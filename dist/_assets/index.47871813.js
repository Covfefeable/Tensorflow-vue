/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class t{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class e{refCount(t){return n("refCount")}incRef(t){return n("incRef")}timerAvailable(){return!0}time(t){return n("time")}read(t){return n("read")}readSync(t){return n("readSync")}numDataIds(){return n("numDataIds")}disposeData(t,e){return n("disposeData")}write(t,e,i){return n("write")}move(t,e,i,r,o){return n("move")}memory(){return n("memory")}floatPrecision(){return n("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return n("dispose")}}function n(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i(t){let e=t.length,n=0,i=0;for(;e>0;)i=Math.random()*e|0,e--,n=t[e],t[e]=t[i],t[i]=n}function r(t,e,n){return Math.max(t,Math.min(e,n))}function o(t){return t%2==0?t:t+1}function a(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function s(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function l(t,e,n=""){s(d(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function u(t){s(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function c(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||C(t)&&!n)for(let i=0;i<t.length;++i)c(t[i],e,n);else e.push(t);return e}function h(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function d(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function p(t){return t%1==0}function f(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function g(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function m(t,e=(t=>0),n){return new Promise(((i,r)=>{let o=0;const a=()=>{if(t())return void i();o++;const s=e(o);null!=n&&o>=n?r():setTimeout(a,s)};a()}))}function y(t,e){let n=1,i=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==i)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${e}`);i=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===i){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[i]=e/n,r}function v(t,e){const n=e.length;return s((t=null==t?e.map(((t,e)=>e)):[].concat(t)).every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),s(t.every((t=>p(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function x(t,e){const n=[],i=[],r=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||r?null:v(e,t).sort();let a=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[a]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[a]||o[a]>e)&&1===t[e]&&(n.push(t[e]),i.push(e)),o[a]<=e&&a++}1!==t[e]&&(n.push(t[e]),i.push(e))}return{newShape:n,keptDims:i}}function b(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function w(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function _(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${e} being uploaded contains ${i}.`)}}function k(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function S(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function C(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function A(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function I(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function M(t){return"string"==typeof t||t instanceof String}function D(t){return"boolean"==typeof t}function T(t){return"number"==typeof t}function E(t){return Array.isArray(t)?E(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":T(t)?"float32":M(t)?"string":D(t)?"bool":"float32"}function N(t){return!!(t&&t.constructor&&t.call&&t.apply)}function O(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function F(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let i=e-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}function R(t,e,n,i=!1){const r=new Array;if(1===e.length){const o=e[0]*(i?2:1);for(let e=0;e<o;e++)r[e]=n[t+e]}else{const o=e[0],a=e.slice(1),s=a.reduce(((t,e)=>t*e))*(i?2:1);for(let e=0;e<o;e++)r[e]=R(t+e*s,a,n,i)}return r}function L(t,e,n=!1){if(0===t.length)return e[0];const i=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===i)return[];if(i!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return R(0,t,e,n)}function $(t,e){const n=P(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function P(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function z(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return L(t,new Float32Array(n));if("int32"===e)return L(t,new Int32Array(n));if("bool"===e)return L(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function B(t){t.forEach((e=>{s(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function V(t,e,n){if(0===e)return 0;if(1===e)return t[0];let i=t[t.length-1];for(let e=0;e<t.length-1;++e)i+=n[e]*t[e];return i}function W(t,e,n){if(0===e)return[];if(1===e)return[t];const i=new Array(e);for(let e=0;e<i.length-1;++e)i[e]=Math.floor(t/n[e]),t-=i[e]*n[e];return i[i.length-1]=t,i}function j(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=G,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(j(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function G(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function H(){return X}let q,X=null;function Y(){if(null==q){let t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}q=t}return q}function K(t,e){const n=function(){const t=Y();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const i=e();return n.set(t,i),n.get(t)}}const Z="Cos",J="Erf",Q="Exp",tt="Mod",et="Sin",nt="Sub",it="Tan",rt=K("kernelRegistry",(()=>new Map)),ot=K("gradRegistry",(()=>new Map));function at(t,e){const n=ht(t,e);return rt.get(n)}function st(t){return ot.get(t)}function lt(t){const e=rt.entries(),n=[];for(;;){const{done:i,value:r}=e.next();if(i)break;const[o,a]=r,[s]=o.split("_");s===t&&n.push(a)}return n}function ut(t){const{kernelName:e,backendName:n}=t,i=ht(e,n);rt.has(i)&&console.warn(`The kernel '${e}' for backend '${n}' is already registered`),rt.set(i,t)}function ct(t){const{kernelName:e}=t;ot.has(e)&&H().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${e}'`),ot.set(e,t)}function ht(t,e){return`${e}_${t}`}var dt=ft,pt=null;try{pt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function ft(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function gt(t){return!0===(t&&t.__isLong__)}ft.prototype.__isLong__,Object.defineProperty(ft.prototype,"__isLong__",{value:!0}),ft.isLong=gt;var mt={},yt={};function vt(t,e){var n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=yt[t])?i:(n=bt(t,(0|t)<0?-1:0,!0),r&&(yt[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=mt[t])?i:(n=bt(t,t<0?-1:0,!1),r&&(mt[t]=n),n)}function xt(t,e){if(isNaN(t))return e?Dt:Mt;if(e){if(t<0)return Dt;if(t>=Ct)return Ft}else{if(t<=-At)return Rt;if(t+1>=At)return Ot}return t<0?xt(-t,e).neg():bt(t%St|0,t/St|0,e)}function bt(t,e,n){return new ft(t,e,n)}ft.fromInt=vt,ft.fromNumber=xt,ft.fromBits=bt;var wt=Math.pow;function _t(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Mt;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return _t(t.substring(1),e,n).neg();for(var r=xt(wt(n,8)),o=Mt,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+s),n);if(s<8){var u=xt(wt(n,s));o=o.mul(u).add(xt(l))}else o=(o=o.mul(r)).add(xt(l))}return o.unsigned=e,o}function kt(t,e){return"number"==typeof t?xt(t,e):"string"==typeof t?_t(t,e):bt(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}ft.fromString=_t,ft.fromValue=kt;var St=4294967296,Ct=St*St,At=Ct/2,It=vt(1<<24),Mt=vt(0);ft.ZERO=Mt;var Dt=vt(0,!0);ft.UZERO=Dt;var Tt=vt(1);ft.ONE=Tt;var Et=vt(1,!0);ft.UONE=Et;var Nt=vt(-1);ft.NEG_ONE=Nt;var Ot=bt(-1,2147483647,!1);ft.MAX_VALUE=Ot;var Ft=bt(-1,-1,!0);ft.MAX_UNSIGNED_VALUE=Ft;var Rt=bt(0,-2147483648,!1);ft.MIN_VALUE=Rt;var Lt=ft.prototype;Lt.toInt=function(){return this.unsigned?this.low>>>0:this.low},Lt.toNumber=function(){return this.unsigned?(this.high>>>0)*St+(this.low>>>0):this.high*St+(this.low>>>0)},Lt.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Rt)){var e=xt(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=xt(wt(t,6),this.unsigned),o=this,a="";;){var s=o.div(r),l=(o.sub(s.mul(r)).toInt()>>>0).toString(t);if((o=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},Lt.getHighBits=function(){return this.high},Lt.getHighBitsUnsigned=function(){return this.high>>>0},Lt.getLowBits=function(){return this.low},Lt.getLowBitsUnsigned=function(){return this.low>>>0},Lt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Rt)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Lt.isZero=function(){return 0===this.high&&0===this.low},Lt.eqz=Lt.isZero,Lt.isNegative=function(){return!this.unsigned&&this.high<0},Lt.isPositive=function(){return this.unsigned||this.high>=0},Lt.isOdd=function(){return 1==(1&this.low)},Lt.isEven=function(){return 0==(1&this.low)},Lt.equals=function(t){return gt(t)||(t=kt(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Lt.eq=Lt.equals,Lt.notEquals=function(t){return!this.eq(t)},Lt.neq=Lt.notEquals,Lt.ne=Lt.notEquals,Lt.lessThan=function(t){return this.comp(t)<0},Lt.lt=Lt.lessThan,Lt.lessThanOrEqual=function(t){return this.comp(t)<=0},Lt.lte=Lt.lessThanOrEqual,Lt.le=Lt.lessThanOrEqual,Lt.greaterThan=function(t){return this.comp(t)>0},Lt.gt=Lt.greaterThan,Lt.greaterThanOrEqual=function(t){return this.comp(t)>=0},Lt.gte=Lt.greaterThanOrEqual,Lt.ge=Lt.greaterThanOrEqual,Lt.compare=function(t){if(gt(t)||(t=kt(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Lt.comp=Lt.compare,Lt.negate=function(){return!this.unsigned&&this.eq(Rt)?Rt:this.not().add(Tt)},Lt.neg=Lt.negate,Lt.add=function(t){gt(t)||(t=kt(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,o=t.high>>>16,a=65535&t.high,s=t.low>>>16,l=0,u=0,c=0,h=0;return c+=(h+=r+(65535&t.low))>>>16,u+=(c+=i+s)>>>16,l+=(u+=n+a)>>>16,l+=e+o,bt((c&=65535)<<16|(h&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},Lt.subtract=function(t){return gt(t)||(t=kt(t)),this.add(t.neg())},Lt.sub=Lt.subtract,Lt.multiply=function(t){if(this.isZero())return Mt;if(gt(t)||(t=kt(t)),pt)return bt(pt.mul(this.low,this.high,t.low,t.high),pt.get_high(),this.unsigned);if(t.isZero())return Mt;if(this.eq(Rt))return t.isOdd()?Rt:Mt;if(t.eq(Rt))return this.isOdd()?Rt:Mt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(It)&&t.lt(It))return xt(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,o=t.high>>>16,a=65535&t.high,s=t.low>>>16,l=65535&t.low,u=0,c=0,h=0,d=0;return h+=(d+=r*l)>>>16,c+=(h+=i*l)>>>16,h&=65535,c+=(h+=r*s)>>>16,u+=(c+=n*l)>>>16,c&=65535,u+=(c+=i*s)>>>16,c&=65535,u+=(c+=r*a)>>>16,u+=e*l+n*s+i*a+r*o,bt((h&=65535)<<16|(d&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Lt.mul=Lt.multiply,Lt.divide=function(t){if(gt(t)||(t=kt(t)),t.isZero())throw Error("division by zero");var e,n,i;if(pt)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?bt((this.unsigned?pt.div_u:pt.div_s)(this.low,this.high,t.low,t.high),pt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Dt:Mt;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Dt;if(t.gt(this.shru(1)))return Et;i=Dt}else{if(this.eq(Rt))return t.eq(Tt)||t.eq(Nt)?Rt:t.eq(Rt)?Tt:(e=this.shr(1).div(t).shl(1)).eq(Mt)?t.isNegative()?Tt:Nt:(n=this.sub(t.mul(e)),i=e.add(n.div(t)));if(t.eq(Rt))return this.unsigned?Dt:Mt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Mt}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var r=Math.ceil(Math.log(e)/Math.LN2),o=r<=48?1:wt(2,r-48),a=xt(e),s=a.mul(t);s.isNegative()||s.gt(n);)s=(a=xt(e-=o,this.unsigned)).mul(t);a.isZero()&&(a=Tt),i=i.add(a),n=n.sub(s)}return i},Lt.div=Lt.divide,Lt.modulo=function(t){return gt(t)||(t=kt(t)),pt?bt((this.unsigned?pt.rem_u:pt.rem_s)(this.low,this.high,t.low,t.high),pt.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Lt.mod=Lt.modulo,Lt.rem=Lt.modulo,Lt.not=function(){return bt(~this.low,~this.high,this.unsigned)},Lt.and=function(t){return gt(t)||(t=kt(t)),bt(this.low&t.low,this.high&t.high,this.unsigned)},Lt.or=function(t){return gt(t)||(t=kt(t)),bt(this.low|t.low,this.high|t.high,this.unsigned)},Lt.xor=function(t){return gt(t)||(t=kt(t)),bt(this.low^t.low,this.high^t.high,this.unsigned)},Lt.shiftLeft=function(t){return gt(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?bt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):bt(0,this.low<<t-32,this.unsigned)},Lt.shl=Lt.shiftLeft,Lt.shiftRight=function(t){return gt(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?bt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):bt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Lt.shr=Lt.shiftRight,Lt.shiftRightUnsigned=function(t){if(gt(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?bt(this.low>>>t|e<<32-t,e>>>t,this.unsigned):bt(32===t?e:e>>>t-32,0,this.unsigned)},Lt.shru=Lt.shiftRightUnsigned,Lt.shr_u=Lt.shiftRightUnsigned,Lt.toSigned=function(){return this.unsigned?bt(this.low,this.high,!1):this},Lt.toUnsigned=function(){return this.unsigned?this:bt(this.low,this.high,!0)},Lt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Lt.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Lt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},ft.fromBytes=function(t,e,n){return n?ft.fromBytesLE(t,e):ft.fromBytesBE(t,e)},ft.fromBytesLE=function(t,e){return new ft(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},ft.fromBytesBE=function(t,e){return new ft(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var $t=Object.freeze(Object.assign(Object.create(null),dt,{[Symbol.toStringTag]:"Module",default:dt}));
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pt=dt||$t;function zt(t){return Pt.fromString(t,!0,16)}const Bt=zt("c3a5c85c97cb3127"),Vt=zt("b492b66fbe98f273"),Wt=zt("9ae16a3b2f90404f");function jt(t){return t.xor(t.shru(47))}function Ut(t,e,n){const i=t.slice(e,e+n);return Pt.fromBytes(Array.from(i),!0,!0)}function Gt(t,e){return Ut(t,e,8)}function Ht(t,e){return Ut(t,e,4)}function qt(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function Xt(t,e,n=zt("9ddfea08eb382d69")){let i=t.xor(e).mul(n);i=i.xor(i.shru(47));let r=e.xor(i).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function Yt(t,e,n,i){return function(t,e,n,i,r,o){r=r.add(t),o=qt(o.add(r).add(i),21);const a=r;return r=(r=r.add(e)).add(n),o=o.add(qt(r,44)),[r.add(i),o.add(a)]}(Gt(t,e),Gt(t,e+8),Gt(t,e+16),Gt(t,e+24),n,i)}function Kt(t,e=t.length){const n=Pt.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Wt.add(2*e),i=Gt(t,0).add(Wt),r=Gt(t,e-8);return Xt(qt(r,37).mul(n).add(i),qt(i,25).add(r).mul(n),n)}if(e>=4){const n=Wt.add(2*e);return Xt(Ht(t,0).shl(3).add(e),Ht(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),i=e+(t[e-1]<<2);return jt(Wt.mul(n).xor(Bt.mul(i))).mul(Wt)}return Wt}(t,e):function(t,e=t.length){const n=Wt.add(2*e),i=Gt(t,0).mul(Vt),r=Gt(t,8),o=Gt(t,e-8).mul(n),a=Gt(t,e-16).mul(Wt);return Xt(qt(i.add(r),43).add(qt(o,30)).add(a),i.add(qt(r.add(Wt),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Wt.add(2*e),i=Gt(t,0).mul(Wt),r=Gt(t,8),o=Gt(t,e-8).mul(n),a=Gt(t,e-16).mul(Wt),s=qt(i.add(r),43).add(qt(o,30)).add(a),l=Xt(s,i.add(qt(r.add(Wt),18)).add(o),n),u=Gt(t,16).mul(n),c=Gt(t,24),h=s.add(Gt(t,e-32)).mul(n),d=l.add(Gt(t,e-24)).mul(n);return Xt(qt(u.add(c),43).add(qt(h,30)).add(d),u.add(qt(c.add(i),18)).add(h),n)}(t,e);let i=n,r=n.mul(Vt).add(113),o=jt(r.mul(Wt).add(113)).mul(Wt),a=[Pt.UZERO,Pt.UZERO],s=[Pt.UZERO,Pt.UZERO];i=i.mul(Wt).add(Gt(t,0));let l=0;const u=64*(e-1>>6),c=u+(e-1&63)-63;do{i=qt(i.add(r).add(a[0]).add(Gt(t,l+8)),37).mul(Vt),r=qt(r.add(a[1]).add(Gt(t,l+48)),42).mul(Vt),i=i.xor(s[1]),r=r.add(a[0]).add(Gt(t,l+40)),o=qt(o.add(s[0]),33).mul(Vt),a=Yt(t,l,a[1].mul(Vt),i.add(s[0])),s=Yt(t,l+32,o.add(s[1]),r.add(Gt(t,l+16))),[o,i]=[i,o],l+=64}while(l!==u);const h=Vt.add(o.and(255).shl(1));return l=c,s[0]=s[0].add(e-1&63),a[0]=a[0].add(s[0]),s[0]=s[0].add(a[0]),i=qt(i.add(r).add(a[0]).add(Gt(t,l+8)),37).mul(h),r=qt(r.add(a[1]).add(Gt(t,l+48)),42).mul(h),i=i.xor(s[1].mul(9)),r=r.add(a[0].mul(9).add(Gt(t,l+40))),o=qt(o.add(s[0]),33).mul(h),a=Yt(t,l,a[1].mul(h),i.add(s[0])),s=Yt(t,l+32,o.add(s[1]),r.add(Gt(t,l+16))),[o,i]=[i,o],Xt(Xt(a[0],s[0],h).add(jt(r).mul(Bt)).add(o),Xt(a[1],s[1],h).add(i),h)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(t,e){return"string"===e?te(t):Jt([t],e)}function Jt(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=c(t)),H().getBool("DEBUG")&&_(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function Qt(){return H().platform.now()}function te(t,e="utf-8"){return e=e||"utf-8",H().platform.encode(t,e)}function ee(t,e="utf-8"){return e=e||"utf-8",H().platform.decode(t,e)}var ne=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createScalarValue:Zt,toTypedArray:Jt,now:Qt,fetch:function(t,e){return H().platform.fetch(t,e)},encodeString:te,decodeString:ee,shuffle:i,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n,i,r=t.length,o=0;for(;r>0;)o=Math.random()*r|0,r--,n=t[r],i=e[r],t[r]=t[o],e[r]=e[o],t[o]=n,e[o]=i},clamp:r,nearestLargerEven:o,sum:a,randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let i=0;i<t.length;i++){const r=Number(t[i])-Number(e[i]);n+=r*r}return n},assert:s,assertShapesMatch:l,assertNonNull:u,flatten:c,sizeFromShape:h,isScalarShape:function(t){return 0===t.length},arraysEqual:d,isInt:p,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:f,createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return i(e),e},rightPad:g,repeatedTry:m,inferFromImplicitShape:y,parseAxisParam:v,squeezeShape:x,getTypedArrayFromDType:b,getArrayFromDType:w,checkConversionForErrors:_,isValidDtype:k,hasEncodingLoss:S,isTypedArray:C,bytesPerElement:A,bytesFromStringArray:I,isString:M,isBoolean:D,isNumber:T,inferDtype:E,isFunction:N,nearestDivisor:O,computeStrides:F,toNestedArray:L,makeOnesTypedArray:$,makeZerosTypedArray:P,makeZerosNestedTypedArray:z,assertNonNegativeIntegerDimensions:B,locToIndex:V,indexToLoc:W,isPromise:j,hexToLong:zt,fingerPrint64:Kt});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ie{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new oe)}profileKernel(t,e,n){let i;const r=()=>{i=n()};let o;const a=Qt();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(r);else{r();for(const t of i)t.dataSync();o=Promise.resolve({kernelMs:Qt()-a})}if(H().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<i.length;e++){const n=i[e];n.data().then((e=>{re(e,n.dtype,t)}))}return{kernelName:t,outputs:i,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:i,inputs:r,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),i,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],r,n[2])}))}))}}function re(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const i=t[e];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class oe{logKernelProfile(t,e,n,i,r,o){const a="number"==typeof i?g(`${i}ms`,9):i.error,s=g(t,25),l=e.rank,u=e.size,c=g(e.shape.toString(),14);let h="";for(const t in r){const n=r[t];if(null!=n){const i=n.shape||e.shape,r=i.length;h+=`${t}: ${r}D ${r>0?i:""} `}}console.log(`%c${s}\t%c${a}\t%c${l}D ${c}\t%c${u}\t%c${h}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(t,e,n,i){const r=F(e),o=function(t,e,n,i){const r=h(e),o=i[i.length-1],a=new Array(o).fill(0),s=e.length,l="complex64"===n?ce(t):t;if(s>1)for(let t=0;t<r/o;t++){const e=t*o;for(let t=0;t<o;t++)a[t]=Math.max(a[t],se(l[e+t],0,n).length)}return a}(t,e,n,r),a=e.length,s=ue(t,e,n,r,o),l=["Tensor"];return i&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${a}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(s.map((t=>"    "+t)).join("\n")),l.join("\n")}function se(t,e,n){let i;return i=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:M(t)?`'${t}'`:"bool"===n?le(t):parseFloat(t.toFixed(7)).toString(),g(i,e)}function le(t){return 0===t?"false":"true"}function ue(t,e,n,i,r,o=!0){const a="complex64"===n?2:1,s=e[0],l=e.length;if(0===l){if("complex64"===n){return[se(ce(t)[0],0,n)]}return"bool"===n?[le(t[0])]:[t[0].toString()]}if(1===l){if(s>20){const e=3*a;let i=Array.from(t.slice(0,e)),o=Array.from(t.slice((s-3)*a,s*a));return"complex64"===n&&(i=ce(i),o=ce(o)),["["+i.map(((t,e)=>se(t,r[e],n))).join(", ")+", ..., "+o.map(((t,e)=>se(t,r[s-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?ce(t):Array.from(t)).map(((t,e)=>se(t,r[e],n))).join(", ")+"]"]}const u=e.slice(1),c=i.slice(1),h=i[0]*a,d=[];if(s>20){for(let e=0;e<3;e++){const i=e*h,o=i+h;d.push(...ue(t.slice(i,o),u,n,c,r,!1))}d.push("...");for(let e=s-3;e<s;e++){const i=e*h,o=i+h;d.push(...ue(t.slice(i,o),u,n,c,r,e===s-1))}}else for(let e=0;e<s;e++){const i=e*h,o=i+h;d.push(...ue(t.slice(i,o),u,n,c,r,e===s-1))}const p=2===l?",":"";d[0]="["+d[0]+p;for(let t=1;t<d.length-1;t++)d[t]=" "+d[t]+p;let f=",\n";for(let t=2;t<l;t++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(o?"":f),d}function ce(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class he{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=h(t),null!=n){const t=n.length;s(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||w(e,this.size),this.strides=F(t)}set(t,...e){0===e.length&&(e=[0]),s(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return de().makeTensor(this.values,this.shape,this.dtype)}}let de=null,pe=null;class fe{constructor(t,e,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=h(t),this.strides=F(t),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return pe.buffer(this.shape,this.dtype,t)}bufferSync(){return pe.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return L(this.shape,t,"complex64"===this.dtype)}arraySync(){return L(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=de().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>ee(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataSync(){this.throwIfDisposed();const t=de().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>ee(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await de().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(de().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return pe.print(this,t)}clone(){return this.throwIfDisposed(),pe.clone(this)}toString(t=!1){return ae(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),pe.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),de().makeVariable(this,t,e,n)}}function ge(){return K("Tensor",(()=>fe))}Object.defineProperty(fe,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),ge();class me extends fe{constructor(t,e,n,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!d(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);de().disposeTensor(this),this.dataId=t.dataId,de().incRef(this,null)}dispose(){de().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var ye,ve,xe,be,we,_e,ke,Se,Ce,Ae;Object.defineProperty(me,Symbol.hasInstance,{value:t=>t instanceof fe&&null!=t.assign&&t.assign instanceof Function}),(ve=ye||(ye={})).R0="R0",ve.R1="R1",ve.R2="R2",ve.R3="R3",ve.R4="R4",ve.R5="R5",ve.R6="R6",(be=xe||(xe={})).float32="float32",be.int32="int32",be.bool="int32",be.complex64="complex64",(_e=we||(we={})).float32="float32",_e.int32="int32",_e.bool="bool",_e.complex64="complex64",(Se=ke||(ke={})).float32="float32",Se.int32="float32",Se.bool="float32",Se.complex64="complex64",(Ae=Ce||(Ce={})).float32="complex64",Ae.int32="complex64",Ae.bool="complex64",Ae.complex64="complex64";const Ie={float32:ke,int32:xe,bool:we,complex64:Ce};function Me(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Ie[t][e]}function De(t){return Me(t,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(t,e){if(t.dtype===e.dtype)return[t,e];const n=Me(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Ee(t,e){s(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Ne(t){const e=[];return Oe(t,e,new Set),e}function Oe(t,e,n){if(null==t)return;if(t instanceof fe)return void e.push(t);if(i=t,!Array.isArray(i)&&"object"!=typeof i)return;var i;const r=t;for(const t in r){const i=r[t];n.has(i)||(n.add(i),Oe(i,e,n))}}var Fe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",makeTypesMatch:Te,assertTypesMatch:Ee,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:Ne});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(t){return null!=t.kernelName}class Le{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class $e{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Le}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(console.warn(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ie(this.backendInstance),!0}setupRegisteredKernels(){lt(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){lt(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const n=this.registryFactory[t];if(null==n)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const i=n.factory();if(!i||i instanceof e||"function"!=typeof i.then)return this.registry[t]=i,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,n=i.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message)),!1)));return this.pendingBackendInit=n,{success:n,asyncInit:!0}}}catch(e){return console.warn(`Initialization of backend ${t} failed`),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:i,asyncInit:r}=this.initializeBackend(n);if(r||i)return{name:n,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),i=n.backend,r=this.readSync(e),o=i.refCount(e);i.disposeData(e,!0),n.backend=t,t.move(e,r,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun((()=>this.startScope(i)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return $e.nextTensorId++}nextVariableId(){return $e.nextVariableId++}clone(t){const e=ze.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return ze.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){if(!(null!=at(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const i=this.backend.numDataIds();let r=0;n.forEach((t=>{r+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-e-r-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const i=this.isTapeOn(),r=this.state.numBytes,o=this.state.numTensors;let a,l;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=Re(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Re(t)){const{kernelName:e,inputs:r,attrs:o}=t;null==this.backendName&&this.backend;const u=at(e,this.backendName);s(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),a=()=>{const t=this.backend.numDataIds();l=u.kernelFunc({inputs:r,attrs:o,backend:this.backend});const a=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,a);const s=a.map((t=>{if(null!=t.rank)return t;const{dataId:e,shape:n,dtype:i}=t;return this.makeTensorFromDataId(e,n,i)}));if(i){const t=this.getTensorsForGradient(e,r,s);n=this.saveTensorsForBackwardMode(t)}return s}}else{const{forwardFunc:e}=t,r=t=>{i&&(n=t.map((t=>this.keep(this.clone(t)))))};a=()=>{const t=this.backend.numDataIds();l=this.tidy((()=>e(this.backend,r)));const n=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:h}=t,d=Re(t)?null:t.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(u,c,(()=>a())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs):e=a()})),i&&this.addTapeNode(u,c,e,d,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?e:e[0]}saveTensorsForBackwardMode(t){return t.map((t=>this.keep(this.clone(t))))}getTensorsForGradient(t,e,n){const i=st(t);if(null!=i){const t=i.inputsToSave||[],r=i.outputsToSave||[];let o;i.saveAllInputs?(s(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const a=n.filter(((t,e)=>r[e]));return o.concat(a)}return[]}makeTensor(t,e,n,i){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;let r=t;"string"===n&&M(t[0])&&(r=t.map((t=>te(t))));const o=i.write(r,e,n),a=new fe(e,n,o,this.nextTensorId());if(this.trackTensor(a,i),"string"===n){const t=this.state.tensorInfo.get(o),e=I(r);this.state.numBytes+=e-t.bytes,t.bytes=e}return a}makeTensorFromDataId(t,e,n,i){const r=new fe(e,n=n||"float32",t,this.nextTensorId());return this.trackTensor(r,i),r}makeVariable(t,e=!0,n,i){n=n||this.nextVariableId().toString(),null!=i&&i!==t.dtype&&(t=t.cast(i));const r=new me(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[r.name])throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*A(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof me||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*A(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,i,r,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:r},s=st(t);null!=s&&(i=s.gradFunc),null!=i&&(a.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],i=P(t.size,t.dtype);return this.makeTensor(i,t.shape,t.dtype)}return t})),i(t.length>1?t:t[0],r,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Ne(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==i.id||this.track(t)}))}gradients(t,e,n,i=!1){if(s(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const r=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));s(r instanceof fe,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const i={},r={};for(let t=0;t<e.length;t++)i[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],a=o.inputs;for(const t in a){const n=a[t];let s=!1;for(let t=0;t<e.length;t++)if(i[n.id]){o.outputs.forEach((t=>i[t.id]=!0)),s=!0,r[o.id]=!0;break}if(s)break}}const o={};o[n.id]=!0;const a={};for(let e=t.length-1;e>=0;e--){const n=t[e],i=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in i)o[i[t].id]=!0,a[n.id]=!0;break}}const s=[];for(let e=0;e<t.length;e++){const n=t[e];if(r[n.id]&&a[n.id]){const t={};for(const e in n.inputs){const r=n.inputs[e];i[r.id]&&(t[e]=r)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,s.push(e)}}return s}(this.state.activeTape,e,r);if(!i&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[r.id]=null==n?function(t){const e=$(h(t),"float32");return ze.makeTensor(e,t,"float32")}(r.shape):n,function(t,e,n,i){for(let r=e.length-1;r>=0;r--){const o=e[r],a=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?a.push(n):a.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const s=o.gradient(a);for(const e in o.inputs){if(!(e in s))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(s)}.`);const r=n((()=>s[e]()));if("float32"!==r.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${r.dtype}'`);const a=o.inputs[e];if(!d(r.shape,a.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${r.shape}', which does not match the shape of the input '${a.shape}'`);if(null==t[a.id])t[a.id]=r;else{const e=t[a.id];t[a.id]=i(e,r),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),Be);const i=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:r,grads:i}}))}customGrad(t){return s(N(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;s(e.every((t=>t instanceof fe)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const i={};e.forEach(((t,e)=>{i[e]=t}));return this.runKernelFunc({forwardFunc:(i,r)=>(n=t(...e,r),s(n.value instanceof fe,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),s(N(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,i)=>{const r=n.gradFunc(t,i),o=Array.isArray(r)?r:[r];s(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),s(o.every((t=>t instanceof fe)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const a={};return o.forEach(((t,e)=>{a[e]=()=>t})),a},inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}async time(t){const e=Qt(),n=await this.backend.time(t);return n.wallMs=Qt()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Le;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function Pe(){const t=Y();if(null==t._tfengine){const e=new U(t);t._tfengine=new $e(e)}var e;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */return e=t._tfengine.ENV,X=e,de=()=>t._tfengine,t._tfengine}$e.nextTensorId=0,$e.nextVariableId=0;const ze=Pe();function Be(t,e){const n={a:t,b:e};return ze.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(t){if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function We(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var je=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isMobile:Ve,isBrowser:We});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ue=H();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ge(t,e){let n=t;if(C(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const i=[];for(;Array.isArray(n)||C(n)&&"string"!==e;)i.push(n.length),n=n[0];return Array.isArray(t)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&He(t,i,[]),i}function He(t,e,n){if(n=n||[],!Array.isArray(t)&&!C(t))return void s(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));s(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),s(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const i=e.slice(1);for(let e=0;e<t.length;++e)He(t[e],i,n.concat(e))}function qe(t,e,n,i){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${i}' must be ${t} tensor, but got ${e} tensor`)}}function Xe(t,e,n,i="numeric"){if(t instanceof fe)return qe(i,t.dtype,e,n),t;let r=E(t);if("string"!==r&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),qe(i,r,e,n),null==t||!C(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const i=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${i}'`)}const o=Ge(t,r);C(t)||Array.isArray(t)||(t=[t]);const a="string"!==r?Jt(t,r):c(t,[],!0);return ze.makeTensor(a,o,r)}function Ye(t,e,n,i="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,r)=>Xe(t,`${e}[${r}]`,n,i)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ue.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ue.registerFlag("IS_BROWSER",(()=>We())),Ue.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),Ue.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Ue.registerFlag("PROD",(()=>!1)),Ue.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Ue.getBool("DEBUG"))),Ue.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Ue.registerFlag("IS_TEST",(()=>!1)),Ue.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),Ue.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1));function Ke(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const i=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const r=(...t)=>{ze.startScope(n);try{const e=i(...t);return j(e)&&console.error("Cannot return a Promise inside of tidy."),ze.endScope(e),e}catch(t){throw ze.endScope(null),t}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ze=Ke({complex_:function(t,e){const n=Xe(t,"real","complex"),i=Xe(e,"imag","complex");l(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const r={real:n,imag:i};return ze.runKernel("Complex",r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Je(t,e,n,i){if(null==i&&(i=E(t)),"complex64"===i)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!C(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){B(e);const t=h(e),i=h(n);s(t===i,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${i}`));for(let t=0;t<n.length;++t){const i=n[t],r=t!==n.length-1||i!==h(e.slice(t));s(n[t]===e[t]||!r,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return C(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==i?Jt(t,i):c(t,[],!0),ze.makeTensor(t,e,i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qe(t,e,n){return Je(t,e,Ge(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tn={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function en(t,e){const n=[],i=[],r=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],s=Array.isArray(t)?t[o].tensor:t[a];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error(`Unsupported dtype in weight '${a}': ${s.dtype}`);const l={name:a,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const t=new Promise((async t=>{const e=await s.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,i=new Uint8Array(n);let r=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);i.set(o,r),r+=4,i.set(n,r),r+=n.length}t(i)}));i.push(t)}else i.push(s.data());null!=e&&(l.group=e),n.push(l)}return{data:rn(await Promise.all(i)),specs:n}}function nn(t,e){const n={};let i,r=0;for(const o of e){const e=o.name,a=o.dtype,s=o.shape,l=h(s);let u;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==a)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${a}.`)}const s=tn[n.dtype],c=t.slice(r,r+l*s),h="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===a)if("uint8"===n.dtype||"uint16"===n.dtype){u=new Float32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];u[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===i&&(i=cn()),u=i(h)}else{if("int32"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);u=new Int32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];u[t]=Math.round(e*n.scale+n.min)}}r+=l*s}else if("string"===a){const e=h(o.shape);u=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(r,r+4))[0];r+=4;const n=new Uint8Array(t.slice(r,r+e));u.push(n),r+=e}}else{const i=tn[a],o=t.slice(r,r+l*i);if("float32"===a)u=new Float32Array(o);else if("int32"===a)u=new Int32Array(o);else if("bool"===a)u=new Uint8Array(o);else{if("complex64"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);{u=new Float32Array(o);const t=new Float32Array(u.length/2),i=new Float32Array(u.length/2);for(let e=0;e<t.length;e++)t[e]=u[2*e],i[e]=u[2*e+1];const r=Qe(t,s,"float32"),a=Qe(i,s,"float32");n[e]=Ze(r,a),r.dispose(),a.dispose()}}r+=l*i}"complex64"!==a&&(n[e]=Qe(u,s,a))}return n}function rn(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const i=new Uint8Array(e);let r=0;return n.forEach((t=>{i.set(new Uint8Array(t.buffer),r),r+=t.byteLength})),i.buffer}const on="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function an(t){return on?Buffer.byteLength(t):new Blob([t]).size}function sn(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let i=0;return t.forEach((t=>{n.set(new Uint8Array(t),i),i+=t.byteLength})),n.buffer}function ln(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function un(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:an(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:an(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function cn(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return i=>{const r=new ArrayBuffer(4*i.length),o=new Uint32Array(r);for(let r=0;r<i.length;r++){const a=i[r],s=t[n[a>>10]+(1023&a)]+e[a>>10];o[r]=s}return new Float32Array(r)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==hn.instance&&(hn.instance=new hn),hn.instance}static registerSaveRouter(t){hn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){hn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return hn.getHandlers(t,"save")}static getLoadHandlers(t,e){return hn.getHandlers(t,"load",e)}static getHandlers(t,e,n){const i=[];return("load"===e?hn.getInstance().loadRouters:hn.getInstance().saveRouters).forEach((e=>{const r=e(t,n);null!==r&&i.push(r)})),i}}const dn=t=>hn.getSaveHandlers(t);function pn(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function fn(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class gn{constructor(t){if(this.indexedDB=pn(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const i=this.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=()=>fn(i),i.onsuccess=()=>{const r=i.result;if(null==e){const e=r.transaction("models_store","readonly"),i=e.objectStore("models_store").get(this.modelPath);i.onsuccess=()=>{if(null==i.result)return r.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(i.result.modelArtifacts)},i.onerror=t=>(r.close(),n(i.error)),e.oncomplete=()=>r.close()}else{const i=un(e),o=r.transaction("model_info_store","readwrite");let a=o.objectStore("model_info_store");const s=a.put({modelPath:this.modelPath,modelArtifactsInfo:i});let l;s.onsuccess=()=>{l=r.transaction("models_store","readwrite");const s=l.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:i});s.onsuccess=()=>t({modelArtifactsInfo:i}),s.onerror=t=>{a=o.objectStore("model_info_store");const e=a.delete(this.modelPath);e.onsuccess=()=>(r.close(),n(s.error)),e.onerror=t=>(r.close(),n(s.error))}},s.onerror=t=>(r.close(),n(s.error)),o.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}}},i.onerror=t=>n(i.error)}))}}gn.URL_SCHEME="indexeddb://";const mn=t=>{return H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(gn.URL_SCHEME)?(e=t.slice(gn.URL_SCHEME.length),new gn(e)):null;var e};hn.registerSaveRouter(mn),hn.registerLoadRouter(mn);class yn{constructor(){this.indexedDB=pn()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>fn(n),n.onsuccess=()=>{const i=n.result,r=i.transaction("model_info_store","readonly"),o=r.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(i.close(),e(o.error)),r.oncomplete=()=>i.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(gn.URL_SCHEME)?e.slice(gn.URL_SCHEME.length):e,new Promise(((e,n)=>{const i=this.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=()=>fn(i),i.onsuccess=()=>{const r=i.result,o=r.transaction("model_info_store","readwrite"),a=o.objectStore("model_info_store"),s=a.get(t);let l;s.onsuccess=()=>{if(null==s.result)return r.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const i=a.delete(t),o=()=>{l=r.transaction("models_store","readwrite");const i=l.objectStore("models_store").delete(t);i.onsuccess=()=>e(s.result.modelArtifactsInfo),i.onerror=t=>n(s.error)};i.onsuccess=o,i.onerror=t=>(o(),r.close(),n(s.error))}},s.onerror=t=>(r.close(),n(s.error)),o.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}},i.onerror=t=>n(i.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vn="tensorflowjs_models",xn="info",bn="model_topology",wn="weight_specs",_n="weight_data",kn="model_metadata";function Sn(t){return{info:[vn,t,xn].join("/"),topology:[vn,t,bn].join("/"),weightSpecs:[vn,t,wn].join("/"),weightData:[vn,t,_n].join("/"),modelMetadata:[vn,t,kn].join("/")}}function Cn(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class An{constructor(t){if(!H().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Sn(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),i=un(t);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(on)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,i=e.length;t<i;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const r={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(r)),{modelArtifactsInfo:i}}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==i)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(null!=r){const t=JSON.parse(r);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(on){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}An.URL_SCHEME="localstorage://";const In=t=>{return H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(An.URL_SCHEME)?(e=t.slice(An.URL_SCHEME.length),new An(e)):null;var e};hn.registerSaveRouter(In),hn.registerLoadRouter(In);class Mn{constructor(){s(H().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),s("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=vn+"/",n="/"+xn;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(e)&&r.endsWith(n)){t[Cn(r)]=JSON.parse(this.LS.getItem(r))}}return t}async removeModel(t){var e;const n=Sn(t=(e=t).startsWith(An.URL_SCHEME)?e.slice(An.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const i=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),i}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dn{constructor(){this.managers={}}static getInstance(){return null==Dn.instance&&(Dn.instance=new Dn),Dn.instance}static registerManager(t,e){s(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),s(t.length>0,(()=>"scheme must not be an empty string."));const n=Dn.getInstance();s(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function Tn(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Dn.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function En(t,e,n=!1){s(t!==e,(()=>`Old path and new path are the same: '${t}'`));const i=hn.getLoadHandlers(t);s(i.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),s(i.length<2,(()=>`Copying failed because more than one (${i.length}) load handlers for source URL ${t}.`));const r=i[0],o=hn.getSaveHandlers(e);s(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),s(o.length<2,(()=>`Copying failed because more than one (${i.length}) save handlers for destination URL ${e}.`));const a=o[0],l=Tn(t).scheme,u=Tn(t).path,c=l===Tn(t).scheme,h=await r.load();n&&c&&await Dn.getManager(l).removeModel(u);const d=await a.save(h);return n&&!c&&await Dn.getManager(l).removeModel(u),d.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Nn{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(H().get("IS_BROWSER")){H().setPlatform("browser",new Nn);try{Dn.registerManager(An.URL_SCHEME,new Mn)}catch(t){}try{Dn.registerManager(gn.URL_SCHEME,new yn)}catch(t){}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const On=()=>require("node-fetch");let Fn;class Rn{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=H().global.fetch?H().global.fetch(t,e):(null==Fn&&(Fn=On()),Fn(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ln(t,e="float32",n){return e=e||"float32",B(t),new he(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().get("IS_NODE")&&H().setPlatform("node",new Rn);const $n=Ke({cast_:function(t,e){const n=Xe(t,"x","cast");if(!k(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const i={x:n},r={dtype:e};return ze.runKernel("Cast",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pn=Ke({clone_:function(t){const e={x:Xe(t,"x","clone","string_or_numeric")};return ze.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe();pe={buffer:Ln,cast:$n,clone:Pn,print:zn};function Bn(t){return new Promise((t=>setTimeout(t))).then(t)}class Vn{constructor(t){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Vn.URL_SCHEME)&&(t=t.slice(Vn.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer);const r=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(o.download=this.modelTopologyFileName,o.href=r,await Bn((()=>o.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await Bn((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:un(t)}}}}Vn.URL_SCHEME="downloads://";class Wn{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.files=t}async load(){const t=this.files[0],e=this.files.slice(1);return new Promise(((n,i)=>{const r=new FileReader;r.onload=r=>{const o=JSON.parse(r.target.result),a=o.modelTopology;if(null==a)return void i(new Error(`modelTopology field is missing from file ${t.name}`));0===e.length&&n({modelTopology:a});const s=o.weightsManifest;if(null==s)return void i(new Error(`weightManifest field is missing from file ${t.name}`));let l;try{l=this.checkManifestAndWeightFiles(s,e)}catch(t){return void i(t)}const u=[],c=[],h=[];s.forEach((t=>{t.paths.forEach((t=>{c.push(t),h.push(null)})),u.push(...t.weights)})),s.forEach((t=>{t.paths.forEach((t=>{const e=new FileReader;e.onload=e=>{const i=e.target.result,r=c.indexOf(t);if(h[r]=i,-1===h.indexOf(null)){const t={modelTopology:a,weightSpecs:u,weightData:sn(h),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy};null!=o.signature&&(t.signature=o.signature),null!=o.userDefinedMetadata&&(t.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(t.modelInitializer=o.modelInitializer),n(t)}},e.onerror=e=>i(`Failed to weights data from file of path '${t}'.`),e.readAsArrayBuffer(l[t])}))}))},r.onerror=e=>i(`Failed to read model topology and weights manifest JSON from file '${t.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(t)}))}checkManifestAndWeightFiles(t,e){const n=[],i=e.map((t=>ln(t.name))),r={};for(const o of t)o.paths.forEach((t=>{const o=ln(t);if(-1!==n.indexOf(o))throw new Error(`Duplicate file basename found in weights manifest: '${o}'`);if(n.push(o),-1===i.indexOf(o))throw new Error(`Weight file with basename '${o}' is not provided.`);r[t]=e[i.indexOf(o)]}));if(n.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${e.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jn(t,e,n,i){var r,o,a;s(null!=(r=t)&&Array.isArray(r)&&r.length>0,(()=>"promises must be a none empty array")),a=i=null==i?1:i,s((o=n=null==n?0:n)>=0&&o<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${o}`)),s(a>=0&&a<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${a}`)),s(a>=o,(()=>`startFraction must be no more than endFraction, but got startFraction ${o} and endFraction ${a}`));let l=0;return Promise.all(t.map((r=>(r.then((r=>{const o=n+ ++l/t.length*(i-n);return e(o),r})),r))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Un(t,e){null==e&&(e={});const n=null==e.fetchFunc?H().platform.fetch:e.fetchFunc,i=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),r=(null==e.onProgress?await Promise.all(i):await jn(i,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(r):await jn(r,e.onProgress,.5,1)}function Gn(t){return async(e,n="",i)=>{const r=e.map((()=>!1)),o={},a=null!=i?i.map((()=>!1)):[],s=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const l="quantization"in t?t.quantization.dtype:t.dtype,u=tn[l]*h(t.shape),c=()=>{r[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:u})};null!=i?i.forEach(((e,n)=>{e===t.name&&(c(),a[n]=!0)})):c(),s.push(t.name),n+=u}))})),!a.every((t=>t))){const t=i.filter(((t,e)=>!a[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${s.join(", ")}.`)}const l=r.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),u=[];l.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;u.push(e)}))}));const c=await t(u),d={};let p=0;return l.forEach((t=>{const n=e[t].paths.length;let i=0;for(let t=0;t<n;t++)i+=c[p+t].byteLength;const r=new ArrayBuffer(i),a=new Uint8Array(r);let s=0;for(let t=0;t<n;t++){const e=new Uint8Array(c[p+t]);a.set(e,s),s+=e.byteLength}o[t].forEach((t=>{const e=nn(r.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)d[t]=e[t]})),p+=n})),d}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */hn.registerSaveRouter((t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Vn.URL_SCHEME)?function(t="model"){return new Vn(t)}(t.slice(Vn.URL_SCHEME.length)):null));class Hn{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(s("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=H().platform.fetch,s(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&s(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),e.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:un(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,i=e.weightsManifest,r=e.generatedBy,o=e.convertedBy,a=e.format,s=e.signature,l=e.userDefinedMetadata;if(null==n&&null==i)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let u,c;if(null!=i){const t=await this.loadWeights(i);[u,c]=t}const h={modelTopology:n,weightSpecs:u,weightData:c,generatedBy:r,convertedBy:o,format:a};null!=s&&(h.signature=s),null!=l&&(h.userDefinedMetadata=l);const d=e.modelInitializer;return d&&(h.modelInitializer=d),h}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,i]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),i=t.substring(0,e),r=n>e?t.substring(n):"";return[i+"/",r]}(e),r=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const a=[],s=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(t)):a.push(r+t+i);this.weightUrlConverter&&a.push(...await Promise.all(s));return[o,sn(await Un(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function qn(t){return null!=t.match(Hn.URL_SCHEME_REGEX)}Hn.URL_SCHEME_REGEX=/^https?:\/\//;const Xn=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>qn(t))):qn(t),n)return Yn(t,e)}return null};function Yn(t,e){return new Hn(t,e)}hn.registerSaveRouter(Xn),hn.registerLoadRouter(Xn);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Kn{constructor(t){this.modelArtifacts=t}async load(){return this.modelArtifacts}}class Zn{constructor(t){this.saveHandler=t}async save(t){return this.saveHandler(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Jn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",browserFiles:function(t){return new Wn(t)},browserHTTPRequest:function(t,e){return Yn(t,e)},concatenateArrayBuffers:sn,decodeWeights:nn,encodeWeights:en,fromMemory:function(t,e,n,i){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new Kn(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Kn({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Kn({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:i})},getLoadHandlers:(t,e)=>hn.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getModelArtifactsInfoForJSON:un,getSaveHandlers:dn,http:Yn,isHTTPScheme:qn,loadWeights:async function(t,e="",n,i){return Gn((t=>Un(t,{requestInit:i})))(t,e,n)},registerLoadRouter:t=>hn.registerLoadRouter(t),registerSaveRouter:t=>hn.registerSaveRouter(t),weightsLoaderFactory:Gn,withSaveHandler:function(t){return new Zn(t)},copyModel:async function(t,e){return En(t,e,!1)},listModels:async function(){const t=Dn.getSchemes(),e={};for(const n of t){const t=await Dn.getManager(n).listModels();for(const i in t){e[n+"://"+i]=t[i]}}return e},moveModel:async function(t,e){return En(t,e,!0)},removeModel:async function(t){const e=Tn(t);return Dn.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qn=Ke({matMul_:function(t,e,n=!1,i=!1){let r=Xe(t,"a","matMul"),o=Xe(e,"b","matMul");[r,o]=Te(r,o);const a={a:r,b:o},s={transposeA:n,transposeB:i};return ze.runKernel("BatchMatMul",a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ti=Ke({oneHot_:function(t,e,n=1,i=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const r={indices:Xe(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:i};return ze.runKernel("OneHot",r,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ei=Ke({transpose_:function(t,e){const n=Xe(t,"x","transpose");if(null==e&&(e=n.shape.map(((t,e)=>e)).reverse()),s(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`)),e.forEach((t=>{s(t>=0&&t<n.rank,(()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`))})),n.rank<=1)return n.clone();const i={x:n},r={perm:e};return ze.runKernel("Transpose",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ni=Ke({confusionMatrix_:function(t,e,n){const i=Xe(t,"labels","confusionMatrix"),r=Xe(e,"predictions","confusionMatrix");s(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),s(1===i.rank,(()=>`Expected the rank of labels to be 1, but got ${i.rank}`)),s(1===r.rank,(()=>`Expected the rank of predictions to be 1, but got ${r.rank}`)),s(i.shape[0]===r.shape[0],(()=>`Mismatch in the number of examples: ${i.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`)),s(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=ti($n(i,"int32"),n),a=ti($n(r,"int32"),n),l=ei(o),u=Qn(l,a);return $n(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ii=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",confusionMatrix:ni});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ri(t,e,n){if(u(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const i=Ge(t,n);if(3!==i.length&&1!==i.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Je(t,e,i,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let oi;function ai(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,i=!1,r=!1,o=!1,a=!1,s=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)i=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)r=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)a=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);s=!0}if(r){const e=2;if(r&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=at("FromPixels",ze.backendName)){const n={pixels:t},i={numChannels:e};return ze.runKernel("FromPixels",n,i)}const[l,u]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let c,h;if(a?c=t.getContext("2d").getImageData(0,0,l,u).data:i||n?c=t.data:(o||r||s)&&(null==oi&&(oi=document.createElement("canvas").getContext("2d")),oi.canvas.width=l,oi.canvas.height=u,oi.drawImage(t,0,0,l,u),c=oi.getImageData(0,0,l,u).data),4===e)h=new Int32Array(c);else{const t=l*u;h=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)h[n*e+t]=c[4*n+t]}return ri(h,[u,l,e],"int32")}function si(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const li=Ke({fromPixels_:ai});var ui=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fromPixelsAsync:async function(t,e=3){let n=null;if(H().getBool("WRAP_TO_IMAGEBITMAP")&&si(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return ai(n,e)},toPixels:async function(t,e){let n=Xe(t,"img","toPixels");if(!(t instanceof fe)){const t=n;n=$n(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[i,r]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const a=await n.data(),s="float32"===n.dtype?255:1,l=new Uint8ClampedArray(r*i*4);for(let t=0;t<i*r;++t){const e=[0,0,0,255];for(let i=0;i<o;i++){const r=a[t*o+i];if("float32"===n.dtype){if(r<0||r>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${r}.`)}else if("int32"===n.dtype&&(r<0||r>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${r}.`);1===o?(e[0]=r*s,e[1]=r*s,e[2]=r*s):e[i]=r*s}const i=4*t;l[i+0]=Math.round(e[0]),l[i+1]=Math.round(e[1]),l[i+2]=Math.round(e[2]),l[i+3]=Math.round(e[3])}if(null!=e){e.width=r,e.height=i;const t=e.getContext("2d"),n=new ImageData(l,r,i);t.putImageData(n,0,0)}return n!==t&&n.dispose(),l},fromPixels:li});function ci(t,e){const n=t.shape.length,i=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[i-1]} vs. ${n}`);if(0===h(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,o=r[r.length-1];let a=1;for(let t=0;t<r.length-1;++t)a*=r[t];const s=t.shape,l=r.slice();l.pop();let u=1;for(let t=o;t<n;++t)u*=s[t],l.push(s[t]);const c=[...F(t.shape).map((t=>t/u)),1].slice(0,o);return[l,a,u,c]}var hi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",prepareAndValidate:ci});function di(t,e,n){const i=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${i}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(o+` update.rank < ${r}. `);if(t.length<i+(n.rank-r))throw new Error(o+` Output shape length < ${i+(n.rank-r)}`);if(n.rank!==r+t.length-i)throw new Error(o+" update.rank != "+(r+t.length-i));for(let t=0;t<r;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-r;++e)if(n.shape[e+r]!==t[e+i])throw new Error(o+` updates.shape[${e+r}] (${n.shape[e+r]}) != shape[${e+r}] (${t[e+r]})`)}function pi(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}di(n,e,t)}function fi(t,e,n){const i=e.shape.length,r=i>1?e.shape[i-1]:1,o=n.length;let a=1;for(let t=r;t<o;++t)a*=n[t];const s=r<1?1:r;return{sliceRank:r,numUpdates:h(e.shape)/s,sliceSize:a,strides:[...F(n.slice(0,r)),1],outputSize:h(n)}}var gi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",validateUpdateShape:di,validateInput:pi,calculateShapes:fi});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(t,e,n){const i=t.shape.length;s(i===e.length,(()=>`Error in slice${i}D: Length of begin ${e} must match the rank of the array (${i}).`)),s(i===n.length,(()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`));for(let r=0;r<i;++r)s(e[r]+n[r]<=t.shape[r],(()=>`Error in slice${i}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`))}function yi(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e}function vi(t,e,n){const i=[];for(let r=0;r<t.length;r++)i[r]=Math.ceil((e[r]-t[r])/n[r]);return i}function xi(t,e,n,i){const r=[...t];for(let t=r.length;t<i.length;t++)r.push(1);for(let t=0;t<n;t++)0===t?r[e]=1:(r.splice(e,0,1),r.pop());return r}function bi(t,e,n){return n<=t?n:n-(e-1)}function wi(t,e){const n=[];for(let i=0;i<t;i++)n.push(e+i);return n}function _i(t,e,n,i,r,o,a,s,l){const u=t.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(e.length&&n>0){const l=e[0],u=n+1;c=ki(a,l,u,i,t),h=Si(s,l,u,r,t),d=xi(o,l,u,t)}else for(let e=0;e<u;e++)c[e]=Ai(a,i,o,t,e,l),h[e]=Ii(s,r,o,t,e,l),d[e]=Ci(o,e,l);return{begin:c,end:h,strides:d}}function ki(t,e,n,i,r){const o=[...r],a=wi(n,e);for(let r=0;r<o.length;r++)if(a.indexOf(r)>-1)o[r]=0;else{const a=bi(e,n,r);let s=i[a];t&1<<a&&(s=0),o[r]=s}return o}function Si(t,e,n,i,o){const a=[...o],s=wi(n,e);for(let r=0;r<a.length;r++)if(s.indexOf(r)>-1)a[r]=Number.MAX_SAFE_INTEGER;else{const o=bi(e,n,r);let s=i[o];t&1<<o&&(s=Number.MAX_SAFE_INTEGER),a[r]=s}for(let t=0;t<a.length;t++){const e=o[t];a[t]<0&&(a[t]+=e),a[t]=r(0,a[t],o[t])}return a}function Ci(t,e,n){let i=t[e];return(n&1<<e||null==i)&&(i=1),i}function Ai(t,e,n,i,o,a){let s=e[o];const l=n[o]||1;(t&1<<o||a&1<<o||null==s)&&(s=l>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=i[o];return s<0&&(s+=u),s=r(0,s,u-1),s}function Ii(t,e,n,i,o,a){let s=e[o];const l=n[o]||1;(t&1<<o||a&1<<o||null==s)&&(s=l>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=i[o];return s<0&&(s+=u),s=l>0?r(0,s,u):r(-1,s,u-1),s}function Mi(t,e,n){let i=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){i=t;break}for(let r=i+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function Di(t,e){let n=t.length>0?t[t.length-1]:1;for(let i=0;i<t.length-1;i++)n+=t[i]*e[i];return n}function Ti(t,e,n){let i;const r=t.shape.length;let o;return i="number"==typeof e?[e,...new Array(r-1).fill(0)]:e.length<r?e.concat(new Array(r-e.length).fill(0)):e.slice(),i.forEach((t=>{s(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(r).fill(-1):"number"==typeof n?[n,...new Array(r-1).fill(-1)]:n.length<r?n.concat(new Array(r-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(s(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-i[n]))),[i,o]}function Ei(t,e,n,i,r,o,a,s,l){let u=e.slice(),c=n.slice(),h=i;null==i&&(h=new Array(u.length));const d=yi(a);if(d.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==a&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==a&&0!==l)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const p=t.length-u.length,f=yi(s),g=t.slice();f.forEach((t=>{u[t]=0,c[t]=1,g.splice(t,0,1)}));const{begin:m,end:y,strides:v}=_i(g,d,p,u,c,h,r,o,a);u=m,c=y,h=v;const x=yi(l);x.forEach((t=>{c[t]=u[t]+1,h[t]=1}));const b=vi(u,c,h),w=b.filter(((t,e)=>-1===x.indexOf(e)));return{nonStrided:h.every((t=>1===t)),$begin:u,$end:c,$strides:h,size:b,newShape:g,outShape:w}}var Ni=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",assertParamsValid:mi,maskToAxes:yi,computeOutShape:vi,stridesWithElidedDims:xi,getNormalizedAxes:_i,startIndicesWithElidedDims:ki,stopIndicesWithElidedDims:Si,stridesForAxis:Ci,startForAxis:Ai,stopForAxis:Ii,isSliceContinous:Mi,computeFlatOffset:Di,parseSliceParams:Ti,sliceInfo:Ei});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oi{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Fi{constructor(){this.classNameMap={}}static getMap(){return null==Fi.instance&&(Fi.instance=new Fi),Fi.instance}static register(t){Fi.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Ri(t){s(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),s("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),s(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Fi.register(t)}var Li=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Serializable:Oi,SerializationMap:Fi,registerClass:Ri});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $i(){return 32===ze.backend.floatPrecision()?.001:.1}function Pi(t,e,n){let i=!0;if((C(t)||C(e))&&(i=!1),C(t)&&C(e)&&(i=!0),i){const n=t.constructor.name,i=e.constructor.name;if(n!==i)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${i}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Ge(t),i=Ge(e);if(!d(n,i))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${i}]`)}const r=C(t)?t:c(t),o=C(e)?e:c(e);if(r.length!==o.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${o.length}.\nActual:   ${r}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=r[t],i=o[t];if(!n(e,i))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${i}.\nActual:   ${r}.\nExpected: ${o}.`)}}function zi(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Bi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=$i()),Pi(t,e,((t,e)=>zi(t,e,n)))},testEpsilon:$i,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return M(t)||M(t[0])||M(e)||M(e[0])?Pi(t,n,((t,e)=>t==e)):Pi(t,e,((t,e)=>zi(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=$i()),!zi(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let i=0;i<t.length;i++)if(t[i]<e||t[i]>n)throw new Error(`Value out of range:${t[i]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)?t(i):e[n]=te(i)}return e}});
/** @license See the LICENSE file. */function Vi(){return ze}function Wi(){return ze.memory()}function ji(t,e){return ze.tidy(t,e)}function Ui(t){Ne(t).forEach((t=>t.dispose()))}function Gi(t){return ze.keep(t)}function Hi(t,e,n=1){return ze.registerBackend(t,e,n)}function qi(){return ze.backend}const Xi=Ke({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Xe(t,"a","add"),i=Xe(e,"b","add");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel("Add",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi=Ke({floorDiv_:function(t,e){let n=Xe(t,"a","floorDiv"),i=Xe(e,"b","floorDiv");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel("FloorDiv",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki=Ke({div_:function(t,e){let n=Xe(t,"a","div"),i=Xe(e,"b","div");if([n,i]=Te(n,i),"int32"===n.dtype&&"int32"===i.dtype)return Yi(n,i);const r={a:n,b:i};return ze.runKernel("RealDiv",r,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zi=Ke({mul_:function(t,e){let n=Xe(t,"a","mul"),i=Xe(e,"b","mul");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel("Multiply",r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ji=Ke({abs_:function(t){const e=Xe(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return ze.runKernel("ComplexAbs",t)}{const t={x:e};return ze.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qi=Ke({acos_:function(t){const e={x:Xe(t,"x","acos")};return ze.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tr=Ke({acosh_:function(t){const e={x:Xe(t,"x","acosh")};return ze.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const er=Ke({addN_:function(t){s(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),s(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Xe(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!d(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const i=e;return ze.runKernel("AddN",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nr=Ke({all_:function(t,e=null,n=!1){const i={x:Xe(t,"x","all","bool")},r={axis:e,keepDims:n};return ze.runKernel("All",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ir=Ke({any_:function(t,e=null,n=!1){const i={x:Xe(t,"x","any","bool")},r={axis:e,keepDims:n};return ze.runKernel("Any",i,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rr=Ke({argMax_:function(t,e=0){const n={x:Xe(t,"x","argMax")},i={axis:e};return ze.runKernel("ArgMax",n,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const or=Ke({argMin_:function(t,e=0){const n={x:Xe(t,"x","argMin")},i={axis:e};return ze.runKernel("ArgMin",n,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ar=Ke({asin_:function(t){const e={x:Xe(t,"x","asin")};return ze.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sr=Ke({asinh_:function(t){const e={x:Xe(t,"x","asinh")};return ze.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lr=Ke({atan_:function(t){const e={x:Xe(t,"x","atan")};return ze.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ur=Ke({atan2_:function(t,e){let n=Xe(t,"a","atan2"),i=Xe(e,"b","atan2");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel("Atan2",r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cr=Ke({atanh_:function(t){const e={x:Xe(t,"x","atanh")};return ze.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hr(t,e,n,i,r="NHWC",o){return fr(t,[...e,t[3]],n,o,i,null,null,kr(r))}function dr(t,e,n,i,r,o,a="channelsLast"){const[s,l]=yr(e);let u;if("channelsLast"===a)u=[s,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);u=[s,l,t[1],t[1]]}return fr(t,u,n,i,r,o,!1,a)}function pr(t,e,n,i,r,o,a="NDHWC"){const[s,l,u]=vr(e);let c,h;if("NDHWC"===a)h="channelsLast",c=[s,l,u,t[4],t[4]];else{if("NCDHW"!==a)throw new Error(`Unknown dataFormat ${a}`);h="channelsFirst",c=[s,l,u,t[1],t[1]]}return gr(t,c,n,i,r,!1,h,o)}function fr(t,e,n,i,r,o,a=!1,s="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if("channelsLast"===s)[l,u,c,h]=t;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[l,h,u,c]=t}const[d,p,,f]=e,[g,m]=yr(n),[y,v]=yr(i),x=xr(d,y),b=xr(p,v),{padInfo:w,outHeight:_,outWidth:k}=function(t,e,n,i,r,o,a,s,l){let u,c,h;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const r=function(t,e,n,i,r){null==i&&(i=mr(t,e,n));const o=t[0],a=t[1],s=br((o-e+2*i)/n+1,r),l=br((a-e+2*i)/n+1,r);return[s,l]}([e,n],o,i,t,s);c=r[0],h=r[1]}else if("same"===t){c=Math.ceil(e/i),h=Math.ceil(n/r);const t=Math.max(0,(c-1)*i+o-e),s=Math.max(0,(h-1)*r+a-n),l=Math.floor(t/2),d=t-l,p=Math.floor(s/2);u={top:l,bottom:d,left:p,right:s-p,type:"SAME"}}else if("valid"===t)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-o+1)/i),h=Math.ceil((n-a+1)/r);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const d="channelsLast"===l?t[1][0]:t[2][0],p="channelsLast"===l?t[1][1]:t[2][1],f="channelsLast"===l?t[2][0]:t[3][0],g="channelsLast"===l?t[2][1]:t[3][1];u={top:d,bottom:p,left:f,right:g,type:0===d&&0===p&&0===f&&0===g?"VALID":"EXPLICIT"},c=br((e-o+d+p)/i+1,s),h=br((n-a+f+g)/r+1,s)}}return{padInfo:u,outHeight:c,outWidth:h}}(r,u,c,g,m,x,b,o,s),S=a?f*h:f;let C;return"channelsFirst"===s?C=[l,S,_,k]:"channelsLast"===s&&(C=[l,_,k,S]),{batchSize:l,dataFormat:s,inHeight:u,inWidth:c,inChannels:h,outHeight:_,outWidth:k,outChannels:S,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:d,filterWidth:p,effectiveFilterHeight:x,effectiveFilterWidth:b,dilationHeight:y,dilationWidth:v,inShape:t,outShape:C,filterShape:e}}function gr(t,e,n,i,r,o=!1,a="channelsLast",s){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[l,u,c,h,d]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,d,u,c,h]=t}const[p,f,g,,m]=e,[y,v,x]=vr(n),[b,w,_]=vr(i),k=xr(p,b),S=xr(f,w),C=xr(g,_),{padInfo:A,outDepth:I,outHeight:M,outWidth:D}=function(t,e,n,i,r,o,a,s,l,u,c){let h,d,p,f;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,i,r,o){null==r&&(r=mr(t,e,i));const a=t[0],s=t[1],l=t[2],u=br((a-e+2*r)/i+1,o),c=br((s-e+2*r)/i+1,o),h=br((l-e+2*r)/i+1,o);return[u,c,h,n]}([e,n,i,1],s,1,r,t,c);d=o[0],p=o[1],f=o[2]}else if("same"===t){d=Math.ceil(e/r),p=Math.ceil(n/o),f=Math.ceil(i/a);const t=(d-1)*r+s-e,c=(p-1)*o+l-n,g=(f-1)*a+u-i,m=Math.floor(t/2),y=t-m,v=Math.floor(c/2),x=c-v,b=Math.floor(g/2);h={top:v,bottom:x,left:b,right:g-b,front:m,back:y,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-s+1)/r),p=Math.ceil((n-l+1)/o),f=Math.ceil((i-u+1)/a)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(r,u,c,h,y,v,x,k,S,C,s),T=o?m*d:m;let E;return"channelsFirst"===a?E=[l,T,I,M,D]:"channelsLast"===a&&(E=[l,I,M,D,T]),{batchSize:l,dataFormat:a,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:I,outHeight:M,outWidth:D,outChannels:T,padInfo:A,strideDepth:y,strideHeight:v,strideWidth:x,filterDepth:p,filterHeight:f,filterWidth:g,effectiveFilterDepth:k,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationDepth:b,dilationHeight:w,dilationWidth:_,inShape:t,outShape:E,filterShape:e}}function mr(t,e,n,i=1){const r=xr(e,i);return Math.floor((t[0]*(n-1)-n+r)/2)}function yr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function vr(t){return"number"==typeof t?[t,t,t]:t}function xr(t,e){return e<=1?t:t+(t-1)*(e-1)}function br(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function wr(t){const[e,n,i]=yr(t);return 1===e&&1===n&&1===i}function _r(t,e){return wr(t)||wr(e)}function kr(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sr=Ke({reshape_:function(t,e){const n={x:Xe(t,"x","reshape","string_or_numeric")},i={shape:e};return ze.runKernel("Reshape",n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cr=Ke({avgPool_:function(t,e,n,i,r){const o=Xe(t,"x","avgPool","float32");s(_r(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let a=o,l=!1;3===o.rank&&(l=!0,a=Sr(o,[1,o.shape[0],o.shape[1],o.shape[2]])),s(4===a.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`)),null!=r&&s(p(i),(()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${r} but got pad ${i}.`));const u={x:a},c={filterSize:e,strides:n,pad:i,dimRoundingMode:r};let h=ze.runKernel("AvgPool",u,c);return h=$n(h,o.dtype),l?Sr(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ar=Ke({avgPool3d_:function(t,e,n,i,r,o="NDHWC"){const a=Xe(t,"x","avgPool3d","float32");let l=a,u=!1;4===a.rank&&(u=!0,l=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),s(5===l.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`)),s("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),null!=r&&s(p(i),(()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${r} but got pad ${i}.`));const c={x:l},h={filterSize:e,strides:n,pad:i,dimRoundingMode:r,dataFormat:o};let d=ze.runKernel("AvgPool3D",c,h);return d=$n(d,l.dtype),u?Sr(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ir=Ke({concat_:function(t,e=0){s(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Ye(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return Pn(n[0]);const i=n,r={axis:e};return ze.runKernel("Concat",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mr=Ke({sigmoid_:function(t){const e={x:Xe(t,"x","sigmoid")};return ze.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dr=Ke({slice_:function(t,e,n){const i=Xe(t,"x","slice","string_or_numeric");if(0===i.rank)throw new Error("Slicing scalar is not possible");const r={x:i},o={begin:e,size:n};return ze.runKernel("Slice",r,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tr=Ke({tanh_:function(t){const e={x:Xe(t,"x","tanh")};return ze.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Er=Ke({basicLSTMCell_:function(t,e,n,i,r,o){const a=Xe(t,"forgetBias","basicLSTMCell"),s=Xe(e,"lstmKernel","basicLSTMCell"),l=Xe(n,"lstmBias","basicLSTMCell"),u=Xe(i,"data","basicLSTMCell"),c=Xe(r,"c","basicLSTMCell"),h=Xe(o,"h","basicLSTMCell"),d=Ir([u,h],1),p=Qn(d,s),f=Xi(p,l),g=f.shape[0],m=f.shape[1]/4,y=[g,m],v=Dr(f,[0,0],y),x=Dr(f,[0,m],y),b=Dr(f,[0,2*m],y),w=Dr(f,[0,3*m],y),_=Xi(Zi(Mr(v),Tr(x)),Zi(c,Mr(Xi(a,b))));return[_,Zi(Tr(_),Mr(w))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nr=Ke({batchToSpaceND_:function(t,e,n){const i=Xe(t,"x","batchToSpaceND"),r=e.reduce(((t,e)=>t*e));s(i.rank>=1+e.length,(()=>`input rank is ${i.rank} but should be > than blockShape.length ${e.length}`)),s(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),s(i.shape[0]%r==0,(()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`));const o={x:i},a={blockShape:e,crops:n};return ze.runKernel("BatchToSpaceND",o,a)}});const Or=Ke({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r,o){null==o&&(o=.001);const a=Xe(t,"x","batchNorm"),l=Xe(e,"mean","batchNorm"),u=Xe(n,"variance","batchNorm");let c,h;null!=r&&(c=Xe(r,"scale","batchNorm")),null!=i&&(h=Xe(i,"offset","batchNorm")),s(l.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),s(null==h||l.rank===h.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),s(null==c||l.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const d={x:function(t){let e;return e=0===t.rank||1===t.rank?Sr(t,[1,1,1,t.size]):2===t.rank?Sr(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Sr(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(a),scale:c,offset:h,mean:l,variance:u},p={varianceEpsilon:o},f=ze.runKernel("FusedBatchNorm",d,p);return Sr(f,a.shape)}});const Fr=Ke({batchNorm2d_:function(t,e,n,i,r,o){const a=Xe(t,"x","batchNorm"),l=Xe(e,"mean","batchNorm"),u=Xe(n,"variance","batchNorm");let c,h;return null!=r&&(c=Xe(r,"scale","batchNorm")),null!=i&&(h=Xe(i,"offset","batchNorm")),s(2===a.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`)),s(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`)),s(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&s(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=h&&s(2===h.rank||1===h.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`)),Or(a,l,u,h,c,o)}});const Rr=Ke({batchNorm3d_:function(t,e,n,i,r,o){const a=Xe(t,"x","batchNorm"),l=Xe(e,"mean","batchNorm"),u=Xe(n,"variance","batchNorm");let c,h;return null!=r&&(c=Xe(r,"scale","batchNorm")),null!=i&&(h=Xe(i,"offset","batchNorm")),s(3===a.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`)),s(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`)),s(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&s(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=h&&s(3===h.rank||1===h.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`)),Or(a,l,u,h,c,o)}});const Lr=Ke({batchNorm4d_:function(t,e,n,i,r,o){const a=Xe(t,"x","batchNorm"),l=Xe(e,"mean","batchNorm"),u=Xe(n,"variance","batchNorm");let c,h;return null!=r&&(c=Xe(r,"scale","batchNorm")),null!=i&&(h=Xe(i,"offset","batchNorm")),s(4===a.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`)),s(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`)),s(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&s(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=h&&s(4===h.rank||1===h.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`)),Or(a,l,u,h,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $r=Ke({bincount_:function(t,e,n){const i=Xe(t,"x","bincount"),r=Xe(e,"weights","bincount");s("int32"===i.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`)),s(n>=0,(()=>`size must be non-negative, but got ${n}.`)),s(r.size===i.size||0===r.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${r.shape}.`));const o={x:i,weights:r},a={size:n};return ze.runKernel("Bincount",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pr=Ke({broadcastTo_:function(t,e){let n=Xe(t,"broadcastTo","x");const i=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=Sr(n,t)}const r=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(r[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${e}].`);if(0===o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0)).length)return Pn(n);const a={x:n},s={reps:o};return ze.runKernel("Tile",a,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zr=Ke({ceil_:function(t){const e={x:Xe(t,"x","ceil")};return ze.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Br=Ke({clipByValue_:function(t,e,n){const i=Xe(t,"x","clipByValue");s(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const r={x:i},o={clipValueMin:e,clipValueMax:n};return ze.runKernel("ClipByValue",r,o)}});const Vr=Ke({concat1d_:function(t){return Ir(t,0)}});const Wr=Ke({concat2d_:function(t,e){return Ir(t,e)}});const jr=Ke({concat3d_:function(t,e){return Ir(t,e)}});const Ur=Ke({concat4d_:function(t,e){return Ir(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gr=Ke({conv2d_:function(t,e,n,i,r="NHWC",o=[1,1],a){const l=Xe(t,"x","conv2d"),u=Xe(e,"filter","conv2d");let c=l,h=!1;3===l.rank&&(h=!0,c=Sr(l,[1,l.shape[0],l.shape[1],l.shape[2]])),s(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),s(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),null!=a&&s(p(i),(()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`));const d="NHWC"===r?c.shape[3]:c.shape[1];s(d===u.shape[2],(()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${u.shape[2]}.`)),s(_r(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const f={x:c,filter:u},g={strides:n,pad:i,dataFormat:r,dilations:o,dimRoundingMode:a},m=ze.runKernel("Conv2D",f,g);return h?Sr(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Hr=Ke({conv1d_:function(t,e,n,i,r="NWC",o=1,a){const l=Xe(t,"x","conv1d"),u=Xe(e,"filter","conv1d");let c=l,h=!1;2===l.rank&&(h=!0,c=Sr(l,[1,l.shape[0],l.shape[1]])),s(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),s(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),null!=a&&s(p(i),(()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`)),s(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),s(_r(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),s("NWC"===r,(()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`));const d=Sr(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=Sr(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=Gr(f,d,[1,n],i,"NHWC",[1,o],a);return Sr(g,h?[g.shape[2],g.shape[3]]:[g.shape[0],g.shape[2],g.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qr=Ke({conv2DBackpropInput_:function(t,e,n,i,r,o="NHWC",a){s(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let l=t,u=e,c=!1;3===e.rank&&(c=!0,u=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2]]),l=[1,t[0],t[1],t[2]]),s(4===l.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`)),s(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),s(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const h="NHWC"===o?l[3]:l[1],d="NHWC"===o?u.shape[3]:u.shape[1];s(h===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`)),s(d===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`)),null!=a&&s(p(r),(()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${a} but got pad ${r}.`));const f={dy:u,filter:n},g={strides:i,pad:r,dataFormat:o,dimRoundingMode:a,inputShape:l},m=ze.runKernel("Conv2DBackpropInput",f,g);return c?Sr(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Xr=Ke({conv2dTranspose_:function(t,e,n,i,r,o){const a=Xe(t,"x","conv2dTranspose"),s=Xe(e,"filter","conv2dTranspose");return qr(n,a,s,i,r,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yr=Ke({conv3d_:function(t,e,n,i,r="NDHWC",o=[1,1,1]){const a=Xe(t,"x","conv3d"),l=Xe(e,"filter","conv3d");let u=a,c=!1;4===a.rank&&(c=!0,u=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),s(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),s(5===l.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`)),s(u.shape[4]===l.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${l.shape[3]}.`)),s(_r(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),s("NDHWC"===r,(()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`));const h={x:u,filter:l},d={strides:n,pad:i,dataFormat:r,dilations:o},p=ze.runKernel("Conv3D",h,d);return c?Sr(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kr=Ke({conv3DBackpropInput_:function(t,e,n,i,r){s(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,a=e,l=!1;4===e.rank&&(l=!0,a=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=a.shape[4];s(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),s(5===a.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`)),s(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),s(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),s(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const h={dy:a,filter:n},d={pad:r,strides:i,inputShape:o},p=ze.runKernel("Conv3DBackpropInputV2",h,d);return l?Sr(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});const Zr=Ke({conv3dTranspose_:function(t,e,n,i,r){const o=Xe(t,"x","conv3dTranspose"),a=Xe(e,"filter","conv3dTranspose");return Kr(n,o,a,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jr=Ke({cos_:function(t){const e={x:Xe(t,"x","cos")};return ze.runKernel(Z,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qr=Ke({cosh_:function(t){const e={x:Xe(t,"x","cosh")};return ze.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const to=Ke({cumsum_:function(t,e=0,n=!1,i=!1){const r={x:Xe(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:i};return ze.runKernel("Cumsum",r,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eo=Ke({denseBincount_:function(t,e,n,i=!1){const r=Xe(t,"x","denseBincount"),o=Xe(e,"weights","denseBincount");s("int32"===r.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`)),s(r.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`)),s(n>=0,(()=>`size must be non-negative, but got ${n}.`)),s(o.size===r.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`));const a={x:r,weights:o},l={size:n,binaryOutput:i};return ze.runKernel("DenseBincount",a,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const no=Ke({depthToSpace_:function(t,e,n="NHWC"){const i=Xe(t,"x","depthToSpace"),r="NHWC"===n?i.shape[1]:i.shape[2],o="NHWC"===n?i.shape[2]:i.shape[3],a="NHWC"===n?i.shape[3]:i.shape[1];s(r*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${r} and ${e}  for depthToSpace with input shape\n    ${i.shape}`)),s(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${i.shape}`)),s(a%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${a} for depthToSpace with input shape ${i.shape}`));const l={x:i},u={blockSize:e,dataFormat:n};return ze.runKernel("DepthToSpace",l,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const io=Ke({depthwiseConv2d_:function(t,e,n,i,r="NHWC",o=[1,1],a){const l=Xe(t,"x","depthwiseConv2d"),u=Xe(e,"filter","depthwiseConv2d");let c=l,h=!1;3===l.rank&&(h=!0,c=Sr(l,[1,l.shape[0],l.shape[1],l.shape[2]])),s(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),s(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),s(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),null!=a&&s(p(i),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`));const d={x:c,filter:u},f={strides:n,pad:i,dataFormat:r,dilations:o,dimRoundingMode:a},g=ze.runKernel("DepthwiseConv2dNative",d,f);return h?Sr(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ro=Ke({diag_:function(t){const e={x:Xe(t,"x","diag")};return ze.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oo=Ke({dilation2d_:function(t,e,n,i,r=[1,1],o="NHWC"){const a=Xe(t,"x","dilation2d"),l=Xe(e,"filter","dilation2d");s(3===a.rank||4===a.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`)),s(3===l.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`)),s("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=a,c=!1;3===a.rank&&(u=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0);const h={x:u,filter:l},d={strides:n,pad:i,dilations:r},p=ze.runKernel("Dilation2D",h,d);return c?Sr(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(t,e){const n=t.length,i=[];for(let r=0;r<n;r++){const o=n-1-r,a=t[o]||1;(e[e.length-1-r]||1)>1&&1===a&&i.unshift(o)}return i}function so(t,e){const n=[];for(let i=0;i<e.length;i++){const r=t[t.length-i-1],o=e.length-i-1,a=e[o];(null==r||1===r&&a>1)&&n.unshift(o)}return n}function lo(t,e){const n=[],i=Math.max(t.length,e.length);for(let r=0;r<i;r++){let i=t[t.length-r-1];null==i&&(i=1);let o=e[e.length-r-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(i)}}return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uo=Ke({equal_:function(t,e){let n=Xe(t,"a","equal","string_or_numeric"),i=Xe(e,"b","equal","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("Equal",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const co=Ke({where_:function(t,e,n){const i=Xe(e,"a","where"),r=Xe(n,"b","where"),o=Xe(t,"condition","where","bool"),a=lo(lo(o.shape,i.shape),r.shape),s={condition:Pr(o,a),t:Pr(i,a),e:Pr(r,a)};return ze.runKernel("Select",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho=Ke({zerosLike_:function(t){const e={x:Xe(t,"x","zerosLike")};return ze.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po=Ke({divNoNan_:function(t,e){let n=Xe(t,"a","div"),i=Xe(e,"b","div");[n,i]=Te(n,i);const r=Ki(n,i),o=ho(r),a=uo(i,o);return co(a,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fo=Ke({dot_:function(t,e){const n=Xe(t,"t1","dot"),i=Xe(e,"t2","dot");s(!(1!==n.rank&&2!==n.rank||1!==i.rank&&2!==i.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${i.rank}.`));const r=1===n.rank?n.size:n.shape[1],o=1===i.rank?i.size:i.shape[0];if(s(r===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`)),1===n.rank&&1===i.rank){const t=Sr(n,[1,-1]),e=Sr(i,[-1,1]),r=Qn(t,e);return Sr(r,[])}if(1===n.rank&&2===i.rank){const t=Sr(n,[1,-1]),e=Sr(i,[i.shape[0],i.shape[1]]),r=Qn(t,e);return Sr(r,[r.size])}if(2===n.rank&&1===i.rank){const t=Sr(i,[-1,1]),e=Qn(n,t);return Sr(e,[e.size])}{const t=Sr(i,[i.shape[0],i.shape[1]]);return Qn(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const go=Ke({einsum_:function(t,...e){const n=e.map(((t,e)=>Xe(t,`tensors${e}`,"einsum"))),i={equation:t};return ze.runKernel("Einsum",n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mo=Ke({elu_:function(t){const e={x:Xe(t,"x","elu")};return ze.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yo=Ke({erf_:function(t){let e=Xe(t,"x","erf");s("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=$n(e,"float32"));const n={x:e};return ze.runKernel(J,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vo=Ke({exp_:function(t){const e={x:Xe(t,"x","exp")};return ze.runKernel(Q,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xo=Ke({expandDims_:function(t,e=0){const n=Xe(t,"x","expandDims","string_or_numeric");s(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const i={input:n},r={dim:e};return ze.runKernel("ExpandDims",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo=Ke({expm1_:function(t){const e={x:Xe(t,"x","expm1")};return ze.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wo=Ke({tile_:function(t,e){const n=Xe(t,"x","tile","string_or_numeric");s(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const i={x:n},r={reps:e};return ze.runKernel("Tile",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _o=Ke({eye_:function(t,e,n,i="float32"){null==e&&(e=t);const r=Ln([t,e],i),o=t<=e?t:e;for(let t=0;t<o;++t)r.set(1,t,t);const a=Sr(r.toTensor(),[t,e]);if(null==n)return a;if(1===n.length)return wo(xo(a,0),[n[0],1,1]);if(2===n.length)return wo(xo(xo(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return wo(xo(xo(xo(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ko(t,e,n){const i={shape:t,value:e,dtype:n};return ze.runKernel("Fill",{},i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const So=Ke({floor_:function(t){const e={x:Xe(t,"x","floor")};return ze.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Co=Ke({gather_:function(t,e,n=0,i=0){const r={x:Xe(t,"x","gather"),indices:Xe(e,"indices","gather","int32")},o={axis:n,batchDims:i};return ze.runKernel("GatherV2",r,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ao=Ke({greater_:function(t,e){let n=Xe(t,"a","greater","string_or_numeric"),i=Xe(e,"b","greater","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("Greater",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Io=Ke({greaterEqual_:function(t,e){let n=Xe(t,"a","greaterEqual","string_or_numeric"),i=Xe(e,"b","greaterEqual","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("GreaterEqual",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mo=Ke({imag_:function(t){const e={input:Xe(t,"input","imag")};return ze.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=Ke({isFinite_:function(t){const e={x:Xe(t,"x","isFinite")};return ze.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const To=Ke({isInf_:function(t){const e={x:Xe(t,"x","isInf")};return ze.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eo=Ke({isNaN_:function(t){const e={x:Xe(t,"x","isNaN")};return ze.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const No=Ke({leakyRelu_:function(t,e=.2){const n={x:Xe(t,"x","leakyRelu")},i={alpha:e};return ze.runKernel("LeakyRelu",n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oo=Ke({less_:function(t,e){let n=Xe(t,"a","less","string_or_numeric"),i=Xe(e,"b","less","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("Less",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fo=Ke({lessEqual_:function(t,e){let n=Xe(t,"a","lessEqual","string_or_numeric"),i=Xe(e,"b","lessEqual","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("LessEqual",r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ro=Ke({localResponseNormalization_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=5,n=1,i=1,r=.5){const o=Xe(t,"x","localResponseNormalization");s(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),s(p(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let a=o,l=!1;3===o.rank&&(l=!0,a=Sr(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:a},c={depthRadius:e,bias:n,alpha:i,beta:r},h=ze.runKernel("LRN",u,c);return l?Sr(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lo=Ke({log_:function(t){const e={x:Xe(t,"x","log")};return ze.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $o=Ke({log1p_:function(t){const e={x:Xe(t,"x","log1p")};return ze.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Po(t,e){s(N(t),(()=>"The f passed in variableGrads(f) must be a function")),s(null==e||Array.isArray(e)&&e.every((t=>t instanceof me)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in ze.registeredVariables)e.push(ze.registeredVariables[t])}const i=n?e.filter((t=>!t.trainable)):null,r=e.length;s((e=e.filter((t=>t.trainable))).length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`));const{value:o,grads:a}=ze.gradients(t,e,null,!0);s(a.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),s(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const l={};return e.forEach(((t,e)=>{null!=a[e]&&(l[t.name]=a[e])})),null!=i&&i.forEach((t=>l[t.name]=null)),{value:o,grads:l}}function zo(t){return ze.customGrad(t)}function Bo(t){if(t.filter((t=>null==t)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vo=Ke({neg_:function(t){const e={x:Xe(t,"x","neg")};return ze.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wo=Ke({softplus_:function(t){const e={x:Xe(t,"x","softplus")};return ze.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jo=Ke({logSigmoid_:function(t){const e=Xe(t,"x","logSigmoid");return zo((t=>({value:Vo(Wo(Vo(t))),gradFunc:e=>Zi(e,Mr(Vo(t)))})))(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uo=Ke({max_:function(t,e=null,n=!1){const i={x:Xe(t,"x","max")},r={reductionIndices:e,keepDims:n};return ze.runKernel("Max",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go=Ke({sub_:function(t,e){let n=Xe(t,"a","sub"),i=Xe(e,"b","sub");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel(nt,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=Ke({sum_:function(t,e=null,n=!1){let i=Xe(t,"x","sum");"bool"===i.dtype&&(i=$n(i,"int32"));const r={x:i},o={axis:e,keepDims:n};return ze.runKernel("Sum",r,o)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qo=Ke({logSoftmax_:function(t,e=-1){const n=Xe(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return zo(((t,n)=>{const i=Uo(t,e,!0),r=Go(t,i),o=Go($n(r,"float32"),Lo(Ho(vo(r),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[i]=n,r=vo(i);return Go(t,Zi(Ho(t,e,!0),r))}}}))(n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Yo(t,e,n){const i=t.length+e.length,r=[];let o=0,a=0;for(let s=0;s<i;s++)-1===n.indexOf(s)?r.push(t[o++]):r.push(e[a++]);return r}function Ko(t,e){const n=[],i=t.length;for(let r=0;r<i;r++)-1===e.indexOf(r)&&n.push(t[r]);return[n,e.map((e=>t[e]))]}function Zo(t,e){return Yo(t,e.map((t=>1)),e)}function Jo(t,e,n){s(Xo(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Qo(t,e){if(Xo(t,e))return null;const n=[];for(let i=0;i<e;++i)-1===t.indexOf(i)&&n.push(i);return t.forEach((t=>n.push(t))),n}function ta(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function ea(t,e){const n=[];for(let i=e-t;i<e;++i)n.push(i);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const na=Ke({logSumExp_:function(t,e=null,n=!1){const i=Xe(t,"x","logSumExp"),r=v(e,i.shape),o=Uo(i,r,!0),a=Go(i,o),s=vo(a),l=Ho(s,r),u=Lo(l),c=Xi(Sr(o,u.shape),u);if(n){const t=Zo(c.shape,r);return Sr(c,t)}return c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=Ke({logicalAnd_:function(t,e){const n=Xe(t,"a","logicalAnd","bool"),i=Xe(e,"b","logicalAnd","bool");lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("LogicalAnd",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ra=Ke({logicalNot_:function(t){const e={x:Xe(t,"x","logicalNot","bool")};return ze.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oa=Ke({logicalOr_:function(t,e){const n=Xe(t,"a","logicalOr","bool"),i=Xe(e,"b","logicalOr","bool");lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("LogicalOr",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=Ke({logicalXor_:function(t,e){const n=Xe(t,"a","logicalXor","bool"),i=Xe(e,"b","logicalXor","bool");return lo(n.shape,i.shape),ia(oa(t,e),ra(ia(t,e)))}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sa=Ke({maxPool_:function(t,e,n,i,r){const o=Xe(t,"x","maxPool");let a=o,l=!1;3===o.rank&&(l=!0,a=Sr(o,[1,o.shape[0],o.shape[1],o.shape[2]])),s(4===a.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`)),s(_r(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),null!=r&&s(p(i),(()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${r} but got pad ${i}.`));const u={x:a},c={filterSize:e,strides:n,pad:i,dimRoundingMode:r},h=ze.runKernel("MaxPool",u,c);return l?Sr(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const la=Ke({maxPool3d_:function(t,e=[1,1,1],n,i,r,o="NDHWC"){const a=Xe(t,"x","maxPool3d");let l=a,u=!1;4===a.rank&&(u=!0,l=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),s(5===l.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`)),s("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),null!=r&&s(p(i),(()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${r} but got pad ${i}.`));const c={x:l},h={filterSize:e,strides:n,pad:i,dimRoundingMode:r,dataFormat:o},d=ze.runKernel("MaxPool3D",c,h);return u?Sr(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ua=Ke({maxPoolWithArgmax_:function(t,e,n,i,r=!1){const o={x:Xe(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:i,includeBatchInIndex:r},s=ze.runKernel("MaxPoolWithArgmax",o,a);return{result:s[0],indexes:s[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ca=Ke({maximum_:function(t,e){let n=Xe(t,"a","maximum"),i=Xe(e,"b","maximum");[n,i]=Te(n,i),"bool"===n.dtype&&(n=$n(n,"int32"),i=$n(i,"int32")),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("Maximum",r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ha=Ke({mean_:function(t,e=null,n=!1){const i={x:Xe(t,"x","mean")},r={axis:e,keepDims:n};return ze.runKernel("Mean",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function da(t,e="float32"){if("complex64"===e){const e=da(t,"float32"),n=da(t,"float32");return Ze(e,n)}const n=P(h(t),e);return ze.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(t,e="float32"){if("complex64"===e){const e=pa(t,"float32"),n=da(t,"float32");return Ze(e,n)}const n=$(h(t),e);return ze.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fa=Ke({min_:
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const i={x:Xe(t,"x","min")},r={axis:e,keepDims:n};return ze.runKernel("Min",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ga=Ke({minimum_:function(t,e){let n=Xe(t,"a","minimum"),i=Xe(e,"b","minimum");[n,i]=Te(n,i),"bool"===n.dtype&&(n=$n(n,"int32"),i=$n(i,"int32")),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("Minimum",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ma=Ke({mirrorPad_:function(t,e,n){s("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const i=Xe(t,"x","mirrorPad");if(0===i.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");s(e.length===i.rank,(()=>`Padding doesn't match input. Must be ${i.rank}. Got ${e.length}.`));const r="reflect"===n?1:0;for(let t=0;t<i.rank;t++)s(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),s(e[t][0]>=0&&e[t][0]<=i.shape[t]-r&&e[t][1]>=0&&e[t][1]<=i.shape[t]-r,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${i.shape[t]-r} or less than 0 for input of shape ${i.shape}`));const o={paddings:e,mode:n},a={x:i};return ze.runKernel("MirrorPad",a,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ya=Ke({mod_:function(t,e){let n=Xe(t,"a","mod"),i=Xe(e,"b","mod");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel(tt,r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const va=Ke({square_:function(t){const e=Xe(t,"x","square");return ze.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xa=Ke({moments_:function(t,e=null,n=!1){const i=v(e,(t=Xe(t,"x","moments")).shape),r=ha(t,i,n);let o=r.shape;n||(o=Zo(r.shape,i));const a=va(Go($n(t,"float32"),Sr(r,o)));return{mean:r,variance:ha(a,i,n)}}});const ba=Ke({multiRNNCell_:function(t,e,n,i){const r=Xe(e,"data","multiRNNCell"),o=Ye(n,"c","multiRNNCell"),a=Ye(i,"h","multiRNNCell");let s=r;const l=[];for(let e=0;e<t.length;e++){const n=t[e](s,o[e],a[e]);l.push(n[0]),l.push(n[1]),s=n[1]}const u=[],c=[];for(let t=0;t<l.length;t+=2)u.push(l[t]),c.push(l[t+1]);return[u,c]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wa=Ke({multinomial_:function(t,e,n,i=!1){const r=Xe(t,"logits","multinomial"),o=r.size,a=r.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(a>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${a}`);n=n||Math.random();const s={logits:1===a?Sr(r,[1,-1]):r},l={numSamples:e,seed:n,normalized:i},u=ze.runKernel("Multinomial",s,l);return 1===a?Sr(u,[u.size]):u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _a=Ke({notEqual_:function(t,e){let n=Xe(t,"a","notEqual","string_or_numeric"),i=Xe(e,"b","notEqual","string_or_numeric");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("NotEqual",r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ka=Ke({onesLike_:function(t){const e={x:Xe(t,"x","onesLike")};return ze.runKernel("OnesLike",e)}});const Sa=Ke({outerProduct_:function(t,e){const n=Xe(t,"v1","outerProduct"),i=Xe(e,"v2","outerProduct");s(1===n.rank&&1===i.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${i.rank}.`));const r=Sr(n,[-1,1]),o=Sr(i,[1,-1]);return Qn(r,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ca=Ke({pad_:function(t,e,n=0){const i=Xe(t,"x","pad");if(0===i.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},o={x:i};return ze.runKernel("PadV2",o,r)}});const Aa=Ke({pad1d_:function(t,e,n=0){return s(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),Ca(t,[e],n)}});const Ia=Ke({pad2d_:function(t,e,n=0){return s(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ca(t,e,n)}});const Ma=Ke({pad3d_:function(t,e,n=0){return s(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ca(t,e,n)}});const Da=Ke({pad4d_:function(t,e,n=0){return s(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ca(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ta=Ke({spaceToBatchND_:function(t,e,n){const i=Xe(t,"x","spaceToBatchND");s(i.rank>=1+e.length,(()=>`input rank ${i.rank} should be > than [blockShape] ${e.length}`)),s(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),s(i.shape.reduce(((t,i,r)=>r>0&&r<=e.length?t&&(i+n[r-1][0]+n[r-1][1])%e[r-1]==0:t),!0),(()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const r={x:i},o={blockShape:e,paddings:n};return ze.runKernel("SpaceToBatchND",r,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ea=Ke({pool_:function(t,e,n,i,r,o){null==r&&(r=[1,1]),null==o&&(o=1),0===i&&(i="valid");const a=Xe(t,"x","maxPool");let l=a,u=!1;3===a.rank&&(u=!0,l=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s(_r(o,r),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`));const c=dr(l.shape,e,o,r,i),h=[c.dilationHeight,c.dilationWidth];let d;d="same"===i?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))).map((t=>t-1)),i=n.map((t=>Math.floor(t/2))),r=n.map(((t,e)=>t-i[e]));return n.map(((t,e)=>[i[e],r[e]]))}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];const p=1===h[0]&&1===h[1],[f,g]=function(t,e,n){const i=n.map((t=>t[0])),r=n.map((t=>t[1])),o=t.concat(i,r),a=e.map(((t,e)=>(t-o[e]%t)%t)),s=r.map(((t,e)=>t+a[e])),l=e.map(((t,e)=>[i[e],s[e]])),u=e.map(((t,e)=>[0,a[e]]));return[l,u]}([c.inHeight,c.inWidth],h,d),m=p?i:"valid",y=p?l:Ta(l,h,f),v=("avg"===n?()=>Cr(y,e,o,m):()=>sa(y,e,o,m))(),x=p?v:Nr(v,h,g);return u?Sr(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Na=Ke({pow_:function(t,e){let n=Xe(t,"base","pow"),i=Xe(e,"exp","pow");[n,i]=Te(n,i);const r={a:n,b:i};return ze.runKernel("Pow",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oa=Ke({prelu_:function(t,e){const n={x:Xe(t,"x","prelu"),alpha:Xe(e,"alpha","prelu")};return ze.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fa=Ke({prod_:function(t,e=null,n=!1){let i=Xe(t,"x","prod");"bool"===i.dtype&&(i=$n(i,"int32"));const r={x:i},o={axis:e,keepDims:n};return ze.runKernel("Prod",r,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ra=Ke({rand_:function(t,e,n){const i=h(t);let r=null;if(null==n||"float32"===n)r=new Float32Array(i);else if("int32"===n)r=new Int32Array(i);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);r=new Uint8Array(i)}for(let t=0;t<i;t++)r[t]=e();return ze.makeTensor(r,t,n)}});var La="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function $a(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}function Pa(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}var za=$a((function(t){!function(t,e,n){function i(t){var e,n=this,i=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(t),n.s0<0&&(n.s0+=1),n.s1-=i(t),n.s1<0&&(n.s1+=1),n.s2-=i(t),n.s2<0&&(n.s2+=1),i=null}function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new i(t),o=e&&e.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.alea=o}(0,t)})),Ba=$a((function(t){!function(t,e,n){function i(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new i(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.xor128=o}(0,t)})),Va=$a((function(t){!function(t,e,n){function i(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new i(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)})),Wa=$a((function(t){!function(t,e,n){function i(t){var e=this;e.next=function(){var t,n,i=e.x,r=e.i;return t=i[r],n=(t^=t>>>7)^t<<24,n^=(t=i[r+1&7])^t>>>10,n^=(t=i[r+3&7])^t>>>3,n^=(t=i[r+4&7])^t<<7,t=i[r+7&7],n^=(t^=t<<13)^t<<9,i[r]=n,e.i=r+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n&&(i[7]=-1),t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new i(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&(o.x&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)})),ja=$a((function(t){!function(t,e,n){function i(t){var e=this;e.next=function(){var t,n,i=e.w,r=e.X,o=e.i;return e.w=i=i+1640531527|0,n=r[o+34&127],t=r[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=r[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,r,o,a,s=[],l=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,l=Math.max(l,e.length)),r=0,o=-32;o<l;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(a=a+1640531527|0,r=0==(n=s[127&o]^=i+a)?r+1:0);for(r>=128&&(s[127&(e&&e.length||0)]=-1),r=127,o=512;o>0;--o)i=s[r+34&127],n=s[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[r]=i^n;t.w=a,t.X=s,t.i=r}(e,t)}function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new i(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&(o.X&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)})),Ua=$a((function(t){!function(t,e,n){function i(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,r=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new i(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}e&&e.exports?e.exports=o:this.tychei=o}(0,t)})),Ga=Pa(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{}})),Ha=$a((function(t){!function(e,n){var i,r=this,o=256,a=n.pow(o,6),s=n.pow(2,52),l=2*s,u=255;function c(t,u,c){var m=[],y=f(p((u=1==u?{entropy:!0}:u||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(r.crypto||r.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=r.navigator,a=n&&n.plugins;return[+new Date,r,a,r.screen,g(e)]}}():t,3),m),v=new h(m),x=function(){for(var t=v.g(6),e=a,n=0;t<s;)t=(t+n)*o,e*=o,n=v.g(1);for(;t>=l;)t/=2,e/=2,n>>>=1;return(t+n)/e};return x.int32=function(){return 0|v.g(4)},x.quick=function(){return v.g(4)/4294967296},x.double=x,f(g(v.S),e),(u.pass||c||function(t,e,i,r){return r&&(r.S&&d(r,v),t.state=function(){return d(v,{})}),i?(n.random=t,e):t})(x,y,"global"in u?u.global:this==n,u.state)}function h(t){var e,n=t.length,i=this,r=0,a=i.i=i.j=0,s=i.S=[];for(n||(t=[n++]);r<o;)s[r]=r++;for(r=0;r<o;r++)s[r]=s[a=u&a+t[r%n]+(e=s[r])],s[a]=e;(i.g=function(t){for(var e,n=0,r=i.i,a=i.j,s=i.S;t--;)e=s[r=u&r+1],n=n*o+s[u&(s[r]=s[a=u&a+e])+(s[a]=e)];return i.i=r,i.j=a,n})(o)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,i=[],r=typeof t;if(e&&"object"==r)for(n in t)try{i.push(p(t[n],e-1))}catch(t){}return i.length?i:"string"==r?t:t+"\0"}function f(t,e){for(var n,i=t+"",r=0;r<i.length;)e[u&r]=u&(n^=19*e[u&r])+i.charCodeAt(r++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=c,f(n.random(),e),t.exports){t.exports=c;try{i=Ga}catch(t){}}}([],Math)}));Ha.alea=za,Ha.xor128=Ba,Ha.xorwow=Va,Ha.xorshift7=Wa,Ha.xor4096=ja,Ha.tychei=Ua;var qa=Ha;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xa{constructor(t,e,n,i,r){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=r||Math.random();this.random=qa.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let i,r,o;do{i=2*this.random()-1,r=2*this.random()-1,o=i*i+r*r}while(o>=1||0===o);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*a,e=this.mean+this.stdDev*r*a,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Ya{constructor(t,e,n,i){this.alpha=t,this.beta=1/e,this.dtype=n;const r=i||Math.random();this.randu=qa.alea(r.toString()),this.randn=new Xa(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,i,r,o;for(;;){do{i=this.randn.nextValue(),o=1+this.c*i}while(o<=0);if(o*=o*o,t=i*i,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),r=this.randu(),r<e||Math.log(r)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class Ka{constructor(t=0,e=1,n,i){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=qa.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Za=Ke({randomGamma_:function(t,e,n=1,i="float32",r){if(null==n&&(n=1),null==i&&(i="float32"),"float32"!==i&&"int32"!==i)throw new Error(`Unsupported data type ${i}`);const o=new Ya(e,n,i,r),a=Ln(t,i);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ja=Ke({randomNormal_:function(t,e=0,n=1,i,r){if(null!=i&&"bool"===i)throw new Error(`Unsupported data type ${i}`);const o=new Xa(e,n,i,!1,r),a=Ln(t,i);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qa=Ke({randomUniform_:function(t,e=0,n=1,i="float32",r){const o=Ln(t,i),a=new Ka(e,n,null,r);for(let t=0;t<o.values.length;t++)o.values[t]=a.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ts(t,e,n=1,i="float32"){if(0===n)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:i};return ze.runKernel("Range",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const es=Ke({real_:function(t){const e={input:Xe(t,"input","real")};return ze.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ns=Ke({reciprocal_:function(t){const e={x:Xe(t,"x","reciprocal")};return ze.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const is=Ke({relu_:function(t){const e={x:Xe(t,"x","relu")};return ze.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rs=Ke({relu6_:function(t){const e={x:Xe(t,"x","relu6")};return ze.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const os=Ke({reverse_:function(t,e){const n={x:Xe(t,"x","reverse")},i={dims:e};return ze.runKernel("Reverse",n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const as=Ke({reverse1d_:function(t){const e=Xe(t,"x","reverse");return s(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),os(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ss=Ke({reverse2d_:function(t,e){const n=Xe(t,"x","reverse");return s(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),os(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ls=Ke({reverse3d_:function(t,e){const n=Xe(t,"x","reverse");return s(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),os(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const us=Ke({reverse4d_:function(t,e){const n=Xe(t,"x","reverse");return s(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),os(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cs=Ke({round_:function(t){const e={x:Xe(t,"x","round")};return ze.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hs=Ke({rsqrt_:function(t){const e={x:Xe(t,"x","rsqrt")};return ze.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(t,e){if((C(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&C(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Je(t,[],[],e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=Ke({selu_:function(t){const e={x:Xe(t,"x","selu")};return ze.runKernel("Selu",e)}});const fs=Ke({separableConv2d_:function(t,e,n,i,r,o=[1,1],a="NHWC"){const l=Xe(t,"x","separableConv2d"),u=Xe(e,"depthwiseFilter","separableConv2d"),c=Xe(n,"pointwiseFilter","separableConv2d");let h=l,d=!1;if(3===l.rank&&(d=!0,h=Sr(l,[1,l.shape[0],l.shape[1],l.shape[2]])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");s(4===h.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`)),s(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),s(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),s(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),s(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const p=u.shape[2],f=u.shape[3];s(c.shape[2]===p*f,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`));const g=io(h,u,i,r,a,o),m=Gr(g,c,1,"valid",a);return d?Sr(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gs=async function(t,e){const n=Xe(t,"x","setdiff1d"),i=Xe(e,"y","setdiff1d");s(n.dtype===i.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${i.dtype}).`)),s(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),s(1===i.rank,(()=>`y should be 1D tensor, but got y (${i.shape}).`));const r=await n.data(),o=await i.data(),a=new Set(o);let l=0;for(let t=0;t<r.length;t++)a.has(r[t])||l++;const u=new he([l],n.dtype),c=new he([l],"int32");for(let t=0,e=0;t<r.length;t++)a.has(r[t])||(u.values[e]=r[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ms=Ke({sign_:function(t){const e={x:Xe(t,"x","sign")};return ze.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ys=Ke({sin_:function(t){const e={x:Xe(t,"x","sin")};return ze.runKernel(et,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vs=Ke({sinh_:function(t){const e={x:Xe(t,"x","sinh")};return ze.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xs=Ke({slice1d_:function(t,e,n){const i=Xe(t,"x","slice1d");return s(1===i.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`)),Dr(i,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bs=Ke({slice2d_:function(t,e,n){const i=Xe(t,"x","slice2d");return s(2===i.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`)),Dr(i,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ws=Ke({slice3d_:function(t,e,n){const i=Xe(t,"x","slice3d");return s(3===i.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`)),Dr(i,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _s=Ke({slice4d_:function(t,e,n){const i=Xe(t,"x","slice4d");return s(4===i.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`)),Dr(i,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ks=Ke({softmax_:function(t,e=-1){const n=Xe(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const i={logits:n},r={dim:e};return ze.runKernel("Softmax",i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ss=Ke({fft_:function(t){s("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return ze.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cs=Ke({ifft_:function(t){s("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return ze.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const As=Ke({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let i;if(e<=2){const r=Sr(t,[n,e]);i=Cs(r)}else{const r=[n,2*(e-1)],o=Sr(es(t),[n,e]),a=Sr(Mo(t),[n,e]),s=os(Dr(o,[0,1],[n,e-2]),1),l=Zi(os(Dr(a,[0,1],[n,e-2]),1),ds(-1)),u=Ir([o,s],1),c=Ir([a,l],1),h=Sr(Ze(u,c),[r[0],r[1]]);i=Cs(h)}if(i=es(i),3===t.rank&&0!==t.shape[0]){const e=i,n=t.shape[0];i=Sr(i,[n,i.shape[0]/n,i.shape[1]]),e.dispose()}return i}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Is=Ke({split_:function(t,e,n=0){const i={x:Xe(t,"x","split")},r={numOrSizeSplits:e,axis:n};return ze.runKernel("SplitV",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ms=Ke({rfft_:function(t,e){s("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const i=t.size/n;let r;if(null!=e&&e<n){const i=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,r=Dr(t,i,o),n=e}else if(null!=e&&e>n){const i=t.shape.map((t=>t));i[t.shape.length-1]=e-n,r=Ir([t,da(i)],t.shape.length-1),n=e}else r=t;const o=ho(r),a=Sr(Ze(r,o),[i,n]),l=Ss(a),u=Math.floor(n/2)+1,c=es(l),h=Mo(l),d=Is(c,[u,n-u],c.shape.length-1),p=Is(h,[u,n-u],h.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=u,Sr(Ze(d[0],p[0]),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=Ke({sqrt_:function(t){const e={x:Xe(t,"x","sqrt")};return ze.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ts=Ke({squaredDifference_:function(t,e){let n=Xe(t,"a","squaredDifference"),i=Xe(e,"b","squaredDifference");[n,i]=Te(n,i),lo(n.shape,i.shape);const r={a:n,b:i};return ze.runKernel("SquaredDifference",r,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Es=Ke({squeeze_:function(t,e){const n=Xe(t,"x","squeeze");return Sr(n,x(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ns=Ke({stack_:function(t,e=0){const n=Ye(t,"tensors","stack","string_or_numeric");s(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&s(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const i=n,r={axis:e};return ze.runKernel("Pack",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Os=Ke({step_:function(t,e=0){const n={x:Xe(t,"x","step")},i={alpha:e};return ze.runKernel("Step",n,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fs=Ke({stridedSlice_:function(t,e,n,i,r=0,o=0,a=0,s=0,l=0){const u={x:Xe(t,"x","stridedSlice","string_or_numeric")},c={begin:e,end:n,strides:i,beginMask:r,endMask:o,ellipsisMask:a,newAxisMask:s,shrinkAxisMask:l};return ze.runKernel("StridedSlice",u,c)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rs=Ke({tan_:function(t){const e={x:Xe(t,"x","tan")};return ze.runKernel(it,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ls(t,e){u(t);const n=Ge(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Je(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(t,e,n){if(u(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const i=Ge(t,n);if(2!==i.length&&1!==i.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Je(t,e,i,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ps=Ke({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const i=Xe(t,"x","topk");if(0===i.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const r=i.shape[i.shape.length-1];if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:i},a={k:e,sorted:n},[s,l]=ze.runKernel("TopK",o,a);return{values:s,indices:l}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zs=Ke({truncatedNormal_:function(t,e=0,n=1,i,r){if(null!=i&&"bool"===i)throw new Error("Unsupported data type $ { dtype }");const o=new Xa(e,n,i,!0,r),a=Ln(t,i);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bs=Ke({unique_:function(t,e=0){const n=Xe(t,"x","unique","string_or_numeric");s(n.rank>0,(()=>"The input tensor must be at least 1D"));const i={x:n},r={axis:e},[o,a]=ze.runKernel("Unique",i,r);return{values:o,indices:a}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vs=Ke({unsortedSegmentSum_:function(t,e,n){const i=Xe(t,"x","unsortedSegmentSum"),r=Xe(e,"segmentIds","unsortedSegmentSum","int32");s(p(n),(()=>"numSegments must be of dtype int"));const o={x:i,segmentIds:r},a={numSegments:n};return ze.runKernel("UnsortedSegmentSum",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ws=Ke({unstack_:function(t,e=0){const n=Xe(t,"x","unstack","string_or_numeric");s(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const i={value:n},r={axis:e};return ze.runKernel("Unpack",i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(t,e=!0,n,i){return ze.makeVariable(t,e,n,i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Us(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const i=Ln(t,"int32"),r=Ln([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=i.indexToLoc(n[e]),a=e*t.length;r.values.set(o,a)}return r.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gs=async function(t){const e=Xe(t,"condition","whereAsync","bool"),n=await e.data(),i=Us(e.shape,n);return t!==e&&e.dispose(),i};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hs=async function(t,e,n){const i=Xe(t,"tensor","boolMask"),r=Xe(e,"mask","boolMask","bool"),o=null==n?0:n,a=r.rank,u=i.shape;s(a>0,(()=>"mask cannot be scalar")),l(u.slice(o,o+a),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let c=1;for(let t=o;t<o+a;t++)c*=u[t];const h=u.slice(0,o).concat([c],u.slice(o+a)),d=Sr(i,h),p=Sr(r,[-1]),f=await Gs(p),g=Es(f,[1]),m=Co(d,g,o);return t!==i&&i.dispose(),e!==r&&r.dispose(),g.dispose(),d.dispose(),p.dispose(),f.dispose(),m};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qs(t,e,n=null){if(0===t.rank)return Ji(t);if(1!==t.rank&&null===n)return qs(Sr(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Ho(Ji(t),n);if(e===1/0)return Uo(Ji(t),n);if(e===-1/0)return fa(Ji(t),n);if("euclidean"===e||2===e)return Ds(Ho(Na(Ji(t),ds(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Uo(Ho(Ji(t),n[0]),n[1]-1);if(e===1/0)return Uo(Ho(Ji(t),n[1]),n[0]);if(e===-1/0)return fa(Ho(Ji(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Ds(Ho(va(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Xs=Ke({norm_:function(t,e="euclidean",n=null,i=!1){const r=qs(t=Xe(t,"x","norm"),e,n);let o=r.shape;if(i){const e=v(n,t.shape);o=Zo(r.shape,e)}return Sr(r,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ys=Ke({movingAverage_:function(t,e,n,i,r=!0){const o=Xe(t,"v","movingAverage"),a=Xe(e,"x","movingAverage"),l=Xe(n,"decay","movingAverage");Ee(o,a),s(d(o.shape,a.shape),(()=>"Shape mismatch in v and x"));const u=ds(1),c=Go(u,l);let h=Zi(Go(a,o),c);if(r){s(null!=i,(()=>"When using zeroDebias: true, step is required."));const t=Xe(i,"step","movingAverage");h=Ki(h,Go(u,Na(l,t)))}return Xi(o,h)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ks=Ke({scatterND_:function(t,e,n){const i=Xe(t,"indices","scatterND","int32"),r=Xe(e,"updates","scatterND");pi(r,i,n);const o={indices:i,updates:r},a={shape:n};return ze.runKernel("ScatterNd",o,a)}});const Zs=Ke({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i=0){const r=Xe(t,"sparseIndices","sparseToDense","int32"),o=Xe(e,"sparseValues","sparseToDense"),a=Xe(i,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,i){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const a=e.size;if(0!==e.rank&&(1!==e.rank||a!==r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==i.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(r,o,n,a);const s={sparseIndices:r,sparseValues:o,defaultValue:a},l={outputShape:n};return ze.runKernel("SparseToDense",s,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Js=Ke({gatherND_:function(t,e){const n=Xe(e,"indices","gatherND","int32"),i={params:Xe(t,"x","gatherND","string_or_numeric"),indices:n};return ze.runKernel("GatherNd",i)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qs=Ke({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i){const r=Xe(t,"x","dropout");if(s("float32"===r.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`)),s(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof fe?r.clone():r;const o=function(t,e){if(null==e)return t.shape.slice();if(d(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let i=0;i<t.shape.length;i++)null==e[i]&&null!=t.shape[i]?n.push(t.shape[i]):n.push(e[i]);return n}return e}(r,n),a=1-e,l=Ki(So(Xi(Qa(o,0,1,"float32",i),a)),a);return Zi(r,l)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tl(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function el(t,e,n){const i=1-t%2,r=new Float32Array(t);for(let o=0;o<t;++o){const a=2*Math.PI*o/(t+i-1);r[o]=e-n*Math.cos(a)}return Ls(r,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nl=async function(t,e,n=1){const i=Xe(t,"predictions","inTopK"),r=Xe(e,"targets","inTopK");s(i.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${i.rank}`)),s(i.rank-1===r.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${i.rank} and targets rank ${r.rank}`)),l(i.shape.slice(0,i.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=i.shape[i.shape.length-1];s(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const a=await i.data(),u=await r.data(),[c,h]=[a.length/o,o],d=b("bool",c);for(let t=0;t<c;t++){const e=t*h,i=a.subarray(e,e+h),r=[];for(let t=0;t<i.length;t++)r.push({value:i[t],index:t});r.sort(((t,e)=>e.value-t.value)),d[t]=0;for(let e=0;e<n;e++)if(r[e].index===u[t]){d[t]=1;break}}return t!==i&&i.dispose(),e!==r&&r.dispose(),Qe(d,r.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const il=Ke({conv2DBackpropFilter_:function(t,e,n,i,r,o="NHWC",a){let l=t;3===t.rank&&(l=Sr(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2]])),s(4===l.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`)),s(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),s(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?l.shape[3]:l.shape[1],h="NHWC"===o?u.shape[3]:u.shape[1];s(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),s(h===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`)),null!=a&&s(p(r),(()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${a} but got pad ${r}.`));const d={x:l,dy:u},f={strides:i,pad:r,dataFormat:o,dimRoundingMode:a,filterShape:n};return ze.runKernel("Conv2DBackpropFilter",d,f)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rl(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return Zi(t,Os(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function ol(t,e){let n=e;const i=so(t.shape,e.shape);return i.length>0&&(n=Ho(n,i)),Sr(n,t.shape)}function al(t,e,n,i){if("linear"===e)return t;if("relu"===e)return is(t);if("elu"===e)return mo(t);if("relu6"===e)return rs(t);if("prelu"===e)return Oa(t,n);if("leakyrelu"===e)return No(t,i);if("sigmoid"===e)return Mr(t);throw new Error(`Unknown fused activation ${e}.`)}const sl=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ll=Ke({fusedConv2d_:function({x:t,filter:e,strides:n,pad:i,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:l,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(u=u||"linear",!1===sl(ze.state.gradientDepth,u)){let s=Gr(t,e,n,i,r,o,a);return null!=l&&(s=Xi(s,l)),al(s,u,c,h)}const d=Xe(t,"x","conv2d"),f=Xe(e,"filter","conv2d");let g=d,m=!1;3===d.rank&&(m=!0,g=Sr(d,[1,d.shape[0],d.shape[1],d.shape[2]])),s(4===g.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`)),s(4===f.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`)),null!=a&&s(p(i),(()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`)),s(g.shape[3]===f.shape[2],(()=>`Error in conv2d: depth of input (${g.shape[3]}) must match input depth for filter ${f.shape[2]}.`)),s(_r(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),s("NHWC"===r,(()=>`Error in conv2d: got dataFormat of ${r} but only NHWC is currently supported.`));const y=fr(g.shape,f.shape,n,o,i,a);let v,x;null!=l&&(v=Xe(l,"bias","fused conv2d"),[v]=Te(v,d),lo(y.outShape,v.shape)),null!=c&&(x=Xe(c,"prelu weights","fused conv2d"));const b=(t,e)=>{const[r,a,l,c]=e,h=rl(t,l,u);s(wr(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const d=[qr(a.shape,h,r,n,i),il(a,h,r.shape,n,i)];if(null!=c){const t=ol(c,h);d.push(t)}return d},w={x:g,filter:f,bias:v,preluActivationWeights:x},_={strides:n,pad:i,dataFormat:r,dilations:o,dimRoundingMode:a,activation:u,leakyreluAlpha:h};if(null==l){return zo(((t,e,n)=>{let i=ze.runKernel("FusedConv2D",w,_);return n([e,t,i]),m&&(i=Sr(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}))(g,f)}return zo(((t,e,n,i)=>{let r=ze.runKernel("FusedConv2D",w,_);return i([e,t,r,n]),m&&(r=Sr(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(g,f,v)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ul=Ke({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,i,r,o=[1,1],a){let s=t;3===t.rank&&(s=Sr(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:s,dy:l},c={strides:i,pad:r,dimRoundingMode:a,dilations:o,filterShape:n};return ze.runKernel("DepthwiseConv2dNativeBackpropFilter",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=Ke({depthwiseConv2dNativeBackpropInput_:function(t,e,n,i,r,o=[1,1],a){let s=e,l=!1;3===e.rank&&(l=!0,s=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:s,filter:n},c={strides:i,pad:r,dimRoundingMode:a,dilations:o,inputShape:t},h=ze.runKernel("DepthwiseConv2dNativeBackpropInput",u,c);return l?Sr(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hl=Ke({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:i,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:l,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(!1===sl(ze.state.gradientDepth,u)){let s=io(t,e,n,i,r,o,a);return null!=l&&(s=Xi(s,l)),al(s,u,c,h)}const d=Xe(t,"x","depthwiseConv2d"),f=Xe(e,"filter","depthwiseConv2d");let g=d,m=!1;3===d.rank&&(m=!0,g=Sr(d,[1,d.shape[0],d.shape[1],d.shape[2]])),s(4===g.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`)),s(4===f.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`)),s(g.shape[3]===f.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`)),null==o&&(o=[1,1]),s(_r(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),null!=a&&s(p(i),(()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${a} but got pad ${i}.`));const y=fr(g.shape,f.shape,n,o,i,a,!0);let v,x;null!=l&&(v=Xe(l,"bias","fused conv2d"),[v]=Te(v,d),lo(y.outShape,v.shape)),null!=c&&(x=Xe(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{s(wr(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[r,l,c,h]=e,d=rl(t,c,u),p=cl(l.shape,d,r,n,i,o,a),f=ul(l,d,r.shape,n,i,o,a);if(null!=h){return[p,f,ol(v,d)]}return[p,f]},w={x:g,filter:f,bias:v,preluActivationWeights:x},_={strides:n,pad:i,dataFormat:r,dilations:o,dimRoundingMode:a,activation:u,leakyreluAlpha:h};if(null==l){return zo(((t,e,n)=>{let i=ze.runKernel("FusedDepthwiseConv2D",w,_);return n([e,t,i]),m&&(i=Sr(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}))(g,f)}return zo(((t,e,n,i)=>{let r=ze.runKernel("FusedDepthwiseConv2D",w,_);return i([e,t,r,n]),m&&(r=Sr(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(g,f,v)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dl=Ke({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:i=!1,bias:r,activation:o="linear",preluActivationWeights:a,leakyreluAlpha:l}){if(!1===sl(ze.state.gradientDepth,o)){let s=Qn(t,e,n,i);return null!=r&&(s=Xi(s,r)),al(s,o,a,l)}let u=Xe(t,"a","fused matMul"),c=Xe(e,"b","fused matMul");[u,c]=Te(u,c);const p=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=i?c.shape[c.rank-1]:c.shape[c.rank-2],g=n?u.shape[u.rank-1]:u.shape[u.rank-2],m=i?c.shape[c.rank-2]:c.shape[c.rank-1],y=u.shape.slice(0,-2),v=c.shape.slice(0,-2),x=h(y),b=h(v);s(u.rank>=2&&c.rank>=2&&u.rank===c.rank,(()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${u.rank} and ${c.rank}.`)),s(d(y,v),(()=>`Error in fused matMul: outer dimensions (${y}) and (${v}) of Tensors with shapes ${u.shape} and ${c.shape} must match.`)),s(p===f,(()=>`Error in fused matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${i} must match.`));const w=u.shape.slice(0,-2).concat([g,m]),_=Sr(u,n?[x,p,g]:[x,g,p]),k=Sr(c,i?[b,m,f]:[b,f,m]);let S,C;null!=r&&(S=Xe(r,"bias","fused matMul"),[S]=Te(S,u),lo(w,S.shape)),null!=a&&(C=Xe(a,"prelu weights","fused matMul"));const A=(t,e)=>{const[a,s,l,u]=e,c=rl(Sr(t,l.shape),l,o);let h,d;if(n||i?!n&&i?(h=Qn(c,s,!1,!1),d=Qn(c,a,!0,!1)):n&&!i?(h=Qn(s,c,!1,!0),d=Qn(a,c,!1,!1)):(h=Qn(s,c,!0,!0),d=Qn(c,a,!0,!0)):(h=Qn(c,s,!1,!0),d=Qn(a,c,!0,!1)),null!=r){return[h,d,ol(u,c)]}return[h,d]},I={a:_,b:k,bias:S,preluActivationWeights:C},M={transposeA:n,transposeB:i,activation:o,leakyreluAlpha:l};if(null==r){return zo(((t,e,n)=>{const i=ze.runKernel("_FusedMatMul",I,M);return n([t,e,i]),{value:Sr(i,w),gradFunc:A}}))(_,k)}return zo(((t,e,n,i)=>{const r=ze.runKernel("_FusedMatMul",I,M);return i([t,e,r,n]),{value:Sr(r,w),gradFunc:A}}))(_,k,S)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",conv2d:ll,depthwiseConv2d:hl,matMul:dl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl=Ke({hammingWindow_:function(t){return el(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gl=Ke({hannWindow_:function(t){return el(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ml=Ke({frame_:function(t,e,n,i=!1,r=0){let o=0;const a=[];for(;o+e<=t.size;)a.push(Dr(t,o,e)),o+=n;if(i)for(;o<t.size;){const i=o+e-t.size,s=Ir([Dr(t,o,e-i),ko([i],r)]);a.push(s),o+=n}return 0===a.length?$s([],[0,e]):Sr(Ir(a),[a.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yl=Ke({stft_:function(t,e,n,i,r=gl){null==i&&(i=tl(e));const o=ml(t,e,n),a=Zi(o,r(e));return Ms(a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vl=Ke({cropAndResize_:function(t,e,n,i,r="bilinear",o=0){const a=Xe(t,"image","cropAndResize"),l=Xe(e,"boxes","cropAndResize","float32"),u=Xe(n,"boxInd","cropAndResize","int32"),c=l.shape[0];s(4===a.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`)),s(2===l.rank&&4===l.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${l.shape}.`)),s(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${l.shape}.`)),s(2===i.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`)),s(i[0]>=1&&i[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${i}`)),s("bilinear"===r||"nearest"===r,(()=>`method must be bilinear or nearest, but was ${r}`));const h={image:a,boxes:l,boxInd:u},d={method:r,extrapolationValue:o,cropSize:i};return ze.runKernel("CropAndResize",h,d)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xl=Ke({flipLeftRight_:function(t){const e=Xe(t,"image","flipLeftRight","float32");s(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return ze.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bl=Ke({rotateWithOffset_:function(t,e,n=0,i=.5){const r=Xe(t,"image","rotateWithOffset","float32");s(4===r.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`));const o={image:r},a={radians:e,fillValue:n,center:i};return ze.runKernel("RotateWithOffset",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wl(t,e,n,i,r,o){null==i&&(i=.5),null==r&&(r=Number.NEGATIVE_INFINITY),null==o&&(o=0);const a=t.shape[0];return n=Math.min(n,a),s(0<=i&&i<=1,(()=>`iouThreshold must be in [0, 1], but was '${i}'`)),s(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),s(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),s(1===e.rank,(()=>"scores must be a 1D tensor")),s(e.shape[0]===a,(()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`)),s(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:i,scoreThreshold:r,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _l=Ke({nonMaxSuppression_:function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY){const o=Xe(t,"boxes","nonMaxSuppression"),a=Xe(e,"scores","nonMaxSuppression"),s=wl(o,a,n,i,r),l={maxOutputSize:n=s.maxOutputSize,iouThreshold:i=s.iouThreshold,scoreThreshold:r=s.scoreThreshold};return ze.runKernel("NonMaxSuppressionV3",{boxes:o,scores:a},l)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kl(t,e,n){const i=function(t,e,n){return function(t,e,n){let i=0,r=t.length,o=0,a=!1;for(;i<r;){o=i+(r-i>>>1);const s=n(e,t[o]);s>0?i=o+1:(r=o,a=!s)}return a?i:-i-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||Sl)}(t,e,n),r=i<0?-(i+1):i;t.splice(r,0,e)}function Sl(t,e){return t>e?1:t<e?-1:0}function Cl(t,e,n,i,r){return Ml(t,e,n,i,r,0)}function Al(t,e,n,i,r,o){return Ml(t,e,n,i,r,0,!1,o,!0)}function Il(t,e,n,i,r,o){return Ml(t,e,n,i,r,o,!0)}function Ml(t,e,n,i,r,o,a=!1,s=!1,l=!1){const u=[];for(let t=0;t<e.length;t++)e[t]>r&&u.push({score:e[t],boxIndex:t,suppressBeginIndex:0});u.sort(El);const c=o>0?-.5/o:0,h=[],d=[];for(;h.length<n&&u.length>0;){const e=u.pop(),{score:n,boxIndex:o,suppressBeginIndex:a}=e;if(n<r)break;let s=!1;for(let n=h.length-1;n>=a;--n){const a=Dl(t,o,h[n]);if(a>=i){s=!0;break}if(e.score=e.score*Tl(i,c,a),e.score<=r)break}e.suppressBeginIndex=h.length,s||(e.score===n?(h.push(o),d.push(e.score)):e.score>r&&kl(u,e,El))}const p=h.length,f=n-p;s&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const g={selectedIndices:h};return a&&(g.selectedScores=d),l&&(g.validOutputs=p),g}function Dl(t,e,n){const i=t.subarray(4*e,4*e+4),r=t.subarray(4*n,4*n+4),o=Math.min(i[0],i[2]),a=Math.min(i[1],i[3]),s=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(s-o)*(l-a),f=(h-u)*(d-c);if(p<=0||f<=0)return 0;const g=Math.max(o,u),m=Math.max(a,c),y=Math.min(s,h),v=Math.min(l,d),x=Math.max(y-g,0)*Math.max(v-m,0);return x/(p+f-x)}function Tl(t,e,n){const i=Math.exp(e*n*n);return n<=t?i:0}function El(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nl=async function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY){const o=Xe(t,"boxes","nonMaxSuppressionAsync"),a=Xe(e,"scores","nonMaxSuppressionAsync"),s=wl(o,a,n,i,r);n=s.maxOutputSize,i=s.iouThreshold,r=s.scoreThreshold;const l=await Promise.all([o.data(),a.data()]),u=l[0],c=l[1],{selectedIndices:h}=Cl(u,c,n,i,r);return o!==t&&o.dispose(),a!==e&&a.dispose(),Ls(h,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ol=Ke({nonMaxSuppressionWithScore_:function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY,o=0){const a=Xe(t,"boxes","nonMaxSuppression"),s=Xe(e,"scores","nonMaxSuppression"),l=wl(a,s,n,i,r,o),u={boxes:a,scores:s},c={maxOutputSize:n=l.maxOutputSize,iouThreshold:i=l.iouThreshold,scoreThreshold:r=l.scoreThreshold,softNmsSigma:o=l.softNmsSigma},h=ze.runKernel("NonMaxSuppressionV5",u,c);return{selectedIndices:h[0],selectedScores:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fl=async function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY,o=0){const a=Xe(t,"boxes","nonMaxSuppressionAsync"),s=Xe(e,"scores","nonMaxSuppressionAsync"),l=wl(a,s,n,i,r,o);n=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([a.data(),s.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:p}=Il(c,h,n,i,r,o);return a!==t&&a.dispose(),s!==e&&s.dispose(),{selectedIndices:Ls(d,"int32"),selectedScores:Ls(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rl=Ke({nonMaxSuppressionPadded_:function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY,o=!1){const a=Xe(t,"boxes","nonMaxSuppression"),s=Xe(e,"scores","nonMaxSuppression"),l=wl(a,s,n,i,r,null),u={boxes:a,scores:s},c={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:o},h=ze.runKernel("NonMaxSuppressionV4",u,c);return{selectedIndices:h[0],validOutputs:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ll=async function(t,e,n,i=.5,r=Number.NEGATIVE_INFINITY,o=!1){const a=Xe(t,"boxes","nonMaxSuppressionAsync"),s=Xe(e,"scores","nonMaxSuppressionAsync"),l=wl(a,s,n,i,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([a.data(),s.data()]),{selectedIndices:f,validOutputs:g}=Al(d,p,u,c,h,o);return a!==t&&a.dispose(),s!==e&&s.dispose(),{selectedIndices:Ls(f,"int32"),validOutputs:ds(g,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $l=Ke({resizeBilinear_:function(t,e,n=!1,i=!1){const r=Xe(t,"images","resizeBilinear");s(3===r.rank||4===r.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`)),s(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),s(!1===i||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=r,a=!1;3===r.rank&&(a=!0,o=Sr(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:o},u={alignCorners:n,halfPixelCenters:i,size:e},c=ze.runKernel("ResizeBilinear",l,u);return a?Sr(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pl=Ke({resizeNearestNeighbor_:function(t,e,n=!1,i=!1){const r=Xe(t,"images","resizeNearestNeighbor");s(3===r.rank||4===r.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`)),s(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),s("float32"===r.dtype||"int32"===r.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),s(!1===i||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=r,a=!1;3===r.rank&&(a=!0,o=Sr(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:o},u={alignCorners:n,halfPixelCenters:i,size:e},c=ze.runKernel("ResizeNearestNeighbor",l,u);return a?Sr(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zl=Ke({threshold_:function(t,e="binary",n=!1,i=.5){const r=Xe(t,"image","threshold"),o=r.shape[0]*r.shape[1];let a,l,u,c,h=Zi(Ls([i]),255);if(s(3===r.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`)),s(3===r.shape[2]||1===r.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`)),s("int32"===r.dtype||"float32"===r.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`)),s("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===r.shape[2]){[a,l,u]=Is(r,[1,1,1],-1);const t=Zi(a,.2989),e=Zi(l,.587),n=Zi(u,.114);c=Xi(Xi(t,e),n)}else c=t;if("otsu"===e){h=function(t,e){let n,i,r,o,a,s,l=Ls([-1]),u=Ls([0]),c=Ls([0]);for(let h=0;h<t.size-1;h++){n=Dr(t,0,h+1),i=Dr(t,h+1),a=Ki(Ho(n),e),s=Ki(Ho(i),e);const d=Ho(Zi(n,ts(0,n.size)));r=Ki(d,Ho(n));const p=ko(i.shape,n.size),f=Xi(ts(0,i.size),p),g=Zi(i,f);o=Ki(Ho(g),Ho(i));const m=Go(r,o),y=Go(r,o),v=Zi(a,s);c=Zi(Zi(v,m),y);const x=Ao(c,u);u=co(x,c,u),l=co(x,Ls([h]),l)}return l}($r($n(cs(c),"int32"),Qe([]),256),o)}const d=n?Fo(c,h):Ao(c,h);return $n(Zi(d,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bl=Ke({transform_:function(t,e,n="nearest",i="constant",r=0,o){const a=Xe(t,"image","transform","float32"),l=Xe(e,"transforms","transform","float32");s(4===a.rank,(()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`)),s(2===l.rank&&(l.shape[0]===a.shape[0]||1===l.shape[0])&&8===l.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),s(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:a,transforms:l},c={interpolation:n,fillMode:i,fillValue:r,outputShape:o};return ze.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vl=Ke({bandPart_:function(t,e,n){s(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),s(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const i=Xe(t,"a","bandPart");s(i.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`));const r=i.shape,[o,a]=i.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=a))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${a}).`);e<0&&(e=o),n<0&&(n=a);const l=Sr(ts(0,o,1,"int32"),[-1,1]),u=ts(0,a,1,"int32"),c=Go(l,u),h=ia(Fo(c,ds(+e,"int32")),Io(c,ds(-n,"int32"))),d=da([o,a],i.dtype);return Sr(Ns(Ws(Sr(i,[-1,o,a])).map((t=>co(h,t,d)))),r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wl=Ke({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,s(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)s(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=Is(t,t.shape[0],0).map((t=>Es(t,[0])));s(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],i=t;for(let e=0;e<t.length;++e)n.push(ze.tidy((()=>{let t=i[e];if(e>0)for(let i=0;i<e;++i){const e=Zi(Ho(Zi(n[i],t)),n[i]);t=Go(t,e)}return Ki(t,Xs(t,"euclidean"))})));return e?Ns(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jl(t,e=!1){return ze.tidy((()=>{s(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],i=t.shape[1];let r=_o(n),o=Pn(t);const a=$s([[1]],[1,1]);let l=Pn(a);const u=n>=i?i:n;for(let t=0;t<u;++t){const e=o,s=l,u=r;[l,o,r]=ze.tidy((()=>{const e=Dr(o,[t,t],[n-t,1]),s=Xs(e),u=Dr(o,[t,t],[1,1]),c=co(Ao(u,0),$s([[-1]]),$s([[1]])),h=Go(u,Zi(c,s)),d=Ki(e,h);l=1===d.shape[0]?Pn(a):Ir([a,Dr(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=Vo(Ki(Qn(c,h),s)),f=Dr(o,[t,0],[n-t,i]),g=Zi(p,l),m=ei(l);if(0===t)o=Go(f,Qn(g,Qn(m,f)));else{const e=Go(f,Qn(g,Qn(m,f)));o=Ir([Dr(o,[0,0],[t,i]),e],0)}const y=ei(g),v=Dr(r,[0,t],[n,r.shape[1]-t]);if(0===t)r=Go(v,Qn(Qn(v,l),y));else{const e=Go(v,Qn(Qn(v,l),y));r=Ir([Dr(r,[0,0],[n,t]),e],1)}return[l,o,r]})),Ui([e,s,u])}return!e&&n>i&&(r=Dr(r,[0,0],[n,i]),o=Dr(o,[0,0],[i,i])),[r,o]}))}const Ul=Ke({qr_:function(t,e=!1){if(s(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return jl(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),i=Ws(Sr(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],o=[];i.forEach((t=>{const[n,i]=jl(t,e);r.push(n),o.push(i)}));return[Sr(Ns(r,0),t.shape),Sr(Ns(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gl,Hl;(Hl=Gl||(Gl={}))[Hl.NONE=0]="NONE",Hl[Hl.MEAN=1]="MEAN",Hl[Hl.SUM=2]="SUM",Hl[Hl.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS";const ql=Ke({computeWeightedLoss_:function(t,e,n=Gl.SUM_BY_NONZERO_WEIGHTS){const i=Xe(t,"losses","computeWeightedLoss");let r=null;null!=e&&(r=Xe(e,"weights","computeWeightedLoss"));const o=null==r?i:Zi(i,r);if(n===Gl.NONE)return o;if(n===Gl.SUM)return Ho(o);if(n===Gl.MEAN){if(null==r)return ha(o);{const t=i.size/r.size,e=Ki(Ho(o),Ho(r));return t>1?Ki(e,ds(t)):e}}if(n===Gl.SUM_BY_NONZERO_WEIGHTS){if(null==r)return Ki(Ho(o),ds(i.size));{const t=Zi(r,pa(i.shape)),e=$n(Ho(_a(t,ds(0))),"float32");return Ki(Ho(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xl=Ke({absoluteDifference_:function(t,e,n,i=Gl.SUM_BY_NONZERO_WEIGHTS){const r=Xe(t,"labels","absoluteDifference"),o=Xe(e,"predictions","absoluteDifference");let a=null;null!=n&&(a=Xe(n,"weights","absoluteDifference")),l(r.shape,o.shape,"Error in absoluteDifference: ");const s=Ji(Go(r,o));return ql(s,a,i)}});const Yl=Ke({cosineDistance_:function(t,e,n,i,r=Gl.SUM_BY_NONZERO_WEIGHTS){const o=Xe(t,"labels","cosineDistance"),a=Xe(e,"predictions","cosineDistance");let s=null;null!=i&&(s=Xe(i,"weights","cosineDistance")),l(o.shape,a.shape,"Error in cosineDistance: ");const u=ds(1),c=Go(u,Ho(Zi(o,a),n,!0));return ql(c,s,r)}});const Kl=Ke({hingeLoss_:function(t,e,n,i=Gl.SUM_BY_NONZERO_WEIGHTS){let r=Xe(t,"labels","hingeLoss");const o=Xe(e,"predictions","hingeLoss");let a=null;null!=n&&(a=Xe(n,"weights","hingeLoss")),l(r.shape,o.shape,"Error in hingeLoss: ");const s=ds(1);r=Go(Zi(ds(2),r),s);const u=is(Go(s,Zi(r,o)));return ql(u,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zl=Ke({huberLoss_:function(t,e,n,i=1,r=Gl.SUM_BY_NONZERO_WEIGHTS){const o=Xe(t,"labels","huberLoss"),a=Xe(e,"predictions","huberLoss");let s=null;null!=n&&(s=Xe(n,"weights","huberLoss")),l(o.shape,a.shape,"Error in huberLoss: ");const u=ds(i),c=Ji(Go(a,o)),h=ga(c,u),d=Go(c,h),p=Xi(Zi(ds(.5),va(h)),Zi(u,d));return ql(p,s,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jl=Ke({logLoss_:function(t,e,n,i=1e-7,r=Gl.SUM_BY_NONZERO_WEIGHTS){const o=Xe(t,"labels","logLoss"),a=Xe(e,"predictions","logLoss");let s=null;null!=n&&(s=Xe(n,"weights","logLoss")),l(o.shape,a.shape,"Error in logLoss: ");const u=ds(1),c=ds(i),h=Vo(Zi(o,Lo(Xi(a,c)))),d=Zi(Go(u,o),Lo(Xi(Go(u,a),c))),p=Go(h,d);return ql(p,s,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ql=Ke({meanSquaredError_:function(t,e,n,i=Gl.SUM_BY_NONZERO_WEIGHTS){const r=Xe(t,"labels","meanSquaredError"),o=Xe(e,"predictions","meanSquaredError");let a=null;null!=n&&(a=Xe(n,"weights","meanSquaredError")),l(r.shape,o.shape,"Error in meanSquaredError: ");const s=Ts(r,o);return ql(s,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tu=Ke({sigmoidCrossEntropy_:function(t,e,n,i=0,r=Gl.SUM_BY_NONZERO_WEIGHTS){let o=Xe(t,"multiClassLabels","sigmoidCrossEntropy");const a=Xe(e,"logits","sigmoidCrossEntropy");let s=null;if(null!=n&&(s=Xe(n,"weights","sigmoidCrossEntropy")),l(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),i>0){const t=ds(i),e=ds(1),n=ds(.5);o=Xi(Zi(o,Go(e,t)),Zi(n,t))}const u=function(t,e){const n=Xe(t,"labels","sigmoidCrossEntropyWithLogits"),i=Xe(e,"logits","sigmoidCrossEntropyWithLogits");l(n.shape,i.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=is(i),o=Zi(i,n),a=$o(vo(Vo(Ji(i))));return Xi(Go(r,o),a)}(o,a);return ql(u,s,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eu=Ke({softmaxCrossEntropy_:function(t,e,n,i=0,r=Gl.SUM_BY_NONZERO_WEIGHTS){let o=Xe(t,"onehotLabels","softmaxCrossEntropy");const a=Xe(e,"logits","softmaxCrossEntropy");let s=null;if(null!=n&&(s=Xe(n,"weights","softmaxCrossEntropy")),l(o.shape,a.shape,"Error in softmaxCrossEntropy: "),i>0){const t=ds(i),e=ds(1),n=ds(o.shape[1]);o=Xi(Zi(o,Go(e,t)),Ki(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return zo(((t,e,i)=>{const r=na(e,[n],!0),o=Go($n(e,"float32"),r);i([t,o]);const a=Vo(Zi(o,t));return{value:Ho(a,[n]),gradFunc:(t,e)=>{const[i,r]=e,o=Zo(t.shape,[n]);return[Zi(Sr(t,o),Go($n(i,"float32"),vo(r))),Zi(Sr(t,o),Go(vo(r),$n(i,"float32")))]}}}))(t,e)}(o,a);return ql(u,s,r)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nu=Ke({sparseFillEmptyRows_:function(t,e,n,i){const r=Xe(t,"indices","sparseFillEmptyRows"),o=Xe(e,"values","sparseFillEmptyRows"),a=Xe(n,"denseShape","sparseFillEmptyRows"),s=Xe(i,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==r.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==a.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${a.shape}`);if(0!==s.rank)throw new Error(`Default value should be a scalar but received shape ${s.shape}`);const l={indices:r,values:o,denseShape:a,defaultValue:s},u=ze.runKernel("SparseFillEmptyRows",l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iu=Ke({sparseReshape_:function(t,e,n){const i=Xe(t,"inputIndices","sparseReshape"),r=Xe(e,"inputShape","sparseReshape"),o=Xe(n,"newShape","sparseReshape");if(2!==i.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==r.rank)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const a={inputIndices:i,inputShape:r,newShape:o},s=ze.runKernel("SparseReshape",a);return{outputIndices:s[0],outputShape:s[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ru=Ke({sparseSegmentMean_:function(t,e,n){const i=Xe(t,"data","sparseSegmentMean"),r=Xe(e,"indices","sparseSegmentMean"),o=Xe(n,"segmentIds","sparseSegmentMean");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${r.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const a={data:i,indices:r,segmentIds:o};return ze.runKernel("SparseSegmentMean",a)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ou=Ke({sparseSegmentSum_:function(t,e,n){const i=Xe(t,"data","sparseSegmentSum"),r=Xe(e,"indices","sparseSegmentSum"),o=Xe(n,"segmentIds","sparseSegmentSum");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${r.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const a={data:i,indices:r,segmentIds:o};return ze.runKernel("SparseSegmentSum",a)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const au=Ke({stringNGrams_:function(t,e,n,i,r,o,a,s){const l=Xe(t,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=Xe(e,"dataSplits","stringNGrams");if("int32"!==u.dtype)throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:i,leftPad:r,rightPad:o,padWidth:a,preserveShortSequences:s},h={data:l,dataSplits:u},d=ze.runKernel("StringNGrams",h,c);return{nGrams:d[0],nGramsSplits:d[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const su=Ke({stringSplit_:function(t,e,n=!0){const i=Xe(t,"input","stringSplit","string"),r=Xe(e,"delimiter","stringSplit","string");if(1!==i.rank)throw new Error(`Input should be Tensor1D but received shape ${i.shape}`);if(0!==r.rank)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const o={skipEmpty:n},a={input:i,delimiter:r},s=ze.runKernel("StringSplit",a,o);return{indices:s[0],values:s[1],shape:s[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lu=Ke({stringToHashBucketFast_:function(t,e){const n=Xe(t,"input","stringToHashBucketFast","string"),i={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return ze.runKernel("StringToHashBucketFast",r,i)}}),uu={fft:Ss,ifft:Cs,rfft:Ms,irfft:As},cu={hammingWindow:fl,hannWindow:gl,frame:ml,stft:yl},hu={flipLeftRight:xl,resizeNearestNeighbor:Pl,resizeBilinear:$l,rotateWithOffset:bl,cropAndResize:vl,nonMaxSuppression:_l,nonMaxSuppressionAsync:Nl,nonMaxSuppressionWithScore:Ol,nonMaxSuppressionWithScoreAsync:Fl,nonMaxSuppressionPadded:Rl,nonMaxSuppressionPaddedAsync:Ll,threshold:zl,transform:Bl},du={bandPart:Vl,gramSchmidt:Wl,qr:Ul},pu={absoluteDifference:Xl,computeWeightedLoss:ql,cosineDistance:Yl,hingeLoss:Kl,huberLoss:Zl,logLoss:Jl,meanSquaredError:Ql,sigmoidCrossEntropy:tu,softmaxCrossEntropy:eu},fu={sparseFillEmptyRows:nu,sparseReshape:iu,sparseSegmentMean:ru,sparseSegmentSum:ou},gu={stringNGrams:au,stringSplit:su,stringToHashBucketFast:lu};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class mu extends Oi{minimize(t,e=!1,n){const{value:i,grads:r}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:r[t.name]})));this.applyGradients(t)}else this.applyGradients(r);return Ui(r),e?i:(i.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return Po(t,e)}dispose(){null!=this.iterations_&&Ui(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:ds(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(mu,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yu extends mu{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=ze.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const i=ze.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:ji((()=>ho(i).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:ji((()=>ho(i).variable(false)))});const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const o=this.accumulatedGrads[n].variable,a=this.accumulatedUpdates[n].variable;ji((()=>{const t=Xi(Zi(o,this.rho),Zi(va(r),1-this.rho)),e=Zi(Ki(Ds(Xi(a,this.epsilon)),Ds(Xi(o,this.epsilon))),r),n=Xi(Zi(a,this.rho),Zi(va(e),1-this.rho));o.assign(t),a.assign(n);const s=Xi(Zi(e,-this.learningRate),i);i.assign(s)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Ui(this.accumulatedGrads.map((t=>t.variable))),Ui(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}yu.className="Adadelta",Ri(yu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class vu extends mu{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const i=ze.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:ji((()=>ko(i.shape,this.initialAccumulatorValue).variable(t)))}}const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const o=this.accumulatedGrads[n].variable;ji((()=>{const t=Xi(o,va(r));o.assign(t);const e=Xi(Zi(Ki(r,Ds(Xi(t,ze.backend.epsilon()))),-this.learningRate),i);i.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Ui(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}vu.className="Adagrad",Ri(vu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xu extends mu{constructor(t,e,n,i=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ji((()=>{this.accBeta1=ds(e).variable(),this.accBeta2=ds(n).variable()})),null==i&&(this.epsilon=ze.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);ji((()=>{const n=Go(1,this.accBeta1),i=Go(1,this.accBeta2);e.forEach(((e,r)=>{const o=ze.registeredVariables[e];null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:`${e}/m`,variable:ji((()=>ho(o).variable(false)))}),null==this.accumulatedSecondMoment[r]&&(this.accumulatedSecondMoment[r]={originalName:`${e}/v`,variable:ji((()=>ho(o).variable(false)))});const a=Array.isArray(t)?t[r].tensor:t[e];if(null==a)return;const s=this.accumulatedFirstMoment[r].variable,l=this.accumulatedSecondMoment[r].variable,u=Xi(Zi(s,this.beta1),Zi(a,1-this.beta1)),c=Xi(Zi(l,this.beta2),Zi(va(a),1-this.beta2)),h=Ki(u,n),d=Ki(c,i);s.assign(u),l.assign(c);const p=Xi(Zi(Ki(h,Xi(Ds(d),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(Zi(this.accBeta1,this.beta1)),this.accBeta2.assign(Zi(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ui(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&Ui(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),ji((()=>{this.accBeta1.assign(Na(this.beta1,this.iterations_+1)),this.accBeta2.assign(Na(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}xu.className="Adam",Ri(xu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class bu extends mu{constructor(t,e,n,i=null,r=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ji((()=>{this.iteration=ds(0).variable(),this.accBeta1=ds(e).variable()})),null==i&&(this.epsilon=ze.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);ji((()=>{const n=Go(1,this.accBeta1),i=Ki(-this.learningRate,Xi(Zi(this.iteration,this.decay),1));e.forEach(((e,r)=>{const o=ze.registeredVariables[e];null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:`${e}/m`,variable:ho(o).variable(false)}),null==this.accumulatedWeightedInfNorm[r]&&(this.accumulatedWeightedInfNorm[r]={originalName:`${e}/v`,variable:ho(o).variable(false)});const a=Array.isArray(t)?t[r].tensor:t[e];if(null==a)return;const s=this.accumulatedFirstMoment[r].variable,l=this.accumulatedWeightedInfNorm[r].variable,u=Xi(Zi(s,this.beta1),Zi(a,1-this.beta1)),c=Zi(l,this.beta2),h=Ji(a),d=ca(c,h);s.assign(u),l.assign(d);const p=Xi(Zi(Ki(i,n),Ki(u,Xi(d,this.epsilon))),o);o.assign(p)})),this.iteration.assign(Xi(this.iteration,1)),this.accBeta1.assign(Zi(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ui(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&Ui(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}bu.className="Adamax",Ri(bu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class wu extends mu{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const r=ze.registeredVariables[e];ji((()=>{const t=Xi(Zi(this.c,i),r);r.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Gi(ds(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}wu.className="SGD",Ri(wu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _u extends wu{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=ds(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const i=ze.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:ji((()=>ho(i).variable(t)))}}const r=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&ji((()=>{let t;const e=Xi(Zi(this.m,r),o);t=this.useNesterov?Xi(Zi(this.c,Xi(o,Zi(e,this.m))),i):Xi(Zi(this.c,e),i),r.assign(e),i.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Ui(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}_u.className="Momentum",Ri(_u);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ku extends mu{constructor(t,e=.9,n=0,i=null,r=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,null==i&&(this.epsilon=ze.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const i=ze.registeredVariables[e],r=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:ji((()=>ho(i).variable(r)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:ji((()=>ho(i).variable(r)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:ji((()=>ho(i).variable(r)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const a=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;ji((()=>{const t=Xi(Zi(a,this.decay),Zi(va(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,r=Xi(Zi(e,this.decay),Zi(o,1-this.decay)),l=Ki(Zi(o,this.learningRate),Ds(Go(t,Xi(va(r),this.epsilon)))),u=Xi(Zi(s,this.momentum),l);a.assign(t),e.assign(r),s.assign(u);const c=Go(i,u);i.assign(c)}else{const t=Xi(Zi(a,this.decay),Zi(va(o),1-this.decay)),e=Xi(Zi(s,this.momentum),Ki(Zi(o,this.learningRate),Ds(Xi(t,this.epsilon))));a.assign(t),s.assign(e);const n=Go(i,e);i.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Ui(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&Ui(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&Ui(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}ku.className="RMSProp",Ri(ku);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Su{static sgd(t){return new wu(t)}static momentum(t,e,n=!1){return new _u(t,e,n)}static rmsprop(t,e=.9,n=0,i=null,r=!1){return new ku(t,e,n,i,r)}static adam(t=.001,e=.9,n=.999,i=null){return new xu(t,e,n,i)}static adadelta(t=.001,e=.95,n=null){return new yu(t,e,n)}static adamax(t=.002,e=.9,n=.999,i=null,r=0){return new bu(t,e,n,i,r)}static adagrad(t,e=.1){return new vu(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cu={sgd:Su.sgd,momentum:Su.momentum,adadelta:Su.adadelta,adagrad:Su.adagrad,rmsprop:Su.rmsprop,adamax:Su.adamax,adam:Su.adam},Au="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iu(){return new Promise((t=>Au((()=>t()))))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mu(t,e){const n=t[0].length;t.forEach(((t,e)=>{s(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),s(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const i=t[0];t.forEach(((t,r)=>{for(let o=0;o<n;o++)s(o===e||t[o]===i[o],(()=>`Error in concat${n}D: Shape of tensors[${r}] (${t}) does not match the shape of the rest (${i}) along the non-concatenated axis ${r}.`))}))}function Du(t,e){const n=t[0].slice();for(let i=1;i<t.length;i++)n[e]+=t[i][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(t){return t<=30?t:O(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eu(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nu(t,e,n,i=!0){let r=[];if(i)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const n=e.length;for(let i=0;i<n;++i)r=r.concat([t[i+1]/e[i],e[i]]);r=r.concat(t.slice(n+1))}return r}function Ou(t,e,n=!0){const i=[];if(n){i.push(e);for(let n=e+1;n<t;++n)n<=2*e?(i.push(n),i.push(n-(e+1))):i.push(n)}else{const n=[],r=[];for(let i=1;i<t;++i)i>=2*e+1||i%2==1?r.push(i):n.push(i);i.push(...n),i.push(0),i.push(...r)}return i}function Fu(t,e,n,i=!0){const r=[];i?r.push(t[0]/n):r.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?i?r.push(e[n-1]*t[n]):r.push(t[n]/e[n-1]):r.push(t[n]);return r}function Ru(t,e){const n=[0];for(let i=0;i<e;++i)n.push(t[i][0]);return n}function Lu(t,e,n){const i=t.slice(0,1);for(let r=0;r<n;++r)i.push(t[r+1]-e[r][0]-e[r][1]);return i}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $u=1.0507009873554805;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Pu(...t){H().getBool("IS_TEST")||console.warn(...t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zu(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let i=0;i<n.length;i+=2)n[i]=t[i/2],n[i+1]=e[i/2];return n}function Bu(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let i=0;i<t.length;i+=2)e[i/2]=t[i],n[i/2]=t[i+1];return{real:e,imag:n}}function Vu(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],i[Math.floor(e/4)]=t[e+1];return{real:n,imag:i}}function Wu(t){const e=Math.floor(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],i[Math.floor(e/4)]=t[e+1];return{real:n,imag:i}}function ju(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Uu(t,e,n,i){t[2*i]=e,t[2*i+1]=n}function Gu(t,e){const n=new Float32Array(t/2),i=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const o=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(o),i[r]=Math.sin(o)}return{real:n,imag:i}}function Hu(t,e,n){const i=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(i),imag:Math.sin(i)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qu=/->/g;function Xu(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(qu,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[i,r]=t.split("->");s(-1===i.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=i.split(","),a=o.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const l=[];for(let t=0;t<r.length;++t){const e=r[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===l.indexOf(e)&&l.push(e)}for(let t=0;t<i.length;++t){const e=i[t];-1===l.indexOf(e)&&","!==e&&l.push(e)}const u=new Array(o.length);for(let t=0;t<a;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(l.indexOf(o[t][e]))}const c=l.length,h=[];for(let t=r.length;t<c;++t)h.push(t);return{allDims:l,summedDims:h,idDims:u}}function Yu(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const i=[];for(let e=0;e<t;++e)-1===n[e]&&i.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:i}}function Ku(t,e,n){const i=new Array(t);for(let t=0;t<n.length;++t){const r=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===i[e[t][n]]?i[e[t][n]]=r[n]:s(i[e[t][n]]===r[n],(()=>`Expected dimension ${i[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(r)}, but got dimension ${r[n]}`))}}function Zu(t,e){const n=t,i=[];let r=0;0===t.length&&n.push(-1),r=t.length+1;for(let t=0;t<r;++t)i.push([]);const o=[];for(let t=0;t<n.length;++t){const r=Qu(e,n[t]);for(const e of r)-1===o.indexOf(e)&&(i[t].push(e),o.push(e))}return{path:n,steps:i}}function Ju(t){return t.every(((t,e)=>t===e))}function Qu(t,e){const n=[];for(let i=0;i<t.length;++i)0!==t[i].length&&-1===t[i].indexOf(e)&&-1!==e||n.push(i);return n}function tc(t,e,n=0){let i=[];if("number"==typeof e)s(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),i=new Array(e).fill(t.shape[n]/e);else{s(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const r=e.indexOf(-1);if(-1!==r){const i=e.reduce(((t,e)=>e>0?t+e:t));e[r]=t.shape[n]-i}s(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),i=e}return i}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(t,e){let n,i=!1;for(t<=30?(n=t,i=!0):n=O(t,Math.floor(Math.sqrt(t)));!i;)n>e||n===t?i=!0:n=O(t,n+1);return n}function nc(t,e,n){const i=[],r=t.length;for(let o=0;o<r;o++)o!==e?i.push(t[o]):i.push(n);return i}function ic(t,e,n,i){const r=e.shape.length,o=t.shape.length;if(0!==i&&(i<-r||i>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${i}`);if(i<0&&(i+=r),i>o)throw new Error(`batchDims (${i}) must be less than rank(x) (\n    ${o}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let n=0;n<i;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const a=t.shape[n],s=[];let l=1,u=1,c=1;for(let e=0;e<i;++e)s.push(t.shape[e]),l*=t.shape[e];for(let e=i;e<n;e++)s.push(t.shape[e]),u*=t.shape[e];for(let t=i;t<r;t++)s.push(e.shape[t]);for(let e=n+1;e<o;e++)s.push(t.shape[e]),c*=t.shape[e];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:a,outputShape:s}}var rc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",segOpComputeOptimalWindowSize:ec,computeOutShape:nc,collectGatherOpShapeInfo:ic});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oc(t){try{return t.map((t=>ee(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function ac(t){return t.map((t=>te(t)))}var sc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",slice_util:Ni,segment_util:rc,fromUint8ToStringArray:oc,fromStringArrayToUint8:ac,upcastType:Me,axesAreInnerMostDims:Xo,combineLocations:Yo,computeOutAndReduceShapes:Ko,expandShapeToKeepDim:Zo,assertAxesAreInnerMostDims:Jo,getAxesPermutation:Qo,getUndoAxesPermutation:ta,getInnerMostAxes:ea,getBroadcastDims:ao,getReductionAxes:so,assertAndGetBroadcastShape:lo,assertParamsConsistent:Mu,computeOutShape:Du,computeDilation2DInfo:hr,computePool2DInfo:dr,computePool3DInfo:pr,computeConv2DInfo:fr,computeConv3DInfo:gr,computeDefaultPad:mr,tupleValuesAreOne:wr,eitherStridesOrDilationsAreOne:_r,convertConv2DDataFormat:kr,getFusedDyActivation:rl,getFusedBiasGradient:ol,applyActivation:al,shouldFuse:sl,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Tu,getImageCenter:Eu,getReshaped:Nu,getPermuted:Ou,getReshapedPermuted:Fu,getSliceBeginCoords:Ru,getSliceSize:Lu,prepareAndValidate:ci,validateUpdateShape:di,validateInput:pi,calculateShapes:fi,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:$u,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Pu,log:function(...t){H().getBool("IS_TEST")||console.log(...t)},mergeRealAndImagArrays:zu,splitRealAndImagArrays:Bu,complexWithEvenIndex:Vu,complexWithOddIndex:Wu,getComplexWithIndex:ju,assignToTypedArray:Uu,exponents:Gu,exponent:Hu,decodeEinsumEquation:Xu,getEinsumPermutation:Yu,checkEinsumDimSizes:Ku,getEinsumComputePath:Zu,isIdentityPermutation:Ju,prepareSplitSize:tc}),lc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nonMaxSuppressionV3Impl:Cl,nonMaxSuppressionV4Impl:Al,nonMaxSuppressionV5Impl:Il,whereImpl:Us}),uc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",AdadeltaOptimizer:yu,AdagradOptimizer:vu,AdamOptimizer:xu,AdamaxOptimizer:bu,MomentumOptimizer:_u,Optimizer:mu,RMSPropOptimizer:ku,SGDOptimizer:wu,Tensor:fe,TensorBuffer:he,Variable:me,get Rank(){return ye},sumOutType:De,upcastType:Me,get Reduction(){return Gl},customGrad:zo,grad:function(t){return s(N(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const i=Xe(e,"x","tf.grad","string_or_numeric"),r=null!=n?Xe(n,"dy","tf.grad"):null;return ze.tidy((()=>{const{value:e,grads:n}=ze.gradients((()=>t(i)),[i],r);return null!=r&&l(e.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Bo(n),n[0]}))}},grads:function(t){return s(N(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{s(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const i=Ye(e,"args","tf.grads","string_or_numeric"),r=null!=n?Xe(n,"dy","tf.grads"):null;return ze.tidy((()=>{const{value:e,grads:n}=ze.gradients((()=>t(...i)),i,r);return null!=r&&l(e.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Bo(n),n}))}},valueAndGrad:function(t){return s(N(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{s(e instanceof fe,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),s(null==n||n instanceof fe,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:i,value:r}=ze.gradients((()=>t(e)),[e],n);return Bo(i),{grad:i[0],value:r}}},valueAndGrads:function(t){return s(N(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{s(Array.isArray(e)&&e.every((t=>t instanceof fe)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),s(null==n||n instanceof fe,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const i=ze.gradients((()=>t(...e)),e,n);return null!=n&&l(i.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Bo(i.grads),i}},variableGrads:Po,Environment:U,env:H,get ENV(){return X},nextFrame:Iu,KernelBackend:e,DataStorage:t,abs:Ji,acos:Qi,acosh:tr,add:Xi,addN:er,all:nr,any:ir,argMax:rr,argMin:or,asin:ar,asinh:sr,atan:lr,atan2:ur,atanh:cr,avgPool:Cr,avgPool3d:Ar,basicLSTMCell:Er,batchToSpaceND:Nr,batchNorm:Or,batchNorm2d:Fr,batchNorm3d:Rr,batchNorm4d:Lr,bincount:$r,broadcastTo:Pr,buffer:Ln,cast:$n,ceil:zr,clipByValue:Br,clone:Pn,complex:Ze,concat:Ir,concat1d:Vr,concat2d:Wr,concat3d:jr,concat4d:Ur,conv1d:Hr,conv2d:Gr,conv2dTranspose:Xr,conv3d:Yr,conv3dTranspose:Zr,cos:Jr,cosh:Qr,cumsum:to,denseBincount:eo,depthToSpace:no,depthwiseConv2d:io,diag:ro,dilation2d:oo,div:Ki,divNoNan:po,dot:fo,einsum:go,elu:mo,equal:uo,erf:yo,exp:vo,expandDims:xo,expm1:bo,eye:_o,fill:ko,floor:So,floorDiv:Yi,gather:Co,greater:Ao,greaterEqual:Io,imag:Mo,isFinite:Do,isInf:To,isNaN:Eo,leakyRelu:No,less:Oo,lessEqual:Fo,linspace:function(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const i={start:t,stop:e,num:n};return ze.runKernel("LinSpace",{},i)},localResponseNormalization:Ro,log:Lo,log1p:$o,logSigmoid:jo,logSoftmax:qo,logSumExp:na,logicalAnd:ia,logicalNot:ra,logicalOr:oa,logicalXor:aa,matMul:Qn,max:Uo,maxPool:sa,maxPool3d:la,maxPoolWithArgmax:ua,maximum:ca,mean:ha,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let i=Xe(t,"x","meshgrid",t instanceof fe?t.dtype:"float32");if(void 0===e)return[i];let r=Xe(e,"y","meshgrid",e instanceof fe?e.dtype:"float32");const o=h(i.shape),a=h(r.shape);return"xy"===n?(i=Sr(i,[1,-1]),r=Sr(r,[-1,1]),[Qn(pa([a,1],i.dtype),i),Qn(r,pa([1,o],r.dtype))]):(i=Sr(i,[-1,1]),r=Sr(r,[1,-1]),[Qn(i,pa([1,a],i.dtype)),Qn(pa([o,1],r.dtype),r)])},min:fa,minimum:ga,mirrorPad:ma,mod:ya,moments:xa,mul:Zi,multiRNNCell:ba,multinomial:wa,neg:Vo,notEqual:_a,oneHot:ti,ones:pa,onesLike:ka,outerProduct:Sa,pad:Ca,pad1d:Aa,pad2d:Ia,pad3d:Ma,pad4d:Da,pool:Ea,pow:Na,prelu:Oa,print:zn,prod:Fa,rand:Ra,randomGamma:Za,randomNormal:Ja,randomUniform:Qa,range:ts,real:es,reciprocal:ns,relu:is,relu6:rs,reshape:Sr,reverse:os,reverse1d:as,reverse2d:ss,reverse3d:ls,reverse4d:us,round:cs,rsqrt:hs,scalar:ds,selu:ps,separableConv2d:fs,setdiff1dAsync:gs,sigmoid:Mr,sign:ms,sin:ys,sinh:vs,slice:Dr,slice1d:xs,slice2d:bs,slice3d:ws,slice4d:_s,softmax:ks,softplus:Wo,spaceToBatchND:Ta,fft:Ss,ifft:Cs,irfft:As,rfft:Ms,split:Is,sqrt:Ds,square:va,squaredDifference:Ts,squeeze:Es,stack:Ns,step:Os,stridedSlice:Fs,sub:Go,sum:Ho,tan:Rs,tanh:Tr,tensor:Qe,tensor1d:Ls,tensor2d:$s,tensor3d:ri,tensor4d:function(t,e,n){if(u(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const i=Ge(t,n);if(4!==i.length&&1!==i.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Je(t,e,i,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(u(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const i=Ge(t,n);if(5!==i.length&&1!==i.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Je(t,e,i,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(u(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const i=Ge(t,n);if(6!==i.length&&1!==i.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Je(t,e=e||i,i,n)},tile:wo,topk:Ps,truncatedNormal:zs,unique:Bs,unsortedSegmentSum:Vs,unstack:Ws,variable:js,where:co,whereAsync:Gs,zeros:da,zerosLike:ho,op:Ke,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:Hs,transpose:ei,norm:Xs,movingAverage:Ys,scatterND:Ks,sparseToDense:Zs,gatherND:Js,dropout:Qs,enclosingPowerOfTwo:tl,cosineWindow:el,inTopKAsync:nl,image:hu,linalg:du,losses:pu,spectral:uu,fused:pl,signal:cu,sparse:fu,string:gu,train:Cu,enableProdMode:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(){H().set("PROD",!0)},enableDebugMode:function(){H().set("DEBUG",!0)},disableDeprecationWarnings:function(){H().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){ze.disposeVariables()},engine:Vi,memory:Wi,profile:function(t){return ze.profile(t)},tidy:ji,dispose:Ui,keep:Gi,time:function(t){return ze.time(t)},setBackend:function(t){return ze.setBackend(t)},ready:function(){return ze.ready()},getBackend:function(){return ze.backendName},removeBackend:function(t){ze.removeBackend(t)},findBackend:function(t){return ze.findBackend(t)},findBackendFactory:function(t){return ze.findBackendFactory(t)},registerBackend:Hi,backend:qi,setPlatform:function(t,e){H().setPlatform(t,e)},getKernel:at,getGradient:st,getKernelsForBackend:lt,registerKernel:ut,registerGradient:ct,unregisterKernel:function(t,e){const n=ht(t,e);if(!rt.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);rt.delete(n)},unregisterGradient:function(t){if(!ot.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);ot.delete(t)},copyRegisteredKernels:function(t,e){lt(t).forEach((t=>{ut(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:Z,Cosh:"Cosh",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:J,Equal:"Equal",Exp:Q,ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:tt,Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:et,Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:nt,Tan:it,Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.7.0",browser:ui,io:Jn,math:ii,serialization:Li,test_util:Bi,util:ne,backend_util:sc,tensor_util:Fe,slice_util:Ni,gather_util:hi,scatter_util:gi,device_util:je,kernel_impls:lc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const cc={kernelName:"Abs",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,Os($n(n,"float32"),-1))}}},hc={kernelName:"Acos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=va($n(n,"float32")),i=Ds(Go(ds(1),e));return Vo(Ki(t,i))}}}},dc={kernelName:"Acosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Ds(Go(va($n(n,"float32")),1));return Ki(t,e)}}}},pc={kernelName:"Add",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{let e=t;const i=so(n.shape,r);return i.length>0&&(e=Ho(e,i)),Sr(e,n.shape)},b:()=>{let e=t;const n=so(i.shape,r);return n.length>0&&(e=Ho(e,n)),Sr(e,i.shape)}}}},fc={kernelName:"AddN",saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,i)=>{n[i]=()=>t.clone()})),n}},gc={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ho(n)}}},mc={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ho(n)}}},yc={kernelName:"Asin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Ds(Go(ds(1),va($n(n,"float32")))))}}},vc={kernelName:"Asinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Ds(Xi(ds(1),va($n(n,"float32"))));return Ki(t,e)}}}},xc={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{const e=Xi(va(n),va(i));let o=Zi(t,Ki(i,e));const a=so(n.shape,r);return a.length>0&&(o=Ho(o,a)),Sr(o,n.shape)},b:()=>{const e=Xi(va(n),va(i));let o=Vo(Zi(t,Ki(n,e)));const a=so(i.shape,r);return a.length>0&&(o=Ho(o,a)),Sr(o,i.shape)}}}},bc={kernelName:"Atan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Xi(va($n(n,"float32")),1))}}},wc={kernelName:"Atanh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Go(ds(1),va($n(n,"float32"))))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _c=Ke({avgPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r,o){const a=Xe(t,"dy","avgPool3dGrad"),l=Xe(e,"input","avgPool3dGrad");let u=a,c=l,h=!1;4===l.rank&&(h=!0,u=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=Sr(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),s(5===u.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`)),s(5===c.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`)),null!=o&&s(p(r),(()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`));const d={dy:u,input:c},f={filterSize:n,strides:i,pad:r,dimRoundingMode:o},g=ze.runKernel("AvgPool3DGrad",d,f);return h?Sr(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),kc={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:s}=n;return{x:()=>_c(t,i,r,o,a,s)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=Ke({avgPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r){const o=Xe(t,"dy","avgPoolGrad"),a=Xe(e,"input","avgPoolGrad");s(a.rank===o.rank,(()=>`Rank of input (${a.rank}) does not match rank of dy (${o.rank})`));let l=a,u=o,c=!1;3===a.rank&&(c=!0,l=Sr(a,[1,a.shape[0],a.shape[1],a.shape[2]]),u=Sr(o,[1,o.shape[0],o.shape[1],o.shape[2]])),s(4===u.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),s(4===l.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`));const h={dy:u,input:l},d={filterSize:n,strides:i,pad:r},p=ze.runKernel("AvgPoolGrad",h,d);return c?Sr(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),Cc={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:r,strides:o,pad:a}=n;return{x:()=>Sc(t,i,r,o,a)}}},Ac={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[i,r]=e,{transposeA:o,transposeB:a}=n;return o||a?!o&&a?{a:()=>Qn(t,r,!1,!1),b:()=>Qn(t,i,!0,!1)}:o&&!a?{a:()=>Qn(r,t,!1,!0),b:()=>Qn(i,t,!1,!1)}:{a:()=>Qn(r,t,!0,!0),b:()=>Qn(t,i,!0,!0)}:{a:()=>Qn(t,r,!1,!0),b:()=>Qn(i,t,!0,!1)}}},Ic={kernelName:"BatchToSpaceND",gradFunc:(t,e,n)=>{const{blockShape:i,crops:r}=n;return{x:()=>Ta(t,i,r)}}},Mc={kernelName:"BroadcastTo",gradFunc:(t,e,n)=>{const i=n,r=i.inputShape,o=i.shape,a=Array.from(o);for(let t=r.length-1;t>=0;t--)if(r[t]===o[t])a[t]=1;else if(1!==r[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const s=[];for(let t=0;t<a.length;t++)a[t]>1&&s.push(t);return{x:()=>Ho(t,s,!0)}}},Dc={kernelName:"Cast",gradFunc:t=>({x:()=>t.clone()})},Tc={kernelName:"Ceil",gradFunc:t=>({x:()=>ho(t)})},Ec={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{clipValueMin:r,clipValueMax:o}=n;return{x:()=>co(ia(Io(i,r),Fo(i,o)),t,ho(t))}}},Nc={kernelName:"ComplexAbs",inputsToSave:["x"],gradFunc:cc.gradFunc},Oc={kernelName:"Concat",saveAllInputs:!0,gradFunc:(t,e,n)=>{const i=e.map((t=>t.shape)),{axis:r}=n,o=v(r,e[0].shape)[0],a=i.map((t=>t[o]));return Is(t,a,o).map((t=>()=>t))}},Fc={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,r]=e,{dilations:o,strides:a,pad:l,dataFormat:u}=n;return s(wr(o),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`)),{x:()=>qr(i.shape,t,r,a,l,u),filter:()=>il(i,t,r.shape,a,l,u)}}},Rc={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[i,r]=e,{strides:o,pad:a,dataFormat:s,dimRoundingMode:l}=n;return{dy:()=>Gr(t,r,o,a,s,1,l),filter:()=>il(t,i,r.shape,o,a,s,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lc=Ke({conv3DBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r){let o=t;4===t.rank&&(o=Sr(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let a=e;4===a.rank&&(a=Sr(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),s(5===o.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`)),s(5===a.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`)),s(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),s(o.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`)),s(a.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${n[4]}).`));const l={x:o,dy:a},u={strides:i,pad:r,filterShape:n};return ze.runKernel("Conv3DBackpropFilterV2",l,u)}}),$c={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:r,pad:o}=n;s(wr(i),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`));const[a,l]=e;return{x:()=>Kr(a.shape,t,l,r,o),filter:()=>Lc(a,t,l.shape,r,o)}}},Pc={kernelName:Z,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(Vo(ys($n(n,"float32"))),t)}}},zc={kernelName:"Cosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(vs($n(n,"float32")),t)}}},Bc={kernelName:"Cumsum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:r,exclusive:o,reverse:a}=n;return{x:()=>{const e=Qo([r],i.rank);let n=to(t,r,o,!a);return null!=e&&(n=ei(n,e)),n}}}},Vc={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:r,pad:o,dimRoundingMode:a}=n,l=null==i?[1,1]:i;s(wr(l),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`));const[u,c]=e;return s(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),s(4===c.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`)),s(u.shape[3]===c.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`)),s(_r(r,l),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${l}'.`)),null!=a&&s(p(o),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${o}.`)),{x:()=>cl(u.shape,t,c,r,o,i,a),filter:()=>ul(u,t,c.shape,r,o,i,a)}}},Wc={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,r]=e,o={x:i,filter:r,dy:t},a={x:i,filter:r,dy:t};return{x:()=>ze.runKernel("Dilation2DBackpropInput",o,n),filter:()=>ze.runKernel("Dilation2DBackpropFilter",a,n)}}},jc={kernelName:"Elu",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,i={dy:t,y:n};return{x:()=>ze.runKernel("EluGrad",i)}}},Uc={kernelName:J,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=Zi(vo(Vo(va(n))),2/Math.sqrt(Math.PI));return{x:()=>Zi(t,i)}}},Gc={kernelName:Q,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,n)}}},Hc={kernelName:"ExpandDims",inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>Sr(t,n.shape)}}},qc={kernelName:"Expm1",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,vo(n))}}},Xc={kernelName:"Floor",gradFunc:t=>({x:()=>ho(t)})},Yc={kernelName:"FloorDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{const e=Ki(t,$n(i,"float32")),o=so(n.shape,r);return o.length>0?Sr(Ho(e,o),n.shape):e},b:()=>{let e=Zi(t,$n(n,"float32"));const o=so(i.shape,r);o.length>0&&(e=Sr(Ho(e,o),i.shape));const a=va(i);return Vo(Ki(e,$n(a,"float32")))}}}},Kc={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:i}=n,[r,o,a,s]=e,l=null==s?ds(1):s,u=so(o.shape,r.shape),c=[];if(1===o.rank){for(let t=0;t<r.shape.length-1;++t)c.push(r.shape[t]);c.push(1)}const h=Go(r,o),d=Zi(t,l),p=hs(Xi(a,ds(i))),f=Zi(Zi(Zi(p,p),p),ds(-.5));return{x:()=>1===o.rank?Sr(Zi(Zi(t,wo(Sr(p,[1,1,1,o.shape[0]]),c)),l),r.shape):Sr(Zi(Zi(t,p),l),r.shape),mean:()=>{let t=Zi(Zi(p,ds(-1)),d);return 1===o.rank&&(t=Ho(t,u)),Sr(t,o.shape)},variance:()=>{let t=Zi(Zi(f,h),d);return 1===o.rank&&(t=Ho(t,u)),Sr(t,o.shape)},scale:()=>{const e=Zi(h,p);let n=Zi(t,e);return 1===o.rank&&(n=Ho(n,u)),Sr(n,o.shape)},offset:()=>{let e=t;return 1===o.rank&&(e=Ho(e,u)),Sr(e,o.shape)}}}},Zc={kernelName:"GatherV2",inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[i,r]=e,{axis:o}=n,a=v(o,i.shape)[0];return{x:()=>{const e=i.shape,n=r.size,s=e.slice(0,a),l=s.length,u=e.slice(o,e.length).slice(1),c=u.length,h=Jc(0,l),d=Jc(l+1,l+1+c),p=Qc([s,[n],u]),f=Sr(t,p),g=Sr(r,[n]),m=Qc([[l],h,d]),y=ei(f,m);let v=Vs(y,g,i.shape[a]);const x=ta(m);return v=ei(v,x),v},indices:()=>r}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jc(t,e){const n=[];for(let i=t;i<e;++i)n.push(i);return n}function Qc(t){const e=[];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)e.push(t[n][i]);return e}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const th={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>ho(n),b:()=>ho(i)}}},eh={kernelName:"Identity",gradFunc:t=>({x:()=>$n(t,"float32")})},nh={kernelName:"IsFinite",gradFunc:t=>({x:()=>ho(t)})},ih={kernelName:"IsInf",gradFunc:t=>({x:()=>ho(t)})},rh={kernelName:"IsNan",gradFunc:t=>({x:()=>ho(t)})},oh={kernelName:"LeakyRelu",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{alpha:r}=n,o=Ao(i,0);return{x:()=>co(o,t,Zi(t,r))}}},ah={kernelName:"Log1p",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Xi(n,1))}}},sh={kernelName:"Log",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,$n(n,"float32"))}}},lh={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{axis:r}=n;return{logits:()=>{const e=vo(i);return Go(t,Zi(Ho(t,r,!0),e))}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uh=Ke({localResponseNormalizationBackprop_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i=5,r=1,o=1,a=.5){const s={x:t,y:e,dy:n},l={depthRadius:i,bias:r,alpha:o,beta:a};return ze.runKernel("LRNGrad",s,l)}}),ch={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{depthRadius:o,bias:a,alpha:s,beta:l}=n;return{x:()=>uh(i,r,t,o,a,s,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hh(t,e,n,i){return e.rank<n.rank&&(e=Sr(e,Zo(e.shape,i))),t.rank<n.rank&&(t=Sr(t,Zo(t.shape,i))),{x:()=>Zi(t,$n(uo(n,e),t.dtype))}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dh={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{reductionIndices:r}=i,o=e[0],a=hh(t,e[1],o,v(r,o.shape));return{x:()=>a.x()}}},ph={kernelName:"Maximum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>Zi(t,$n(Io(n,i),"float32")),b:()=>Zi(t,$n(Oo(n,i),"float32"))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fh=Ke({maxPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r,o,a){const l=Xe(t,"dy","maxPool3dGrad"),u=Xe(e,"input","maxPool3dGrad"),c=Xe(n,"output","maxPool3dGrad");let h=l,d=u,f=c,g=!1;4===u.rank&&(g=!0,h=Sr(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=Sr(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=Sr(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),s(5===h.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`)),s(5===d.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`)),s(5===f.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`)),null!=a&&s(p(o),(()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${a} but got pad ${o}.`));const m={dy:h,input:d,output:f},y={filterSize:i,strides:r,pad:o,dimRoundingMode:a},v=ze.runKernel("MaxPool3DGrad",m,y);return g?Sr(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),gh={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{filterSize:o,strides:a,pad:s,dimRoundingMode:l}=n;return{x:()=>fh(t,i,r,o,a,s,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mh=Ke({maxPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i,r,o,a){const l=Xe(t,"dy","maxPoolGrad"),u=Xe(e,"input","maxPoolGrad"),c=Xe(n,"output","maxPoolGrad");s(u.rank===l.rank,(()=>`Rank of input (${u.rank}) does not match rank of dy (${l.rank})`)),s(4===l.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),s(4===u.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`)),null!=a&&s(p(o),(()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${a} but got pad ${o}.`));const h={dy:l,input:u,output:c},d={filterSize:i,strides:r,pad:o,dimRoundingMode:a};return ze.runKernel("MaxPoolGrad",h,d)}}),yh={kernelName:"PadV2",inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:r}=n,o=r.map((t=>t[0]));return{x:()=>Dr(t,o,i.shape)}}},vh={kernelName:"SpaceToBatchND",gradFunc:(t,e,n)=>{const{blockShape:i,paddings:r}=n;return{x:()=>Nr(t,i,r)}}},xh={kernelName:"SplitV",gradFunc:(t,e,n)=>{const{axis:i}=n;return{x:()=>Ir(t,i)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bh=[cc,hc,dc,pc,fc,gc,mc,yc,vc,xc,bc,wc,kc,Cc,Ac,Ic,Mc,Dc,Tc,Ec,Nc,Oc,Rc,Fc,$c,Pc,zc,Bc,Vc,Wc,{kernelName:"RealDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{const e=Ki(t,$n(i,"float32")),o=so(n.shape,r);return o.length>0?Sr(Ho(e,o),n.shape):e},b:()=>{let e=Zi(t,$n(n,"float32"));const o=so(i.shape,r);o.length>0&&(e=Sr(Ho(e,o),i.shape));const a=va(i);return Vo(Ki(e,$n(a,"float32")))}}}},jc,Uc,Gc,Hc,qc,Yc,Xc,Kc,Zc,th,eh,nh,ih,rh,oh,ah,sh,lh,ch,dh,dh,ph,gh,{kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{filterSize:o,strides:a,pad:s}=n;return{x:()=>mh(t,i,r,o,a,s)}}},{kernelName:"Mean",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:r}=n,o=v(r,i.shape),a=h(Ko(i.shape,o)[1]);return{x:()=>{const e=i.shape.slice();o.forEach((t=>{e[t]=1}));const n=Sr(t,e);return Ki(Zi(n,pa(i.shape,"float32")),a)}}}},{kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{axis:r}=i,[o,a]=e,s=hh(t,a,o,v(r,o.shape));return{x:()=>s.x()}}},{kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>Zi(t,$n(Fo(n,i),"float32")),b:()=>Zi(t,$n(Ao(n,i),"float32"))}}},{kernelName:"MirrorPad",inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:r}=n,o=r.map((t=>t[0]));return{x:()=>Dr(t,o,i.shape)}}},{kernelName:tt,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{const e=so(n.shape,r);return e.length>0?Sr(Ho(t,e),n.shape):t},b:()=>{const e=Zi(t,Vo(So(Ki(n,i)))),o=so(i.shape,r);return o.length>0?Sr(Ho(e,o),i.shape):e}}}},{kernelName:"Multiply",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{const e=Zi(t,$n(i,"float32")),o=so(n.shape,r);return o.length>0?Sr(Ho(e,o),n.shape):e},b:()=>{const e=Zi(t,$n(n,"float32")),o=so(i.shape,r);return o.length>0?Sr(Ho(e,o),i.shape):e}}}},{kernelName:"Neg",gradFunc:t=>({x:()=>Vo(t)})},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>da(n.shape,"float32")}}},{kernelName:"OnesLike",gradFunc:t=>({x:()=>ho(t)})},{kernelName:"Pack",saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:i}=n;return Ws(t,i).map((t=>()=>t))}},yh,yh,{kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,i,r]=e,o=n,a=i,s=lo(o.shape,a.shape);return{a:()=>{const e=$n(a,"float32");let n=Zi(t,Zi(e,Na(o,Go(e,ds(1)))));const i=so(o.shape,s);return i.length>0&&(n=Ho(n,i)),Sr(n,o.shape)},b:()=>{const e=Ao(o,0),n=co(e,Lo(o),ho(o));let i=Zi(t,Zi(r,n));const l=so(a.shape,s);return l.length>0&&(i=Ho(i,l)),Sr(i,a.shape)}}}},{kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,i]=e,r=Ao(n,0);return{x:()=>co(r,t,Zi(t,i)),alpha:()=>{let e=co(r,ho(t),Zi(t,n));const o=so(i.shape,t.shape);return o.length>0&&(e=Ho(e,o)),Sr(e,i.shape)}}}},{kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Vo(va(n)))}}},{kernelName:"Relu6",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=Zi(Fo(n,6),Os(n));return{x:()=>Zi(t,$n(i,"float32"))}}},{kernelName:"Relu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,$n(Os(n),"float32"))}}},{kernelName:"Reshape",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Sr(t,n.shape)}}},{kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,r={dy:t,images:i};return{images:()=>ze.runKernel("ResizeBilinearGrad",r,n)}}},{kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,r={dy:t,images:i};return{images:()=>ze.runKernel("ResizeNearestNeighborGrad",r,n)}}},{kernelName:"Reverse",gradFunc:(t,e,n)=>{const{dims:i}=n,r=v(i,t.shape);return{x:()=>os(t,r)}}},{kernelName:"Round",gradFunc:t=>({x:()=>ho(t)})},{kernelName:"Rsqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Vo(Ki(t,Zi(Na(n,1.5),2)))}}},{kernelName:"Select",inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>$n(ho(n),"float32"),t:()=>Zi(t,$n(n,t.dtype)),e:()=>Zi(t,$n(ra(n),t.dtype))}}},{kernelName:"Selu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Ao(n,ds(0)),i=ds(1.7580993408473768),r=ds($u),o=Zi(t,r),a=Zi(Zi(t,i),vo($n(n,"float32")));return co(e,o,a)}}}},{kernelName:"Sigmoid",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,Zi(n,Go(ds(1),n)))}}},{kernelName:"Sign",gradFunc:t=>({x:()=>ho(t)})},{kernelName:et,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(Jr($n(n,"float32")),t)}}},{kernelName:"Sinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(Qr($n(n,"float32")),t)}}},{kernelName:"Slice",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{begin:r,size:o}=n,a=i.shape,[s,l]=Ti(i,r,o),u=[];for(let e=0;e<t.rank;e++)u.push([s[e],a[e]-s[e]-l[e]]);return{x:()=>Ca(t,u)}}},{kernelName:"Softmax",outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{dim:r}=n,o=Zi(t,i);return{logits:()=>Go(o,Zi(Ho(o,[r],true),i))}}},{kernelName:"Softplus",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,Mr(n))}}},vh,vh,xh,xh,{kernelName:"Sqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,Zi(Ds($n(n,"float32")),2))}}},{kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=ds(2);return{a:()=>Zi(t,Zi(r,Go(n,i))),b:()=>Zi(t,Zi(r,Go(i,n)))}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(t,Zi($n(n,"float32"),2))}}},{kernelName:"Step",gradFunc:t=>({x:()=>ho(t)})},{kernelName:nt,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=lo(n.shape,i.shape);return{a:()=>{let e=t;const i=so(n.shape,r);return i.length>0&&(e=Ho(e,i)),Sr(e,n.shape)},b:()=>{let e=t;const n=so(i.shape,r);return n.length>0&&(e=Ho(e,n)),Sr(Vo(e),i.shape)}}}},{kernelName:"Sum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,r=i.shape.slice(),{axis:o}=n;v(o,i.shape).forEach((t=>{r[t]=1}));const a=Sr(t,r),s=Zi(a,pa(i.shape,"float32"));return{x:()=>s}}},{kernelName:it,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,va(Jr(n)))}}},{kernelName:"Tanh",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zi(Go(ds(1),va(n)),t)}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{reps:r}=n;return{x:()=>{let e=ho(i);if(1===i.rank)for(let n=0;n<r[0];++n)e=Xi(e,Dr(t,[n*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(let n=0;n<r[0];++n)for(let o=0;o<r[1];++o)e=Xi(e,Dr(t,[n*i.shape[0],o*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(let n=0;n<r[0];++n)for(let o=0;o<r[1];++o)for(let a=0;a<r[2];++a)e=Xi(e,Dr(t,[n*i.shape[0],o*i.shape[1],a*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);for(let n=0;n<r[0];++n)for(let o=0;o<r[1];++o)for(let a=0;a<r[2];++a)for(let s=0;s<r[3];++s)e=Xi(e,Dr(t,[n*i.shape[0],o*i.shape[1],a*i.shape[2],s*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return e}}}},{kernelName:"Transpose",gradFunc:(t,e,n)=>{const i=n,{perm:r}=i,o=ta(r);return{x:()=>ei(t,o)}}},{kernelName:"Unpack",gradFunc:(t,e,n)=>{const i=n,{axis:r}=i;return{value:()=>Ns(t,r)}}},{kernelName:"UnsortedSegmentSum",inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=ca(e,ho(e)),i=Co(t,n);let r=Io(e,ds(0,"int32"));const o=i.rank-r.rank;for(let t=0;t<o;++t)r=xo(r,t+1);r=ia(r,pa(i.shape,"bool"));const a=ho(i);return co(r,i,a)}(t,n)}}},{kernelName:"ZerosLike",gradFunc:t=>({x:()=>ho(t)})}];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of bh)ct(t);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
let wh;function _h(){return null==wh&&(wh=qi().epsilon()),wh}ge().prototype.abs=function(){return this.throwIfDisposed(),Ji(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.acos=function(){return this.throwIfDisposed(),Qi(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.acosh=function(){return this.throwIfDisposed(),tr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.add=function(t){return this.throwIfDisposed(),Xi(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.all=function(t,e){return this.throwIfDisposed(),nr(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.any=function(t,e){return this.throwIfDisposed(),ir(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.argMax=function(t){return this.throwIfDisposed(),rr(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.argMin=function(t){return this.throwIfDisposed(),or(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.asScalar=function(){return this.throwIfDisposed(),s(1===this.size,(()=>"The array must have only 1 element.")),Sr(this,[])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.asType=function(t){return this.throwIfDisposed(),$n(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.as1D=function(){return this.throwIfDisposed(),Sr(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.as2D=function(t,e){return this.throwIfDisposed(),Sr(this,[t,e])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),Sr(this,[t,e,n])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.as4D=function(t,e,n,i){return this.throwIfDisposed(),Sr(this,[t,e,n,i])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.as5D=function(t,e,n,i,r){return this.throwIfDisposed(),Sr(this,[t,e,n,i,r])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.asin=function(){return this.throwIfDisposed(),ar(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.asinh=function(){return this.throwIfDisposed(),sr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.atan=function(){return this.throwIfDisposed(),lr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.atan2=function(t){return this.throwIfDisposed(),ur(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.atanh=function(){return this.throwIfDisposed(),cr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.avgPool=function(t,e,n,i){return this.throwIfDisposed(),Cr(this,t,e,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Nr(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.batchNorm=function(t,e,n,i,r){return this.throwIfDisposed(),Or(this,t,e,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Pr(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.cast=function(t){return this.throwIfDisposed(),$n(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.ceil=function(){return this.throwIfDisposed(),zr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Br(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof fe&&(t=[t]),Ir([this,...t],e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.conv1d=function(t,e,n,i,r,o){return this.throwIfDisposed(),Hr(this,t,e,n,i,r,o)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.conv2dTranspose=function(t,e,n,i,r){return this.throwIfDisposed(),Xr(this,t,e,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.conv2d=function(t,e,n,i,r,o){return this.throwIfDisposed(),Gr(this,t,e,n,i,r,o)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.cos=function(){return this.throwIfDisposed(),Jr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.cosh=function(){return this.throwIfDisposed(),Qr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),to(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),no(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.depthwiseConv2d=function(t,e,n,i,r,o){return this.throwIfDisposed(),io(this,t,e,n,i,r,o)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.dilation2d=function(t,e,n,i,r){return this.throwIfDisposed(),oo(this,t,e,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.divNoNan=function(t){return this.throwIfDisposed(),po(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.div=function(t){return this.throwIfDisposed(),Ki(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.dot=function(t){return this.throwIfDisposed(),fo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.elu=function(){return this.throwIfDisposed(),mo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.equal=function(t){return this.throwIfDisposed(),uo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.erf=function(){return this.throwIfDisposed(),yo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.exp=function(){return this.throwIfDisposed(),vo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.expandDims=function(t){return this.throwIfDisposed(),xo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.expm1=function(){return this.throwIfDisposed(),bo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.fft=function(){return this.throwIfDisposed(),Ss(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.flatten=function(){return this.throwIfDisposed(),Sr(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.floor=function(){return this.throwIfDisposed(),So(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.floorDiv=function(t){return this.throwIfDisposed(),Yi(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.gather=function(t,e){return this.throwIfDisposed(),Co(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Io(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.greater=function(t){return this.throwIfDisposed(),Ao(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.ifft=function(){return this.throwIfDisposed(),Cs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.irfft=function(){return this.throwIfDisposed(),As(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.isFinite=function(){return this.throwIfDisposed(),Do(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.isInf=function(){return this.throwIfDisposed(),To(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.isNaN=function(){return this.throwIfDisposed(),Eo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.leakyRelu=function(t){return this.throwIfDisposed(),No(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.lessEqual=function(t){return this.throwIfDisposed(),Fo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.less=function(t){return this.throwIfDisposed(),Oo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.localResponseNormalization=function(t,e,n,i){return this.throwIfDisposed(),Ro(this,t,e,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logSigmoid=function(){return this.throwIfDisposed(),jo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logSoftmax=function(t){return this.throwIfDisposed(),qo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),na(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.log=function(){return this.throwIfDisposed(),Lo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.log1p=function(){return this.throwIfDisposed(),$o(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ia(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logicalNot=function(){return this.throwIfDisposed(),ra(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logicalOr=function(t){return this.throwIfDisposed(),oa(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.logicalXor=function(t){return this.throwIfDisposed(),aa(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Qn(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.maxPool=function(t,e,n,i){return this.throwIfDisposed(),sa(this,t,e,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.max=function(t,e){return this.throwIfDisposed(),Uo(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.maximum=function(t){return this.throwIfDisposed(),ca(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.mean=function(t,e){return this.throwIfDisposed(),ha(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.min=function(t,e){return this.throwIfDisposed(),fa(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.minimum=function(t){return this.throwIfDisposed(),ga(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),ma(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.mod=function(t){return this.throwIfDisposed(),ya(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.mul=function(t){return this.throwIfDisposed(),Zi(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.neg=function(){return this.throwIfDisposed(),Vo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Xs(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.notEqual=function(t){return this.throwIfDisposed(),_a(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),ti(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.onesLike=function(){return this.throwIfDisposed(),ka(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.pad=function(t,e){return this.throwIfDisposed(),Ca(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.pool=function(t,e,n,i,r){return this.throwIfDisposed(),Ea(this,t,e,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.pow=function(t){return this.throwIfDisposed(),Na(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.prelu=function(t){return this.throwIfDisposed(),Oa(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.prod=function(t,e){return this.throwIfDisposed(),Fa(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.reciprocal=function(){return this.throwIfDisposed(),ns(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.relu=function(){return this.throwIfDisposed(),is(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.relu6=function(){return this.throwIfDisposed(),rs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.reshapeAs=function(t){return this.throwIfDisposed(),Sr(this,t.shape)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.reshape=function(t){return this.throwIfDisposed(),Sr(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),$l(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),Pl(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.reverse=function(t){return this.throwIfDisposed(),os(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.rfft=function(){return this.throwIfDisposed(),Ms(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.round=function(){return this.throwIfDisposed(),cs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.rsqrt=function(){return this.throwIfDisposed(),hs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.selu=function(){return this.throwIfDisposed(),ps(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.separableConv2d=function(t,e,n,i,r,o){return this.throwIfDisposed(),fs(this,t,e,n,i,r,o)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sigmoid=function(){return this.throwIfDisposed(),Mr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sign=function(){return this.throwIfDisposed(),ms(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sin=function(){return this.throwIfDisposed(),ys(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sinh=function(){return this.throwIfDisposed(),vs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.slice=function(t,e){return this.throwIfDisposed(),Dr(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.softmax=function(t){return this.throwIfDisposed(),ks(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.softplus=function(){return this.throwIfDisposed(),Wo(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Ta(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.split=function(t,e){return this.throwIfDisposed(),Is(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sqrt=function(){return this.throwIfDisposed(),Ds(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.square=function(){return this.throwIfDisposed(),va(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.squaredDifference=function(t){return this.throwIfDisposed(),Ts(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.squeeze=function(t){return this.throwIfDisposed(),Es(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof fe?[this,t]:[this,...t];return Ns(n,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.step=function(t){return this.throwIfDisposed(),Os(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.stridedSlice=function(t,e,n,i,r,o,a,s){return this.throwIfDisposed(),Fs(this,t,e,n,i,r,o,a,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sub=function(t){return this.throwIfDisposed(),Go(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.sum=function(t,e){return this.throwIfDisposed(),Ho(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.tan=function(){return this.throwIfDisposed(),Rs(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.tanh=function(){return this.throwIfDisposed(),Tr(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.tile=function(t){return this.throwIfDisposed(),wo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.toBool=function(){return this.throwIfDisposed(),$n(this,"bool")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.toFloat=function(){return this.throwIfDisposed(),$n(this,"float32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.toInt=function(){return this.throwIfDisposed(),$n(this,"int32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.topk=function(t,e){return this.throwIfDisposed(),Ps(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.transpose=function(t){return this.throwIfDisposed(),ei(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.unique=function(t){return this.throwIfDisposed(),Bs(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Vs(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.unstack=function(t){return this.throwIfDisposed(),Ws(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.where=function(t,e){return this.throwIfDisposed(),co(t,this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ge().prototype.zerosLike=function(){return this.throwIfDisposed(),ho(this)};
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class kh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,kh.prototype)}}class Sh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Sh.prototype)}}class Ch extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ch.prototype)}}class Ah extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ah.prototype)}}class Ih extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ih.prototype)}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mh(t,e){if(Array.isArray(t)){let n=[];for(let i=0;i<e;i++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function Dh(t,e){if(!t)throw new Ih(e)}function Th(t,e){let n=0;for(const i of t)i===e&&n++;return n}function Eh(t){return 1===t.length?t[0]:t}function Nh(t){return Array.isArray(t)?t:[t]}function Oh(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function Fh(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let Rh={};function Lh(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function $h(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>$h(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?$h(e):t[n]=e.value)}}}function Ph(t,e={},n={},i="object",r=!1){if("string"==typeof t){const r=t;let o;if(r in n)o=n[r];else if(r in Rh)o=Rh[r];else if(o=e[r],null==o)throw new Ch(`Unknown ${i}: ${t}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}{const o=t;if(null==o.className||null==o.config)throw new Ch(`${i}: Improper config format: ${JSON.stringify(o)}.\n'className' and 'config' must set.`);const a=o.className;let s,l;if(a in n?[s,l]=n[a]:a in Rh?[s,l]=Rh.className:a in e&&([s,l]=e[a]),null==s)throw new Ch(`Unknown ${i}: ${a}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const t={};for(const e of Object.keys(Rh))t[e]=Rh[e];for(const e of Object.keys(n))t[e]=n[e];o.config.customObjects=t;const e=Object.assign({},Rh);for(const t of Object.keys(n))Rh[t]=n[t];$h(o.config);const i=l(s,o.config,n,r);return Rh=Object.assign({},e),i}{const t=Object.assign({},Rh);for(const t of Object.keys(n))Rh[t]=n[t];const e=new s(o.config);return Rh=Object.assign({},t),e}}}function zh(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function Bh(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function Vh(t){if(null==t)throw new Ch(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Wh(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new Ch(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function jh(t,e,n=0,i=1/0){return Dh(n>=0),Dh(i>=n),Array.isArray(t)&&t.length>=n&&t.length<=i&&t.every((t=>typeof t===e))}function Uh(t,e){Array.isArray(t)?(s(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>Uh(t,`element ${n+1} of ${e}`)))):s(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${Gh(t)}.`))}function Gh(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>Gh(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function Hh(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qh(t,e){return ji((()=>Ds(Ho(Zi(t,t),e,!0))))}class Xh extends Oi{getConfig(){return{}}}class Yh extends Xh{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return ji((()=>{const e=qh(t,this.axis),n=Br(e,0,this.maxValue);return Zi(t,Ki(n,Xi(_h(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Yh.className="MaxNorm",Ri(Yh);class Kh extends Xh{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return ji((()=>Ki(t,Xi(_h(),qh(t,this.axis)))))}getConfig(){return{axis:this.axis}}}Kh.className="UnitNorm",Ri(Kh);class Zh extends Xh{apply(t){return is(t)}}Zh.className="NonNeg",Ri(Zh);class Jh extends Xh{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return ji((()=>{const e=qh(t,this.axis),n=Xi(Zi(this.rate,Br(e,this.minValue,this.maxValue)),Zi(1-this.rate,e));return Zi(t,Ki(n,Xi(_h(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Jh.className="MinMaxNorm",Ri(Jh);const Qh={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function td(t){return Lh(t)}function ed(t,e={}){return Ph(t,Fi.getMap().classNameMap,e,"constraint")}function nd(t){if(null==t)return null;if("string"==typeof t){return ed({className:t in Qh?Qh[t]:t,config:{}})}return t instanceof Xh?t:ed(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const id=["channelsFirst","channelsLast"],rd=["nearest","bilinear"],od=["valid","same","causal"],ad=["max","avg"],sd=["sum","mul","concat","ave"],ld=new Map;function ud(t){Wh(id,"DataFormat",t)}function cd(t){Wh(od,"PaddingMode",t)}function hd(t){Wh(ad,"PoolMode",t)}const dd=[];function pd(t,e){dd.push(t);try{const t=e();return dd.pop(),t}catch(t){throw dd.pop(),t}}function fd(t){if(!yd(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===dd.length?"":dd.join("/")+"/")+t}function gd(t){if(!yd(t))throw new Error("Not a valid tensor name: '"+t+"'");ld.has(t)||ld.set(t,0);const e=ld.get(t);if(ld.set(t,ld.get(t)+1),e>0){const n=`${t}_${e}`;return ld.set(n,1),n}return t}const md=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yd(t){return!!t.match(md)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vd(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let i=1;for(let r=e;r<n;++r)i*=t[r];return i}function xd(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i<e&&(e=i)}return e}function bd(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i>e&&(e=i)}return e}function wd(t,e){if(e<t)throw new Ch(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let i=t;i<e;++i)n.push(i);return n}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _d(t,e){return t.asType(e)}function kd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function Sd(t,e,n){return ji((()=>{switch(t.rank){case 1:return xs(t,e,n);case 2:return bs(t,[e,0],[n,t.shape[1]]);case 3:return ws(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return _s(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Dr(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Dr(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new Ch(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Cd(t,e,n){return ji((()=>{switch(t.rank){case 1:return xs(t,e,n);case 2:return bs(t,[0,e],[t.shape[0],n]);case 3:return ws(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return _s(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new Ch(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Ad(t,e,n,i){return ji((()=>{switch(t.rank){case 1:return xs(t,e,n);case 2:switch(i){case 1:return Sd(t,e,n);case 2:return Cd(t,e,n);default:throw new Ch(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return Sd(t,e,n);case 2:return ws(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Cd(t,e,n);default:throw new Ch(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return Sd(t,e,n);case 2:return _s(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return _s(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Cd(t,e,n);default:throw new Ch(`The axis is not within the rank of the tensor ${i}`)}default:throw new Ch(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Id(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),Ir(t,e)}function Md(t,e){switch(t.rank){case 1:return Vr([t,e]);case 2:return Wr([t,e],0);case 3:return jr([t,e],0);case 4:return Ur([t,e],0);default:throw new Ch(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Dd(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new Ch(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return wo(t,e)}function Td(t,e=0,n=1,i,r){return Ja(t,e,n,i,r)}function Ed(t,e,n,i){if(t.rank<2||e.rank<2)throw new Ah(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){if(t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new Ah(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){return dl({a:t,b:e,transposeA:!1,transposeB:!1,bias:i?Fd(t.rank,i,"channelsLast"):null,activation:n})}{const r=t.shape.slice(),o=r.pop();t=t.reshape([-1,o]);const a=e.shape.slice(),s=a.pop(),l=a.pop(),u=[...a,s],c=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=e.transpose(c).reshape([l,-1]);const h=[...r,...u];return dl({a:t,b:e,transposeA:!1,transposeB:!1,bias:i?Fd(t.rank,i,"channelsLast"):null,activation:n}).reshape(h)}}function Nd(t,e,n){return ji((()=>(e=Array.isArray(e)?Ls(e,"int32"):e.toInt(),Co(t,e,n))))}function Od(t){return Zi(t,t)}function Fd(t,e,n){const i=e.shape;if(1!==e.rank&&e.rank!==t)throw new Ch(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===i.length?e.reshape([1,i[0],1,1,1]):e.reshape([1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?e.reshape([1,1,1,1,i[0]]):e.reshape([1].concat(i))}else if(4===t){if("channelsFirst"===n)return 1===i.length?e.reshape([1,i[0],1,1]):e.reshape([1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?e.reshape([1,1,1,i[0]]):e.reshape([1].concat(i))}else if(3===t){if("channelsFirst"===n)return 1===i.length?e.reshape([1,i[0],1]):e.reshape([1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?e.reshape([1,1,i[0]]):e.reshape([1].concat(i))}else if(t<3)return e;throw new Ch(`Unsupported input rank by biasAdd: ${e.rank}`)}function Rd(t,e,n){return ji((()=>(null==n&&(n="channelsLast"),ud(n),t.add(Fd(t.rank,e,n)))))}function Ld(t,e,n,i){return ji((()=>Qs(t,e,n,i)))}function $d(t,e,n=!1){return n?t():e()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Pd=["fanIn","fanOut","fanAvg"],zd=["normal","uniform","truncatedNormal"];class Bd extends Oi{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Vd extends Bd{apply(t,e){return da(t,e)}}Vd.className="Zeros",Ri(Vd);class Wd extends Bd{apply(t,e){return pa(t,e)}}Wd.className="Ones",Ri(Wd);class jd extends Bd{constructor(t){if(super(),"object"!=typeof t)throw new Ch(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new Ch(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return ji((()=>Zi(ds(this.value),pa(t,e))))}getConfig(){return{value:this.value}}}jd.className="Constant",Ri(jd);class Ud extends Bd{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Qa(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Ud.className="RandomUniform",Ri(Ud);class Gd extends Bd{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Ah(`randomNormal does not support dType ${e}.`);return Td(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Gd.className="RandomNormal",Ri(Gd);class Hd extends Bd{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Ah(`truncatedNormal does not support dType ${e}.`);return zs(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Hd.className="TruncatedNormal",Ri(Hd);class qd extends Bd{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return ji((()=>{if(2!==t.length||t[0]!==t[1])throw new Ch("Identity matrix initializer can only be used for 2D square matrices.");return Zi(this.gain,_o(t[0]))}))}getConfig(){return{gain:this.gain}}}qd.className="Identity",Ri(qd);class Xd extends Bd{constructor(t){if(super(),t.scale<0)throw new Ch(`scale must be a positive float. Got: ${t.scale}`);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,Wh(Pd,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){Wh(zd,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,i;if(ud(e),2===t.length)n=t[0],i=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=vd(t,2);n=t[1]*e,i=t[0]*e}else if("channelsLast"===e){const e=vd(t,0,t.length-2);n=t[t.length-2]*e,i=t[t.length-1]*e}}else{const e=vd(t);n=Math.sqrt(e),i=Math.sqrt(e)}return[n,i]}(t),i=n[0],r=n[1];let o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,i):"fanOut"===this.mode?o/=Math.max(1,r):o/=Math.max(1,(i+r)/2),"normal"===this.distribution){const n=Math.sqrt(o);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Ah(`${this.getClassName()} does not support dType ${e}.`);return zs(t,0,n,e,this.seed)}{const n=Math.sqrt(3*o);return Qa(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Xd.className="VarianceScaling",Ri(Xd);class Yd extends Xd{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}Yd.className="GlorotUniform",Ri(Yd);class Kd extends Xd{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}Kd.className="GlorotNormal",Ri(Kd);class Zd extends Xd{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}Zd.className="HeNormal",Ri(Zd);class Jd extends Xd{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}Jd.className="HeUniform",Ri(Jd);class Qd extends Xd{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}Qd.className="LeCunNormal",Ri(Qd);class tp extends Xd{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Xd.className}}tp.className="LeCunNormal",Ri(tp);class ep extends Bd{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new Ah("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return ji((()=>{if(t.length<2)throw new Ah("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=Td(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32");let n=du.gramSchmidt(e);return t[0]>t[1]&&(n=n.transpose()),Zi(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}ep.className="Orthogonal",Ri(ep);const np={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ip(t,e={}){return Ph(t,Fi.getMap().classNameMap,e,"initializer")}function rp(t){return Lh(t)}function op(t){if("string"==typeof t){const e=t in np?np[t]:t;if("GlorotNormal"===e)return new Kd;if("GlorotUniform"===e)return new Yd;if("HeNormal"===e)return new Zd;if("HeUniform"===e)return new Jd;if("LeCunNormal"===e)return new Qd;if("LeCunUniform"===e)return new tp;{const t={};return t.className=e,t.config={},ip(t)}}return t instanceof Bd?t:ip(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ap=0;function sp(){return ap++}const lp={};function up(t=""){return t in lp||(lp[t]=0),lp[t]+=1,t+lp[t].toString()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cp(t){return Array.isArray(t)&&Array.isArray(t[0])}function hp(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function dp(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new Ch(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function pp(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new Ch(`Expected exactly 1 Shape; got ${t.length}`)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fp(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gp{constructor(t,e="float32",n="Variable",i=!0,r=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=sp(),n=null==n?"Variable":n,this.originalName=fd(n),this.name=gd(this.originalName),this.trainable_=i,this.constraint=r,this.val=js(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function mp(t){return t.map((t=>t.read()))}function yp(t){t.forEach((t=>{t[0].write(t[1])}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vp{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class xp{constructor(t,e,n,i,r,o,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=sp(),null!=o&&(this.originalName=fd(o),this.name=gd(this.originalName)),this.rank=e.length}}let bp=0;class wp{constructor(t,e){this.callArgs=e,this.id=bp++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const e of t.inboundLayers)null!=e&&e.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let _p=0;class kp extends Oi{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=_p++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=Oh(t)+"_"+up(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new Sh(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new Ch(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Eh(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Eh(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new kh(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new kh(`Layer ${this.name} is not connected, no input to return.`);return Eh(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new kh(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new kh(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Eh(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=Nh(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=Nh(this.inputSpec);if(t.length!==e.length)throw new Ch(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const i=t[n],r=e[n];if(null==r)continue;const o=i.rank;if(null!=r.ndim&&o!==r.ndim)throw new Ch(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${r.ndim}, found ndim=${o}`);if(null!=r.maxNDim&&o>r.maxNDim)throw new Ch(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${r.maxNDim}, found ndim=${o}`);if(null!=r.minNDim&&o<r.minNDim)throw new Ch(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${r.minNDim}, found ndim=${o}.`);if(null!=r.dtype&&i.dtype!==r.dtype)throw new Ch(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${r.dtype}, found dtype=${i.dtype}.`);if(r.axes){const t=i.shape;for(const e in r.axes){const i=Number(e),o=r.axes[e],a=i>=0?t[i]:t[t.length+i];if(null!=o&&-1===[o,null].indexOf(a))throw new Ch(`Input ${n} is incompatible with layer ${this.name}: expected axis ${i} of input shape to have value ${o} but got shape ${t}.`)}}if(null!=r.shape)for(let t=0;t<r.shape.length;++t){const e=r.shape[t],o=i.shape[t];if(null!=e&&null!=o&&e!==o)throw new Ch(`Input ${n} is incompatible with layer ${this.name}: expected shape=${r.shape}, found shape=${i.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=Nh(t);let i=!0;for(const t of n)if(!(t instanceof xp)){i=!1;break}let r=!0;for(const t of n)if(t instanceof xp){r=!1;break}if(i===r)throw new Ch("Arguments to apply() must be all SymbolicTensors or all Tensors");return pd(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of Nh(t))e.push(n.shape);this.build(Eh(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&r&&(this._refCount=1)}if(this.assertInputCompatibility(t),r){let i=this.call(t,e);const r=Nh(i),o=[];for(let t of r)-1!==n.indexOf(t)&&(t=t.clone()),o.push(t);if(i=Eh(o),null!=this.activityRegularizer)throw new Ah("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}{const n=function(t){t=Nh(t);const e=[];for(const n of t)e.push(n.shape);return Eh(e)}(t),i=this.computeOutputShape(n);let r;const o="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),r=null!=i&&i.length>0&&Array.isArray(i[0])?i.map(((n,i)=>new xp(o,n,this,Nh(t),e,this.name,i))):new xp(o,i,this,Nh(t),e,this.name),this.addInboundNode(t,r,null,null,n,i,e),this._refCount++,null!=this.activityRegularizer)throw new Ah("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,i)=>{null!=n&&null!=t[i]&&t[i]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new kh(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new kh(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Sh(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return fp(this.weights)}build(t){this.built=!0}getWeights(t=!1){return mp(t?this.trainableWeights:this.weights)}setWeights(t){ji((()=>{const e=this.weights;if(e.length!==t.length)throw new Ch(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],i=mp(e);for(let r=0;r<i.length;++r){const o=i[r],a=e[r],s=t[r];if(!d(o.shape,s.shape))throw new Ch(`Layer weight shape ${o.shape} not compatible with provided weight shape ${s.shape}`);n.push([a,s])}yp(n)}))}addWeight(t,e,n,i,r,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new Ch(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(i=op("zeros"));const s=i.apply(e,n),l=new gp(s,n,t,o,a);return s.dispose(),null!=r&&this.addLoss((()=>r.apply(l.read()))),null==o&&(o=!0),o?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=Nh(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,i,r,o,a=null){const s=Nh(t);e=Nh(e),n=Nh(n),i=Nh(i),r=hp(r),o=hp(o);const l=[],u=[],c=[];for(const t of s)l.push(t.sourceLayer),u.push(t.nodeIndex),c.push(t.tensorIndex);new wp({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:o},a);for(let t=0;t<e.length;t++)e[t].sourceLayer=this,e[t].nodeIndex=this.inboundNodes.length-1,e[t].tensorIndex=t}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Sp(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const i=Sp(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of i)-1===e.indexOf(t)&&e.push(t)}return e}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Cp extends kp{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:up("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new Ch("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new Ch("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new Ch("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const i=new xp(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new wp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new Ch(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
async function Ap(t){if(null==t)return;const e=[],n=[],i=[];for(const r in t){const o=t[r];if("number"!=typeof o){const t=o;e.push(t.data()),n.push(r),i.push(t)}}if(e.length>0){const r=await Promise.all(e);for(let e=0;e<r.length;++e)t[n[e]]=r[e][0];Ui(i)}}function Ip(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Mp,Dp;Cp.className="InputLayer",Ri(Cp),(Dp=Mp||(Mp={}))[Dp.SILENT=0]="SILENT",Dp[Dp.VERBOSE=1]="VERBOSE";class Tp{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class Ep{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class Np extends Tp{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const t in e){const i=e[t];if("number"==typeof i)this.totals.hasOwnProperty(t)||(this.totals[t]=0),this.totals[t]=this.totals[t]+i*n;else{let e;t in this.totals?e=this.totals[t]:this.totals[t]=0;const r=ji((()=>Xi(this.totals[t],Zi(i,n))));this.totals[t]=r,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const t of this.params.metrics)null!=this.totals[t]&&("number"==typeof this.totals[t]?e[t]=this.totals[t]/this.seen:ji((()=>{const n=Zi(Ki(1,this.seen),this.totals[t]);e[t]=n,this.totals[t].dispose(),Gi(e[t])})))}}class Op extends Tp{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const t in e)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(e[t])}async syncData(){const t=[],e=[],n=[];for(const i in this.history){const r=this.history[i];for(let o=0;o<r.length;++o)if("number"!=typeof r[o]){const a=r[o];t.push(a.data()),e.push(i),n.push(o)}}const i=await Promise.all(t);for(let t=0;t<i.length;++t){this.history[e[t]][n[t]].dispose(),this.history[e[t]][n[t]]=i[t][0]}}}class Fp extends Tp{constructor(t,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");T(this.yieldEvery)&&(this.maybeWait=function(t,e){let n,i=Qt();return(...r)=>{const o=Qt();return o-i<e||(i=o,n=t(...r)),n}}(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const i=[];null!=this.yield&&(await Ap(n),i.push(this.yield(t,e,n))),i.push(Iu()),await Promise.all(i)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await Ap(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await Ap(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(Iu()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await Ap(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await Ap(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(Iu()):T(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await Ap(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await Ap(t),await this.trainEnd(t))}}function Rp(t,e){if(null==t&&(t={}),t instanceof Tp)return[t];if(Array.isArray(t)&&t[0]instanceof Tp)return t;return Nh(t).map((t=>new Fp(t,e)))}class Lp{constructor(){}static registerCallbackConstructor(t,e){s(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),Lp.checkForDuplicate(e),null==Lp.constructors[t]&&(Lp.constructors[t]=[]),Lp.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Lp.constructors){Lp.constructors[+e].forEach((e=>{if(e===t)throw new Ch("Duplicate callback constructor.")}))}}static clear(){Lp.constructors={}}static createCallbacks(t){const e=[];for(const n in Lp.constructors){const i=+n;t>=i&&e.push(...Lp.constructors[i])}return e.map((t=>new t))}}function $p(t,e,n,i,r,o,a,s,l){const u=new Op,c=[new Np,...Lp.createCallbacks(e)];null!=t&&c.push(...t),c.push(u);const h=new Ep(c);return h.setParams({epochs:n,initialEpoch:i,samples:r,steps:o,batchSize:a,verbose:e,doValidation:s,metrics:l}),{callbackList:h,history:u}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pp(t,e={},n=!1){return Ph(t,Fi.getMap().classNameMap,e,"layer",n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zp(t,e){return ji((()=>{"float32"!==t.dtype&&(t=t.asType("float32"));const n=Ho(Od(t),e,!0),i=ko(n.shape,_h()),r=Ds(ca(n,i));return Ki(t,r)}))}function Bp(t,e){return ji((()=>ha(Od(Go(e,t)),-1)))}function Vp(t,e){return ji((()=>ha(Ji(Go(e,t)),-1)))}function Wp(t,e){return ji((()=>{const n=Go(t,e),i=Br(Ji(t),_h(),Number.MAX_VALUE),r=Ji(Ki(n,i));return Zi(100,ha(r,-1))}))}function jp(t,e,n=!1){return ji((()=>{if(n)e=ks(e);else{const t=Ho(e,e.shape.length-1,!0);e=Ki(e,t)}return e=Br(e,_h(),1-_h()),Vo(Ho(Zi(t.toFloat(),Lo(e)),e.shape.length-1))}))}function Up(t,e,n=!1){return ji((()=>{const i=So(function(t){const e=[vd(t.shape)];return t.reshape(e)}(t)).toInt(),r=(e=Br(e,_h(),1-_h())).shape;return jp(ti(i,r[r.length-1]).reshape(r),e,n)}))}function Gp(t,e){return ji((()=>{let n;return n=Br(e,_h(),1-_h()),n=Lo(Ki(n,Go(1,n))),ha(function(t,e){if(!d(t.shape,e.shape))throw new Ch(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return ji((()=>{const n=e.relu(),i=e.abs().neg();return n.sub(e.mul(t)).add(i.exp().log1p())}))}(t,n),-1)}))}function Hp(t,e){return ji((()=>{const n=zp(t,-1),i=zp(e,-1),r=Zi(n,i);return Vo(Ho(r,-1))}))}Lp.constructors={};const qp={meanSquaredError:Bp,meanAbsoluteError:Vp,meanAbsolutePercentageError:Wp,meanSquaredLogarithmicError:function(t,e){return ji((()=>{const n=Br(e,_h(),Number.MAX_VALUE),i=Lo(Xi(1,n)),r=Br(t,_h(),Number.MAX_VALUE),o=Lo(Xi(1,r));return ha(Od(Go(i,o)),-1)}))},squaredHinge:function(t,e){return ji((()=>{const n=ca(0,Go(1,Zi(t,e)));return ha(Od(n),-1)}))},hinge:function(t,e){return ji((()=>{const n=ca(0,Go(1,Zi(t,e)));return ha(n,-1)}))},categoricalHinge:function(t,e){return ji((()=>{const n=Ho(Zi(t,e),-1),i=Uo(Zi(Go(1,t),e),-1);return ca(0,Xi(1,Go(i,n)))}))},logcosh:function(t,e){return ji((()=>{const n=Math.log(2),i=Go(e,t),r=Go(Xi(i,Wo(Zi(-2,i))),n);return ha(r,-1)}))},categoricalCrossentropy:jp,sparseCategoricalCrossentropy:Up,binaryCrossentropy:Gp,kullbackLeiblerDivergence:function(t,e){return ji((()=>{const n=Br(t,_h(),1),i=Br(e,_h(),1);return Ho(Zi(t,Lo(Ki(n,i))),-1)}))},poisson:function(t,e){return ji((()=>{const n=Lo(Xi(_h(),e));return ha(Go(e,Zi(t,n)),-1)}))},cosineProximity:Hp};function Xp(t){if("string"==typeof t){if(t in qp)return qp[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Ch(e)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yp(t,e){return ji((()=>{const n=Zi(.5,ka(e)),i=_d(Ao(e,n),t.dtype);return ha(uo(t,i),-1)}))}function Kp(t,e){return ji((()=>_d(uo(rr(t,-1),rr(e,-1)),"float32")))}function Zp(t,e){return Gp(t,e)}function Jp(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),(e=e.argMax(-1)).dtype!==t.dtype&&(e=e.asType(t.dtype)),uo(t,e).asType("float32")}const Qp=jp,tf=Up,ef={binaryAccuracy:Yp,categoricalAccuracy:Kp,precision:function(t,e){return ji((()=>{const n=function(t,e){return ji((()=>ia(t.equal(1),e.equal(1)).sum().cast("float32")))}(t,e),i=function(t,e){return ji((()=>ia(t.equal(0),e.equal(1)).sum().cast("float32")))}(t,e),r=n.add(i);return co(Ao(r,0),n.div(r),0).cast("float32")}))},categoricalCrossentropy:Qp,sparseCategoricalCrossentropy:tf,mse:Bp,MSE:Bp,mae:Vp,MAE:Vp,mape:Wp,MAPE:Wp,cosine:Hp};function nf(t){if("string"==typeof t&&t in ef)return ef[t];if("string"!=typeof t&&null!=t)return t;throw new Ch(`Unknown metric ${t}`)}function rf(t){if(Dh(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(qp))if(qp[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(ef))if(ef[n]===t){e=n;break}return void 0!==e?e:t.name}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function of(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!af(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function af(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!af(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!af(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sf(t,e,n,i=console.log){const r=function(t){let e=!0;const n=[],i=[];for(const e in t.nodesByDepth)n.push(t.nodesByDepth[e]);for(const t of n){if(t.length>1||1===t.length&&t[0].inboundLayers.length>1){e=!1;break}i.push(...t)}if(e)for(const n of t.layers){let t=!1;for(const r of n.inboundNodes)if(-1!==i.indexOf(r)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),o=["Layer (type)","Output shape","Param #"];let a;if(r?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!r){o.push("Receives inputs"),a=[];for(const e in t.nodesByDepth)a.push(...t.nodesByDepth[e])}i("_".repeat(e)),lf(o,n,i),i("=".repeat(e));const s=t.layers;for(let t=0;t<s.length;++t)r?uf(s[t],n,i):cf(s[t],n,a,i),i((t===s.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=function(t){let e;e=null!=t.collectedTrainableWeights?fp(t.collectedTrainableWeights):fp(t.trainableWeights);return e}(t),u=fp(t.nonTrainableWeights);i(`Total params: ${l+u}`),i(`Trainable params: ${l}`),i(`Non-trainable params: ${u}`),i("_".repeat(e))}function lf(t,e,n=console.log){let i="";for(let n=0;n<t.length;++n)n>0&&(i=i.slice(0,i.length-1)+" "),i+=t[n],i=i.slice(0,e[n]),i+=" ".repeat(e[n]-i.length);n(i)}function uf(t,e,n){let i;try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}lf([`${t.name} (${t.getClassName()})`,i,t.countParams().toString()],e,n)}function cf(t,e,n,i){let r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}const o=[];for(const e of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(e)))for(let t=0;t<e.inboundLayers.length;++t){const n=e.inboundLayers[t].name,i=e.nodeIndices[t],r=e.tensorIndices[t];o.push(`${n}[${i}][${r}]`)}const a=t.name,s=t.getClassName(),l=0===o.length?"":o[0];lf([`${a} (${s})`,r,t.countParams().toString(),l],e,i);for(let t=1;t<o.length;++t)lf(["","","",o[t]],e,i)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hf(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function df(t,e){if(null===t)return null;if("string"==typeof t)return Fh(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],i=t.length;for(let r=0;r<i;++r){const i=t[r];hf(e,r,i)?n.push(i):n.push(df(i,e))}return n}{const e={};for(const n of Object.keys(t)){const i=t[n];if("name"===n&&"string"==typeof i)e[n]=i;else{const t=Fh(n);e[t]=df(i,t)}}return e}}function pf(t,e){if(null==t)return null;if("string"==typeof t)return Oh(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],i=t.length;for(let r=0;r<i;++r){const i=t[r];hf(e,r,i)?n.push(i):n.push(pf(i,e))}return n}{const e={};for(const n of Object.keys(t)){const i=t[n],r=Oh(n);e[r]="name"!==n&&"className"!==n||"string"!=typeof i?pf(i,n):i}return e}}
/** @license See the LICENSE file. */class ff{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof ff)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new Ch(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return $n(e,t.dtype)}catch(n){throw new Ch(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof xp){if(null==this.id2Value[t.id])throw new Ch(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new Ch(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof xp){if(null==this.id2Value[t.id])throw new Ch(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new Ch(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&Ui(this.id2Mask)}}const gf={},mf={};function yf(t,e,n,i){const r=null!=n&&n.training,o=Array.isArray(t),a=o?t:[t],l=a.map((t=>t.name)),u=[],c=e.names();for(const t of l)-1!==c.indexOf(t)?u.push(e.getValue(t)):u.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const h=l.join(",")+"|"+e.names().join(",");let d,p;if(null==gf[h]){const t=function(t,e){s(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],i={};if(1===t.length){const r=xf(t[0],e);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const o of t){const{sorted:t,recipientMap:a}=xf(o,e);for(const e of t)r.has(e.name)||(n.push(e),r.add(e.name));for(const t in a)null==i[t]&&(i[t]=new Set),a[t].forEach((e=>i[t].add(e)))}}return{sorted:n,recipientCounts:vf(i)}}(a,e);d=t.sorted,p=t.recipientCounts,gf[h]=d,mf[h]=p}d=gf[h],p={},r||Object.assign(p,mf[h]);const f=new ff(e);for(let t=0;t<d.length;++t){if(null!=i){const t=Wi().numTensors;t>i.maxNumTensors&&(i.maxNumTensors=t),t<i.minNumTensors&&(i.minNumTensors=t)}const o=d[t],a=o.sourceLayer;if(a instanceof Cp)continue;const s=[],c=[],h=[];let g=!1;for(const t of o.inputs){const n=f.getValue(t),i=f.getMask(t);s.push(n),c.push(i),null!=i&&(g=!0),r||(p[t.name]--,0!==p[t.name]||e.hasKey(t)||-1!==l.indexOf(t.name)||n.isDisposed||!0===t.sourceLayer.stateful||h.push(n))}g&&((n=n||{}).mask=c[0]);const m=Nh(a.apply(s,n));let y=null;a.supportsMasking&&(y=a.computeMask(s,c));const v=bf(o),x=Array.isArray(v)?v:[v];for(let t=0;t<x.length;++t){f.hasKey(x[t])||f.add(x[t],m[t],Array.isArray(y)?y[0]:y);const e=l.indexOf(x[t].name);-1!==e&&(u[e]=m[t])}r||Ui(h)}return f.disposeMasks(),o?u:u[0]}function vf(t){const e={};for(const n in t)e[n]=t[n].size;return e}function xf(t,e){const n=new Set,i=[],r={};for(const t of e.names())n.add(t);const o=[],a=[];for(o.push(t);o.length>0;){const t=o[o.length-1];if(n.has(t.name)){o.pop();continue}const e=a[a.length-1]===o.length-1;if(0===t.inputs.length||e)o.pop(),i.push(t),n.add(t.name),e&&a.pop();else{a.push(o.length-1);for(const e of t.inputs)null==r[e.name]&&(r[e.name]=new Set),r[e.name].add(t.name),n.has(e.name)||o.push(e)}}return{sorted:i,recipientMap:r}}function bf(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const i of t.sourceLayer.inboundNodes[e].outputTensors)if(i.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wf extends kp{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=up(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Bh(this.inputs).length!==this.inputs.length)throw new Ch(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);Bh(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const t of this.outputs){const e=t.sourceLayer,n=t.nodeIndex,i=t.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(i)}for(const t of this.inputs){const e=t.sourceLayer,n=t.nodeIndex,i=t.tensorIndex;Dh(0===n,"input layer has >1 nodes"),Dh(0===i,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(i)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e];if(!(n instanceof Cp))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${e} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const t of this.outputLayers)this.outputNames.push(t.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},i={},r={},o={},a=[],s=(t,e,n,i,r,l)=>{null!=i&&null!=r&&null!=l||(i=t.sourceLayer,r=t.nodeIndex,l=t.tensorIndex);const u=i.inboundNodes[r];if(-1!==n.indexOf(u))throw new Sh(`The tensor ${t.name} at layer "${i.name}" is part of a cycle.`);if(-1!==e.indexOf(u))return;this.containerNodes.add(wf.nodeKey(i,r)),i.id in o||(o[i.id]=Object.keys(o).length),-1===n.indexOf(u)&&n.push(u);const c=u.inboundLayers.length;for(let t=0;t<c;t++){const i=u.inputTensors[t],r=u.inboundLayers[t],o=u.nodeIndices[t],a=u.tensorIndices[t];s(i,e,n,r,o,a)}for(e.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);a.push(u)},l=[],u=[];for(const t of this.outputs)s(t,l,u);const c=a.slice().reverse();for(const t of c){n[t.id]=t,t.id in e||(e[t.id]=0);let o=e[t.id];const a=null==i[t.outboundLayer.id]?0:i[t.outboundLayer.id];o=Math.max(o,a),i[t.outboundLayer.id]=o,r[t.outboundLayer.id]=t.outboundLayer,e[t.id]=o;for(let i=0;i<t.inboundLayers.length;i++){const r=t.inboundLayers[i],a=t.nodeIndices[i],s=r.inboundNodes[a],l=null==e[s.id]?0:e[s.id];e[s.id]=Math.max(o+1,l),n[s.id]=s}}const h={};for(const t in e){const i=e[t];i in h||(h[i]=[]),h[i].push(n[t])}const d={};for(const t in i){const e=i[t];e in d||(d[e]=[]),d[e].push(r[t])}let p=Object.keys(d).map((t=>parseInt(t,10))).sort(zh);this.layers=[];for(const t of p){const e=d[t];e.sort(((t,e)=>{const n=o[t.id],i=o[e.id];return n<i?-1:n>i?1:0}));for(const t of e)t instanceof wf&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map((t=>parseInt(t,10))).sort(zh);const f=this.inputs.slice(),g=[];for(const t of p)for(const e of h[t]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new Sh(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${g}`);for(const t of e.outputTensors)f.push(t);g.push(t.name)}}this.nodesByDepth=h;const m=this.layers.map((t=>t.name));for(const t of m){const e=m.filter((e=>e===t)).length;if(1!==e)throw new Sh(`The name "${t}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new wp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new Ch("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let i=0;for(const t of this.layers)for(const e of t.weights){if(null!=n[e.originalName])throw new Ch(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,i++}const r=[];for(const i in t){let o=i;if(null==n[i]){const t=i.split("/");o=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[o])r.push([n[o],t[i]]);else if(e)throw new Ch(`Provided weight data has no target variable: ${i}`);delete n[o]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new Ch(`${t.length} of ${i} weights are not set: ${t}`)}yp(r)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 3.7.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=pf(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return ji((()=>{t=Nh(t);const n=new ff;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return yf(this.outputs,n,e)}))}computeMask(t,e){return ji((()=>{let n;return t=Nh(t),n=null==e?Mh(null,t.length):Nh(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=hp(t);if(e.length!==this.inputLayers.length)throw new Ch(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let t=0;t<e.length;t++){const i=this.inputLayers[t],r=e[t];n[i.name+"_0_0"]=r}const i=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(zh);if(i.length>1)for(const t of i){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(e.id))continue;const i=[];for(let e=0;e<t.inboundLayers.length;e++){const r=t.inboundLayers[e],o=t.nodeIndices[e],a=t.tensorIndices[e],s=n[`${r.name}_${o}_${a}`];i.push(s)}const r=hp(e.computeOutputShape(Eh(i))),o=e.inboundNodes.indexOf(t);for(let t=0;t<r.length;t++){n[`${e.name}_${o}_${t}`]=r[t]}}}const r=[],o=[];for(let t=0;t<this.outputLayers.length;t++){const e=this.outputLayers[t],n=this.outputLayersNodeIndices[t],i=this.outputLayersTensorIndices[t],r=`${e.name}_${n}_${i}`;o.push(r)}for(let t=0;t<o.length;t++){const e=o[t];Dh(e in n),r.push(n[e])}return Eh(r)}runInternalGraph(t,e){null==e&&(e=Mh(null,t.length));const n={};for(let i=0;i<this.inputs.length;++i){const r=this.inputs[i],o=t[i],a=e[i];n[r.id]=[o,a]}const i=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(zh);for(const t of i){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer,i=t.inputTensors,r=t.outputTensors,o=new Array;for(const t of i)t.id in n&&o.push(n[t.id]);if(o.length===i.length){let i,a,s,l,u={};if(null!=t.callArgs&&(u=t.callArgs),1===o.length){const[t,n]=o[0];null==u.mask&&(u.mask=n),s=Nh(e.call(t,u)),l=Nh(e.computeMask(t,n)),i=[t],a=[n]}else i=o.map((t=>t[0])),a=o.map((t=>t[1])),null==u.mask&&(u.mask=a),s=Nh(e.call(i,u)),l=Nh(e.computeMask(i,a));if(e.activityRegularizer)throw new Ah("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<r.length;++t){const e=r[t],i=s[t],o=l[t];n[e.id]=[i,o]}}}}const r=[],o=[],a=[];for(const t of this.outputs){Dh(t.id in n,`Could not compute output ${t.name} : ${t.id}`);const[e,i]=n[t.id];a.push(e.shape),r.push(e),o.push(i)}return[r,o,a]}buildNodeConversionMap(t){const e={};let n;for(const t of this.layers){n=t instanceof wf?1:0;for(let i=0;i<t.inboundNodes.length;i++){const r=wf.nodeKey(t,i);this.containerNodes.has(r)&&(e[r]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new Ch(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new Ch("Provide either a layer name or layer index");for(const e of this.layers)if(e.name===t)return e;throw new Ch(`No such layer: ${t}`)}calculateLosses(){return ji((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const i=wf.nodeKey(e,n);this.containerNodes.has(i)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const t of this.layers){const i=t.getClassName(),r=t.getConfig(),o=[];for(let n=0;n<t.inboundNodes.length;n++){const i=t.inboundNodes[n],r=wf.nodeKey(t,n);let a={};if(this.containerNodes.has(r)){if(i.callArgs)try{JSON.stringify(i.callArgs),a=i.callArgs}catch(e){console.warn(`Layer ${t.name} was passed non-serializable keyword arguments: ${i.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),a={}}if(i.inboundLayers.length>0){const t=[];for(let n=0;n<i.inboundLayers.length;n++){const r=i.inboundLayers[n],o=i.nodeIndices[n],s=i.tensorIndices[n];let l=e[wf.nodeKey(r,o)];null==l&&(l=0),t.push([r.name,l,s,a])}o.push(t)}}}const a={};a.name=t.name,a.className=i,a.config=r,a.inboundNodes=o,n.push(a)}t.layers=n;const i=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t],r=this.inputLayersNodeIndices[t],o=wf.nodeKey(n,r);if(!this.containerNodes.has(o))continue;let a=e[o];null==a&&(a=0);const s=this.inputLayersTensorIndices[t];i.push([n.name,a,s])}t.inputLayers=i;const r=[];for(let t=0;t<this.outputLayers.length;t++){const n=this.outputLayers[t],i=this.outputLayersNodeIndices[t],o=wf.nodeKey(n,i);if(!this.containerNodes.has(o))continue;let a=e[o];null==a&&(a=0);const s=this.outputLayersTensorIndices[t];r.push([n.name,a,s])}return t.outputLayers=r,t}static fromConfig(t,e,n={},i=!1){const r={},o={};function a(t,e){t.name in o?o[t.name].push(e):o[t.name]=[e]}function s(t,e){const n=[];let i;for(const o of e){const s=o[0],l=o[1],u=o[2];if(i=null==o[3]?{}:o[3],!(s in r))return void a(t,e);const c=r[s];if(c.inboundNodes.length<=l)return void a(t,e);const h=c.inboundNodes[l];n.push(h.outputTensors[u])}n.length>0&&t.apply(Eh(n),i)}function l(t){const n=t.name,o=Pp(t,null!=e.customObjects?e.customObjects:{});o.setFastWeightInitDuringBuild(i),r[n]=o;t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new Ch(`Corrupted configuration, expected array for nodeData: ${t}`);a(o,t)}))}const u=e.name,c=e.layers;for(const t of c)l(t);for(;!Vh(o);)for(const t of c){const e=r[t.name];if(e.name in o){const t=o[e.name];delete o[e.name];for(const n of t)s(e,n)}}const h=[],d=[],p=e.inputLayers;for(const t of p){const e=t[0],n=t[1],i=t[2];Dh(e in r);const o=r[e].inboundNodes[n].outputTensors;h.push(o[i])}const f=e.outputLayers;for(const t of f){const e=t[0],n=t[1],i=t[2];Dh(e in r);const o=r[e].inboundNodes[n].outputTensors;d.push(o[i])}return new t({inputs:h,outputs:d,name:u})}get stateful(){if(this._stateful)throw new Ch("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){ji((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _f(t,e){return function(t,e,n){const i=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===i)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==i)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}(t,e,"classWeight")}async function kf(t,e,n,i){if(null!=e||null!=i)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=ji((()=>{if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1){const e=1;return t.argMax(e)}if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),i=Array.from(await e.data());Ui(e);const r=[];return i.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);r.push(n[t])})),Ls(r,"float32")}return null}function Sf(t,e){return Zi(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cf(t,e){let n,i;const r=e;n=r.xs,i=r.ys,s(null!=n&&null!=i,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const o=Af("input",t.inputNames,n),a=Af("output",t.outputNames,i),l=o[0].shape[0];s(o.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),s(a.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let e=0;e<o.length;e++)s(o[e].shape[0]===l,(()=>`Batch size mismatch: input ${t.inputNames[e]} has ${o[e].shape[0]}; expected  ${l} based on input ${t.inputNames[0]}.`));for(let e=0;e<a.length;e++)s(a[e].shape[0]===l,(()=>`Batch size mismatch: output ${t.outputNames[e]} has ${a[e].shape[0]}; expected  ${l} based on input ${t.inputNames[0]}.`));return{xs:o,ys:a}}function Af(t,e,n){if(n instanceof fe)return[n];if(Array.isArray(n))return s(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const i=[];for(const r of e){if(null==n[r])throw new Ch(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);i.push(n[r])}return i}}async function If(t,e,n){const i=null!=n.batchesPerEpoch;if(s(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),s(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),s(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),s(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),s(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=null!=n.validationData;let o,a;if(r)if(Mf(n.validationData))s(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new Ah("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);o=t.xs,a=t.ys}const l=t.makeTrainFunction(),u=t.getDedupedMetricsNames();let c;c=r?u.slice().concat(u.map((t=>"val_"+t))):u.slice();const h=Rp(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:p,history:f}=$p(h,d,n.epochs,null,null,function(t,e){let n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,r,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let g=null==n.initialEpoch?0:n.initialEpoch,m=await e.iterator();for(;g<n.epochs;){const s={};await p.onEpochBegin(g);let c=0,h=0;for(i||(m=await e.iterator());!i||c<n.batchesPerEpoch;){const e=await m.next();if(i&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${c} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(null!=e.value){const{xs:i,ys:r}=Cf(t,e.value),o={};o.batch=h,o.size=i[0].shape[0],await p.onBatchBegin(h,o);const a=[];if(null!=n.classWeight){const e=_f(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)a.push(await kf(r[t],null,e[t]))}const s=i.concat(r).concat(a),d=l(s);Ui(s);for(let t=0;t<u.length;++t){const e=u[t],n=d[t];o[e]=n,Gi(n)}await p.onBatchEnd(h,o),Ip(o),h++,c++}if(i?c>=n.batchesPerEpoch:e.done){if(r){let e;e=Mf(n.validationData)?Nh(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):Nh(t.evaluate(o,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)s[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(g,s),g++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Mf(t){return"function"==typeof t.iterator}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Df(t){s(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function Tf(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>Sd(t,e,n-e))):Sd(t,e,n-e)}function Ef(t,e){return ji((()=>null==t?null:Array.isArray(t)?t.map((t=>Ef(t,e))):Nd(t,"int32"===e.dtype?e:e.toInt())))}function Nf(t,e){const n=[];let i=0,r=null;for(;i<t;)r=i+e,r>=t&&(r=t),n.push([i,r]),i=r;return n}async function Of(t,e,n,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let o,a,s,l,u,c,h;t.isTraining=!0;try{const d=null==r.batchSize?32:r.batchSize;Df(d);const p=!1,f=await t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,p,d);o=f[0],a=f[1],h=f[2];let g,m=!1;if(null!=r.validationData&&r.validationData.length>0){if(m=!0,2!==r.validationData.length)throw 3===r.validationData.length?new Ah("validationData including sample weights is not supported yet."):new Ch(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);s=r.validationData[0],l=r.validationData[1];const e=!0,n=await t.standardizeUserData(s,l,null,null,e,d);u=n[0],c=n[1],g=u.concat(c)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){m=!0;const t=Math.floor(o[0].shape[0]*(1-r.validationSplit)),e=o[0].shape[0];u=Tf(o,t,e),o=Tf(o,0,t),c=Tf(a,t,e),a=Tf(a,0,t),g=u.concat(c)}else null!=r.validationSteps&&(m=!0);const y=o.concat(a).concat(h);t.checkTrainableWeightsConsistency();const v=t.makeTrainFunction(),x=t.getDedupedMetricsNames();let b,w;m?(t.makeTestFunction(),b=t.testFunction,w=x.slice().concat(x.map((t=>"val_"+t)))):(b=null,g=[],w=x.slice());const _=Rp(r.callbacks,r.yieldEvery);return await async function(t,e,n,r,o,a,s,l,u,c,h,d,p,f,g){null==o&&(o=32),null==a&&(a=1),null==h&&(h=!0),null==p&&(p=0);let m=!1;if(null!=u&&null!=c&&(m=!0),null!=g&&(m=!0,null==f))throw new Ch("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=t.checkNumSamples(n,o,f,"steps_per_epoch");let v;null!=y&&(v=wd(0,y)),null==s&&(s=1);const{callbackList:x,history:b}=$p(l,s,a,p,y,f,o,m,d);x.setModel(t),t.history=b,await x.onTrainBegin(),t.stopTraining_=!1;for(let s=p;s<a;++s){await x.onEpochBegin(s);const a={};if(null!=f)throw new Ah("stepsPerEpoch mode is not implemented yet.");{if("batch"===h)throw new Ah("batch shuffling is not implemneted yet");h&&i(v);const s=Ls(v),l=Nf(y,o);for(let i=0;i<l.length;++i){const h={};if(await x.onBatchBegin(i,h),ji((()=>{const d=l[i][0],p=l[i][1],f=Sd(s,d,p-d);h.batch=i,h.size=p-d;const g=Ef(n,f),y=e(g);for(let t=0;t<r.length;++t){const e=r[t],n=y[t];h[e]=n,Gi(n)}if(i===l.length-1&&m){const e=t.testLoop(u,c,o);for(let t=0;t<r.length;++t){const n=r[t],i=e[t];Gi(i),a["val_"+n]=i}}})),await x.onBatchEnd(i,h),Ip(h),t.stopTraining_)break}s.dispose()}if(await x.onEpochEnd(s,a),t.stopTraining_)break}return await x.onTrainEnd(),await t.history.syncData(),t.history}(t,v,y,x,d,r.epochs,r.verbose,_,b,g,r.shuffle,w,r.initialEpoch,null,null)}finally{t.isTraining=!1,Rf(o,e),Rf(a,n),Rf(u,s),Rf(c,l),null!=h&&Ui(h)}}function Ff(t){const e=[];t instanceof fe&&(t=[t]);for(let n=0;n<t.length;++n){const i=t[n];if(1===i.rank)e.push(kd(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(i)}}return e}function Rf(t,e){if(null==t)return;const n=[];if(e instanceof fe)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const t in e){const i=e[t];n.push(i.id)}const i=[];if(t instanceof fe)-1===n.indexOf(t.id)&&i.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&i.push(t)}));else if(null!=t)for(const e in t){const r=t[e];-1===n.indexOf(r.id)&&i.push(r)}i.forEach((t=>{t.isDisposed||t.dispose()}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lf(t){return Array.isArray(t)}function $f(t){return!function(t){return t instanceof fe}(t)&&!Lf(t)}function Pf(t,e,n,i=!0,r=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(Lf(t)&&t.length>0)e=!0;else if($f(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new Ch(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let o;if($f(t)){t=t,o=[];for(const n of e){if(null==t[n])throw new Ch(`No data provided for "${n}". Need data for each key in: ${e}`);o.push(t[n])}}else if(Lf(t)){if((t=t).length!==e.length)throw new Ch(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);o=t}else{if(t=t,e.length>1)throw new Ch(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);o=[t]}if(o=Ff(o),null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const a=o[t];if(a.shape.length!==n[t].length)throw new Ch(`Error when checking ${r}: expected ${e[t]} to have ${n[t].length} dimension(s). but got array with shape ${a.shape}`);for(let o=0;o<n[t].length;++o){if(0===o&&!i)continue;const s=a.shape[o],l=n[t][o];if(null!=l&&l>=0&&s!==l)throw new Ch(`Error when checking ${r}: expected ${e[t]} to have shape [${n[t]}], but got array with shape [${a.shape}].`)}}return o}function zf(t,e,n,i=!0,r=""){let o;if(Array.isArray(t)){if(t.length!==e.length)throw new Ch(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);o=t}else{if(e.length>1)throw new Ch(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);o=[t]}if(null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const a=o[t];if(a.shape.length!==n[t].length)throw new Ch(`Error when checking ${r}: expected ${e[t]} to have ${n[t].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let o=0;o<n[t].length;++o){if(0===o&&!i)continue;const s=a.shape[o],l=n[t][o];if(null!=l&&l!==s)throw new Ch(`Error when checking ${r}: expected ${e[t]} to have shape ${JSON.stringify(n[t])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}class Bf extends wf{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new Ch("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");sf(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>Cu.adagrad(.01),Adadelta:()=>Cu.adadelta(1,.95,_h()),Adam:()=>Cu.adam(.001,.9,.999,_h()),Adamax:()=>Cu.adamax(.002,.9,.999,_h(),0),RMSProp:()=>Cu.rmsprop(.001,.9,0,_h()),SGD:()=>Cu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new Ch(`Unknown Optimizer ${t}`)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof mu))throw new Ch("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Ch(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>Xp(t)))}else{const n=Xp(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new Ch(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(Xp(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let t=0;t<this.outputs.length;++t){const e=this.internalOutputShapes[t],n=this.outputNames[t];this.feedOutputNames.push(n),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[t])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],pd("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const i=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const i of e){let e=n.hasOwnProperty(i)?n[i]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),r=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};pd("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;(e=>{let n,i,o;for(const a of e){if("string"==typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const e=this.internalOutputShapes[t];let r;1===e[e.length-1]||this.lossFunctions[t]===Gp?-1!==["accuracy","acc"].indexOf(a)?i=Yp:-1!==["crossentropy","ce"].indexOf(a)&&(i=Zp):this.lossFunctions[t]===Up?-1!==["accuracy","acc"].indexOf(a)?i=Jp:-1!==["crossentropy","ce"].indexOf(a)&&(i=tf):-1!==["accuracy","acc"].indexOf(a)?i=Kp:-1!==["crossentropy","ce"].indexOf(a)&&(i=Qp),-1!==["accuracy","acc"].indexOf(a)?r="acc":-1!==["crossentropy","ce"].indexOf(a)&&(r="ce"),o=i,n=""+r}else{const t=nf(a);o=t,n=""+rf(a)}let e;pd(n,(()=>{e=o})),r(t,n,e)}})(i[t])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const i=null==n.batchSize?32:n.batchSize;Df(i);const r=this.standardizeUserDataXY(t,e,!0,i);try{const o=r[0].concat(r[1]);this.makeTestFunction();const a=this.testFunction;return Eh(this.testLoop(a,o,i,n.verbose,n.steps))}finally{Rf(r[0],t),Rf(r[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const i=null!=(n=n||{}).batches,r=t.testFunction;let o=[];if(n.verbose>0)throw new Ah("Verbose mode is not implemented yet.");s(!i||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const a="function"==typeof e.next?e:await e.iterator();let l=0,u=0;for(;!i||u<n.batches;){const e=await a.next();if(o=ji((()=>{if(e.value){const{xs:n,ys:i}=Cf(t,e.value),a=n.concat(i),s=ji((()=>r(a)));if(Ui(a),0===u)for(let t=0;t<s.length;++t)o.push(ds(0));const c=a[0].shape[0];for(let t=0;t<s.length;++t){const e=s[t],n=o[t];o[t]=ji((()=>Xi(o[t],Zi(c,e)))),u>0&&Ui(n)}Ui(s),l+=c,++u}return o})),e.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let t=0;t<o.length;++t){const e=o[t];o[t]=Ki(o[t],l),Ui(e)}return Eh(o)}(this,t,e)}checkNumSamples(t,e,n,i="steps"){let r;if(null!=n){if(r=null,null!=e)throw new Ch(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new Ch(`Either the input data should have a defined shape, or ${i} shoud be specified.`);r=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return r}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new Ch("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),i=n?e:[e],r=this.retrieveSymbolicTensors(i),o=new ff;if(t instanceof fe&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Ch(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)o.add(this.inputs[e],t[e])}else for(const e of this.inputs){const n=t[e.name];if(null==n)throw new Ch(`No value is provided for the model's input ${e.name}`);o.add(e,n)}const a=yf(r,o);return n?a:a[0]}retrieveSymbolicTensors(t){const e=Mh(null,t.length);let n=t.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],o=r.map((t=>t.name));for(let i=0;i<t.length;++i){const a=o.indexOf(t[i]);if(-1!==a&&(e[i]=r[a],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,i)=>{null==e&&n.push(t[i])})),new Ch(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return ji((()=>{const i=this.checkNumSamples(t);if(n)throw new Ah("Verbose predictLoop() is not implemented yet.");const r=Nf(i,e),o=this.outputs.map((t=>[]));for(let e=0;e<r.length;++e){ji((()=>{const n=r[e][0],i=r[e][1],o=Tf(t,n,i),a=[];if(Array.isArray(o))for(let t=0;t<o.length;++t)a.push({key:this.inputs[t],value:o[t]});else a.push({key:this.inputs[0],value:o});const s=new ff(a);return yf(this.outputs,s)})).forEach(((t,e)=>o[e].push(t)))}return Eh(o.map((t=>Ir(t,0))))}))}predict(t,e={}){const n=Ff(t);zf(n,this.inputNames,this.feedInputShapes,!1);try{const i=null==e.batchSize?32:e.batchSize;return Df(i),this.predictLoop(n,i)}finally{Rf(n,t)}}predictOnBatch(t){zf(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,i){if(null==this.optimizer_)throw new Sh("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let t=0;t<this.feedOutputShapes.length;++t){const e=this.feedOutputShapes[t];this.feedLossFns[t]===Up?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(t,e,n){const i=Bh(t.map((t=>t.shape[0])));i.sort();const r=Bh(e.map((t=>t.shape[0])));if(r.sort(),i.length>1)throw new Ch(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(r.length>1)throw new Ch(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(i.length>0&&r.length>0&&!d(i,r))throw new Ch(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${r[0]} target sample(s).`)}(t=Pf(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Pf(e,this.feedOutputNames,r,!1,"target")),function(t,e,n){const i=[Bp,Gp,jp];for(let r=0;r<t.length;++r){const o=t[r],a=e[r],s=n[r];if(null!=a){if(a===jp&&1===o.shape[o.shape.length-1])throw new Ch(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==i.indexOf(a)){const t=o.shape.slice(1),e=s.slice(1);for(let n=0;n<t.length;++n){const i=t[n],r=e[n];if(null!=r&&i!==r)throw new Ch(`A target Tensor with shape ${o.shape} was passed for an output of shape ${s}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&t[0].shape[0]%i!=0)throw new Ch(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,i,r=!0,o){const[a,s]=this.standardizeUserDataXY(t,e,r,o);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=i){const t=_f(i,this.outputNames);l=[];for(let e=0;e<t.length;++e)l.push(await kf(s[e],null,t[e]))}return[a,s,l]}testLoop(t,e,n,i=0,r){return ji((()=>{const o=this.checkNumSamples(e,n,r,"steps"),a=[];if(i>0)throw new Ah("Verbose mode is not implemented yet.");if(null!=r)throw new Ah("steps mode in testLoop() is not implemented yet");{const i=Nf(o,n),r=Ls(wd(0,o));for(let n=0;n<i.length;++n){const o=i[n][0],s=i[n][1],l=Sd(r,o,s-o),u=Ef(e,l),c=t(u);if(0===n)for(let t=0;t<c.length;++t)a.push(ds(0));for(let t=0;t<c.length;++t){const e=c[t];a[t]=Xi(a[t],Zi(s-o,e))}}for(let t=0;t<a.length;++t)a[t]=Ki(a[t],o)}return a}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const i=t[n];let r=i;if(Th(t,i)>1){r+=`_${Th(t.slice(0,n),i)}`}e.push(r)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),o=[],a=this.collectedTrainableWeights.map((t=>t.read()));return[this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const a=new ff(t),s=yf(this.outputs,a,{training:!0});let l;for(let t=0;t<this.lossFunctions.length;++t){let n=(0,this.lossFunctions[t])(i[t],s[t]);null!=r[t]&&(n=Sf(n,r[t]));const o=ha(n);e.push(o),l=0===t?n:Xi(l,n)}for(let t=0;t<this.metricsTensors.length;++t){let n;if(this.outputs.length>1&&t<this.outputs.length)n=e[t];else{const e=this.metricsTensors[t][0],r=this.metricsTensors[t][1];n=ha(e(i[r],s[r]))}Gi(n),o.push(n)}return l=ha(l),this.calculateLosses().forEach((t=>{l=Xi(l,t)})),l}),!0,a)].concat(o)}}makeTestFunction(){this.testFunction=t=>ji((()=>{const e=[];let n;const i=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let t=0;t<this.inputs.length;++t)o.push({key:this.inputs[t],value:i[t]});const a=new ff(o),s=yf(this.outputs,a);for(let t=0;t<this.lossFunctions.length;++t){const i=this.lossFunctions[t],o=ha(i(r[t],s[t]));n=0===t?o:Xi(n,o),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],i=this.metricsTensors[t][1],o=ha(n(r[i],s[i]));e.push(o)}return e}))}async fit(t,e,n={}){return Of(this,t,e,n)}async fitDataset(t,e){return If(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),i=n[0],r=n[1],o=this.makeTrainFunction()(i.concat(r)),a=[];for(const t of o){const e=await t.data();a.push(e[0])}return Ui(o),Eh(a)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n);for(let t=0;t<i.length;++t)n&&!i[t].trainable||e.push({name:i[t].originalName,tensor:r[t]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=Wi().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Wi().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=Oh(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>Oh(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const i of e){if("string"!=typeof n[i])throw new Error("Serialization of non-string loss is not supported.");t[i]=Oh(n[i])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Oh(rf(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>Oh(rf(t))));{const t={};for(const e in this.metrics)t[e]=Oh(rf(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Pp(df(t.optimizer_config));let n,i;if("string"==typeof t.loss)n=Fh(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>Fh(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=Fh(t.loss[e])}if(Array.isArray(t.metrics))i=t.metrics.map((t=>Fh(t)));else if(null!=t.metrics){i={};for(const e in t.metrics)i[e]=Fh(t.metrics[e])}this.compile({loss:n,metrics:i,optimizer:e})}async save(t,e){if("string"==typeof t){const e=dn(t);if(0===e.length)throw new Ch(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Ch(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Ch("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await en(this.getNamedWeights(e)),i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.7.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){i.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:r}=await en(await this.optimizer.getWeights(),t);n.specs.push(...r),n.data=sn([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;of(this.userDefinedMetadata,this.name,t),i.userDefinedMetadata=this.userDefinedMetadata}return i.weightData=n.data,i.weightSpecs=n.specs,t.save(i)}setUserDefinedMetadata(t){of(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Bf.className="Model",Ri(Bf);class Vf extends Bf{}Vf.className="Functional",Ri(Vf);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Wf extends Bf{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:up("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new Ch(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof Wf||t instanceof Bf;let n;if(e){if(n=t,1!==n.outputs.length)throw new Ch("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new Ch("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new Ch("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=function(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new Ch("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new Cp({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new Ch(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new Ch("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Sp(this.outputs[0])}this.inboundNodes=[],new wp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Mh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(pp(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Bf({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new Sh("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new Sh("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new Sh("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new Sh("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},i=!1){let r,o={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new Ch("Legacy serialization format not supported yet.");r=e}else s(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),r=e.layers,delete e.layers,o=e;const a=new t(o);if(!(a instanceof Wf))throw new Ah(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const t of r){const e=Pp(t,void 0,i);i&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(t){if(null==this.model)throw new Ch("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new Ch("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}Wf.className="Sequential",Ri(Wf);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class jf extends Oi{getConfig(){return{}}}class Uf extends jf{apply(t,e=1){return function(t,e=1){if(1!==e)throw new Ah(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return mo(t)}(t,e)}}Uf.className="elu",Ri(Uf);class Gf extends jf{apply(t){return ps(t)}}Gf.className="selu",Ri(Gf);class Hf extends jf{apply(t){return is(t)}}Hf.className="relu",Ri(Hf);class qf extends jf{apply(t){return ji((()=>ga(6,is(t))))}}qf.className="relu6",Ri(qf);class Xf extends jf{apply(t){return t}}Xf.className="linear",Ri(Xf);class Yf extends jf{apply(t){return Mr(t)}}Yf.className="sigmoid",Ri(Yf);class Kf extends jf{apply(t){return function(t){return ji((()=>{const e=Xi(.5,Zi(.2,t));return Br(e,0,1)}))}(t)}}Kf.className="hardSigmoid",Ri(Kf);class Zf extends jf{apply(t){return Wo(t)}}Zf.className="softplus",Ri(Zf);class Jf extends jf{apply(t){return function(t){return ji((()=>Ki(t,Ji(t).add(1))))}(t)}}Jf.className="softsign",Ri(Jf);class Qf extends jf{apply(t){return Tr(t)}}Qf.className="tanh",Ri(Qf);class tg extends jf{apply(t,e=-1){return ks(t,e)}}tg.className="softmax",Ri(tg);class eg extends jf{apply(t,e=-1){return qo(t,e)}}eg.className="logSoftmax",Ri(eg);class ng extends jf{apply(t,e=1){return ji((()=>Mr(t.mul(e)).mul(t)))}}ng.className="swish",Ri(ng);class ig extends jf{apply(t){return ji((()=>Zi(t,Tr(Wo(t)))))}}function rg(t){return t.getClassName()}function og(t,e={}){return Ph(t,Fi.getMap().classNameMap,e,"activation")}function ag(t){if(null==t){const t={className:"linear",config:{}};return og(t)}if("string"==typeof t){const e={};return e.className=t,e.config={},og(e)}return t instanceof jf?t:og(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */ig.className="mish",Ri(ig);class sg extends Oi{}class lg extends sg{constructor(t){super(),function(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return ji((()=>{let e=da([1]);return this.hasL1&&(e=Xi(e,Ho(Zi(this.l1,Ji(t))))),this.hasL2&&(e=Xi(e,Ho(Zi(this.l2,Od(t))))),e.asScalar()}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}lg.className="L1L2",Ri(lg);const ug={l1l2:"L1L2"};function cg(t){return Lh(t)}function hg(t,e={}){return Ph(t,Fi.getMap().classNameMap,e,"regularizer")}function dg(t){if(null==t)return null;if("string"==typeof t){return hg({className:t in ug?ug[t]:t,config:{}})}return t instanceof sg?t:hg(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pg extends kp{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=dp(t);let n=is(t);return null!=this.maxValue&&(n=Br(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}pg.className="ReLU",Ri(pg);class fg extends kp{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=dp(t);return No(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}fg.className="LeakyReLU",Ri(fg);class gg extends kp{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=op(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=dg(t.alphaRegularizer),this.alphaConstraint=nd(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new Ch(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=pp(t)).slice(1);if(null!=this.sharedAxes)for(const t of this.sharedAxes)e[t-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let e=1;e<t.length;++e)n[e]=t[e];this.inputSpec=[new vp({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=dp(t),Oa(t,this.alpha.read())}getConfig(){const t={alphaInitializer:rp(this.alphaInitializer),alphaRegularizer:cg(this.alphaRegularizer),alphaConstraint:td(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}gg.className="PReLU",Ri(gg);class mg extends kp{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new Ah(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=dp(t);return mo(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}mg.className="ELU",Ri(mg);class yg extends kp{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=dp(t);return n.mul(_d(n.greater(this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}yg.className="ThresholdedReLU",Ri(yg);class vg extends kp{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new tg).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=dp(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function xg(t,e,n){if("number"==typeof t)return Mh(t,e);if(t.length!==e)throw new Ch(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let r=0;r<e;++r){const o=t[r];if((i=o)!==parseInt(i.toString(),10))throw new Ch(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t;var i}function bg(t,e,n,i,r=1){if(null==t)return t;let o;return o="same"===n?t:t-(e+(e-1)*(r-1))+1,Math.floor((o+i-1)/i)}function wg(t,e,n,i){if(null==t)return null;if("valid"===i)t=t*e+bd([n-e,0]);else{if("same"!==i)throw new Ch(`Unsupport padding mode: ${i}.`);t*=e}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _g(t,e){return ji((()=>(ud(e),"channelsFirst"===e?ei(t,[0,2,3,1]):t)))}function kg(t,e){return ji((()=>(ud(e),"channelsFirst"===e?ei(t,[0,2,3,4,1]):t)))}function Sg(t,e,n,i=[1,1],r="valid",o,a,s=null){return ji((()=>{if(null==o&&(o="channelsLast"),ud(o),3!==t.rank&&4!==t.rank)throw new Ch(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new Ch(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=_g(t,o);if("causal"===r)throw new Ah("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=ll({x:l,filter:e,strides:i,pad:"same"===r?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===o&&(l=ei(l,[0,3,1,2])),l}))}vg.className="Softmax",Ri(vg);class Cg extends kp{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Cg.verifyArgs(e),this.rank=t,Uh(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new Ah(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=xg(e.kernelSize,t,"kernelSize"),this.strides=xg(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,cd(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ud(this.dataFormat),this.activation=ag(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=op(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=nd(e.biasConstraint),this.biasRegularizer=dg(e.biasRegularizer),this.activityRegularizer=dg(e.activityRegularizer),this.dilationRate=xg(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new Ch(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new Ch(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new Ch(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(Dh("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!jh(t.kernelSize,"number",1,3))throw new Ch(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:rg(this.activation),useBias:this.useBias,biasInitializer:rp(this.biasInitializer),biasRegularizer:cg(this.biasRegularizer),activityRegularizer:cg(this.activityRegularizer),biasConstraint:td(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class Ag extends Cg{constructor(t,e){super(t,e),this.kernel=null,Ag.verifyArgs(e),this.filters=e.filters,Uh(this.filters,"filters"),this.kernelInitializer=op(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=nd(e.kernelConstraint),this.kernelRegularizer=dg(e.kernelRegularizer)}build(t){t=pp(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new Ch(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return ji((()=>{let e;t=dp(t);const n=null==this.bias?null:this.bias.read(),i=Hh(this.activation.getClassName());if(null!=i&&2===this.rank)e=Sg(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(1===this.rank)e=function(t,e,n,i=1,r="valid",o,a=1){return ji((()=>{if(null==o&&(o="channelsLast"),ud(o),3!==t.shape.length)throw new Ch(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new Ch(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new Ch(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===o&&(t=ei(t,[0,2,1])),"causal"===r)throw new Ah("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=Hr(t,e,i,"same"===r?"same":"valid","NWC",a);return null!=n&&(s=Rd(s,n)),s}))}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=Sg(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new Ah("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,i=[1,1,1],r="valid",o,a){return ji((()=>{if(null==o&&(o="channelsLast"),ud(o),4!==t.rank&&5!==t.rank)throw new Ch(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new Ch(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let s=kg(t,o);if("causal"===r)throw new Ah("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=Yr(s,e,i,"same"===r?"same":"valid","NDHWC",a),null!=n&&(s=Rd(s,n)),"channelsFirst"===o&&(s=ei(s,[0,4,1,2,3])),s}))}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=pp(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let t=0;t<n.length;++t){const i=bg(n[t],this.kernelSize[t],this.padding,this.strides[t],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[t]);e.push(i)}let i=[t[0]];return"channelsLast"===this.dataFormat?(i=i.concat(e),i.push(this.filters)):(i.push(this.filters),i=i.concat(e)),i}getConfig(){const t={filters:this.filters,kernelInitializer:rp(this.kernelInitializer),kernelRegularizer:cg(this.kernelRegularizer),kernelConstraint:td(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new Ch(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Ig extends Ag{constructor(t){super(2,t),Ig.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!jh(t.kernelSize,"number",1,2))throw new Ch(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Ig.className="Conv2D",Ri(Ig);class Mg extends Ag{constructor(t){super(3,t),Mg.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new Ch(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Mg.className="Conv3D",Ri(Mg);class Dg extends Ig{constructor(t){if(super(t),this.inputSpec=[new vp({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new Ch(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=pp(t)).length)throw new Ch("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new Ch("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vp({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return ji((()=>{let e=dp(t);if(4!==e.shape.length)throw new Ch(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,i=n[0];let r,o;"channelsFirst"===this.dataFormat?(r=2,o=3):(r=1,o=2);const a=n[r],s=n[o],l=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],h=this.strides[1],d=[i,wg(a,c,l,this.padding),wg(s,h,u,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=ei(e,[0,2,3,1]));let p=Xr(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=ei(p,[0,3,1,2])),null!=this.bias&&(p=Rd(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=pp(t)).slice();let n,i,r;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3):(n=3,i=1,r=2);const o=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return e[n]=this.filters,e[i]=wg(e[i],s,o,this.padding),e[r]=wg(e[r],l,a,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Dg.className="Conv2DTranspose",Ri(Dg);class Tg extends Mg{constructor(t){if(super(t),this.inputSpec=[new vp({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new Ch(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=pp(t)).length)throw new Ch("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new Ch("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vp({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return ji((()=>{let e=dp(t);if(5!==e.shape.length)throw new Ch(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,i=n[0];let r,o,a;"channelsFirst"===this.dataFormat?(a=2,r=3,o=4):(a=1,r=2,o=3);const s=n[a],l=n[r],u=n[o],c=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],g=this.strides[2],m=[i,wg(s,p,c,this.padding),wg(l,f,h,this.padding),wg(u,g,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=ei(e,[0,2,3,4,1]));let y=Zr(e,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=ei(y,[0,4,1,2,3])),null!==this.bias&&(y=Rd(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(t){const e=(t=pp(t)).slice();let n,i,r,o;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3,o=4):(n=4,i=1,r=2,o=3);const a=this.kernelSize[0],s=this.kernelSize[1],l=this.kernelSize[2],u=this.strides[0],c=this.strides[1],h=this.strides[2];return e[n]=this.filters,e[i]=wg(e[i],u,a,this.padding),e[r]=wg(e[r],c,s,this.padding),e[o]=wg(e[o],h,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Tg.className="Conv3DTranspose",Ri(Tg);class Eg extends Ag{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new Ch("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new Ch("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new Ch(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=op(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=dg(e.depthwiseRegularizer),this.depthwiseConstraint=nd(e.depthwiseConstraint),this.pointwiseInitializer=op(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=dg(e.pointwiseRegularizer),this.pointwiseConstraint=nd(e.pointwiseConstraint)}build(t){if((t=pp(t)).length<this.rank+2)throw new Ch(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new Ch(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[];for(let t=0;t<this.rank;++t)r.push(1);r.push(n*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new vp({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return ji((()=>{let e;if(t=dp(t),1===this.rank)throw new Ah("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=ei(t,[0,2,3,1])),e=fs(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=Rd(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=ei(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=rp(this.depthwiseInitializer),t.pointwiseInitializer=rp(this.pointwiseInitializer),t.depthwiseRegularizer=cg(this.depthwiseRegularizer),t.pointwiseRegularizer=cg(this.pointwiseRegularizer),t.depthwiseConstraint=td(this.depthwiseConstraint),t.pointwiseConstraint=td(this.pointwiseConstraint),t}}Eg.className="SeparableConv";class Ng extends Eg{constructor(t){super(2,t)}}Ng.className="SeparableConv2D",Ri(Ng);class Og extends Ag{constructor(t){super(1,t),Og.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!jh(t.kernelSize,"number",1,1))throw new Ch(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Og.className="Conv1D",Ri(Og);class Fg extends kp{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return ji((()=>{if(t=dp(t),"channelsLast"===this.dataFormat){const e=Ad(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ad(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=Ad(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ad(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}Fg.className="Cropping2D",Ri(Fg);class Rg extends kp{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ud(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,Wh(rd,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return ji((()=>{let e=dp(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=ei(e,[0,2,3,1]);const t=this.size[0]*n[2],i=this.size[1]*n[3],r="nearest"===this.interpolation?e.resizeNearestNeighbor([t,i]):e.resizeBilinear([t,i]);return ei(r,[0,3,1,2])}{const t=this.size[0]*n[1],i=this.size[1]*n[2];return"nearest"===this.interpolation?e.resizeNearestNeighbor([t,i]):e.resizeBilinear([t,i])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}Rg.className="UpSampling2D",Ri(Rg);class Lg extends Cg{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=op(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=nd(t.depthwiseConstraint),this.depthwiseRegularizer=dg(t.depthwiseRegularizer)}build(t){if((t=pp(t)).length<4)throw new Ch(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new Ch(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ji((()=>{let e=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e,n=[1,1],i="valid",r,o){return ji((()=>{null==r&&(r="channelsLast"),ud(r);let a=_g(t,r);if(4!==t.rank)throw new Ch(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new Ch(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return a=io(a,e,n,"same"===i?"same":"valid","NHWC",o),"channelsFirst"===r&&(a=ei(a,[0,3,1,2])),a}))}(t=dp(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=Rd(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=pp(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],i="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=bg(e,this.kernelSize[0],this.padding,this.strides[0]),o=bg(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],i,r,o]:[t[0],r,o,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=rp(this.depthwiseInitializer),t.depthwiseRegularizer=cg(this.depthwiseRegularizer),t.depthwiseConstraint=td(this.depthwiseRegularizer),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function $g(t,e,n,i){if(Array.isArray(t)){if(null!=e||null!=n)throw new Ch("When inputs is an array, neither initialState or constants should be provided");null!=i&&(n=t.slice(t.length-i,t.length),t=t.slice(0,t.length-i)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=r(e),constants:n=r(n)}}function Pg(t,e,n,i=!1,r,o,a=!1,s=!1){return ji((()=>{const l=e.shape.length;if(l<3)throw new Ch(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(wd(2,l));if(e=ei(e,u),null!=o)throw new Ah("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=r&&((r=r.asType("bool").asType("float32")).rank===l-1&&(r=xo(r,-1)),r=ei(r,u)),i&&(e=os(e,0),null!=r&&(r=os(r,0)));const c=[];let h,d=n;const p=e.shape[0],f=Ws(e);let g,m;null!=r&&(g=Ws(r));for(let e=0;e<p;++e){const n=f[e],i=ji((()=>t(n,d)));if(null==r)h=i[0],d=i[1];else{const t=ji((()=>{const t=g[e],n=ka(t).sub(t);return{output:i[0].mul(t).add(d[0].mul(n)),newStates:d.map(((e,r)=>i[1][r].mul(t).add(e.mul(n))))}}));h=t.output,d=t.newStates}s&&c.push(h)}if(s){m=Ns(c,1)}return[h,m,d]}))}Lg.className="DepthwiseConv2D",Ri(Lg);class zg extends kp{constructor(t){let e;if(super(t),null==t.cell)throw new Ch("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new qg({cells:t.cell}):t.cell,null==e.stateSize)throw new Ch("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new vp({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return wd(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){cp(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let i;if(i=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const i of e)n.push([t[0],i]);return[i].concat(n)}return i}computeMask(t,e){return ji((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new Ah("Constants support is not implemented in RNN yet.");cp(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new vp({shape:[e,null,...n]});const i=[t[0]].concat(t.slice(2));let r;if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!d(this.stateSpec.map((t=>t.shape[t.shape.length-1])),r))throw new Ch(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map((t=>new vp({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){ji((()=>{if(!this.stateful)throw new kh("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new Ch("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>da([n,t]))):this.states_=[da([n,this.cell.stateSize])];else if(null==t)Ui(this.states_),null!=this.keptStates&&(Ui(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>da([n,t]))):this.states_[0]=da([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new Ch(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):Ui(this.states_);for(let e=0;e<this.states_.length;++e){const i=t[e],r=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,o=[n,r];if(!d(i.shape,o))throw new Ch(`State ${e} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${i.shape}`);this.states_[e]=i}}this.states_=this.states_.map((t=>Gi(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,i=null==e?null:e.constants;null==e&&(e={});const r=$g(t,n,i,this.numConstants);t=r.inputs,n=r.initialState,i=r.constants;let o=[],a=[];if(null!=n){e.initialState=n,o=o.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new vp({shape:t.shape}));a=a.concat(this.stateSpec)}null!=i&&(e.constants=i,o=o.concat(i),this.numConstants=i.length);if(o[0]instanceof xp){const n=[t].concat(o),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const s=super.apply(n,e);return this.inputSpec=r,s}return super.apply(t,e)}call(t,e){return ji((()=>{const n=null==e?null:e.mask,i=null==e?null:e.training;let r=null==e?null:e.initialState;t=dp(t),null==r&&(r=this.stateful?this.states_:this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==o)throw new Ch(`RNN Layer has ${o} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},s=Pg(((t,e)=>{const n=this.cell.call([t].concat(e),a);return[n[0],n.slice(1)]}),t,r,this.goBackwards,n,null,this.unroll,this.returnSequences),l=s[0],u=s[1],c=s[2];this.stateful&&this.resetStates(c,i);const h=this.returnSequences?u:l;return this.returnState?[h].concat(c):h}))}getInitialState(t){return ji((()=>{let e=da(t.shape);return e=Ho(e,[1,2]),e=kd(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?Dd(e,[1,t]):e)):this.cell.stateSize>1?[Dd(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===zg.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,t,e)}static fromConfig(t,e,n={}){const i=Pp(e.cell,n);return new t(Object.assign(e,{cell:i}))}}zg.className="RNN",Ri(zg);class Bg extends kp{}class Vg extends Bg{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Uh(this.units,"units"),this.activation=ag(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=op(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=op(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=op(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=dg(t.kernelRegularizer),this.recurrentRegularizer=dg(t.recurrentRegularizer),this.biasRegularizer=dg(t.biasRegularizer),this.kernelConstraint=nd(t.kernelConstraint),this.recurrentConstraint=nd(t.recurrentConstraint),this.biasConstraint=nd(t.biasConstraint),this.dropout=xd([1,bd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=xd([1,bd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=pp(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ji((()=>{if(2!==(t=t).length)throw new Ch(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const i=null!=e.training&&e.training;let r;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Xg({ones:()=>ka(t),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Xg({ones:()=>ka(n),rate:this.recurrentDropout,training:i}));const o=this.dropoutMask,a=this.recurrentDropoutMask;r=Ed(null!=o?Zi(t,o):t,this.kernel.read()),null!=this.bias&&(r=Rd(r,this.bias.read())),null!=a&&(n=Zi(n,a));let s=Xi(r,Ed(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:rg(this.activation),useBias:this.useBias,kernelInitializer:rp(this.kernelInitializer),recurrentInitializer:rp(this.recurrentInitializer),biasInitializer:rp(this.biasInitializer),kernelRegularizer:cg(this.kernelRegularizer),recurrentRegularizer:cg(this.recurrentRegularizer),biasRegularizer:cg(this.biasRegularizer),activityRegularizer:cg(this.activityRegularizer),kernelConstraint:td(this.kernelConstraint),recurrentConstraint:td(this.recurrentConstraint),biasConstraint:td(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,e)}}Vg.className="SimpleRNNCell",Ri(Vg);class Wg extends zg{constructor(t){t.cell=new Vg(t),super(t)}call(t,e){return ji((()=>{null!=this.cell.dropoutMask&&(Ui(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ui(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,i=null==e?null:e.training,r=null==e?null:e.initialState;return super.call(t,{mask:n,training:i,initialState:r})}))}static fromConfig(t,e){return new t(e)}}Wg.className="SimpleRNN",Ri(Wg);class jg extends Bg{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Ch("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Uh(this.units,"units"),this.activation=ag(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ag(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=op(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=op(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=op(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=dg(t.kernelRegularizer),this.recurrentRegularizer=dg(t.recurrentRegularizer),this.biasRegularizer=dg(t.biasRegularizer),this.kernelConstraint=nd(t.kernelConstraint),this.recurrentConstraint=nd(t.recurrentConstraint),this.biasConstraint=nd(t.biasConstraint),this.dropout=xd([1,bd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=xd([1,bd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=pp(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ji((()=>{if(2!==(t=t).length)throw new Ch(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Xg({ones:()=>ka(t),rate:this.dropout,training:n,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Xg({ones:()=>ka(i),rate:this.recurrentDropout,training:n,count:3}));const r=this.dropoutMask,o=this.recurrentDropoutMask;let a,s,l;0<this.dropout&&this.dropout<1&&(t=Zi(t,r[0]));let u=Ed(t,this.kernel.read());this.useBias&&(u=Rd(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Zi(i,o[0]));const c=this.recurrentKernel.read(),[h,d]=Is(c,[2*this.units,this.units],c.rank-1),p=Ed(i,h),[f,g,m]=Is(u,3,u.rank-1),[y,v]=Is(p,2,p.rank-1);a=this.recurrentActivation.apply(Xi(f,y)),s=this.recurrentActivation.apply(Xi(g,v));const x=Ed(Zi(s,i),d);l=this.activation.apply(Xi(m,x));const b=Xi(Zi(a,i),Zi(Xi(1,Vo(a)),l));return[b,b]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:rg(this.activation),recurrentActivation:rg(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rp(this.kernelInitializer),recurrentInitializer:rp(this.recurrentInitializer),biasInitializer:rp(this.biasInitializer),kernelRegularizer:cg(this.kernelRegularizer),recurrentRegularizer:cg(this.recurrentRegularizer),biasRegularizer:cg(this.biasRegularizer),activityRegularizer:cg(this.activityRegularizer),kernelConstraint:td(this.kernelConstraint),recurrentConstraint:td(this.recurrentConstraint),biasConstraint:td(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,e)}}jg.className="GRUCell",Ri(jg);class Ug extends zg{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new jg(t),super(t)}call(t,e){return ji((()=>{null!=this.cell.dropoutMask&&(Ui(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ui(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,i=null==e?null:e.training,r=null==e?null:e.initialState;return super.call(t,{mask:n,training:i,initialState:r})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Ug.className="GRU",Ri(Ug);class Gg extends Bg{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Uh(this.units,"units"),this.activation=ag(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ag(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=op(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=op(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=op(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=dg(t.kernelRegularizer),this.recurrentRegularizer=dg(t.recurrentRegularizer),this.biasRegularizer=dg(t.biasRegularizer),this.kernelConstraint=nd(t.kernelConstraint),this.recurrentConstraint=nd(t.recurrentConstraint),this.biasConstraint=nd(t.biasConstraint),this.dropout=xd([1,bd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=xd([1,bd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=pp(t))[t.length-1];let i;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;i=new((e=class extends Bd{apply(e,i){const r=t.apply([n]),o=(new Wd).apply([n]),a=t.apply([2*n]);return Md(Md(r,o),a)}}).className="CustomInit",e)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return ji((()=>{const n=null!=e.training&&e.training;if(3!==(t=t).length)throw new Ch(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const r=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Xg({ones:()=>ka(t),rate:this.dropout,training:n,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Xg({ones:()=>ka(i),rate:this.recurrentDropout,training:n,count:4}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let s,l,u,c;0<this.dropout&&this.dropout<1&&(t=Zi(t,o[0]));let h=Ed(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Zi(i,a[0])),h=Xi(h,Ed(i,this.recurrentKernel.read())),this.useBias&&(h=Rd(h,this.bias.read()));const[d,p,f,g]=Is(h,4,h.rank-1);s=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),u=Xi(Zi(l,r),Zi(s,this.activation.apply(f))),c=this.recurrentActivation.apply(g);const m=Zi(c,this.activation.apply(u));return[m,m,u]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:rg(this.activation),recurrentActivation:rg(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rp(this.kernelInitializer),recurrentInitializer:rp(this.recurrentInitializer),biasInitializer:rp(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cg(this.kernelRegularizer),recurrentRegularizer:cg(this.recurrentRegularizer),biasRegularizer:cg(this.biasRegularizer),activityRegularizer:cg(this.activityRegularizer),kernelConstraint:td(this.kernelConstraint),recurrentConstraint:td(this.recurrentConstraint),biasConstraint:td(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,e)}}Gg.className="LSTMCell",Ri(Gg);class Hg extends zg{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Gg(t),super(t)}call(t,e){return ji((()=>{null!=this.cell.dropoutMask&&(Ui(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ui(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,i=null==e?null:e.training,r=null==e?null:e.initialState;return super.call(t,{mask:n,training:i,initialState:r})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Hg.className="LSTM",Ri(Hg);class qg extends Bg{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return ji((()=>{let n=(t=t).slice(1);const i=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?i.push(n.splice(0,t.stateSize.length)):i.push(n.splice(0,1));i.reverse();const r=[];let o;for(let a=0;a<this.cells.length;++a){const s=this.cells[a];n=i[a],o=0===a?[t[0]].concat(n):[o[0]].concat(n),o=s.call(o,e),r.push(o.slice(1))}n=[];for(const t of r.slice().reverse())n.push(...t);return[o[0]].concat(n)}))}build(t){let e;cp(t)&&(t=t[0]),t=t,this.cells.forEach(((n,i)=>{pd(`RNNCell_${i}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign({},t,e)}static fromConfig(t,e,n={}){const i=[];for(const t of e.cells)i.push(Pp(t,n));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return mp(t)}setWeights(t){const e=[];for(const n of this.cells){const i=n.weights.length,r=t.splice(i);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],r[t]])}yp(e)}}function Xg(t){const{ones:e,rate:n,training:i=!1,count:r=1}=t,o=()=>Ld(e(),n),a=()=>$d(o,e,i);if(!r||r<=1)return Gi(a().clone());return Array(r).fill(void 0).map(a).map((t=>Gi(t.clone())))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */qg.className="StackedRNNCells",Ri(qg);class Yg extends zg{constructor(t){if(t.unroll)throw new Ah("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Ah("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new vp({ndim:5})]}call(t,e){return ji((()=>{if(null!=this.cell.dropoutMask&&(Ui(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ui(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new Ch("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,i=null==e?null:e.training,r=null==e?null:e.initialState;return super.call(t,{mask:n,training:i,initialState:r})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return ji((()=>{const{stateSize:e}=this.cell,n=t.shape,i=this.computeSingleOutputShape(n),r=da([i[0],...i.slice(2)]);return Array.isArray(e)?Array(e.length).fill(r):[r]}))}resetStates(t,e=!1){ji((()=>{if(!this.stateful)throw new kh("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,i=this.computeSingleOutputShape(n),r=[i[0],...i.slice(2)];if(null==n[0])throw new Ch("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>da(r))):this.states_=[da(r)];else if(null==t)Ui(this.states_),null!=this.keptStates&&(Ui(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>da(r))):this.states_[0]=da(r);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new Ch(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):Ui(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],i=r;if(!d(n.shape,i))throw new Ch(`State ${e} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>Gi(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:i,padding:r,strides:o,dilationRate:a}=this.cell,s="channelsFirst"===e,l=t[s?3:2],u=t[s?4:3],c=bg(l,i[0],r,o[0],a[0]),h=bg(u,i[1],r,o[1],a[1]);return[...t.slice(0,2),...s?[n,c,h]:[c,h,n]]}}Yg.className="ConvRNN2D";class Kg extends Gg{constructor(t){const{filters:e,kernelSize:n,strides:i,padding:r,dataFormat:o,dilationRate:a}=t;super(Object.assign({},t,{units:e})),this.filters=e,Uh(this.filters,"filters"),this.kernelSize=xg(n,2,"kernelSize"),this.kernelSize.forEach((t=>Uh(t,"kernelSize"))),this.strides=xg(i||1,2,"strides"),this.strides.forEach((t=>Uh(t,"strides"))),this.padding=r||"valid",cd(this.padding),this.dataFormat=o||"channelsLast",ud(this.dataFormat),this.dilationRate=xg(a||1,2,"dilationRate"),this.dilationRate.forEach((t=>Uh(t,"dilationRate")))}build(t){var e;t=pp(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new Ch(`The channel dimension of the input should be defined. Found ${t[n]}`);const i=t[n],r=this.kernelSize.concat([i,4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const o=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,i=this.filters;t=new((e=class extends Bd{apply(t,e){return Id([n.apply([i]),pa([i]),n.apply([2*i])])}}).className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return ji((()=>{if(3!==t.length)throw new Ch(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,i=t[0],r=t[1],o=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Xg({ones:()=>ka(i),rate:this.dropout,training:n,count:4}));const a=this.dropoutMask,s=(t,e,n)=>e&&e[n]?Zi(e[n],t):t;let l=s(i,a,0),u=s(i,a,1),c=s(i,a,2),h=s(i,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Xg({ones:()=>ka(r),rate:this.recurrentDropout,training:n,count:4}));const d=this.recurrentDropoutMask;let p=s(r,d,0),f=s(r,d,1),g=s(r,d,2),m=s(r,d,3);const[y,v,x,b]=Is(this.kernel.read(),4,3),[w,_,k,S]=this.useBias?Is(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,w,this.padding),u=this.inputConv(u,v,_,this.padding),c=this.inputConv(c,x,k,this.padding),h=this.inputConv(h,b,S,this.padding);const[C,A,I,M]=Is(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,C),f=this.recurrentConv(f,A),g=this.recurrentConv(g,I),m=this.recurrentConv(m,M);const D=this.recurrentActivation.apply(Xi(l,p)),T=this.recurrentActivation.apply(Xi(u,f)),E=Xi(Zi(T,o),Zi(D,this.activation.apply(Xi(c,g)))),N=Zi(this.recurrentActivation.apply(Xi(h,m)),this.activation.apply(E));return[N,N,E]}))}getConfig(){const t=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(super.getConfig(),["units"]),e={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,e)}inputConv(t,e,n,i){const r=Gr(t,e,this.strides,i||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Rd(r,n,this.dataFormat):r}recurrentConv(t,e){return Gr(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}Kg.className="ConvLSTM2DCell",Ri(Kg);class Zg extends Yg{constructor(t){const e=new Kg(t);super(Object.assign({},t,{cell:e}))}static fromConfig(t,e){return new t(e)}}Zg.className="ConvLSTM2D",Ri(Zg);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Jg extends kp{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let t=0;t<this.noiseShape.length;++t)n.push(null==this.noiseShape[t]?e[t]:this.noiseShape[t]);return n}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,i=this.getNoiseShape(n);return $d((()=>Ld(n,this.rate,i,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Jg.className="Dropout",Ri(Jg);class Qg extends Jg{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}Qg.className="SpatialDropout1D",Ri(Qg);class tm extends kp{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,Uh(this.units,"units"),this.activation=ag(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=op(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=op(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=nd(t.kernelConstraint),this.biasConstraint=nd(t.biasConstraint),this.kernelRegularizer=dg(t.kernelRegularizer),this.biasRegularizer=dg(t.biasRegularizer),this.activityRegularizer=dg(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=pp(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=pp(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t),i=Hh(this.activation.getClassName());let r;return null!=i?r=Ed(n,this.kernel.read(),i,this.bias?this.bias.read():null):(r=Ed(n,this.kernel.read()),null!=this.bias&&(r=Rd(r,this.bias.read())),null!=this.activation&&(r=this.activation.apply(r))),r}))}getConfig(){const t={units:this.units,activation:rg(this.activation),useBias:this.useBias,kernelInitializer:rp(this.kernelInitializer),biasInitializer:rp(this.biasInitializer),kernelRegularizer:cg(this.kernelRegularizer),biasRegularizer:cg(this.biasRegularizer),activityRegularizer:cg(this.activityRegularizer),kernelConstraint:td(this.kernelConstraint),biasConstraint:td(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}tm.className="Dense",Ri(tm);class em extends kp{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=pp(t);for(const e of t.slice(1))if(null==e)throw new Ch(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],vd(t,1)]}call(t,e){return ji((()=>{this.invokeCallHook(t,e);let n=dp(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=n.transpose(t)}return function(t){if(t.rank<=1)throw new Ch(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],vd(t.shape,1)];return t.reshape(e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}em.className="Flatten",Ri(em);class nm extends kp{constructor(t){super(t),this.supportsMasking=!0,this.activation=ag(t.activation)}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t);return this.activation.apply(n)}))}getConfig(){const t={activation:rg(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}nm.className="Activation",Ri(nm);class im extends kp{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return ji((()=>{return t=dp(t),e=t,n=this.n,ji((()=>{if(2!==e.shape.length)throw new Ch(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return Dd(kd(e,1),[1,n,1])}));var e,n}))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}im.className="RepeatVector",Ri(im);class rm extends kp{constructor(t){super(t),this.targetShape=t.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",i=e.slice();let r=1,o=null;for(let t=0;t<i.length;++t){const e=i[t];if(this.isUnknown(e)){if(null!==o)throw new Ch("Can only specifiy one unknown dimension.");o=t}else r*=e}const a=vd(t);if(null!==o){if(0===r||a%r!=0)throw new Ch(n);i[o]=a/r}else if(a!==r)throw new Ch(n);return i}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t),i=n.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return n.reshape(r)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}rm.className="Reshape",Ri(rm);class om extends kp{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=wd(1,t.dims.length+1);if(!d(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new vp({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=pp(t)).slice();return this.dims.forEach(((n,i)=>{e[i+1]=t[n]})),e}call(t,e){return ei(dp(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}om.className="Permute",Ri(om);class am extends kp{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=dp(t);return ir(_a(n,this.maskValue),-1)}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t),i=ir(_a(n,this.maskValue),-1,!0);return n.mul(i.asType(n.dtype))}))}}am.className="Masking",Ri(am);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class sm extends kp{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(Nh(t.inputLength))}this.inputDim=t.inputDim,Uh(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Uh(this.outputDim,"outputDim"),this.embeddingsInitializer=op(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=dg(t.embeddingsRegularizer),this.activityRegularizer=dg(t.activityRegularizer),this.embeddingsConstraint=nd(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return ji((()=>this.maskZero?(t=dp(t),_a(t,ho(t))):null))}computeOutputShape(t){if(t=pp(t),null==this.inputLength)return[...t,this.outputDim];const e=Nh(this.inputLength);if(e.length!==t.length-1)throw new Ch(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let i=0;i<e.length;++i){const r=e[i],o=t[i+1];if(null!=r&&null!=o&&r!==o)throw new Ch(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==r&&(e[n]=o),n++}}return[t[0],...e,this.outputDim]}call(t,e){return ji((()=>{this.invokeCallHook(t,e);let n=dp(t);"int32"!==n.dtype&&(n=_d(n,"int32"));return Nd(this.embeddings.read(),n.as1D()).reshape(pp(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:rp(this.embeddingsInitializer),embeddingsRegularizer:cg(this.embeddingsRegularizer),activityRegularizer:cg(this.activityRegularizer),embeddingsConstraint:td(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}sm.className="Embedding",Ri(sm);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class lm extends kp{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Ah}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let i=0;i<e.length;++i){const r=t[t.length-e.length+i],o=e[i];if(null==r||null==o||r<0||o<0)n.push(null);else if(1===r)n.push(o);else if(1===o)n.push(r);else{if(r!==o)throw new Ch("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(r)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[pp(t)]),(t=t).length<2)throw new Ch(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const n of t)null!=n&&null!==n[0]&&e.push(n[0]);if(e=Bh(e),e.length>1)throw new Ch(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let e=1;e<t.length;++e){const i=null==t[e]?null:t[e].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}const i=t.map((t=>t.length));-1===t.indexOf(null)&&1===Bh(i).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return ji((()=>{if(t=t,this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const i=bd(n);for(let n of t){const t=n.rank;for(let e=0;e<i-t;++e)n=kd(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const i of t){const t=i.rank;if(null==t){const t=i.shape,r=t[0],o=t.slice(1).concat([r]);let a=i.reshape([r].concat(vd(t.slice(1))));a=ei(a,[1,0]),a=a.reshape(o),e.push(a),n=!0}else if(t>1){const r=wd(1,t).concat([0]);e.push(ei(i,r)),n=!0}else e.push(i)}let i=this.mergeFunction(e);const r=i.rank;if(n)if(null==r){const t=i.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));i=ei(i.reshape([-1,e]),[1,0]).reshape(n)}else if(r>1){const t=[r-1].concat(wd(0,r-1));i=ei(i,t)}return i}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==(t=t)[0]?null:t[0].slice(1);for(let n=1;n<t.length;++n){const i=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let n=[];for(const e of t)null!=e&&null!==e[0]&&n.push(e[0]);return n=Bh(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return ji((()=>{if(null==e)return null;if(!Array.isArray(e))throw new Ch("`mask` should be an Array");if(!Array.isArray(t))throw new Ch("`inputs` should be an Array");if(e.length!==t.length)throw new Ch(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;let n=(e=e.map((t=>null==t?t:xo(t,0))))[0];for(let t=1;t<e.length-1;++t)n=ia(n,e[t]);return n}))}}class um extends lm{constructor(t){super(t)}mergeFunction(t){return ji((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Xi(e,t[n]);return e}))}}um.className="Add",Ri(um);class cm extends lm{constructor(t){super(t)}mergeFunction(t){return ji((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Zi(e,t[n]);return e}))}}cm.className="Multiply",Ri(cm);class hm extends lm{constructor(t){super(t)}mergeFunction(t){return ji((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Xi(e,t[n]);return Zi(1/t.length,e)}))}}hm.className="Average",Ri(hm);class dm extends lm{constructor(t){super(t)}mergeFunction(t){return ji((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=ca(e,t[n]);return e}))}}dm.className="Maximum",Ri(dm);class pm extends lm{constructor(t){super(t)}mergeFunction(t){return ji((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=ga(e,t[n]);return e}))}}pm.className="Minimum",Ri(pm);class fm extends lm{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new Ch("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const n of t)if(null!=n){e=!1;break}if(e)return;const n=[];for(let e=0;e<t.length;++e){const i=t[e].slice();i.splice(this.axis,1);let r=!1;for(const t of n)if(d(t,i)){r=!0;break}r||n.push(i)}if(n.length>1)throw new Ch("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return ji((()=>Id(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Ch("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),i=this.axis<0?n.length+this.axis:this.axis;for(const t of e.slice(1)){if(null==n[i]||null==t[i]){n[i]=null;break}n[i]+=t[i]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new Ch("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Ch("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new Ch(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return ji((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const i=[];for(let n=0;n<t.length;++n)null==e[n]?i.push(ka(t[n]).asType("bool")):e[n].rank<t[n].rank?i.push(xo(e[n],-1)):i.push(e[n]);const r=Ir(i,this.axis);return nr(r,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function gm(t,e){for(;t<0;)t+=e;return t}fm.className="Concatenate",Ri(fm);class mm extends lm{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){s(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new Ah("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,n);if(e[i[0]]!==n[i[1]])throw new Ch(`Dimension incompatibility: ${e[i[0]]} !== ${n[i[1]]}`)}mergeFunction(t){if(2!==t.length)throw new Ch(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],i=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>gm(e,t[n].shape.length))):[gm(this.axes,n.shape.length),gm(this.axes,i.shape.length)],this.normalize&&(n=zp(n,e[0]),i=zp(i,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ah("batchDot is not implemented for tensors of 4D or higher rank yet");if(s(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),s(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new Ah("batchDot is not implemented for complex64-type Tensors yet.");const i=t.shape.length,r=e.shape.length;null==n&&(n=[i-1,r-2]);const o=n;return ji((()=>{let n,a;if(i>r){n=i-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else if(r>i){n=r-i;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)a=o[0]===o[1]?t.mul(e).sum(o[0]):t.transpose([1,0]).mul(e).sum(o[1]);else{const n=o[0]!==t.shape.length-1,i=o[1]===e.shape.length-1;a=t.matMul(e,n,i)}if(n>0){let t;t=i>r?i+r-3:i-1;const e=[];for(let i=t;i<t+n;++i)e.push(i);a=a.squeeze(e)}return 1===a.shape.length&&(a=a.expandDims(1)),a}))}(n,i,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[gm(this.axes,t.length),gm(this.axes,e.length)],n}computeOutputShape(t){s(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new Ah("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,n);e.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const r=e.concat(n);return 1===r.length&&r.push(1),r}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}mm.className="Dot",Ri(mm);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class ym extends kp{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t);return $d((()=>Td(n.shape,0,this.stddev).add(n)),(()=>n),e.training||!1)}))}}ym.className="GaussianNoise",Ri(ym);class vm extends kp{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return ji((()=>{this.invokeCallHook(t,e);const n=dp(t);if(this.rate>0&&this.rate<1){return $d((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return n.mul(Td(n.shape,1,t))}),(()=>n),e.training||!1)}return n}))}}vm.className="GaussianDropout",Ri(vm);class xm extends kp{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||dp(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return ji((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return $d((()=>{const e=dp(t),i=-1.7580993408473766;let r=Io(Qa(n),this.rate);r=_d(r,"float32");const o=((1-this.rate)*(1+this.rate*i**2))**-.5,a=-o*i*this.rate;return e.mul(r).add(r.add(-1).mul(i)).mul(o).add(a)}),(()=>dp(t)),e.training||!1)}return t}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function bm(t,e,n,i,r,o=.001){let a;if(2===t.rank)a=Fr(t,e,n,i,r,o);else if(3===t.rank)a=Rr(t,e,n,i,r,o);else{if(4!==t.rank)throw new Ah(`batchNormalization is not implemented for array of rank ${t.rank} yet`);a=Lr(t,e,n,i,r,o)}return a}function wm(t,e,n,i,r=.001){return d(i.slice().sort(),wd(0,t.rank-1))?function(t,e,n,i,r=.001){return ji((()=>{const o=xa(t,i),a=o.mean,s=o.variance;return[bm(t,a,s,n,e,r),a,s]}))}(t,e,n,i,r):function(t,e,n,i,r=.001){return ji((()=>{const o=xa(t,i),a=o.mean,s=o.variance,l=[];for(const e of wd(0,t.rank))-1!==i.indexOf(e)?l.push(1):l.push(t.shape[e]);const u=a.reshape(l),c=s.reshape(l),h=null==e?null:e.reshape(l),d=null==n?null:n.reshape(l);return[bm(t,u,c,d,h,r),a,s]}))}(t,e,n,i,r)}xm.className="AlphaDropout",Ri(xm);class _m extends kp{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=op(t.betaInitializer||"zeros"),this.gammaInitializer=op(t.gammaInitializer||"ones"),this.movingMeanInitializer=op(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=op(t.movingVarianceInitializer||"ones"),this.betaConstraint=nd(t.betaConstraint),this.gammaConstraint=nd(t.gammaConstraint),this.betaRegularizer=dg(t.betaRegularizer),this.gammaRegularizer=dg(t.gammaRegularizer)}build(t){t=pp(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new Ch(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new vp({ndim:t.length,axes:{[e]:n}})];const i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return ji((()=>{const n=null!=e.training&&e.training,i=dp(t),r=i.shape,o=r.length,a=wd(0,o),s=this.axis>=0?this.axis:this.axis+o;a.splice(s,1);const l=Mh(1,o);l[s]=r[s];const u=a.slice();u.sort();const c=!d(u,wd(0,o).slice(0,o-1));if(!n)return(()=>{if(c){const t=this.movingMean.read().reshape(l),e=this.movingVariance.read().reshape(l),n=this.center?this.beta.read().reshape(l):null,r=this.scale?this.gamma.read().reshape(l):null;return bm(i,t,e,n,r,this.epsilon)}return bm(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,p,f]=wm(i,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(t,e,n)=>{ji((()=>{const i=1-n,r=t.read(),o=r.sub(e).mul(i);t.write(r.sub(o))}))};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,f,this.momentum)})(),h}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rp(this.betaInitializer),gammaInitializer:rp(this.gammaInitializer),movingMeanInitializer:rp(this.movingMeanInitializer),movingVarianceInitializer:rp(this.movingVarianceInitializer),betaRegularizer:cg(this.betaRegularizer),gammaRegularizer:cg(this.gammaRegularizer),betaConstraint:td(this.betaConstraint),gammaConstraint:td(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}_m.className="BatchNormalization",Ri(_m);class km extends kp{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=op(t.betaInitializer||"zeros"),this.gammaInitializer=op(t.gammaInitializer||"ones"),this.betaRegularizer=dg(t.betaRegularizer),this.gammaRegularizer=dg(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=pp(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let t=0;t<this.axis.length;++t)this.axis[t]<0&&(this.axis[t]+=e);for(const t of this.axis)if(t<0||t>=e)throw new Error(`Invalid axis: ${t}`);if(this.axis.length!==Bh(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(t,e){const n=dp(t),i=n.shape,r=i.length;return ji((()=>{let{mean:t,variance:e}=xa(n,this.axis,!0);const o=Mh(1,r);for(const t of this.axis)o[t]=i[t];const a=t=>null!=t&&t.shape.length!==r&&this.axis!==[r-1]?t.reshape(o):t;let s=a(this.gamma.read()),l=a(this.beta.read());const u=[],c=[];for(let t=0;t<r;++t)-1!==this.axis.indexOf(t)?(u.push(i[t]),c.push(1)):(u.push(1),c.push(i[t]));return t=t.tile(u),e=e.tile(u),s=s.tile(c),l=l.tile(c),bm(n,t,e,l,s,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rp(this.betaInitializer),gammaInitializer:rp(this.gammaInitializer),betaRegularizer:cg(this.betaRegularizer),gammaRegularizer:cg(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}km.className="LayerNormalization",Ri(km);class Sm extends kp{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new Ch(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new Ch(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new Ch(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new vp({ndim:4})]}computeOutputShape(t){let e,n;return t=pp(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return ji((()=>{return e=dp(t),n=this.padding,i=this.dataFormat,ji((()=>{if(4!==e.rank)throw new Ch(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new Ch("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i="channelsLast"),"channelsLast"!==i&&"channelsFirst"!==i)throw new Ch(`Unknown data format: ${i}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===i?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],Ca(e,t)}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e,n,i}))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Cm(t,e,n,i,r,o){return ji((()=>{let a;ud(r),hd(o),cd(i),null==n&&(n=[1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==o&&(o="max"),t=_g(t,r);const s="same"===i?"same":"valid";return a="max"===o?sa(t,e,n,s):Cr(t,e,n,s),"channelsFirst"===r&&(a=ei(a,[0,3,1,2])),a}))}function Am(t,e,n,i,r,o){return ji((()=>{let a;ud(r),hd(o),cd(i),null==n&&(n=[1,1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==o&&(o="max"),t=kg(t,r);const s="same"===i?"same":"valid";return a="max"===o?la(t,e,n,s):Ar(t,e,n,s),"channelsFirst"===r&&(a=ei(a,[0,4,1,2,3])),a}))}Sm.className="ZeroPadding2D",Ri(Sm);class Im extends kp{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new Ch(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(Uh(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new Ch(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}Uh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,cd(this.padding),this.inputSpec=[new vp({ndim:3})]}computeOutputShape(t){const e=bg((t=pp(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return ji((()=>{this.invokeCallHook(t,e),t=kd(dp(t),2);const n=this.poolingFunction(dp(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Es(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class Mm extends Im{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Cm(t,e,n,i,r,"max")}}Mm.className="MaxPooling1D",Ri(Mm);class Dm extends Im{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Cm(t,e,n,i,r,"avg")}}Dm.className="AveragePooling1D",Ri(Dm);class Tm extends kp{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new Ch(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Uh(this.poolSize,"poolSize"),Uh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ud(this.dataFormat),cd(this.padding),this.inputSpec=[new vp({ndim:4})]}computeOutputShape(t){t=pp(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=bg(e,this.poolSize[0],this.padding,this.strides[0]),n=bg(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return ji((()=>(this.invokeCallHook(t,e),this.poolingFunction(dp(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Em extends Tm{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Cm(t,e,n,i,r,"max")}}Em.className="MaxPooling2D",Ri(Em);class Nm extends Tm{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Cm(t,e,n,i,r,"avg")}}Nm.className="AveragePooling2D",Ri(Nm);class Om extends kp{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new Ch(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Uh(this.poolSize,"poolSize"),Uh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ud(this.dataFormat),cd(this.padding),this.inputSpec=[new vp({ndim:5})]}computeOutputShape(t){t=pp(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],i="channelsFirst"===this.dataFormat?t[4]:t[3];return e=bg(e,this.poolSize[0],this.padding,this.strides[0]),n=bg(n,this.poolSize[1],this.padding,this.strides[1]),i=bg(i,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,i]:[t[0],e,n,i,t[4]]}call(t,e){return ji((()=>(this.invokeCallHook(t,e),this.poolingFunction(dp(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Fm extends Om{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Am(t,e,n,i,r,"max")}}Fm.className="MaxPooling3D",Ri(Fm);class Rm extends Om{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ud(r),cd(i),Am(t,e,n,i,r,"avg")}}Rm.className="AveragePooling3D",Ri(Rm);class Lm extends kp{constructor(t){super(t),this.inputSpec=[new vp({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Ah}}class $m extends Lm{constructor(t){super(t||{})}call(t,e){return ji((()=>{const e=dp(t);return ha(e,1)}))}}$m.className="GlobalAveragePooling1D",Ri($m);class Pm extends Lm{constructor(t){super(t||{})}call(t,e){return ji((()=>{const e=dp(t);return Uo(e,1)}))}}Pm.className="GlobalMaxPooling1D",Ri(Pm);class zm extends kp{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ud(this.dataFormat),this.inputSpec=[new vp({ndim:4})]}computeOutputShape(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Ah}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Bm extends zm{call(t,e){return ji((()=>{const e=dp(t);return"channelsLast"===this.dataFormat?ha(e,[1,2]):ha(e,[2,3])}))}}Bm.className="GlobalAveragePooling2D",Ri(Bm);class Vm extends zm{call(t,e){return ji((()=>{const e=dp(t);return"channelsLast"===this.dataFormat?Uo(e,[1,2]):Uo(e,[2,3])}))}}Vm.className="GlobalMaxPooling2D",Ri(Vm);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Wm extends kp{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const i=Pp(e.layer,n);delete e.layer;const r={layer:i};return Object.assign(r,e),new t(r)}}class jm extends Wm{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=pp(t)).length<3)throw new Ch(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=pp(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),i=t[1];return[n[0],i].concat(n.slice(1))}call(t,e){return ji((()=>Pg(((t,n)=>[dp(this.layer.call(t,e)),[]]),t=dp(t),[],!1,null,null,!1,!0)[1]))}}jm.className="TimeDistributed",Ri(jm);class Um extends Wm{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=Pp(n),e.goBackwards=!0!==e.goBackwards;const i={};var r;if(i.className=t.layer.getClassName(),i.config=e,this.backwardLayer=Pp(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,r=this.mergeMode,Wh(sd,"BidirectionalMergeMode",r),t.weights)throw new Ah("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,i,r=this.forwardLayer.computeOutputShape(t);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r,this.returnState?(i=r.slice(1),e=r[0]):e=r[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[e].concat(i).concat(i.slice()):Eh(n)}apply(t,e){let n=null==e?null:e.initialState,i=null==e?null:e.constants;null==e&&(e={});const r=$g(t,n,i,this.numConstants);if(t=r.inputs,n=r.initialState,i=r.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==i)return super.apply(t,e);const o=[],a=[];if(null!=n){const t=n.length;if(t%2>0)throw new Ch("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,o.push(...n);const i=n.map((t=>new vp({shape:t.shape})));this.forwardLayer.stateSpec=i.slice(0,t/2),this.backwardLayer.stateSpec=i.slice(t/2),a.push(...i)}if(null!=i)throw new Ah("Support for constants in Bidirectional layers is not implemented yet.");const s=o[0]instanceof xp;for(const t of o)if(t instanceof xp!==s)throw new Ch("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[t].concat(o),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const s=super.apply(n,e);return this.inputSpec=r,s}return super.apply(t,e)}call(t,e){return ji((()=>{const n=e.initialState;let i,r,o,a;if(null==n)i=this.forwardLayer.call(t,e),r=this.backwardLayer.call(t,e);else{const o=n.slice(0,n.length/2),a=n.slice(n.length/2);i=this.forwardLayer.call(t,Object.assign(e,{initialState:o})),r=this.backwardLayer.call(t,Object.assign(e,{initialState:a}))}return this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=os(r,1)),"concat"===this.mergeMode?a=Id([i,r]):"sum"===this.mergeMode?a=Xi(i,r):"ave"===this.mergeMode?a=Zi(.5,Xi(i,r)):"mul"===this.mergeMode?a=Zi(i,r):null==this.mergeMode&&(a=[i,r]),this.returnState?null==this.mergeMode?a.concat(o):[a].concat(o):a}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){pd(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),pd(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=Pp(e.layer);if(delete e.layer,null!=e.numConstants)throw new Ah("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=e;return i.layer=n,new t(i)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Gm,Hm,qm,Xm,Ym;Um.className="Bidirectional",Ri(Um),(Hm=Gm||(Gm={}))[Hm.DT_INVALID=0]="DT_INVALID",Hm[Hm.DT_FLOAT=1]="DT_FLOAT",Hm[Hm.DT_DOUBLE=2]="DT_DOUBLE",Hm[Hm.DT_INT32=3]="DT_INT32",Hm[Hm.DT_UINT8=4]="DT_UINT8",Hm[Hm.DT_INT16=5]="DT_INT16",Hm[Hm.DT_INT8=6]="DT_INT8",Hm[Hm.DT_STRING=7]="DT_STRING",Hm[Hm.DT_COMPLEX64=8]="DT_COMPLEX64",Hm[Hm.DT_INT64=9]="DT_INT64",Hm[Hm.DT_BOOL=10]="DT_BOOL",Hm[Hm.DT_QINT8=11]="DT_QINT8",Hm[Hm.DT_QUINT8=12]="DT_QUINT8",Hm[Hm.DT_QINT32=13]="DT_QINT32",Hm[Hm.DT_BFLOAT16=14]="DT_BFLOAT16",Hm[Hm.DT_FLOAT_REF=101]="DT_FLOAT_REF",Hm[Hm.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",Hm[Hm.DT_INT32_REF=103]="DT_INT32_REF",Hm[Hm.DT_UINT8_REF=104]="DT_UINT8_REF",Hm[Hm.DT_INT16_REF=105]="DT_INT16_REF",Hm[Hm.DT_INT8_REF=106]="DT_INT8_REF",Hm[Hm.DT_STRING_REF=107]="DT_STRING_REF",Hm[Hm.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",Hm[Hm.DT_INT64_REF=109]="DT_INT64_REF",Hm[Hm.DT_BOOL_REF=110]="DT_BOOL_REF",Hm[Hm.DT_QINT8_REF=111]="DT_QINT8_REF",Hm[Hm.DT_QUINT8_REF=112]="DT_QUINT8_REF",Hm[Hm.DT_QINT32_REF=113]="DT_QINT32_REF",Hm[Hm.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",Xm=qm||(qm={}),(Ym=Xm.CheckpointFormatVersion||(Xm.CheckpointFormatVersion={}))[Ym.LEGACY=0]="LEGACY",Ym[Ym.V1=1]="V1",Ym[Ym.V2=2]="V2";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Km,Zm;(Zm=Km||(Km={}))[Zm.FAIL=0]="FAIL",Zm[Zm.SHORTEST=1]="SHORTEST",Zm[Zm.LONGEST=2]="LONGEST";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Jm(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&s("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qm=Us;class ty extends e{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new t(this,Vi())}nextDataId(){return ty.nextDataId++}write(t,e,n){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&Pu("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:n,refCount:1}),i}makeTensorInfo(t,e,n){let i;if("string"===e&&null!=n&&n.length>0&&M(n[0])){const r=n.map((t=>te(t)));i=this.write(r,t,e)}else i=this.write(n,t,e);return{dataId:i,shape:t,dtype:e}}refCount(t){if(this.data.has(t)){return this.data.get(t).refCount}return 0}incRef(t){this.data.get(t).refCount++}decRef(t){if(this.data.has(t)){this.data.get(t).refCount--}}move(t,e,n,i,r){this.data.set(t,{values:e,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){return zu(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return this.data.get(t).values}bufferSync(t){const e=this.readSync(t.dataId);let n=e;if("string"===t.dtype)try{n=e.map((t=>ee(t)))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ln(t.shape,t.dtype,n)}makeOutput(t,e,n){const i=this.write(t,e,n);return Vi().makeTensorFromDataId(i,e,n,this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(t);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=Qt();t();return{kernelMs:Qt()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Jm([t],"where");const e=this.readSync(t.dataId);return Qm(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ey(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}ty.nextDataId=0;const ny={kernelName:"Abs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend;Jm(e,"abs");let i=new Float32Array(h(e.shape));return i=ey(n.data.get(e.dataId).values),n.makeOutput(i,e.shape,"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iy(t){return(e,n,i,r,o)=>{const a=lo(e,n),s=a.length,l=F(a),u=b(o,h(a)),c=e.length,d=n.length,p=F(e),f=F(n),g=ao(e,a),m=ao(n,a);if(g.length+m.length===0)for(let e=0;e<u.length;++e)u[e]=t(i[e%i.length],r[e%r.length]);else for(let e=0;e<u.length;++e){const n=W(e,s,l),o=n.slice(-c);g.forEach((t=>o[t]=0));const a=V(o,c,p),h=n.slice(-d);m.forEach((t=>h[t]=0));const y=V(h,d,f);u[e]=t(i[a],r[y])}return[u,a]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(t){const{inputs:e,backend:n}=t,{real:i,imag:r}=e,o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,s=n.makeTensorInfo(i.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(i.shape,"float32",o),imag:n.makeTensorInfo(r.shape,"float32",a)},s}const oy={kernelName:"Complex",backendName:"cpu",kernelFunc:ry};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ay(t,e,n="float32"){if("complex64"===n){return ry({inputs:{real:ay(t,e,"float32"),imag:ay(t,e,"float32")},backend:t})}const i=P(h(e),n);return t.makeTensorInfo(e,n,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const ly={kernelName:"Identity",backendName:"cpu",kernelFunc:sy};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uy(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.data.get(i.dataId).complexTensorInfos.real,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const cy={kernelName:"Real",backendName:"cpu",kernelFunc:uy};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hy(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dtype:o}=i;if("complex64"===o){if("complex64"===r.dtype)return sy({inputs:{x:r},backend:n});const t=ay(n,r.shape,r.dtype),e=hy({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),i=ry({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),i}if("complex64"===r.dtype){const t=uy({inputs:{input:r},backend:n}),e=hy({inputs:{x:t},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(t),e}if(!S(r.dtype,o)){const t=sy({inputs:{x:r},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:o}}if("int32"===o){const t=n.data.get(r.dataId).values,e=Int32Array.from(t);return n.makeTensorInfo(r.shape,"int32",e)}if("bool"===o){const t=n.data.get(r.dataId).values,e=Jt([0],r.dtype),[i,o]=iy(((t,e)=>t!==e?1:0))(r.shape,[],t,e,"bool");return n.makeTensorInfo(o,"bool",i)}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const dy={kernelName:"Cast",backendName:"cpu",kernelFunc:hy};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function py(t,e,n,i){return null==n?({inputs:n,backend:r})=>{const{a:o,b:a}=n,s=r;Jm([o,a],t);const l=s.data.get(o.dataId).values,u=s.data.get(a.dataId).values,c="string"===o.dtype?oc(l):l,h="string"===o.dtype?oc(u):u,d=i||o.dtype,[p,f]=e(o.shape,a.shape,c,h,d);return s.makeTensorInfo(f,d,p)}:({inputs:t,backend:r})=>{const{a:o,b:a}=t,s=r;if("complex64"===o.dtype||"complex64"===a.dtype){const t=hy({inputs:{x:o},backend:s,attrs:{dtype:"complex64"}}),e=s.data.get(t.dataId),i=e.complexTensorInfos.real,r=e.complexTensorInfos.imag,l=s.data.get(i.dataId).values,u=s.data.get(r.dataId).values,c=hy({inputs:{x:a},backend:s,attrs:{dtype:"complex64"}}),h=s.data.get(c.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=s.data.get(d.dataId).values,g=s.data.get(p.dataId).values,[m,y,v]=n(o.shape,a.shape,l,u,f,g),x=s.makeTensorInfo(v,"float32",m),b=s.makeTensorInfo(v,"float32",y),w=ry({inputs:{real:x,imag:b},backend:s});return s.disposeIntermediateTensorInfo(t),s.disposeIntermediateTensorInfo(c),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(b),w}{const t=s.data.get(o.dataId).values,n=s.data.get(a.dataId).values,r=i||o.dtype,[l,u]=e(o.shape,a.shape,t,n,r);return s.makeTensorInfo(u,r,l)}}}function fy(t){return(e,n,i,r,o,a)=>{const s=lo(e,n),l=h(s),u=s.length,c=F(s),d=b("float32",l),p=b("float32",l),f=ao(e,s),g=ao(n,s),m=zu(i,r),y=zu(o,a),v=e.length,x=F(e),w=n.length,_=F(n);if(f.length+g.length===0)for(let e=0;e<d.length;e++){const n=e%m.length,i=e%y.length,r=t(m[2*n],m[2*n+1],y[2*i],y[2*i+1]);d[e]=r.real,p[e]=r.imag}else for(let e=0;e<d.length;e++){const n=W(e,u,c),i=n.slice(-v);f.forEach((t=>i[t]=0));const r=V(i,v,x),o=n.slice(-w);g.forEach((t=>o[t]=0));const a=V(o,w,_),s=t(m[2*r],m[2*r+1],y[2*a],y[2*a+1]);d[e]=s.real,p[e]=s.imag}return[d,p,s]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gy=iy(((t,e)=>t+e)),my=py("Add",gy,fy(((t,e,n,i)=>({real:t+n,imag:e+i})))),yy={kernelName:"Add",backendName:"cpu",kernelFunc:my};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vy(t,e,n,i,r){const o=h(i),a=P(r,n);for(let n=0;n<t.length;n++){const i=t[n];if(i<0)throw new Error("Input x must be non-negative!");i>=r||(a[i]+=o>0?e[n]:1)}return a}function xy(t,e,n,i=!1){const r=t.shape[0],o=t.shape[1],a=Ln([r,n],e.dtype);for(let s=0;s<r;s++)for(let r=0;r<o;r++){const o=t.get(s,r);if(o<0)throw new Error("Input x must be non-negative!");o>=n||(i?a.set(1,s,o):e.size>0?a.set(a.get(s,o)+e.get(s,r),s,o):a.set(a.get(s,o)+1,s,o))}return a}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function by(t){return(e,n,i)=>{const r=b(n,e.length);for(let n=0;n<e.length;++n)r[n]=t(e[n],i);return r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wy(t,e,n){return({inputs:i,attrs:r,backend:o})=>{const{x:a}=i;if(Jm(a,t),"string"===a.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const s=o,l=s.data.get(a.dataId).values,u=h(a.shape),c=n||a.dtype,d=w(c,u);for(let t=0;t<u;++t)d[t]=e(l[t],r);return s.makeTensorInfo(a.shape,c,d)}}function _y(t,e,n){return({inputs:i,attrs:r,backend:o})=>{const{x:a}=i;if(Jm(a,t),"string"===a.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const s=o,l=s.data.get(a.dataId).values,u=n||a.dtype,c=e(l,u,r);return s.makeTensorInfo(a.shape,u,c)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ky=by((t=>Math.ceil(t))),Sy={kernelName:"Ceil",backendName:"cpu",kernelFunc:_y("Ceil",ky)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cy(t,e,n,i){const r=w(n,h(e));if(i&&"string"!==n){let e=0;t.forEach((t=>{const n=h(t.shape);r.set(t.vals,e),e+=n}))}else{let i=0;t.forEach((t=>{const o="string"===n?oc(t.vals):t.vals;let a=0;for(let n=0;n<t.shape[0];++n){const s=n*e[1]+i;for(let e=0;e<t.shape[1];++e)r[s+e]=o[a++]}i+=t.shape[1]}))}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ay=iy(((t,e)=>t===e?1:0)),Iy=py("Equal",Ay,null,"bool"),My={kernelName:"Equal",backendName:"cpu",kernelFunc:Iy},Dy=by((t=>Math.exp(t))),Ty=_y(Q,Dy),Ey={kernelName:Q,backendName:"cpu",kernelFunc:Ty},Ny=by((t=>Math.expm1(t))),Oy={kernelName:"Expm1",backendName:"cpu",kernelFunc:_y("Expm1",Ny)},Fy=by((t=>Math.floor(t))),Ry={kernelName:"Floor",backendName:"cpu",kernelFunc:_y("Floor",Fy)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ly(t,e,n,i,r,o,a,s,l){const u=Ln([i,o],n);for(let n=0;n<i;n++){const i=[];let c=0;for(let e=0;e<r;e++){const o=t[n*r+e];c+=o*a[e],i.push(o)}if(c<0||c>=l/o)throw new Error(`Invalid indices: ${i} does not index into ${s}`);for(let t=0;t<o;t++)u.values[n*o+t]=e.get(...e.indexToLoc(c*o+t))}return u}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $y(t,e,n){const i=Ln(n,t.dtype);for(let n=0;n<i.size;++n){const r=i.indexToLoc(n).slice(),o=r[0],a=r[2],s=e.locToIndex([o,a]);r[2]=e.values[s];const l=t.locToIndex(r);i.values[n]=t.values[l]}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Py=iy(((t,e)=>t>e?1:0)),zy={kernelName:"Greater",backendName:"cpu",kernelFunc:py("Greater",Py,null,"bool")},By=iy(((t,e)=>t>=e?1:0)),Vy={kernelName:"GreaterEqual",backendName:"cpu",kernelFunc:py("GreaterEqual",By,null,"bool")},Wy=iy(((t,e)=>t<e?1:0)),jy={kernelName:"Less",backendName:"cpu",kernelFunc:py("Less",Wy,null,"bool")},Uy=iy(((t,e)=>t<=e?1:0)),Gy={kernelName:"LessEqual",backendName:"cpu",kernelFunc:py("LessEqual",Uy,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hy(t,e,n){const i=(e-t)/(n-1),r=P(n,"float32");r[0]=t;for(let t=1;t<r.length;t++)r[t]=r[t-1]+i;return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qy=by((t=>Math.log(t))),Xy={kernelName:"Log",backendName:"cpu",kernelFunc:_y("Log",qy)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yy(t,e,n,i){const r=b(i,h(n));for(let n=0;n<r.length;++n){const i=n*e;let o=t[i];for(let n=0;n<e;++n){const e=t[i+n];(Number.isNaN(e)||e>o)&&(o=e)}r[n]=o}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ky=iy(((t,e)=>Math.max(t,e))),Zy={kernelName:"Maximum",backendName:"cpu",kernelFunc:py("Maximum",Ky)},Jy=iy(((t,e)=>Math.min(t,e))),Qy={kernelName:"Minimum",backendName:"cpu",kernelFunc:py("Minimum",Jy)},tv=iy(((t,e)=>t*e)),ev=fy(((t,e,n,i)=>({real:t*n-e*i,imag:t*i+e*n}))),nv=py("Multiply",tv,ev),iv={kernelName:"Multiply",backendName:"cpu",kernelFunc:nv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rv(t,e,n){const i=Zt(-1,n);return tv([],e,i,t,n)}const ov={kernelName:"Neg",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e;Jm(i,"neg");const r=n.data.get(i.dataId).values,[o,a]=rv(r,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,o)}},av=iy(((t,e)=>t!==e?1:0)),sv={kernelName:"NotEqual",backendName:"cpu",kernelFunc:py("NotEqual",av,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lv(t,e,n,i,r){const o=e.length,a=h(e),s=F(e),l=F(r),u=b(n,h(r));for(let e=0;e<a;++e){const n=W(e,o,s),r=new Array(n.length);for(let t=0;t<r.length;t++)r[t]=n[i[t]];u[V(r,o,l)]=t[e]}return u}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(t){const{inputs:e,attrs:n,backend:i}=t,{x:r}=e,{perm:o}=n;Jm(r,"transpose");const a=r.shape.length,s=new Array(a);for(let t=0;t<s.length;t++)s[t]=r.shape[o[t]];const l=lv(i.data.get(r.dataId).values,r.shape,r.dtype,o,s);return{dataId:i.write(l,s,r.dtype),shape:s,dtype:r.dtype}}const cv={kernelName:"Transpose",backendName:"cpu",kernelFunc:uv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hv(t,e,n,i){const[r,o]=Ko(t,i),a=Me(e,"int32"),s=P(h(r),a),l=h(o);for(let t=0;t<s.length;++t){const e=t*l;let i=1;for(let t=0;t<l;++t)i*=n[e+t];s[t]=i}return{outVals:s,outShape:r,outDtype:a}}const dv={kernelName:"Prod",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;Jm(r,"prod");const s=r.shape.length,l=v(o,r.shape),u=Qo(l,s);let c=l,h=r;const d=[];null!=u&&(h=uv({inputs:{x:r},backend:n,attrs:{perm:u}}),d.push(h),c=ea(c.length,s));const p=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:m}=hv(h.shape,h.dtype,p,c);let y=g;return a&&(y=Zo(g,l)),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,m,f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pv(t,e,n,i){if(t===e||t<e&&n<0||e<t&&n>1)return P(0,i);const r=P(Math.abs(Math.ceil((e-t)/n)),i);e<t&&1===n&&(n=-1),r[0]=t;for(let t=1;t<r.length;t++)r[t]=r[t-1]+n;return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fv=by((t=>1/Math.sqrt(t))),gv={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:_y("Rsqrt",fv)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mv(t,e,n,i,r){const o=Mi(i,e,n),a=h(n),s=F(i);if(o){const n=Di(e,s);return"string"===r?t.slice(n,n+a):t.subarray(n,n+a)}const l=Ln(i,r,"string"===r?oc(t):t),u=Ln(n,r);for(let t=0;t<u.size;++t){const n=u.indexToLoc(t),i=n.map(((t,n)=>t+e[n]));u.set(l.get(...i),...n)}return"string"===r?ac(u.values):u.values}function yv(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:o,size:a}=i;Jm(r,"slice");const[s,l]=Ti(r,o,a);mi(r,s,l);const u=mv(n.data.get(r.dataId).values,s,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,u)}const vv={kernelName:"Slice",backendName:"cpu",kernelFunc:yv};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(t,e,n,i,r,o,a){const s=e[0],l=o[0],u=new Array(l),c=new Array(s),h=e[1];if(0===l){if(0!==s)throw new Error(`Received SparseTensor with denseShape[0] = 0 but\n         indices.shape[0] = ${s}`);return[w(n,0),[0,h],w(r,0),u,c]}let d=!0,p=0;const f=new Array(l).fill(0);for(let e=0;e<s;++e){const n=t[e*h];if(n<0)throw new Error(`indices(${e}, 0) is invalid: ${n} < 0`);if(n>=l)throw new Error(`indices(${e}, 0) is invalid: ${n} >= ${l}`);++f[n],d=d&&n>=p,p=n}let g=!0;for(let t=0;t<l;++t){const e=0===f[t];u[t]=e,g=g&&!e,f[t]=Math.max(f[t],1),t>0&&(f[t]+=f[t-1])}if(g&&d){const e=t,n=i;for(let t=0;t<s;++t)c[t]=t;return[e,[s,h],n,u,c]}{const e=f[l-1],o=w(n,e*h),d=w(r,e),p=new Array(l).fill(0);for(let e=0;e<s;++e){const n=t[e*h],r=p[n],a=(0===n?0:f[n-1])+r;p[n]++;for(let n=0;n<h;++n)o[a*h+n]=t[e*h+n];d[a]=i[e],c[e]=a}for(let t=0;t<l;++t){if(0===p[t]){const e=0===t?0:f[t-1];o[e*h+0]=t;for(let t=1;t<h;++t)o[e*h+t]=0;d[e]=a}}return[o,[e,h],d,u,c]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bv(t,e,n,i,r){const o=h(i),a=e[0],s=r.length,l=[];let u=1,c=-1;for(let t=0;t<s;++t){const e=r[t];if(-1===e){if(-1!==c)throw new Error(`only one output dimension may be -1, not both ${c} and ${t}`);c=t,l.push(1)}else{if(e<0)throw new Error(`size ${t} must be non-negative, not ${e}`);u*=e,l.push(e)}}if(-1!==c){if(u<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(o/u);if(u*t!==o)throw new Error(`Input to reshape is a SparseTensor with ${o}\n          dense values, but the requested shape requires a multiple of ${u}. inputShape=${i} outputShape= ${l}`);l[c]=t}const d=h(l);if(d!==o)throw new Error(`Input to reshape is a tensor with ${o} dense values, but the requested shape has ${d}. inputShape=${i} outputShape=${l}`);const p=i.length,f=[];if(p>0){f[p-1]=1;for(let t=p-2;t>=0;--t)f[t]=f[t+1]*i[t+1]}const g=[];if(s>0){g[s-1]=1;for(let t=s-2;t>=0;--t)g[t]=g[t+1]*l[t+1]}const m=w(n,a*s);for(let e=0;e<a;++e){let n=0;for(let i=0;i<p;++i)n+=t[e*p+i]*f[i];for(let t=0;t<s;++t)m[e*s+t]=Math.trunc(n/g[t]),n%=g[t]}return[m,[a,s],l]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wv(t,e,n,i,r,o=!1,a=0){const s=i.length;if(s!==r.length)throw new Error("segmentIds and indices should have same size.");const l=[e[0],t.length/e[0]],u=l[1],c=s>0?r[s-1]+1:0;if(c<0)throw new Error("segment ids must be >= 0");const h=e.slice();h[0]=c;const d=w(n,h.reduce(((t,e)=>t*e),1));if(0===s)return c>0&&d.fill(a),[d,h];if(c<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,g=0,m=r[p];for(;;){let e=0;if(f<s){if(e=r[f],m===e){++f;continue}if(m>=e)throw new Error("segment ids are not increasing")}if(m<0||m>=c)throw new Error(`Segment id ${m} out of range [0, ${c}), possibly because segmentIds input is not sorted.`);m>g&&d.fill(a,g*u,m*u);for(let e=p;e<f;++e){const n=i[e];if(n<0||n>=l[0])throw new Error(`Bad: indices[${e}] == ${i[e]} out of range [0, ${l[0]})`);for(let e=0;e<u;e++)d[m*u+e]+=t[n*u+e]}if(o)for(let t=0;t<u;t++)d[m*u+t]/=f-p;if(p=f,++f,g=m+1,m=e,f>s)break}return g<c&&d.fill(a,g*u,c*u),[d,h]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _v=iy(((t,e)=>{const n=t-e;return n*n})),kv={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:py("SquaredDifference",_v)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Sv(t,e,n,i){const r=Ln(t,e.dtype);for(let t=0;t<r.size;t++){const o=r.indexToLoc(t),a=new Array(o.length);for(let t=0;t<a.length;t++)a[t]=o[t]*n[t]+i[t];r.set(e.get(...a),...o)}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cv{constructor(t,e,n,i,r,o){this.separator=te(t),this.nGramWidths=e,this.leftPad=te(n),this.rightPad=te(i),this.padWidth=r,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,i,r,o){for(let a=0;a<r;++a){const s=this.getPadWidth(o),l=Math.max(0,s-a),u=Math.max(0,s-(r-(a+1))),c=o-(l+u),h=e+(l>0?0:a-s);let d=0;d+=l*this.leftPad.length;for(let e=0;e<c;++e)d+=t[h+e].length;d+=u*this.rightPad.length;d+=(l+u+c-1)*this.separator.length,n[i+a]=new Uint8Array(d);const p=n[i+a];let f=0;const g=t=>t.forEach((t=>p[f++]=t));for(let t=0;t<l;++t)g(this.leftPad),g(this.separator);for(let e=0;e<c-1;++e)g(t[h+e]),g(this.separator);if(c>0){g(t[h+c-1]);for(let t=0;t<u;++t)g(this.separator),g(this.rightPad)}else{for(let t=0;t<u-1;++t)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(t,e){const n=t.length,i=e.length;if(i>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let r=1;r<i;++r){let i=e[r]>=t;if(i=i&&e[r]<=n,!i)throw new Error(`Invalid split value ${e[r]}, must be in [${t}, ${n}]`);t=e[r]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const r=i-1,o=w("int32",i);if(0===n||0===i){const t=new Array(n);for(let t=0;t<=r;++t)o[t]=0;return[t,o]}o[0]=0;for(let t=1;t<=r;++t){const n=e[t]-e[t-1];let i=0;this.nGramWidths.forEach((t=>{i+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===i&&(i=1),o[t]=o[t-1]+i}const a=new Array(o[r]);for(let n=0;n<r;++n){const i=e[n];let r=o[n];if(this.nGramWidths.forEach((o=>{const s=e[n+1]-e[n],l=this.getNumNGrams(s,o);this.createNGrams(t,i,a,r,l,o),r+=l})),this.preserveShort&&r===o[n]){const o=e[n+1]-e[n];if(0===o)continue;const s=o+2*this.padWidth,l=1;this.createNGrams(t,i,a,r,l,s)}}return[a,o]}}function Av(t,e,n,i,r,o,a,s){return new Cv(n,i,r,o,a,s).compute(t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iv(t,e,n){if(!t.length)return[];if(0===e.length){const e=new Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.subarray(n,n+1);return e}if(1===e.length){const i=e[0],r=[];let o=t.indexOf(i);for(;-1!==o;){const e=t.subarray(0,o);n&&0===e.length||r.push(e),o=(t=t.subarray(o+1)).indexOf(i)}return n&&0===t.length||r.push(t),r}const i=[];let r=0;for(let o=0;o<t.length+1;o++)if(o===t.length||-1!==e.indexOf(t[o])){const e=t.subarray(r,o);n&&0===e.length||i.push(e),r=o+1}return i}function Mv(t,e,n){const i=t.length,r=[];let o=0,a=0;const s=new Array(i);for(let l=0;l<i;++l){const i=Iv(t[l],e,n),u=i.length;s[l]=u,o+=u,a=Math.max(a,u),r.push(...i)}const l=w("int32",2*o),u=new Array(o),c=[i,a];let h=0;for(let t=0;t<i;++t)for(let e=0;e<s[t];++e)l[2*h]=t,l[2*h+1]=e,u[h]=r[h],++h;return[l,u,c]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dv(t,e){const n=w("int32",t.length);for(let i=0;i<t.length;++i)n[i]=Kt(t[i]).modulo(e).getLowBitsUnsigned();return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tv=iy(((t,e)=>t-e)),Ev=fy(((t,e,n,i)=>({real:t-n,imag:e-i}))),Nv=py(nt,Tv,Ev),Ov={kernelName:nt,backendName:"cpu",kernelFunc:Nv};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fv(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const i=Ln(n,t.dtype);for(let e=0;e<i.values.length;++e){const n=i.indexToLoc(e),r=new Array(t.rank);for(let e=0;e<r.length;e++)r[e]=n[e]%t.shape[e];const o=t.locToIndex(r);i.values[e]=t.values[o]}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rv(t,e,n,i,r){const o=e[e.length-1],[a,s]=[t.length/o,o],l=b(n,a*i),u=b("int32",a*i);for(let e=0;e<a;e++){const n=e*s,r=t.subarray(n,n+s),o=[];for(let t=0;t<r.length;t++)o.push({value:r[t],index:t});o.sort(((t,e)=>e.value-t.value));const a=e*i,c=l.subarray(a,a+i),h=u.subarray(a,a+i);for(let t=0;t<i;t++)c[t]=o[t].value,h[t]=o[t].index}const c=e.slice();return c[c.length-1]=i,[Ln(c,n,l),Ln(c,"int32",u)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(t,e,n,i){const r=v(e,n)[0],o=[1,n[0],1];for(let t=0;t<r;t++)o[0]*=n[t];o[1]=n[r];for(let t=r+1;t<n.length;t++)o[2]*=n[t];const a={},s=new Int32Array(n[r]),l=new he(o,i,t),u=[],c=1===o[0]&&1===o[2];for(let e=0;e<n[r];e++){let n;if(c)n=t[e].toString();else{const t=[];for(let n=0;n<o[0];n++)for(let i=0;i<o[2];i++)t.push(l.get(n,e,i));n=t.join(",")}if(void 0!==a[n])s[e]=a[n];else{const t=Object.keys(a).length;a[n]=t,s[e]=t,u.push(e)}}const h=o.slice();h[1]=Object.keys(a).length;const d=new he(h,i);u.forEach(((t,e)=>{for(let n=0;n<o[0];n++)for(let i=0;i<o[2];i++)d.set(l.get(n,t,i),n,e,i)}));const p=n.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $v=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",simpleAbsImpl:ey,addImpl:gy,bincountImpl:vy,bincountReduceImpl:xy,ceilImpl:ky,concatImpl:Cy,equalImpl:Ay,expImpl:Dy,expm1Impl:Ny,floorImpl:Fy,gatherNdImpl:Ly,gatherV2Impl:$y,greaterImpl:Py,greaterEqualImpl:By,lessImpl:Wy,lessEqualImpl:Uy,linSpaceImpl:Hy,logImpl:qy,maxImpl:Yy,maximumImpl:Ky,minimumImpl:Jy,multiplyImpl:tv,negImpl:rv,notEqualImpl:av,prodImpl:hv,rangeImpl:pv,rsqrtImpl:fv,sliceImpl:mv,sparseFillEmptyRowsImpl:xv,sparseReshapeImpl:bv,sparseSegmentReductionImpl:wv,squaredDifferenceImpl:_v,stridedSliceImpl:Sv,stringNGramsImpl:Av,stringSplitImpl:Mv,stringToHashBucketFastImpl:Dv,subImpl:Tv,tileImpl:Fv,topKImpl:Rv,transposeImpl:lv,uniqueImpl:Lv});
/** @license See the LICENSE file. */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Hi("cpu",(()=>new ty),1);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Pv=wy("Elu",(t=>t>=0?t:Math.exp(t)-1)),zv={kernelName:"Elu",backendName:"cpu",kernelFunc:Pv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bv(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{alpha:o}=i;Jm([r],"leakyRelu");const a=h(r.shape),s=n.data.get(r.dataId).values,l=b("float32",a);for(let t=0;t<s.length;t++)l[t]=s[t]<0?o*s[t]:s[t];return n.makeTensorInfo(r.shape,"float32",l)}const Vv={kernelName:"LeakyRelu",backendName:"cpu",kernelFunc:Bv},Wv=iy(((t,e)=>t<0?e*t:t));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jv(t){const{inputs:e,backend:n}=t,{x:i,alpha:r}=e;Jm([i,r],"prelu");const o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,[s,l]=Wv(i.shape,r.shape,o,a,i.dtype);return n.makeTensorInfo(l,i.dtype,s)}const Uv={kernelName:"Prelu",backendName:"cpu",kernelFunc:jv},Gv=wy("Relu",(t=>Math.max(0,t))),Hv={kernelName:"Relu",backendName:"cpu",kernelFunc:Gv},qv=wy("Relu6",(t=>Math.min(Math.max(0,t),6))),Xv={kernelName:"Relu6",backendName:"cpu",kernelFunc:qv},Yv=wy("Sigmoid",(t=>1/(1+Math.exp(-t)))),Kv={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:Yv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zv(t,e,n,i,r){if("linear"===n)return sy({inputs:{x:e},backend:t});if("relu"===n)return Gv({inputs:{x:e},backend:t});if("elu"===n)return Pv({inputs:{x:e},backend:t});if("relu6"===n)return qv({inputs:{x:e},backend:t});if("prelu"===n)return jv({inputs:{x:e,alpha:i},backend:t});if("leakyrelu"===n)return Bv({inputs:{x:e},backend:t,attrs:{alpha:r}});if("sigmoid"===n)return Yv({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jv(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{shape:o}=i,a=h(r.shape),l=y(o,a),u=h(l);s(a===u,(()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(null!=c.complexTensorInfos){const t=c.complexTensorInfos.real,e=c.complexTensorInfos.imag;t.shape=l,e.shape=l}return{dataId:r.dataId,shape:l,dtype:r.dtype}}const Qv={kernelName:"Reshape",backendName:"cpu",kernelFunc:Jv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tx(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:o}=e,{transposeA:a,transposeB:l}=i;Jm([r,o],"matMul");const u=r.shape.length,c=o.shape.length,d=a?r.shape[u-2]:r.shape[u-1],p=l?o.shape[c-1]:o.shape[c-2],f=a?r.shape[u-1]:r.shape[u-2],g=l?o.shape[c-2]:o.shape[c-1],m=r.shape.slice(0,-2),y=o.shape.slice(0,-2),v=h(m),x=h(y);s(u>=2&&c>=2&&(v===x||1===v||1===x),(()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${y}).`));const b=(v>x?r.shape.slice(0,-2):o.shape.slice(0,-2)).concat([f,g]);s(d===p,(()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${a} and transposeB=${l} must match.`));const w=l?[x,g,p]:[x,p,g],_=Jv({inputs:{x:r},backend:n,attrs:{shape:a?[v,d,f]:[v,f,d]}}),k=Jv({inputs:{x:o},backend:n,attrs:{shape:w}}),S=a?_.shape[1]:_.shape[2],C=a?_.shape[2]:_.shape[1],A=l?k.shape[1]:k.shape[2],I=Math.max(v,x),M=n.data.get(_.dataId).values,D=n.data.get(k.dataId).values,T=F(_.shape),E=F(k.shape),[N,O,R]=a?[T[0],1,T[1]]:[T[0],T[1],1],[L,$,P]=l?[1,E[1],E[0]]:[E[1],1,E[0]],z=C*A,B=Ln([I,C,A],_.dtype),V=B.values,W=n.blockSize;for(let t=0;t<I;t++)for(let e=0;e<C;e+=W)for(let n=0;n<A;n+=W)for(let i=0;i<S;i+=W){const r=Math.min(e+W,C),o=Math.min(n+W,A),a=Math.min(i+W,S);for(let s=e;s<r;s++)for(let e=n;e<o;e++){let n=0;for(let r=i;r<a;r++){const i=Math.min(t,v-1)*N,o=Math.min(t,x-1)*P;n+=M[i+s*O+r*R]*D[r*L+e*$+o]}V[t*z+(s*A+e)]+=n}}return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(b,B.dtype,B.values)}const ex={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:tx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nx={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:o,bias:a,preluActivationWeights:s}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=i;let d,p,f;const g=[];d=tx({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:n}),a&&(p=my({inputs:{a:d,b:a},backend:n}),g.push(d),d=p),c&&(f=Zv(n,d,c,s,h),g.push(d),d=f);for(const t of g)n.disposeIntermediateTensorInfo(t);return d}},ix={kernelName:"Acos",backendName:"cpu",kernelFunc:wy("Acos",(t=>Math.acos(t)))},rx={kernelName:"Acosh",backendName:"cpu",kernelFunc:wy("Acosh",(t=>Math.acosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ox={kernelName:"AddN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,i=e;Jm(e,"addN");const r=i.map((t=>n.data.get(t.dataId).values)),o=Ln(i[0].shape,i[0].dtype),a=o.values;for(let t=0;t<i.length;t++){const e=r[t];for(let t=0;t<a.length;t++)a[t]+=e[t]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ax={kernelName:"All",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;Jm(r,"all");const s=v(o,r.shape);let l=s;const u=Qo(l,r.shape.length);let c=r;null!=u&&(c=uv({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ea(l.length,r.shape.length)),Jo("all",l,c.shape.length);const[d,p]=Ko(c.shape,l),f=h(p),g=P(h(d),c.dtype),m=n.data.get(c.dataId).values;for(let t=0;t<g.length;++t){const e=t*f;let n=m[e];for(let t=0;t<f;++t){const i=m[e+t];n=n&&i}g[t]=n}null!=u&&n.disposeIntermediateTensorInfo(c);const y=n.makeTensorInfo(d,c.dtype,g);if(a){const t=Jv({inputs:{x:y},backend:n,attrs:{shape:Zo(d,s)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sx={kernelName:"Any",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;Jm(r,"any");const s=v(o,r.shape);let l=s;const u=Qo(l,r.shape.length);let c=r;null!=u&&(c=uv({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ea(l.length,r.shape.length)),Jo("any",l,c.shape.length);const[d,p]=Ko(c.shape,l),f=h(p),g=P(h(d),c.dtype),m=n.data.get(c.dataId).values;for(let t=0;t<g.length;++t){const e=t*f;let n=m[e];for(let t=0;t<f;++t){const i=m[e+t];n=n||i}g[t]=n}null!=u&&n.disposeIntermediateTensorInfo(c);const y=n.makeTensorInfo(d,c.dtype,g);if(a){const t=Jv({inputs:{x:y},backend:n,attrs:{shape:Zo(d,s)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lx={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o}=i;Jm(r,"argMax");let a=v(o,r.shape);const s=Qo(a,r.shape.length);let l=r;const u=[];null!=s&&(l=uv({inputs:{x:r},backend:n,attrs:{perm:s}}),u.push(l),a=ea(a.length,l.shape.length)),a=[a[0]],Jo("argMax",a,l.shape.length);const[c,d]=Ko(l.shape,a),p=P(h(c),"int32"),f=h(d),g=n.data.get(l.dataId).values;for(let t=0;t<p.length;++t){const e=t*f;let n=g[e],i=0;for(let t=0;t<f;++t){const r=g[e+t];r>n&&(n=r,i=t)}p[t]=i}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c,"int32",p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ux={kernelName:"ArgMin",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o}=i;Jm(r,"argMin");let a=v(o,r.shape);const s=Qo(a,r.shape.length);let l=r;const u=[];null!=s&&(l=uv({inputs:{x:r},backend:n,attrs:{perm:s}}),u.push(l),a=ea(a.length,l.shape.length)),a=[a[0]],Jo("argMin",a,l.shape.length);const[c,d]=Ko(l.shape,a),p=P(h(c),"int32"),f=h(d),g=n.data.get(l.dataId).values;for(let t=0;t<p.length;++t){const e=t*f;let n=g[e],i=0;for(let t=0;t<f;++t){const r=g[e+t];r<n&&(n=r,i=t)}p[t]=i}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c,"int32",p)}},cx={kernelName:"Asin",backendName:"cpu",kernelFunc:wy("Asin",(t=>Math.asin(t)))},hx={kernelName:"Asinh",backendName:"cpu",kernelFunc:wy("Asinh",(t=>Math.asinh(t)))},dx={kernelName:"Atan",backendName:"cpu",kernelFunc:wy("Atan",(t=>Math.atan(t)))},px={kernelName:"Atan2",backendName:"cpu",kernelFunc:py("Atan2",iy(((t,e)=>Math.atan2(t,e))))},fx={kernelName:"Atanh",backendName:"cpu",kernelFunc:wy("Atanh",(t=>Math.atanh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gx(t,e,n,i,r,o){const a=r.strideHeight,s=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Ln(r.outShape,n),m=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],x=r.outShape[3];for(let e=0;e<r.batchSize;++e){const n=e*y,g=e*i[0];for(let e=0;e<r.inChannels;++e)for(let y=0;y<r.outHeight;++y){const b=y*a-d,w=Math.max(0,b),_=Math.min(r.inHeight,c+b),k=n+y*v;for(let n=0;n<r.outWidth;++n){const a=n*s-p,c=Math.max(0,a),d=Math.min(r.inWidth,h+a);let y=f,v=0,b=0;for(let n=w;n<_;n+=l){const r=g+n*i[1];for(let n=c;n<d;n+=u){const a=t[r+n*i[2]+e];"max"===o&&a>y?y=a:"avg"===o&&(v+=a,b++)}if(isNaN(y))break}m[k+n*x+e]="avg"===o?v/b:y}}}return g}function mx(t,e,n,i,r=!1,o=!1){const a=Ln(i.outShape,"int32"),s=i.strideHeight,l=i.strideWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,p=i.padInfo.top,f=i.padInfo.left,g=Ln(e,n,t);for(let t=0;t<i.batchSize;++t)for(let e=0;e<i.inChannels;++e)for(let n=0;n<i.outHeight;++n){const m=n*s-p;let y=m;for(;y<0;)y+=u;const v=Math.min(i.inHeight,h+m);for(let s=0;s<i.outWidth;++s){const h=s*l-f;let p=h;for(;p<0;)p+=c;const x=Math.min(i.inWidth,d+h);let b=Number.NEGATIVE_INFINITY,w=-1;for(let n=y;n<v;n+=u){const a=n-m;for(let s=p;s<x;s+=c){const l=s-h,u=g.get(t,n,s,e);u>b&&(b=u,w=r?o?((t*i.inHeight+n)*i.inWidth+s)*i.inChannels+e:(n*i.inWidth+s)*i.inChannels+e:a*d+l)}}a.set(w,t,n,s,e)}}return a}function yx(t,e,n,i,r,o){const a=r.strideDepth,s=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left,v="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Ln(r.outShape,n),b=x.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],S=r.outShape[4];for(let e=0;e<r.batchSize;++e){const n=e*w,x=e*i[0];for(let e=0;e<r.inChannels;++e)for(let w=0;w<r.outDepth;++w){const C=w*a-g;let A=C;for(;A<0;)A+=u;const I=Math.min(r.inDepth,d+C),M=n+w*_;for(let n=0;n<r.outHeight;++n){const a=n*s-m;let d=a;for(;d<0;)d+=c;const g=Math.min(r.inHeight,p+a),w=M+n*k;for(let n=0;n<r.outWidth;++n){const a=n*l-y;let s=a;for(;s<0;)s+=h;const p=Math.min(r.inWidth,f+a),m=w+n*S;let _=v,k=0,C=0;for(let n=A;n<I;n+=u){const r=x+n*i[1];for(let n=d;n<g;n+=c){const a=r+n*i[2];for(let n=s;n<p;n+=h){const r=t[a+n*i[3]+e];if("max"===o&&r>_?_=r:"avg"===o&&(k+=r,C++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}b[m+e]="avg"===o?k/C:_}}}}return x}const vx={kernelName:"AvgPool",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Jm(r,"avgPool");const{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=i;s(_r(a,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const c=dr(r.shape,o,a,1,l,u);let h;if(1===c.filterWidth&&1===c.filterHeight&&d(c.inShape,c.outShape))h=sy({inputs:{x:r},backend:n});else{const t=n.data.get(r.dataId).values,e=F(r.shape),i=gx(t,r.shape,r.dtype,e,c,"avg");h=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xx={kernelName:"AvgPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:o,strides:a,pad:s,dimRoundingMode:l,dataFormat:u}=i;Jm(r,"avgPool3d");const c=pr(r.shape,o,a,1,s,l,u),h=yx(n.data.get(r.dataId).values,r.shape,r.dtype,F(r.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bx={kernelName:"AvgPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,{filterSize:a,strides:s,pad:l,dimRoundingMode:u}=i;Jm([r,o],"avgPool3DGrad");const c=pr(o.shape,a,s,1,l,u),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,f=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,v=c.dilationHeight,x=c.dilationWidth,b=c.effectiveFilterDepth,w=c.effectiveFilterHeight,_=c.effectiveFilterWidth,k=b-1-c.padInfo.front,S=_-1-c.padInfo.left,C=w-1-c.padInfo.top,A=Ln(o.shape,"float32"),I=1/(f*g*m),M=n.bufferSync(r);for(let t=0;t<c.batchSize;++t)for(let e=0;e<c.inChannels;++e)for(let n=0;n<c.inDepth;++n)for(let i=0;i<c.inHeight;++i)for(let r=0;r<c.inWidth;++r){const o=n-k,a=i-C,s=r-S;let l=0;for(let n=0;n<b;n+=y){const i=(o+n)/h;if(!(i<0||i>=c.outDepth||Math.floor(i)!==i))for(let n=0;n<w;n+=v){const r=(a+n)/d;if(!(r<0||r>=c.outHeight||Math.floor(r)!==r))for(let n=0;n<_;n+=x){const o=(s+n)/p;if(o<0||o>=c.outWidth||Math.floor(o)!==o)continue;l+=M.get(t,i,r,o,e)}}}A.set(l*I,t,n,i,r,e)}return n.makeTensorInfo(A.shape,A.dtype,A.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _x={kernelName:"AvgPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,a=o;Jm([r,o],"avgPoolGrad");const{filterSize:s,strides:l,pad:u}=i,c=dr(a.shape,s,l,1,u),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,f=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,v=c.effectiveFilterWidth,x=v-1-c.padInfo.left,b=y-1-c.padInfo.top,w=Ln(a.shape,"float32"),_=1/(p*f),k=n.data.get(r.dataId).values,S=Ln(r.shape,"float32",k);for(let t=0;t<c.batchSize;++t)for(let e=0;e<c.inChannels;++e)for(let n=0;n<c.inHeight;++n)for(let i=0;i<c.inWidth;++i){const r=n-b,o=i-x;let a=0;for(let n=0;n<y;n+=g){const i=(r+n)/h;if(!(i<0||i>=c.outHeight||Math.floor(i)!==i))for(let n=0;n<v;n+=m){const r=(o+n)/d;if(r<0||r>=c.outWidth||Math.floor(r)!==r)continue;a+=S.get(t,i,r,e)}}w.set(a*_,t,n,i,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kx={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,scale:o,offset:a,mean:l,variance:u}=e;s(l.shape.length===u.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),s(null==a||l.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),s(null==o||l.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),Jm([r,l,u,o,a],"batchNorm");let{varianceEpsilon:c}=i;null==c&&(c=.001);const h=n.data.get(r.dataId).values,d=n.data.get(l.dataId).values,p=n.data.get(u.dataId).values,f=o?n.data.get(o.dataId).values:new Float32Array([1]),g=a?n.data.get(a.dataId).values:new Float32Array([0]),m=new Float32Array(h.length),y=g.length,v=f.length,x=p.length,b=d.length;let w=0,_=0,k=0,S=0;for(let t=0;t<h.length;++t)m[t]=g[w++]+(h[t]-d[_++])*f[k++]/Math.sqrt(p[S++]+c),w>=y&&(w=0),_>=b&&(_=0),k>=v&&(k=0),S>=x&&(S=0);return n.makeTensorInfo(r.shape,r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sx={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:o,crops:a}=i;Jm([r],"batchToSpaceND");const s=o.reduce(((t,e)=>t*e)),l=Nu(r.shape,o,s),u=Ou(l.length,o.length),c=Fu(r.shape,o,s),h=Ru(a,o.length),d=Lu(c,a,o.length),p=Jv({inputs:{x:r},backend:n,attrs:{shape:l}}),f=uv({inputs:{x:p},backend:n,attrs:{perm:u}}),g=Jv({inputs:{x:f},backend:n,attrs:{shape:c}}),m=yv({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cx={kernelName:"Bincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:o}=e,{size:a}=i,s=vy(n.data.get(r.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,a);return n.makeTensorInfo([a],o.dtype,s)}},Ax={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:wy("ClipByValue",((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}))},Ix={kernelName:"ComplexAbs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend,i=new Float32Array(h(e.shape)),r=n.data.get(e.dataId),o=r.complexTensorInfos.real,a=r.complexTensorInfos.imag,s=n.data.get(o.dataId).values,l=n.data.get(a.dataId).values;for(let t=0;t<s.length;t++){const e=s[t],n=l[t];i[t]=Math.hypot(e,n)}return n.makeOutput(i,e.shape,"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mx(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.data.get(i.dataId).complexTensorInfos.imag,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const Dx={kernelName:"Imag",backendName:"cpu",kernelFunc:Mx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tx(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i,o=v(r,e[0].shape)[0];let a=Du(e.map((t=>t.shape)),o);if(0===h(a))return n.makeTensorInfo(a,e[0].dtype,[]);const s=e.filter((t=>h(t.shape)>0));if(1===s.length)return sy({inputs:{x:s[0]},backend:n});if(Mu(s.map((t=>t.shape)),o),"complex64"===s[0].dtype){const t=s.map((t=>uy({inputs:{input:t},backend:n}))),e=s.map((t=>Mx({inputs:{input:t},backend:n}))),i=Tx({inputs:t,backend:n,attrs:{axis:o}}),r=Tx({inputs:e,backend:n,attrs:{axis:o}}),a=ry({inputs:{real:i,imag:r},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),a}const l=s.map((t=>{const e=h(t.shape.slice(o));return Jv({inputs:{x:t},backend:n,attrs:{shape:[-1,e]}})})),u=l.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));a=Du(l.map((t=>t.shape)),1);const c=1===l[0].shape[0],d=Cy(u,a,e[0].dtype,c),p=Du(s.map((t=>t.shape)),o),f=n.makeTensorInfo(p,e[0].dtype,d);return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}const Ex={kernelName:"Concat",backendName:"cpu",kernelFunc:Tx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nx(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:s,dataFormat:l,dilations:u,dimRoundingMode:c}=i;Jm([r,o],"conv2d");const h=kr(l),d=fr(r.shape,o.shape,a,u,s,c,!1,h),p=d.filterHeight,f=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,y=d.padInfo.left,v=d.padInfo.top,x="channelsLast"===d.dataFormat,b=new he(d.outShape,r.dtype),w=F(r.shape),_=F(o.shape),k=w[0],S=x?w[1]:w[2],C=x?w[2]:1,A=x?1:w[1],I=b.strides[0],M=x?b.strides[1]:b.strides[2],D=x?b.strides[2]:1,T=x?1:b.strides[1],E=n.data.get(r.dataId).values,N=n.data.get(o.dataId).values,O=b.values;for(let t=0;t<d.batchSize;++t){const e=t*k,n=t*I;for(let t=0;t<d.outHeight;++t){const i=n+t*M,r=t*d.strideHeight-v;for(let t=0;t<p;++t){const n=r+t*g;if(n<0||n>=d.inHeight)continue;const o=t*_[0],a=e+n*S;for(let t=0;t<d.outWidth;++t){const e=i+t*D,n=t*d.strideWidth-y;for(let t=0;t<f;++t){const i=n+t*m;if(i<0||i>=d.inWidth)continue;const r=a+i*C;let s=o+t*_[1];for(let t=0;t<d.inChannels;++t){const n=E[r+t*A];for(let t=0;t<d.outChannels;++t)O[e+t*T]+=n*N[s+t];s+=d.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,O)}const Ox={kernelName:"Conv2D",backendName:"cpu",kernelFunc:Nx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fx={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,pad:s,dataFormat:l,dimRoundingMode:u,filterShape:c}=i;Jm([r,o],"conv2dBackpropFilter");const h=kr(l),d=fr(r.shape,c,a,1,s,u,!1,h),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:m}=d,y="channelsLast"===d.dataFormat,v=new he(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,w=n.data.get(r.dataId).values,_=n.data.get(o.dataId).values,k=new he(r.shape,r.dtype,w),S=new he(o.shape,o.dtype,_);for(let t=0;t<g;++t){const e=Math.max(0,Math.ceil((b-t)/p)),n=Math.min(d.outHeight,(d.inHeight+b-t)/p);for(let i=0;i<m;++i){const r=Math.max(0,Math.ceil((x-i)/f)),o=Math.min(d.outWidth,(d.inWidth+x-i)/f);for(let a=0;a<d.inChannels;++a)for(let s=0;s<d.outChannels;++s){let l=0;for(let u=0;u<d.batchSize;++u)for(let c=e;c<n;++c){const e=t+c*p-b;for(let t=r;t<o;++t){const n=i+t*f-x;l+=y?k.get(u,e,n,a)*S.get(u,c,t,s):k.get(u,a,e,n)*S.get(u,s,c,t)}}v.set(l,t,i,a,s)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rx={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{inputShape:a,strides:s,pad:l,dataFormat:u,dimRoundingMode:c}=i;Jm([r,o],"conv2dBackpropInput");const h=F(o.shape),d=F(r.shape);let p=kr(u);const f=fr(a,o.shape,s,1,l,c,!1,p),g=new he(f.inShape,"float32"),m=g.values,y=n.data.get(r.dataId).values,v=n.data.get(o.dataId).values,[x,b,w]=h,{batchSize:_,filterHeight:k,filterWidth:S,inChannels:C,inHeight:A,inWidth:I,outChannels:M,outHeight:D,outWidth:T,strideHeight:E,strideWidth:N}=f;p=f.dataFormat;const O=k-1-f.padInfo.top,R=S-1-f.padInfo.left,L="channelsLast"===p,$=g.strides[0],P=L?g.strides[1]:g.strides[2],z=L?g.strides[2]:1,B=L?1:g.strides[1],V=d[0],W=L?d[1]:d[2],j=L?d[2]:1,U=L?1:d[1];for(let t=0;t<_;++t)for(let e=0;e<C;++e)for(let n=0;n<A;++n){const i=n-O,r=Math.max(0,Math.ceil(i/E)),o=Math.min(D,(k+i)/E);for(let a=0;a<I;++a){const s=a-R,l=Math.max(0,Math.ceil(s/N)),u=Math.min(T,(S+s)/N);let c=0;for(let n=r;n<o;++n){const r=n*E-i;for(let i=l;i<u;++i){const o=V*t+W*n+j*i,a=x*(k-1-r)+b*(S-1-(i*N-s))+w*e;for(let t=0;t<M;++t){c+=y[o+U*t]*v[a+t]}}}m[$*t+P*n+z*a+B*e]=c}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lx={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:s,dilations:l}=i;Jm([r,o],"conv3d");const u=gr(r.shape,o.shape,a,l,s),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:m}=u,y=m.front,v=m.left,x=m.top,b=new he(u.outShape,r.dtype),w=n.data.get(r.dataId).values,_=n.data.get(o.dataId).values,k=b.values,S=F(r.shape),C=F(o.shape);for(let t=0;t<u.batchSize;++t){const e=t*S[0],n=t*b.strides[0];for(let t=0;t<u.outDepth;++t){const i=n+t*b.strides[1],r=t*u.strideDepth-y;for(let t=0;t<c;++t){const n=r+t*p;if(n<0||n>=u.inDepth)continue;const o=t*C[0],a=e+n*S[1];for(let t=0;t<u.outHeight;++t){const e=i+t*b.strides[2],n=t*u.strideHeight-x;for(let t=0;t<h;++t){const i=n+t*f;if(i<0||i>=u.inHeight)continue;const r=o+t*C[1],s=a+i*S[2];for(let t=0;t<u.outWidth;++t){const n=e+t*u.outChannels,i=t*u.strideWidth-v;for(let t=0;t<d;++t){const e=i+t*g;if(e<0||e>=u.inWidth)continue;const o=r+t*C[2],a=s+e*u.inChannels;let l=o;for(let t=0;t<u.inChannels;++t){const e=w[a+t];for(let t=0;t<u.outChannels;++t)k[n+t]+=e*_[l+t];l+=u.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $x={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,pad:s,filterShape:l}=i;Jm([r,o],"conv3dBackpropFilterV2");const u=F(r.shape),c=F(o.shape),h=gr(r.shape,l,a,1,s),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,g=h.filterDepth,m=h.filterHeight,y=h.filterWidth,v=new he(h.filterShape,"float32"),x=v.values,[b,w,_,k]=v.strides,S=n.data.get(o.dataId).values,[C,A,I,M]=c,D=n.data.get(r.dataId).values,[T,E,N,O]=u,R=h.padInfo.front,L=h.padInfo.left,$=h.padInfo.top;for(let t=0;t<g;++t){const e=Math.max(0,Math.ceil((R-t)/d)),n=Math.min(h.outDepth,(h.inDepth+R-t)/d),i=t*b;for(let r=0;r<m;++r){const o=Math.max(0,Math.ceil(($-r)/p)),a=Math.min(h.outHeight,(h.inHeight+$-r)/p),s=r*w+i;for(let i=0;i<y;++i){const l=Math.max(0,Math.ceil((L-i)/f)),u=Math.min(h.outWidth,(h.inWidth+L-i)/f),c=i*_+s;for(let s=0;s<h.inChannels;++s){const g=s*k+c;for(let c=0;c<h.outChannels;++c){let m=0;for(let g=0;g<h.batchSize;++g){const h=g*T,y=g*C;for(let g=e;g<n;++g){const e=(t+g*d-R)*E+h,n=g*A+y;for(let t=o;t<a;++t){const o=(r+t*p-$)*N+e,a=t*I+n;for(let t=l;t<u;++t){const e=t*M+a;m+=D[(i+t*f-L)*O+o+s]*S[e+c]}}}}x[g+c]=m}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Px={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{pad:a,strides:s,inputShape:l}=i;Jm([r],"conv3dBackpropInputV2");const u=F(r.shape),c=F(o.shape),h=gr(l,o.shape,s,1,a),d=new he(h.inShape,"float32"),p=d.values,[f,g,m,y]=d.strides,v=n.data.get(r.dataId).values,[x,b,w,_]=u,k=n.data.get(o.dataId).values,[S,C,A,I]=c,{batchSize:M,filterDepth:D,filterHeight:T,filterWidth:E,inChannels:N,inDepth:O,inHeight:R,inWidth:L,outChannels:$,outDepth:P,outHeight:z,outWidth:B,strideDepth:V,strideHeight:W,strideWidth:j}=h,U=D-1-h.padInfo.front,G=T-1-h.padInfo.top,H=E-1-h.padInfo.left;for(let t=0;t<M;++t)for(let e=0;e<N;++e)for(let n=0;n<O;++n){const i=n-U,r=Math.max(0,Math.ceil(i/V)),o=Math.min(P,(D+i)/V);for(let a=0;a<R;++a){const s=a-G,l=Math.max(0,Math.ceil(s/W)),u=Math.min(z,(T+s)/W);for(let c=0;c<L;++c){const h=c-H,d=Math.max(0,Math.ceil(h/j)),M=Math.min(B,(E+h)/j);let N=0;for(let n=r;n<o;++n){const r=n*V-i;for(let i=l;i<u;++i){const o=i*W-s;for(let a=d;a<M;++a){const s=x*t+b*n+w*i+_*a,l=S*(D-1-r)+C*(T-1-o)+A*(E-1-(a*j-h))+I*e;for(let t=0;t<$;++t){N+=v[s+t]*k[l+t]}}}}p[f*t+g*n+m*a+y*c+e]=N}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},zx=wy(Z,(t=>Math.cos(t))),Bx={kernelName:Z,backendName:"cpu",kernelFunc:zx},Vx={kernelName:"Cosh",backendName:"cpu",kernelFunc:wy("Cosh",(t=>Math.cosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wx={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{image:r,boxes:o,boxInd:a}=e,{cropSize:s,method:l,extrapolationValue:u}=i,[c,h,d,p]=r.shape,f=o.shape[0],[g,m]=s,y=Ln([f,g,m,p],"float32"),v=n.data.get(o.dataId).values,x=n.data.get(a.dataId).values,b=n.data.get(r.dataId).values,w=F(r.shape),_=F(y.shape);for(let t=0;t<f;t++){const e=4*t,n=v[e],i=v[e+1],r=v[e+2],o=v[e+3],a=x[t];if(a>=c)continue;const s=g>1?(r-n)*(h-1)/(g-1):0,f=m>1?(o-i)*(d-1)/(m-1):0;for(let e=0;e<g;e++){const c=g>1?n*(h-1)+e*s:.5*(n+r)*(h-1);if(c<0||c>h-1)for(let n=0;n<m;n++)for(let i=0;i<p;i++){const r=i+n*_[2]+e*_[1]+t*_[0];y.values[r]=u}else if("bilinear"===l){const n=Math.floor(c),r=Math.ceil(c),s=c-n;for(let l=0;l<m;l++){const c=m>1?i*(d-1)+l*f:.5*(i+o)*(d-1);if(c<0||c>d-1){for(let n=0;n<p;n++){const i=n+l*_[2]+e*_[1]+t*_[0];y.values[i]=u}continue}const h=Math.floor(c),g=Math.ceil(c),v=c-h;for(let i=0;i<p;i++){let o=i+h*w[2]+n*w[1]+a*w[0];const u=b[o];o=i+g*w[2]+n*w[1]+a*w[0];const c=b[o];o=i+h*w[2]+r*w[1]+a*w[0];const d=b[o];o=i+g*w[2]+r*w[1]+a*w[0];const p=u+(c-u)*v,f=d+(b[o]-d)*v;o=i+l*_[2]+e*_[1]+t*_[0],y.values[o]=p+(f-p)*s}}}else for(let n=0;n<m;++n){const r=m>1?i*(d-1)+n*f:.5*(i+o)*(d-1);if(r<0||r>d-1){for(let i=0;i<p;i++){const r=i+n*_[2]+e*_[1]+t*_[0];y.values[r]=u}continue}const s=Math.round(r),l=Math.round(c);for(let i=0;i<p;i++){const r=i+s*w[2]+l*w[1]+a*w[0],o=i+n*_[2]+e*_[1]+t*_[0];y.values[o]=b[r]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jx={kernelName:"Cumsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,exclusive:a,reverse:s}=i;Jm(r,"cumsum");const l=Qo([o],r.shape.length);let u=r;null!=l&&(u=uv({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=ea(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=Me(u.dtype,"int32"),p=P(h(u.shape),d),f=n.data.get(u.dataId).values,g=u.shape[u.shape.length-1],m=s?(t,e)=>t+g-e-1:(t,e)=>t+e;for(let t=0;t<f.length;t+=g)for(let e=0;e<g;e++){const n=m(t,e);if(0===e)p[n]=a?0:f[n];else{const i=m(t,e-1);p[n]=a?f[i]+p[i]:f[n]+p[i]}}const y=n.makeTensorInfo(u.shape,d,p);if(null!=l){const t=uv({inputs:{x:y},backend:n,attrs:{perm:ta(l)}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(u),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:o}=e,{size:a,binaryOutput:s}=i;if(1===r.shape.length){const t=vy(n.data.get(r.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,a);return n.makeTensorInfo([a],o.dtype,t)}if(2===r.shape.length){const t=xy(n.bufferSync(r),n.bufferSync(o),a,s);return n.makeTensorInfo(t.shape,o.dtype,t.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gx={kernelName:"DepthToSpace",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockSize:o,dataFormat:a}=i;s("NHWC"===a,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`)),s(o>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${o}`));const l=r.shape[0],u=r.shape[1],c=r.shape[2],h=r.shape[3],d=u*o,p=c*o,f=h/(o*o),g=n.data.get(r.dataId).values,m=new Float32Array(l*d*p*f);let y=0;for(let t=0;t<l;++t)for(let e=0;e<d;++e){const n=Math.floor(e/o),i=e%o;for(let e=0;e<p;++e){const r=Math.floor(e/o),a=(i*o+e%o)*f;for(let e=0;e<f;++e){const i=e+a+h*(r+c*(n+u*t));m[y++]=g[i]}}}return n.makeTensorInfo([l,d,p,f],r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hx(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:l,dilations:u,dimRoundingMode:c}=i;Jm([r,o],"depthwiseConv2DNative");const h=F(r.shape),d=F(o.shape);let p=u;null==p&&(p=[1,1]),s(_r(a,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${p}'`));const f=fr(r.shape,o.shape,a,p,l,c,!0),{filterHeight:g,filterWidth:m,dilationHeight:y,dilationWidth:v,padInfo:x}=f,b=x.left,w=x.top,_=f.outChannels/f.inChannels,k=new he(f.outShape,r.dtype),S=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,A=k.values;for(let t=0;t<f.batchSize;++t){const e=t*h[0],n=t*k.strides[0];for(let t=0;t<f.outHeight;++t){const i=n+t*k.strides[1],r=t*f.strideHeight-w;for(let t=0;t<g;++t){const n=r+t*y;if(n<0||n>=f.inHeight)continue;const o=t*d[0],a=e+n*h[1];for(let t=0;t<f.outWidth;++t){const e=i+t*k.strides[2],n=t*f.strideWidth-b;for(let t=0;t<m;++t){const i=n+t*v;if(i<0||i>=f.inWidth)continue;const r=o+t*d[1],s=a+i*f.inChannels;let l=e,u=r;for(let t=0;t<f.inChannels;++t){const e=S[s+t];for(let t=0;t<_;++t)A[l+t]+=e*C[u+t];l+=_,u+=_}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const qx={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:Hx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xx={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,dilations:s,pad:l,dimRoundingMode:u,filterShape:c}=i;Jm([r,o],"depthwiseConv2dNativeBackpropFilter");const h=fr(r.shape,c,a,s,l,u,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:g}=h,m=new he(h.filterShape,"float32"),y=h.padInfo.left,v=h.padInfo.top,x=h.outChannels/h.inChannels,b=n.data.get(r.dataId).values,w=new he(r.shape,r.dtype,b),_=n.data.get(o.dataId).values,k=new he(o.shape,o.dtype,_);for(let t=0;t<f;++t){const e=Math.max(0,Math.ceil((v-t)/d)),n=Math.min(h.outHeight,(h.inHeight+v-t)/d);for(let i=0;i<g;++i){const r=Math.max(0,Math.ceil((y-i)/p)),o=Math.min(h.outWidth,(h.inWidth+y-i)/p);for(let a=0;a<h.outChannels;++a){const s=Math.trunc(a/x),l=a%x;let u=0;for(let l=0;l<h.batchSize;++l)for(let c=e;c<n;++c){const e=t+c*d-v;for(let t=r;t<o;++t){const n=i+t*p-y;u+=w.get(l,e,n,s)*k.get(l,c,t,a)}}m.set(u,t,i,s,l)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yx={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{strides:a,dilations:s,pad:l,dimRoundingMode:u,inputShape:c}=i;Jm([r,o],"depthwiseConv2DNativeBackpropInput");const h=F(r.shape),d=F(o.shape),p=fr(c,o.shape,a,s,l,u,!0),f=new he(p.inShape,"float32"),g=f.values,[m,y,v]=f.strides,x=n.data.get(r.dataId).values,[b,w,_]=h,k=n.data.get(o.dataId).values,[S,C,A]=d,{batchSize:I,filterHeight:M,filterWidth:D,inChannels:T,inHeight:E,inWidth:N,outChannels:O,outHeight:R,outWidth:L,strideHeight:$,strideWidth:P}=p,z=M-1-p.padInfo.top,B=D-1-p.padInfo.left,V=O/T;for(let t=0;t<I;++t)for(let e=0;e<T;++e)for(let n=0;n<E;++n){const i=n-z,r=Math.max(0,Math.ceil(i/$)),o=Math.min(R,(M+i)/$);for(let a=0;a<N;++a){const s=a-B,l=Math.max(0,Math.ceil(s/P)),u=Math.min(L,(D+s)/P);let c=0;for(let n=r;n<o;++n){const r=n*$-i;for(let i=l;i<u;++i){const o=b*t+w*n+_*i,a=S*(M-1-r)+C*(D-1-(i*P-s))+A*e;for(let t=0;t<V;++t){c+=x[o+(e*V+t)]*k[a+t]}}}g[m*t+y*n+v*a+e]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kx={kernelName:"Diag",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e,r=h(i.shape),o=n.data.get(i.dataId).values,a=Ln([r,r],i.dtype),s=a.values;for(let t=0;t<o.length;t++)s[t*r+t]=o[t];const l=[...i.shape,...i.shape];return n.makeTensorInfo(l,a.dtype,a.values)}},Zx={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:r}=t,{strides:o,pad:a,dilations:s}=n,l=e,u=l.data.get(i.dataId).values,c=i.shape.length,d=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:f,inHeight:g,inWidth:m,inChannels:y,outHeight:v,outWidth:x,padInfo:b,strideHeight:_,strideWidth:k,filterHeight:S,filterWidth:C,dilationHeight:A,dilationWidth:I,outShape:M}=hr(i.shape,r.shape,o,a,"NHWC",s),D=h(M),T=M.length,E=w(i.dtype,D);for(let t=0;t<f;++t)for(let e=0;e<v;++e){const n=e*_-b.top;for(let o=0;o<x;++o){const a=o*k-b.left;for(let s=0;s<y;++s){let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<S;++e){const o=n+e*A;if(o>=0&&o<g)for(let n=0;n<C;++n){const h=a+n*I;if(h>=0&&h<m){const a=V([t,o,h,s],c,F(i.shape)),f=V([e,n,s],p,F(r.shape)),g=u[a]+d[f];g>l&&(l=g)}}}E[V([t,e,o,s],T,F(M))]=l}}}return{dataId:l.write(Jt(E,i.dtype),M,i.dtype),shape:M,dtype:i.dtype}}},Jx={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:r,dy:o}=t,{strides:a,pad:l,dilations:u}=n,c=e,h=L(i.shape,c.data.get(i.dataId).values),d=L(r.shape,c.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:_,filterWidth:k,dilationHeight:S,dilationWidth:C,outShape:A}=hr(i.shape,r.shape,a,l,"NHWC",u);s(o.rank===A.length,(()=>`Error in Dilation2DBackpropFilter, dy must have the same rank as output ${A.length}, but got ${o.rank}`));const I=L(A,c.data.get(o.dataId).values),M=z(r.shape,r.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*b-x.top;for(let i=0;i<v;++i){const r=i*w-x.left;for(let o=0;o<m;++o){let a=Number.MIN_SAFE_INTEGER,s=0,l=0;for(let e=0;e<_;++e){const i=n+e*S;if(i>=0&&i<f)for(let n=0;n<k;++n){const u=r+n*C;if(u>=0&&u<g){const r=h[t][i][u][o]+d[e][n][o];r>a&&(a=r,s=e,l=n)}}}M[s][l][o]+=I[t][e][i][o]}}}return{dataId:c.write(Jt(M,i.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Qx={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:r,dy:o}=t,{strides:a,pad:l,dilations:u}=n,c=e,h=L(i.shape,c.data.get(i.dataId).values),d=L(r.shape,c.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:_,filterWidth:k,dilationHeight:S,dilationWidth:C,outShape:A}=hr(i.shape,r.shape,a,l,"NHWC",u);s(o.rank===A.length,(()=>`Error in Dilation2DBackpropInput, dy must have the same rank as output ${A.length}, but got ${o.rank}`));const I=L(A,c.data.get(o.dataId).values),M=z(i.shape,i.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*b-x.top;for(let i=0;i<v;++i){const r=i*w-x.left;for(let o=0;o<m;++o){let a=Number.MIN_SAFE_INTEGER,s=n<0?0:n,l=r<0?0:r;for(let e=0;e<_;++e){const i=n+e*S;if(i>=0&&i<f)for(let n=0;n<k;++n){const u=r+n*C;if(u>=0&&u<g){const r=h[t][i][u][o]+d[e][n][o];r>a&&(a=r,s=i,l=u)}}}M[t][s][l][o]+=I[t][e][i][o]}}}return{dataId:c.write(Jt(M,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tb(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;let s;Jm(r,"sum"),s="bool"===r.dtype?hy({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):sy({inputs:{x:r},backend:n});const l=s.shape.length,u=v(o,s.shape),c=Qo(u,l);let d=u,p=s;null!=c&&(p=uv({inputs:{x:s},backend:n,attrs:{perm:c}}),d=ea(d.length,l)),Jo("sum",d,p.shape.length);const[f,g]=Ko(p.shape,d);let m=ay(n,f,Me(p.dtype,"int32"));const y=h(g),x=n.data.get(m.dataId).values,b=n.data.get(p.dataId).values;for(let t=0;t<x.length;++t){const e=t*y;let n=0;for(let t=0;t<y;++t)n+=b[e+t];x[t]=n}if(a){const t=m;m=Jv({inputs:{x:m},backend:n,attrs:{shape:Zo(m.shape,u)}}),n.disposeIntermediateTensorInfo(t)}return n.disposeIntermediateTensorInfo(s),null!=c&&n.disposeIntermediateTensorInfo(p),m}const eb={kernelName:"Sum",backendName:"cpu",kernelFunc:tb};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb={kernelName:"Einsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{equation:r}=i,o=e,{allDims:a,summedDims:s,idDims:l}=Xu(r,o.length);Ku(a.length,l,o);const{path:u,steps:c}=Zu(s,l),h=c.length;let p=null,f=a.length;const g=[];for(let t=0;t<h;++t){for(const e of c[t]){const{permutationIndices:t,expandDims:i}=Yu(f,l[e]);let r;Ju(t)?r=o[e]:(r=uv({inputs:{x:o[e]},backend:n,attrs:{perm:t}}),g.push(r));const a=r.shape.slice();for(let t=0;t<i.length;++t)a.splice(i[t],0,1);d(r.shape,a)||(r=Jv({inputs:{x:r},backend:n,attrs:{shape:a}}),g.push(r)),null===p?p=r:(p=nv({inputs:{a:r,b:p},backend:n}),g.push(p))}t<h-1&&(u[t]>=0&&(p=tb({inputs:{x:p},backend:n,attrs:{axis:u[t]-(a.length-f),keepDims:!1}}),g.push(p)),f--)}for(const t of g)t!==p&&n.disposeIntermediateTensorInfo(t);return p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ib={kernelName:"EluGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{dy:i,y:r}=e;Jm([i,r],"eluGrad");const o=new Float32Array(h(r.shape)),a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values;for(let t=0;t<a.length;++t){const e=a[t];o[t]=e>=1?s[t]:s[t]*(e+1)}return n.makeTensorInfo(r.shape,"float32",o)}},rb=wy(J,(t=>{const e=Math.sign(t),n=Math.abs(t),i=1/(1+.3275911*n);return e*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-n*n))})),ob={kernelName:J,backendName:"cpu",kernelFunc:rb};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ab(t){const{inputs:e,backend:n,attrs:i}=t,{input:r}=e,{dim:o}=i,a=r.shape.length,l=r.shape.slice();let u=o;return o<0&&(s(-(a+1)<=o,(()=>`Axis must be in the interval [${-(a+1)}, ${a}]`)),u=a+o+1),l.splice(u,0,1),Jv({inputs:{x:r},backend:n,attrs:{shape:l}})}const sb={kernelName:"ExpandDims",backendName:"cpu",kernelFunc:ab},lb=py("RealDiv",iy(((t,e)=>t/e))),ub={kernelName:"RealDiv",backendName:"cpu",kernelFunc:lb};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cb(t,e,n){const i=t.shape,r=i[0],o=i[1],a=n.data.get(t.dataId),s=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,u=[r,o],c=h(u),d=b("float32",c),p=b("float32",c);for(let t=0;t<r;t++){const i=yv({inputs:{x:s},backend:n,attrs:{begin:[t,0],size:[1,o]}}),r=yv({inputs:{x:l},backend:n,attrs:{begin:[t,0],size:[1,o]}}),a=ry({inputs:{real:i,imag:r},backend:n}),{real:u,imag:c}=hb(a,e,n),h=zu(u,c);for(let e=0;e<o;e++){const n=ju(h,e);d[t*o+e]=n.real,p[t*o+e]=n.imag}n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a)}const f=n.makeTensorInfo(u,"float32",d),g=n.makeTensorInfo(u,"float32",p),m=ry({inputs:{real:f,imag:g},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}function hb(t,e,n){const i=h(t.shape),r=n.data.get(t.dataId),o=n.data.get(r.complexTensorInfos.real.dataId).values,a=n.data.get(r.complexTensorInfos.imag.dataId).values;if(0==((s=i)&s-1)){const r=db(o,a,i,e,n),s=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(s,"float32",r.real),e=n.makeTensorInfo(s,"float32",r.imag),o=n.makeTensorInfo([],"float32",Zt(i,"float32")),a=sy({inputs:{x:o},backend:n}),l=ub.kernelFunc({inputs:{a:t,b:o},backend:n}),u=ub.kernelFunc({inputs:{a:e,b:a},backend:n}),c=n.data.get(l.dataId).values,h=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),{real:c,imag:h}}return r}return Bu(function(t,e,n){const i=new Float32Array(2*e);for(let r=0;r<e;r++){let o=0,a=0;for(let i=0;i<e;i++){const s=Hu(r*i,e,n),l=ju(t,i);o+=l.real*s.real-l.imag*s.imag,a+=l.real*s.imag+l.imag*s.real}n&&(o/=e,a/=e),Uu(i,o,a,r)}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(zu(o,a),i,e));var s}function db(t,e,n,i,r){if(1===n)return{real:t,imag:e};const o=zu(t,e),a=n/2,s=Vu(o),l=s.real,u=s.imag,c=[l.length],h=r.makeTensorInfo(c,"float32",l),d=r.makeTensorInfo(c,"float32",u),p=ry({inputs:{real:h,imag:d},backend:r}),f=Wu(o),g=f.real,m=f.imag,y=[g.length],v=r.makeTensorInfo(y,"float32",g),x=r.makeTensorInfo(y,"float32",m),b=ry({inputs:{real:v,imag:x},backend:r}),w=db(l,u,a,i,r),_=w.real,k=w.imag,S=[_.length],C=r.makeTensorInfo(S,"float32",_),A=r.makeTensorInfo(S,"float32",k),I=ry({inputs:{real:C,imag:A},backend:r}),M=db(g,m,a,i,r),D=M.real,T=M.imag,E=[D.length],N=r.makeTensorInfo(E,"float32",D),O=r.makeTensorInfo(E,"float32",T),F=ry({inputs:{real:N,imag:O},backend:r}),R=Gu(n,i),L=[R.real.length],$=r.makeTensorInfo(L,"float32",R.real),P=r.makeTensorInfo(L,"float32",R.imag),z=ry({inputs:{real:$,imag:P},backend:r}),B=nv({inputs:{a:z,b:F},backend:r}),V=my({inputs:{a:I,b:B},backend:r}),W=Nv({inputs:{a:I,b:B},backend:r}),j=uy({inputs:{input:V},backend:r}),U=uy({inputs:{input:W},backend:r}),G=Mx({inputs:{input:V},backend:r}),H=Mx({inputs:{input:W},backend:r}),q=Tx({inputs:[j,U],backend:r,attrs:{axis:0}}),X=Tx({inputs:[G,H],backend:r,attrs:{axis:0}}),Y=r.data.get(q.dataId).values,K=r.data.get(X.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(X),{real:Y,imag:K}}const pb={kernelName:"FFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:i}=e,r=h(i.shape),o=i.shape[i.shape.length-1],a=Jv({inputs:{x:i},backend:n,attrs:{shape:[r/o,o]}}),s=cb(a,!1,n),l=Jv({inputs:{x:s},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),l}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fb(t){const{backend:e,attrs:n}=t,{shape:i,value:r,dtype:o}=n,a=o||E(r),s=w(a,h(i));return function(t,e,n){t.fill(e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(s,r),e.makeTensorInfo(i,a,s)}const gb={kernelName:"Fill",backendName:"cpu",kernelFunc:fb};const mb={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,r=n,o=b(i.dtype,h(i.shape)),[a,s,l,u]=i.shape,c=r.data.get(i.dataId).values;for(let t=0;t<a;t++){const e=t*l*s*u;for(let t=0;t<s;t++){const n=t*(l*u);for(let i=0;i<l;i++){const r=i*u;for(let s=0;s<u;s++){const h=[a,t,i,s][2],d=Math.round(l-h),p=e+n+r+s;let f=c[p];if(d>=0&&d<l){f=c[e+n+d*u+s]}o[p]=f}}}}return{dataId:r.write(o,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},yb={kernelName:"FloorDiv",backendName:"cpu",kernelFunc:py("FloorDiv",iy(((t,e)=>Math.floor(t/e))),null,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o,bias:a,preluActivationWeights:s}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i;let g=Nx({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(a){const t=g;g=my({inputs:{a:g,b:a},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=g;g=Zv(n,g,p,s,f),n.disposeIntermediateTensorInfo(t)}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xb={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o,bias:a,preluActivationWeights:s}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i;let g=Hx({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(a){const t=g;g=my({inputs:{a:g,b:a},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=g;g=Zv(n,g,p,s,f),n.disposeIntermediateTensorInfo(t)}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bb={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:i,indices:r}=e,o=h(i.shape),a=r.shape,s=a[a.length-1],[l,u,c,d]=ci(i,r);if(0===u)return n.makeTensorInfo(l,i.dtype,[]);const p=Ly(n.data.get(r.dataId).values,n.bufferSync(i),i.dtype,u,s,c,d,i.shape,o);return n.makeTensorInfo(l,i.dtype,p.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wb={kernelName:"GatherV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,indices:o}=e,{axis:a,batchDims:s}=i;Jm([r,o],"gatherV2");let l=s;null==s&&(l=0);const u=h(o.shape),c=ic(r,o,v(a,r.shape)[0],l),d=Jv({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=Jv({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}}),f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize],g=n.bufferSync(p),m=$y(n.bufferSync(d),g,f);return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.makeTensorInfo(c.outputShape,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _b={kernelName:"IFFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:i}=e,r=h(i.shape),o=i.shape[i.shape.length-1],a=Jv({inputs:{x:i},backend:n,attrs:{shape:[r/o,o]}}),s=cb(a,!0,n),l=Jv({inputs:{x:s},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),l}},kb={kernelName:"IsFinite",backendName:"cpu",kernelFunc:wy("IsFinite",(t=>Number.isFinite(t)?1:0),"bool")},Sb={kernelName:"IsInf",backendName:"cpu",kernelFunc:wy("IsInf",(t=>Math.abs(t)===1/0?1:0),"bool")},Cb={kernelName:"IsNan",backendName:"cpu",kernelFunc:wy("IsNan",(t=>Number.isNaN(t)?1:0),"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ab={kernelName:"LinSpace",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:i,stop:r,num:o}=n,a=Hy(i,r,o);return e.makeTensorInfo([a.length],"float32",a)}},Ib={kernelName:"Log1p",backendName:"cpu",kernelFunc:wy("Log1p",(t=>Math.log1p(t)))},Mb={kernelName:"LogicalAnd",backendName:"cpu",kernelFunc:py("LogicalAnd",iy(((t,e)=>t&&e)),null,"bool")},Db={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:wy("LogicalNot",(t=>t?0:1),"bool")},Tb={kernelName:"LogicalOr",backendName:"cpu",kernelFunc:py("LogicalOr",iy(((t,e)=>t||e)),null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eb={kernelName:"LRN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{depthRadius:o,bias:a,alpha:s,beta:l}=i;Jm(r,"LRN");const u=r.shape[3],c=u-1,d=n.data.get(r.dataId).values,p=h(r.shape),f=new Float32Array(p);function g(t){const e=t%u;let n=t-e+Math.max(0,e-o);const i=t-e+Math.min(e+o,c);let r=0;for(;n<=i;n++){const t=d[n];r+=t*t}return r}for(let t=0;t<p;t++){const e=g(t),n=d[t]*Math.pow(a+s*e,-l);f[t]=n}return n.makeTensorInfo(r.shape,r.dtype,f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nb={kernelName:"LRNGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,y:o,dy:a}=e,{depthRadius:s,bias:l,alpha:u,beta:c}=i;Jm(a,"LRNGrad");const d=h(a.shape),p=a.shape[3],f=n.data.get(a.dataId).values,g=n.data.get(r.dataId).values,m=n.data.get(o.dataId).values,y=new Float32Array(d),v=d;for(let t=0;t<v;t++){const e=t%p,n=t-e+Math.max(0,e-s),i=t-e+Math.min(p,e+s+1);let r=0;for(let t=n;t<i;t++)r+=Math.pow(g[t],2);r=u*r+l;for(let e=n;e<i;e++){let n=-2*u*c*g[e]*m[t]/r;t===e&&(n+=Math.pow(r,-c)),n*=f[t],y[e]+=n}}return n.makeTensorInfo(a.shape,r.dtype,y)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ob(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reductionIndices:o,keepDims:a}=i,s=n;let l=r.shape;const u=l.length,c=v(o,l);let d=c;const p=Qo(d,u);let f=s.data.get(r.dataId).values;if(null!=p){const t=new Array(u);for(let e=0;e<t.length;e++)t[e]=l[p[e]];f=lv(f,l,r.dtype,p,t),d=ea(d.length,u),l=t}Jm(r,"max"),Jo("max",d,u);const[g,m]=Ko(l,d),y=Yy(f,h(m),g,r.dtype),x=s.write(y,g,r.dtype);let b=g;if(a){b=Zo(g,c)}return{dataId:x,shape:b,dtype:r.dtype}}const Fb={kernelName:"Max",backendName:"cpu",kernelFunc:Ob};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Jm(r,"maxPool");const{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=i;s(_r(a,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const c=dr(r.shape,o,a,1,l,u);let h;if(1===c.filterWidth&&1===c.filterHeight&&d(c.inShape,c.outShape))h=sy({inputs:{x:r},backend:n});else{const t=n.data.get(r.dataId).values,e=F(r.shape),i=gx(t,r.shape,r.dtype,e,c,"max");h=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lb={kernelName:"MaxPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:o,strides:a,pad:s,dimRoundingMode:l,dataFormat:u}=i;Jm(r,"maxPool3d");const c=pr(r.shape,o,a,1,s,l,u),h=yx(n.data.get(r.dataId).values,r.shape,r.dtype,F(r.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $b={kernelName:"MaxPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,{filterSize:a,strides:s,pad:l,dimRoundingMode:u}=i;Jm([r,o],"maxPool3DGrad");const c=pr(o.shape,a,s,1,l,u),h=function(t,e){const n=Ln(e.outShape,"int32"),i=e.strideDepth,r=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let m=0;m<e.inChannels;++m)for(let y=0;y<e.outDepth;++y){const v=y*i-d;let x=v;for(;x<0;)x+=a;const b=Math.min(e.inDepth,u+v);for(let i=0;i<e.outHeight;++i){const u=i*r-p;let d=u;for(;d<0;)d+=s;const w=Math.min(e.inHeight,c+u);for(let r=0;r<e.outWidth;++r){const p=r*o-f;let _=p;for(;_<0;)_+=l;const k=Math.min(e.inWidth,h+p);let S=Number.NEGATIVE_INFINITY,C=-1;for(let e=x;e<b;e+=a){const n=e-v;for(let i=d;i<w;i+=s){const r=i-u;for(let o=_;o<k;o+=l){const a=o-p,s=t.get(g,e,i,o,m);s>=S&&(S=s,C=n*c*h+r*c+a)}}}n.set(C,g,y,i,r,m)}}}return n}(n.bufferSync(o),c),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,g=c.dilationDepth,m=c.dilationHeight,y=c.dilationWidth,v=c.effectiveFilterDepth,x=c.effectiveFilterHeight,b=c.effectiveFilterWidth,w=v-1-c.padInfo.front,_=b-1-c.padInfo.left,k=x-1-c.padInfo.top,S=Ln(o.shape,"float32"),C=n.bufferSync(r);for(let t=0;t<c.batchSize;++t)for(let e=0;e<c.inChannels;++e)for(let n=0;n<c.inDepth;++n)for(let i=0;i<c.inHeight;++i)for(let r=0;r<c.inWidth;++r){const o=n-w,a=i-k,s=r-_;let l=0;for(let n=0;n<v;n+=g){const i=(o+n)/d;if(!(i<0||i>=c.outDepth||Math.floor(i)!==i))for(let r=0;r<x;r+=m){const o=(a+r)/p;if(!(o<0||o>=c.outHeight||Math.floor(o)!==o))for(let a=0;a<b;a+=y){const u=(s+a)/f;if(u<0||u>=c.outWidth||Math.floor(u)!==u)continue;const d=v*x*b-1-h.get(t,i,o,u,e)===n*x*b+r*b+a?1:0;if(0===d)continue;l+=C.get(t,i,o,u,e)*d}}}S.set(l,t,n,i,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pb={kernelName:"MaxPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o,output:a}=e,s=o;Jm([o,a],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=i,d=dr(s.shape,l,u,1,c,h),p=n.data.get(s.dataId).values,f=Ln(d.outShape,s.dtype,mx(p,s.shape,s.dtype,d).values),g=d.strideHeight,m=d.strideWidth,y=d.dilationHeight,v=d.dilationWidth,x=d.effectiveFilterHeight,b=d.effectiveFilterWidth,w=b-1-d.padInfo.left,_=x-1-d.padInfo.top,k=Ln(s.shape,"float32"),S=n.data.get(r.dataId).values,C=Ln(r.shape,"float32",S);for(let t=0;t<d.batchSize;++t)for(let e=0;e<d.inChannels;++e)for(let n=0;n<d.inHeight;++n)for(let i=0;i<d.inWidth;++i){const r=n-_,o=i-w;let a=0;for(let n=0;n<x;n+=y){const i=(r+n)/g;if(!(i<0||i>=d.outHeight||Math.floor(i)!==i))for(let r=0;r<b;r+=v){const s=(o+r)/m;if(s<0||s>=d.outWidth||Math.floor(s)!==s)continue;const l=x*b-1-f.get(t,i,s,e)===n*b+r?1:0;if(0===l)continue;a+=C.get(t,i,s,e)*l}}k.set(a,t,n,i,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zb={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:r,strides:o,pad:a,includeBatchInIndex:s}=e,l=n;Jm(i,"MaxPoolWithArgmax");const u=l.data.get(i.dataId).values,c=dr(i.shape,r,o,[1,1],a),[h,d]=function(t,e,n,i,r){const o=gx(t,0,n,F(e),r,"max"),a=mx(t,e,n,r,!0,i);return[o.values,a.values]}(u,i.shape,i.dtype,s,c),p=l.write(h,c.outShape,i.dtype),f=l.write(d,c.outShape,i.dtype);return[{dataId:p,shape:c.outShape,dtype:i.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bb={kernelName:"Mean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i,s=v(o,r.shape),l=h(Ko(r.shape,s)[1]),u=[],c=n.makeTensorInfo([],"float32",new Float32Array([l]));u.push(c);const d=hy({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});u.push(d);const p=lb({inputs:{a:d,b:c},backend:n});u.push(p);const f=tb({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:a}});return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vb={kernelName:"Min",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;Jm(r,"min");const s=v(o,r.shape);let l=s;const u=Qo(l,r.shape.length);let c=r;null!=u&&(c=uv({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ea(l.length,r.shape.length)),Jo("min",l,c.shape.length);const[d,p]=Ko(c.shape,l),f=h(p),g=P(h(d),c.dtype),m=n.data.get(c.dataId).values;for(let t=0;t<g.length;++t){const e=t*f;let n=m[e];for(let t=0;t<f;++t){const i=m[e+t];(Number.isNaN(i)||i<n)&&(n=i)}g[t]=n}null!=u&&n.disposeIntermediateTensorInfo(c);const y=n.makeTensorInfo(d,c.dtype,g);if(a){const t=Jv({inputs:{x:y},backend:n,attrs:{shape:Zo(d,s)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wb={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{paddings:o,mode:a}=i;Jm(r,"mirrorPad");const s=o.map(((t,e)=>t[0]+r.shape[e]+t[1])),l=o.map((t=>t[0])),u=o.map(((t,e)=>t[0]+r.shape[e])),c="reflect"===a?0:1,d=n.data.get(r.dataId).values,p=r.shape.length,f=F(r.shape),g=h(s),m=s.length,y=F(s),v=b(r.dtype,g);for(let t=0;t<g;t++){let e=W(t,m,y);for(let t=0;t<m;t++)e[t]<l[t]?e[t]=2*l[t]-e[t]-c:e[t]>=u[t]&&(e[t]=2*(u[t]-1)-e[t]+c);e=e.map(((t,e)=>t-l[e]));const n=V(e,p,f);v[t]=d[n]}return{dataId:n.write(v,s,r.dtype),shape:s,dtype:r.dtype}}},jb=iy(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),Ub=py(tt,jb),Gb={kernelName:tt,backendName:"cpu",kernelFunc:Ub};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hb(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{dim:o}=i,a=r.shape.length;let s=o;if(-1===s&&(s=a-1),s!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${s}`);const l=v([s],r.shape),u=Ob({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=Zo(u.shape,l),h=Jv({inputs:{x:u},backend:n,attrs:{shape:c}}),d=Nv({inputs:{a:r,b:h},backend:n}),p=Ty({inputs:{x:d},backend:n}),f=tb({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),g=Jv({inputs:{x:f},backend:n,attrs:{shape:c}}),m=lb({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}const qb={kernelName:"Softmax",backendName:"cpu",kernelFunc:Hb};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xb={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{numSamples:o,seed:a,normalized:s}=i;Jm(r,"multinomial");const l=s?r:Hb({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],d=n.data.get(l.dataId).values,p=[u,o],f=P(h(p),"int32");for(let t=0;t<u;++t){const e=t*c,n=new Float32Array(c-1);n[0]=d[e];for(let t=1;t<n.length;++t)n[t]=n[t-1]+d[e+t];const i=qa.alea(a.toString()),r=t*o;for(let t=0;t<o;++t){const e=i();f[r+t]=n.length;for(let i=0;i<n.length;i++)if(e<n[i]){f[r+t]=i;break}}}return s||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(p,"int32",f)}},Yb=Cl;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb={kernelName:"NonMaxSuppressionV3",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l}=i;Jm(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,{selectedIndices:h}=Yb(u,c,a,s,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},Zb=Al;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jb={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:u}=i;Jm(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values,{selectedIndices:d,validOutputs:p}=Zb(c,h,a,s,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Qb=Il;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l,softNmsSigma:u}=i;Jm(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values,d=a,p=s,f=l,g=u,{selectedIndices:m,selectedScores:y}=Qb(c,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ew={kernelName:"OneHot",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{indices:r}=e,{depth:o,onValue:a,offValue:s}=i;Jm(r,"oneHot");const l=h(r.shape),u=new Float32Array(l*o);u.fill(s);const c=n.data.get(r.dataId).values;for(let t=0;t<l;++t)c[t]>=0&&c[t]<o&&(u[t*o+c[t]]=a);return n.makeTensorInfo([...r.shape,o],"int32",u)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nw(t){const{inputs:e,backend:n}=t,{x:i}=e;if("string"===i.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===i.dtype){const t=uy({inputs:{input:i},backend:n}),e=nw({inputs:{x:t},backend:n}),r=Mx({inputs:{input:i},backend:n}),o=nw({inputs:{x:r},backend:n}),a=ry({inputs:{real:e,imag:o},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),a}return fb({backend:n,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const iw={kernelName:"ZerosLike",backendName:"cpu",kernelFunc:nw};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw={kernelName:"OnesLike",backendName:"cpu",kernelFunc:function t(e){const{inputs:n,backend:i}=e,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===r.dtype){const e=uy({inputs:{input:r},backend:i}),n=t({inputs:{x:e},backend:i}),o=Mx({inputs:{input:r},backend:i}),a=nw({inputs:{x:o},backend:i}),s=ry({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(e),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(a),s}return fb({backend:i,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ow(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i;if(1===e.length)return ab({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,a=e[0].dtype;e.forEach((t=>{l(o,t.shape,"All tensors passed to stack must have matching shapes"),s(a===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const u=[],c=Tx({inputs:e.map((t=>{const e=ab({inputs:{input:t},backend:n,attrs:{dim:r}});return u.push(e),e})),backend:n,attrs:{axis:r}});return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}const aw={kernelName:"Pack",backendName:"cpu",kernelFunc:ow};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sw={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{paddings:o,constantValue:a}=i;Jm(r,"pad");const s=o.map(((t,e)=>t[0]+r.shape[e]+t[1])),l=o.map((t=>t[0])),u=n.data.get(r.dataId).values,c=h(r.shape),d=r.shape.length,p=F(r.shape),f=h(s),g=s.length,m=F(s),y=b(r.dtype,f);0!==a&&y.fill(a);for(let t=0;t<c;t++){y[V(W(t,d,p).map(((t,e)=>t+l[e])),g,m)]=u[t]}return{dataId:n.write(y,s,r.dtype),shape:s,dtype:r.dtype}}},lw={kernelName:"Pow",backendName:"cpu",kernelFunc:py("Pow",iy(((t,e)=>Math.pow(t,e))))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uw={kernelName:"Range",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:i,stop:r,dtype:o,step:a}=n,s=pv(i,r,a,o);return e.makeTensorInfo([s.length],o,s)}},cw={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:wy("Reciprocal",(t=>1/t))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hw={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:s}=i;Jm(r,"resizeBilinear");const l=F(r.shape),[u,c]=s,[d,p,f,g]=r.shape,m=n.data.get(r.dataId).values,y=new Float32Array(h([d,u,c,g])),v=[o&&u>1?p-1:p,o&&c>1?f-1:f],x=[o&&u>1?u-1:u,o&&c>1?c-1:c];let b=0;const w=v[0]/x[0],_=v[1]/x[1];for(let t=0;t<d;t++)for(let e=0;e<u;e++){let n;n=a?w*(e+.5)-.5:w*e;const i=Math.max(0,Math.floor(n)),r=n-i,o=Math.min(p-1,Math.ceil(n)),s=t*l[0]+i*l[1],u=t*l[0]+o*l[1];for(let t=0;t<c;t++){let e;e=a?_*(t+.5)-.5:_*t;const n=Math.max(0,Math.floor(e)),i=e-n,o=Math.min(f-1,Math.ceil(e)),c=s+n*l[2],h=u+n*l[2],d=s+o*l[2],p=u+o*l[2];for(let t=0;t<g;t++){const e=m[c+t],n=m[h+t],o=e+(m[d+t]-e)*i,a=o+(n+(m[p+t]-n)*i-o)*r;y[b++]=a}}}return n.makeTensorInfo([d,u,c,g],"float32",y)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dw={kernelName:"ResizeBilinearGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:o}=e,{alignCorners:a}=i;Jm([o,r],"resizeBilinearGrad");const s=F(r.shape),[l,u,c,h]=r.shape,[,d,p]=o.shape,f=new Float32Array(l*u*c*h),g=[a&&d>1?u-1:u,a&&p>1?c-1:c],m=[a&&d>1?d-1:d,a&&p>1?p-1:p],y=g[0]/m[0],v=g[1]/m[1],x=n.data.get(o.dataId).values;let b=0;for(let t=0;t<l;t++){const e=t*s[0];for(let t=0;t<d;t++){const n=t*y,i=Math.floor(n),r=Math.min(Math.ceil(n),u-1),o=e+i*s[1],a=e+r*s[1],l=n-i,d=1-l;for(let t=0;t<p;t++){const e=t*v,n=Math.floor(e),i=Math.min(Math.ceil(e),c-1),r=e-n,u=1-r,p=o+n*s[2],g=o+i*s[2],m=a+n*s[2],y=a+i*s[2],w=d*u,_=d*r,k=l*u,S=l*r;for(let t=0;t<h;t++){const e=x[b++];f[p+t]+=e*w,f[g+t]+=e*_,f[m+t]+=e*k,f[y+t]+=e*S}}}}return n.makeTensorInfo([l,c,u,h],"float32",f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pw={kernelName:"ResizeNearestNeighbor",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:s}=i;Jm(r,"resizeNearestNeighbor");const l=F(r.shape),[u,c]=s,[h,d,p,f]=r.shape,g=n.data.get(r.dataId).values,m=new Float32Array(h*u*c*f),y=[o&&u>1?d-1:d,o&&c>1?p-1:p],v=[o&&u>1?u-1:u,o&&c>1?c-1:c],x=y[0]/v[0],b=y[1]/v[1];let w=0;for(let t=0;t<h;t++){const e=t*l[0];for(let t=0;t<u;t++){const n=a?x*(t+.5):x*t;let i=Math.min(d-1,o?Math.round(n):Math.floor(n));a&&(i=Math.max(0,i));const r=e+i*l[1];for(let t=0;t<c;t++){const e=a?b*(t+.5):b*t;let n=Math.min(p-1,o?Math.round(e):Math.floor(e));a&&(n=Math.max(0,n));const i=r+n*l[2];for(let t=0;t<f;t++){const e=g[i+t];m[w++]=e}}}}return n.makeTensorInfo([h,u,c,f],r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fw={kernelName:"ResizeNearestNeighborGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:o}=e,{alignCorners:a}=i;Jm([o,r],"resizeNearestNeighborGrad");const s=F(r.shape),l=F(o.shape),[u,c,h,d]=r.shape,[,p,f]=o.shape,g=new Float32Array(u*c*h*d),m=n.data.get(o.dataId).values,y=[a&&p>1?c-1:c,a&&f>1?h-1:h],v=[a&&p>1?p-1:p,a&&f>1?f-1:f],x=y[0]/v[0],b=y[1]/v[1],w=1/x,_=1/b,k=2*Math.ceil(w)+2,S=2*Math.ceil(_)+2;for(let t=0;t<u;t++){const e=t*s[0];for(let t=0;t<c;t++){const n=e+t*s[1],i=Math.floor(t*w),r=Math.floor(i-k/2);for(let i=0;i<h;i++){const o=n+i*s[2],u=Math.floor(i*_),y=Math.floor(u-S/2);for(let n=0;n<d;n++){let s=0;for(let o=0;o<k;o++){const u=o+r;if(u<0||u>=p)continue;const d=e+u*l[1],g=u*x;if(t===Math.min(c-1,a?Math.round(g):Math.floor(g)))for(let t=0;t<S;t++){const e=t+y;if(e<0||e>=f)continue;const r=d+e*l[2],o=e*b;i===Math.min(h-1,a?Math.round(o):Math.floor(o))&&(s+=m[r+n])}}g[o+n]=s}}}}return n.makeTensorInfo(r.shape,r.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gw={kernelName:"Reverse",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dims:o}=i;Jm(r,"reverse");const a=r.shape.length,s=v(o,r.shape);if(0===a)return sy({inputs:{x:r},backend:n});const l=new he(r.shape,r.dtype),u=n.bufferSync(r);for(let t=0;t<l.size;t++){const e=l.indexToLoc(t),n=e.slice();s.forEach((t=>n[t]=r.shape[t]-1-n[t])),l.set(u.get(...n),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},mw={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:r,fillValue:o,center:a}=e,s=n,l=b(i.dtype,h(i.shape)),[u,c,d,p]=i.shape,[f,g]=Eu(a,c,d),m=Math.sin(r),y=Math.cos(r),v=s.data.get(i.dataId).values;for(let t=0;t<u;t++){const e=t*d*c*p;for(let t=0;t<c;t++){const n=t*(d*p);for(let i=0;i<d;i++){const r=i*p;for(let a=0;a<p;a++){const s=[u,t,i,a],h=s[2],x=s[1];let b=(h-f)*y-(x-g)*m,w=(h-f)*m+(x-g)*y;b=Math.round(b+f),w=Math.round(w+g);let _=o;if("number"!=typeof o&&(_=3===a?255:o[a]),b>=0&&b<d&&w>=0&&w<c){_=v[e+w*(d*p)+b*p+a]}l[e+n+r+a]=_}}}}return{dataId:s.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},yw={kernelName:"Round",backendName:"cpu",kernelFunc:wy("Round",(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vw(t,e,n,i,r,o,a,s,l,u){const c=[i/r,r],h=t.values,d=e.values;if(0===i)return Ln(n,e.dtype);const p=Ln(c,e.dtype);p.values.fill(l);for(let t=0;t<o;t++){const o=[];let l=0;for(let e=0;e<a;e++){const n=h[t*a+e];o.push(n),l+=n*s[e]}if(l<0||l>=i/r)throw new Error(`Invalid indices: ${o} does not index into ${n}`);for(let n=0;n<r;n++)u?p.values[l*r+n]+=d[t*r+n]:p.values[l*r+n]=0===e.rank?d[0]:d[t*r+n]}return p}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xw={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{indices:r,updates:o}=e,{shape:a}=i,{sliceRank:s,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=fi(0,r,a),d=vw(n.bufferSync(r),n.bufferSync(o),a,h,u,l,s,c,0,!0);return n.makeTensorInfo(a,d.dtype,d.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bw={kernelName:"Select",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:i,t:r,e:o}=e;Jm([i,r,o],"select");const a=i.shape.length,s=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=Me(r.dtype,o.dtype),d=P(h(r.shape),c);let p=0;const f=0===a||a>1||1===r.shape.length?1:h(r.shape.slice(1));for(let t=0;t<s.length;t++)for(let e=0;e<f;e++)1===s[t]?d[p++]=l[t]:d[p++]=u[t];return n.makeTensorInfo(r.shape,c,d)}},ww={kernelName:"Selu",backendName:"cpu",kernelFunc:wy("Selu",(t=>t>=0?1.0507009873554805*t:1.7580993408473768*(Math.exp(t)-1)))},_w={kernelName:"Sign",backendName:"cpu",kernelFunc:wy("Sign",(t=>t<0?-1:t>0?1:0))},kw=wy(et,(t=>Math.sin(t))),Sw={kernelName:et,backendName:"cpu",kernelFunc:kw},Cw={kernelName:"Sinh",backendName:"cpu",kernelFunc:wy("Sinh",(t=>Math.sinh(t)))},Aw=Math.log(1.1920928955078125e-7)+2,Iw={kernelName:"Softplus",backendName:"cpu",kernelFunc:wy("Softplus",(t=>{const e=t>-Aw,n=t<Aw,i=Math.exp(t);let r;return r=n?i:e?t:Math.log(1+i),r}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mw={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:o,paddings:a}=i;Jm([r],"spaceToBatchND");const s=h(o),l=[[0,0]];l.push(...a);for(let t=1+o.length;t<r.shape.length;++t)l.push([0,0]);const u=sw.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=Nu(u.shape,o,s,!1),d=Ou(c.length,o.length,!1),p=Fu(u.shape,o,s,!1),f=Jv({inputs:{x:u},backend:n,attrs:{shape:c}}),g=uv({inputs:{x:f},backend:n,attrs:{perm:d}}),m=Jv({inputs:{x:g},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dw={kernelName:"SparseFillEmptyRows",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:i,values:r,denseShape:o,defaultValue:a}=e;if(1!==o.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${o.shape}`);if(2!==i.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${i.shape}`);if(1!==r.shape.length)throw new Error(`Values must be a vector, saw:\n        ${r.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const s=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=n.data.get(a.dataId).values[0],[h,d,p,f,g]=xv(s,i.shape,i.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([g.length],i.dtype,new Int32Array(g))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tw={kernelName:"SparseReshape",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:r,newShape:o}=e;if(2!==i.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${i.shape}`);if(1!==r.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${r.shape}`);if(1!==o.shape.length)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const a=Array.from(n.data.get(r.dataId).values),s=n.data.get(i.dataId).values,l=Array.from(n.data.get(o.dataId).values),[u,c,h]=bv(s,i.shape,i.dtype,a,l);return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ew={kernelName:"SparseSegmentMean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${r.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${o.shape}`);const a=n.data.get(i.dataId).values,s=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=wv(a,i.shape,i.dtype,s,l,!0);return n.makeTensorInfo(c,i.dtype,u)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nw={kernelName:"SparseSegmentSum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${r.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${o.shape}`);const a=n.data.get(i.dataId).values,s=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=wv(a,i.shape,i.dtype,s,l);return n.makeTensorInfo(c,i.dtype,u)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ow={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:r,sparseValues:o,defaultValue:a}=e,{outputShape:s}=i,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=fi(0,r,s),p=vw(n.bufferSync(r),n.bufferSync(o),s,d,c,u,l,h,n.data.get(a.dataId).values[0],!1);return n.makeTensorInfo(s,p.dtype,p.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fw={kernelName:"SplitV",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{numOrSizeSplits:o,axis:a}=i,s=v(a,r.shape)[0],l=tc(r,o,s),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map((t=>{const e=[...c];e[s]=t;const i=yv({inputs:{x:r},backend:n,attrs:{begin:u,size:e}});return u[s]+=t,i}))}},Rw={kernelName:"Sqrt",backendName:"cpu",kernelFunc:wy("Sqrt",(t=>Math.sqrt(t)))},Lw={kernelName:"Square",backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,i=e;Jm(n,"square");const r=i.data.get(n.dataId).values,o=new Float32Array(r.length);for(let t=0;t<r.length;++t){const e=r[t];o[t]=e*e}return{dataId:i.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},$w={kernelName:"Step",backendName:"cpu",kernelFunc:wy("Step",((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pw={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:o,end:a,strides:s,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=i;Jm(r,"stridedSlice");const{nonStrided:p,$begin:f,$strides:g,size:m,newShape:y,outShape:v}=Ei(r.shape,o,a,s,l,u,c,h,d),x=Jv({inputs:{x:r},backend:n,attrs:{shape:y}});let b;if(p){const t=yv({inputs:{x:x},backend:n,attrs:{begin:f,size:m}});b=Jv({inputs:{x:t},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(t)}else if(v.some((t=>0===t)))b=n.makeTensorInfo(v,r.dtype,[]);else{const t=Sv(v,n.bufferSync(x),g,f);b=n.makeTensorInfo(t.shape,t.dtype,t.values)}const w=Jv({inputs:{x:b},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),w}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zw={kernelName:"StringNGrams",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{separator:r,nGramWidths:o,leftPad:a,rightPad:s,padWidth:l,preserveShortSequences:u}=i,{data:c,dataSplits:h}=e,d=n.data.get(c.dataId).values,p=n.data.get(h.dataId).values,[f,g]=Av(d,p,r,o,a,s,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw={kernelName:"StringSplit",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:r}=i,{input:o,delimiter:a}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(1!==o.shape.length)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const s=n.data.get(o.dataId).values,l=n.data.get(a.dataId).values[0],[u,c,h]=Mv(s,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vw={kernelName:"StringToHashBucketFast",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:r}=i,{input:o}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=Dv(n.data.get(o.dataId).values,r);return n.makeTensorInfo(o.shape,"int32",a)}},Ww=wy(it,(t=>Math.tan(t))),jw={kernelName:it,backendName:"cpu",kernelFunc:Ww},Uw=wy("Tanh",(t=>Math.tanh(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gw(t,e,n){switch(n){case"reflect":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=2*e;n<t&&(n=t*Math.trunc(-n/t)+n),n=n<-e?n+t:-n-1}else if(n>e-1)if(e<=1)n=0;else{const t=2*e;n-=t*Math.trunc(n/t),n>=e&&(n=t-n-1)}return r(0,n,e-1)}(t,e);case"wrap":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=e-1;n+=e*(Math.trunc(-n/t)+1)}else if(n>e-1)if(e<=1)n=0;else{const t=e-1;n-=e*Math.trunc(n/t)}return r(0,n,e-1)}(t,e);case"nearest":return function(t,e){return r(0,t,e-1)}(t,e);case"constant":default:return function(t,e){return t}(t)}}function Hw(t,e,n,i,r,o,a,s,l,u,c){return 0<=s&&s<e&&0<=l&&l<n?t[a*i+s*r+l*o+u]:c}function qw(t,e,n,i,r,o,a,s,l,u,c){return Hw(t,e,n,i,r,o,a,Math.round(s),Math.round(l),u,c)}function Xw(t,e,n,i,r,o,a,s,l,u,c){const h=Math.floor(s),d=Math.floor(l),p=h+1,f=d+1;return(p-s)*((f-l)*Hw(t,e,n,i,r,o,a,h,d,u,c)+(l-d)*Hw(t,e,n,i,r,o,a,h,f,u,c))+(s-h)*((f-l)*Hw(t,e,n,i,r,o,a,p,d,u,c)+(l-d)*Hw(t,e,n,i,r,o,a,p,f,u,c))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw=[nx,ny,ix,rx,yy,ox,ax,sx,lx,ux,cx,hx,dx,px,fx,vx,xx,bx,_x,ex,kx,Sx,Cx,dy,Sy,Ax,oy,Ix,Ex,Fx,Rx,Ox,$x,Px,Lx,Bx,Vx,Wx,jx,Ux,Gx,qx,Xx,Yx,Kx,Zx,Qx,Jx,ub,nb,zv,ib,My,ob,Ey,sb,Oy,pb,gb,mb,Ry,yb,vb,xb,bb,wb,zy,Vy,ly,_b,Dx,kb,Sb,Cb,Vv,jy,Gy,Ab,Xy,Ib,Mb,Db,Tb,Eb,Nb,Zy,Rb,Lb,$b,Pb,zb,Fb,Bb,Vb,Qy,Wb,Gb,Xb,iv,ov,Kb,Jb,tw,sv,ew,rw,aw,sw,lw,Uv,dv,uw,cy,cw,Hv,Xv,Qv,hw,dw,pw,fw,gw,mw,yw,gv,xw,bw,ww,Kv,_w,Sw,Cw,vv,qb,Iw,Mw,Dw,Tw,Ew,Nw,Ow,Fw,Rw,Lw,kv,$w,Pw,zw,Bw,Vw,Ov,eb,jw,{kernelName:"Tanh",backendName:"cpu",kernelFunc:Uw},{kernelName:"Tile",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reps:o}=i;Jm(r,"tile");const a=Fv(n.bufferSync(r),o);return n.makeTensorInfo(a.shape,a.dtype,a.values)}},{kernelName:"TopK",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{k:o,sorted:a}=i;Jm(r,"topk");const s=n.data.get(r.dataId).values,[l,u]=Rv(s,r.shape,r.dtype,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}},cv,{kernelName:"Transform",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,attrs:n,backend:i}=t,{image:r,transforms:o}=e,{interpolation:a,fillMode:s,fillValue:l,outputShape:u}=n,[c,d,p,f]=r.shape,[g,m]=null!=u?u:[d,p],y=[c,g,m,f],v=F(r.shape),x=v[0],w=v[1],_=v[2],k=b(r.dtype,h(y));k.fill(l);const S=i.data.get(r.dataId).values,C=i.data.get(o.dataId).values;for(let t=0;t<c;++t){const e=1===o.shape[0]?C:C.subarray(8*t,8*t+8);for(let n=0;n<g;++n)for(let i=0;i<m;++i)for(let r=0;r<f;++r){let o;const u=e[6]*i+e[7]*n+1;if(0===u)continue;const c=(e[0]*i+e[1]*n+e[2])/u,h=(e[3]*i+e[4]*n+e[5])/u,f=Gw(c,p,s),g=Gw(h,d,s);switch(a){case"nearest":o=qw(S,d,p,x,w,_,t,g,f,r,l);break;case"bilinear":o=Xw(S,d,p,x,w,_,t,g,f,r,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}k[t*x+n*w+i*_+r]=o}return i.makeTensorInfo(y,r.dtype,k)}return{dataId:i.write(k,y,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:"Unique",backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:i}=t,{axis:r}=n,{x:o}=e;Jm(o,"unique");const a=i.data.get(o.dataId).values,{outputValues:s,outputShape:l,indices:u}=Lv(a,r,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,s),i.makeTensorInfo([u.length],"int32",u)]}},{kernelName:"Unpack",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{value:r}=e;let{axis:o}=i;o<0&&(o+=r.shape.length);const a=r.shape.length,s=r.shape[o],l=new Array(a-1);let u=0;for(let t=0;t<a;t++)t!==o&&(l[u++]=r.shape[t]);const c=new Array(a).fill(0),h=r.shape.slice();h[o]=1;const d=new Array(s);for(let t=0;t<d.length;t++){c[o]=t;const e=yv({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});d[t]=Jv({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}},{kernelName:"UnsortedSegmentSum",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,segmentIds:o}=e,{numSegments:a}=i;Jm(r,"unsortedSegmentSum");const s=[],l=[],u=r.shape.length-o.shape.length;let c=o;for(let t=0;t<u;++t){const e=ab({inputs:{input:c},backend:n,attrs:{dim:t+1}});c=e,l.push(e)}for(let t=0;t<a;++t){const e=Zt(t,"int32"),i=n.makeTensorInfo([],"int32",e),o=Iy({inputs:{a:i,b:c},backend:n}),a=hy({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),u=nv({inputs:{a:a,b:r},backend:n}),h=tb({inputs:{x:u},backend:n,attrs:{axis:0,keepDims:!1}});s.push(h),l.push(i),l.push(o),l.push(a),l.push(u),l.push(h)}const h=ow({inputs:s,backend:n,attrs:{axis:0}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},iw];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of Yw)ut(t);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kw={},Zw={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Jw(t){if(!(t in Kw)){const e=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);if(e.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete Kw[t]}),!1),1===t)return e.getContext("webgl",Zw)||e.getContext("experimental-webgl",Zw);return e.getContext("webgl2",Zw)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);if(null===e)return console.log("Could not get context for WebGL version",t),null;Kw[t]=e}const e=Kw[t];return e.isContextLost()?(delete Kw[t],Jw(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Kw[t])}var Qw,t_,e_,n_,i_,r_;function o_(t,e){return[e,t]}function a_(t){const e=h(t);return f(Math.ceil(e/4))}function s_(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function l_(t,e){const n=t;let i,r,o,a,s,l,u,c,h,d;return 2===H().getNumber("WEBGL_VERSION")?(i=n.R32F,r=n.R16F,o=n.RGBA16F,a=n.RGBA32F,s=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT):(i=t.RGBA,r=t.RGBA,o=t.RGBA,a=n.RGBA,s=t.RGBA,u=4,c=4,h=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT),l=t.RGBA,{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:s,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_(t,e){const n=e();return H().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}(t_=Qw||(Qw={}))[t_.DENSE=0]="DENSE",t_[t_.SHARED_BATCH=1]="SHARED_BATCH",(n_=e_||(e_={}))[n_.RENDER=0]="RENDER",n_[n_.UPLOAD=1]="UPLOAD",n_[n_.PIXELS=2]="PIXELS",n_[n_.DOWNLOAD=3]="DOWNLOAD",(r_=i_||(i_={}))[r_.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r_[r_.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r_[r_.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r_[r_.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r_[r_.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16";function c_(t){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function h_(t,e){return b_(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}function d_(t,e){const n=b_(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(u_(t,(()=>t.shaderSource(n,e))),u_(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){const n=p_.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const i=+n[1],r=t.split("\n"),o=r.length.toString().length+2,a=r.map(((t,e)=>g((e+1).toString(),o)+t));let s=0;for(let t=0;t<a.length;t++)s=Math.max(a[t].length,s);const l=a.slice(0,i-1),u=a.slice(i-1,i),c=a.slice(i);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${g(u[0],s)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const p_=/ERROR: [0-9]+:([0-9]+):/g;function f_(t,e){if(u_(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function g_(t,e,n,i,r,o,a){const s=t.getAttribLocation(e,n);return-1!==s&&(u_(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,i))),u_(t,(()=>t.vertexAttribPointer(s,r,t.FLOAT,!1,o,a))),u_(t,(()=>t.enableVertexAttribArray(s))),!0)}function m_(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=e+t.TEXTURE0;if(i<t.TEXTURE0||i>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),u_(t,(()=>t.activeTexture(t.TEXTURE0+n))),u_(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function y_(t,e,n){u_(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),u_(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function v_(t,e){u_(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),u_(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function x_(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function b_(t,e,n){const i=u_(t,(()=>e()));if(null==i)throw new Error(n);return i}function w_(t,e=2){return h(t.slice(0,t.length-e))}function __(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function k_(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[w_(t),...__(t)]),e}function S_(t){return t%2==0}function C_(t,e){if(d(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],i=e.slice(-1)[0];if(n===i)return!0;if(S_(n)&&S_(i)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&S_(t[0])&&S_(e[0])}let A_,I_;function M_(t,e){return null!=t.getExtension(e)}function D_(t){try{if(null!=Jw(t))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function T_(t){if(0===t)return!1;const e=Jw(t);if(1!==t){if(M_(e,"EXT_color_buffer_float"))return E_(e);const t="EXT_color_buffer_half_float";if(M_(e,t)){const n=e.getExtension(t);return function(t,e){const n=l_(t,e),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const r=1,o=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,r,o,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(i),t.deleteFramebuffer(a),s}(e,n)}return!1}if(!M_(e,"OES_texture_float"))return!1;if(!M_(e,"WEBGL_color_buffer_float"))return!1;return E_(e)}function E_(t){const e=l_(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const r=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),r}function N_(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&s("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_=H();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function F_(){let t,e,n,i,r,o,a,s,l,u;return 2===H().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",i="in",r="texture",o="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",i="varying",r="texture2D",o="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:i,texture2D:r,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:l,defineRound:u}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_(t,e,n="index"){const i=F(e);return i.map(((e,r)=>`${`int ${t[r]} = ${n} / ${e}`}; ${r===i.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${e}`:`index -= ${t[r]} * ${e}`};`)).join("")}function L_(t){const e=F(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}O_.registerFlag("HAS_WEBGL",(()=>O_.getNumber("WEBGL_VERSION")>0)),O_.registerFlag("WEBGL_VERSION",(()=>D_(2)?2:D_(1)?1:0)),O_.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),O_.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===O_.get("WEBGL_VERSION"))),O_.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),O_.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),O_.registerFlag("WEBGL_PACK",(()=>O_.getBool("HAS_WEBGL"))),O_.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_CLIP",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_PACK_REDUCE",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_LAZILY_UNPACK",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_CONV_IM2COL",(()=>O_.getBool("WEBGL_PACK"))),O_.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==A_){const e=Jw(t);A_=e.getParameter(e.MAX_TEXTURE_SIZE)}return A_}(O_.getNumber("WEBGL_VERSION")))),O_.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==I_){const e=Jw(t);I_=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,I_)}(O_.getNumber("WEBGL_VERSION")))),O_.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=O_.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=Jw(t);return e=M_(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:M_(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),O_.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>O_.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ve())),O_.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=Jw(t);if(1===t){if(!M_(e,"OES_texture_float"))return!1}else if(!M_(e,"EXT_color_buffer_float"))return!1;return E_(e)}(O_.getNumber("WEBGL_VERSION")))),O_.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!O_.getBool("WEBGL_FORCE_F16_TEXTURES")&&O_.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),O_.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>T_(O_.getNumber("WEBGL_VERSION")))),O_.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=O_.getNumber("WEBGL_VERSION"))&&null!=Jw(t).fenceSync;var t})),O_.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>O_.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),O_.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),O_.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>Ve()&&O_.getBool("IS_CHROME")?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),O_.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128));const $_="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P_{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Qw.DENSE;const e=a_(t),n=F_();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${R_(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${n.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z_{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Qw.DENSE;const e=a_(t),n=F_();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${R_(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${n.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B_{constructor(t){this.variableNames=["A"],this.outTexUsage=e_.DOWNLOAD;const e=F_();this.outputShape=t,this.userCode=`\n      ${$_}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V_{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=e_.DOWNLOAD;const e=F_();this.outputShape=t,this.userCode=`\n      ${$_}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W_{constructor(t,e,n=!1){this.variableNames=["A"];const i=F_(),[r,o]=e;this.outputShape=t;let a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`\n      ${L_(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ${o};\n        int c = imod(flatIndex, ${o});\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(${o}.0, ${r}.0);\n        vec4 values = ${i.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${i.output} = vec4(${a}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j_{constructor(t,e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const i=F_(),[r,o]=e;this.outputShape=t;let a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let n=0;n<=1;n++){const s=2*e+n;a+=`\n          localCoords = coords;\n          if(localCoords[2] + ${n} < ${t[2]}) {\n            localCoords[2] += ${n};\n            if(localCoords[1] + ${e} < ${t[1]}) {\n              localCoords[1] += ${e};\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ${o};\n              c = imod(flatIndex, ${o});\n              uv = (vec2(c, r) + halfCR) / vec2(${o}.0, ${r}.0);\n              values = ${i.texture2D}(A, uv);\n\n              if(offset == 0) {\n                result[${s}] = values[0];\n              } else if(offset == 1) {\n                result[${s}] = values[1];\n              } else if(offset == 2) {\n                result[${s}] = values[2];\n              } else {\n                result[${s}] = values[3];\n              }\n            }\n          }\n        `}this.userCode=`\n      ${L_(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ${a}\n\n        ${i.output} = ${s};\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(t){const e=F_();return function(t,e){const n=b_(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(u_(t,(()=>t.shaderSource(n,e))),u_(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function G_(t){return function(t,e){const n=b_(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return u_(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),u_(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function H_(t){return function(t,e){const n=b_(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return u_(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),u_(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function q_(t,e,n,i,r,o){!function(t,e){const n=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const a=function(t){return b_(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),s=t.TEXTURE_2D;return u_(t,(()=>t.bindTexture(s,a))),u_(t,(()=>t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),u_(t,(()=>t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),u_(t,(()=>t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST))),u_(t,(()=>t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST))),u_(t,(()=>t.texImage2D(s,0,i,e,n,0,r,o,null))),u_(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),a}function X_(t){return t.internalFormatFloat}function Y_(t){return t.internalFormatHalfFloat}function K_(t){return t.downloadTextureFormat}function Z_(t){return t.internalFormatPackedFloat}function J_(t){return t.internalFormatPackedHalfFloat}function Q_(t,e,n,i,r,o,a,s){const l=t,u=new Float32Array(function(t,e){const[n,i]=s_(t,e);return n*i*4}(o,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class tk{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=H().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){Kw[t]=e}(e,t)):this.gl=Jw(e);let n="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(1===H().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=h_(this.gl,t),M_(this.gl,e))this.textureHalfFloatExtension=h_(this.gl,e);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),M_(this.gl,i))this.colorBufferHalfFloatExtension=h_(this.gl,i);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",M_(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!M_(this.gl,i))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(i)}this.vertexBuffer=G_(this.gl),this.indexBuffer=H_(this.gl),this.framebuffer=function(t){return b_(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=l_(this.gl,this.textureHalfFloatExtension)}get debug(){return H().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;u_(t,(()=>t.finish())),u_(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),u_(t,(()=>t.deleteFramebuffer(this.framebuffer))),u_(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),u_(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),u_(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,i){const[r,o]=o_(e,n);return q_(t,r,o,X_(i),i.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,i){const[r,o]=o_(e,n);return q_(t,r,o,Y_(i),i.textureFormatFloat,i.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,i){const[r,o]=o_(e,n);return q_(t,r,o,K_(i),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){u_(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?u_(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):u_(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),u_(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,i){this.throwIfDisposed(),function(t,e,n,i,r,o){let a,s,l;u_(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),r instanceof Uint8Array?(a=new Uint8Array(n*i*4),s=t.UNSIGNED_BYTE,l=t.RGBA):(a=new Float32Array(n*i*4),s=t.FLOAT,l=o.internalFormatPackedFloat),a.set(r),u_(t,(()=>t.texImage2D(t.TEXTURE_2D,0,l,n,i,0,t.RGBA,s,a))),u_(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,i){const[r,o]=s_(e,n);return q_(t,r,o,J_(i),t.RGBA,i.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,i){const[r,o]=s_(e,n);return q_(t,r,o,Z_(i),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(v_(this.gl,this.framebuffer),this.outputTexture=null),u_(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,i){const[r,o]=o_(e,n),a=new Uint8Array(e*n*4);return u_(t,(()=>t.readPixels(0,0,r,o,i.downloadTextureFormat,t.UNSIGNED_BYTE,a))),new Float32Array(a.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,i,r,o){return Q_(this.gl,t,0,0,0,r,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const i=t,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const i=function(t,e,n,i){const r=t.createBuffer();u_(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r)));const o=16*e*n;return u_(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,o,t.STREAM_READ))),u_(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),u_(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),r}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(H().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=i.clientWaitSync(r,0,0);return t===i.ALREADY_SIGNALED||t===i.CONDITION_SATISFIED},e=r}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const i=new Float32Array(e*n*4);return u_(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,i))),i}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl,n=d_(e,t);null==this.vertexShader&&(this.vertexShader=U_(e));const i=function(t){return b_(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);return u_(e,(()=>e.attachShader(i,this.vertexShader))),u_(e,(()=>e.attachShader(i,n))),function(t,e){if(u_(t,(()=>t.linkProgram(e))),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,i),this.debug&&f_(e,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(t,e,n){return u_(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),g_(t,e,"clipSpacePos",n,3,20,0)&&g_(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),i}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&u_(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&f_(this.gl,this.program),u_(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return b_(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),u_(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,i){u_(t,(()=>m_(t,e,i))),u_(t,(()=>t.uniform1i(n,i)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[i,r]=s_(e,n);this.setOutputMatrixTextureDriver(t,i,r)}setOutputMatrixWriteRegion(t,e,n,i){this.setOutputMatrixWriteRegionDriver(n,t,i,e)}setOutputPackedMatrixWriteRegion(t,e,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&f_(this.gl,this.program),x_(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),u_(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),u_(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=h_(this.gl,2===H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await m((()=>this.disposed||this.isQueryAvailable(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),i=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),i&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||m((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),y_(this.gl,t,this.framebuffer),this.debug&&x_(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(y_(this.gl,this.outputTexture,this.framebuffer),this.debug&&x_(this.gl)):v_(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const i=this.gl;y_(i,t,this.framebuffer),this.debug&&x_(i),this.outputTexture=t,u_(i,(()=>i.viewport(0,0,e,n))),u_(i,(()=>i.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,i){this.throwIfDisposed(),u_(this.gl,(()=>this.gl.scissor(t,e,n,i)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{getBroadcastDims:ek}=sc;function nk(t,e,n,i){const r=[];t.forEach((t=>{const e=h(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`))}));const o=r.join("\n"),a=t.map((t=>function(t,e,n=!1){let i="";i+=n?rk(t):ik(t);const r=t.shapeInfo.logicalShape,o=e.logicalShape;r.length<=o.length&&(i+=n?function(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",o=t.shapeInfo.logicalShape.length,a=e.logicalShape.length,s=ek(t.shapeInfo.logicalShape,e.logicalShape),l=dk(a),u=a-o;let c;const d=["x","y","z","w","u","v"];c=0===o?"":a<2&&s.length>=1?"coords = 0;":s.map((t=>`coords.${d[t+u]} = 0;`)).join("\n");let p="";p=a<2&&o>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${d[e+u]}`)).join(", ");let f="return outputValue;";const g=1===h(t.shapeInfo.logicalShape),m=1===h(e.logicalShape);if(1!==o||g||m){if(g&&!m)f=1===a?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){const t=o-2,e=o-1;s.indexOf(t)>-1&&s.indexOf(e)>-1?f="return vec4(outputValue.x);":s.indexOf(t)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(e)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${r}() {\n      ${l} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${i}(${p});\n      ${f}\n    }\n  `}(t,e):function(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",o=e.texShape,a=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===l&&null==t.shapeInfo.flatOffset&&d(a,o))return`\n      float ${r}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const u=dk(l),c=ek(t.shapeInfo.logicalShape,e.logicalShape),h=l-s;let p;const f=["x","y","z","w","u","v"];p=0===s?"":l<2&&c.length>=1?"coords = 0;":c.map((t=>`coords.${f[t+h]} = 0;`)).join("\n");let g="";g=l<2&&s>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${f[e+h]}`)).join(", ");return`\n    float ${r}() {\n      ${u} coords = getOutputCoords();\n      ${p}\n      return get${i}(${g});\n    }\n  `}(t,e));return i}(t,e,i))).join("\n"),s=e.texShape,l=F_(),u=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(l);let c,p,f=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${ok}\n    ${ak}\n    ${sk}\n  `}(l);e.isPacked?(c=function(t,e){switch(t.length){case 0:return uk();case 1:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===n[0])return`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${n[1]}.0);\n      }\n    `;if(1===n[1])return`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${n[0]}.0);\n      }\n    `;return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);\n    }\n  `}(0,e);case 2:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(d(t,e))return`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e);case 3:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),r=i*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      int b = index / ${r};\n      index -= b * ${r};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e);default:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),r=i*Math.ceil(t[t.length-2]/2);let o=r,a="",s="b, r, c";for(let e=2;e<t.length-1;e++)o*=t[t.length-e-1],a=`\n      int b${e} = index / ${o};\n      index -= b${e} * ${o};\n    `+a,s=`b${e}, `+s;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${r};\n      index -= b * ${r};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${t.length}(${s});\n    }\n  `}(t,e)}}(e.logicalShape,s),p=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(l)):(c=function(t,e){switch(t.length){case 0:return uk();case 1:return function(t,e){if(1===e[0])return`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e);case 2:return function(t,e){if(d(t,e))return`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e);case 3:return function(t,e){const n=R_(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec3(r, c, d);\n    }\n  `}(t,e);case 4:return function(t,e){const n=R_(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e);case 5:return function(t,e){const n=R_(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=R_(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,s),p=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(l)),i&&(f+=lk);return[f,u,p,o,c,a,n].join("\n")}function ik(t){const e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${e};}`;const[i,r]=t.shapeInfo.texShape;if(1===i&&1===r)return`\n      float ${n}() {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const[o,a]=t.shapeInfo.texShape,s=ck(e);return`\n    float ${n}() {\n      vec2 uv = uvFromFlat(${o}, ${a}, ${s});\n      return sampleTexture(${e}, uv);\n    }\n  `}(t);case 1:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${n}(int index) {\n        ${hk(t)}\n      }\n    `;const i=t.shapeInfo.texShape,r=i[0],o=i[1];if(1===o&&1===r)return`\n      float ${n}(int index) {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const a=ck(e);if(1===o)return`\n      float ${n}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);\n        return sampleTexture(${e}, uv);\n      }\n    `;if(1===r)return`\n      float ${n}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);\n        return sampleTexture(${e}, uv);\n      }\n    `;return`\n    float ${n}(int index) {\n      vec2 uv = uvFromFlat(${r}, ${o}, index + ${a});\n      return sampleTexture(${e}, uv);\n    }\n  `}(t);case 2:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape;if(null!=r&&d(e,r)){const t=r[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${r[1]}.0, ${t}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `}const{newShape:o,keptDims:a}=x(e),s=o;if(s.length<e.length){const e=["row","col"];return`\n      ${ik(pk(t,s))}\n      float ${i}(int row, int col) {\n        return ${i}(${fk(e,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));\n        ${hk(t)}\n      }\n    `;const l=r[0],u=r[1],c=ck(n);if(1===u)return`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${e[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `;if(1===l)return`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${e[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${e[1]} + col + ${c};\n    vec2 uv = uvFromFlat(${l}, ${u}, index);\n    return sampleTexture(${n}, uv);\n  }\n`}(t);case 3:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[1]*e[2],o=e[2],{newShape:a,keptDims:s}=x(e),l=a;if(l.length<e.length){const e=["row","col","depth"];return`\n        ${ik(pk(t,l))}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${fk(e,s)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${r}, ${o}, 1)));\n        ${hk(t)}\n      }\n    `;const u=t.shapeInfo.texShape,c=u[0],h=u[1],d=t.shapeInfo.flatOffset;if(h===r&&null==d)return`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${c}.0);\n          return sampleTexture(${n}, uv);\n        }\n      `;if(h===o&&null==d)return`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${c}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `;const p=ck(n);return`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r} + col * ${o} + depth + ${p};\n        vec2 uv = uvFromFlat(${c}, ${h}, index);\n        return sampleTexture(${n}, uv);\n      }\n  `}(t);case 4:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[3],o=e[2]*r,a=e[1]*o,{newShape:s,keptDims:l}=x(e);if(s.length<e.length){const e=["row","col","depth","depth2"];return`\n      ${ik(pk(t,s))}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${fk(e,l)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${o}, ${r}, 1)));\n        ${hk(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,c=t.shapeInfo.texShape,h=c[0],d=c[1];if(d===a&&null==u)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${r}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(d===r&&null==u)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${e[1]*e[2]}, ${e[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const p=ck(n);return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} +\n          depth * ${r} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${d}, index + ${p});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],o=e[3]*r,a=e[2]*o,s=e[1]*a,{newShape:l,keptDims:u}=x(e);if(l.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${ik(pk(t,l))}\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        return ${i}(${fk(e,u)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${s}, ${a}, ${o}, ${r})) +\n          depth3;\n        ${hk(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===s&&null==c)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${a}, ${o}, ${r}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===r&&null==c)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=ck(n);return`\n    float ${i}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${s} + col * ${a} + depth * ${o} +\n          depth2 * ${r} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:o}=x(e);if(r.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${ik(pk(t,r))}\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${i}(${fk(e,o)});\n      }\n    `}const a=e[5],s=e[4]*a,l=e[3]*s,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${u}, ${l}, ${s})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${a}, 1)));\n        ${hk(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===c&&null==h)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${u}, ${l}, ${s}, ${a})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===a&&null==h)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const g=ck(n);return`\n    float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${u} + depth * ${l} +\n          depth2 * ${s} + depth3 * ${a} + depth4 + ${g};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function rk(t){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),i=F_();return`\n    vec4 ${n}() {\n      return ${i.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),i=t.shapeInfo.texShape,r=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],o=F_();return`\n    vec4 ${n}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${r[0]}, ${r[1]}, index);\n      return ${o.texture2D}(${e}, uv);\n    }\n  `}(t);case 2:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=r[0],a=r[1],s=F_();if(null!=r&&d(e,r))return`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n\n        return ${s.texture2D}(${n}, uv);\n      }\n    `;const l=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],u=Math.ceil(e[1]/2);return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u}, ${l[0]}, ${l[1]}, row, col);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t);case 3:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(1===e[0]){const n=[1,2],r=["b","row","col"];return`\n        ${rk(pk(t,e.slice(1)))}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${fk(r,n)});\n        }\n      `}const a=o[0],s=o[1],l=Math.ceil(e[2]/2),u=l*Math.ceil(e[1]/2),c=F_();return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${a}, ${s}, ${u}, ${l}, b, row, col);\n      return ${c.texture2D}(${n}, uv);\n    }\n  `}(t);default:return function(t){const e=t.shapeInfo.logicalShape,n=e.length,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],s=a[0],l=a[1],u=Math.ceil(e[n-1]/2);let c=u*Math.ceil(e[n-2]/2),h="int b, int row, int col",d=`b * ${c} + (row / 2) * ${u} + (col / 2)`;for(let t=2;t<n-1;t++)h=`int b${t}, `+h,c*=e[n-t-1],d=`b${t} * ${c} + `+d;const p=F_();return`\n    vec4 ${r}(${h}) {\n      int index = ${d};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${s});\n      return ${p.texture2D}(${i}, uv);\n    }\n  `}(t)}}const ok="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ak="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",sk="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",lk="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function uk(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function ck(t){return`offset${t}`}function hk(t){const e=t.name,n=h(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function dk(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function pk(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function fk(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gk(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const i=t.logicalShape,r=e[n],o=r.shape;if(!d(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(t.isUniform&&r.isUniform)return;const a=t.texShape,s=r.isUniform?null:r.texData.texShape;if(!d(a,s))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${s} must match`)}))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const{addImpl:mk,bincountImpl:yk,bincountReduceImpl:vk,ceilImpl:xk,concatImpl:bk,equalImpl:wk,expImpl:_k,expm1Impl:kk,floorImpl:Sk,gatherNdImpl:Ck,gatherV2Impl:Ak,greaterImpl:Ik,greaterEqualImpl:Mk,lessImpl:Dk,lessEqualImpl:Tk,linSpaceImpl:Ek,logImpl:Nk,maxImpl:Ok,maximumImpl:Fk,minimumImpl:Rk,multiplyImpl:Lk,negImpl:$k,notEqualImpl:Pk,prodImpl:zk,rangeImpl:Bk,rsqrtImpl:Vk,simpleAbsImpl:Wk,sliceImpl:jk,sparseFillEmptyRowsImpl:Uk,sparseReshapeImpl:Gk,sparseSegmentReductionImpl:Hk,stridedSliceImpl:qk,stringNGramsImpl:Xk,stringSplitImpl:Yk,stringToHashBucketFastImpl:Kk,subImpl:Zk,tileImpl:Jk,topKImpl:Qk,transposeImpl:tS,uniqueImpl:eS}=$v;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nS(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function iS(t,e){return 1===e?[t]:nS(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class rS{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;const e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=iS("rc",e),i=dk(e),r=function(t,e,n){if(1===t)return`rc > ${e[0]}`;let i="";for(let r=t-2;r<t;r++)i+=`${n[r]} >= ${e[r]}`,r<t-1&&(i+="||");return i}(e,t,n),o=function(t,e,n,i){if(1===t)return"";const r=i.slice(-2);return`\n    int r = ${r[0]};\n    int c = ${r[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${e};\n    bool rEdge = rp1 >= ${n};\n  `}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){const n=t.length,i=function(t,e){const n=[];for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){let o=`${0===i?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let n=2;n<t;n++)o=`${e[e.length-1-n]},`+o;n.push(o)}return n}(n,e);if(1===n)return`getA(rc),\n            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),\n            0, 0`;return`getA(${i[0]}),\n          cEdge ? 0. : getA(${i[1]}),\n          rEdge ? 0. : getA(${i[2]}),\n          rEdge || cEdge ? 0. : getA(${i[3]})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,n);this.userCode=`\n        void main() {\n          ${i} rc = getOutputCoords();\n\n          if(${r}) {\n            setOutput(vec4(0));\n          } else {\n            ${o}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}}class oS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var i;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${i=e,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${R_(["r","c","d"],i)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${L_(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${t[1]};\n        int cols = ${t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class aS{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const i=lS(e,n),r=uS(t,i,n);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const o=sS(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const t=this.freeTextures[r].shift();return this.usedTextures[r].push(t),t}let a;return i===i_.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===i_.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===i_.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===i_.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===i_.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,e,n,i){if(null==this.freeTextures)return;const r=lS(n,i),o=uS(e,r,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=sS(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),s=H().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(t),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],u=l.indexOf(t);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(u,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function sS(t,e,n,i,r){const o=function(t,e){switch(t){case i_.PACKED_2X2_FLOAT32:return Z_(e);case i_.PACKED_2X2_FLOAT16:return J_(e);case i_.UNPACKED_FLOAT32:return X_(e);case i_.UNPACKED_FLOAT16:return Y_(e);case i_.PACKED_4X1_UNSIGNED_BYTE:return K_(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,i);let a;if(r){const[e,n]=s_(t[0],t[1]);a=e*n}else{const[e,n]=o_(t[0],t[1]);a=e*n}return a*function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;throw new Error(`Unknown internal format ${e}`)}(n,o)}function lS(t,e){if(t===e_.UPLOAD)return i_.PACKED_2X2_FLOAT32;if(t===e_.RENDER||null==t)return function(t){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?i_.PACKED_2X2_FLOAT32:i_.UNPACKED_FLOAT32:t?i_.PACKED_2X2_FLOAT16:i_.UNPACKED_FLOAT16}(e);if(t===e_.DOWNLOAD||t===e_.PIXELS)return i_.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function uS(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cS{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const hS="return x;";class dS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pS{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;const e=t.length,n=iS("rc",e),i=dk(e),r=function(t,e){if(1===t)return"rc";let n="";for(let i=0;i<t;i++)n+=e[i],i<t-1&&(n+=",");return n}(e,n),o=n.slice(-2),a=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`\n      void main() {\n        ${i} rc = getOutputCoords();\n        vec4 packedInput = getA(${r});\n\n        setOutput(getChannel(packedInput, ${a}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fS=Us,gS={};const mS=H().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class yS extends e{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){const t=Jw(H().getNumber("WEBGL_VERSION"));this.binaryCache=((n=H().getNumber("WEBGL_VERSION"))in gS||(gS[n]={}),gS[n]),this.gpgpu=new tk(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var n;this.textureManager=new aS(this.gpgpu),this.numMBBeforeWarning=null==H().global.screen?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new t(this,Vi())}nextDataId(){return yS.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,e,n){if((H().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||H().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:e,dtype:n,values:t,usage:e_.UPLOAD,refCount:1}),i}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,i,r){if(H().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:i,values:e,usage:e_.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:i,complexTensorInfos:r,slice:o,shape:a,isPacked:s}=e;if(null!=o){let e;e=s?new dS(a,hS):new cS(a,hS);const n=this.runWebGLProgram(e,[{dataId:t,shape:a,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===i)return n;const l=null!=this.activeTimers;let u,c;if(l&&(u=Qt()),"complex64"===i){c=zu(this.readSync(r.real.dataId),this.readSync(r.imag.dataId))}else c=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=Qt()-u),this.convertAndCacheOnCPU(t,c)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:i,slice:r,dtype:o,complexTensorInfos:a,isPacked:s}=e;if(null!=r){let e;e=s?new dS(i,hS):new cS(i,hS);const n=this.runWebGLProgram(e,[{dataId:t,shape:i,dtype:o}],o),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(t);if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===H().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,u,c=null;if("complex64"!==o&&H().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(t);const e=this.texData.get(l.dataId);c=this.gpgpu.createBufferFromTexture(e.texture,...a_(i))}if(this.pendingRead.set(t,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const t=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]);u=zu(t[0],t[1])}else if(null==c)u=this.getValuesFromTexture(t);else{const t=h(i);u=this.gpgpu.downloadFloat32MatrixFromBuffer(c,t)}null!=l&&this.disposeIntermediateTensorInfo(l);const d=this.convertAndCacheOnCPU(t,u),p=this.pendingRead.get(t);return this.pendingRead.delete(t),p.forEach((t=>t(d))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Vi().removeDataId(t,this),this.pendingDeletes--),d}bufferSync(t){const e=this.readSync(t.dataId);let n=e;if("string"===t.dtype)try{n=e.map((t=>ee(t)))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ln(t.shape,t.dtype,n)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!c_(n)){if(H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:i}=this.texData.get(t),r=h(e);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),i=this.texData.get(n.dataId),o=this.gpgpu.downloadMatrixFromPackedTexture(i.texture,...a_(e)).subarray(0,r);return this.disposeIntermediateTensorInfo(n),o}const o=H().getBool("WEBGL_PACK")&&!0===i,a=o?k_(e):e,s=o?new V_(a):new B_(a),l=this.runWebGLProgram(s,[{shape:a,dtype:n,dataId:t}],"float32"),u=this.texData.get(l.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture,u.texShape[0],u.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(l),c}timerAvailable(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(t){const e=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,t();const r=c(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),o=c(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,i&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(r);s.kernelMs=a(t),s.getExtraProfileInfo=()=>t.map(((t,e)=>({name:o[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Qt(),endMs:null}}endTimer(t){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Qt(),t)}async getQueryTime(t){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:i,usage:r,isPacked:o,slice:a}=this.texData.get(t),s=a&&a.origDataId||t,l=this.dataRefCount.get(s);l>1?this.dataRefCount.set(s,l-1):(this.dataRefCount.delete(s),null!=e&&(this.numBytesInGPU-=this.computeBytes(i,n),this.textureManager.releaseTexture(e,i,r,o)));const u=this.texData.get(t);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=mS){return H().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&h(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){Pu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return fS(t.shape,e)}packedUnaryOp(t,e,n){const i=new dS(t.shape,e),r=this.compileAndRun(i,[t],n);return Vi().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=Wk(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"return abs(x);",t.dtype);const e=new cS(t.shape,"return abs(x);"),n=this.compileAndRun(e,[t]);return Vi().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}makeTensorInfo(t,e,n){let i;if("string"===e&&null!=n&&n.length>0&&M(n[0])){const r=n.map((t=>te(t)));i=this.write(r,t,e)}else i=this.write(n,t,e);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:e}}makeOutput(t,e,n){const{dataId:i}=this.makeTensorInfo(t,e,n);return Vi().makeTensorFromDataId(i,t,e,this)}unpackTensor(t){const e=new pS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new rS(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[w_(t.shape),...__(t.shape)],i={dtype:t.dtype,shape:n,dataId:t.dataId},r=[w_(e),...__(e)],o=new oS(r,n),a=this.runWebGLProgram(o,[i],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t){const e=this.texData.get(t),{isPacked:n,shape:i,dtype:r}=e,o=k_(i);let a;a=n?new z_(o):new P_(o);return{dtype:r,shape:i,dataId:this.runWebGLProgram(a,[{shape:o,dtype:r,dataId:t}],r,null,!0).dataId}}runWebGLProgram(t,e,n,i,r=!1){const o=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(o.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===Qw.DENSE){const e=a_(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===h(o.shape))return a.values=b(o.dtype,0),o;const s=[],l=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&h(e.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),s.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!C_(n.shape,e.shape)){const t=e,i=e.shape;e.shape=n.shape,e=this.packedReshape(e,i),s.push(e),n=this.texData.get(e.dataId),t.shape=i}return this.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const u={shape:o.shape,texData:a,isUniform:!1},c=function(t,e,n){let i="";e.concat(n).forEach((t=>{const e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;i+=`${t.shape}_${n}_${e}`}));const r=t.userCode;let o=t.constructor.name;return o+="_"+i+"_"+r,o}(t,l,u),d=this.getAndSaveBinary(c,(()=>function(t,e,n,i){const r=e.userCode,o=n.map(((t,n)=>{const i={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(i.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:i}})),a=o.map((t=>t.shapeInfo)),s={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},l=nk(o,s,r,e.packedInputs),u=t.createProgram(l);let c=null;const h=t.getUniformLocation(u,"NAN",!1);1===H().getNumber("WEBGL_VERSION")&&(c=t.getUniformLocation(u,"INFINITY",!1));const d={};for(let n=0;n<e.variableNames.length;n++){const i=e.variableNames[n],r=!1;d[i]=t.getUniformLocation(u,i,r),d[`offset${i}`]=t.getUniformLocation(u,`offset${i}`,r)}return{program:e,source:l,webGLProgram:u,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:c,nanLoc:h}}(this.gpgpu,t,l,u))),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),function(t,e,n,i,r){gk(e.inShapeInfos,n),gk([e.outShapeInfo],[i]);const o=i.texData.texture,a=i.texData.texShape;i.texData.isPacked?t.setOutputPackedMatrixTexture(o,a[0],a[1]):t.setOutputMatrixTexture(o,a[0],a[1]),t.setProgram(e.webGLProgram),1===H().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,i)=>{const r=e.program.variableNames[i],o=e.uniformLocations[r],a=e.uniformLocations[`offset${r}`];if(null!=o)if(n.isUniform)if(h(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(o,e)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,o,i)})),null!=r&&r(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,d,l,u,i),s.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)}));const g=H().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const t=Qt();t-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!H().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===r){const t=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),t}return o}compileAndRun(t,e,n,i,r=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,i,r)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!H().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=ji((()=>{if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=H().getBool("DEBUG");H().set("DEBUG",!1);const e=this.abs(ds(1e-8)).dataSync()[0];if(H().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:i,values:r,texture:a,usage:s,isPacked:l}=e;if(null!=a)return;const u=null!=this.activeTimers;let c;u&&(c=Qt());let d=e.texShape;if(null==d&&(d=function(t,e=!1){let n=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,1===(t=t.map(((e,n)=>n>=t.length-2?o(t[n]):t[n]))).length&&(t=[2,t[0]])),2!==t.length){const e=x(t);t=e.newShape}let i=h(t);if(t.length<=1&&i<=n)return[1,i];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const e=w_(t);let n=2,r=2;return t.length&&([n,r]=__(t)),i=e*(n/2)*(r/2),f(i).map((t=>2*t))}return f(i)}(n,l),e.texShape=d),null!=r){const t=k_(n);let o,a=d[1],s=d[0];const h=r instanceof Uint8Array;l?([a,s]=s_(d[0],d[1]),o=new j_(t,[s,a],h)):o=new W_(t,[s,a],h);const p=this.makeTensorInfo([s,a],i);this.texData.get(p.dataId).usage=h?e_.PIXELS:e_.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),a,s,r);const f=!0,g=this.runWebGLProgram(o,[p],i,null,f),m=this.texData.get(g.dataId);e.texture=m.texture,e.texShape=m.texShape,e.isPacked=m.isPacked,e.usage=m.usage,this.disposeIntermediateTensorInfo(p),this.texData.delete(g.dataId),e.values=null,u&&(this.uploadWaitMs+=Qt()-c)}else{const t=this.acquireTexture(d,s,i,l);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:i}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/** @license See the LICENSE file. */(e,i)),n.values}acquireTexture(t,e,n,i){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,i)}computeBytes(t,e){return t[0]*t[1]*A(e)}}yS.nextDataId=0;
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
We()&&Hi("webgl",(()=>new yS),2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;class vS{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=lo(e,n),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xS{constructor(t,e,n,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=lo(e,n);const r=this.outputShape.length;let o="";if(i)if(0===r||1===h(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(o=`\n          ${dk(r)} coords = getOutputCoords();\n        `,1===r)o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=iS("coords",r);o+=`\n            bool nextRowOutOfBounds =\n              (${t[r-2]} + 1) >= ${this.outputShape[r-2]};\n            bool nextColOutOfBounds =\n              (${t[r-1]} + 1) >= ${this.outputShape[r-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bS(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const wS={kernelName:"Identity",backendName:"webgl",kernelFunc:bS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _S(t){const{inputs:e,backend:n}=t,{real:i,imag:r}=e,o=n.makeTensorInfo(i.shape,"complex64"),a=n.texData.get(o.dataId),s=bS({inputs:{x:i},backend:n}),l=bS({inputs:{x:r},backend:n});return a.complexTensorInfos={real:s,imag:l},o}const kS={kernelName:"Complex",backendName:"webgl",kernelFunc:_S},SS="return (a < 0.) ? b * a : a;",CS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AS={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{alpha:o}=i,a=n.makeTensorInfo([],"float32",Zt(o,"float32")),s=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xS(CS,r.shape,a.shape):new vS(SS,r.shape,a.shape),l=n.runWebGLProgram(s,[r,a],r.dtype);return n.disposeIntermediateTensorInfo(a),l}},IS="return (a < 0.) ? b * a : a;",MS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DS={kernelName:"Prelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i,alpha:r}=e,o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xS(MS,i.shape,r.shape):new vS(IS,i.shape,r.shape);return n.runWebGLProgram(o,[i,r],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TS({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:i}){return({inputs:r,backend:o})=>{const{x:a}=r,s=o,l=i||a.dtype;if(s.shouldExecuteOnCPU([a])&&null!=n){const t=s.texData.get(a.dataId),e=n(t.values,l);return s.makeTensorInfo(a.shape,l,e)}let u;return u=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new dS(a.shape,e):new cS(a.shape,t),s.runWebGLProgram(u,[a],l)}}function ES({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:r,dtype:o}){return({inputs:a,backend:s})=>{const{a:l,b:u}=a,c=s;if(i&&"complex64"===l.dtype){const e=c.texData.get(l.dataId),n=c.texData.get(u.dataId),[i,r]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,i]=e,r={dataId:n.dataId,dtype:n.dtype,shape:l.shape},o={dataId:i.dataId,dtype:i.dtype,shape:u.shape},a=new vS(t,l.shape,u.shape);return c.runWebGLProgram(a,[r,o],Me(n.dtype,i.dtype))})),o=_S({inputs:{real:i,imag:r},backend:c});return c.disposeIntermediateTensorInfo(i),c.disposeIntermediateTensorInfo(r),o}const h=o||Me(l.dtype,u.dtype);if(("string"===l.dtype||"string"===u.dtype||c.shouldExecuteOnCPU([l,u]))&&null!=r){const t=c.texData.get(l.dataId).values,e=c.texData.get(u.dataId).values,n="string"===l.dtype?oc(t):t,i="string"===l.dtype?oc(e):e,[o,a]=r(l.shape,u.shape,n,i,h),s=c.makeTensorInfo(a,h);return c.texData.get(s.dataId).values=o,s}let d;return d=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new xS(e,l.shape,u.shape,n):new vS(t,l.shape,u.shape),c.runWebGLProgram(d,[l,u],h)}}function NS(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?MS:IS;if("leakyrelu"===t)return e?CS:SS;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OS{constructor(t,e,n,i=!1,r=!1,o=!1,a=null,s=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;const u=i?t[1]:t[2],c=Math.ceil(u/2),h=i?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";a&&(g=s?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${a}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${a}\n        }`:`vec4 activation(vec4 x) {\n          ${a}\n        }`,m="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",x="rc.x";t[0]<e[0]?v=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(x=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${g}\n\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${c}; i++) {\n          int batchA = ${v};\n          int batchB = ${x};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${m}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FS="return areal * breal - aimag * bimag;",RS="return areal * bimag + aimag * breal;";class LS{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=lo(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $S="return a * b;";function PS(t){const{inputs:e,backend:n}=t,{a:i,b:r}=e,o=Me(i.dtype,r.dtype);if("complex64"===i.dtype){const t=n.texData.get(i.dataId),e=n.texData.get(r.dataId),o=new LS(FS,i.shape,r.shape),a=new LS(RS,i.shape,r.shape),s=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape}],l=n.runWebGLProgram(o,s,"float32"),u=n.runWebGLProgram(a,s,"float32"),c=_S({inputs:{real:l,imag:u},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),c}if(n.shouldExecuteOnCPU([i,r])){const t=n.texData.get(i.dataId),e=n.texData.get(r.dataId),[a,s]=Lk(i.shape,r.shape,t.values,e.values,o),l=n.makeTensorInfo(s,o);return n.texData.get(l.dataId).values=a,l}let a;return a=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xS($S,i.shape,r.shape):new vS($S,i.shape,r.shape),n.runWebGLProgram(a,[i,r],o)}const zS={kernelName:"Multiply",backendName:"webgl",kernelFunc:PS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function BS(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{shape:o}=i,a=n,l=h(r.shape),u=y(o,l),c=h(u);s(l===c,(()=>`The new shape (${u}) has ${c} elements and the old shape (${r.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`));const d=a.texData.get(r.dataId);return!d.isPacked||C_(r.shape,u)||null!==d.texture&&C_(d.shape,u)?(a.incRef(r.dataId),{dataId:r.dataId,shape:u,dtype:r.dtype}):function(t,e,n){const i=[w_(t.shape),...__(t.shape)],r={dtype:t.dtype,shape:i,dataId:t.dataId},o=[w_(e),...__(e)],a=new oS(o,i),s=n.runWebGLProgram(a,[r],t.dtype,null,!0);return{dataId:s.dataId,shape:e,dtype:s.dtype}}(r,u,a)}const VS={kernelName:"Reshape",backendName:"webgl",kernelFunc:BS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:o}=t;this.outputShape=[i,o];const a=4*Math.floor(n/4),s=n%4;let l="sumValue += dot(values, ones);";if(null!=e){const t=1/e;l=`sumValue += dot(values * ${p(t)?t.toPrecision(2):t}, ones);`}let u="";r%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===s}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===s}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===s}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:o}=t;this.outputShape=[i,o];let a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?l="sumValue":"prod"===e?l="prodValue":"all"===e?l="allValue":"any"===e&&(l="anyValue");const u=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${s}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${s}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===e?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";r%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${a};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${a});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${l});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(t,e,n,i){const r=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],i=Tu(n);e.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return e}(t.shape);let o=t;for(let a=0;a<r.length;a++){const{inSize:s,windowSize:l,outSize:u}=r[a];let c,h;c="mean"===n?0===a?new WS({windowSize:l,inSize:s,batchSize:t.shape[0],outSize:u},s):new WS({windowSize:l,inSize:s,batchSize:t.shape[0],outSize:u}):new jS({windowSize:l,inSize:s,batchSize:t.shape[0],outSize:u},n),h=o,o=i.runWebGLProgram(c,[o],e),h.dataId!==t.dataId&&i.disposeIntermediateTensorInfo(h)}return o}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GS{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[e[i]];this.outputShape=n,this.rank=n.length;const i=dk(this.rank),r=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(e);for(let e=0;e<t.length;e++)i[t[e]]=n[e];return i.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n    void main() {\n      ${i} resRC = getOutputCoords();\n      setOutput(getA(${r}));\n    }\n    `}}class HS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[e[i]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=dk(this.rank),r=nS("rc",this.rank),o=new Array(this.rank);for(let t=0;t<e.length;t++)o[e[t]]=r[t];const a=`vec2(${o.slice(-2).join()})`,s=`++${r[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`\n    void main() {\n      ${i} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${s}) {\n        result[1] = ${l};\n      }\n      --${r[this.rank-1]};\n      if(++${r[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${s}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qS(t,e,n){const i=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HS(t.shape,e):new GS(t.shape,e);return n.runWebGLProgram(i,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XS(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i;return function(t,e,n,i){const r=e,o=t.shape.length,a=v(r,t.shape);let s=a;const l=Qo(s,o),u=null!=l;let c=t;u&&(c=qS(t,l,i),s=ea(s.length,o)),Jo("sum",s,o);const[d,p]=Ko(c.shape,s);let f=d;n&&(f=Zo(d,a));const g=h(p),m=BS({inputs:{x:c},attrs:{shape:[h(t.shape)/g,g]},backend:i}),y=US(m,De(t.dtype),"sum",i),x=BS({inputs:{x:y},attrs:{shape:f},backend:i});return i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(y),u&&i.disposeIntermediateTensorInfo(c),x}(r,o,a,n)}const YS={kernelName:"Sum",backendName:"webgl",kernelFunc:XS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KS(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{perm:o}=i,a=n,s=r.shape.length,l=new Array(s);for(let t=0;t<l.length;t++)l[t]=r.shape[o[t]];let u;if(a.shouldExecuteOnCPU([r])){const t=a.texData.get(r.dataId).values,e=tS(t,r.shape,r.dtype,o,l);u=a.makeTensorInfo(l,r.dtype);a.texData.get(u.dataId).values=e}else u=qS(r,o,a);return u}const ZS={kernelName:"Transpose",backendName:"webgl",kernelFunc:KS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS({a:t,b:e,transposeA:n,transposeB:i,backend:r,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:l=0,activation:u=null}){const c=t.shape.length,d=e.shape.length,p=n?t.shape[c-2]:t.shape[c-1],f=i?e.shape[d-1]:e.shape[d-2],g=n?t.shape[c-1]:t.shape[c-2],m=i?e.shape[d-2]:e.shape[d-1],y=t.shape.slice(0,-2),v=e.shape.slice(0,-2),x=h(y),b=h(v);s(c>=2&&d>=2&&(x===b||1===x||1===b),(()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${y}) and (${v}).`));const w=(x>b?t.shape.slice(0,-2):e.shape.slice(0,-2)).concat([g,m]);s(p===f,(()=>`Error in matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${i} must match.`));const _=n?[x,p,g]:[x,g,p],k=i?[b,m,f]:[b,f,m],S=BS({inputs:{x:t},backend:r,attrs:{shape:_}}),C=BS({inputs:{x:e},backend:r,attrs:{shape:k}}),A=[S,C],I=Math.max(x,b),M=n?S.shape[1]:S.shape[2],D=null!=o,T=null!=a,E="leakyrelu"===u,N=null!=u?NS(u,!0):null;let O;if((1===g||1===m)&&M>1e3&&!1===(D||T||E||null!=N)){let t=S,e=C;n&&(t=KS({inputs:{x:S},backend:r,attrs:{perm:[0,2,1]}}),A.push(t)),i&&(e=KS({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),A.push(e));const o=1===m;let a=t;1!==m&&(a=BS({inputs:{x:t},backend:r,attrs:{shape:[I,M,1]}}),A.push(a));const s=1===m?2:1;let l=e;o&&(l=BS({inputs:{x:e},backend:r,attrs:{shape:[I,1,M]}}),A.push(l));const u=PS({inputs:{a:a,b:l},backend:r});O=XS({inputs:{x:u},backend:r,attrs:{axis:s,keepDims:!0}}),A.push(u)}else{const s=Me(t.dtype,e.dtype),u=new OS(_,k,[I,g,m],n,i,D,N,T,E),c=[S,C];if(null!=o&&c.push(o),T&&c.push(a),E){const t=r.makeTensorInfo([],"float32",Zt(l,"float32"));c.push(t),A.push(t)}O=r.runWebGLProgram(u,c,s)}const F=BS({inputs:{x:O},backend:r,attrs:{shape:w}});A.push(O);for(const t of A)r.disposeIntermediateTensorInfo(t);return F}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:o,bias:a,preluActivationWeights:s}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=i;return JS({a:r,b:o,transposeA:l,transposeB:u,backend:n,bias:a,preluActivationWeights:s,leakyreluAlpha:h,activation:c})}},tC="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC={kernelName:"Abs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){const t=n.texData.get(i.dataId),e=Wk(t.values);return n.makeTensorInfo(i.shape,i.dtype,e)}let r;return r=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new dS(i.shape,tC):new cS(i.shape,tC),n.runWebGLProgram(r,[i],i.dtype)}},nC={kernelName:"Acos",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},iC={kernelName:"Acosh",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},rC={kernelName:"Add",backendName:"webgl",kernelFunc:ES({opSnippet:"return a + b;",packedOpSnippet:"return a + b;",supportsComplex:!0,cpuKernelImpl:mk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class oC{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const i=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${i};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aC{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const i=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${i};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sC={kernelName:"AddN",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:i}=e,r=n;if(1===r.length)return bS({inputs:{x:r[0]},backend:i});if(r.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(r.length/2),n=t({inputs:r.slice(0,e),backend:i}),o=t({inputs:r.slice(e),backend:i});return t({inputs:[n,o],backend:i})}const o=r.map((t=>t.dtype)).reduce(((t,e)=>Me(t,e))),a=r.map((t=>t.shape)),s=H().getBool("WEBGL_PACK")?new aC(r[0].shape,a):new oC(r[0].shape,a);return i.runWebGLProgram(s,r,o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC={kernelName:"All",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i,s=r.shape.length,l=v(o,r.shape);let u=l;const c=Qo(u,s);let d=r;null!=c&&(d=KS({inputs:{x:r},backend:n,attrs:{perm:c}}),u=ea(u.length,s)),Jo("all",u,s);const[p,f]=Ko(d.shape,u),g=BS({inputs:{x:d},backend:n,attrs:{shape:[-1,h(f)]}}),m=US(g,g.dtype,"all",n);let y;if(a){y=BS({inputs:{x:m},backend:n,attrs:{shape:Zo(p,l)}})}else y=BS({inputs:{x:m},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC={kernelName:"Any",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i,s=r.shape.length,l=v(o,r.shape);let u=l;const c=Qo(u,s);let d=r;null!=c&&(d=KS({inputs:{x:r},backend:n,attrs:{perm:c}}),u=ea(u.length,s)),Jo("any",u,s);const[p,f]=Ko(d.shape,u),g=BS({inputs:{x:d},backend:n,attrs:{shape:[-1,h(f)]}}),m=US(g,g.dtype,"any",n);let y;if(a){y=BS({inputs:{x:m},backend:n,attrs:{shape:Zo(p,l)}})}else y=BS({inputs:{x:m},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cC{constructor(t,e,n){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:o}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[r,o];const a="max"===e?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${i};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${i}; i++) {\n          int inIdx = ${s};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hC{constructor(t,e,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,s(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const r=t[t.length-1],o=Math.ceil(r/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=dk(l),c=iS("coords",l);let h,d;if(1===o){d=l+1;const t=dk(d);h=`\n        ${t} sourceLocR = ${t}(${c.join()}, 0);\n        ++${c[l-1]};\n        ${t} sourceLocG = ${t}(${c.join()}, 0);\n        ++${c[l-2]};\n        ${t} sourceLocA = ${t}(${c.join()}, 0);\n        --${c[l-1]};\n        ${t} sourceLocB = ${t}(${c.join()}, 0);\n        --${c[l-2]};`}else d=l,h=`\n        ${u} sourceLocR = coords;\n        ++${c[l-1]};\n        ${u} sourceLocG = coords;\n        ++${c[l-2]};\n        ${u} sourceLocA = coords;\n        --${c[l-1]};\n        ${u} sourceLocB = coords;\n        --${c[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],g=p.map((t=>"int "+t)),m=iS("sourceLocR",d-1).concat("inIdx.r"),y=iS("sourceLocG",d-1).concat("inIdx.g"),v=iS("sourceLocB",d-1).concat("inIdx.b"),x=iS("sourceLocA",d-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=i?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()}),\n                             getBestIndicesAChannel(${x.join()})));`,_=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${v.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${x.join()}) : 0.)`,k=i?"":`\n      float getBestIndicesAChannel(${g.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${g.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${k}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};\n        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};\n        ${h}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${_};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${w}\n          vec4 candidate = ${_};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dC(t,e,n,i=null){let r=e.shape[0],o=e.shape[1];null!=i&&(r=i.shape[0],o=i.shape[1]);const a=Tu(o),s={windowSize:a,inSize:o,batchSize:r,outSize:Math.ceil(o/a)},l=new cC(s,n,null==i),u=[e];null!=i&&u.push(i);const c=t.runWebGLProgram(l,u,"int32");if(1===c.shape[1])return c;const h=dC(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function pC(t,e,n,i=null){const r=null!=i?i.shape:e.shape,o=Tu(r[r.length-1]),a=new hC(r,o,n,null==i),s=null==i?[e]:[e,i],l=t.runWebGLProgram(a,s,"int32");if(l.shape.length===e.shape.length){const i=pC(t,e,n,l);return t.disposeIntermediateTensorInfo(l),i}return l}function fC(t,e,n,i){const r=[n];if(Jo("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,e.shape.length),!H().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],[o,a]=Ko(e.shape,r),s=h(a),l=BS({inputs:{x:e},backend:t,attrs:{shape:[-1,s]}});n.push(l);const u=dC(t,l,i);n.push(u);const c=BS({inputs:{x:u},backend:t,attrs:{shape:o}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),c}return pC(t,e,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gC={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o}=i;let a=v(o,r.shape);const s=Qo(a,r.shape.length);let l=r;const u=[];null!=s&&(l=KS({inputs:{x:r},backend:n,attrs:{perm:s}}),u.push(l),a=ea(a.length,l.shape.length)),Jo("argMax",[a[0]],l.shape.length);const c=fC(n,l,a[0],"max");return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mC={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o}=i;let a=v(o,r.shape);const s=Qo(a,r.shape.length);let l=r;const u=[];null!=s&&(l=KS({inputs:{x:r},backend:n,attrs:{perm:s}}),u.push(l),a=ea(a.length,l.shape.length)),Jo("argMin",[a[0]],l.shape.length);const c=fC(n,l,a[0],"min");return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}},yC={kernelName:"Asin",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},vC={kernelName:"Asinh",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},xC={kernelName:"Atan",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},bC={kernelName:"Atan2",backendName:"webgl",kernelFunc:ES({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},wC={kernelName:"Atanh",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _C{constructor(t,e,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,s=t.strideWidth,l=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,m=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${a}, ${s});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${i?r?g:m:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(v="avgValue / count");const x=4*Math.floor(o/4),b=o%4,w=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${s});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${x}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${x};\n          if (${1===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class kC{constructor(t,e,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,s=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,g=t.padInfo.front,m=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const v="avg"===e;let x="0.0";if(v||(x="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${a}, ${s}, ${l});\n        const ivec3 pads = ivec3(${g}, ${m}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${i?r?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / count");const w=4*Math.floor(o/4),_=o%4,k=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${a}, ${s}, ${l});\n      const ivec3 pads = ivec3(${g}, ${m}, ${y});\n      const float initializationValue = ${x};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${x});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${k}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${k}\n            }\n          }\n          setOutput(${b});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SC={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;N_(r,"avgPool");const{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=i;s(_r(a,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const c=dr(r.shape,o,a,1,l,u);if(1===c.filterWidth&&1===c.filterHeight&&d(c.inShape,c.outShape))return bS({inputs:{x:r},backend:n});const h=new _C(c,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CC={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:o,strides:a,pad:s,dimRoundingMode:l,dataFormat:u}=i,c=pr(r.shape,o,a,[1,1,1],s,l,u),h=new kC(c,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AC{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,l=t.effectiveFilterWidth,u=s-1-t.padInfo.top,c=l-1-t.padInfo.left,h=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${u}, ${c});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${s};\n            wR += ${o}) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class IC{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,i=t.filterWidth,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=c-1-t.padInfo.front,f=h-1-t.padInfo.top,g=d-1-t.padInfo.left,m=1/(e*n*i);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${g});\n      const float avgMultiplier = float(${m});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${s}) {\n          float dyD = float(dyDCorner + wD) / ${r}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${u}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,a=o,{filterSize:s,strides:l,pad:u,dimRoundingMode:c}=i,h=pr(a.shape,s,l,[1,1,1],u,c),d=new IC(h);return n.runWebGLProgram(d,[r],a.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DC={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,a=o;N_([r,o],"avgPoolGrad");const{filterSize:s,strides:l,pad:u}=i,c=dr(a.shape,s,l,1,u),h=new AC(c);return n.runWebGLProgram(h,[r],a.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:o}=e,{transposeA:a,transposeB:s}=i;return JS({a:r,b:o,transposeA:a,transposeB:s,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EC{constructor(t,e,n,i,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],lo(t,e),lo(t,n);let a="0.0";null!=i&&(lo(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let s="1.0";null!=r&&(lo(t,r),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${a};\n        float scale = ${s};\n        float inv = scale * inversesqrt(variance + float(${o}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NC{constructor(t,e,n,i,r,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],lo(t,e),lo(t,n);let a="vec4(0.0)";null!=i&&(lo(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=r&&(lo(t,r),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${a};\n        vec4 scale = ${s};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${o}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OC={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,mean:r,variance:o,offset:a,scale:l}=t;s(r.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),s(null==a||r.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),s(null==l||r.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const c=[i,r,o];let h=null;null!=a&&(h=a.shape,c.push(a));let d=null;null!=l&&(d=l.shape,c.push(l));const p=H().getBool("WEBGL_PACK_NORMALIZATION")?new NC(i.shape,r.shape,o.shape,h,d,u):new EC(i.shape,r.shape,o.shape,h,d,u);return e.runWebGLProgram(p,c,c[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class FC{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=dk(this.rank),n=`uniform int start[${this.rank}];`,i=function(t){if(1===t)return"sourceLoc";if(t<=6)return RC.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let r;r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${t.map(((t,e)=>`sourceLoc.${RC[e]} = start[${e}] + coords.${RC[e]};`)).join("\n")}\n      `,this.userCode=`\n      ${n}\n      void main() {\n        ${r}\n        setOutput(getSource(${i}));\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}const RC=["x","y","z","w","u","v"];class LC{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;const e=dk(this.rank),n=iS("coords",this.rank),i=iS("sourceLoc",this.rank),r=1===this.rank?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${r})`,a=`\n      result.x = ${o};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${i[this.rank-1]};\n        result.y = ${o};\n        --${i[this.rank-1]};\n      }\n    `,s=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${i[this.rank-2]};\n        result.z = ${o};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${i[this.rank-1]};\n          result.w = ${o};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${i[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      uniform int start[${this.rank}];\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${a}\n        ${s}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $C(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:o,size:a}=i,[s,l]=Ti(r,o,a);if(mi(r,s,l),0===h(l))return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||"string"===r.dtype){const t=n.texData.get(r.dataId),e=jk(t.values,s,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,e)}const{isPacked:u}=n.texData.get(r.dataId),c=Mi(r.shape,s,l);if(u||!c){const t=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LC(l):new FC(l),e=t.getCustomSetupFunc(s);return n.runWebGLProgram(t,[r],r.dtype,e)}return n.uploadToGPU(r.dataId),function(t,e,n,i){const r=i.texData.get(t.dataId),o=i.makeTensorInfo(n,t.dtype),a=i.texData.get(o.dataId);Object.assign(a,r),a.refCount=1,a.shape=n,a.dtype=t.dtype;let s=Di(e,F(t.shape));r.slice&&(s+=r.slice.flatOffset),a.slice={flatOffset:s,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=i.dataRefCount.get(a.slice.origDataId)||1;return i.dataRefCount.set(a.slice.origDataId,l+1),o}(r,s,l,n)}const PC={kernelName:"Slice",backendName:"webgl",kernelFunc:$C},zC={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:o,crops:a}=i;s(r.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const l=o.reduce(((t,e)=>t*e)),u=Nu(r.shape,o,l),c=Ou(u.length,o.length),h=Fu(r.shape,o,l),d=Ru(a,o.length),p=Lu(h,a,o.length),f=[],g=BS({inputs:{x:r},backend:n,attrs:{shape:u}}),m=KS({inputs:{x:g},backend:n,attrs:{perm:c}}),y=BS({inputs:{x:m},backend:n,attrs:{shape:h}}),v=$C({inputs:{x:y},backend:n,attrs:{begin:d,size:p}});return f.push(g),f.push(m),f.push(y),f.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC={kernelName:"Bincount",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:o}=e,{size:a}=i,s=n.readSync(r.dataId),l=n.readSync(o.dataId),u=yk(s,l,o.dtype,o.shape,a);return n.makeTensorInfo([a],o.dtype,u)}},VC=ES({opSnippet:"return float(a != b);",cpuKernelImpl:Pk,dtype:"bool"}),WC={kernelName:"NotEqual",backendName:"webgl",kernelFunc:VC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jC(t){const{inputs:e,backend:n}=t,{input:i}=e;return bS({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.real},backend:n})}const UC={kernelName:"Real",backendName:"webgl",kernelFunc:jC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GC={kernelName:"Cast",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function t(e){const{inputs:n,backend:i,attrs:r}=e,{x:o}=n,{dtype:a}=r;if("complex64"===a){if("complex64"===o.dtype)return bS({inputs:{x:o},backend:i});const e=da(o.shape),n=t({inputs:{x:o},backend:i,attrs:{dtype:"float32"}}),r=_S({inputs:{real:n,imag:e},backend:i});return e.dispose(),i.disposeIntermediateTensorInfo(n),r}if("complex64"===o.dtype){const e=jC({inputs:{input:o},backend:i}),n=t({inputs:{x:e},backend:i,attrs:{dtype:a}});return i.disposeIntermediateTensorInfo(e),n}if(!S(o.dtype,a)){const t=bS({inputs:{x:o},backend:i});return{dataId:t.dataId,shape:t.shape,dtype:a}}if("int32"===a)return function(t,e){const n=new cS(t.shape,"return float(int(x));"),i=e.runWebGLProgram(n,[t],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}(o,i);if("bool"===a){const t=i.makeTensorInfo([],"bool",b("bool",1)),e=VC({inputs:{a:o,b:t},backend:i});return i.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${a}`)}},HC="return ceil(x);",qC={kernelName:"Ceil",backendName:"webgl",kernelFunc:TS({opSnippet:HC,packedOpSnippet:HC,cpuKernelImpl:xk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class XC{constructor(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(t,e){return(n,i)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(i,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(i,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YC{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(t,e){return(n,i)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(i,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(i,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KC={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{clipValueMin:o,clipValueMax:a}=i;let s;s=H().getBool("WEBGL_PACK_CLIP")?new YC(r.shape):new XC(r.shape);const l=s.getCustomSetupFunc(o,a);return n.runWebGLProgram(s,[r],r.dtype,l)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZC{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JC(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const QC={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e,r=n.texData.get(i.dataId),o=new ZC(i.shape),a=[JC(i,r.complexTensorInfos.real),JC(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(o,a,a[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tA{constructor(t){this.outputShape=[],this.outputShape=Du(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const i=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${i}));`)}const i=e.length,r=e[e.length-1];n.push(`else setOutput(getT${i}(yR, yC-${r}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eA{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Du(t,e);const n=this.outputShape,i=n.length,r=dk(i),o=iS("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map(((t,e)=>`T${e}`));const s=new Array(t.length-1);s[0]=t[0][e];for(let n=1;n<s.length;n++)s[n]=s[n-1]+t[n][e];const l=a[e],u=a.slice(-2),c=a.join();let h=`if (${l} < ${s[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${u.join()}));\n        }`;for(let t=1;t<s.length;t++){const e=s[t-1];h+=`\n        if (${l} < ${s[t]}  && ${l} >= ${s[t-1]}) {\n          return getChannel(\n            getT${t}(${nA(a,l,e)}),\n            vec2(${nA(u,l,e)}));\n        }`}const d=s.length,p=s[s.length-1];h+=`\n        return getChannel(\n          getT${d}(${nA(a,l,p)}),\n          vec2(${nA(u,l,p)}));`,this.userCode=`\n      float getValue(${a.map((t=>"int "+t))}) {\n        ${h}\n      }\n\n      void main() {\n        ${r} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${o}), 0., 0., 0.);\n\n        ${o[i-1]} = ${o[i-1]} + 1;\n        if (${o[i-1]} < ${n[i-1]}) {\n          result.g = getValue(${o});\n        }\n\n        ${o[i-2]} = ${o[i-2]} + 1;\n        if (${o[i-2]} < ${n[i-2]}) {\n          result.a = getValue(${o});\n        }\n\n        ${o[i-1]} = ${o[i-1]} - 1;\n        if (${o[i-2]} < ${n[i-2]} &&\n            ${o[i-1]} < ${n[i-1]}) {\n          result.b = getValue(${o});\n        }\n        setOutput(result);\n      }\n    `}}function nA(t,e,n){const i=t.indexOf(e);return t.map(((t,e)=>e===i?`${t} - ${n}`:t)).join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(t){const{inputs:e,backend:n}=t,{input:i}=e;return bS({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.imag},backend:n})}const rA={kernelName:"Imag",backendName:"webgl",kernelFunc:iA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(t,e,n){const i=t[0].dtype;if("complex64"===i){const i=t.map((t=>jC({inputs:{input:t},backend:n}))),r=t.map((t=>iA({inputs:{input:t},backend:n}))),o=oA(i,e,n),a=oA(r,e,n),s=_S({inputs:{real:o,imag:a},backend:n});return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),r.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),s}let r=n.shouldExecuteOnCPU(t);if("string"===i&&(r=!0),r){const r=t.map((t=>{const i=h(t.shape.slice(e));return BS({inputs:{x:t},backend:n,attrs:{shape:[-1,i]}})})),o=r.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),a=Du(r.map((t=>t.shape)),1),s=1===r[0].shape[0],l=bk(o,a,i,s),u=Du(t.map((t=>t.shape)),e),c=n.makeTensorInfo(u,i,l);return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}if(t.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const i=Math.floor(t.length/2),r=oA(t.slice(0,i),e,n),o=oA(t.slice(i),e,n),a=oA([r,o],e,n);return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),a}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const r=new eA(t.map((t=>t.shape)),e);return n.runWebGLProgram(r,t,i)}const{tensors2D:o,outShape:a}=function(t,e,n){const i=Du(t.map((t=>t.shape)),e);return{tensors2D:t.map((t=>BS({inputs:{x:t},attrs:{shape:[-1,h(t.shape.slice(e))]},backend:n}))),outShape:i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n),s=new tA(o.map((t=>t.shape))),l=n.runWebGLProgram(s,o,i);o.forEach((t=>n.disposeIntermediateTensorInfo(t)));const u=BS({inputs:{x:l},attrs:{shape:a},backend:n});return n.disposeIntermediateTensorInfo(l),u}function aA(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i,o=v(r,e[0].shape)[0],a=Du(e.map((t=>t.shape)),o);if(0===h(a))return n.makeTensorInfo(a,e[0].dtype,[]);const s=e.filter((t=>h(t.shape)>0));if(1===s.length)return bS({inputs:{x:s[0]},backend:n});return Mu(s.map((t=>t.shape)),o),oA(s,o,n)}const sA={kernelName:"Concat",backendName:"webgl",kernelFunc:aA};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lA{constructor(t,e=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,s=t.strideHeight,l=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4,g="channelsLast"===t.dataFormat,m=g?1:2,y=g?2:3,v=g?3:1;let x="",b="";n&&(x=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,b="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${x}\n\n      const ivec2 strides = ivec2(${s}, ${l});\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${u};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${g}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${g}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${g}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${g}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${b}\n        setOutput(result);\n      }\n    `}}class uA{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,i=t.padInfo.left,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,c=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${r}, ${o}, ${a});\n      const ivec3 pads = ivec3(${e}, ${n}, ${i});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${s};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cA{constructor(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;const{filterWidth:i,inChannels:r,strideWidth:o,strideHeight:a,padInfo:s,outWidth:l,dilationWidth:u,dilationHeight:c,dataFormat:h}=n,{left:d,top:p}=s,f=r*i,g=F_(),m="channelsLast"===h,y=m?0:1,v=m?1:2;let x="";for(let n=0;n<=1;n++)for(let i=0;i<=1;i++)x+=`\n          blockIndex = rc.y + ${i};\n          pos = rc.x + ${n};\n\n          if(blockIndex < ${t[1]} && pos < ${t[0]}) {\n            offsetY = int(blockIndex / (${l})) * ${a} - ${p};\n            d0 = offsetY + ${c} * (pos / ${f});\n\n            if(d0 < ${e[y]} && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ${l}.) * ${o}. - ${d}.);\n              d1 = offsetX + ${u} * (int(mod(float(pos), ${f}.) / ${r}.));\n\n              if(d1 < ${e[v]} && d1 >= 0) {\n\n                ch = int(mod(float(pos), ${r}.));\n\n                if (${m}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*n+i}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*n+i}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${x}\n\n        ${g.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape,c=i.texData.get(t.dataId),h=n.inChannels,d=u[0]*u[1]*u[2],p=n.outChannels,f="channelsLast"===n.dataFormat;let g;const m=[],y=(1===d||1===p)&&h>1e3,v=u[2]%2!=0&&!!c.isPacked;if(!y&&H().getBool("WEBGL_LAZILY_UNPACK")&&H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&v){const h=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),d={dataId:t.dataId,shape:[1,h,n.inChannels],dtype:t.dtype},p=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,s(C_(c.shape,d.shape),(()=>`packed reshape ${c.shape} to ${d.shape} isn't free`));const y=BS({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(y);const v=JS({a:d,b:y,backend:i,transposeA:false,transposeB:false,bias:r,activation:l,preluActivationWeights:o,leakyreluAlpha:a}),x=i.texData.get(v.dataId);s(x.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=p,x.shape=n.outShape,g=bS({inputs:{x:v},backend:i}),g.shape=n.outShape,m.push(v)}else{const s=BS({inputs:{x:t},backend:i,attrs:{shape:[1,f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],n.inChannels]}}),c=BS({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=JS({a:s,b:c,transposeA:false,transposeB:false,backend:i,bias:r,activation:l,preluActivationWeights:o,leakyreluAlpha:a});g=BS({inputs:{x:h},backend:i,attrs:{shape:n.outShape}}),m.push(s),m.push(c),m.push(h)}for(const t of m)i.disposeIntermediateTensorInfo(t);return g}function dA({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:s=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:d,outHeight:p,dataFormat:f}=n,g="channelsLast"===f,m=l*u*c,y=p*d,v=[m,y],x=[],b=BS({inputs:{x:t},backend:i,attrs:{shape:t.shape.slice(1)}}),w=BS({inputs:{x:e},backend:i,attrs:{shape:[1,m,h(e.shape)/m]}});x.push(b),x.push(w);const _=new cA(v,b.shape,n),k=i.runWebGLProgram(_,[b],"float32"),S=BS({inputs:{x:k},backend:i,attrs:{shape:[1,v[0],v[1]]}});x.push(k),x.push(S);const C=null!=r,A=null!=o,I="leakyrelu"===s,M=s?NS(s,!0):null,D=new OS(S.shape,w.shape,[1,y,n.outChannels],!0,!1,C,M,A,I),T=[S,w];if(r&&T.push(r),A&&T.push(o),I){const t=i.makeTensorInfo([],"float32",Zt(a,"float32"));T.push(t),x.push(t)}const E=i.runWebGLProgram(D,T,"float32"),N=BS({inputs:{x:E},backend:i,attrs:{shape:g?[1,p,d,n.outChannels]:[1,n.outChannels,p,d]}});x.push(E);for(const t of x)i.disposeIntermediateTensorInfo(t);return N}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pA={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:s,dataFormat:l,dilations:u,dimRoundingMode:c}=i,h=kr(l),d=fr(r.shape,o.shape,a,u,s,c,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(H().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])p=dA({x:r,filter:o,convInfo:d,backend:n});else{const t=new lA(d);p=n.runWebGLProgram(t,[r,o],"float32")}else p=hA({x:r,filter:o,convInfo:d,backend:n});const f=BS({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fA{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,i=t.padInfo.top,r=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${i};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${o}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class gA{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,s=n-1-t.padInfo.left,l=o?1:2,u=o?2:3,c=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class mA{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,i=t.strideWidth,r=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${r};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${o};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${i} - ${a};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class yA{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,i=t.filterWidth,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=e-1-t.padInfo.front,l=n-1-t.padInfo.top,u=i-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${s}, ${l}, ${u});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${r}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${i}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${i} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vA={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,pad:s,dataFormat:l,dimRoundingMode:u,filterShape:c}=i,h=kr(l),d=fr(r.shape,c,a,1,s,u,!1,h),p=new fA(d);return n.runWebGLProgram(p,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{inputShape:a,strides:s,pad:l,dataFormat:u,dimRoundingMode:c}=i,h=kr(u),d=fr(a,o.shape,s,1,l,c,!1,h),p=new gA(d);return n.runWebGLProgram(p,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bA={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:s,dilations:l}=i,u=gr(r.shape,o.shape,a,l,s),c=new uA(u);return n.runWebGLProgram(c,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wA={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,pad:s,filterShape:l}=i,u=gr(r.shape,l,a,1,s),c=new mA(u);return n.runWebGLProgram(c,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _A={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{pad:a,strides:s,inputShape:l}=i,u=gr(l,o.shape,s,1,a),c=new yA(u);return n.runWebGLProgram(c,[r,o],"float32")}},kA=TS({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),SA={kernelName:Z,backendName:"webgl",kernelFunc:kA},CA={kernelName:"Cosh",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class AA{constructor(t,e,n,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,s,l]=t,[u]=e,[c,h]=n;this.outputShape=[u,c,h,l];const d="bilinear"===i?1:0,[p,f]=[a-1+".0",s-1+".0"],[g,m,y]=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,x,b]=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${g});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${m};\n        float width_scale = ${x};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${r}));\n          return;\n        }\n        float in_x = ${b};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${r}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{image:r,boxes:o,boxInd:a}=e,{cropSize:s,method:l,extrapolationValue:u}=i,c=new AA(r.shape,o.shape,s,l,u);return n.runWebGLProgram(c,[r,o,a],"float32")}};class MA{constructor(t,e,n){this.variableNames=["x"],this.outputShape=t;const i=t.length,r=e?"0.0":`getX(${DA(i,"coords")})`,o=t[t.length-1];let a="",s="";e?(a=n?"end != "+(o-1):"end != 0",s=n?"end + 1":"end - 1"):(a=n?`end + pow2 < ${o}`:"end >= pow2",s=n?"end + pow2":"end - pow2"),this.userCode=`\n      uniform float index;\n      void main() {\n        ${dk(i)} coords = getOutputCoords();\n        int end = ${TA(i,"coords")};\n        float val = ${r};\n        int pow2 = int(pow(2.0, index));\n        if (${a}) {\n          int idx = ${s};\n          ${TA(i,"coords")} = idx;\n          val += getX(${DA(i,"coords")});\n        }\n        setOutput(val);\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.index&&(this.index=e.getUniformLocation(n,"index")),e.gl.uniform1f(this.index,t)}}}function DA(t,e){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function TA(t,e){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EA={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,exclusive:a,reverse:s}=i,l=r.shape.length,u=Qo([o],l);let c=r;null!=u&&(c=KS({inputs:{x:r},backend:n,attrs:{perm:u}}));const h=ea(1,l)[0];if(h!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${r.shape.length-1} but got axis=${o}`);const d=c.shape[h];let p=bS({inputs:{x:c},backend:n});for(let t=0;t<=Math.ceil(Math.log2(d))-1;t++){const e=new MA(c.shape,!1,s),i=e.getCustomSetupFunc(t),r=p;p=n.runWebGLProgram(e,[p],p.dtype,i),n.disposeIntermediateTensorInfo(r)}if(a){const t=new MA(c.shape,a,s),e=p;p=n.runWebGLProgram(t,[p],p.dtype),n.disposeIntermediateTensorInfo(e)}if(null!=u){const t=KS({inputs:{x:p},backend:n,attrs:{perm:ta(u)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(c),t}return p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NA={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:o}=e,{size:a,binaryOutput:s}=i;if(1===r.shape.length){const t=n.readSync(r.dataId),e=n.readSync(o.dataId),i=yk(t,e,o.dtype,o.shape,a);return n.makeTensorInfo([a],o.dtype,i)}if(2===r.shape.length){const t=n.bufferSync(r),e=n.bufferSync(o),i=vk(t,e,a,s);return n.makeTensorInfo(i.shape,o.dtype,i.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OA{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockSize:o,dataFormat:a}=i;s(o>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${o}`));const l=r.shape[0],u="NHWC"===a?r.shape[1]:r.shape[2],c="NHWC"===a?r.shape[2]:r.shape[3],h="NHWC"===a?r.shape[3]:r.shape[1],d=u*o,p=c*o,f=h/(o*o),g=new OA("NHWC"===a?[l,d,p,f]:[l,f,d,p],o,a);return n.runWebGLProgram(g,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RA{constructor(t,e=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.inHeight,a=t.inWidth,s=t.padInfo.top,l=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,h=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,f=t.filterWidth,g=t.outChannels/t.inChannels;let m="",y="";n&&(m=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,y="result = activation(result);");const v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${m}\n\n      const ivec2 strides = ivec2(${u}, ${c});\n      const ivec2 pads = ivec2(${s}, ${l});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${g};\n        int q = d2 - d1 * ${g};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${p}; wR++) {\n          int xR = xRCorner + wR * ${h};\n\n          if (xR < 0 || xR >= ${o}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${f}; wC++) {\n            int xC = xCCorner + wC * ${d};\n\n            if (xC < 0 || xC >= ${a}) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${v}\n        ${y}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LA{constructor(t,e=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;const a=t.outChannels/t.inChannels,s=t.inHeight,l=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,h=t.strideHeight,d=t.strideWidth,p=t.dilationHeight,f=t.dilationWidth,g=t.filterHeight,m=t.filterWidth,y=m;let v="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<m;t++)v+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xC${t};`;for(let t=0;t<g;t++){for(let t=0;t<m;t++)v+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xC${t} = vec4(0.0);`;v+=`\n        xR = xRCorner + ${t*p};\n        if (xR >=0 && xR < ${s}) {\n      `;for(let e=0;e<(y+1)/2;e++){const n=2*e,i=n*f;if(v+=`\n          xC = xCCorner + ${i};\n          `,1===d){if(n<m&&(c%2==1?(v+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${i}Ready == 0) {\n                  xTexelC${i} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= ${l}) {\n                    xTexelC${i}.zw = vec2(0.0);\n                  }\n                  xTexelC${i}Ready = 1;\n                }\n              `,v+=1===f&&i>0?`\n                xC${n} = vec4(xTexelC${i-2}.zw, xTexelC${i}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < ${l}) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= ${l}) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${n} = vec4(previous.zw, xTexelC${i}.xy);\n                  } else {\n                    xC${n} = vec4(0.0, 0.0, xTexelC${i}.xy);\n                  }\n                  `):v+=`\n                if (xC >= 0 && xC < ${l} && xTexelC${i}Ready == 0) {\n                  xTexelC${i} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= ${l}) {\n                    xTexelC${i}.zw = vec2(0.0);\n                  }\n                  xTexelC${i}Ready = 1;\n                }\n\n                xC${n} = xTexelC${i};\n                `,i+1<m)){const t=c%2==0?o(f):f;f%2==0&&c%2==1||f%2!=0&&c%2!=1?(v+=`\n                  xCOffset = xC + ${c%2} + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${i+2}Ready == 0) {\n                    xTexelC${i+2} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= ${l}) {\n                      xTexelC${i+2}.zw = vec2(0.0);\n                    }\n                    xTexelC${i+2}Ready = 1;\n                  }\n                  `,f>1&&(v+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${i}Ready == 0) {\n                      xTexelC${i} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${i}Ready = 1;\n                    }\n                    `),v+=`\n                  xC${n+1} = vec4(xTexelC${i}.zw, xTexelC${i+2}.xy);\n                  `):v+=1===t?`\n                    xC${n+1} = xTexelC${i};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${i+2}Ready == 0) {\n                      xTexelC${i+2} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= ${l}) {\n                        xTexelC${i+2}.zw = vec2(0.0);\n                      }\n                      xTexelC${i+2}Ready = 1;\n                    }\n\n                    xC${n+1} = xTexelC${i+2};\n                    `}}else i<m&&(c%2==1?(v+=`\n                xCOffset = xC + 1 - ${d};\n                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${i}Ready == 0) {\n                  xTexelC${i} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= ${l}) {\n                    xTexelC${i}.zw = vec2(0.0);\n                  }\n                  xTexelC${i}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${i+2}Ready == 0) {\n                  xTexelC${i+2} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= ${l}) {\n                    xTexelC${i+2}.zw = vec2(0.0);\n                  }\n                  xTexelC${i+2}Ready = 1;\n                }\n\n                xC${n} = vec4(xTexelC${i}.zw, xTexelC${i+2}.zw);\n              `,i+1<m&&(v+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + ${d};\n                  if(xCOffset >= 0 && xCOffset < ${l}) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${n+1} = vec4(xTexelC${i+2}.xy, final.xy);\n                `)):(v+=`\n                if(xC >= 0 && xC < ${l} && xTexelC${i}Ready == 0) {\n                  xTexelC${i} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= ${l}) {\n                    xTexelC${i}.zw = vec2(0.0);\n                  }\n                  xTexelC${i}Ready = 1;\n                }\n\n                xCOffset = xC + ${d};\n                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${i+2}Ready == 0) {\n                  xTexelC${i+2} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= ${l}) {\n                    xTexelC${i+2}.zw = vec2(0.);\n                  }\n                  xTexelC${i+2}Ready = 1;\n                }\n\n                xC${n} = vec4(\n                  xTexelC${i}.xy, xTexelC${i+2}.xy);\n              `,i+1<m&&(v+=`\n                  xC${n+1} = vec4(xTexelC${i}.zw, xTexelC${i+2}.zw);\n                `)));n<m&&(v+=`\n            wTexel = getW(${t}, ${i}, d1, q);\n            dotProd += xC${n} * vec4(wTexel.xz, wTexel.xz);\n          `,i+1<m&&(v+=`\n              wTexel = getW(${t}, ${i+1}, d1, q);\n              dotProd += xC${n+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}v+="\n        }\n      "}let x="",b="";n&&(x=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,b="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${x}\n\n      const ivec2 strides = ivec2(${h}, ${d});\n      const ivec2 pads = ivec2(${u}, ${c});\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${v}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${w}\n        ${b}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $A={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:l,dilations:u,dimRoundingMode:c}=i;let h=u;null==h&&(h=[1,1]),s(_r(a,h),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`));const d=fr(r.shape,o.shape,a,h,l,c,!0);let p;return p=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new LA(d):new RA(d),n.runWebGLProgram(p,[r,o],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PA{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,i=t.padInfo.top,r=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${o} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${i};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class zA{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${s}; dm++) {\n              int d2 = d1 * ${s} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BA={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:o}=e,{strides:a,dilations:s,pad:l,dimRoundingMode:u,filterShape:c}=i,h=fr(r.shape,c,a,s,l,u,!0),d=new PA(h);return n.runWebGLProgram(d,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VA={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:o}=e,{strides:a,dilations:s,pad:l,dimRoundingMode:u,inputShape:c}=i,h=fr(c,o.shape,a,s,l,u,!0),d=new zA(h);return n.runWebGLProgram(d,[r,o],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WA{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jA={kernelName:"Diag",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e,r=[...i.shape,...i.shape],o=h(i.shape),a=BS({inputs:{x:i},backend:n,attrs:{shape:[o]}}),s=new WA(o),l=n.runWebGLProgram(s,[a],a.dtype),u=BS({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UA{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:i,strideHeight:r,strideWidth:o,filterHeight:a,filterWidth:s,dilationHeight:l,dilationWidth:u}=t,{top:c,left:h}=i;this.userCode=`\n      const ivec2 strides = ivec2(${r}, ${o});\n      const ivec2 pads = ivec2(${c}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${s}; w++) {\n              int wIn = wBeg + w * ${u};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GA={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o}=e,{strides:a,pad:s,dilations:l}=i,u=hr(r.shape,o.shape,a,s,"NHWC",l);let c;const h=new UA(u);c=n.runWebGLProgram(h,[r,o],"float32");const d=BS({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),d}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{equation:r}=i,o=e,{allDims:a,summedDims:s,idDims:l}=Xu(r,o.length);Ku(a.length,l,o);const{path:u,steps:c}=Zu(s,l),h=c.length;let p=null,f=a.length;const g=[];for(let t=0;t<h;++t){for(const e of c[t]){const{permutationIndices:t,expandDims:i}=Yu(f,l[e]);let r;Ju(t)?r=o[e]:(r=KS({inputs:{x:o[e]},backend:n,attrs:{perm:t}}),g.push(r));const a=r.shape.slice();for(let t=0;t<i.length;++t)a.splice(i[t],0,1);d(r.shape,a)||(r=BS({inputs:{x:r},backend:n,attrs:{shape:a}}),g.push(r)),null===p?p=r:(p=PS({inputs:{a:r,b:p},backend:n}),g.push(p))}t<h-1&&(u[t]>=0&&(p=XS({inputs:{x:p},backend:n,attrs:{axis:u[t]-(a.length-f),keepDims:!1}}),g.push(p)),f--)}for(const t of g)t!==p&&n.disposeIntermediateTensorInfo(t);return p}},qA={kernelName:"Elu",backendName:"webgl",kernelFunc:TS({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},XA={kernelName:"EluGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:i,y:r}=e,o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xS("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",i.shape,r.shape):new vS("return (b >= 1.0) ? a : a * (b + 1.0);",i.shape,r.shape);return n.runWebGLProgram(o,[i,r],i.dtype)}},YA={kernelName:"Equal",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:wk})},KA=TS({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'}),ZA={kernelName:J,backendName:"webgl",kernelFunc:KA},JA="return exp(x);",QA=TS({opSnippet:JA,packedOpSnippet:JA,cpuKernelImpl:_k}),tI={kernelName:Q,backendName:"webgl",kernelFunc:QA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function eI(t){const{inputs:e,attrs:n,backend:i}=t,{dim:r}=n,{input:o}=e,a=o.shape.length,l=o.shape.slice();let u=r;return r<0&&(s(-(a+1)<=r,(()=>`Axis must be in the interval [${-(a+1)}, ${a}]`)),u=a+r+1),l.splice(u,0,1),BS({inputs:{x:o},backend:i,attrs:{shape:l}})}const nI={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:eI},iI="return exp(x) - 1.0;",rI={kernelName:"Expm1",backendName:"webgl",kernelFunc:TS({opSnippet:iI,packedOpSnippet:iI,cpuKernelImpl:kk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class oI{constructor(t,e,n){this.variableNames=["real","imag"];const i=e[1];this.outputShape=e;const r=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${i}.0`:"1.0";let a;if("real"===t)a="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${r};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${i});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${i}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${o};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aI(t,e,n){const i=n.texData.get(t.dataId),r=h(t.shape),o=t.shape[t.shape.length-1],a=BS({inputs:{x:t},backend:n,attrs:{shape:[r/o,o]}}),s=a.shape,l=new oI("real",s,e),u=new oI("imag",s,e),c=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:s},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:s}],d=n.runWebGLProgram(l,c,"float32"),p=n.runWebGLProgram(u,c,"float32"),f=_S({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);const g=BS({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),g}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sI={kernelName:"FFT",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:i}=e;return aI(i,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lI{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(t){return(e,n)=>{null==this.valueLoc&&(this.valueLoc=e.getUniformLocationNoThrow(n,"value")),e.gl.uniform1f(this.valueLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uI(t){const{backend:e,attrs:n}=t,{shape:i,value:r}=n;let{dtype:o}=n;if(o=o||E(r),"string"===o){const t=w(o,h(i));return t.fill(r),e.makeTensorInfo(i,o,t)}{const t=new lI(i,r),n=t.getCustomSetupFunc(r);return e.runWebGLProgram(t,[],o,n)}}const cI={kernelName:"Fill",backendName:"webgl",kernelFunc:uI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hI{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dI={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,i=e,r=new hI(n.shape);return i.runWebGLProgram(r,[n],n.dtype)}},pI="return floor(x);",fI={kernelName:"Floor",backendName:"webgl",kernelFunc:TS({opSnippet:pI,packedOpSnippet:pI,cpuKernelImpl:Sk})},gI={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:ES({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class mI{constructor(t){this.variableNames=["A"];const e=F_(),[n,i]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yI{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=F_(),[n,i]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${i}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vI={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t;let{pixels:r}=e;const{numChannels:o}=i,a="undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement,[l,u]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],h=[u,l,o];(s||a)&&(null==xI&&(xI=document.createElement("canvas").getContext("2d")),xI.canvas.width=l,xI.canvas.height=u,xI.drawImage(r,0,0,l,u),r=xI.canvas);const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=e_.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const p=H().getBool("WEBGL_PACK")?new yI(h):new mI(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let xI;const bI={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o,bias:a,preluActivationWeights:s}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,g=kr(c),m=fr(r.shape,o.shape,l,h,u,d,!1,g);let y;const v=[];if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if(H().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])y=dA({x:r,filter:o,convInfo:m,backend:n,bias:a,activation:p,preluActivationWeights:s,leakyreluAlpha:f});else{const t=null!=a,e=null!=s,i="leakyrelu"===p,l=p?NS(p,!1):null,u=new lA(m,t,l,e,i),c=[r,o];if(a&&c.push(a),s&&c.push(s),i){const t=n.makeTensorInfo([],"float32",Zt(f,"float32"));c.push(t),v.push(t)}y=n.runWebGLProgram(u,c,"float32")}else y=hA({x:r,filter:o,convInfo:m,backend:n,bias:a,activation:p,preluActivationWeights:s,leakyreluAlpha:f});const x=BS({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return v.push(y),v.forEach((t=>n.disposeIntermediateTensorInfo(t))),x}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wI={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:o,bias:a,preluActivationWeights:l}=e,{strides:u,pad:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,g=[];let m=h;null==m&&(m=[1,1]),s(_r(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const y=fr(r.shape,o.shape,u,m,c,d,!0),v=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,x=p?NS(p,v):null,b=[r,o],w=null!=a,_=null!=l,k="leakyrelu"===p;if(w&&b.push(a),_&&b.push(l),k){const t=n.makeTensorInfo([],"float32",Zt(f,"float32"));b.push(t),g.push(t)}let S;S=v?new LA(y,w,x,_,k):new RA(y,w,x,_,k);const C=n.runWebGLProgram(S,b,"float32");return g.forEach((t=>n.disposeIntermediateTensorInfo(t))),C}};class _I{constructor(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;const i=dk(e.length),r=dk(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${i} strides = ${i}(${this.strides});\n         void main() {\n          ${r} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${o};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kI={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:i,indices:r}=e,o=r.shape,a=o[o.length-1],s=h(i.shape),[l,u,c,d]=ci(i,r),p=BS({inputs:{x:r},backend:n,attrs:{shape:[u,a]}}),f=BS({inputs:{x:i},backend:n,attrs:{shape:[h(i.shape)/c,c]}});if(n.shouldExecuteOnCPU([i,r])||"string"===i.dtype){const t=n.readSync(r.dataId),e=n.bufferSync(i),o=Ck(t,e,i.dtype,u,a,c,d,i.shape,s);return n.makeTensorInfo(l,i.dtype,o.values)}const g=new _I(a,d,[u,c]),m=n.runWebGLProgram(g,[f,p],f.dtype),y=BS({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SI{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=dk(this.rank),i=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let e=0;e<t.length;e++)2===e?i.push("int(getIndices(resRC.x, resRC.z))"):i.push(`${n[e]}`);return i.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}const CI={kernelName:"GatherV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,indices:o}=e,{axis:a,batchDims:s}=i,l=ic(r,o,v(a,r.shape)[0],s),u=h(o.shape),c=[],d=BS({inputs:{x:r},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=BS({inputs:{x:o},backend:n,attrs:{shape:[l.batchSize,u/l.batchSize]}});c.push(d),c.push(p);const f=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([r,o])||"string"===r.dtype){const t=n.bufferSync(p),e=n.bufferSync(d),i=Ak(e,t,f);return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(l.outputShape,i.dtype,i.values)}const g=new SI(d.shape,f),m=n.runWebGLProgram(g,[d,p],d.dtype);c.push(m);const y=BS({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}},AI={kernelName:"Greater",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Ik,dtype:"bool"})},II={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Mk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MI={kernelName:"IFFT",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{input:i}=e;return aI(i,!0,n)}},DI={kernelName:"IsFinite",backendName:"webgl",kernelFunc:TS({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},TI={kernelName:"IsInf",backendName:"webgl",kernelFunc:TS({opSnippet:"return float(isinf(x));",dtype:"bool"})},EI={kernelName:"IsNan",backendName:"webgl",kernelFunc:TS({opSnippet:"return float(isnan(x));",dtype:"bool"})},NI={kernelName:"Less",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Dk,dtype:"bool"})},OI={kernelName:"LessEqual",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:Tk,dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI={kernelName:"LinSpace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:i,stop:r,num:o}=n,a=Ek(i,r,o);return e.makeTensorInfo([a.length],"float32",a)}},RI={kernelName:"Log",backendName:"webgl",kernelFunc:TS({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Nk})},LI={kernelName:"Log1p",backendName:"webgl",kernelFunc:TS({opSnippet:"return log(1.0 + x);"})},$I={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},PI={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:TS({opSnippet:"return float(!(x >= 1.0));"})},zI={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:ES({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class BI{constructor(t,e,n,i,r){this.variableNames=["x"],this.outputShape=[];const o=e,a=t[3]-1;let s;this.outputShape=t;const l=`float(${n}) + float(${i}) * sum`;s=.5===r?`inversesqrt(${l})`:1===r?`1.0/(${l})`:`exp(log(${l}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${o}; j <= ${o}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${a}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${s};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VI{constructor(t,e,n,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,a=t[3]-1;let s;this.outputShape=t;const l=`float(${n}) + float(${i}) * sum`;s=.5===r?`inversesqrt(${l})`:1===r?`1.0/(${l})`:`exp(log(${l}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${o};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${o}; j <= ${o}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${s};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WI={kernelName:"LRN",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{depthRadius:o,bias:a,alpha:s,beta:l}=i,u=H().getBool("WEBGL_PACK_NORMALIZATION")?new VI(r.shape,o,a,s,l):new BI(r.shape,o,a,s,l);return n.runWebGLProgram(u,[r],r.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class jI{constructor(t,e,n,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=i,this.beta=r,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${i}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${i})\n                * float(${r})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${r});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UI={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r,y:o,dy:a}=e,{depthRadius:s,bias:l,alpha:u,beta:c}=i,h=new jI(r.shape,s,l,u,c);return n.runWebGLProgram(h,[r,o,a],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GI(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reductionIndices:o,keepDims:a}=i,s=r.shape.length,l=v(o,r.shape);let u=l;const c=Qo(u,s),d=null!=c,p=n.shouldExecuteOnCPU([r]);let f=r;if(d){if(p){const t=n.texData.get(f.dataId).values,e=new Array(s);for(let t=0;t<e.length;t++)e[t]=r.shape[c[t]];const i=tS(t,r.shape,r.dtype,c,e);f=n.makeTensorInfo(e,r.dtype);n.texData.get(f.dataId).values=i}else f=qS(r,c,n);u=ea(u.length,s)}Jo("max",u,s);const[g,m]=Ko(f.shape,u);let y,x=g;if(a&&(x=Zo(g,l)),p){const t=n.texData.get(f.dataId).values,e=Ok(t,h(m),x,r.dtype);y=n.makeTensorInfo(x,r.dtype);n.texData.get(y.dataId).values=e}else y=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,i){const r=h(e),o=BS({inputs:{x:t},attrs:{shape:[h(t.shape)/r,r]},backend:i}),a=US(o,t.dtype,"max",i),s=BS({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(a),s}(f,m,x,n);return d&&n.disposeIntermediateTensorInfo(f),y}const HI={kernelName:"Max",backendName:"webgl",kernelFunc:GI},qI={kernelName:"Maximum",backendName:"webgl",kernelFunc:ES({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Fk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XI={kernelName:"MaxPool",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;N_(r,"maxPool");const{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=i;s(_r(a,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const c=dr(r.shape,o,a,1,l,u);if(1===c.filterWidth&&1===c.filterHeight&&d(c.inShape,c.outShape))return bS({inputs:{x:r},backend:n});const h=new _C(c,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YI={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:o,strides:a,pad:s,dataFormat:l,dimRoundingMode:u}=i,c=pr(r.shape,o,a,[1,1,1],s,u,l),h=new kC(c,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KI{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,i=t.dilationHeight,r=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=r-1-t.padInfo.top,s=o-1-t.padInfo.left,l=r*o-1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${r};\n          wR += ${i}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${o} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class ZI{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,i=t.strideWidth,r=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterDepth,l=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.front,h=l-1-t.padInfo.top,d=u-1-t.padInfo.left,p=s*l*u-1;this.userCode=`\n      const ivec3 pads = ivec3(${c}, ${h}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${s};\n           wD += ${r}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${o}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${u};\n                wC += ${a}) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${u} +\n                  wR * ${u} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JI={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o}=e,a=o,{filterSize:s,strides:l,pad:u,dimRoundingMode:c}=i,h=pr(a.shape,s,l,[1,1,1],u,c),d=new kC(h,"max",!0),p=n.runWebGLProgram(d,[a],a.dtype),f=new ZI(h),g=n.runWebGLProgram(f,[r,p],a.dtype);return n.disposeIntermediateTensorInfo(p),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QI={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:o,output:a}=e,s=o;N_([o,a],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=i,d=dr(s.shape,l,u,1,c,h),p=new _C(d,"max",!0),f=n.runWebGLProgram(p,[s],s.dtype),g=new KI(d),m=n.runWebGLProgram(g,[r,f],s.dtype);return n.disposeIntermediateTensorInfo(f),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const tM={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:r,strides:o,pad:a,includeBatchInIndex:l}=e,u=n;s(4===i.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`));const c=[1,1];s(_r(o,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const h=dr(i.shape,r,o,c,a),[d,p]=function(t,e,n,i){let r=new _C(n,"max",!1);const o=i.runWebGLProgram(r,[t],"float32");return r=new _C(n,"max",!0,!0,e),[o,i.runWebGLProgram(r,[t],"float32")]}(i,l,h,u);return[d,p]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const eM={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{keepDims:r,axis:o}=e,a=n,s=i.shape.length,l=v(o,i.shape);let u=l;const c=Qo(u,s),d=null!=c,p=a.shouldExecuteOnCPU([i]),f=[];let g=i;if(d){if(p){const t=a.texData.get(g.dataId).values,e=new Array(s);for(let t=0;t<e.length;t++)e[t]=i.shape[c[t]];const n=tS(t,i.shape,i.dtype,c,e);g=a.makeTensorInfo(e,i.dtype);a.texData.get(g.dataId).values=n}else g=qS(i,c,a);f.push(g),u=ea(u.length,s)}Jo("sum",u,s);const[m,y]=Ko(g.shape,u);let x=m;r&&(x=Zo(m,l));const b=function(t,e,n,i){const r=h(e),o=BS({inputs:{x:t},attrs:{shape:[h(t.shape)/r,r]},backend:i}),a=US(o,"float32","mean",i),s=BS({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(a),s}(g,y,x,a);for(const t of f)a.disposeIntermediateTensorInfo(t);return b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM={kernelName:"Min",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i,s=r.shape.length,l=v(o,r.shape);let u=l;const c=Qo(u,s);let d=r;null!=c&&(d=KS({inputs:{x:r},backend:n,attrs:{perm:c}}),u=ea(u.length,r.shape.length)),Jo("min",u,s);const[p,f]=Ko(d.shape,u),g=BS({inputs:{x:d},backend:n,attrs:{shape:[-1,h(f)]}}),m=US(g,g.dtype,"min",n);let y;if(a){y=BS({inputs:{x:m},backend:n,attrs:{shape:Zo(p,l)}})}else y=BS({inputs:{x:m},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),y}},iM={kernelName:"Minimum",backendName:"webgl",kernelFunc:ES({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Rk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class rM{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const i=t.length,r=dk(i),o=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l="reflect"===n?0:1;this.userCode=1!==i?`\n      ${r} start = ${r}(${o});\n      ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        for (int i = 0; i < ${i}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${r} coords = outC - start;\n        setOutput(getX(${s}));\n      }\n    `:`\n        int start = ${o};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oM{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const i=t.length,r=dk(i),o=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),s=iS("rc",i),l=iS("source",i),u=`${s[i-1]} < ${this.outputShape[i-1]}`,c=1===i?"source":`vec2(${l.slice(-2).join()})`,h="reflect"===n?0:1;let d="";if(1===i){const t=`\n        ${r} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;d=`\n        ${r} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[i-1]} += 1;\n        if(${u}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n      `}else{const t=`\n        ${r} source = rc;\n        ${r} lt = ${r}(lessThan(source, start));\n        ${r} gte = ${r}(greaterThanEqual(source, end));\n        ${r} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;d=`\n        ${r} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[i-1]} += 1;\n        if(${u}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${s[i-2]} += 1;\n        if(${s[i-2]} < ${this.outputShape[i-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${l.join()}), ${c});\n          ${s[i-1]} += 1;\n          if(${u}) {\n            ${t}\n            result[3] = getChannel(getX(${l.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${r} start = ${r}(${o});\n      const ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aM={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i}=t,{paddings:r,mode:o}=n,a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oM(i.shape,r,o):new rM(i.shape,r,o);return e.runWebGLProgram(a,[i],i.dtype)}},sM=ES({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),lM={kernelName:tt,backendName:"webgl",kernelFunc:sM};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class uM{constructor(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.seedLoc&&(this.seedLoc=e.getUniformLocation(n,"seed")),e.gl.uniform1f(this.seedLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cM=ES({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),hM={kernelName:"RealDiv",backendName:"webgl",kernelFunc:cM},dM="return a - b;",pM=ES({opSnippet:dM,packedOpSnippet:dM,supportsComplex:!0,cpuKernelImpl:Zk}),fM={kernelName:nt,backendName:"webgl",kernelFunc:pM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gM(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{dim:o}=i,a=v([o],r.shape),s=GI({inputs:{x:r},backend:n,attrs:{reductionIndices:a,keepDims:!1}}),l=Zo(s.shape,a),u=BS({inputs:{x:s},backend:n,attrs:{shape:l}}),c=pM({inputs:{a:r,b:u},backend:n}),h=QA({inputs:{x:c},backend:n}),d=XS({inputs:{x:h},backend:n,attrs:{axis:a,keepDims:!1}}),p=BS({inputs:{x:d},backend:n,attrs:{shape:l}}),f=cM({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const mM={kernelName:"Softmax",backendName:"webgl",kernelFunc:gM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yM={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{numSamples:o,seed:a,normalized:s}=i,l=s?r:gM({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new uM(u,c,o),d=h.getCustomSetupFunc(a),p=n.runWebGLProgram(h,[l],"int32",d);return s||n.disposeIntermediateTensorInfo(l),p}},vM="return -x;";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xM={kernelName:"Neg",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])){const t=n.texData.get(i.dataId),[e,r]=$k(t.values,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,e)}let r;return r=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new dS(i.shape,vM):new cS(i.shape,vM),n.runWebGLProgram(r,[i],i.dtype)}},bM=Cl;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wM={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(t){Pu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l}=i,u=n.readSync(r.dataId),c=n.readSync(o.dataId),{selectedIndices:h}=bM(u,c,a,s,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},_M=Al;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kM={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(t){Pu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:u}=i,c=n.readSync(r.dataId),h=n.readSync(o.dataId),{selectedIndices:d,validOutputs:p}=_M(c,h,a,s,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},SM=Il;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CM={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){Pu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:s,scoreThreshold:l,softNmsSigma:u}=i,c=n.readSync(r.dataId),h=n.readSync(o.dataId),d=a,p=s,f=l,g=u,{selectedIndices:m,selectedScores:y}=SM(c,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AM{constructor(t,e,n,i){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${i}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM={kernelName:"OneHot",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{indices:r}=e,{depth:o,onValue:a,offValue:s}=i,l=h(r.shape),u=new AM(l,o,a,s),c=BS({inputs:{x:r},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(u,[c],r.dtype);n.disposeIntermediateTensorInfo(c);const p=BS({inputs:{x:d},backend:n,attrs:{shape:[...r.shape,o]}});return n.disposeIntermediateTensorInfo(d),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MM(t){const{inputs:e,backend:n}=t,{x:i}=e;if("complex64"===i.dtype){const t=jC({inputs:{input:i},backend:n}),e=MM({inputs:{x:t},backend:n}),r=iA({inputs:{input:i},backend:n}),o=MM({inputs:{x:r},backend:n}),a=_S({inputs:{real:e,imag:o},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),a}return uI({attrs:{shape:i.shape,dtype:i.dtype,value:"string"===i.dtype?"":0},backend:n})}const DM={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:MM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TM={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:i}=e,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===r.dtype){const e=jC({inputs:{input:r},backend:i}),n=t({inputs:{x:e},backend:i}),o=iA({inputs:{input:r},backend:i}),a=MM({inputs:{x:o},backend:i}),s=_S({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(e),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(a),s}return uI({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:i})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EM={kernelName:"Pack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i;if(1===e.length)return eI({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,a=e[0].dtype;e.forEach((t=>{l(o,t.shape,"All tensors passed to stack must have matching shapes"),s(a===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const u=[],c=aA({inputs:e.map((t=>{const e=eI({inputs:{input:t},backend:n,attrs:{dim:r}});return u.push(e),e})),backend:n,attrs:{axis:r}});return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NM{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const i=t.length,r=dk(i),o=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?`\n      ${r} start = ${r}(${o});\n      ${r} end = ${r}(${a});\n      uniform float value;\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${r} coords = outC - start;\n          setOutput(getX(${s}));\n        }\n      }\n    `:`\n        int start = ${o};\n        int end = ${a};\n        uniform float value;\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}getCustomSetupFunc(t){return(e,n)=>{null==this.valueLoc&&(this.valueLoc=e.getUniformLocationNoThrow(n,"value")),e.gl.uniform1f(this.valueLoc,t)}}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OM{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const i=t.length,r=dk(i),o=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),s=iS("rc",i),l=iS("source",i),u=`${s[i-1]} < ${this.outputShape[i-1]}`,c=1===i?"source":`vec2(${l.slice(-2).join()})`,h=[`${r} rc = outputLoc;`,`${s[i-1]} += 1;\n       if(${u}) {\n      `,1===i?"":`}\n       rc = outputLoc;\n       ${s[i-2]} += 1;\n       if(${s[i-2]} < ${this.outputShape[i-2]}) {`,1===i?"":`  ${s[i-1]} += 1;\n         if(${u}) {`],d=1===i?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===i?2:4;t<e;t++)p+=`\n        ${h[t]}\n        if (${d}) {\n          result[${t}] = float(value);\n        } else {\n          ${r} source = rc - start;\n          result[${t}] = getChannel(getX(${l.join()}), ${c});\n        }\n      `;p+=1===i?"} ":"}}",this.userCode=`\n      const ${r} start = ${r}(${o});\n      const ${r} end = ${r}(${a});\n      uniform float value;\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.valueLoc&&(this.valueLoc=e.getUniformLocationNoThrow(n,"value")),e.gl.uniform1f(this.valueLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FM=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{paddings:o,constantValue:a}=i,s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OM(r.shape,o,a):new NM(r.shape,o,a),l=s.getCustomSetupFunc(a);return n.runWebGLProgram(s,[r],r.dtype,l)},RM={kernelName:"PadV2",backendName:"webgl",kernelFunc:FM},LM={kernelName:"Pow",backendName:"webgl",kernelFunc:ES({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};const $M={kernelName:"Prod",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:o,keepDims:a}=i,s=r.shape.length,l=[],u=v(o,r.shape);let c=u;const d=Qo(c,s);let p,f=r;if(null!=d&&(f=KS({inputs:{x:r},backend:n,attrs:{perm:d}}),c=ea(c.length,s),l.push(f)),Jo("prod",c,s),n.shouldExecuteOnCPU([f])){const t=n.texData.get(f.dataId).values,{outVals:e,outShape:i,outDtype:r}=zk(f.shape,f.dtype,t,c);p=n.makeTensorInfo(i,r,e)}else{const[t,e]=Ko(f.shape,c),i=h(e),o=BS({inputs:{x:f},backend:n,attrs:{shape:[-1,i]}}),a=US(o,De(r.dtype),"prod",n);p=BS({inputs:{x:a},backend:n,attrs:{shape:t}}),l.push(o),l.push(a)}if(a){l.push(p);const t=Zo(p.shape,u);p=BS({inputs:{x:p},backend:n,attrs:{shape:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}},PM=t=>{const{backend:e,attrs:n}=t,{start:i,stop:r,step:o,dtype:a}=n,s=Bk(i,r,o,a);return e.makeTensorInfo([s.length],a,s)},zM={kernelName:"Range",backendName:"webgl",kernelFunc:PM},BM={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:TS({opSnippet:"return 1.0 / x;"})},VM={kernelName:"Relu",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},WM={kernelName:"Relu6",backendName:"webgl",kernelFunc:TS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class jM{constructor(t,e,n,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,s,l]=t;this.outputShape=[o,e,n,l];const u=[i&&e>1?a-1:a,i&&n>1?s-1:s],c=[i&&e>1?e-1:e,i&&n>1?n-1:n];let h;h=r?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${s}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UM{constructor(t,e,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,s,l]=t;this.outputShape=[o,e,n,l];const u=[i&&e>1?a-1:a,i&&n>1?s-1:s],c=[i&&e>1?e-1:e,i&&n>1?n-1:n];let h;h=r?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]},\n          ${u[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${s}.0,\n                                     ${s}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GM={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:s}=i,[l,u]=s,c=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new UM(r.shape,l,u,o,a):new jM(r.shape,l,u,o,a);return n.runWebGLProgram(c,[r],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HM{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,i,r]=e,[,o,a]=t,s=[n&&o>1?i-1:i,n&&a>1?r-1:r],l=[n&&o>1?o-1:o,n&&a>1?a-1:a],u=s[0]/l[0],c=s[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qM={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:o}=e,{alignCorners:a}=i,s=new HM(o.shape,r.shape,a);return n.runWebGLProgram(s,[o],o.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XM{constructor(t,e,n,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,s,l]=t;this.outputShape=[o,e,n,l];const u=[i&&e>1?a-1:a,i&&n>1?s-1:s],c=[i&&e>1?e-1:e,i&&n>1?n-1:n],h=i?"0.5":"0.0";let d;d=r?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${s}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YM{constructor(t,e,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,s,l]=t;this.outputShape=[o,e,n,l];const u=[i&&e>1?a-1:a,i&&n>1?s-1:s],c=[i&&e>1?e-1:e,i&&n>1?n-1:n],h=i?"0.5":"0.0";let d;d=r?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]},\n          ${u[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${s}.0,\n                                     ${s}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KM={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:s}=i,[l,u]=s,c=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new YM(r.shape,l,u,o,a):new XM(r.shape,l,u,o,a);return n.runWebGLProgram(c,[r],r.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZM{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,i,r]=e,[,o,a]=t,s=[n&&o>1?i-1:i,n&&a>1?r-1:r],l=[n&&o>1?o-1:o,n&&a>1?a-1:a],u=s[0]/l[0],c=s[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${s[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${s[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JM={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:o}=e,{alignCorners:a}=i,s=new ZM(o.shape,r.shape,a);return n.runWebGLProgram(s,[o],o.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QM{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const i=t.map(((n,i)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(i))).join(","),r=dk(n);this.userCode=`\n      void main() {\n        ${r} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tD{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const i=iS("rc",n),r=`${i[n-1]} + 1 < ${this.outputShape[n-1]}`,o=`${i[n-2]} + 1 < ${this.outputShape[n-2]}`,a=dk(n);var s;function l(n){const i=t.map(((i,r)=>function(n,i){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${i[n]} - 1`:`${i[n]}`}(r,n)));return`getChannel(getX(${i.join(",")}), vec2(${i.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${r}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${a} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${s=i.slice(),l(s)};\n          if(${r}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",l(t)}(i.slice())};\n          }\n          if(${o}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",l(t)}(i.slice())};\n            if(${r}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",l(t)}(i.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dims:o}=i,a=r.shape.length,s=v(o,r.shape);if(0===a)return bS({inputs:{x:r},backend:n});const l=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tD(r.shape,s):new QM(r.shape,s);return n.runWebGLProgram(l,[r],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nD{constructor(t,e){this.variableNames=["Image"],this.outputShape=[];const n=t[1],i=t[2];this.outputShape=t;let r="";r="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        uniform vec4 params;\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${r}\n          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}getCustomSetupFunc(t,e,n,i){return(r,o)=>{null==this.paramsLoc&&(this.paramsLoc=r.getUniformLocationNoThrow(o,"params")),r.gl.uniform4f(this.paramsLoc,t,e,n,i)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:r,fillValue:o,center:a}=e,s=n,l=new nD(i.shape,o),[u,c]=Eu(a,i.shape[1],i.shape[2]),h=l.getCustomSetupFunc(u,c,Math.sin(r),Math.cos(r));return s.runWebGLProgram(l,[i],i.dtype,h)}},rD={kernelName:"Round",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},oD={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:TS({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Vk})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class aD{constructor(t,e,n,i,r,o,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const s=dk(r.length),l=dk(o.length);let u="";1===n?u="i":2===n&&(u="i, j");const c=`getIndices(${u})`;let h="";1===i?h="i":2===i&&(h="i, coords[1]");const d=`getUpdates(${h})`,p=e>1?"strides[j]":"strides";this.userCode=`\n        ${s} strides = ${s}(${r});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${c});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${d};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{indices:r,updates:o}=e,{shape:a}=i,{sliceRank:s,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=fi(0,r,a),d=[h/u,u];if(0===h)return n.makeTensorInfo(a,r.dtype);const p=BS({inputs:{x:r},backend:n,attrs:{shape:[l,s]}}),f=BS({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),m=new aD(l,s,p.shape.length,f.shape.length,c,d),y=n.runWebGLProgram(m,[f,p,g],f.dtype),v=BS({inputs:{x:y},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),v}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lD{constructor(t,e,n){let i,r;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)r="resRC",i="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=[];for(let i=0;i<e.length;i++)a.push(`${n[i]}`),i<t&&o.push(`${n[i]}`);i=o.join(),r=a.join()}const o=dk(n);this.userCode=`\n      void main() {\n        ${o} resRC = getOutputCoords();\n        float cVal = getC(${i});\n        if (cVal >= 1.0) {\n          setOutput(getA(${r}));\n        } else {\n          setOutput(getB(${r}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uD={kernelName:"Select",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:i,t:r,e:o}=e,a=new lD(i.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(a,[i,r,o],Me(r.dtype,o.dtype))}},cD={kernelName:"Selu",backendName:"webgl",kernelFunc:TS({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ${$u};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`})},hD={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:TS({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"})},dD={kernelName:"Sign",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},pD=TS({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),fD={kernelName:et,backendName:"webgl",kernelFunc:pD},gD={kernelName:"Sinh",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},mD={kernelName:"Softplus",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},yD={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:o,paddings:a}=i;s(r.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const l=o.reduce(((t,e)=>t*e)),u=[[0,0]];u.push(...a);for(let t=1+o.length;t<r.shape.length;++t)u.push([0,0]);const c=[],h=FM({inputs:{x:r},backend:n,attrs:{paddings:u,constantValue:0}}),d=Nu(h.shape,o,l,!1),p=Ou(d.length,o.length,!1),f=Fu(h.shape,o,l,!1),g=BS({inputs:{x:h},backend:n,attrs:{shape:d}}),m=KS({inputs:{x:g},backend:n,attrs:{perm:p}}),y=BS({inputs:{x:m},backend:n,attrs:{shape:f}});return c.push(h),c.push(g),c.push(m),c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD={kernelName:"SparseFillEmptyRows",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{indices:i,values:r,denseShape:o,defaultValue:a}=e;if(1!==o.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${o.shape}`);if(2!==i.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${i.shape}`);if(1!==r.shape.length)throw new Error(`Values must be a vector, saw:\n         ${r.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const s=n.readSync(i.dataId),l=n.readSync(r.dataId),u=n.readSync(o.dataId),c=n.readSync(a.dataId)[0],[h,d,p,f,g]=Uk(s,i.shape,i.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([g.length],i.dtype,new Int32Array(g))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xD={kernelName:"SparseReshape",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:r,newShape:o}=e;if(2!==i.shape.length)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(1!==r.shape.length)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(1!==o.shape.length)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const a=Array.from(n.readSync(r.dataId)),s=n.readSync(i.dataId),l=Array.from(n.readSync(o.dataId)),[u,c,h]=Gk(s,i.shape,i.dtype,a,l);return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bD={kernelName:"SparseSegmentMean",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${r.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${o.shape}`);const a=n.readSync(i.dataId),s=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=Hk(a,i.shape,i.dtype,s,l,!0);return n.makeTensorInfo(c,i.dtype,u)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD={kernelName:"SparseSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${r.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${o.shape}`);const a=n.readSync(i.dataId),s=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=Hk(a,i.shape,i.dtype,s,l);return n.makeTensorInfo(c,i.dtype,u)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _D={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:r,sparseValues:o,defaultValue:a}=e,{outputShape:s}=i,{sliceRank:l,numUpdates:u,strides:c,outputSize:h}=fi(0,r,s),d=new aD(u,l,r.shape.length,o.shape.length,c,[h,1],!1),p=n.runWebGLProgram(d,[o,r,a],o.dtype),f=BS({inputs:{x:p},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(p),f}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD={kernelName:"SplitV",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{numOrSizeSplits:o,axis:a}=i,s=v(a,r.shape)[0],l=tc(r,o,s),u=r.shape.length,c=new Array(u).fill(0),h=r.shape.slice();return l.map((t=>{const e=[...h];e[s]=t;const i=$C({inputs:{x:r},backend:n,attrs:{begin:c,size:e}});return c[s]+=t,i}))}},SD={kernelName:"Sqrt",backendName:"webgl",kernelFunc:TS({opSnippet:"return sqrt(x);"})},CD={kernelName:"Square",backendName:"webgl",kernelFunc:TS({opSnippet:"return x * x;"})},AD={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:ES({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID={kernelName:"Step",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({inputs:t,attrs:e,backend:n}){const{x:i}=t,r=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,o=new cS(i.shape,r);return n.runWebGLProgram(o,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MD{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const i=n.length,r=dk(n.length),o=dk(n.length);let a="";if(1===i)a="coords * strides + begin";else{let t=0;a=n.map(((e,i)=>(t++,1===n.length?`coords * strides[${i}] + begin[${i}]`:`coords[${t-1}] * strides[${i}] + begin[${i}]`))).join(",")}this.userCode=`\n      ${r} begin = ${r}(${t});\n      ${r} strides = ${r}(${e});\n\n      void main() {\n        ${o} coords = getOutputCoords();\n        setOutput(getX(${a}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:o,end:a,strides:s,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=i,{nonStrided:p,$begin:f,$strides:g,size:m,newShape:y,outShape:v}=Ei(r.shape,o,a,s,l,u,c,h,d),x=BS({inputs:{x:r},backend:n,attrs:{shape:y}});let b;if(p){const t=$C({inputs:{x:x},backend:n,attrs:{begin:f,size:m}});b=BS({inputs:{x:t},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(t)}else if(v.some((t=>0===t)))b=n.makeTensorInfo(v,r.dtype,[]);else{if(n.shouldExecuteOnCPU([x])){const t=n.texData.get(x.dataId).values,e=Ln(x.shape,x.dtype,t),i=qk(v,e,g,f);b=n.makeTensorInfo(v,x.dtype,i.values)}else{const t=new MD(f,g,v);b=n.runWebGLProgram(t,[x],x.dtype)}}const w=BS({inputs:{x:b},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),w}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD={kernelName:"StringNGrams",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{separator:r,nGramWidths:o,leftPad:a,rightPad:s,padWidth:l,preserveShortSequences:u}=i,{data:c,dataSplits:h}=e,d=n.readSync(c.dataId),p=n.readSync(h.dataId),[f,g]=Xk(d,p,r,o,a,s,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ED={kernelName:"StringSplit",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:r}=i,{input:o,delimiter:a}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(1!==o.shape.length)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const s=n.readSync(o.dataId),l=n.readSync(a.dataId)[0],[u,c,h]=Yk(s,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND={kernelName:"StringToHashBucketFast",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:r}=i,{input:o}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=n.readSync(o.dataId),s=Kk(a,r);return n.makeTensorInfo(o.shape,"int32",s)}},OD=TS({opSnippet:"return tan(x);"}),FD={kernelName:it,backendName:"webgl",kernelFunc:OD},RD={kernelName:"Tanh",backendName:"webgl",kernelFunc:TS({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LD{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[i]*e[i];this.outputShape=n,this.rank=n.length;const i=dk(this.rank),r=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let e=0;e<t.length;e++)i.push(`imod(${n[e]}, ${t[e]})`);return i.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        setOutput(getA(${r}));\n      }\n    `}}function $D(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reps:o}=i;if("string"===r.dtype||r.shape.length>5){const t=n.readSync(r.dataId),e="string"===r.dtype?t.map((t=>ee(t))):t,i=Ln(r.shape,r.dtype,e),a=Jk(i,o);return n.makeTensorInfo(a.shape,a.dtype,a.values)}const a=new LD(r.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const PD={kernelName:"Tile",backendName:"webgl",kernelFunc:$D};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zD={kernelName:"TopK",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{k:o,sorted:a}=i,s=n.readSync(r.dataId),[l,u]=Qk(s,r.shape,r.dtype,o,a);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BD{constructor(t,e,n,i,r,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a="nearest"===n?1:2;let s;switch(i){case"constant":s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4;break;default:s=1}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${s} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${s} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${s} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${r});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${r});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${a} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD={kernelName:"Transform",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{image:r,transforms:o}=e,{interpolation:a,fillMode:s,fillValue:l,outputShape:u}=i,[c,h,d,p]=r.shape,[f,g]=null!=u?u:[h,d],m=new BD(h,d,a,s,l,[c,f,g,p]);return n.runWebGLProgram(m,[r,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD={kernelName:"Unique",backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:i}=t,{axis:r}=n,{x:o}=e;N_(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=i.readSync(o.dataId),{outputValues:s,outputShape:l,indices:u}=eS(a,r,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,s),i.makeTensorInfo([u.length],"int32",u)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{value:r}=e;let{axis:o}=i;o<0&&(o+=r.shape.length);const a=r,s=a.shape.length,l=r.shape[o],u=new Array(s-1);let c=0;for(let t=0;t<s;t++)t!==o&&(u[c++]=a.shape[t]);const h=[],d=new Array(s).fill(0),p=a.shape.slice();p[o]=1;const f=new Array(l);for(let t=0;t<f.length;t++){d[o]=t;const e=$C({inputs:{x:a},backend:n,attrs:{begin:d,size:p}}),i=BS({inputs:{x:e},backend:n,attrs:{shape:u}});f[t]=i,h.push(e)}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UD{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,i=t.batchSize,r=t.inSize,o=t.numSegments,a=o*Math.ceil(r/n);this.outputShape=[i,a];const s=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let c="";r%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `);let h="";r%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${o})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${o})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=[WI,UI,QS,eC,nC,iC,rC,sC,lC,uC,gC,mC,yC,vC,bC,xC,wC,CC,SC,MC,DC,TC,OC,zC,BC,GC,qC,KC,QC,kS,sA,vA,xA,pA,wA,_A,bA,SA,CA,IA,EA,NA,FA,BA,VA,$A,jA,GA,HA,qA,XA,YA,ZA,tI,nI,rI,sI,cI,dI,fI,gI,vI,bI,wI,kI,CI,AI,II,wS,MI,rA,DI,TI,EI,AS,NI,OI,FI,LI,RI,$I,PI,zI,HI,YI,XI,JI,QI,tM,qI,eM,nM,iM,aM,lM,yM,zS,xM,wM,kM,CM,WC,IM,TM,EM,RM,LM,DS,$M,zM,UC,hM,BM,WM,VM,VS,GM,qM,KM,JM,eD,iD,rD,oD,sD,uD,cD,hD,dD,fD,gD,PC,mM,mD,yD,vD,xD,bD,wD,_D,kD,SD,CD,AD,ID,DD,TD,ED,ND,fM,YS,FD,RD,PD,zD,VD,ZS,WD,jD,{kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,segmentIds:o}=e,{numSegments:a}=i,s=r.shape.length,l=[];let u=0;const c=Qo([u],s);let d=r;null!=c&&(d=KS({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(d),u=ea(1,s)[0]);const p=nc(d.shape,u,a),f=h([d.shape[u]]),g=BS({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(g);const m=De(r.dtype),y=(t,e,i,r,o)=>{const a=t.shape[0],s=t.shape[1],u=ec(s,o),c=new UD({windowSize:u,inSize:s,batchSize:a,numSegments:o},e),h=n.compileAndRun(c,[t,i],r);if(l.push(h),h.shape[1]===o)return h;const d=PM({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=$D({inputs:{x:d},backend:n,attrs:{reps:[s/u]}});l.push(d),l.push(p);return y(h,e,p,r,o)},v=BS({inputs:{x:y(g,"unsortedSegmentSum",o,m,a)},backend:n,attrs:{shape:p}});let x=v;if(null!=c){l.push(v);const t=ta(c);x=KS({inputs:{x:x},backend:n,attrs:{perm:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),x}},DM];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of GD)ut(t);
/** @license See the LICENSE file. */
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var HD,qD=(HD=function(t,e){return(HD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}HD(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),XD=Object.prototype.hasOwnProperty;function YD(t,e){return XD.call(t,e)}function KD(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);e=[];for(var i in t)YD(t,i)&&e.push(i);return e}function ZD(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function JD(t){for(var e,n=0,i=t.length;n<i;){if(!((e=t.charCodeAt(n))>=48&&e<=57))return!1;n++}return!0}function QD(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function tT(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function eT(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(eT(t[e]))return!0}else if("object"==typeof t){var i=KD(t),r=i.length;for(e=0;e<r;e++)if(eT(t[i[e]]))return!0}return!1}function nT(t,e){var n=[t];for(var i in e){var r="object"==typeof e[i]?JSON.stringify(e[i],null,2):e[i];void 0!==r&&n.push(i+": "+r)}return n.join("\n")}var iT=function(t){function e(e,n,i,r,o){var a=this.constructor,s=t.call(this,nT(e,{name:n,index:i,operation:r,tree:o}))||this;return s.name=n,s.index=i,s.operation=r,s.tree=o,Object.setPrototypeOf(s,a.prototype),s.message=nT(e,{name:n,index:i,operation:r,tree:o}),s}return qD(e,t),e}(Error),rT=iT,oT=ZD,aT={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var i=t[e];return delete t[e],{newDocument:n,removed:i}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:function(t,e,n){var i=lT(n,this.path);i&&(i=ZD(i));var r=uT(n,{op:"remove",path:this.from}).removed;return uT(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(t,e,n){var i=lT(n,this.from);return uT(n,{op:"add",path:this.path,value:ZD(i)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:pT(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},sT={add:function(t,e,n){return JD(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){return{newDocument:n,removed:t.splice(e,1)[0]}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:aT.move,copy:aT.copy,test:aT.test,_get:aT._get};function lT(t,e){if(""==e)return t;var n={op:"_get",path:e};return uT(t,n),n.value}function uT(t,e,n,i,r,o){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===o&&(o=0),n&&("function"==typeof n?n(e,0,t,e.path):hT(e,0)),""===e.path){var a={newDocument:t};if("add"===e.op)return a.newDocument=e.value,a;if("replace"===e.op)return a.newDocument=e.value,a.removed=t,a;if("move"===e.op||"copy"===e.op)return a.newDocument=lT(t,e.from),"move"===e.op&&(a.removed=t),a;if("test"===e.op){if(a.test=pT(t,e.value),!1===a.test)throw new rT("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a.newDocument=t,a}if("remove"===e.op)return a.removed=t,a.newDocument=null,a;if("_get"===e.op)return e.value=t,a;if(n)throw new rT("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return a}i||(t=ZD(t));var s=(e.path||"").split("/"),l=t,u=1,c=s.length,h=void 0,d=void 0,p=void 0;for(p="function"==typeof n?n:hT;;){if(d=s[u],r&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===h&&(void 0===l[d]?h=s.slice(0,u).join("/"):u==c-1&&(h=e.path),void 0!==h&&p(e,0,t,h)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(n&&!JD(d))throw new rT("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);JD(d)&&(d=~~d)}if(u>=c){if(n&&"add"===e.op&&d>l.length)throw new rT("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);if(!1===(a=sT[e.op].call(e,l,d,t)).test)throw new rT("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}}else if(d&&-1!=d.indexOf("~")&&(d=tT(d)),u>=c){if(!1===(a=aT[e.op].call(e,l,d,t)).test)throw new rT("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}l=l[d]}}function cT(t,e,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n&&!Array.isArray(e))throw new rT("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(t=ZD(t));for(var o=new Array(e.length),a=0,s=e.length;a<s;a++)o[a]=uT(t,e[a],n,!0,r,a),t=o[a].newDocument;return o.newDocument=t,o}function hT(t,e,n,i){if("object"!=typeof t||null===t||Array.isArray(t))throw new rT("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(!aT[t.op])throw new rT("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n);if("string"!=typeof t.path)throw new rT("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new rT('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new rT("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new rT("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&eT(t.value))throw new rT("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n)if("add"==t.op){var r=t.path.split("/").length,o=i.split("/").length;if(r!==o+1&&r!==o)throw new rT("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==i)throw new rT("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if("move"===t.op||"copy"===t.op){var a=dT([{op:"_get",path:t.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new rT("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}function dT(t,e,n){try{if(!Array.isArray(t))throw new rT("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)cT(ZD(e),ZD(t),n||!0);else{n=n||hT;for(var i=0;i<t.length;i++)n(t[i],i,e,void 0)}}catch(t){if(t instanceof rT)return t;throw t}}function pT(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n,i,r,o=Array.isArray(t),a=Array.isArray(e);if(o&&a){if((i=t.length)!=e.length)return!1;for(n=i;0!=n--;)if(!pT(t[n],e[n]))return!1;return!0}if(o!=a)return!1;var s=Object.keys(t);if((i=s.length)!==Object.keys(e).length)return!1;for(n=i;0!=n--;)if(!e.hasOwnProperty(s[n]))return!1;for(n=i;0!=n--;)if(!pT(t[r=s[n]],e[r]))return!1;return!0}return t!=t&&e!=e}var fT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",JsonPatchError:rT,deepClone:oT,getValueByPointer:lT,applyOperation:uT,applyPatch:cT,applyReducer:function(t,e,n){var i=uT(t,e);if(!1===i.test)throw new rT("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return i.newDocument},validator:hT,validate:dT,_areEquals:pT}),gT=new WeakMap,mT=function(t){this.observers=new Map,this.obj=t},yT=function(t,e){this.callback=t,this.observer=e};
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */function vT(t,e){void 0===e&&(e=!1);var n=gT.get(t.object);xT(n.value,t.object,t.patches,"",e),t.patches.length&&cT(n.value,t.patches);var i=t.patches;return i.length>0&&(t.patches=[],t.callback&&t.callback(i)),i}function xT(t,e,n,i,r){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var o=KD(e),a=KD(t),s=!1,l=a.length-1;l>=0;l--){var u=t[h=a[l]];if(!YD(e,h)||void 0===e[h]&&void 0!==u&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(r&&n.push({op:"test",path:i+"/"+QD(h),value:ZD(u)}),n.push({op:"remove",path:i+"/"+QD(h)}),s=!0):(r&&n.push({op:"test",path:i,value:t}),n.push({op:"replace",path:i,value:e}));else{var c=e[h];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?xT(u,c,n,i+"/"+QD(h),r):u!==c&&(r&&n.push({op:"test",path:i+"/"+QD(h),value:ZD(u)}),n.push({op:"replace",path:i+"/"+QD(h),value:ZD(c)}))}}if(s||o.length!=a.length)for(l=0;l<o.length;l++){var h;YD(t,h=o[l])||void 0===e[h]||n.push({op:"add",path:i+"/"+QD(h),value:ZD(e[h])})}}}var bT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",unobserve:function(t,e){e.unobserve()},observe:function(t,e){var n,i=function(t){return gT.get(t)}(t);if(i){var r=function(t,e){return t.observers.get(e)}(i,e);n=r&&r.observer}else i=new mT(t),gT.set(t,i);if(n)return n;if(n={},i.value=ZD(t),e){n.callback=e,n.next=null;var o=function(){vT(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=[],n.object=t,n.unobserve=function(){vT(n),clearTimeout(n.next),function(t,e){t.observers.delete(e.callback)}(i,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new yT(e,n)),n},generate:vT,compare:function(t,e,n){void 0===n&&(n=!1);var i=[];return xT(t,e,i,"",n),i}});Object.assign({},fT,bT,{JsonPatchError:iT,deepClone:ZD,escapePathComponent:QD,unescapePathComponent:tT});var wT=/("(?:[^\\"]|\\.)*")|[:,]/g,_T=function(t,e){var n,i,r;return e=e||{},n=JSON.stringify([1],void 0,void 0===e.indent?2:e.indent).slice(2,-3),i=""===n?1/0:void 0===e.maxLength?80:e.maxLength,r=e.replacer,function t(e,o,a){var s,l,u,c,h,d,p,f,g,m,y,v;if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0===(y=JSON.stringify(e,r)))return y;if(p=i-o.length-a,y.length<=p&&(g=y.replace(wT,(function(t,e){return e||t+" "}))).length<=p)return g;if(null!=r&&(e=JSON.parse(y),r=void 0),"object"==typeof e&&null!==e){if(f=o+n,u=[],l=0,Array.isArray(e))for(m="[",s="]",p=e.length;l<p;l++)u.push(t(e[l],f,l===p-1?0:1)||"null");else for(m="{",s="}",p=(d=Object.keys(e)).length;l<p;l++)c=d[l],h=JSON.stringify(c)+": ",void 0!==(v=t(e[c],f,h.length+(l===p-1?0:1)))&&u.push(h+v);if(u.length>0)return[m,n+u.join(",\n"+f),s].join("\n"+o)}return y}(t,"",0)};var kT={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var ST="object"==typeof process&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},CT=$a((function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n}=kT,i=(e=t.exports={}).re=[],r=e.src=[],o=e.t={};let a=0;const s=(t,e,n)=>{const s=a++;ST(s,e),o[t]=s,r[s]=e,i[s]=new RegExp(e,n?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${r[o.NUMERICIDENTIFIER]})\\.(${r[o.NUMERICIDENTIFIER]})\\.(${r[o.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${r[o.NUMERICIDENTIFIERLOOSE]})\\.(${r[o.NUMERICIDENTIFIERLOOSE]})\\.(${r[o.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${r[o.NUMERICIDENTIFIER]}|${r[o.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${r[o.NUMERICIDENTIFIERLOOSE]}|${r[o.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${r[o.PRERELEASEIDENTIFIER]}(?:\\.${r[o.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${r[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[o.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${r[o.BUILDIDENTIFIER]}(?:\\.${r[o.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${r[o.MAINVERSION]}${r[o.PRERELEASE]}?${r[o.BUILD]}?`),s("FULL",`^${r[o.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${r[o.MAINVERSIONLOOSE]}${r[o.PRERELEASELOOSE]}?${r[o.BUILD]}?`),s("LOOSE",`^${r[o.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${r[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${r[o.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${r[o.XRANGEIDENTIFIER]})(?:\\.(${r[o.XRANGEIDENTIFIER]})(?:\\.(${r[o.XRANGEIDENTIFIER]})(?:${r[o.PRERELEASE]})?${r[o.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${r[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[o.XRANGEIDENTIFIERLOOSE]})(?:${r[o.PRERELEASELOOSE]})?${r[o.BUILD]}?)?)?`),s("XRANGE",`^${r[o.GTLT]}\\s*${r[o.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${r[o.GTLT]}\\s*${r[o.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",r[o.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${r[o.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",s("TILDE",`^${r[o.LONETILDE]}${r[o.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${r[o.LONETILDE]}${r[o.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${r[o.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",s("CARET",`^${r[o.LONECARET]}${r[o.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${r[o.LONECARET]}${r[o.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${r[o.GTLT]}\\s*(${r[o.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${r[o.GTLT]}\\s*(${r[o.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${r[o.GTLT]}\\s*(${r[o.LOOSEPLAIN]}|${r[o.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${r[o.XRANGEPLAIN]})\\s+-\\s+(${r[o.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${r[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[o.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));const AT=["includePrerelease","loose","rtl"];var IT=t=>t?"object"!=typeof t?{loose:!0}:AT.filter((e=>t[e])).reduce(((t,e)=>(t[e]=!0,t)),{}):{};const MT=/^[0-9]+$/,DT=(t,e)=>{const n=MT.test(t),i=MT.test(e);return n&&i&&(t=+t,e=+e),t===e?0:n&&!i?-1:i&&!n?1:t<e?-1:1};var TT={compareIdentifiers:DT,rcompareIdentifiers:(t,e)=>DT(e,t)};const{MAX_LENGTH:ET,MAX_SAFE_INTEGER:NT}=kT,{re:OT,t:FT}=CT,{compareIdentifiers:RT}=TT;class LT{constructor(t,e){if(e=IT(e),t instanceof LT){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid Version: ${t}`);if(t.length>ET)throw new TypeError(`version is longer than ${ET} characters`);ST("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?OT[FT.LOOSE]:OT[FT.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>NT||this.major<0)throw new TypeError("Invalid major version");if(this.minor>NT||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>NT||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<NT)return e}return t})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(ST("SemVer.compare",this.version,this.options,t),!(t instanceof LT)){if("string"==typeof t&&t===this.version)return 0;t=new LT(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof LT||(t=new LT(t,this.options)),RT(this.major,t.major)||RT(this.minor,t.minor)||RT(this.patch,t.patch)}comparePre(t){if(t instanceof LT||(t=new LT(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],i=t.prerelease[e];if(ST("prerelease compare",e,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return RT(n,i)}while(++e)}compareBuild(t){t instanceof LT||(t=new LT(t,this.options));let e=0;do{const n=this.build[e],i=t.build[e];if(ST("prerelease compare",e,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return RT(n,i)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let t=this.prerelease.length;for(;--t>=0;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}}var $T=LT;const{MAX_LENGTH:PT}=kT,{re:zT,t:BT}=CT;var VT=(t,e)=>{if(e=IT(e),t instanceof $T)return t;if("string"!=typeof t)return null;if(t.length>PT)return null;if(!(e.loose?zT[BT.LOOSE]:zT[BT.FULL]).test(t))return null;try{return new $T(t,e)}catch(t){return null}};var WT=(t,e)=>{const n=VT(t,e);return n?n.version:null};var jT=(t,e)=>{const n=VT(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};var UT=(t,e,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new $T(t,n).inc(e,i).version}catch(t){return null}};var GT=(t,e,n)=>new $T(t,n).compare(new $T(e,n));var HT=(t,e,n)=>0===GT(t,e,n);var qT=(t,e)=>{if(HT(t,e))return null;{const n=VT(t),i=VT(e),r=n.prerelease.length||i.prerelease.length,o=r?"pre":"",a=r?"prerelease":"";for(const t in n)if(("major"===t||"minor"===t||"patch"===t)&&n[t]!==i[t])return o+t;return a}};var XT=(t,e)=>new $T(t,e).major;var YT=(t,e)=>new $T(t,e).minor;var KT=(t,e)=>new $T(t,e).patch;var ZT=(t,e)=>{const n=VT(t,e);return n&&n.prerelease.length?n.prerelease:null};var JT=(t,e,n)=>GT(e,t,n);var QT=(t,e)=>GT(t,e,!0);var tE=(t,e,n)=>{const i=new $T(t,n),r=new $T(e,n);return i.compare(r)||i.compareBuild(r)};var eE=(t,e)=>t.sort(((t,n)=>tE(t,n,e)));var nE=(t,e)=>t.sort(((t,n)=>tE(n,t,e)));var iE=(t,e,n)=>GT(t,e,n)>0;var rE=(t,e,n)=>GT(t,e,n)<0;var oE=(t,e,n)=>0!==GT(t,e,n);var aE=(t,e,n)=>GT(t,e,n)>=0;var sE=(t,e,n)=>GT(t,e,n)<=0;var lE=(t,e,n,i)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return HT(t,n,i);case"!=":return oE(t,n,i);case">":return iE(t,n,i);case">=":return aE(t,n,i);case"<":return rE(t,n,i);case"<=":return sE(t,n,i);default:throw new TypeError(`Invalid operator: ${e}`)}};const{re:uE,t:cE}=CT;var hE=(t,e)=>{if(t instanceof $T)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;let n=null;if((e=e||{}).rtl){let e;for(;(e=uE[cE.COERCERTL].exec(t))&&(!n||n.index+n[0].length!==t.length);)n&&e.index+e[0].length===n.index+n[0].length||(n=e),uE[cE.COERCERTL].lastIndex=e.index+e[1].length+e[2].length;uE[cE.COERCERTL].lastIndex=-1}else n=t.match(uE[cE.COERCE]);return null===n?null:VT(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,e)},dE=pE;function pE(t){var e=this;if(e instanceof pE||(e=new pE),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach((function(t){e.push(t)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}function fE(t,e,n){var i=e===t.head?new yE(n,null,e,t):new yE(n,e,e.next,t);return null===i.next&&(t.tail=i),null===i.prev&&(t.head=i),t.length++,i}function gE(t,e){t.tail=new yE(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function mE(t,e){t.head=new yE(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function yE(t,e,n,i){if(!(this instanceof yE))return new yE(t,e,n,i);this.list=i,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}pE.Node=yE,pE.create=pE,pE.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e},pE.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},pE.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},pE.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)gE(this,arguments[t]);return this.length},pE.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)mE(this,arguments[t]);return this.length},pE.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},pE.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},pE.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,i=0;null!==n;i++)t.call(e,n.value,i,this),n=n.next},pE.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,i=this.length-1;null!==n;i--)t.call(e,n.value,i,this),n=n.prev},pE.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},pE.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},pE.prototype.map=function(t,e){e=e||this;for(var n=new pE,i=this.head;null!==i;)n.push(t.call(e,i.value,this)),i=i.next;return n},pE.prototype.mapReverse=function(t,e){e=e||this;for(var n=new pE,i=this.tail;null!==i;)n.push(t.call(e,i.value,this)),i=i.prev;return n},pE.prototype.reduce=function(t,e){var n,i=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");i=this.head.next,n=this.head.value}for(var r=0;null!==i;r++)n=t(n,i.value,r),i=i.next;return n},pE.prototype.reduceReverse=function(t,e){var n,i=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");i=this.tail.prev,n=this.tail.value}for(var r=this.length-1;null!==i;r--)n=t(n,i.value,r),i=i.prev;return n},pE.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},pE.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},pE.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new pE;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,r=this.head;null!==r&&i<t;i++)r=r.next;for(;null!==r&&i<e;i++,r=r.next)n.push(r.value);return n},pE.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new pE;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,r=this.tail;null!==r&&i>e;i--)r=r.prev;for(;null!==r&&i>t;i--,r=r.prev)n.push(r.value);return n},pE.prototype.splice=function(t,e,...n){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var i=0,r=this.head;null!==r&&i<t;i++)r=r.next;var o=[];for(i=0;r&&i<e;i++)o.push(r.value),r=this.removeNode(r);null===r&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(i=0;i<n.length;i++)r=fE(this,r,n[i]);return o},pE.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=e,this.tail=t,this};try{pE.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}catch(t){}const vE=Symbol("max"),xE=Symbol("length"),bE=Symbol("lengthCalculator"),wE=Symbol("allowStale"),_E=Symbol("maxAge"),kE=Symbol("dispose"),SE=Symbol("noDisposeOnSet"),CE=Symbol("lruList"),AE=Symbol("cache"),IE=Symbol("updateAgeOnGet"),ME=()=>1;const DE=(t,e,n)=>{const i=t[AE].get(e);if(i){const e=i.value;if(TE(t,e)){if(NE(t,i),!t[wE])return}else n&&(t[IE]&&(i.value.now=Date.now()),t[CE].unshiftNode(i));return e.value}},TE=(t,e)=>{if(!e||!e.maxAge&&!t[_E])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[_E]&&n>t[_E]},EE=t=>{if(t[xE]>t[vE])for(let e=t[CE].tail;t[xE]>t[vE]&&null!==e;){const n=e.prev;NE(t,e),e=n}},NE=(t,e)=>{if(e){const n=e.value;t[kE]&&t[kE](n.key,n.value),t[xE]-=n.length,t[AE].delete(n.key),t[CE].removeNode(e)}};class OE{constructor(t,e,n,i,r){this.key=t,this.value=e,this.length=n,this.now=i,this.maxAge=r||0}}const FE=(t,e,n,i)=>{let r=n.value;TE(t,r)&&(NE(t,n),t[wE]||(r=void 0)),r&&e.call(i,r.value,r.key,t)};var RE=class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[vE]=t.max||1/0;const e=t.length||ME;if(this[bE]="function"!=typeof e?ME:e,this[wE]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[_E]=t.maxAge||0,this[kE]=t.dispose,this[SE]=t.noDisposeOnSet||!1,this[IE]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[vE]=t||1/0,EE(this)}get max(){return this[vE]}set allowStale(t){this[wE]=!!t}get allowStale(){return this[wE]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[_E]=t,EE(this)}get maxAge(){return this[_E]}set lengthCalculator(t){"function"!=typeof t&&(t=ME),t!==this[bE]&&(this[bE]=t,this[xE]=0,this[CE].forEach((t=>{t.length=this[bE](t.value,t.key),this[xE]+=t.length}))),EE(this)}get lengthCalculator(){return this[bE]}get length(){return this[xE]}get itemCount(){return this[CE].length}rforEach(t,e){e=e||this;for(let n=this[CE].tail;null!==n;){const i=n.prev;FE(this,t,n,e),n=i}}forEach(t,e){e=e||this;for(let n=this[CE].head;null!==n;){const i=n.next;FE(this,t,n,e),n=i}}keys(){return this[CE].toArray().map((t=>t.key))}values(){return this[CE].toArray().map((t=>t.value))}reset(){this[kE]&&this[CE]&&this[CE].length&&this[CE].forEach((t=>this[kE](t.key,t.value))),this[AE]=new Map,this[CE]=new dE,this[xE]=0}dump(){return this[CE].map((t=>!TE(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)})).toArray().filter((t=>t))}dumpLru(){return this[CE]}set(t,e,n){if((n=n||this[_E])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const i=n?Date.now():0,r=this[bE](e,t);if(this[AE].has(t)){if(r>this[vE])return NE(this,this[AE].get(t)),!1;const o=this[AE].get(t).value;return this[kE]&&(this[SE]||this[kE](t,o.value)),o.now=i,o.maxAge=n,o.value=e,this[xE]+=r-o.length,o.length=r,this.get(t),EE(this),!0}const o=new OE(t,e,r,i,n);return o.length>this[vE]?(this[kE]&&this[kE](t,e),!1):(this[xE]+=o.length,this[CE].unshift(o),this[AE].set(t,this[CE].head),EE(this),!0)}has(t){if(!this[AE].has(t))return!1;const e=this[AE].get(t).value;return!TE(this,e)}get(t){return DE(this,t,!0)}peek(t){return DE(this,t,!1)}pop(){const t=this[CE].tail;return t?(NE(this,t),t.value):null}del(t){NE(this,this[AE].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const i=t[n],r=i.e||0;if(0===r)this.set(i.k,i.v);else{const t=r-e;t>0&&this.set(i.k,i.v,t)}}}prune(){this[AE].forEach(((t,e)=>DE(this,e,!1)))}};class LE{constructor(t,e){if(e=IT(e),t instanceof LE)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new LE(t.raw,e);if(t instanceof sN)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((t=>this.parseRange(t.trim()))).filter((t=>t.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const t=this.set[0];if(this.set=this.set.filter((t=>!UE(t[0]))),0===this.set.length)this.set=[t];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&GE(t[0])){this.set=[t];break}}this.format()}format(){return this.range=this.set.map((t=>t.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();const e=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=PE.get(e);if(n)return n;const i=this.options.loose,r=i?zE[BE.HYPHENRANGELOOSE]:zE[BE.HYPHENRANGE];t=t.replace(r,iN(this.options.includePrerelease)),ST("hyphen replace",t),t=t.replace(zE[BE.COMPARATORTRIM],VE),ST("comparator trim",t,zE[BE.COMPARATORTRIM]),t=(t=(t=t.replace(zE[BE.TILDETRIM],WE)).replace(zE[BE.CARETTRIM],jE)).split(/\s+/).join(" ");const o=i?zE[BE.COMPARATORLOOSE]:zE[BE.COMPARATOR],a=t.split(" ").map((t=>qE(t,this.options))).join(" ").split(/\s+/).map((t=>nN(t,this.options))).filter(this.options.loose?t=>!!t.match(o):()=>!0).map((t=>new sN(t,this.options)));a.length;const s=new Map;for(const t of a){if(UE(t))return[t];s.set(t.value,t)}s.size>1&&s.has("")&&s.delete("");const l=[...s.values()];return PE.set(e,l),l}intersects(t,e){if(!(t instanceof LE))throw new TypeError("a Range is required");return this.set.some((n=>HE(n,e)&&t.set.some((t=>HE(t,e)&&n.every((n=>t.every((t=>n.intersects(t,e)))))))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new $T(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(rN(this.set[e],t,this.options))return!0;return!1}}var $E=LE;const PE=new RE({max:1e3}),{re:zE,t:BE,comparatorTrimReplace:VE,tildeTrimReplace:WE,caretTrimReplace:jE}=CT,UE=t=>"<0.0.0-0"===t.value,GE=t=>""===t.value,HE=(t,e)=>{let n=!0;const i=t.slice();let r=i.pop();for(;n&&i.length;)n=i.every((t=>r.intersects(t,e))),r=i.pop();return n},qE=(t,e)=>(ST("comp",t,e),t=ZE(t,e),ST("caret",t),t=YE(t,e),ST("tildes",t),t=QE(t,e),ST("xrange",t),t=eN(t,e),ST("stars",t),t),XE=t=>!t||"x"===t.toLowerCase()||"*"===t,YE=(t,e)=>t.trim().split(/\s+/).map((t=>KE(t,e))).join(" "),KE=(t,e)=>{const n=e.loose?zE[BE.TILDELOOSE]:zE[BE.TILDE];return t.replace(n,((e,n,i,r,o)=>{let a;return ST("tilde",t,e,n,i,r,o),XE(n)?a="":XE(i)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:XE(r)?a=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:o?(ST("replaceTilde pr",o),a=`>=${n}.${i}.${r}-${o} <${n}.${+i+1}.0-0`):a=`>=${n}.${i}.${r} <${n}.${+i+1}.0-0`,ST("tilde return",a),a}))},ZE=(t,e)=>t.trim().split(/\s+/).map((t=>JE(t,e))).join(" "),JE=(t,e)=>{ST("caret",t,e);const n=e.loose?zE[BE.CARETLOOSE]:zE[BE.CARET],i=e.includePrerelease?"-0":"";return t.replace(n,((e,n,r,o,a)=>{let s;return ST("caret",t,e,n,r,o,a),XE(n)?s="":XE(r)?s=`>=${n}.0.0${i} <${+n+1}.0.0-0`:XE(o)?s="0"===n?`>=${n}.${r}.0${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.0${i} <${+n+1}.0.0-0`:a?(ST("replaceCaret pr",a),s="0"===n?"0"===r?`>=${n}.${r}.${o}-${a} <${n}.${r}.${+o+1}-0`:`>=${n}.${r}.${o}-${a} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${o}-${a} <${+n+1}.0.0-0`):(ST("no pr"),s="0"===n?"0"===r?`>=${n}.${r}.${o}${i} <${n}.${r}.${+o+1}-0`:`>=${n}.${r}.${o}${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${o} <${+n+1}.0.0-0`),ST("caret return",s),s}))},QE=(t,e)=>(ST("replaceXRanges",t,e),t.split(/\s+/).map((t=>tN(t,e))).join(" ")),tN=(t,e)=>{t=t.trim();const n=e.loose?zE[BE.XRANGELOOSE]:zE[BE.XRANGE];return t.replace(n,((n,i,r,o,a,s)=>{ST("xRange",t,n,i,r,o,a,s);const l=XE(r),u=l||XE(o),c=u||XE(a),h=c;return"="===i&&h&&(i=""),s=e.includePrerelease?"-0":"",l?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&h?(u&&(o=0),a=0,">"===i?(i=">=",u?(r=+r+1,o=0,a=0):(o=+o+1,a=0)):"<="===i&&(i="<",u?r=+r+1:o=+o+1),"<"===i&&(s="-0"),n=`${i+r}.${o}.${a}${s}`):u?n=`>=${r}.0.0${s} <${+r+1}.0.0-0`:c&&(n=`>=${r}.${o}.0${s} <${r}.${+o+1}.0-0`),ST("xRange return",n),n}))},eN=(t,e)=>(ST("replaceStars",t,e),t.trim().replace(zE[BE.STAR],"")),nN=(t,e)=>(ST("replaceGTE0",t,e),t.trim().replace(zE[e.includePrerelease?BE.GTE0PRE:BE.GTE0],"")),iN=t=>(e,n,i,r,o,a,s,l,u,c,h,d,p)=>`${n=XE(i)?"":XE(r)?`>=${i}.0.0${t?"-0":""}`:XE(o)?`>=${i}.${r}.0${t?"-0":""}`:a?`>=${n}`:`>=${n}${t?"-0":""}`} ${l=XE(u)?"":XE(c)?`<${+u+1}.0.0-0`:XE(h)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${h}-${d}`:t?`<${u}.${c}.${+h+1}-0`:`<=${l}`}`.trim(),rN=(t,e,n)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let n=0;n<t.length;n++)if(ST(t[n].semver),t[n].semver!==sN.ANY&&t[n].semver.prerelease.length>0){const i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0},oN=Symbol("SemVer ANY");class aN{static get ANY(){return oN}constructor(t,e){if(e=IT(e),t instanceof aN){if(t.loose===!!e.loose)return t;t=t.value}ST("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===oN?this.value="":this.value=this.operator+this.semver.version,ST("comp",this)}parse(t){const e=this.options.loose?lN[uN.COMPARATORLOOSE]:lN[uN.COMPARATOR],n=t.match(e);if(!n)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new $T(n[2],this.options.loose):this.semver=oN}toString(){return this.value}test(t){if(ST("Comparator.test",t,this.options.loose),this.semver===oN||t===oN)return!0;if("string"==typeof t)try{t=new $T(t,this.options)}catch(t){return!1}return lE(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof aN))throw new TypeError("a Comparator is required");if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return""===this.value||new $E(t.value,e).test(this.value);if(""===t.operator)return""===t.value||new $E(this.value,e).test(t.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),r=this.semver.version===t.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),a=lE(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),s=lE(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return n||i||r&&o||a||s}}var sN=aN;const{re:lN,t:uN}=CT;var cN=(t,e,n)=>{try{e=new $E(e,n)}catch(t){return!1}return e.test(t)};var hN=(t,e)=>new $E(t,e).set.map((t=>t.map((t=>t.value)).join(" ").trim().split(" ")));var dN=(t,e,n)=>{let i=null,r=null,o=null;try{o=new $E(e,n)}catch(t){return null}return t.forEach((t=>{o.test(t)&&(i&&-1!==r.compare(t)||(i=t,r=new $T(i,n)))})),i};var pN=(t,e,n)=>{let i=null,r=null,o=null;try{o=new $E(e,n)}catch(t){return null}return t.forEach((t=>{o.test(t)&&(i&&1!==r.compare(t)||(i=t,r=new $T(i,n)))})),i};var fN=(t,e)=>{t=new $E(t,e);let n=new $T("0.0.0");if(t.test(n))return n;if(n=new $T("0.0.0-0"),t.test(n))return n;n=null;for(let e=0;e<t.set.length;++e){const i=t.set[e];let r=null;i.forEach((t=>{const e=new $T(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":r&&!iE(e,r)||(r=e);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!r||n&&!iE(n,r)||(n=r)}return n&&t.test(n)?n:null};var gN=(t,e)=>{try{return new $E(t,e).range||"*"}catch(t){return null}};const{ANY:mN}=sN;var yN=(t,e,n,i)=>{let r,o,a,s,l;switch(t=new $T(t,i),e=new $E(e,i),n){case">":r=iE,o=sE,a=rE,s=">",l=">=";break;case"<":r=rE,o=aE,a=iE,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(cN(t,e,i))return!1;for(let n=0;n<e.set.length;++n){const u=e.set[n];let c=null,h=null;if(u.forEach((t=>{t.semver===mN&&(t=new sN(">=0.0.0")),c=c||t,h=h||t,r(t.semver,c.semver,i)?c=t:a(t.semver,h.semver,i)&&(h=t)})),c.operator===s||c.operator===l)return!1;if((!h.operator||h.operator===s)&&o(t,h.semver))return!1;if(h.operator===l&&a(t,h.semver))return!1}return!0};var vN=(t,e,n)=>yN(t,e,">",n);var xN=(t,e,n)=>yN(t,e,"<",n);var bN=(t,e,n)=>(t=new $E(t,n),e=new $E(e,n),t.intersects(e));const{ANY:wN}=sN,_N=(t,e,n)=>{if(t===e)return!0;if(1===t.length&&t[0].semver===wN){if(1===e.length&&e[0].semver===wN)return!0;t=n.includePrerelease?[new sN(">=0.0.0-0")]:[new sN(">=0.0.0")]}if(1===e.length&&e[0].semver===wN){if(n.includePrerelease)return!0;e=[new sN(">=0.0.0")]}const i=new Set;let r,o,a,s,l,u,c;for(const e of t)">"===e.operator||">="===e.operator?r=kN(r,e,n):"<"===e.operator||"<="===e.operator?o=SN(o,e,n):i.add(e.semver);if(i.size>1)return null;if(r&&o){if(a=GT(r.semver,o.semver,n),a>0)return null;if(0===a&&(">="!==r.operator||"<="!==o.operator))return null}for(const t of i){if(r&&!cN(t,String(r),n))return null;if(o&&!cN(t,String(o),n))return null;for(const i of e)if(!cN(t,String(i),n))return!1;return!0}let h=!(!o||n.includePrerelease||!o.semver.prerelease.length)&&o.semver,d=!(!r||n.includePrerelease||!r.semver.prerelease.length)&&r.semver;h&&1===h.prerelease.length&&"<"===o.operator&&0===h.prerelease[0]&&(h=!1);for(const t of e){if(c=c||">"===t.operator||">="===t.operator,u=u||"<"===t.operator||"<="===t.operator,r)if(d&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===d.major&&t.semver.minor===d.minor&&t.semver.patch===d.patch&&(d=!1),">"===t.operator||">="===t.operator){if(s=kN(r,t,n),s===t&&s!==r)return!1}else if(">="===r.operator&&!cN(r.semver,String(t),n))return!1;if(o)if(h&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===h.major&&t.semver.minor===h.minor&&t.semver.patch===h.patch&&(h=!1),"<"===t.operator||"<="===t.operator){if(l=SN(o,t,n),l===t&&l!==o)return!1}else if("<="===o.operator&&!cN(o.semver,String(t),n))return!1;if(!t.operator&&(o||r)&&0!==a)return!1}return!(r&&u&&!o&&0!==a)&&(!(o&&c&&!r&&0!==a)&&(!d&&!h))},kN=(t,e,n)=>{if(!t)return e;const i=GT(t.semver,e.semver,n);return i>0?t:i<0||">"===e.operator&&">="===t.operator?e:t},SN=(t,e,n)=>{if(!t)return e;const i=GT(t.semver,e.semver,n);return i<0?t:i>0||"<"===e.operator&&"<="===t.operator?e:t};var CN=(t,e,n={})=>{if(t===e)return!0;t=new $E(t,n),e=new $E(e,n);let i=!1;t:for(const r of t.set){for(const t of e.set){const e=_N(r,t,n);if(i=i||null!==e,e)continue t}if(i)return!1}return!0},AN={re:CT.re,src:CT.src,tokens:CT.t,SEMVER_SPEC_VERSION:kT.SEMVER_SPEC_VERSION,SemVer:$T,compareIdentifiers:TT.compareIdentifiers,rcompareIdentifiers:TT.rcompareIdentifiers,parse:VT,valid:WT,clean:jT,inc:UT,diff:qT,major:XT,minor:YT,patch:KT,prerelease:ZT,compare:GT,rcompare:JT,compareLoose:QT,compareBuild:tE,sort:eE,rsort:nE,gt:iE,lt:rE,eq:HT,neq:oE,gte:aE,lte:sE,cmp:lE,coerce:hE,Comparator:sN,Range:$E,satisfies:cN,toComparators:hN,maxSatisfying:dN,minSatisfying:pN,minVersion:fN,validRange:gN,outside:yN,gtr:vN,ltr:xN,intersects:bN,simplifyRange:(t,e,n)=>{const i=[];let r=null,o=null;const a=t.sort(((t,e)=>GT(t,e,n)));for(const t of a){cN(t,e,n)?(o=t,r||(r=t)):(o&&i.push([r,o]),o=null,r=null)}r&&i.push([r,null]);const s=[];for(const[t,e]of i)t===e?s.push(t):e||t!==a[0]?e?t===a[0]?s.push(`<=${e}`):s.push(`${t} - ${e}`):s.push(`>=${t}`):s.push("*");const l=s.join(" || "),u="string"==typeof e.raw?e.raw:String(e);return l.length<u.length?l:e},subset:CN};function IN(t,e,n){return t.fields=e||[],t.fname=n,t}function MN(t){return null==t?null:t.fname}function DN(t){return null==t?null:t.fields}function TN(t){return 1===t.length?EN(t[0]):NN(t)}const EN=t=>function(e){return e[t]},NN=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function ON(t){throw Error(t)}function FN(t){const e=[],n=t.length;let i,r,o,a=null,s=0,l="";function u(){e.push(l+t.substring(i,r)),l="",i=r+1}for(t+="",i=r=0;r<n;++r)if(o=t[r],"\\"===o)l+=t.substring(i,r),l+=t.substring(++r,++r),i=r;else if(o===a)u(),a=null,s=-1;else{if(a)continue;i===s&&'"'===o||i===s&&"'"===o?(i=r+1,a=o):"."!==o||s?"["===o?(r>i&&u(),s=i=r+1):"]"===o&&(s||ON("Access path missing open bracket: "+t),s>0&&u(),s=0,i=r+1):r>i?u():i=r+1}return s&&ON("Access path missing closing bracket: "+t),a&&ON("Access path missing closing quote: "+t),r>i&&(r++,u()),e}function RN(t,e,n){const i=FN(t);return t=1===i.length?i[0]:t,IN((n&&n.get||TN)(i),[t],e||t)}const LN=RN("id"),$N=IN((t=>t),[],"identity"),PN=IN((()=>0),[],"zero"),zN=IN((()=>1),[],"one"),BN=IN((()=>!0),[],"true"),VN=IN((()=>!1),[],"false");function WN(t,e,n){const i=[e].concat([].slice.call(n));console[t].apply(console,i)}function jN(t,e){let n=t||0;return{level(t){return arguments.length?(n=+t,this):n},error(){return n>=1&&WN(e||"error","ERROR",arguments),this},warn(){return n>=2&&WN(e||"warn","WARN",arguments),this},info(){return n>=3&&WN(e||"log","INFO",arguments),this},debug(){return n>=4&&WN(e||"log","DEBUG",arguments),this}}}var UN=Array.isArray;function GN(t){return t===Object(t)}const HN=t=>"__proto__"!==t;function qN(...t){return t.reduce(((t,e)=>{for(const n in e)if("signals"===n)t.signals=YN(t.signals,e.signals);else{const i="legend"===n?{layout:1}:"style"===n||null;XN(t,n,e[n],i)}return t}),{})}function XN(t,e,n,i){if(!HN(e))return;let r,o;if(GN(n)&&!UN(n))for(r in o=GN(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?XN(o,r,n[r]):HN(r)&&(o[r]=n[r]);else t[e]=n}function YN(t,e){if(null==t)return e;const n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}function KN(t){return t[t.length-1]}function ZN(t){return null==t||""===t?null:+t}const JN=t=>e=>t*Math.exp(e),QN=t=>e=>Math.log(t*e),tO=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),eO=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,nO=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function iO(t,e,n,i){const r=n(t[0]),o=n(KN(t)),a=(o-r)*e;return[i(r-a),i(o-a)]}function rO(t,e){return iO(t,e,ZN,$N)}function oO(t,e){var n=Math.sign(t[0]);return iO(t,e,QN(n),JN(n))}function aO(t,e,n){return iO(t,e,nO(n),nO(1/n))}function sO(t,e,n){return iO(t,e,tO(n),eO(n))}function lO(t,e,n,i,r){const o=i(t[0]),a=i(KN(t)),s=null!=e?i(e):(o+a)/2;return[r(s+(o-s)*n),r(s+(a-s)*n)]}function uO(t,e,n){return lO(t,e,n,ZN,$N)}function cO(t,e,n){const i=Math.sign(t[0]);return lO(t,e,n,QN(i),JN(i))}function hO(t,e,n,i){return lO(t,e,n,nO(i),nO(1/i))}function dO(t,e,n,i){return lO(t,e,n,tO(i),eO(i))}function pO(t){return 1+~~(new Date(t).getMonth()/3)}function fO(t){return 1+~~(new Date(t).getUTCMonth()/3)}function gO(t){return null!=t?UN(t)?t:[t]:[]}function mO(t,e,n){let i,r=t[0],o=t[1];return o<r&&(i=o,o=r,r=i),i=o-r,i>=n-e?[e,n]:[r=Math.min(Math.max(r,e),n-i),r+i]}function yO(t){return"function"==typeof t}function vO(t,e,n){n=n||{},e=gO(e)||[];const i=[],r=[],o={},a=n.comparator||bO;return gO(t).forEach(((t,a)=>{null!=t&&(i.push("descending"===e[a]?-1:1),r.push(t=yO(t)?t:RN(t,null,n)),(DN(t)||[]).forEach((t=>o[t]=1)))})),0===r.length?null:IN(a(r,i),Object.keys(o))}const xO=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),bO=(t,e)=>1===t.length?wO(t[0],e[0]):_O(t,e,t.length),wO=(t,e)=>function(n,i){return xO(t(n),t(i))*e},_O=(t,e,n)=>(e.push(0),function(i,r){let o,a=0,s=-1;for(;0===a&&++s<n;)o=t[s],a=xO(o(i),o(r));return a*e[s]});function kO(t){return yO(t)?t:()=>t}function SO(t,e){let n;return i=>{n&&clearTimeout(n),n=setTimeout((()=>(e(i),n=null)),t)}}function CO(t){for(let e,n,i=1,r=arguments.length;i<r;++i)for(n in e=arguments[i],e)t[n]=e[n];return t}function AO(t,e){let n,i,r,o,a=0;if(t&&(n=t.length))if(null==e){for(i=t[a];a<n&&(null==i||i!=i);i=t[++a]);for(r=o=i;a<n;++a)i=t[a],null!=i&&(i<r&&(r=i),i>o&&(o=i))}else{for(i=e(t[a]);a<n&&(null==i||i!=i);i=e(t[++a]));for(r=o=i;a<n;++a)i=e(t[a]),null!=i&&(i<r&&(r=i),i>o&&(o=i))}return[r,o]}function IO(t,e){const n=t.length;let i,r,o,a,s,l=-1;if(null==e){for(;++l<n;)if(r=t[l],null!=r&&r>=r){i=o=r;break}if(l===n)return[-1,-1];for(a=s=l;++l<n;)r=t[l],null!=r&&(i>r&&(i=r,a=l),o<r&&(o=r,s=l))}else{for(;++l<n;)if(r=e(t[l],l,t),null!=r&&r>=r){i=o=r;break}if(l===n)return[-1,-1];for(a=s=l;++l<n;)r=e(t[l],l,t),null!=r&&(i>r&&(i=r,a=l),o<r&&(o=r,s=l))}return[a,s]}const MO=Object.prototype.hasOwnProperty;function DO(t,e){return MO.call(t,e)}const TO={};function EO(t){let e,n={};function i(t){return DO(n,t)&&n[t]!==TO}const r={size:0,empty:0,object:n,has:i,get:t=>i(t)?n[t]:void 0,set(t,e){return i(t)||(++r.size,n[t]===TO&&--r.empty),n[t]=e,this},delete(t){return i(t)&&(--r.size,++r.empty,n[t]=TO),this},clear(){r.size=r.empty=0,r.object=n={}},test(t){return arguments.length?(e=t,r):e},clean(){const t={};let i=0;for(const r in n){const o=n[r];o===TO||e&&e(o)||(t[r]=o,++i)}r.size=i,r.empty=0,r.object=n=t}};return t&&Object.keys(t).forEach((e=>{r.set(e,t[e])})),r}function NO(t,e,n,i,r,o){if(!n&&0!==n)return o;const a=+n;let s,l=t[0],u=KN(t);u<l&&(s=l,l=u,u=s),s=Math.abs(e-l);const c=Math.abs(u-e);return s<c&&s<=a?i:c<=a?r:o}function OO(t,e,n){const i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),CO(i,n)}function FO(t,e,n,i){let r,o=e[0],a=e[e.length-1];return o>a&&(r=o,o=a,a=r),i=void 0===i||i,((n=void 0===n||n)?o<=t:o<t)&&(i?t<=a:t<a)}function RO(t){return"boolean"==typeof t}function LO(t){return"[object Date]"===Object.prototype.toString.call(t)}function $O(t){return t&&yO(t[Symbol.iterator])}function PO(t){return"number"==typeof t}function zO(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function BO(t){return"string"==typeof t}function VO(t,e,n){t&&(t=e?gO(t).map((t=>t.replace(/\\(.)/g,"$1"))):gO(t));const i=t&&t.length,r=n&&n.get||TN,o=t=>r(e?[t]:FN(t));let a;if(i)if(1===i){const e=o(t[0]);a=function(t){return""+e(t)}}else{const e=t.map(o);a=function(t){let n=""+e[0](t),r=0;for(;++r<i;)n+="|"+e[r](t);return n}}else a=function(){return""};return IN(a,t,"key")}function WO(t,e){const n=t[0],i=KN(t),r=+e;return r?1===r?i:n+r*(i-n):n}function jO(t){let e,n,i;t=+t||1e4;const r=()=>{e={},n={},i=0},o=(r,o)=>(++i>t&&(n=e,e={},i=1),e[r]=o);return r(),{clear:r,has:t=>DO(e,t)||DO(n,t),get:t=>DO(e,t)?e[t]:DO(n,t)?o(t,n[t]):void 0,set:(t,n)=>DO(e,t)?e[t]=n:o(t,n)}}function UO(t,e,n,i){const r=e.length,o=n.length;if(!o)return e;if(!r)return n;const a=i||new e.constructor(r+o);let s=0,l=0,u=0;for(;s<r&&l<o;++u)a[u]=t(e[s],n[l])>0?n[l++]:e[s++];for(;s<r;++s,++u)a[u]=e[s];for(;l<o;++l,++u)a[u]=n[l];return a}function GO(t,e){let n="";for(;--e>=0;)n+=t;return n}function HO(t,e,n,i){const r=n||" ",o=t+"",a=e-o.length;return a<=0?o:"left"===i?GO(r,a)+o:"center"===i?GO(r,~~(a/2))+o+GO(r,Math.ceil(a/2)):o+GO(r,a)}function qO(t){return t&&KN(t)-t[0]||0}function XO(t){return UN(t)?"["+t.map(XO)+"]":GN(t)||BO(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function YO(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t)&&!!t}const KO=t=>PO(t)||LO(t)?t:Date.parse(t);function ZO(t,e){return e=e||KO,null==t||""===t?null:e(t)}function JO(t){return null==t||""===t?null:t+""}function QO(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function tF(t,e,n,i){const r=null!=i?i:"…",o=t+"",a=o.length,s=Math.max(0,e-r.length);return a<=e?o:"left"===n?r+o.slice(a-s):"center"===n?o.slice(0,Math.ceil(s/2))+r+o.slice(a-~~(s/2)):o.slice(0,s)+r}function eF(t,e,n){if(t)if(e){const i=t.length;for(let r=0;r<i;++r){const i=e(t[r]);i&&n(i,r,t)}}else t.forEach(n)}const nF=/^([A-Za-z]+:)?\/\//,iF=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,rF=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;async function oF(t,e){const n=await this.sanitize(t,e),i=n.href;return n.localFile?this.file(i):this.http(i,e)}async function aF(t,e){e=CO({},this.options,e);const n=this.fileAccess,i={href:null};let r,o,a;const s=iF.test(t.replace(rF,""));null!=t&&"string"==typeof t&&s||ON("Sanitize failure, invalid URI: "+XO(t));const l=nF.test(t);return(a=e.baseURL)&&!l&&(t.startsWith("/")||"/"===a[a.length-1]||(t="/"+t),t=a+t),o=(r=t.startsWith("file://"))||"file"===e.mode||"http"!==e.mode&&!l&&n,r?t=t.slice("file://".length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),o=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(i,"localFile",{value:!!o}),i.href=t,e.target&&(i.target=e.target+""),e.rel&&(i.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(i.crossOrigin=e.crossOrigin+""),i}function sF(t){return t?e=>new Promise(((n,i)=>{t.readFile(e,((t,e)=>{t?i(t):n(e)}))})):lF}async function lF(){ON("No file system access.")}function uF(t){return t?async function(e,n){const i=CO({},this.options.http,n),r=n&&n.response,o=await t(e,i);return o.ok?yO(o[r])?o[r]():o.text():ON(o.status+""+o.statusText)}:cF}async function cF(){ON("No HTTP fetch method available.")}const hF=t=>!(Number.isNaN(+t)||t instanceof Date),dF={boolean:YO,integer:ZN,number:ZN,date:ZO,string:JO,unknown:$N},pF=[t=>"true"===t||"false"===t||!0===t||!1===t,t=>hF(t)&&Number.isInteger(+t),hF,t=>!Number.isNaN(Date.parse(t))],fF=["boolean","integer","number","date"];function gF(t,e){if(!t||!t.length)return"unknown";const n=t.length,i=pF.length,r=pF.map(((t,e)=>e+1));for(let a,s,l=0,u=0;l<n;++l)for(s=e?t[l][e]:t[l],a=0;a<i;++a)if(r[a]&&(null!=(o=s)&&o==o)&&!pF[a](s)&&(r[a]=0,++u,u===pF.length))return"string";var o;return fF[r.reduce(((t,e)=>0===t?e:t),0)-1]}function mF(t,e){return e.reduce(((e,n)=>(e[n]=gF(t,n),e)),{})}var yF={},vF={};function xF(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function bF(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var i in t)i in e||n.push(e[i]=i)})),n}function wF(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function _F(t){var e,n=t.getUTCHours(),i=t.getUTCMinutes(),r=t.getUTCSeconds(),o=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+wF(-e,6):e>9999?"+"+wF(e,6):wF(e,4))+"-"+wF(t.getUTCMonth()+1,2)+"-"+wF(t.getUTCDate(),2)+(o?"T"+wF(n,2)+":"+wF(i,2)+":"+wF(r,2)+"."+wF(o,3)+"Z":r?"T"+wF(n,2)+":"+wF(i,2)+":"+wF(r,2)+"Z":i||n?"T"+wF(n,2)+":"+wF(i,2)+"Z":"")}function kF(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function i(t,e){var i,r=[],o=t.length,a=0,s=0,l=o<=0,u=!1;function c(){if(l)return vF;if(u)return u=!1,yF;var e,i,r=a;if(34===t.charCodeAt(r)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?l=!0:10===(i=t.charCodeAt(a++))?u=!0:13===i&&(u=!0,10===t.charCodeAt(a)&&++a),t.slice(r+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(i=t.charCodeAt(e=a++)))u=!0;else if(13===i)u=!0,10===t.charCodeAt(a)&&++a;else if(i!==n)continue;return t.slice(r,e)}return l=!0,t.slice(r,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(i=c())!==vF;){for(var h=[];i!==yF&&i!==vF;)h.push(i),i=c();e&&null==(h=e(h,s++))||r.push(h)}return r}function r(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?_F(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,r,o=i(t,(function(t,i){if(n)return n(t,i-1);r=t,n=e?function(t,e){var n=xF(t);return function(i,r){return e(n(i),r,t)}}(t,e):xF(t)}));return o.columns=r||[],o},parseRows:i,format:function(e,n){return null==n&&(n=bF(e)),[n.map(a).join(t)].concat(r(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=bF(t)),r(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}function SF(t){const e=function(e,n){const i={delimiter:t};return CF(e,n?CO(n,i):i)};return e.responseType="text",e}function CF(t,e){return e.header&&(t=e.header.map(XO).join(e.delimiter)+"\n"+t),kF(e.delimiter).parse(t+"")}function AF(t,e){const n=e&&e.property?RN(e.property):$N;return!GN(t)||(i=t,"function"==typeof Buffer&&yO(Buffer.isBuffer)&&Buffer.isBuffer(i))?n(JSON.parse(t)):function(t,e){!UN(t)&&$O(t)&&(t=[...t]);return e&&e.copy?JSON.parse(JSON.stringify(t)):t}(n(t),e);var i}function IF(t){return t}function MF(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return DF(t,e)}))}:DF(t,e)}function DF(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,o=TF(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:o}:null==i?{type:"Feature",id:n,properties:r,geometry:o}:{type:"Feature",id:n,bbox:i,properties:r,geometry:o}}function TF(t,e){var n=function(t){if(null==t)return IF;var e,n,i=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var l=2,u=t.length,c=new Array(u);for(c[0]=(e+=t[0])*i+o,c[1]=(n+=t[1])*r+a;l<u;)c[l]=t[l],++l;return c}}(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],o=0,a=r.length;o<a;++o)e.push(n(r[o],o));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}return function t(e){var n,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=a(e.arcs);break;case"MultiLineString":n=e.arcs.map(a);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:i,coordinates:n}}(e)}function EF(t,e){var n={},i={},r={},o=[],a=-1;function s(t,e){for(var i in t){var r=t[i];delete e[r.start],delete r.start,delete r.end,r.forEach((function(t){n[t<0?~t:t]=1})),o.push(r)}}return e.forEach((function(n,i){var r,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(r=e[++a],e[a]=n,e[i]=r)})),e.forEach((function(e){var n,o,a=function(e){var n,i=t.arcs[e<0?~e:e],r=i[0];t.transform?(n=[0,0],i.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=i[i.length-1];return e<0?[n,r]:[r,n]}(e),s=a[0],l=a[1];if(n=r[s])if(delete r[n.end],n.push(e),n.end=l,o=i[l]){delete i[o.start];var u=o===n?n:n.concat(o);i[u.start=n.start]=r[u.end=o.end]=u}else i[n.start]=r[n.end]=n;else if(n=i[l])if(delete i[n.start],n.unshift(e),n.start=s,o=r[s]){delete r[o.end];var c=o===n?n:o.concat(n);i[c.start=o.start]=r[c.end=n.end]=c}else i[n.start]=r[n.end]=n;else i[(n=[e]).start=s]=r[n.end=l]=n})),s(r,i),s(i,r),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function NF(t){return TF(t,OF.apply(this,arguments))}function OF(t,e,n){var i,r,o;if(arguments.length>1)i=FF(t,e,n);else for(r=0,i=new Array(o=t.arcs.length);r<o;++r)i[r]=r;return{type:"MultiLineString",arcs:EF(t,i)}}function FF(t,e,n){var i,r=[],o=[];function a(t){var e=t<0?~t:t;(o[e]||(o[e]=[])).push({i:t,g:i})}function s(t){t.forEach(a)}function l(t){t.forEach(s)}return function t(e){switch(i=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":l(e.arcs);break;case"MultiPolygon":e.arcs.forEach(l)}}(e),o.forEach(null==n?function(t){r.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&r.push(t[0].i)}),r}CF.responseType="text",AF.responseType="json";const RF={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function LF(t,e){let n,i,r,o;return t=AF(t,e),e&&e.feature?(n=MF,r=e.feature):e&&e.mesh?(n=NF,r=e.mesh,o=RF[e.filter]):ON("Missing TopoJSON feature or mesh parameter."),i=(i=t.objects[r])?n(t,i,o):ON("Invalid TopoJSON object: "+r),i&&i.features||[i]}LF.responseType="json";const $F={dsv:CF,csv:SF(","),tsv:SF("\t"),json:AF,topojson:LF};function PF(t,e){return arguments.length>1?($F[t]=e,this):DO($F,t)?$F[t]:null}function zF(t){const e=PF(t);return e&&e.responseType||"text"}function BF(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function VF(t){let e=t,n=t;function i(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)<0?i=o+1:r=o}return i}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>BF(t(e),n)}(t)),{left:i,center:function(t,n,r,o){null==r&&(r=0),null==o&&(o=t.length);const a=i(t,n,r,o-1);return a>r&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)>0?r=o:i=o+1}return i}}}function WF(t){return null===t?NaN:+t}const jF=VF(BF),UF=jF.right,GF=jF.left;VF(WF).center;class HF{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=e[i],o=t+r,a=Math.abs(t)<Math.abs(r)?t-(o-r):r-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,i,r=this._n,o=0;if(r>0){for(o=t[--r];r>0&&(e=o,n=t[--r],o=e+n,i=n-(o-e),!i););r>0&&(i<0&&t[r-1]<0||i>0&&t[r-1]>0)&&(n=2*i,e=o+n,n==e-o&&(o=e))}return o}}var qF=Math.sqrt(50),XF=Math.sqrt(10),YF=Math.sqrt(2);function KF(t,e,n){var i,r,o,a,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((i=e<t)&&(r=t,t=e,e=r),0===(a=ZF(t,e,n))||!isFinite(a))return[];if(a>0){let n=Math.round(t/a),i=Math.round(e/a);for(n*a<t&&++n,i*a>e&&--i,o=new Array(r=i-n+1);++s<r;)o[s]=(n+s)*a}else{a=-a;let n=Math.round(t*a),i=Math.round(e*a);for(n/a<t&&++n,i/a>e&&--i,o=new Array(r=i-n+1);++s<r;)o[s]=(n+s)/a}return i&&o.reverse(),o}function ZF(t,e,n){var i=(e-t)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=qF?10:o>=XF?5:o>=YF?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=qF?10:o>=XF?5:o>=YF?2:1)}function JF(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=qF?r*=10:o>=XF?r*=5:o>=YF&&(r*=2),e<t?-r:r}function QF(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function tR(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function eR(t,e,n=0,i=t.length-1,r=BF){for(;i>n;){if(i-n>600){const o=i-n+1,a=e-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);eR(t,e,Math.max(n,Math.floor(e-a*l/o+u)),Math.min(i,Math.floor(e+(o-a)*l/o+u)),r)}const o=t[e];let a=n,s=i;for(nR(t,n,e),r(t[i],o)>0&&nR(t,n,i);a<s;){for(nR(t,a,s),++a,--s;r(t[a],o)<0;)++a;for(;r(t[s],o)>0;)--s}0===r(t[n],o)?nR(t,n,s):(++s,nR(t,s,i)),s<=e&&(n=s+1),e<=s&&(i=s-1)}return t}function nR(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function iR(t,e,n){if(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n))).length){if((e=+e)<=0||i<2)return tR(t);if(e>=1)return QF(t);var i,r=(i-1)*e,o=Math.floor(r),a=QF(eR(t,o).subarray(0,o+1));return a+(tR(t.subarray(o+1))-a)*(r-o)}}function rR(t,e,n=WF){if(i=t.length){if((e=+e)<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,o=Math.floor(r),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(r-o)}}function oR(t,e){return iR(t,.5,e)}function aR(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function sR(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(r);++i<r;)o[i]=t+i*n;return o}function lR(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}function uR(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function cR(t){return(t=uR(Math.abs(t)))?t[1]:NaN}var hR,dR=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pR(t){if(!(e=dR.exec(t)))throw new Error("invalid format: "+t);var e;return new fR({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function fR(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function gR(t,e){var n=uR(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}pR.prototype=fR.prototype,fR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var mR={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>gR(100*t,e),r:gR,s:function(t,e){var n=uR(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(hR=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+uR(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function yR(t){return t}var vR,xR,bR,wR=Array.prototype.map,_R=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function kR(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?yR:(e=wR.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,o=[],a=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?yR:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(wR.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=pR(t)).fill,n=t.align,h=t.sign,d=t.symbol,p=t.zero,f=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):mR[v]||(void 0===m&&(m=12),y=!0,v="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var x="$"===d?r:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",b="$"===d?o:/[%p]/.test(v)?l:"",w=mR[v],_=/[defgprs%]/.test(v);function k(t){var r,o,l,d=x,k=b;if("c"===v)k=w(t)+k,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:w(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==h&&(S=!1),d=(S?"("===h?h:u:"-"===h||"("===h?"":h)+d,k=("s"===v?_R[8+hR/3]:"")+k+(S&&"("===h?")":""),_)for(r=-1,o=t.length;++r<o;)if(48>(l=t.charCodeAt(r))||l>57){k=(46===l?a+t.slice(r+1):t.slice(r))+k,t=t.slice(0,r);break}}g&&!p&&(t=i(t,1/0));var C=d.length+t.length+k.length,A=C<f?new Array(f-C+1).join(e):"";switch(g&&p&&(t=i(A+t,A.length?f-k.length:1/0),A=""),n){case"<":t=d+t+k+A;break;case"=":t=d+A+t+k;break;case"^":t=A.slice(0,C=A.length>>1)+d+t+k+A.slice(C);break;default:t=A+d+t+k}return s(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:h,formatPrefix:function(t,e){var n=h(((t=pR(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(cR(e)/3))),r=Math.pow(10,-i),o=_R[8+i/3];return function(t){return n(r*t)+o}}}}vR=kR({thousands:",",grouping:[3],currency:["$",""]}),xR=vR.format,bR=vR.formatPrefix;var SR=new Date,CR=new Date;function AR(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},r.round=function(t){var e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},r.range=function(n,i,o){var a,s=[];if(n=r.ceil(n),o=null==o?1:Math.floor(o),!(n<i&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<i);return s},r.filter=function(n){return AR((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}))},n&&(r.count=function(e,i){return SR.setTime(+e),CR.setTime(+i),t(SR),t(CR),Math.floor(n(SR,CR))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?function(e){return i(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var IR=AR((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));IR.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?AR((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):IR:null};var MR=AR((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),DR=AR((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()})),TR=AR((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()})),ER=AR((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5),(t=>t.getDate()-1));function NR(t){return AR((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var OR=NR(0),FR=NR(1);NR(2),NR(3);var RR=NR(4);NR(5),NR(6);var LR=AR((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),$R=AR((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));$R.every=function(t){return isFinite(t=Math.floor(t))&&t>0?AR((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var PR=AR((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()})),zR=AR((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),BR=AR((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}));function VR(t){return AR((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var WR=VR(0),jR=VR(1);VR(2),VR(3);var UR=VR(4);VR(5),VR(6);var GR=AR((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})),HR=AR((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));function qR(t,e,n,i,r,o){const a=[[MR,1,1e3],[MR,5,5e3],[MR,15,15e3],[MR,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[r,1,36e5],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,864e5],[i,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function s(e,n,i){const r=Math.abs(n-e)/i,o=VF((([,,t])=>t)).right(a,r);if(o===a.length)return t.every(JF(e/31536e6,n/31536e6,i));if(0===o)return IR.every(Math.max(JF(e,n,i),1));const[s,l]=a[r/a[o-1][2]<a[o][2]/r?o-1:o];return s.every(l)}return[function(t,e,n){const i=e<t;i&&([t,e]=[e,t]);const r=n&&"function"==typeof n.range?n:s(t,e,n),o=r?r.range(t,+e+1):[];return i?o.reverse():o},s]}HR.every=function(t){return isFinite(t=Math.floor(t))&&t>0?AR((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const[XR,YR]=qR(HR,GR,WR,BR,zR,PR),[KR,ZR]=qR($R,LR,OR,ER,TR,DR),JR="year",QR="quarter",tL="month",eL="week",nL="date",iL="day",rL="hours",oL="minutes",aL="seconds",sL=[JR,QR,tL,eL,nL,iL,"dayofyear",rL,oL,aL,"milliseconds"],lL=sL.reduce(((t,e,n)=>(t[e]=1+n,t)),{});function uL(t){const e=gO(t).slice(),n={};e.length||ON("Missing time unit."),e.forEach((t=>{DO(lL,t)?n[t]=1:ON("Invalid time unit: ".concat(t,"."))}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&ON("Incompatible time units: ".concat(t)),e.sort(((t,e)=>lL[t]-lL[e])),e}const cL={[JR]:"%Y ",[QR]:"Q%q ",[tL]:"%b ",[nL]:"%d ",[eL]:"W%U ",[iL]:"%a ",dayofyear:"%j ",[rL]:"%H:00",[oL]:"00:%M",[aL]:":%S",milliseconds:".%L",["".concat(JR,"-").concat(tL)]:"%Y-%m ",["".concat(JR,"-").concat(tL,"-").concat(nL)]:"%Y-%m-%d ",["".concat(rL,"-").concat(oL)]:"%H:%M"};function hL(t,e){const n=CO({},cL,e),i=uL(t),r=i.length;let o,a,s="",l=0;for(l=0;l<r;)for(o=i.length;o>l;--o)if(a=i.slice(l,o).join("-"),null!=n[a]){s+=n[a],l=o;break}return s.trim()}const dL=new Date;function pL(t){return dL.setFullYear(t),dL.setMonth(0),dL.setDate(1),dL.setHours(0,0,0,0),dL}function fL(t){return mL(new Date(t))}function gL(t){return yL(new Date(t))}function mL(t){return ER.count(pL(t.getFullYear())-1,t)}function yL(t){return OR.count(pL(t.getFullYear())-1,t)}function vL(t){return pL(t).getDay()}function xL(t,e,n,i,r,o,a){if(0<=t&&t<100){const s=new Date(-1,e,n,i,r,o,a);return s.setFullYear(t),s}return new Date(t,e,n,i,r,o,a)}function bL(t){return _L(new Date(t))}function wL(t){return kL(new Date(t))}function _L(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return BR.count(e-1,t)}function kL(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return WR.count(e-1,t)}function SL(t){return dL.setTime(Date.UTC(t,0,1)),dL.getUTCDay()}function CL(t,e,n,i,r,o,a){if(0<=t&&t<100){const t=new Date(Date.UTC(-1,e,n,i,r,o,a));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(t,e,n,i,r,o,a))}function AL(t,e,n,i,r){const o=e||1,a=KN(t),s=(t,e,r)=>function(t,e,n,i){const r=n<=1?t:i?(e,r)=>i+n*Math.floor((t(e,r)-i)/n):(e,i)=>n*Math.floor(t(e,i)/n);return e?(t,n)=>e(r(t,n),n):r}(n[r=r||t],i[r],t===a&&o,e),l=new Date,u=QO(t),c=u.year?s(JR):kO(2012),h=u.month?s(tL):u.quarter?s(QR):PN,d=u.week&&u.day?s(iL,1,eL+iL):u.week?s(eL,1):u.day?s(iL,1):u.date?s(nL,1):u.dayofyear?s("dayofyear",1):zN,p=u.hours?s(rL):PN,f=u.minutes?s(oL):PN,g=u.seconds?s(aL):PN,m=u.milliseconds?s("milliseconds"):PN;return function(t){l.setTime(+t);const e=c(l);return r(e,h(l),d(l,e),p(l),f(l),g(l),m(l))}}function IL(t,e,n){return e+7*t-(n+6)%7}const ML={[JR]:t=>t.getFullYear(),[QR]:t=>Math.floor(t.getMonth()/3),[tL]:t=>t.getMonth(),[nL]:t=>t.getDate(),[rL]:t=>t.getHours(),[oL]:t=>t.getMinutes(),[aL]:t=>t.getSeconds(),milliseconds:t=>t.getMilliseconds(),dayofyear:t=>mL(t),[eL]:t=>yL(t),[eL+iL]:(t,e)=>IL(yL(t),t.getDay(),vL(e)),[iL]:(t,e)=>IL(1,t.getDay(),vL(e))},DL={[QR]:t=>3*t,[eL]:(t,e)=>IL(t,0,vL(e))};function TL(t,e){return AL(t,e||1,ML,DL,xL)}const EL={[JR]:t=>t.getUTCFullYear(),[QR]:t=>Math.floor(t.getUTCMonth()/3),[tL]:t=>t.getUTCMonth(),[nL]:t=>t.getUTCDate(),[rL]:t=>t.getUTCHours(),[oL]:t=>t.getUTCMinutes(),[aL]:t=>t.getUTCSeconds(),milliseconds:t=>t.getUTCMilliseconds(),dayofyear:t=>_L(t),[eL]:t=>kL(t),[iL]:(t,e)=>IL(1,t.getUTCDay(),SL(e)),[eL+iL]:(t,e)=>IL(kL(t),t.getUTCDay(),SL(e))},NL={[QR]:t=>3*t,[eL]:(t,e)=>IL(t,0,SL(e))};function OL(t,e){return AL(t,e||1,EL,NL,CL)}const FL={[JR]:$R,[QR]:LR.every(3),[tL]:LR,[eL]:OR,[nL]:ER,[iL]:ER,dayofyear:ER,[rL]:TR,[oL]:DR,[aL]:MR,milliseconds:IR},RL={[JR]:HR,[QR]:GR.every(3),[tL]:GR,[eL]:WR,[nL]:BR,[iL]:BR,dayofyear:BR,[rL]:zR,[oL]:PR,[aL]:MR,milliseconds:IR};function LL(t){return FL[t]}function $L(t){return RL[t]}function PL(t,e,n){return t?t.offset(e,n):void 0}function zL(t,e,n){return PL(LL(t),e,n)}function BL(t,e,n){return PL($L(t),e,n)}function VL(t,e,n,i){return t?t.range(e,n,i):void 0}function WL(t,e,n,i){return VL(LL(t),e,n,i)}function jL(t,e,n,i){return VL($L(t),e,n,i)}const UL=[JR,tL,nL,rL,oL,aL,"milliseconds"],GL=UL.slice(0,-1),HL=GL.slice(0,-1),qL=HL.slice(0,-1),XL=qL.slice(0,-1),YL=[JR,tL],KL=[JR],ZL=[[GL,1,1e3],[GL,5,5e3],[GL,15,15e3],[GL,30,3e4],[HL,1,6e4],[HL,5,3e5],[HL,15,9e5],[HL,30,18e5],[qL,1,36e5],[qL,3,108e5],[qL,6,216e5],[qL,12,432e5],[XL,1,864e5],[[JR,eL],1,6048e5],[YL,1,2592e6],[YL,3,7776e6],[KL,1,31536e6]];function JL(t){const e=t.extent,n=t.maxbins||40,i=Math.abs(qO(e))/n;let r,o,a=VF((t=>t[2])).right(ZL,i);return a===ZL.length?(r=KL,o=JF(e[0]/31536e6,e[1]/31536e6,n)):a?(a=ZL[i/ZL[a-1][2]<ZL[a][2]/i?a-1:a],r=a[0],o=a[1]):(r=UL,o=Math.max(JF(e[0],e[1],n),1)),{units:r,step:o}}function QL(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function t$(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function e$(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function n$(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,u=f$(r),c=g$(r),h=f$(o),d=g$(o),p=f$(a),f=g$(a),g=f$(s),m=g$(s),y=f$(l),v=g$(l),x={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:L$,e:L$,f:V$,g:J$,G:tP,H:$$,I:P$,j:z$,L:B$,m:W$,M:j$,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:kP,s:SP,S:U$,u:G$,U:H$,V:X$,w:Y$,W:K$,x:null,X:null,y:Z$,Y:Q$,Z:eP,"%":_P},b={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:nP,e:nP,f:sP,g:vP,G:bP,H:iP,I:rP,j:oP,L:aP,m:lP,M:uP,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:kP,s:SP,S:cP,u:hP,U:dP,V:fP,w:gP,W:mP,x:null,X:null,y:yP,Y:xP,Z:wP,"%":_P},w={a:function(t,e,n){var i=p.exec(e.slice(n));return i?(t.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(t,e,n){var i=h.exec(e.slice(n));return i?(t.w=d.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(t,e,n){var i=y.exec(e.slice(n));return i?(t.m=v.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(t,e,n){var i=g.exec(e.slice(n));return i?(t.m=m.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(t,n,i){return S(t,e,n,i)},d:A$,e:A$,f:N$,g:_$,G:w$,H:M$,I:M$,j:I$,L:E$,m:C$,M:D$,p:function(t,e,n){var i=u.exec(e.slice(n));return i?(t.p=c.get(i[0].toLowerCase()),n+i[0].length):-1},q:S$,Q:F$,s:R$,S:T$,u:y$,U:v$,V:x$,w:m$,W:b$,x:function(t,e,i){return S(t,n,e,i)},X:function(t,e,n){return S(t,i,e,n)},y:_$,Y:w$,Z:k$,"%":O$};function _(t,e){return function(n){var i,r,o,a=[],s=-1,l=0,u=t.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===t.charCodeAt(s)&&(a.push(t.slice(l,s)),null!=(r=l$[i=t.charAt(++s)])?i=t.charAt(++s):r="e"===i?" ":"0",(o=e[i])&&(i=o(n,r)),a.push(i),l=s+1);return a.push(t.slice(l,s)),a.join("")}}function k(t,e){return function(n){var i,r,o=e$(1900,void 0,1);if(S(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(r=(i=t$(e$(o.y,0,1))).getUTCDay(),i=r>4||0===r?jR.ceil(i):jR(i),i=BR.offset(i,7*(o.V-1)),o.y=i.getUTCFullYear(),o.m=i.getUTCMonth(),o.d=i.getUTCDate()+(o.w+6)%7):(r=(i=QL(e$(o.y,0,1))).getDay(),i=r>4||0===r?FR.ceil(i):FR(i),i=ER.offset(i,7*(o.V-1)),o.y=i.getFullYear(),o.m=i.getMonth(),o.d=i.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),r="Z"in o?t$(e$(o.y,0,1)).getUTCDay():QL(e$(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(r+5)%7:o.w+7*o.U-(r+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,t$(o)):QL(o)}}function S(t,e,n,i){for(var r,o,a=0,s=e.length,l=n.length;a<s;){if(i>=l)return-1;if(37===(r=e.charCodeAt(a++))){if(r=e.charAt(a++),!(o=w[r in l$?e.charAt(a++):r])||(i=o(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return x.x=_(n,x),x.X=_(i,x),x.c=_(e,x),b.x=_(n,b),b.X=_(i,b),b.c=_(e,b),{format:function(t){var e=_(t+="",x);return e.toString=function(){return t},e},parse:function(t){var e=k(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=_(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=k(t+="",!0);return e.toString=function(){return t},e}}}var i$,r$,o$,a$,s$,l$={"-":"",_:" ",0:"0"},u$=/^\s*\d+/,c$=/^%/,h$=/[\\^$*+?|[\]().{}]/g;function d$(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(e)+r:r)}function p$(t){return t.replace(h$,"\\$&")}function f$(t){return new RegExp("^(?:"+t.map(p$).join("|")+")","i")}function g$(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function m$(t,e,n){var i=u$.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function y$(t,e,n){var i=u$.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function v$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function x$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function b$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function w$(t,e,n){var i=u$.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function _$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function k$(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function S$(t,e,n){var i=u$.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function C$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function A$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function I$(t,e,n){var i=u$.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function M$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function D$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function T$(t,e,n){var i=u$.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function E$(t,e,n){var i=u$.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function N$(t,e,n){var i=u$.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function O$(t,e,n){var i=c$.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function F$(t,e,n){var i=u$.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function R$(t,e,n){var i=u$.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function L$(t,e){return d$(t.getDate(),e,2)}function $$(t,e){return d$(t.getHours(),e,2)}function P$(t,e){return d$(t.getHours()%12||12,e,2)}function z$(t,e){return d$(1+ER.count($R(t),t),e,3)}function B$(t,e){return d$(t.getMilliseconds(),e,3)}function V$(t,e){return B$(t,e)+"000"}function W$(t,e){return d$(t.getMonth()+1,e,2)}function j$(t,e){return d$(t.getMinutes(),e,2)}function U$(t,e){return d$(t.getSeconds(),e,2)}function G$(t){var e=t.getDay();return 0===e?7:e}function H$(t,e){return d$(OR.count($R(t)-1,t),e,2)}function q$(t){var e=t.getDay();return e>=4||0===e?RR(t):RR.ceil(t)}function X$(t,e){return t=q$(t),d$(RR.count($R(t),t)+(4===$R(t).getDay()),e,2)}function Y$(t){return t.getDay()}function K$(t,e){return d$(FR.count($R(t)-1,t),e,2)}function Z$(t,e){return d$(t.getFullYear()%100,e,2)}function J$(t,e){return d$((t=q$(t)).getFullYear()%100,e,2)}function Q$(t,e){return d$(t.getFullYear()%1e4,e,4)}function tP(t,e){var n=t.getDay();return d$((t=n>=4||0===n?RR(t):RR.ceil(t)).getFullYear()%1e4,e,4)}function eP(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+d$(e/60|0,"0",2)+d$(e%60,"0",2)}function nP(t,e){return d$(t.getUTCDate(),e,2)}function iP(t,e){return d$(t.getUTCHours(),e,2)}function rP(t,e){return d$(t.getUTCHours()%12||12,e,2)}function oP(t,e){return d$(1+BR.count(HR(t),t),e,3)}function aP(t,e){return d$(t.getUTCMilliseconds(),e,3)}function sP(t,e){return aP(t,e)+"000"}function lP(t,e){return d$(t.getUTCMonth()+1,e,2)}function uP(t,e){return d$(t.getUTCMinutes(),e,2)}function cP(t,e){return d$(t.getUTCSeconds(),e,2)}function hP(t){var e=t.getUTCDay();return 0===e?7:e}function dP(t,e){return d$(WR.count(HR(t)-1,t),e,2)}function pP(t){var e=t.getUTCDay();return e>=4||0===e?UR(t):UR.ceil(t)}function fP(t,e){return t=pP(t),d$(UR.count(HR(t),t)+(4===HR(t).getUTCDay()),e,2)}function gP(t){return t.getUTCDay()}function mP(t,e){return d$(jR.count(HR(t)-1,t),e,2)}function yP(t,e){return d$(t.getUTCFullYear()%100,e,2)}function vP(t,e){return d$((t=pP(t)).getUTCFullYear()%100,e,2)}function xP(t,e){return d$(t.getUTCFullYear()%1e4,e,4)}function bP(t,e){var n=t.getUTCDay();return d$((t=n>=4||0===n?UR(t):UR.ceil(t)).getUTCFullYear()%1e4,e,4)}function wP(){return"+0000"}function _P(){return"%"}function kP(t){return+t}function SP(t){return Math.floor(+t/1e3)}function CP(t){const e={};return n=>e[n]||(e[n]=t(n))}function AP(t){const e=CP(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){const n=pR(t||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return i=e(n),r=e(".1f")(1)[1],t=>{const e=i(t),n=e.indexOf(r);if(n<0)return e;let o=function(t,e){let n,i=t.lastIndexOf("e");if(i>0)return i;for(i=t.length;--i>e;)if(n=t.charCodeAt(i),n>=48&&n<=57)return i+1}(e,n);const a=o<e.length?e.slice(o):"";for(;--o>n;)if("0"!==e[o]){++o;break}return e.slice(0,o)+a}}return e(n);var i,r},formatSpan(t,i,r,o){o=pR(null==o?",f":o);const a=JF(t,i,r),s=Math.max(Math.abs(t),Math.abs(i));let l;if(null==o.precision)switch(o.type){case"s":return isNaN(l=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(cR(e)/3)))-cR(Math.abs(t)))}(a,s))||(o.precision=l),n(o,s);case"":case"e":case"g":case"p":case"r":isNaN(l=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,cR(e)-cR(t))+1}(a,s))||(o.precision=l-("e"===o.type));break;case"f":case"%":isNaN(l=function(t){return Math.max(0,-cR(Math.abs(t)))}(a))||(o.precision=l-2*("%"===o.type))}return e(o)}}}let IP,MP;function DP(){return IP=AP({format:xR,formatPrefix:bR})}function TP(t){return AP(kR(t))}function EP(t){return arguments.length?IP=TP(t):IP}function NP(t,e,n){GN(n=n||{})||ON("Invalid time multi-format specifier: ".concat(n));const i=e(aL),r=e(oL),o=e(rL),a=e(nL),s=e(eL),l=e(tL),u=e(QR),c=e(JR),h=t(n.milliseconds||".%L"),d=t(n.seconds||":%S"),p=t(n.minutes||"%I:%M"),f=t(n.hours||"%I %p"),g=t(n.date||n.day||"%a %d"),m=t(n.week||"%b %d"),y=t(n.month||"%B"),v=t(n.quarter||"%B"),x=t(n.year||"%Y");return t=>(i(t)<t?h:r(t)<t?d:o(t)<t?p:a(t)<t?f:l(t)<t?s(t)<t?g:m:c(t)<t?u(t)<t?y:v:x)(t)}function OP(t){const e=CP(t.format),n=CP(t.utcFormat);return{timeFormat:t=>BO(t)?e(t):NP(e,LL,t),utcFormat:t=>BO(t)?n(t):NP(n,$L,t),timeParse:CP(t.parse),utcParse:CP(t.utcParse)}}function FP(){return MP=OP({format:r$,parse:o$,utcFormat:a$,utcParse:s$})}function RP(t){return OP(n$(t))}function LP(t){return arguments.length?MP=RP(t):MP}!function(t){i$=n$(t),r$=i$.format,o$=i$.parse,a$=i$.utcFormat,s$=i$.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),DP(),FP();const $P=(t,e)=>CO({},t,e);function PP(t,e){const n=t?TP(t):EP(),i=e?RP(e):LP();return $P(n,i)}function zP(t,e){const n=arguments.length;return n&&2!==n&&ON("defaultLocale expects either zero or two arguments."),n?$P(EP(t),LP(e)):$P(EP(),LP())}function BP(t,e,n,i){const r=PF((e=e||{}).type||"json");return r||ON("Unknown data format type: "+e.type),t=r(t,e),e.parse&&function(t,e,n,i){if(!t.length)return;const r=LP();n=n||r.timeParse,i=i||r.utcParse;let o,a,s,l,u,c,h=t.columns||Object.keys(t[0]);"auto"===e&&(e=mF(t,h));h=Object.keys(e);const d=h.map((t=>{const r=e[t];let o,a;if(r&&(r.startsWith("date:")||r.startsWith("utc:"))){o=r.split(/:(.+)?/,2),a=o[1],("'"===a[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1));return("utc"===o[0]?i:n)(a)}if(!dF[r])throw Error("Illegal format pattern: "+t+":"+r);return dF[r]}));for(s=0,u=t.length,c=h.length;s<u;++s)for(o=t[s],l=0;l<c;++l)a=h[l],o[a]=d[l](o[a])}(t,e.parse,n,i),DO(t,"columns")&&delete t.columns,t}const VP=(WP="undefined"!=typeof fetch&&fetch,jP=null,t=>({options:t||{},sanitize:aF,load:oF,fileAccess:!!jP,file:sF(jP),http:uF(WP)}));var WP,jP;function UP(t){const e=t||$N,n=[],i={};return n.add=t=>{const r=e(t);return i[r]||(i[r]=1,n.push(t)),n},n.remove=t=>{const r=e(t);if(i[r]){i[r]=0;const e=n.indexOf(t);e>=0&&n.splice(e,1)}return n},n}async function GP(t,e){try{await e(t)}catch(e){t.error(e)}}const HP=Symbol("vega_id");let qP=1;function XP(t){return!(!t||!YP(t))}function YP(t){return t[HP]}function KP(t,e){return t[HP]=e,t}function ZP(t){const e=t===Object(t)?t:{data:t};return YP(e)?e:KP(e,qP++)}function JP(t){return QP(t,ZP({}))}function QP(t,e){for(const n in t)e[n]=t[n];return e}function tz(t,e){return KP(e,YP(t))}function ez(t,e){return t?e?(n,i)=>t(n,i)||YP(e(n))-YP(e(i)):(e,n)=>t(e,n)||YP(e)-YP(n):null}function nz(t){return t&&t.constructor===iz}function iz(){const t=[],e=[],n=[],i=[],r=[];let o=null,a=!1;return{constructor:iz,insert(e){const n=gO(e),i=n.length;for(let e=0;e<i;++e)t.push(n[e]);return this},remove(t){const n=yO(t)?i:e,r=gO(t),o=r.length;for(let t=0;t<o;++t)n.push(r[t]);return this},modify(t,e,i){const o={field:e,value:kO(i)};return yO(t)?(o.filter=t,r.push(o)):(o.tuple=t,n.push(o)),this},encode(t,e){return yO(t)?r.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean(t){return o=t,this},reflow(){return a=!0,this},pulse(s,l){const u={},c={};let h,d,p,f,g,m;for(h=0,d=l.length;h<d;++h)u[YP(l[h])]=1;for(h=0,d=e.length;h<d;++h)g=e[h],u[YP(g)]=-1;for(h=0,d=i.length;h<d;++h)f=i[h],l.forEach((t=>{f(t)&&(u[YP(t)]=-1)}));for(h=0,d=t.length;h<d;++h)g=t[h],m=YP(g),u[m]?u[m]=1:s.add.push(ZP(t[h]));for(h=0,d=l.length;h<d;++h)g=l[h],u[YP(g)]<0&&s.rem.push(g);function y(t,e,n){n?t[e]=n(t):s.encode=e,a||(c[YP(t)]=t)}for(h=0,d=n.length;h<d;++h)p=n[h],g=p.tuple,f=p.field,m=u[YP(g)],m>0&&(y(g,f,p.value),s.modifies(f));for(h=0,d=r.length;h<d;++h)p=r[h],f=p.filter,l.forEach((t=>{f(t)&&u[YP(t)]>0&&y(t,p.field,p.value)})),s.modifies(p.field);if(a)s.mod=e.length||i.length?l.filter((t=>u[YP(t)]>0)):l.slice();else for(m in c)s.mod.push(c[m]);return(o||null==o&&(e.length||i.length))&&s.clean(!0),s}}}function rz(){Object.defineProperty(this,"_:mod:_",{writable:!0,value:{}})}rz.prototype={set(t,e,n,i){const r=this,o=r[t],a=r["_:mod:_"];return null!=e&&e>=0?(o[e]!==n||i)&&(o[e]=n,a[e+":"+t]=-1,a[t]=-1):(o!==n||i)&&(r[t]=n,a[t]=UN(n)?1+n.length:-1),r},modified(t,e){const n=this["_:mod:_"];if(!arguments.length){for(const t in n)if(n[t])return!0;return!1}if(UN(t)){for(let e=0;e<t.length;++e)if(n[t[e]])return!0;return!1}return null!=e&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this["_:mod:_"]={},this}};let oz=0;const az=new rz;function sz(t,e,n,i){this.id=++oz,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,i)}function lz(t){return function(e){const n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}sz.prototype={targets(){return this._targets||(this._targets=UP(LN))},set(t){return this.value!==t?(this.value=t,1):0},skip:lz(1),modified:lz(2),parameters(t,e,n){e=!1!==e;const i=this._argval=this._argval||new rz,r=this._argops=this._argops||[],o=[];let a,s,l,u;const c=(t,n,a)=>{a instanceof sz?(a!==this&&(e&&a.targets().add(this),o.push(a)),r.push({op:a,name:t,index:n})):i.set(t,n,a)};for(a in t)if(s=t[a],"pulse"===a)gO(s).forEach((t=>{t instanceof sz?t!==this&&(t.targets().add(this),o.push(t)):ON("Pulse parameters must be operator instances.")})),this.source=s;else if(UN(s))for(i.set(a,-1,Array(l=s.length)),u=0;u<l;++u)c(a,u,s[u]);else c(a,-1,s);return this.marshall().clear(),n&&(r.initonly=!0),o},marshall(t){const e=this._argval||az,n=this._argops;let i,r,o,a;if(n){const s=n.length;for(r=0;r<s;++r)i=n[r],o=i.op,a=o.modified()&&o.stamp===t,e.set(i.name,i.index,o.value,a);if(n.initonly){for(r=0;r<s;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,i,r;if(t)for(e=0,n=t.length;e<n;++e)i=t[e],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),i=e.call(this,n,t);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};let uz=0;function cz(t,e,n){this.id=++uz,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function hz(t,e,n){return new cz(t,e,n)}cz.prototype={_filter:BN,_apply:$N,targets(){return this._targets||(this._targets=UP(LN))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,i=n?n.length:0;for(let t=0;t<i;++t)n[t].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=hz(t);return this.targets().add(e),e},apply(t){const e=hz(null,t);return this.targets().add(e),e},merge(){const t=hz();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter((()=>{const n=Date.now();return n-e>t?(e=n,1):0}))},debounce(t){const e=hz();return this.targets().add(hz(null,null,SO(t,(t=>{const n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},between(t,e){let n=!1;return t.targets().add(hz(null,null,(()=>n=!0))),e.targets().add(hz(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=BN,this._targets=null}};const dz={skip:!0};function pz(t,e,n,i,r,o){const a=CO({},o,dz);let s,l;yO(n)||(n=kO(n)),void 0===i?s=e=>t.touch(n(e)):yO(i)?(l=new sz(null,i,r,!1),s=e=>{l.evaluate(e);const i=n(e),r=l.value;nz(r)?t.pulse(i,r,o):t.update(i,r,a)}):s=e=>t.update(n(e),i,a),e.apply(s)}function fz(t,e,n,i,r,o){if(void 0===i)e.targets().add(n);else{const a=o||{},s=new sz(null,function(t,e){return e=yO(e)?e:kO(e),t?function(n,i){const r=e(n,i);return t.skip()||(t.skip(r!==this.value).value=r),r}:e}(n,i),r,!1);s.modified(a.force),s.rank=e.rank,e.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),t.connect(n,[s]))}}const gz={};function mz(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function yz(t,e){const n=[];return eF(t,e,(t=>n.push(t))),n}function vz(t,e){const n={};return t.visit(e,(t=>{n[YP(t)]=1})),t=>n[YP(t)]?null:t}function xz(t,e){return t?(n,i)=>t(n,i)&&e(n,i):e}function bz(t,e,n,i){const r=this,o=n.length;let a=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=i||null,this.pulses=n;for(let t=0;t<o;++t){const i=n[t];if(i.stamp===e){if(i.fields){const t=r.fields||(r.fields={});for(const e in i.fields)t[e]=1}i.changed(r.ADD)&&(a|=r.ADD),i.changed(r.REM)&&(a|=r.REM),i.changed(r.MOD)&&(a|=r.MOD)}}this.changes=a}function wz(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}mz.prototype={StopPropagation:gz,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(t){return new mz(this.dataflow).init(this,t)},clone(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new mz(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},reflow(t){if(t)return this.fork(7).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,vz(this,1))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return UN(t)?t.forEach((t=>e[t]=!0)):e[t]=!0,this},modified(t,e){const n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?UN(t)?t.some((t=>n[t])):n[t]:!!n)},filter(t,e){const n=this;return 1&t&&(n.addF=xz(n.addF,e)),2&t&&(n.remF=xz(n.remF,e)),4&t&&(n.modF=xz(n.modF,e)),16&t&&(n.srcF=xz(n.srcF,e)),n},materialize(t){const e=this;return 1&(t=t||7)&&e.addF&&(e.add=yz(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=yz(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=yz(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,i=e;if(16&t)return eF(n.source,n.srcF,i),n;1&t&&eF(n.add,n.addF,i),2&t&&eF(n.rem,n.remF,i),4&t&&eF(n.mod,n.modF,i);const r=n.source;if(8&t&&r){const t=n.add.length+n.mod.length;t===r.length||eF(r,t?vz(n,5):n.srcF,i)}return n}},OO(bz,mz,{fork(t){const e=new mz(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(t=>e.add.push(t))),t&e.REM&&this.visit(e.REM,(t=>e.rem.push(t))),t&e.MOD&&this.visit(e.MOD,(t=>e.mod.push(t)))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?UN(t)?t.some((t=>n[t])):n[t]:0},filter(){ON("MultiPulse does not support filtering.")},materialize(){ON("MultiPulse does not support materialization.")},visit(t,e){const n=this,i=n.pulses,r=i.length;let o=0;if(t&n.SOURCE)for(;o<r;++o)i[o].visit(t,e);else for(;o<r;++o)i[o].stamp===n.stamp&&i[o].visit(t,e);return n}});const _z={skip:!1,force:!1};function kz(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),Sz(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let i;return e.length?(i=e[0],e[0]=n,function(t,e,n){const i=e,r=t.length,o=t[e];let a,s=1+(e<<1);for(;s<r;)a=s+1,a<r&&n(t[s],t[a])>=0&&(s=a),t[e]=t[s],s=1+((e=s)<<1);t[e]=o,Sz(t,i,e,n)}(e,0,t)):i=n,i}}}function Sz(t,e,n,i){let r,o;const a=t[n];for(;n>e&&(o=n-1>>1,r=t[o],i(a,r)<0);)t[n]=r,n=o;return t[n]=a}function Cz(){this.logger(jN()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=zP();try{this._loader=VP()}catch(t){}this._touched=UP(LN),this._input={},this._pulse=null,this._heap=kz(((t,e)=>t.qrank-e.qrank)),this._postrun=[]}function Az(t){return function(){return this._log[t].apply(this,arguments)}}function Iz(t,e){sz.call(this,t,null,e)}Cz.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:Az("error"),warn:Az("warn"),info:Az("info"),debug:Az("debug"),logLevel:Az("level"),cleanThreshold:1e4,add:function(t,e,n,i){let r,o=1;return t instanceof sz?r=t:t&&t.prototype instanceof sz?r=new t:yO(t)?r=new sz(null,t):(o=0,r=new sz(t,e)),this.rank(r),o&&(i=n,n=e),n&&this.connect(r,r.parameters(n,i)),this.touch(r),r},connect:function(t,e){const n=t.rank,i=e.length;for(let r=0;r<i;++r)if(n<e[r].rank)return void this.rerank(t)},rank:function(t){t.rank=++this._rank},rerank:function(t){const e=[t];let n,i,r;for(;e.length;)if(this.rank(n=e.pop()),i=n._targets)for(r=i.length;--r>=0;)e.push(n=i[r]),n===t&&ON("Cycle detected in dataflow graph.")},pulse:function(t,e,n){this.touch(t,n||_z);const i=new mz(this,this._clock+(this._pulse?0:1)),r=t.pulse&&t.pulse.source||[];return i.target=t,this._input[t.id]=e.pulse(i,r),this},touch:function(t,e){const n=e||_z;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},update:function(t,e,n){const i=n||_z;return(t.set(e)||i.force)&&this.touch(t,i),this},changeset:iz,ingest:function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},parse:function(t,e){const n=this.locale();return BP(t,e,n.timeParse,n.utcParse)},preload:async function(t,e,n){const i=this,r=i._pending||function(t){let e;const n=new Promise((t=>e=t));return n.requests=0,n.done=()=>{0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(i);r.requests+=1;const o=await i.request(e,n);return i.pulse(t,i.changeset().remove(BN).insert(o.data||[])),r.done(),o},request:async function(t,e){const n=this;let i,r=0;try{i=await n.loader().load(t,{context:"dataflow",response:zF(e&&e.type)});try{i=n.parse(i,e)}catch(e){r=-2,n.warn("Data ingestion failed",t,e)}}catch(e){r=-1,n.warn("Loading failed",t,e)}return{data:i,status:r}},events:function(t,e,n,i){const r=this,o=hz(n,i),a=function(t){t.dataflow=r;try{o.receive(t)}catch(t){r.error(t)}finally{r.run()}};let s;s="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):gO(t);const l=s.length;for(let t=0;t<l;++t)s[t].addEventListener(e,a);return o},on:function(t,e,n,i,r){return(t instanceof sz?fz:pz)(this,t,e,n,i,r),this},evaluate:async function(t,e,n){const i=this,r=[];if(i._pulse)return wz(i);if(i._pending&&await i._pending,e&&await GP(i,e),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const o=++i._clock;i._pulse=new mz(i,o,t),i._touched.forEach((t=>i._enqueue(t,!0))),i._touched=UP(LN);let a,s,l,u=0;try{for(;i._heap.size()>0;)a=i._heap.pop(),a.rank===a.qrank?(s=a.run(i._getPulse(a,t)),s.then?s=await s:s.async&&(r.push(s.async),s=gz),s!==gz&&a._targets&&a._targets.forEach((t=>i._enqueue(t))),++u):i._enqueue(a,!0)}catch(t){i._heap.clear(),l=t}if(i._input={},i._pulse=null,i.debug(`Pulse ${o}: ${u} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const t=i._postrun.sort(((t,e)=>e.priority-t.priority));i._postrun=[];for(let e=0;e<t.length;++e)await GP(i,t[e].callback)}return n&&await GP(i,n),r.length&&Promise.all(r).then((t=>i.runAsync(null,(()=>{t.forEach((t=>{try{t(i)}catch(t){i.error(t)}}))})))),i},run:function(t,e,n){return this._pulse?wz(this):(this.evaluate(t,e,n),this)},runAsync:async function(t,e,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(i,i),this._running},runAfter:function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},_enqueue:function(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},_getPulse:function(t,e){const n=t.source,i=this._clock;return n&&UN(n)?new bz(this,i,n.map((t=>t.pulse)),e):this._input[t.id]||function(t,e){if(e&&e.stamp===t.stamp)return e;t=t.fork(),e&&e!==gz&&(t.source=e.source);return t}(this._pulse,n&&n.pulse)}},OO(Iz,sz,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then((t=>this.pulse=t)):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const Mz={};function Dz(t){const e=Tz(t);return e&&e.Definition||null}function Tz(t){return t=t&&t.toLowerCase(),DO(Mz,t)?Mz[t]:null}function*Ez(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)i=e(i,++n,t),null!=i&&""!==i&&(i=+i)>=i&&(yield i)}}function Nz(t,e,n){const i=Float64Array.from(Ez(t,n));return i.sort(BF),e.map((t=>rR(i,t)))}function Oz(t,e){return Nz(t,[.25,.5,.75],e)}function Fz(t,e){const n=t.length,i=function(t,e){const n=function(t,e){let n,i=0,r=0,o=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-r,r+=n/++i,o+=n*(e-r));else{let a=-1;for(let s of t)null!=(s=e(s,++a,t))&&(s=+s)>=s&&(n=s-r,r+=n/++i,o+=n*(s-r))}if(i>1)return o/(i-1)}(t,e);return n?Math.sqrt(n):n}(t,e),r=Oz(t,e),o=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,o)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function Rz(t){const e=t.maxbins||20,n=t.base||10,i=Math.log(n),r=t.divide||[5,2];let o,a,s,l,u,c,h=t.extent[0],d=t.extent[1];const p=t.span||d-h||Math.abs(h)||1;if(t.step)o=t.step;else if(t.steps){for(l=p/e,u=0,c=t.steps.length;u<c&&t.steps[u]<l;++u);o=t.steps[Math.max(0,u-1)]}else{for(a=Math.ceil(Math.log(e)/i),s=t.minstep||0,o=Math.max(s,Math.pow(n,Math.round(Math.log(p)/i)-a));Math.ceil(p/o)>e;)o*=n;for(u=0,c=r.length;u<c;++u)l=o/r[u],l>=s&&p/l<=e&&(o=l)}l=Math.log(o);const f=l>=0?0:1+~~(-l/i),g=Math.pow(n,-f-1);return(t.nice||void 0===t.nice)&&(l=Math.floor(h/o+g)*o,h=h<l?l-o:l,d=Math.ceil(d/o)*o),{start:h,stop:d===h?h+o:d,step:o}}var Lz=Math.random;function $z(t,e,n,i){if(!t.length)return[void 0,void 0];const r=Float64Array.from(Ez(t,i)),o=r.length,a=e;let s,l,u,c;for(u=0,c=Array(a);u<a;++u){for(s=0,l=0;l<o;++l)s+=r[~~(Lz()*o)];c[u]=s/o}return c.sort(BF),[iR(c,n/2),iR(c,1-n/2)]}function Pz(t,e,n,i){i=i||(t=>t);const r=t.length,o=new Float64Array(r);let a,s=0,l=1,u=i(t[0]),c=u,h=u+e;for(;l<r;++l){if(a=i(t[l]),a>=h){for(c=(u+c)/2;s<l;++s)o[s]=c;h=a+e,u=a}c=a}for(c=(u+c)/2;s<l;++s)o[s]=c;return n?function(t,e){const n=t.length;let i,r,o=0,a=1;for(;t[o]===t[a];)++a;for(;a<n;){for(i=a+1;t[a]===t[i];)++i;if(t[a]-t[a-1]<e){for(r=a+(o+i-a-a>>1);r<a;)t[r++]=t[a];for(;r>a;)t[r--]=t[o]}o=a,a=i}return t}(o,e+e/4):o}const zz=Math.sqrt(2*Math.PI),Bz=Math.SQRT2;let Vz=NaN;function Wz(t,e){t=t||0,e=null==e?1:e;let n,i,r=0,o=0;if(Vz==Vz)r=Vz,Vz=NaN;else{do{r=2*Lz()-1,o=2*Lz()-1,n=r*r+o*o}while(0===n||n>1);i=Math.sqrt(-2*Math.log(n)/n),r*=i,Vz=o*i}return t+r*e}function jz(t,e,n){const i=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*zz)}function Uz(t,e,n){const i=(t-(e=e||0))/(n=null==n?1:n),r=Math.abs(i);let o;if(r>37)o=0;else{const t=Math.exp(-r*r/2);let e;r<7.07106781186547?(e=.0352624965998911*r+.700383064443688,e=e*r+6.37396220353165,e=e*r+33.912866078383,e=e*r+112.079291497871,e=e*r+221.213596169931,e=e*r+220.206867912376,o=t*e,e=.0883883476483184*r+1.75566716318264,e=e*r+16.064177579207,e=e*r+86.7807322029461,e=e*r+296.564248779674,e=e*r+637.333633378831,e=e*r+793.826512519948,e=e*r+440.413735824752,o/=e):(e=r+.65,e=r+4/e,e=r+3/e,e=r+2/e,e=r+1/e,o=t/e/2.506628274631)}return i>0?1-o:o}function Gz(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*Bz*function(t){let e,n=-Math.log((1-t)*(1+t));n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0;return e*t}(2*t-1)}function Hz(t,e){let n,i;const r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>Wz(n,i),pdf:t=>jz(t,n,i),cdf:t=>Uz(t,n,i),icdf:t=>Gz(t,n,i)};return r.mean(t).stdev(e)}function qz(t,e){const n=Hz();let i=0;const r={data(n){return arguments.length?(t=n,i=n?n.length:0,r.bandwidth(e)):t},bandwidth(n){return arguments.length?(!(e=n)&&t&&(e=Fz(t)),r):e},sample:()=>t[~~(Lz()*i)]+e*n.sample(),pdf(r){let o=0,a=0;for(;a<i;++a)o+=n.pdf((r-t[a])/e);return o/e/i},cdf(r){let o=0,a=0;for(;a<i;++a)o+=n.cdf((r-t[a])/e);return o/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(t)}function Xz(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+Wz()*e)}function Yz(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const i=(Math.log(t)-e)/n;return Math.exp(-.5*i*i)/(n*zz*t)}function Kz(t,e,n){return Uz(Math.log(t),e,n)}function Zz(t,e,n){return Math.exp(Gz(t,e,n))}function Jz(t,e){let n,i;const r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>Xz(n,i),pdf:t=>Yz(t,n,i),cdf:t=>Kz(t,n,i),icdf:t=>Zz(t,n,i)};return r.mean(t).stdev(e)}function Qz(t,e){let n,i=0;const r={weights(t){return arguments.length?(n=function(t){const e=[];let n,r=0;for(n=0;n<i;++n)r+=e[n]=null==t[n]?1:+t[n];for(n=0;n<i;++n)e[n]/=r;return e}(e=t||[]),r):e},distributions(n){return arguments.length?(n?(i=n.length,t=n):(i=0,t=[]),r.weights(e)):t},sample(){const e=Lz();let r=t[i-1],o=n[0],a=0;for(;a<i-1;o+=n[++a])if(e<o){r=t[a];break}return r.sample()},pdf(e){let r=0,o=0;for(;o<i;++o)r+=n[o]*t[o].pdf(e);return r},cdf(e){let r=0,o=0;for(;o<i;++o)r+=n[o]*t[o].cdf(e);return r},icdf(){throw Error("Mixture icdf not supported.")}};return r.distributions(t).weights(e)}function tB(t,e){return null==e&&(e=null==t?1:t,t=0),t+(e-t)*Lz()}function eB(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function nB(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function iB(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function rB(t,e){let n,i;const r={min(t){return arguments.length?(n=t||0,r):n},max(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>tB(n,i),pdf:t=>eB(t,n,i),cdf:t=>nB(t,n,i),icdf:t=>iB(t,n,i)};return null==e&&(e=null==t?1:t,t=0),r.min(t).max(e)}function oB(t,e,n,i){const r=i-t*t,o=Math.abs(r)<1e-24?0:(n-t*e)/r;return[e-o*t,o]}function aB(t,e,n,i){t=t.filter((t=>{let i=e(t),r=n(t);return null!=i&&(i=+i)>=i&&null!=r&&(r=+r)>=r})),i&&t.sort(((t,n)=>e(t)-e(n)));const r=t.length,o=new Float64Array(r),a=new Float64Array(r);let s,l,u,c=0,h=0,d=0;for(u of t)o[c]=s=+e(u),a[c]=l=+n(u),++c,h+=(s-h)/c,d+=(l-d)/c;for(c=0;c<r;++c)o[c]-=h,a[c]-=d;return[o,a,h,d]}function sB(t,e,n,i){let r,o,a=-1;for(const s of t)r=e(s),o=n(s),null!=r&&(r=+r)>=r&&null!=o&&(o=+o)>=o&&i(r,o,++a)}function lB(t,e,n,i,r){let o=0,a=0;return sB(t,e,n,((t,e)=>{const n=e-r(t),s=e-i;o+=n*n,a+=s*s})),1-o/a}function uB(t,e,n){let i=0,r=0,o=0,a=0,s=0;sB(t,e,n,((t,e)=>{++s,i+=(t-i)/s,r+=(e-r)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const l=oB(i,r,o,a),u=t=>l[0]+l[1]*t;return{coef:l,predict:u,rSquared:lB(t,e,n,r,u)}}function cB(t,e,n){let i=0,r=0,o=0,a=0,s=0;sB(t,e,n,((t,e)=>{++s,t=Math.log(t),i+=(t-i)/s,r+=(e-r)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const l=oB(i,r,o,a),u=t=>l[0]+l[1]*Math.log(t);return{coef:l,predict:u,rSquared:lB(t,e,n,r,u)}}function hB(t,e,n){const[i,r,o,a]=aB(t,e,n);let s,l,u,c=0,h=0,d=0,p=0,f=0;sB(t,e,n,((t,e)=>{s=i[f++],l=Math.log(e),u=s*e,c+=(e*l-c)/f,h+=(u-h)/f,d+=(u*l-d)/f,p+=(s*u-p)/f}));const[g,m]=oB(h/a,c/a,d/a,p/a),y=t=>Math.exp(g+m*(t-o));return{coef:[Math.exp(g-m*o),m],predict:y,rSquared:lB(t,e,n,a,y)}}function dB(t,e,n){let i=0,r=0,o=0,a=0,s=0,l=0;sB(t,e,n,((t,e)=>{const n=Math.log(t),u=Math.log(e);++l,i+=(n-i)/l,r+=(u-r)/l,o+=(n*u-o)/l,a+=(n*n-a)/l,s+=(e-s)/l}));const u=oB(i,r,o,a),c=t=>u[0]*Math.pow(t,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:lB(t,e,n,s,c)}}function pB(t,e,n){const[i,r,o,a]=aB(t,e,n),s=i.length;let l,u,c,h,d=0,p=0,f=0,g=0,m=0;for(l=0;l<s;)u=i[l],c=r[l++],h=u*u,d+=(h-d)/l,p+=(h*u-p)/l,f+=(h*h-f)/l,g+=(u*c-g)/l,m+=(h*c-m)/l;const y=f-d*d,v=d*y-p*p,x=(m*d-g*p)/v,b=(g*y-m*p)/v,w=-x*d,_=t=>x*(t-=o)*t+b*t+w+a;return{coef:[w-b*o+x*o*o+a,b-2*x*o,x],predict:_,rSquared:lB(t,e,n,a,_)}}function fB(t,e,n,i){if(1===i)return uB(t,e,n);if(2===i)return pB(t,e,n);const[r,o,a,s]=aB(t,e,n),l=r.length,u=[],c=[],h=i+1;let d,p,f,g,m;for(d=0;d<h;++d){for(f=0,g=0;f<l;++f)g+=Math.pow(r[f],d)*o[f];for(u.push(g),m=new Float64Array(h),p=0;p<h;++p){for(f=0,g=0;f<l;++f)g+=Math.pow(r[f],d+p);m[p]=g}c.push(m)}c.push(u);const y=function(t){const e=t.length-1,n=[];let i,r,o,a,s;for(i=0;i<e;++i){for(a=i,r=i+1;r<e;++r)Math.abs(t[i][r])>Math.abs(t[i][a])&&(a=r);for(o=i;o<e+1;++o)s=t[o][i],t[o][i]=t[o][a],t[o][a]=s;for(r=i+1;r<e;++r)for(o=e;o>=i;o--)t[o][r]-=t[o][i]*t[i][r]/t[i][i]}for(r=e-1;r>=0;--r){for(s=0,o=r+1;o<e;++o)s+=t[o][r]*n[o];n[r]=(t[e][r]-s)/t[r][r]}return n}(c),v=t=>{t-=a;let e=s+y[0]+y[1]*t+y[2]*t*t;for(d=3;d<h;++d)e+=y[d]*Math.pow(t,d);return e};return{coef:gB(h,y,-a,s),predict:v,rSquared:lB(t,e,n,s,v)}}function gB(t,e,n,i){const r=Array(t);let o,a,s,l;for(o=0;o<t;++o)r[o]=0;for(o=t-1;o>=0;--o)for(s=e[o],l=1,r[o]+=s,a=1;a<=o;++a)l*=(o+1-a)/a,r[o-a]+=s*Math.pow(n,a)*l;return r[0]+=i,r}function mB(t,e,n,i){const[r,o,a,s]=aB(t,e,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),h=new Float64Array(l),d=new Float64Array(l).fill(1);for(let t=-1;++t<=2;){const e=[0,u-1];for(let t=0;t<l;++t){const n=r[t],i=e[0],a=e[1],s=n-r[i]>r[a]-n?i:a;let l=0,u=0,p=0,f=0,g=0;const m=1/Math.abs(r[s]-n||1);for(let t=i;t<=a;++t){const e=r[t],i=o[t],a=yB(Math.abs(n-e)*m)*d[t],s=e*a;l+=a,u+=s,p+=i*a,f+=i*s,g+=e*s}const[y,v]=oB(u/l,p/l,f/l,g/l);c[t]=y+v*n,h[t]=Math.abs(o[t]-c[t]),vB(r,t+1,e)}if(2===t)break;const n=oR(h);if(Math.abs(n)<1e-12)break;for(let t,e,i=0;i<l;++i)t=h[i]/(6*n),d[i]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,i){const r=t.length,o=[];let a,s=0,l=0,u=[];for(;s<r;++s)a=t[s]+n,u[0]===a?u[1]+=(e[s]-u[1])/++l:(l=0,u[1]+=i,u=[a,e[s]],o.push(u));return u[1]+=i,o}(r,c,a,s)}function yB(t){return(t=1-t*t*t)*t*t}function vB(t,e,n){const i=t[e];let r=n[0],o=n[1]+1;if(!(o>=t.length))for(;e>r&&t[o]-i<=i-t[r];)n[0]=++r,n[1]=o,++o}const xB=.1*Math.PI/180;function bB(t,e,n,i){n=n||25,i=Math.max(n,i||200);const r=e=>[e,t(e)],o=e[0],a=e[1],s=a-o,l=s/i,u=[r(o)],c=[];if(n===i){for(let t=1;t<i;++t)u.push(r(o+t/n*s));return u.push(r(a)),u}c.push(r(a));for(let t=n;--t>0;)c.push(r(o+t/n*s));let h=u[0],d=c[c.length-1];for(;d;){const t=r((h[0]+d[0])/2);t[0]-h[0]>=l&&wB(h,t,d)>xB?c.push(t):(h=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function wB(t,e,n){const i=Math.atan2(n[1]-t[1],n[0]-t[0]),r=Math.atan2(e[1]-t[1],e[0]-t[0]);return Math.abs(i-r)}function _B(t){return t&&t.length?1===t.length?t[0]:(e=t,t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}):function(){return""};var e}function kB(t,e,n){return n||t+(e?"_"+e:"")}const SB=()=>{},CB={init:SB,add:SB,rem:SB,idx:0},AB={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3}},IB=Object.keys(AB);function MB(t,e){return AB[t](e)}function DB(t,e){return t.idx-e.idx}function TB(){this.valid=0,this.missing=0,this._ops.forEach((t=>t.init(this)))}function EB(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach((n=>n.add(this,t,e)))):++this.missing}function NB(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach((n=>n.rem(this,t,e)))):--this.missing}function OB(t){return this._out.forEach((e=>t[e.out]=e.value(this))),t}function FB(t,e){const n=e||$N,i=function(t){const e={};t.forEach((t=>e[t.name]=t));const n=t=>{t.req&&t.req.forEach((t=>{e[t]||n(e[t]=AB[t]())}))};return t.forEach(n),Object.values(e).sort(DB)}(t),r=t.slice().sort(DB);function o(t){this._ops=i,this._out=r,this.cell=t,this.init()}return o.prototype.init=TB,o.prototype.add=EB,o.prototype.rem=NB,o.prototype.set=OB,o.prototype.get=n,o.fields=t.map((t=>t.out)),o}function RB(t){this._key=t?RN(t):YP,this.reset()}IB.forEach((t=>{AB[t]=function(t,e){return n=>CO({name:t,out:n||t},CB,e)}(t,AB[t])}));const LB=RB.prototype;function $B(t){Iz.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}LB.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},LB.add=function(t){this._add.push(t)},LB.rem=function(t){this._rem.push(t)},LB.values=function(){if(this._get=null,0===this._rem.length)return this._add;const t=this._add,e=this._rem,n=this._key,i=t.length,r=e.length,o=Array(i-r),a={};let s,l,u;for(s=0;s<r;++s)a[n(e[s])]=1;for(s=0,l=0;s<i;++s)a[n(u=t[s])]?a[n(u)]=0:o[l++]=u;return this._rem=[],this._add=o},LB.distinct=function(t){const e=this.values(),n={};let i,r=e.length,o=0;for(;--r>=0;)i=t(e[r])+"",DO(n,i)||(n[i]=1,++o);return o},LB.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=IO(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},LB.argmin=function(t){return this.extent(t)[0]||{}},LB.argmax=function(t){return this.extent(t)[1]||{}},LB.min=function(t){const e=this.extent(t)[0];return null!=e?t(e):void 0},LB.max=function(t){const e=this.extent(t)[1];return null!=e?t(e):void 0},LB.quartile=function(t){return this._get===t&&this._q||(this._q=Oz(this.values(),t),this._get=t),this._q},LB.q1=function(t){return this.quartile(t)[0]},LB.q2=function(t){return this.quartile(t)[1]},LB.q3=function(t){return this.quartile(t)[2]},LB.ci=function(t){return this._get===t&&this._ci||(this._ci=$z(this.values(),1e3,.05,t),this._get=t),this._ci},LB.ci0=function(t){return this.ci(t)[0]},LB.ci1=function(t){return this.ci(t)[1]},$B.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:IB},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},OO($B,Iz,{transform(t,e){const n=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.modified();return n.stamp=i.stamp,n.value&&(r||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(n.value=n.value||n.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),i.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&i.clean(!0).runAfter((()=>this.clean())),n.changes(i)},cross(){const t=this,e=t.value,n=t._dnames,i=n.map((()=>({}))),r=n.length;function o(t){let e,o,a,s;for(e in t)for(a=t[e].tuple,o=0;o<r;++o)i[o][s=a[n[o]]]=s}o(t._prev),o(e),function o(a,s,l){const u=n[l],c=i[l++];for(const n in c){const i=a?a+"|"+n:n;s[u]=c[n],l<r?o(i,s,l):e[i]||t.cell(i,s)}}("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],i={};function r(t){const n=gO(DN(t)),r=n.length;let o,a=0;for(;a<r;++a)i[o=n[a]]||(i[o]=1,e.push(o))}this._dims=gO(t.groupby),this._dnames=this._dims.map((t=>{const e=MN(t);return r(t),n.push(e),e})),this.cellkey=t.key?t.key:_B(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=t.fields||[null],a=t.ops||["count"],s=t.as||[],l=o.length,u={};let c,h,d,p,f,g;for(l!==a.length&&ON("Unmatched number of fields and aggregate ops."),g=0;g<l;++g)c=o[g],h=a[g],null==c&&"count"!==h&&ON("Null aggregate field specified."),p=MN(c),f=kB(h,p,s[g]),n.push(f),"count"!==h?(d=u[p],d||(r(c),d=u[p]=[],d.field=c,this._measures.push(d)),"count"!==h&&(this._countOnly=!1),d.push(MB(h,f))):this._counts.push(f);return this._measures=this._measures.map((t=>FB(t,t.field))),{}},cellkey:_B(),cell(t,e){let n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const t=this._measures,e=t.length;n.agg=Array(e);for(let i=0;i<e;++i)n.agg[i]=new t[i](n)}return n.store&&(n.data=new RB),n},newtuple(t,e){const n=this._dnames,i=this._dims,r=i.length,o={};for(let e=0;e<r;++e)o[n[e]]=i[e](t);return e?tz(e.tuple,o):ZP(o)},clean(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].add(i[e].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].rem(i[e].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let i=0,r=n.length;i<r;++i)e[n[i]]=t.num;if(!this._countOnly){const n=t.agg;for(let t=0,i=n.length;t<i;++t)n[t].set(e)}return e},changes(t){const e=this._adds,n=this._mods,i=this._prev,r=this._drop,o=t.add,a=t.rem,s=t.mod;let l,u,c,h;if(i)for(u in i)l=i[u],r&&!l.num||a.push(l.tuple);for(c=0,h=this._alen;c<h;++c)o.push(this.celltuple(e[c])),e[c]=null;for(c=0,h=this._mlen;c<h;++c)l=n[c],(0===l.num&&r?a:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,t}});function PB(t){Iz.call(this,null,t)}function zB(t,e,n){const i=t;let r=e||[],o=n||[],a={},s=0;return{add:t=>o.push(t),remove:t=>a[i(t)]=++s,size:()=>r.length,data:(t,e)=>(s&&(r=r.filter((t=>!a[i(t)])),a={},s=0),e&&t&&r.sort(t),o.length&&(r=t?UO(t,r,o.sort(t)):r.concat(o),o=[]),r)}}function BB(t){Iz.call(this,[],t)}function VB(t){sz.call(this,null,WB,t)}function WB(t){return this.value&&!t.modified()?this.value:vO(t.fields,t.orders)}function jB(t){Iz.call(this,null,t)}function UB(t){Iz.call(this,null,t)}PB.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},OO(PB,Iz,{transform(t,e){const n=!1!==t.interval,i=this._bins(t),r=i.start,o=i.step,a=t.as||["bin0","bin1"],s=a[0],l=a[1];let u;return u=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(DN(t.field))?e.ADD_MOD:e.ADD,e.visit(u,n?t=>{const e=i(t);t[s]=e,t[l]=null==e?null:r+o*(1+(e-r)/o)}:t=>t[s]=i(t)),e.modifies(n?a:s)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,n=Rz(t),i=n.step;let r,o,a=n.start,s=a+Math.ceil((n.stop-a)/i)*i;null!=(r=t.anchor)&&(o=r-(a+i*Math.floor((r-a)/i)),a+=o,s+=o);const l=function(t){let n=ZN(e(t));return null==n?null:n<a?-1/0:n>s?1/0:(n=Math.max(a,Math.min(n,s-i)),a+i*Math.floor(1e-14+(n-a)/i))};return l.start=a,l.stop=n.stop,l.step=i,this.value=IN(l,DN(e),t.name||"bin_"+MN(e))}}),BB.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},OO(BB,Iz,{transform(t,e){const n=e.fork(e.ALL),i=zB(YP,this.value,n.materialize(n.ADD).add),r=t.sort,o=e.changed()||r&&(t.modified("sort")||e.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(o),this.value=n.source=i.data(ez(r),o),e.source&&e.source.root&&(this.value.root=e.source.root),n}}),OO(VB,sz),jB.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},OO(jB,Iz,{transform(t,e){const n=e=>n=>{for(var i,r=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(s(n),t.case,o)||[],l=0,u=r.length;l<u;++l)a.test(i=r[l])||e(i)},i=this._parameterCheck(t,e),r=this._counts,o=this._match,a=this._stop,s=t.field,l=t.as||["text","count"],u=n((t=>r[t]=1+(r[t]||0))),c=n((t=>r[t]-=1));return i?e.visit(e.SOURCE,u):(e.visit(e.ADD,u),e.visit(e.REM,c)),this._finish(e,l)},_parameterCheck(t,e){let n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,i=this._tuples||(this._tuples={}),r=e[0],o=e[1],a=t.fork(t.NO_SOURCE|t.NO_FIELDS);let s,l,u;for(s in n)l=i[s],u=n[s]||0,!l&&u?(i[s]=l=ZP({}),l[r]=s,l[o]=u,a.add.push(l)):0===u?(l&&a.rem.push(l),n[s]=null,i[s]=null):l[o]!==u&&(l[o]=u,a.mod.push(l));return a.modifies(e)}}),UB.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},OO(UB,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.as||["a","b"],r=i[0],o=i[1],a=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let s=this.value;return a?(s&&(n.rem=s),s=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,i){for(var r,o,a=[],s={},l=t.length,u=0;u<l;++u)for(s[e]=o=t[u],r=0;r<l;++r)s[n]=t[r],i(s)&&(a.push(ZP(s)),(s={})[e]=o);return a}(s,r,o,t.filter||BN)):n.mod=s,n.source=this.value,n.modifies(i)}});const GB={kde:qz,mixture:Qz,normal:Hz,lognormal:Jz,uniform:rB};function HB(t,e){const n=t.function;DO(GB,n)||ON("Unknown distribution function: "+n);const i=GB[n]();for(const n in t)"field"===n?i.data((t.from||e()).map(t[n])):"distributions"===n?i[n](t[n].map((t=>HB(t,e)))):"function"==typeof i[n]&&i[n](t[n]);return i}function qB(t){Iz.call(this,null,t)}const XB=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],YB={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:XB},{name:"weights",type:"number",array:!0}]};function KB(t,e){return t?t.map(((t,n)=>e[n]||MN(t))):null}function ZB(t,e,n){const i=[],r=t=>t(l);let o,a,s,l,u,c;if(null==e)i.push(t.map(n));else for(o={},a=0,s=t.length;a<s;++a)l=t[a],u=e.map(r),c=o[u],c||(o[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}qB.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:XB.concat(YB)},{name:"as",type:"string",array:!0,default:["value","density"]}]},OO(qB,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=HB(t.distribution,function(t){return()=>t.materialize(t.SOURCE).source}(e)),r=t.steps||t.minsteps||25,o=t.steps||t.maxsteps||200;let a=t.method||"pdf";"pdf"!==a&&"cdf"!==a&&ON("Invalid density method: "+a),t.extent||i.data||ON("Missing density extent parameter."),a=i[a];const s=t.as||["value","density"],l=bB(a,t.extent||AO(i.data()),r,o).map((t=>{const e={};return e[s[0]]=t[0],e[s[1]]=t[1],ZP(e)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function JB(t){Iz.call(this,null,t)}JB.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function QB(t){sz.call(this,null,tV,t),this.modified(!0)}function tV(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:IN((n=>e(n,t)),DN(e),MN(e))}function eV(t){Iz.call(this,[void 0,void 0],t)}function nV(t,e){sz.call(this,t),this.parent=e,this.count=0}function iV(t){Iz.call(this,{},t),this._keys=EO();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,i=e.active;n<i;++n)t(e[n],n,e)}}function rV(t){sz.call(this,null,oV,t)}function oV(t){return this.value&&!t.modified()?this.value:UN(t.name)?gO(t.name).map((t=>RN(t))):RN(t.name,t.as)}function aV(t){Iz.call(this,EO(),t)}function sV(t){Iz.call(this,[],t)}function lV(t){Iz.call(this,[],t)}function uV(t){Iz.call(this,null,t)}function cV(t){Iz.call(this,[],t)}OO(JB,Iz,{transform(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,i=ZB(e.source,t.groupby,$N),r=t.smooth||!1,o=t.field,a=t.step||((t,e)=>qO(AO(t,e))/30)(n,o),s=ez(((t,e)=>o(t)-o(e))),l=t.as||"bin",u=i.length;let c,h=1/0,d=-1/0,p=0;for(;p<u;++p){const t=i[p].sort(s);c=-1;for(const e of Pz(t,a,r,o))e<h&&(h=e),e>d&&(d=e),t[++c][l]=e}return this.value={start:h,stop:d,step:a},e.reflow(!0).modifies(l)}}),OO(QB,sz),eV.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},OO(eV,Iz,{transform(t,e){const n=this.value,i=t.field,r=e.changed()||e.modified(i.fields)||t.modified("field");let o=n[0],a=n[1];if((r||null==o)&&(o=1/0,a=-1/0),e.visit(r?e.SOURCE:e.ADD,(t=>{const e=ZN(i(t));null!=e&&(e<o&&(o=e),e>a&&(a=e))})),!Number.isFinite(o)||!Number.isFinite(a)){let t=MN(i);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${o}, ${a}]`),o=a=void 0}this.value=[o,a]}}),OO(nV,sz,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}}),OO(iV,Iz,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,i){const r=this.value;let o,a,s=DO(r,t)&&r[t];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=i||(a=this._group[t])&&a.tuple,o=n.dataflow,s=new nV(n.fork(n.NO_SOURCE),this),o.add(s).connect(e(o,t,a)),r[t]=s,this.activate(s)),s},clean(){const t=this.value;let e=0;for(const n in t)if(0===t[n].count){const i=t[n].detachSubflow;i&&i(),delete t[n],++e}if(e){const t=this._targets.filter((t=>t&&t.count>0));this.initTargets(t)}},initTargets(t){const e=this._targets,n=e.length,i=t?t.length:0;let r=0;for(;r<i;++r)e[r]=t[r];for(;r<n&&null!=e[r];++r)e[r]=null;e.active=i},transform(t,e){const n=e.dataflow,i=t.key,r=t.subflow,o=this._keys,a=t.modified("key"),s=t=>this.subflow(t,r,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,(t=>{const e=YP(t),n=o.get(e);void 0!==n&&(o.delete(e),s(n).rem(t))})),e.visit(e.ADD,(t=>{const e=i(t);o.set(YP(t),e),s(e).add(t)})),a||e.modified(i.fields)?e.visit(e.MOD,(t=>{const e=YP(t),n=o.get(e),r=i(t);n===r?s(r).mod(t):(o.set(e,r),s(n).rem(t),s(r).add(t))})):e.changed(e.MOD)&&e.visit(e.MOD,(t=>{s(o.get(YP(t))).mod(t)})),a&&e.visit(e.REFLOW,(t=>{const e=YP(t),n=o.get(e),r=i(t);n!==r&&(o.set(e,r),s(n).rem(t),s(r).add(t))})),e.clean()?n.runAfter((()=>{this.clean(),o.clean()})):o.empty>n.cleanThreshold&&n.runAfter(o.clean),e}}),OO(rV,sz),aV.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},OO(aV,Iz,{transform(t,e){const n=e.dataflow,i=this.value,r=e.fork(),o=r.add,a=r.rem,s=r.mod,l=t.expr;let u=!0;function c(e){const n=YP(e),r=l(e,t),c=i.get(n);r&&c?(i.delete(n),o.push(e)):r||c?u&&r&&!c&&s.push(e):(i.set(n,1),a.push(e))}return e.visit(e.REM,(t=>{const e=YP(t);i.has(e)?i.delete(e):a.push(t)})),e.visit(e.ADD,(e=>{l(e,t)?o.push(e):i.set(YP(e),1)})),e.visit(e.MOD,c),t.modified()&&(u=!1,e.visit(e.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}}),sV.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},OO(sV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=KB(i,t.as||[]),o=t.index||null,a=r.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{const e=i.map((e=>e(t))),s=e.reduce(((t,e)=>Math.max(t,e.length)),0);let l,u,c,h=0;for(;h<s;++h){for(u=JP(t),l=0;l<a;++l)u[r[l]]=null==(c=e[l][h])?null:c;o&&(u[o]=h),n.add.push(u)}})),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(r)}}),lV.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},OO(lV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=i.map(MN),o=t.as||["key","value"],a=o[0],s=o[1],l=i.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{for(let e,o=0;o<l;++o)e=JP(t),e[a]=r[o],e[s]=i[o](t),n.add.push(e)})),this.value=n.source=n.add,n.modifies(o)}}),uV.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},OO(uV,Iz,{transform(t,e){const n=t.expr,i=t.as,r=t.modified(),o=t.initonly?e.ADD:r?e.SOURCE:e.modified(n.fields)||e.modified(i)?e.ADD_MOD:e.ADD;return r&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(i),e.visit(o,(e=>e[i]=n(e,t)))}}),OO(cV,Iz,{transform(t,e){const n=e.fork(e.ALL),i=t.generator;let r,o,a,s=this.value,l=t.size-s.length;if(l>0){for(r=[];--l>=0;)r.push(a=ZP(i(t))),s.push(a);n.add=n.add.length?n.materialize(n.ADD).add.concat(r):r}else o=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(o):o,s=s.slice(-l);return n.source=this.value=s,n}});const hV={value:"value",median:oR,mean:function(t,e){let n=0,i=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,i+=e);else{let r=-1;for(let o of t)null!=(o=e(o,++r,t))&&(o=+o)>=o&&(++n,i+=o)}if(n)return i/n},min:tR,max:QF},dV=[];function pV(t){Iz.call(this,[],t)}function fV(t){$B.call(this,t)}function gV(t){Iz.call(this,null,t)}function mV(t){sz.call(this,null,yV,t)}function yV(t){return this.value&&!t.modified()?this.value:VO(t.fields,t.flat)}function vV(t){Iz.call(this,[],t),this._pending=null}function xV(t,e,n){n.forEach(ZP);const i=e.fork(e.NO_FIELDS&e.NO_SOURCE);return i.rem=t.value,t.value=i.source=i.add=n,t._pending=null,i.rem.length&&i.clean(!0),i}function bV(t){Iz.call(this,{},t)}function wV(t){sz.call(this,null,_V,t)}function _V(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let i,r,o=1/0,a=-1/0;for(i=0;i<n;++i)r=e[i],r[0]<o&&(o=r[0]),r[1]>a&&(a=r[1]);return[o,a]}function kV(t){sz.call(this,null,SV,t)}function SV(t){return this.value&&!t.modified()?this.value:t.values.reduce(((t,e)=>t.concat(e)),[])}function CV(t){Iz.call(this,null,t)}function AV(t){$B.call(this,t)}function IV(t){iV.call(this,t)}function MV(t){Iz.call(this,null,t)}function DV(t){Iz.call(this,null,t)}function TV(t){Iz.call(this,null,t)}pV.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},OO(pV,Iz,{transform(t,e){var n,i,r,o,a,s,l,u,c,h,d=e.fork(e.ALL),p=function(t){var e,n=t.method||hV.value;if(null!=hV[n])return n===hV.value?(e=void 0!==t.value?t.value:0,()=>e):hV[n];ON("Unrecognized imputation method: "+n)}(t),f=function(t){const e=t.field;return t=>t?e(t):NaN}(t),g=MN(t.field),m=MN(t.key),y=(t.groupby||[]).map(MN),v=function(t,e,n,i){var r,o,a,s,l,u,c,h,d=t=>t(h),p=[],f=i?i.slice():[],g={},m={};for(f.forEach(((t,e)=>g[t]=e+1)),s=0,c=t.length;s<c;++s)u=n(h=t[s]),l=g[u]||(g[u]=f.push(u)),(a=m[o=(r=e?e.map(d):dV)+""])||(a=m[o]=[],p.push(a),a.values=r),a[l-1]=h;return p.domain=f,p}(e.source,t.groupby,t.key,t.keyvals),x=[],b=this.value,w=v.domain.length;for(a=0,u=v.length;a<u;++a)for(r=(n=v[a]).values,i=NaN,l=0;l<w;++l)if(null==n[l]){for(o=v.domain[l],h={_impute:!0},s=0,c=r.length;s<c;++s)h[y[s]]=r[s];h[m]=o,h[g]=Number.isNaN(i)?i=p(n,f):i,x.push(ZP(h))}return x.length&&(d.add=d.materialize(d.ADD).add.concat(x)),b.length&&(d.rem=d.materialize(d.REM).rem.concat(b)),this.value=x,d}}),fV.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:IB},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},OO(fV,$B,{transform(t,e){const n=this,i=t.modified();let r;return n.value&&(i||e.modified(n._inputs,!0))?(r=n.value=i?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(r=n.value=n.value||this.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),n.changes(),e.visit(e.SOURCE,(t=>{CO(t,r[n.cellkey(t)].tuple)})),e.reflow(i).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(t[n]),t[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}}),gV.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},OO(gV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=ZB(i,t.groupby,t.field),o=(t.groupby||[]).map(MN),a=t.bandwidth,s=t.cumulative?"cdf":"pdf",l=t.as||["value","density"],u=[];let c=t.extent,h=t.steps||t.minsteps||25,d=t.steps||t.maxsteps||200;"pdf"!==s&&"cdf"!==s&&ON("Invalid density method: "+s),"shared"===t.resolve&&(c||(c=AO(i,t.field)),h=d=t.steps||d),r.forEach((e=>{const n=qz(e,a)[s],i=t.counts?e.length:1;bB(n,c||AO(e),h,d).forEach((t=>{const n={};for(let t=0;t<o.length;++t)n[o[t]]=e.dims[t];n[l[0]]=t[0],n[l[1]]=t[1]*i,u.push(ZP(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),OO(mV,sz),OO(vV,Iz,{transform(t,e){const n=e.dataflow;if(this._pending)return xV(this,e,this._pending);if(function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t))return e.StopPropagation;if(t.values)return xV(this,e,n.parse(t.values,t.format));if(t.async){return{async:n.request(t.url,t.format).then((t=>(this._pending=gO(t.data),t=>t.touch(this))))}}return n.request(t.url,t.format).then((t=>xV(this,e,gO(t.data))))}}),bV.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},OO(bV,Iz,{transform(t,e){const n=t.fields,i=t.index,r=t.values,o=null==t.default?null:t.default,a=t.modified(),s=n.length;let l,u,c,h=a?e.SOURCE:e.ADD,d=e,p=t.as;return r?(u=r.length,s>1&&!p&&ON('Multi-field lookup requires explicit "as" parameter.'),p&&p.length!==s*u&&ON('The "as" parameter has too few output field names.'),p=p||r.map(MN),l=function(t){for(var e,a,l=0,c=0;l<s;++l)if(null==(a=i.get(n[l](t))))for(e=0;e<u;++e,++c)t[p[c]]=o;else for(e=0;e<u;++e,++c)t[p[c]]=r[e](a)}):(p||ON("Missing output field names."),l=function(t){for(var e,r=0;r<s;++r)e=i.get(n[r](t)),t[p[r]]=null==e?o:e}),a?d=e.reflow(!0):(c=n.some((t=>e.modified(t.fields))),h|=c?e.MOD:0),e.visit(h,l),d.modifies(p)}}),OO(wV,sz),OO(kV,sz),OO(CV,Iz,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),AV.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:IB,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},OO(AV,$B,{_transform:$B.prototype.transform,transform(t,e){return this._transform(function(t,e){const n=t.field,i=t.value,r=("count"===t.op?"__count__":t.op)||"sum",o=DN(n).concat(DN(i)),a=function(t,e,n){const i={},r=[];return n.visit(n.SOURCE,(e=>{const n=t(e);i[n]||(i[n]=1,r.push(n))})),r.sort(xO),e?r.slice(0,e):r}(n,t.limit||0,e);e.changed()&&t.set("__pivot__",null,null,!0);return{key:t.key,groupby:t.groupby,ops:a.map((()=>r)),fields:a.map((t=>function(t,e,n,i){return IN((i=>e(i)===t?n(i):NaN),i,t+"")}(t,n,i,o))),as:a.map((t=>t+"")),modified:t.modified.bind(t)}}(t,e),e)}}),OO(IV,iV,{transform(t,e){const n=t.subflow,i=t.field,r=t=>this.subflow(YP(t),n,e,t);return(t.modified("field")||i&&e.modified(DN(i)))&&ON("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,(t=>{const e=r(t);i(t).forEach((t=>e.mod(t)))})),e.visit(e.ADD,(t=>{const e=r(t);i(t).forEach((t=>e.add(ZP(t))))})),e.visit(e.REM,(t=>{const e=r(t);i(t).forEach((t=>e.rem(t)))}))):(e.visit(e.MOD,(t=>r(t).mod(t))),e.visit(e.ADD,(t=>r(t).add(t))),e.visit(e.REM,(t=>r(t).rem(t)))),e.clean()&&e.runAfter((()=>this.clean())),e}}),MV.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},OO(MV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=KB(t.fields,t.as||[]),o=i?(t,e)=>function(t,e,n,i){for(let r=0,o=n.length;r<o;++r)e[i[r]]=n[r](t);return e}(t,e,i,r):QP;let a;return this.value?a=this.value:(e=e.addAll(),a=this.value={}),e.visit(e.REM,(t=>{const e=YP(t);n.rem.push(a[e]),a[e]=null})),e.visit(e.ADD,(t=>{const e=o(t,ZP({}));a[YP(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{n.mod.push(o(t,a[YP(t)]))})),n}}),OO(DV,Iz,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}}),TV.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function EV(t){Iz.call(this,null,t)}function NV(t){Iz.call(this,[],t),this.count=0}function OV(t){Iz.call(this,null,t)}function FV(t){Iz.call(this,null,t),this.modified(!0)}function RV(t){Iz.call(this,null,t)}OO(TV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const r=ZB(e.materialize(e.SOURCE).source,t.groupby,t.field),o=(t.groupby||[]).map(MN),a=[],s=t.step||.01,l=t.probs||sR(s/2,1-1e-14,s),u=l.length;return r.forEach((t=>{const e=Nz(t,l);for(let n=0;n<u;++n){const r={};for(let e=0;e<o.length;++e)r[o[e]]=t.dims[e];r[i[0]]=l[n],r[i[1]]=e[n],a.push(ZP(r))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}}),OO(EV,Iz,{transform(t,e){let n,i;return this.value?i=this.value:(n=e=e.addAll(),i=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,(t=>{const e=YP(t);n.rem.push(i[e]),i[e]=null})),e.visit(e.ADD,(t=>{const e=JP(t);i[YP(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{const e=i[YP(t)];for(const i in t)e[i]=t[i],n.modifies(i);n.mod.push(e)}))),n}}),NV.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},OO(NV,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.modified("size"),r=t.size,o=this.value.reduce(((t,e)=>(t[YP(e)]=1,t)),{});let a=this.value,s=this.count,l=0;function u(t){let e,i;a.length<r?a.push(t):(i=~~((s+1)*Lz()),i<a.length&&i>=l&&(e=a[i],o[YP(e)]&&n.rem.push(e),a[i]=t)),++s}if(e.rem.length&&(e.visit(e.REM,(t=>{const e=YP(t);o[e]&&(o[e]=-1,n.rem.push(t)),--s})),a=a.filter((t=>-1!==o[YP(t)]))),(e.rem.length||i)&&a.length<r&&e.source&&(l=s=a.length,e.visit(e.SOURCE,(t=>{o[YP(t)]||u(t)})),l=-1),i&&a.length>r){const t=a.length-r;for(let e=0;e<t;++e)o[YP(a[e])]=-1,n.rem.push(a[e]);a=a.slice(t)}return e.mod.length&&e.visit(e.MOD,(t=>{o[YP(t)]&&n.mod.push(t)})),e.add.length&&e.visit(e.ADD,u),(e.add.length||l<0)&&(n.add=a.filter((t=>!o[YP(t)]))),this.count=s,this.value=n.source=a,n}}),OV.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},OO(OV,Iz,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),i=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=sR(t.start,t.stop,t.step||1).map((t=>{const e={};return e[i]=t,ZP(e)})),n.add=e.add.concat(this.value),n}}),OO(FV,Iz,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});const LV=["unit0","unit1"];function $V(t){Iz.call(this,EO(),t)}function PV(t){Iz.call(this,null,t)}RV.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:sL,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:LV}]},OO(RV,Iz,{transform(t,e){const n=t.field,i=!1!==t.interval,r="utc"===t.timezone,o=this._floor(t,e),a=(r?$L:LL)(o.unit).offset,s=t.as||LV,l=s[0],u=s[1],c=o.step;let h=o.start||1/0,d=o.stop||-1/0,p=e.ADD;return(t.modified()||e.modified(DN(n)))&&(p=(e=e.reflow(!0)).SOURCE,h=1/0,d=-1/0),e.visit(p,(t=>{const e=n(t);let r,s;null==e?(t[l]=null,i&&(t[u]=null)):(t[l]=r=s=o(e),i&&(t[u]=s=a(r,c)),r<h&&(h=r),s>d&&(d=s))})),o.start=h,o.stop=d,e.modifies(i?s:l)},_floor(t,e){const n="utc"===t.timezone,{units:i,step:r}=t.units?{units:t.units,step:t.step||1}:JL({extent:t.extent||AO(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),o=uL(i),a=this.value||{},s=(n?OL:TL)(o,r);return s.unit=KN(o),s.units=o,s.step=r,s.start=a.start,s.stop=a.stop,this.value=s}}),OO($V,Iz,{transform(t,e){const n=e.dataflow,i=t.field,r=this.value,o=t=>r.set(i(t),t);let a=!0;return t.modified("field")||e.modified(i.fields)?(r.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,(t=>r.delete(i(t)))),e.visit(e.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),e.fork()}}),OO(PV,Iz,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(ez(t.sort)):e.source).map(t.field))}});const zV={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?++t:t}}},percent_rank:function(){const t=zV.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,i=e.compare;let r=e.index;if(t<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;t=r}return(1+t)/n.length}}},ntile:function(t,e){(e=+e)>0||ON("ntile num must be greater than zero.");const n=zV.cume_dist(),i=n.next;return{init:n.init,next:t=>Math.ceil(e*i(t))}},lag:function(t,e){return e=+e||1,{next:n=>{const i=n.index-e;return i>=0?t(n.data[i]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const i=n.index+e,r=n.data;return i<r.length?t(r[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||ON("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(e-1);return i<n.i1?t(n.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const i=t(n.data[n.index]);return null!=i?e=i:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:i=>{const r=i.data;return i.index<=n?e:(n=function(t,e,n){for(let i=e.length;n<i;++n){if(null!=t(e[n]))return n}return-1}(t,r,i.index))<0?(n=r.length,e=null):e=t(r[n])}}}};const BV=Object.keys(zV);function VV(t){const e=gO(t.ops),n=gO(t.fields),i=gO(t.params),r=gO(t.as),o=this.outputs=[],a=this.windows=[],s={},l={},u=[],c=[];let h=!0;function d(t){gO(DN(t)).forEach((t=>s[t]=1))}d(t.sort),e.forEach(((t,e)=>{const s=n[e],p=MN(s),f=kB(t,p,r[e]);if(d(s),o.push(f),DO(zV,t))a.push(function(t,e,n,i){const r=zV[t](e,n);return{init:r.init||PN,update:function(t,e){e[i]=r.next(t)}}}(t,n[e],i[e],f));else{if(null==s&&"count"!==t&&ON("Null aggregate field specified."),"count"===t)return void u.push(f);h=!1;let e=l[p];e||(e=l[p]=[],e.field=s,c.push(e)),e.push(MB(t,f))}})),(u.length||c.length)&&(this.cell=function(t,e,n){t=t.map((t=>FB(t,t.field)));const i={num:0,agg:null,store:!1,count:e};if(!n)for(var r=t.length,o=i.agg=Array(r),a=0;a<r;++a)o[a]=new t[a](i);if(i.store)var s=i.data=new RB;return i.add=function(t){if(i.num+=1,!n){s&&s.add(t);for(let e=0;e<r;++e)o[e].add(o[e].get(t),t)}},i.rem=function(t){if(i.num-=1,!n){s&&s.rem(t);for(let e=0;e<r;++e)o[e].rem(o[e].get(t),t)}},i.set=function(t){let r,a;for(s&&s.values(),r=0,a=e.length;r<a;++r)t[e[r]]=i.num;if(!n)for(r=0,a=o.length;r<a;++r)o[r].set(t)},i.init=function(){i.num=0,s&&s.reset();for(let t=0;t<r;++t)o[t].init()},i}(c,u,h)),this.inputs=Object.keys(s)}const WV=VV.prototype;function jV(t){Iz.call(this,{},t),this._mlen=0,this._mods=[]}function UV(t,e,n,i){const r=i.sort,o=r&&!i.ignorePeers,a=i.frame||[null,0],s=t.data(n),l=s.length,u=o?VF(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||kO(-1)};e.init();for(let t=0;t<l;++t)GV(c,a,t,l),o&&HV(c,u),e.update(c,s[t])}function GV(t,e,n,i){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?i:Math.min(i,n+Math.abs(e[1])+1),t.index=n}function HV(t,e){const n=t.i0,i=t.i1-1,r=t.compare,o=t.data,a=o.length-1;n>0&&!r(o[n],o[n-1])&&(t.i0=e.left(o,o[n])),i<a&&!r(o[i],o[i+1])&&(t.i1=e.right(o,o[i]))}WV.init=function(){this.windows.forEach((t=>t.init())),this.cell&&this.cell.init()},WV.update=function(t,e){const n=this.cell,i=this.windows,r=t.data,o=i&&i.length;let a;if(n){for(a=t.p0;a<t.i0;++a)n.rem(r[a]);for(a=t.p1;a<t.i1;++a)n.add(r[a]);n.set(e)}for(a=0;a<o;++a)i[a].update(t,e)},jV.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:BV.concat(IB)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},OO(jV,Iz,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),i=ez(t.sort),r=_B(t.groupby),o=t=>this.group(r(t));let a=this.state;a&&!n||(a=this.state=new VV(t)),n||e.modified(a.inputs)?(this.value={},e.visit(e.SOURCE,(t=>o(t).add(t)))):(e.visit(e.REM,(t=>o(t).remove(t))),e.visit(e.ADD,(t=>o(t).add(t))));for(let e=0,n=this._mlen;e<n;++e)UV(this._mods[e],a,i,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(a.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=zB(YP),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}});var qV=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",aggregate:$B,bin:PB,collect:BB,compare:VB,countpattern:jB,cross:UB,density:qB,dotbin:JB,expression:QB,extent:eV,facet:iV,field:rV,filter:aV,flatten:sV,fold:lV,formula:uV,generate:cV,impute:pV,joinaggregate:fV,kde:gV,key:mV,load:vV,lookup:bV,multiextent:wV,multivalues:kV,params:CV,pivot:AV,prefacet:IV,project:MV,proxy:DV,quantile:TV,relay:EV,sample:NV,sequence:OV,sieve:FV,subflow:nV,timeunit:RV,tupleindex:$V,values:PV,window:jV});const XV=Math.PI,YV=2*XV,KV=YV-1e-6;function ZV(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function JV(){return new ZV}function QV(t){return function(){return t}}ZV.prototype=JV.prototype={constructor:ZV,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var o=this._x1,a=this._y1,s=n-t,l=i-e,u=o-t,c=a-e,h=u*u+c*c;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(c*s-l*u)>1e-6&&r){var d=n-o,p=i-a,f=s*s+l*l,g=d*d+p*p,m=Math.sqrt(f),y=Math.sqrt(h),v=r*Math.tan((XV-Math.acos((f+h-g)/(2*m*y)))/2),x=v/y,b=v/m;Math.abs(x-1)>1e-6&&(this._+="L"+(t+x*u)+","+(e+x*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>u*p)+","+(this._x1=t+b*s)+","+(this._y1=e+b*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,i,r,o){t=+t,e=+e,o=!!o;var a=(n=+n)*Math.cos(i),s=n*Math.sin(i),l=t+a,u=e+s,c=1^o,h=o?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+l+","+u),n&&(h<0&&(h=h%YV+YV),h>KV?this._+="A"+n+","+n+",0,1,"+c+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=XV)+","+c+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var tW=Math.abs,eW=Math.atan2,nW=Math.cos,iW=Math.max,rW=Math.min,oW=Math.sin,aW=Math.sqrt,sW=Math.PI,lW=sW/2,uW=2*sW;function cW(t){return t>1?0:t<-1?sW:Math.acos(t)}function hW(t){return t>=1?lW:t<=-1?-lW:Math.asin(t)}function dW(t){return t.innerRadius}function pW(t){return t.outerRadius}function fW(t){return t.startAngle}function gW(t){return t.endAngle}function mW(t){return t&&t.padAngle}function yW(t,e,n,i,r,o,a,s){var l=n-t,u=i-e,c=a-r,h=s-o,d=h*l-c*u;if(!(d*d<1e-12))return[t+(d=(c*(e-o)-h*(t-r))/d)*l,e+d*u]}function vW(t,e,n,i,r,o,a){var s=t-n,l=e-i,u=(a?o:-o)/aW(s*s+l*l),c=u*l,h=-u*s,d=t+c,p=e+h,f=n+c,g=i+h,m=(d+f)/2,y=(p+g)/2,v=f-d,x=g-p,b=v*v+x*x,w=r-o,_=d*g-f*p,k=(x<0?-1:1)*aW(iW(0,w*w*b-_*_)),S=(_*x-v*k)/b,C=(-_*v-x*k)/b,A=(_*x+v*k)/b,I=(-_*v+x*k)/b,M=S-m,D=C-y,T=A-m,E=I-y;return M*M+D*D>T*T+E*E&&(S=A,C=I),{cx:S,cy:C,x01:-c,y01:-h,x11:S*(r/w-1),y11:C*(r/w-1)}}function xW(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function bW(t){this._context=t}function wW(t){return new bW(t)}function _W(t){return t[0]}function kW(t){return t[1]}function SW(t,e){var n=QV(!0),i=null,r=wW,o=null;function a(a){var s,l,u,c=(a=xW(a)).length,h=!1;for(null==i&&(o=r(u=JV())),s=0;s<=c;++s)!(s<c&&n(l=a[s],s,a))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(l,s,a),+e(l,s,a));if(u)return o=null,u+""||null}return t="function"==typeof t?t:void 0===t?_W:QV(t),e="function"==typeof e?e:void 0===e?kW:QV(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:QV(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:QV(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:QV(!!t),a):n},a.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),a):r},a.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),a):i},a}function CW(t,e,n){var i=null,r=QV(!0),o=null,a=wW,s=null;function l(l){var u,c,h,d,p,f=(l=xW(l)).length,g=!1,m=new Array(f),y=new Array(f);for(null==o&&(s=a(p=JV())),u=0;u<=f;++u){if(!(u<f&&r(d=l[u],u,l))===g)if(g=!g)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=u-1;h>=c;--h)s.point(m[h],y[h]);s.lineEnd(),s.areaEnd()}g&&(m[u]=+t(d,u,l),y[u]=+e(d,u,l),s.point(i?+i(d,u,l):m[u],n?+n(d,u,l):y[u]))}if(p)return s=null,p+""||null}function u(){return SW().defined(r).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?_W:QV(+t),e="function"==typeof e?e:QV(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?kW:QV(+n),l.x=function(e){return arguments.length?(t="function"==typeof e?e:QV(+e),i=null,l):t},l.x0=function(e){return arguments.length?(t="function"==typeof e?e:QV(+e),l):t},l.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:QV(+t),l):i},l.y=function(t){return arguments.length?(e="function"==typeof t?t:QV(+t),n=null,l):e},l.y0=function(t){return arguments.length?(e="function"==typeof t?t:QV(+t),l):e},l.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:QV(+t),l):n},l.lineX0=l.lineY0=function(){return u().x(t).y(e)},l.lineY1=function(){return u().x(t).y(n)},l.lineX1=function(){return u().x(i).y(e)},l.defined=function(t){return arguments.length?(r="function"==typeof t?t:QV(!!t),l):r},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l}bW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var AW={draw:function(t,e){var n=Math.sqrt(e/sW);t.moveTo(n,0),t.arc(0,0,n,0,uW)}};function IW(){}function MW(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function DW(t){this._context=t}function TW(t){this._context=t}function EW(t){this._context=t}function NW(t,e){this._basis=new DW(t),this._beta=e}DW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:MW(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:MW(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},TW.prototype={areaStart:IW,areaEnd:IW,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:MW(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},EW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:MW(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},NW.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,r=t[0],o=e[0],a=t[n]-r,s=e[n]-o,l=-1;++l<=n;)i=l/n,this._basis.point(this._beta*t[l]+(1-this._beta)*(r+i*a),this._beta*e[l]+(1-this._beta)*(o+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var OW=function t(e){function n(t){return 1===e?new DW(t):new NW(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function FW(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function RW(t,e){this._context=t,this._k=(1-e)/6}RW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:FW(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:FW(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var LW=function t(e){function n(t){return new RW(t,e)}return n.tension=function(e){return t(+e)},n}(0);function $W(t,e){this._context=t,this._k=(1-e)/6}$W.prototype={areaStart:IW,areaEnd:IW,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:FW(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var PW=function t(e){function n(t){return new $W(t,e)}return n.tension=function(e){return t(+e)},n}(0);function zW(t,e){this._context=t,this._k=(1-e)/6}zW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:FW(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var BW=function t(e){function n(t){return new zW(t,e)}return n.tension=function(e){return t(+e)},n}(0);function VW(t,e,n){var i=t._x1,r=t._y1,o=t._x2,a=t._y2;if(t._l01_a>1e-12){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>1e-12){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*u+t._x1*t._l23_2a-e*t._l12_2a)/c,a=(a*u+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(i,r,o,a,t._x2,t._y2)}function WW(t,e){this._context=t,this._alpha=e}WW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:VW(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var jW=function t(e){function n(t){return e?new WW(t,e):new RW(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function UW(t,e){this._context=t,this._alpha=e}UW.prototype={areaStart:IW,areaEnd:IW,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:VW(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var GW=function t(e){function n(t){return e?new UW(t,e):new $W(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function HW(t,e){this._context=t,this._alpha=e}HW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:VW(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var qW=function t(e){function n(t){return e?new HW(t,e):new zW(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function XW(t){this._context=t}function YW(t){return t<0?-1:1}function KW(t,e,n){var i=t._x1-t._x0,r=e-t._x1,o=(t._y1-t._y0)/(i||r<0&&-0),a=(n-t._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(YW(o)+YW(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function ZW(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function JW(t,e,n){var i=t._x0,r=t._y0,o=t._x1,a=t._y1,s=(o-i)/3;t._context.bezierCurveTo(i+s,r+s*e,o-s,a-s*n,o,a)}function QW(t){this._context=t}function tj(t){this._context=new ej(t)}function ej(t){this._context=t}function nj(t){this._context=t}function ij(t){var e,n,i=t.length-1,r=new Array(i),o=new Array(i),a=new Array(i);for(r[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<i-1;++e)r[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(r[i-1]=2,o[i-1]=7,a[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)n=r[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(r[i-1]=a[i-1]/o[i-1],e=i-2;e>=0;--e)r[e]=(a[e]-r[e+1])/o[e];for(o[i-1]=(t[i]+r[i-1])/2,e=0;e<i-1;++e)o[e]=2*t[e+1]-r[e+1];return[r,o]}function rj(t,e){this._context=t,this._t=e}function oj(t,e){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}XW.prototype={areaStart:IW,areaEnd:IW,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},QW.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:JW(this,this._t0,ZW(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,JW(this,ZW(this,n=KW(this,t,e)),n);break;default:JW(this,this._t0,n=KW(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(tj.prototype=Object.create(QW.prototype)).point=function(t,e){QW.prototype.point.call(this,e,t)},ej.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,o){this._context.bezierCurveTo(e,t,i,n,o,r)}},nj.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var i=ij(t),r=ij(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},rj.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};function aj(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function sj(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const lj=Symbol("implicit");function uj(){var t=new Map,e=[],n=[],i=lj;function r(r){var o=r+"",a=t.get(o);if(!a){if(i!==lj)return i;t.set(o,a=e.push(r))}return n[(a-1)%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of n){const n=i+"";t.has(n)||t.set(n,e.push(i))}return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return uj(e,n).unknown(i)},aj.apply(r,arguments),r}function cj(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function hj(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function dj(){}var pj=1/.7,fj="\\s*([+-]?\\d+)\\s*",gj="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",mj="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yj=/^#([0-9a-f]{3,8})$/,vj=new RegExp("^rgb\\("+[fj,fj,fj]+"\\)$"),xj=new RegExp("^rgb\\("+[mj,mj,mj]+"\\)$"),bj=new RegExp("^rgba\\("+[fj,fj,fj,gj]+"\\)$"),wj=new RegExp("^rgba\\("+[mj,mj,mj,gj]+"\\)$"),_j=new RegExp("^hsl\\("+[gj,mj,mj]+"\\)$"),kj=new RegExp("^hsla\\("+[gj,mj,mj,gj]+"\\)$"),Sj={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Cj(){return this.rgb().formatHex()}function Aj(){return this.rgb().formatRgb()}function Ij(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=yj.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Mj(e):3===n?new Nj(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Dj(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Dj(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=vj.exec(t))?new Nj(e[1],e[2],e[3],1):(e=xj.exec(t))?new Nj(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=bj.exec(t))?Dj(e[1],e[2],e[3],e[4]):(e=wj.exec(t))?Dj(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=_j.exec(t))?Lj(e[1],e[2]/100,e[3]/100,1):(e=kj.exec(t))?Lj(e[1],e[2]/100,e[3]/100,e[4]):Sj.hasOwnProperty(t)?Mj(Sj[t]):"transparent"===t?new Nj(NaN,NaN,NaN,0):null}function Mj(t){return new Nj(t>>16&255,t>>8&255,255&t,1)}function Dj(t,e,n,i){return i<=0&&(t=e=n=NaN),new Nj(t,e,n,i)}function Tj(t){return t instanceof dj||(t=Ij(t)),t?new Nj((t=t.rgb()).r,t.g,t.b,t.opacity):new Nj}function Ej(t,e,n,i){return 1===arguments.length?Tj(t):new Nj(t,e,n,null==i?1:i)}function Nj(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Oj(){return"#"+Rj(this.r)+Rj(this.g)+Rj(this.b)}function Fj(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Rj(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Lj(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new zj(t,e,n,i)}function $j(t){if(t instanceof zj)return new zj(t.h,t.s,t.l,t.opacity);if(t instanceof dj||(t=Ij(t)),!t)return new zj;if(t instanceof zj)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),a=NaN,s=o-r,l=(o+r)/2;return s?(a=e===o?(n-i)/s+6*(n<i):n===o?(i-e)/s+2:(e-n)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new zj(a,s,l,t.opacity)}function Pj(t,e,n,i){return 1===arguments.length?$j(t):new zj(t,e,n,null==i?1:i)}function zj(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Bj(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}cj(dj,Ij,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Cj,formatHex:Cj,formatHsl:function(){return $j(this).formatHsl()},formatRgb:Aj,toString:Aj}),cj(Nj,Ej,hj(dj,{brighter:function(t){return t=null==t?pj:Math.pow(pj,t),new Nj(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Nj(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Oj,formatHex:Oj,formatRgb:Fj,toString:Fj})),cj(zj,Pj,hj(dj,{brighter:function(t){return t=null==t?pj:Math.pow(pj,t),new zj(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new zj(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Nj(Bj(t>=240?t-240:t+120,r,i),Bj(t,r,i),Bj(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const Vj=Math.PI/180,Wj=180/Math.PI,jj=4/29,Uj=6/29,Gj=3*Uj*Uj;function Hj(t){if(t instanceof Xj)return new Xj(t.l,t.a,t.b,t.opacity);if(t instanceof eU)return nU(t);t instanceof Nj||(t=Tj(t));var e,n,i=Jj(t.r),r=Jj(t.g),o=Jj(t.b),a=Yj((.2225045*i+.7168786*r+.0606169*o)/1);return i===r&&r===o?e=n=a:(e=Yj((.4360747*i+.3850649*r+.1430804*o)/.96422),n=Yj((.0139322*i+.0971045*r+.7141733*o)/.82521)),new Xj(116*a-16,500*(e-a),200*(a-n),t.opacity)}function qj(t,e,n,i){return 1===arguments.length?Hj(t):new Xj(t,e,n,null==i?1:i)}function Xj(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function Yj(t){return t>.008856451679035631?Math.pow(t,1/3):t/Gj+jj}function Kj(t){return t>Uj?t*t*t:Gj*(t-jj)}function Zj(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Jj(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qj(t){if(t instanceof eU)return new eU(t.h,t.c,t.l,t.opacity);if(t instanceof Xj||(t=Hj(t)),0===t.a&&0===t.b)return new eU(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Wj;return new eU(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function tU(t,e,n,i){return 1===arguments.length?Qj(t):new eU(t,e,n,null==i?1:i)}function eU(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function nU(t){if(isNaN(t.h))return new Xj(t.l,0,0,t.opacity);var e=t.h*Vj;return new Xj(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}cj(Xj,qj,hj(dj,{brighter:function(t){return new Xj(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Xj(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Nj(Zj(3.1338561*(e=.96422*Kj(e))-1.6168667*(t=1*Kj(t))-.4906146*(n=.82521*Kj(n))),Zj(-.9787684*e+1.9161415*t+.033454*n),Zj(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),cj(eU,tU,hj(dj,{brighter:function(t){return new eU(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new eU(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return nU(this).rgb()}}));var iU=-.14861,rU=1.78277,oU=-.29227,aU=-.90649,sU=1.97294,lU=sU*aU,uU=sU*rU,cU=rU*oU-aU*iU;function hU(t){if(t instanceof pU)return new pU(t.h,t.s,t.l,t.opacity);t instanceof Nj||(t=Tj(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(cU*i+lU*e-uU*n)/(cU+lU-uU),o=i-r,a=(sU*(n-r)-oU*o)/aU,s=Math.sqrt(a*a+o*o)/(sU*r*(1-r)),l=s?Math.atan2(a,o)*Wj-120:NaN;return new pU(l<0?l+360:l,s,r,t.opacity)}function dU(t,e,n,i){return 1===arguments.length?hU(t):new pU(t,e,n,null==i?1:i)}function pU(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function fU(t,e,n,i,r){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*i+a*r)/6}function gU(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],a=i>0?t[i-1]:2*r-o,s=i<e-1?t[i+2]:2*o-r;return fU((n-i/e)*e,a,r,o,s)}}function mU(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],o=t[i%e],a=t[(i+1)%e],s=t[(i+2)%e];return fU((n-i/e)*e,r,o,a,s)}}cj(pU,dU,hj(dj,{brighter:function(t){return t=null==t?pj:Math.pow(pj,t),new pU(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new pU(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Vj,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new Nj(255*(e+n*(iU*i+rU*r)),255*(e+n*(oU*i+aU*r)),255*(e+n*(sU*i)),this.opacity)}}));var yU=t=>()=>t;function vU(t,e){return function(n){return t+n*e}}function xU(t,e){var n=e-t;return n?vU(t,n>180||n<-180?n-360*Math.round(n/360):n):yU(isNaN(t)?e:t)}function bU(t){return 1==(t=+t)?wU:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):yU(isNaN(e)?n:e)}}function wU(t,e){var n=e-t;return n?vU(t,n):yU(isNaN(t)?e:t)}var _U=function t(e){var n=bU(e);function i(t,e){var i=n((t=Ej(t)).r,(e=Ej(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),a=wU(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);function kU(t){return function(e){var n,i,r=e.length,o=new Array(r),a=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=Ej(e[n]),o[n]=i.r||0,a[n]=i.g||0,s[n]=i.b||0;return o=t(o),a=t(a),s=t(s),i.opacity=1,function(t){return i.r=o(t),i.g=a(t),i.b=s(t),i+""}}}var SU=kU(gU),CU=kU(mU);function AU(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(o){for(n=0;n<i;++n)r[n]=t[n]*(1-o)+e[n]*o;return r}}function IU(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function MU(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),a=new Array(i);for(n=0;n<r;++n)o[n]=RU(t[n],e[n]);for(;n<i;++n)a[n]=e[n];return function(t){for(n=0;n<r;++n)a[n]=o[n](t);return a}}function DU(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function TU(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function EU(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=RU(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}}var NU=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,OU=new RegExp(NU.source,"g");function FU(t,e){var n,i,r,o=NU.lastIndex=OU.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=NU.exec(t))&&(i=OU.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:TU(n,i)})),o=OU.lastIndex;return o<e.length&&(r=e.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function RU(t,e){var n,i=typeof e;return null==e||"boolean"===i?yU(e):("number"===i?TU:"string"===i?(n=Ij(e))?(e=n,_U):FU:e instanceof Ij?_U:e instanceof Date?DU:IU(e)?AU:Array.isArray(e)?MU:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?EU:TU)(t,e)}function LU(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var $U,PU=180/Math.PI,zU={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function BU(t,e,n,i,r,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*PU,skewX:Math.atan(l)*PU,scaleX:a,scaleY:s}}function VU(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,i,r,o,a,s){if(t!==r||i!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:TU(t,r)},{i:l-2,x:TU(i,o)})}else(r||o)&&a.push("translate("+r+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:TU(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:TU(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(o.skewX,a.skewX,s,l),function(t,e,n,i,o,a){if(t!==n||e!==i){var s=o.push(r(o)+"scale(",null,",",null,")");a.push({i:s-4,x:TU(t,n)},{i:s-2,x:TU(e,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var WU=VU((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?zU:BU(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),jU=VU((function(t){return null==t?zU:($U||($U=document.createElementNS("http://www.w3.org/2000/svg","g")),$U.setAttribute("transform",t),(t=$U.transform.baseVal.consolidate())?BU((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):zU)}),", ",")",")");function UU(t){return((t=Math.exp(t))+1/t)/2}var GU=function t(e,n,i){function r(t,r){var o,a,s=t[0],l=t[1],u=t[2],c=r[0],h=r[1],d=r[2],p=c-s,f=h-l,g=p*p+f*f;if(g<1e-12)a=Math.log(d/u)/e,o=function(t){return[s+t*p,l+t*f,u*Math.exp(e*t*a)]};else{var m=Math.sqrt(g),y=(d*d-u*u+i*g)/(2*u*n*m),v=(d*d-u*u-i*g)/(2*d*n*m),x=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(v*v+1)-v);a=(b-x)/e,o=function(t){var i,r=t*a,o=UU(x),c=u/(n*m)*(o*(i=e*r+x,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(x));return[s+c*p,l+c*f,u*o/UU(e*r+x)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);function HU(t){return function(e,n){var i=t((e=Pj(e)).h,(n=Pj(n)).h),r=wU(e.s,n.s),o=wU(e.l,n.l),a=wU(e.opacity,n.opacity);return function(t){return e.h=i(t),e.s=r(t),e.l=o(t),e.opacity=a(t),e+""}}}var qU=HU(xU),XU=HU(wU);function YU(t){return function(e,n){var i=t((e=tU(e)).h,(n=tU(n)).h),r=wU(e.c,n.c),o=wU(e.l,n.l),a=wU(e.opacity,n.opacity);return function(t){return e.h=i(t),e.c=r(t),e.l=o(t),e.opacity=a(t),e+""}}}var KU=YU(xU),ZU=YU(wU);function JU(t){return function e(n){function i(e,i){var r=t((e=dU(e)).h,(i=dU(i)).h),o=wU(e.s,i.s),a=wU(e.l,i.l),s=wU(e.opacity,i.opacity);return function(t){return e.h=r(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,i.gamma=e,i}(1)}var QU=JU(xU),tG=JU(wU);function eG(t,e){void 0===e&&(e=t,t=RU);for(var n=0,i=e.length-1,r=e[0],o=new Array(i<0?0:i);n<i;)o[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return o[e](t-e)}}var nG=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",interpolate:RU,interpolateArray:function(t,e){return(IU(e)?AU:MU)(t,e)},interpolateBasis:gU,interpolateBasisClosed:mU,interpolateDate:DU,interpolateDiscrete:function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},interpolateHue:function(t,e){var n=xU(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},interpolateNumber:TU,interpolateNumberArray:AU,interpolateObject:EU,interpolateRound:LU,interpolateString:FU,interpolateTransformCss:WU,interpolateTransformSvg:jU,interpolateZoom:GU,interpolateRgb:_U,interpolateRgbBasis:SU,interpolateRgbBasisClosed:CU,interpolateHsl:qU,interpolateHslLong:XU,interpolateLab:function(t,e){var n=wU((t=qj(t)).l,(e=qj(e)).l),i=wU(t.a,e.a),r=wU(t.b,e.b),o=wU(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=i(e),t.b=r(e),t.opacity=o(e),t+""}},interpolateHcl:KU,interpolateHclLong:ZU,interpolateCubehelix:QU,interpolateCubehelixLong:tG,piecewise:eG,quantize:function(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t(i/(e-1));return n}});function iG(t){return+t}var rG=[0,1];function oG(t){return t}function aG(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function sG(t,e,n){var i=t[0],r=t[1],o=e[0],a=e[1];return r<i?(i=aG(r,i),o=n(a,o)):(i=aG(i,r),o=n(o,a)),function(t){return o(i(t))}}function lG(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),o=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<i;)r[a]=aG(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=UF(t,e,1,i)-1;return o[n](r[n](e))}}function uG(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function cG(){var t,e,n,i,r,o,a=rG,s=rG,l=RU,u=oG;function c(){var t,e,n,l=Math.min(a.length,s.length);return u!==oG&&(t=a[0],e=a[l-1],t>e&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),i=l>2?lG:sG,r=o=null,h}function h(e){return null==e||isNaN(e=+e)?n:(r||(r=i(a.map(t),s,l)))(t(u(e)))}return h.invert=function(n){return u(e((o||(o=i(s,a.map(t),TU)))(n)))},h.domain=function(t){return arguments.length?(a=Array.from(t,iG),c()):a.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),c()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),l=LU,c()},h.clamp=function(t){return arguments.length?(u=!!t||oG,c()):u!==oG},h.interpolate=function(t){return arguments.length?(l=t,c()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,i){return t=n,e=i,c()}}function hG(){return cG()(oG,oG)}function dG(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function pG(t){return(t=dG(Math.abs(t)))?t[1]:NaN}var fG,gG=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mG(t){return new yG(t)}function yG(t){if(!(e=gG.exec(t)))throw new Error("invalid format: "+t);var e;this.fill=e[1]||" ",this.align=e[2]||">",this.sign=e[3]||"-",this.symbol=e[4]||"",this.zero=!!e[5],this.width=e[6]&&+e[6],this.comma=!!e[7],this.precision=e[8]&&+e[8].slice(1),this.trim=!!e[9],this.type=e[10]||""}function vG(t,e){var n=dG(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}mG.prototype=yG.prototype,yG.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var xG={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return vG(100*t,e)},r:vG,s:function(t,e){var n=dG(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(fG=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+dG(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function bG(t){return t}var wG,_G,kG,SG=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function CG(t){var e,n,i=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,i){for(var r=t.length,o=[],a=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}):bG,r=t.currency,o=t.decimal,a=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(t.numerals):bG,s=t.percent||"%";function l(t){var e=(t=mG(t)).fill,n=t.align,l=t.sign,u=t.symbol,c=t.zero,h=t.width,d=t.comma,p=t.precision,f=t.trim,g=t.type;"n"===g?(d=!0,g="g"):xG[g]||(null==p&&(p=12),f=!0,g="g"),(c||"0"===e&&"="===n)&&(c=!0,e="0",n="=");var m="$"===u?r[0]:"#"===u&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",y="$"===u?r[1]:/[%p]/.test(g)?s:"",v=xG[g],x=/[defgprs%]/.test(g);function b(t){var r,s,u,b=m,w=y;if("c"===g)w=v(t)+w,t="";else{var _=(t=+t)<0;if(t=v(Math.abs(t),p),f&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(r>0){if(!+t[i])break t;r=0}}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),_&&0==+t&&(_=!1),b=(_?"("===l?l:"-":"-"===l||"("===l?"":l)+b,w=("s"===g?SG[8+fG/3]:"")+w+(_&&"("===l?")":""),x)for(r=-1,s=t.length;++r<s;)if(48>(u=t.charCodeAt(r))||u>57){w=(46===u?o+t.slice(r+1):t.slice(r))+w,t=t.slice(0,r);break}}d&&!c&&(t=i(t,1/0));var k=b.length+t.length+w.length,S=k<h?new Array(h-k+1).join(e):"";switch(d&&c&&(t=i(S+t,S.length?h-w.length:1/0),S=""),n){case"<":t=b+t+w+S;break;case"=":t=b+S+t+w;break;case"^":t=S.slice(0,k=S.length>>1)+b+t+w+S.slice(k);break;default:t=S+b+t+w}return a(t)}return p=null==p?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,p)):Math.max(0,Math.min(20,p)),b.toString=function(){return t+""},b}return{format:l,formatPrefix:function(t,e){var n=l(((t=mG(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(pG(e)/3))),r=Math.pow(10,-i),o=SG[8+i/3];return function(t){return n(r*t)+o}}}}function AG(t){return wG=CG(t),_G=wG.format,kG=wG.formatPrefix,wG}function IG(t){return Math.max(0,-pG(Math.abs(t)))}function MG(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(pG(e)/3)))-pG(Math.abs(t)))}function DG(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,pG(e)-pG(t))+1}AG({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var TG=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",formatDefaultLocale:AG,get format(){return _G},get formatPrefix(){return kG},formatLocale:CG,formatSpecifier:mG,precisionFixed:IG,precisionPrefix:MG,precisionRound:DG});function EG(t,e,n,i){var r,o=JF(t,e,n);switch((i=mG(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=MG(o,a))||(i.precision=r),kG(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=DG(o,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=IG(o))||(i.precision=r-2*("%"===i.type))}return _G(i)}function NG(t){var e=t.domain;return t.ticks=function(t){var n=e();return KF(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return EG(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,o=e(),a=0,s=o.length-1,l=o[a],u=o[s],c=10;for(u<l&&(r=l,l=u,u=r,r=a,a=s,s=r);c-- >0;){if((r=ZF(l,u,n))===i)return o[a]=l,o[s]=u,e(o);if(r>0)l=Math.floor(l/r)*r,u=Math.ceil(u/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,u=Math.floor(u*r)/r}i=r}return t},t}function OG(t,e){var n,i=0,r=(t=t.slice()).length-1,o=t[i],a=t[r];return a<o&&(n=i,i=r,r=n,n=o,o=a,a=n),t[i]=e.floor(o),t[r]=e.ceil(a),t}function FG(t){return Math.log(t)}function RG(t){return Math.exp(t)}function LG(t){return-Math.log(-t)}function $G(t){return-Math.exp(-t)}function PG(t){return isFinite(t)?+("1e"+t):t<0?0:t}function zG(t){return function(e){return-t(-e)}}function BG(t){var e,n,i=t(FG,RG),r=i.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?PG:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),r()[0]<0?(e=zG(e),n=zG(n),t(LG,$G)):t(FG,RG),i}return i.base=function(t){return arguments.length?(o=+t,a()):o},i.domain=function(t){return arguments.length?(r(t),a()):r()},i.ticks=function(t){var i,a=r(),s=a[0],l=a[a.length-1];(i=l<s)&&(d=s,s=l,l=d);var u,c,h,d=e(s),p=e(l),f=null==t?10:+t,g=[];if(!(o%1)&&p-d<f){if(d=Math.floor(d),p=Math.ceil(p),s>0){for(;d<=p;++d)for(c=1,u=n(d);c<o;++c)if(!((h=u*c)<s)){if(h>l)break;g.push(h)}}else for(;d<=p;++d)for(c=o-1,u=n(d);c>=1;--c)if(!((h=u*c)<s)){if(h>l)break;g.push(h)}2*g.length<f&&(g=KF(s,l,f))}else g=KF(d,p,Math.min(p-d,f)).map(n);return i?g.reverse():g},i.tickFormat=function(t,r){if(null==r&&(r=10===o?".0e":","),"function"!=typeof r&&(r=_G(r)),t===1/0)return r;null==t&&(t=10);var a=Math.max(1,o*t/i.ticks().length);return function(t){var i=t/n(Math.round(e(t)));return i*o<o-.5&&(i*=o),i<=a?r(t):""}},i.nice=function(){return r(OG(r(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},i}function VG(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function WG(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function jG(t){var e=1,n=t(VG(e),WG(e));return n.constant=function(n){return arguments.length?t(VG(e=+n),WG(e)):e},NG(n)}function UG(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function GG(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function HG(t){return t<0?-t*t:t*t}function qG(t){var e=t(oG,oG),n=1;function i(){return 1===n?t(oG,oG):.5===n?t(GG,HG):t(UG(n),UG(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,i()):n},NG(e)}function XG(){var t=qG(cG());return t.copy=function(){return uG(t,XG()).exponent(t.exponent())},aj.apply(t,arguments),t}function YG(t){return new Date(t)}function KG(t){return t instanceof Date?+t:+new Date(+t)}function ZG(t,e,n,i,r,o,a,s,l,u){var c=hG(),h=c.invert,d=c.domain,p=u(".%L"),f=u(":%S"),g=u("%I:%M"),m=u("%I %p"),y=u("%a %d"),v=u("%b %d"),x=u("%B"),b=u("%Y");function w(t){return(l(t)<t?p:s(t)<t?f:a(t)<t?g:o(t)<t?m:i(t)<t?r(t)<t?y:v:n(t)<t?x:b)(t)}return c.invert=function(t){return new Date(h(t))},c.domain=function(t){return arguments.length?d(Array.from(t,KG)):d().map(YG)},c.ticks=function(e){var n=d();return t(n[0],n[n.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?w:u(e)},c.nice=function(t){var n=d();return t&&"function"==typeof t.range||(t=e(n[0],n[n.length-1],null==t?10:t)),t?d(OG(n,t)):c},c.copy=function(){return uG(c,ZG(t,e,n,i,r,o,a,s,l,u))},c}function JG(){var t,e,n,i,r,o=0,a=1,s=oG,l=!1;function u(e){return null==e||isNaN(e=+e)?r:s(0===n?.5:(e=(i(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,i;return arguments.length?([n,i]=e,s=t(n,i),u):[s(0),s(1)]}}return u.domain=function(r){return arguments.length?([o,a]=r,t=i(o=+o),e=i(a=+a),n=t===e?0:1/(e-t),u):[o,a]},u.clamp=function(t){return arguments.length?(l=!!t,u):l},u.interpolator=function(t){return arguments.length?(s=t,u):s},u.range=c(RU),u.rangeRound=c(LU),u.unknown=function(t){return arguments.length?(r=t,u):r},function(r){return i=r,t=r(o),e=r(a),n=t===e?0:1/(e-t),u}}function QG(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function tH(){var t=NG(JG()(oG));return t.copy=function(){return QG(t,tH())},sj.apply(t,arguments)}function eH(){var t=qG(JG());return t.copy=function(){return QG(t,eH()).exponent(t.exponent())},sj.apply(t,arguments)}function nH(){var t,e,n,i,r,o,a,s=0,l=.5,u=1,c=1,h=oG,d=!1;function p(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(c*t<c*e?i:r),h(d?Math.max(0,Math.min(1,t)):t))}function f(t){return function(e){var n,i,r;return arguments.length?([n,i,r]=e,h=eG(t,[n,i,r]),p):[h(0),h(.5),h(1)]}}return p.domain=function(a){return arguments.length?([s,l,u]=a,t=o(s=+s),e=o(l=+l),n=o(u=+u),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,p):[s,l,u]},p.clamp=function(t){return arguments.length?(d=!!t,p):d},p.interpolator=function(t){return arguments.length?(h=t,p):h},p.range=f(RU),p.rangeRound=f(LU),p.unknown=function(t){return arguments.length?(a=t,p):a},function(a){return o=a,t=a(s),e=a(l),n=a(u),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,p}}function iH(){var t=qG(nH());return t.copy=function(){return QG(t,iH()).exponent(t.exponent())},sj.apply(t,arguments)}function rH(t,e,n){const i=t-e+2*n;return t?i>0?i:1:0}const oH="log",aH="pow",sH="time",lH="utc",uH="sequential",cH="continuous";function hH(){const t=uj().unknown(void 0),e=t.domain,n=t.range;let i,r,o=[0,1],a=!1,s=0,l=0,u=.5;function c(){const t=e().length,c=o[1]<o[0],h=o[1-c],d=rH(t,s,l);let p=o[c-0];i=(h-p)/(d||1),a&&(i=Math.floor(i)),p+=(h-p-i*(t-s))*u,r=i*(1-s),a&&(p=Math.round(p),r=Math.round(r));const f=sR(t).map((t=>p+i*t));return n(c?f.reverse():f)}return delete t.unknown,t.domain=function(t){return arguments.length?(e(t),c()):e()},t.range=function(t){return arguments.length?(o=[+t[0],+t[1]],c()):o.slice()},t.rangeRound=function(t){return o=[+t[0],+t[1]],a=!0,c()},t.bandwidth=function(){return r},t.step=function(){return i},t.round=function(t){return arguments.length?(a=!!t,c()):a},t.padding=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),s=l,c()):s},t.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},t.paddingOuter=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},t.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},t.invertRange=function(t){if(null==t[0]||null==t[1])return;const i=o[1]<o[0],a=i?n().reverse():n(),s=a.length-1;let l,u,c,h=+t[0],d=+t[1];return h!=h||d!=d||(d<h&&(c=h,h=d,d=c),d<a[0]||h>o[1-i])?void 0:(l=Math.max(0,UF(a,h)-1),u=h===d?l:UF(a,d)-1,h-a[l]>r+1e-10&&++l,i&&(c=l,l=s-u,u=s-c),l>u?void 0:e().slice(l,u+1))},t.invert=function(e){const n=t.invertRange([e,e]);return n?n[0]:n},t.copy=function(){return hH().domain(e()).range(o).round(a).paddingInner(s).paddingOuter(l).align(u)},c()}function dH(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return dH(e())},t}var pH=Array.prototype.map;function fH(t){return pH.call(t,ZN)}const gH=Array.prototype.slice;const mH={};function yH(t,e,n){const i=function(){const n=e();return n.invertRange||(n.invertRange=n.invert?function(t){return function(e){let n,i=e[0],r=e[1];return r<i&&(n=i,i=r,r=n),[t.invert(i),t.invert(r)]}}(n):n.invertExtent?function(t){return function(e){const n=t.range();let i,r,o,a,s=e[0],l=e[1],u=-1;for(l<s&&(r=s,s=l,l=r),o=0,a=n.length;o<a;++o)n[o]>=s&&n[o]<=l&&(u<0&&(u=o),i=o);if(!(u<0))return s=t.invertExtent(n[u]),l=t.invertExtent(n[i]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=t,n};return i.metadata=QO(gO(n)),i}function vH(t,e,n){return arguments.length>1?(mH[t]=yH(t,e,n),this):xH(t)?mH[t]:void 0}function xH(t){return DO(mH,t)}function bH(t,e){const n=mH[t];return n&&n.metadata[e]}function wH(t){return bH(t,cH)}function _H(t){return bH(t,"discrete")}function kH(t){return bH(t,"discretizing")}function SH(t){return bH(t,oH)}function CH(t){return bH(t,"interpolating")}function AH(t){return bH(t,"quantile")}vH("identity",(function t(e){var n;function i(t){return null==t||isNaN(t=+t)?n:t}return i.invert=i,i.domain=i.range=function(t){return arguments.length?(e=Array.from(t,iG),i):e.slice()},i.unknown=function(t){return arguments.length?(n=t,i):n},i.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,iG):[0,1],NG(i)})),vH("linear",(function t(){var e=hG();return e.copy=function(){return uG(e,t())},aj.apply(e,arguments),NG(e)}),cH),vH(oH,(function t(){var e=BG(cG()).domain([1,10]);return e.copy=function(){return uG(e,t()).base(e.base())},aj.apply(e,arguments),e}),[cH,oH]),vH("pow",XG,cH),vH("sqrt",(function(){return XG.apply(null,arguments).exponent(.5)}),cH),vH("symlog",(function t(){var e=jG(cG());return e.copy=function(){return uG(e,t()).constant(e.constant())},aj.apply(e,arguments)}),cH),vH(sH,(function(){return aj.apply(ZG(KR,ZR,$R,LR,OR,ER,TR,DR,MR,r$).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[cH,"temporal"]),vH(lH,(function(){return aj.apply(ZG(XR,YR,HR,GR,WR,BR,zR,PR,MR,a$).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[cH,"temporal"]),vH("sequential",tH,[cH,"interpolating"]),vH("".concat("sequential","-").concat("linear"),tH,[cH,"interpolating"]),vH("".concat("sequential","-").concat(oH),(function t(){var e=BG(JG()).domain([1,10]);return e.copy=function(){return QG(e,t()).base(e.base())},sj.apply(e,arguments)}),[cH,"interpolating",oH]),vH("".concat("sequential","-").concat("pow"),eH,[cH,"interpolating"]),vH("".concat("sequential","-").concat("sqrt"),(function(){return eH.apply(null,arguments).exponent(.5)}),[cH,"interpolating"]),vH("".concat("sequential","-").concat("symlog"),(function t(){var e=jG(JG());return e.copy=function(){return QG(e,t()).constant(e.constant())},sj.apply(e,arguments)}),[cH,"interpolating"]),vH("".concat("diverging","-").concat("linear"),(function t(){var e=NG(nH()(oG));return e.copy=function(){return QG(e,t())},sj.apply(e,arguments)}),[cH,"interpolating"]),vH("".concat("diverging","-").concat(oH),(function t(){var e=BG(nH()).domain([.1,1,10]);return e.copy=function(){return QG(e,t()).base(e.base())},sj.apply(e,arguments)}),[cH,"interpolating",oH]),vH("".concat("diverging","-").concat("pow"),iH,[cH,"interpolating"]),vH("".concat("diverging","-").concat("sqrt"),(function(){return iH.apply(null,arguments).exponent(.5)}),[cH,"interpolating"]),vH("".concat("diverging","-").concat("symlog"),(function t(){var e=jG(nH());return e.copy=function(){return QG(e,t()).constant(e.constant())},sj.apply(e,arguments)}),[cH,"interpolating"]),vH("quantile",(function t(){var e,n=[],i=[],r=[];function o(){var t=0,e=Math.max(1,i.length);for(r=new Array(e-1);++t<e;)r[t-1]=rR(n,t/e);return a}function a(t){return null==t||isNaN(t=+t)?e:i[UF(r,t)]}return a.invertExtent=function(t){var e=i.indexOf(t);return e<0?[NaN,NaN]:[e>0?r[e-1]:n[0],e<r.length?r[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(BF),o()},a.range=function(t){return arguments.length?(i=Array.from(t),o()):i.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return r.slice()},a.copy=function(){return t().domain(n).range(i).unknown(e)},aj.apply(a,arguments)}),["discretizing","quantile"]),vH("quantize",(function t(){var e,n=0,i=1,r=1,o=[.5],a=[0,1];function s(t){return null!=t&&t<=t?a[UF(o,t,0,r)]:e}function l(){var t=-1;for(o=new Array(r);++t<r;)o[t]=((t+1)*i-(t-r)*n)/(r+1);return s}return s.domain=function(t){return arguments.length?([n,i]=t,n=+n,i=+i,l()):[n,i]},s.range=function(t){return arguments.length?(r=(a=Array.from(t)).length-1,l()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=r?[o[r-1],i]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,i]).range(a).unknown(e)},aj.apply(NG(s),arguments)}),"discretizing"),vH("threshold",(function t(){var e,n=[.5],i=[0,1],r=1;function o(t){return null!=t&&t<=t?i[UF(n,t,0,r)]:e}return o.domain=function(t){return arguments.length?(n=Array.from(t),r=Math.min(n.length,i.length-1),o):n.slice()},o.range=function(t){return arguments.length?(i=Array.from(t),r=Math.min(n.length,i.length-1),o):i.slice()},o.invertExtent=function(t){var e=i.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(i).unknown(e)},aj.apply(o,arguments)}),"discretizing"),vH("bin-ordinal",(function t(){let e=[],n=[];function i(t){return null==t||t!=t?void 0:n[(UF(e,t)-1)%n.length]}return i.domain=function(t){return arguments.length?(e=fH(t),i):e.slice()},i.range=function(t){return arguments.length?(n=gH.call(t),i):n.slice()},i.tickFormat=function(t,n){return EG(e[0],KN(e),null==t?10:t,n)},i.copy=function(){return t().domain(i.domain()).range(i.range())},i}),["discrete","discretizing"]),vH("ordinal",uj,"discrete"),vH("band",hH,"discrete"),vH("point",(function(){return dH(hH().paddingInner(1))}),"discrete");const IH=["clamp","base","constant","exponent"];function MH(t,e){const n=e[0],i=KN(e)-n;return function(e){return t(n+e*i)}}function DH(t,e,n){return eG(NH(e||"rgb",n),t)}function TH(t,e){const n=new Array(e),i=e+1;for(let r=0;r<e;)n[r]=t(++r/i);return n}function EH(t,e,n){const i=n-e;let r,o,a;return i&&Number.isFinite(i)?(r=(o=t.type).indexOf("-"),o=r<0?o:o.slice(r+1),a=vH(o)().domain([e,n]).range([0,1]),IH.forEach((e=>t[e]?a[e](t[e]()):0)),a):kO(.5)}function NH(t,e){const n=nG[function(t){return"interpolate"+t.toLowerCase().split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function OH(t){const e=t.length/6|0,n=new Array(e);for(let i=0;i<e;)n[i]="#"+t.slice(6*i,6*++i);return n}function FH(t,e){for(const n in t)LH(n,e(t[n]))}const RH={};function LH(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(RH[t]=e,this):RH[t]}FH({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},OH),FH({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(t=>DH(OH(t))));const $H=t=>UN(t)?t.map((t=>String(t))):String(t),PH=(t,e)=>t[1]-e[1],zH=(t,e)=>e[1]-t[1];function BH(t,e,n){let i;return PO(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(qO(t.domain())/n||1)))),GN(e)&&(i=e.step,e=e.interval),BO(e)&&(e=t.type===sH?LL(e):t.type==lH?$L(e):ON("Only time and utc scales accept interval strings."),i&&(e=e.every(i))),e}function VH(t,e,n){let i=t.range(),r=i[0],o=KN(i),a=PH;if(r>o&&(i=o,o=r,r=i,a=zH),r=Math.floor(r),o=Math.ceil(o),e=e.map((e=>[e,t(e)])).filter((t=>r<=t[1]&&t[1]<=o)).sort(a).map((t=>t[0])),n>0&&e.length>1){const t=[e[0],KN(e)];for(;e.length>n&&e.length>=3;)e=e.filter(((t,e)=>!(e%2)));e.length<3&&(e=t)}return e}function WH(t,e){return t.bins?VH(t,t.bins):t.ticks?t.ticks(e):t.domain()}function jH(t,e,n,i,r,o){const a=e.type;let s=$H;if(a===sH||r===sH)s=t.timeFormat(i);else if(a===lH||r===lH)s=t.utcFormat(i);else if(SH(a)){const r=t.formatFloat(i);if(o||e.bins)s=r;else{const t=UH(e,n,!1);s=e=>t(e)?r(e):""}}else if(e.tickFormat){const r=e.domain();s=t.formatSpan(r[0],r[r.length-1],n,i)}else i&&(s=t.format(i));return s}function UH(t,e,n){const i=WH(t,e),r=t.base(),o=Math.log(r),a=Math.max(1,r*e/i.length),s=t=>{let e=t/Math.pow(r,Math.round(Math.log(t)/o));return e*r<r-.5&&(e*=r),e<=a};return n?i.filter(s):s}const GH={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},HH={quantile:"quantiles",quantize:"domain"};function qH(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=KN(t),e}(t.bins):t.type===oH?UH(t,e,!0):GH[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[GH[t.type]]()):WH(t,e)}function XH(t,e,n,i,r,o,a){const s=HH[e.type]&&o!==sH&&o!==lH?function(t,e,n){const i=e[HH[e.type]](),r=i.length;let o,a=r>1?i[1]-i[0]:i[0];for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return t.formatSpan(0,a,30,n)}(t,e,r):jH(t,e,n,r,o,a);return"symbol"===i&&(t=>GH[t.type]||t.bins)(e)?YH(s):"discrete"===i?ZH(s):JH(s)}const YH=t=>(e,n,i)=>{const r=KH(i[n+1],KH(i.max,1/0)),o=QH(e,t),a=QH(r,t);return o&&a?o+" – "+a:a?"< "+a:"≥ "+o},KH=(t,e)=>null!=t?t:e,ZH=t=>(e,n)=>n?t(e):null,JH=t=>e=>t(e),QH=(t,e)=>Number.isFinite(t)?e(t):null;function tq(t,e,n,i){const r=i||e.type;return BO(n)&&bH(r,"temporal")&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||r!==sH?n||r!==lH?XH(t,e,5,null,n,i,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}function eq(t,e,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=tq(t,e,n.format,n.formatType);if(kH(e.type)){const t=qH(e).slice(1).map(r),n=t.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(t.join(", "))}if(_H(e.type)){const t=e.domain(),n=t.length,o=n>i?t.slice(0,i-2).map(r).join(", ")+", ending with "+t.slice(-1).map(r):t.map(r).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(o)}{const t=e.domain();return"values from ".concat(r(t[0])," to ").concat(r(KN(t)))}}let nq=0;function iq(t){return t&&t.gradient}function rq(t,e,n){const i=t.gradient;let r=t.id,o="radial"===i?"p_":"";return r||(r=t.id="gradient_"+nq++,"radial"===i?(t.x1=oq(t.x1,.5),t.y1=oq(t.y1,.5),t.r1=oq(t.r1,0),t.x2=oq(t.x2,.5),t.y2=oq(t.y2,.5),t.r2=oq(t.r2,.5),o="p_"):(t.x1=oq(t.x1,0),t.y1=oq(t.y1,0),t.x2=oq(t.x2,1),t.y2=oq(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+o+r+")"}function oq(t,e){return null!=t?t:e}function aq(t,e){var n,i=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}}const sq={basis:{curve:function(t){return new DW(t)}},"basis-closed":{curve:function(t){return new TW(t)}},"basis-open":{curve:function(t){return new EW(t)}},bundle:{curve:OW,tension:"beta",value:.85},cardinal:{curve:LW,tension:"tension",value:0},"cardinal-open":{curve:BW,tension:"tension",value:0},"cardinal-closed":{curve:PW,tension:"tension",value:0},"catmull-rom":{curve:jW,tension:"alpha",value:.5},"catmull-rom-closed":{curve:GW,tension:"alpha",value:.5},"catmull-rom-open":{curve:qW,tension:"alpha",value:.5},linear:{curve:wW},"linear-closed":{curve:function(t){return new XW(t)}},monotone:{horizontal:function(t){return new tj(t)},vertical:function(t){return new QW(t)}},natural:{curve:function(t){return new nj(t)}},step:{curve:function(t){return new rj(t,.5)}},"step-after":{curve:function(t){return new rj(t,1)}},"step-before":{curve:function(t){return new rj(t,0)}}};function lq(t,e,n){var i=DO(sq,t)&&sq[t],r=null;return i&&(r=i.curve||i[e||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}const uq={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},cq=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function hq(t){const e=[];let n,i,r,o,a,s,l,u,c,h;const d=t.slice().replace(cq[0],"###$1").split(cq[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],i=n.slice(1).trim().replace(cq[2],"$1###$2").replace(cq[3],"$1###$2").split(cq[4]),a=n.charAt(0),r=[a],u=0,h=i.length;u<h;++u)(o=+i[u])===o&&r.push(o);if(s=uq[a.toLowerCase()],r.length-1>s){const t=r.length;for(u=1,e.push([a].concat(r.slice(u,u+=s))),a="M"===a?"L":"m"===a?"l":a;u<t;u+=s)e.push([a].concat(r.slice(u,u+s)))}else e.push(r)}return e}const dq=Math.PI/180,pq=Math.PI/2,fq=2*Math.PI,gq=Math.sqrt(3)/2;var mq={},yq={},vq=[].join;function xq(t){const e=vq.call(t);if(yq[e])return yq[e];var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7];const c=u*a,h=-l*s,d=l*a,p=u*s,f=Math.cos(r),g=Math.sin(r),m=Math.cos(o),y=Math.sin(o),v=.5*(o-r),x=Math.sin(.5*v),b=8/3*x*x/Math.sin(v),w=n+f-b*g,_=i+g+b*f,k=n+m,S=i+y,C=k+b*y,A=S-b*m;return yq[e]=[c*w+h*_,d*w+p*_,c*C+h*A,d*C+p*A,c*k+h*S,d*k+p*S]}const bq=["l",0,0,0,0,0,0,0];function wq(t,e,n){const i=bq[0]=t[0];if("a"===i||"A"===i)bq[1]=e*t[1],bq[2]=n*t[2],bq[3]=t[3],bq[4]=t[4],bq[5]=t[5],bq[6]=e*t[6],bq[7]=n*t[7];else if("h"===i||"H"===i)bq[1]=e*t[1];else if("v"===i||"V"===i)bq[1]=n*t[1];else for(var r=1,o=t.length;r<o;++r)bq[r]=(r%2==1?e:n)*t[r];return bq}function _q(t,e,n,i,r,o){var a,s,l,u,c,h=null,d=0,p=0,f=0,g=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==o&&(o=r),t.beginPath&&t.beginPath();for(var m=0,y=e.length;m<y;++m){switch(a=e[m],1===r&&1===o||(a=wq(a,r,o)),a[0]){case"l":d+=a[1],p+=a[2],t.lineTo(d+n,p+i);break;case"L":d=a[1],p=a[2],t.lineTo(d+n,p+i);break;case"h":d+=a[1],t.lineTo(d+n,p+i);break;case"H":d=a[1],t.lineTo(d+n,p+i);break;case"v":p+=a[1],t.lineTo(d+n,p+i);break;case"V":p=a[1],t.lineTo(d+n,p+i);break;case"m":d+=a[1],p+=a[2],t.moveTo(d+n,p+i);break;case"M":d=a[1],p=a[2],t.moveTo(d+n,p+i);break;case"c":s=d+a[5],l=p+a[6],f=d+a[3],g=p+a[4],t.bezierCurveTo(d+a[1]+n,p+a[2]+i,f+n,g+i,s+n,l+i),d=s,p=l;break;case"C":d=a[5],p=a[6],f=a[3],g=a[4],t.bezierCurveTo(a[1]+n,a[2]+i,f+n,g+i,d+n,p+i);break;case"s":s=d+a[3],l=p+a[4],f=2*d-f,g=2*p-g,t.bezierCurveTo(f+n,g+i,d+a[1]+n,p+a[2]+i,s+n,l+i),f=d+a[1],g=p+a[2],d=s,p=l;break;case"S":s=a[3],l=a[4],f=2*d-f,g=2*p-g,t.bezierCurveTo(f+n,g+i,a[1]+n,a[2]+i,s+n,l+i),d=s,p=l,f=a[1],g=a[2];break;case"q":s=d+a[3],l=p+a[4],f=d+a[1],g=p+a[2],t.quadraticCurveTo(f+n,g+i,s+n,l+i),d=s,p=l;break;case"Q":s=a[3],l=a[4],t.quadraticCurveTo(a[1]+n,a[2]+i,s+n,l+i),d=s,p=l,f=a[1],g=a[2];break;case"t":s=d+a[1],l=p+a[2],null===h[0].match(/[QqTt]/)?(f=d,g=p):"t"===h[0]?(f=2*d-u,g=2*p-c):"q"===h[0]&&(f=2*d-f,g=2*p-g),u=f,c=g,t.quadraticCurveTo(f+n,g+i,s+n,l+i),p=l,f=(d=s)+a[1],g=p+a[2];break;case"T":s=a[1],l=a[2],f=2*d-f,g=2*p-g,t.quadraticCurveTo(f+n,g+i,s+n,l+i),d=s,p=l;break;case"a":kq(t,d+n,p+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+n,a[7]+p+i]),d+=a[6],p+=a[7];break;case"A":kq(t,d+n,p+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),d=a[6],p=a[7];break;case"z":case"Z":t.closePath()}h=a}}function kq(t,e,n,i){const r=function(t,e,n,i,r,o,a,s,l){const u=vq.call(arguments);if(mq[u])return mq[u];const c=a*dq,h=Math.sin(c),d=Math.cos(c),p=d*(s-t)*.5+h*(l-e)*.5,f=d*(l-e)*.5-h*(s-t)*.5;let g=p*p/((n=Math.abs(n))*n)+f*f/((i=Math.abs(i))*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);const m=d/n,y=h/n,v=-h/i,x=d/i,b=m*s+y*l,w=v*s+x*l,_=m*t+y*e,k=v*t+x*e;let S=1/((_-b)*(_-b)+(k-w)*(k-w))-.25;S<0&&(S=0);let C=Math.sqrt(S);o==r&&(C=-C);const A=.5*(b+_)-C*(k-w),I=.5*(w+k)+C*(_-b),M=Math.atan2(w-I,b-A);let D=Math.atan2(k-I,_-A)-M;D<0&&1===o?D+=fq:D>0&&0===o&&(D-=fq);const T=Math.ceil(Math.abs(D/(pq+.001))),E=[];for(let t=0;t<T;++t){const e=M+t*D/T,r=M+(t+1)*D/T;E[t]=[A,I,e,r,n,i,h,d]}return mq[u]=E}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let e=0;e<r.length;++e){const n=xq(r[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const Sq=.5773502691896257,Cq={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,fq)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,o=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-o),t.lineTo(r,-o),t.lineTo(0,-n),t.lineTo(-r,-o),t.lineTo(-i,-o),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n,r=i-n*Sq,o=n/4;t.moveTo(0,-i-r),t.lineTo(-o,i-r),t.lineTo(o,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n,r=i-n*Sq;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=gq*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function Aq(t){return DO(Cq,t)?Cq[t]:function(t){if(!DO(Iq,t)){const e=hq(t);Iq[t]={draw:function(t,n){_q(t,e,0,0,Math.sqrt(n)/2)}}}return Iq[t]}(t)}var Iq={};const Mq=.448084975506;function Dq(t){return t.x}function Tq(t){return t.y}function Eq(t){return t.width}function Nq(t){return t.height}function Oq(t){return"function"==typeof t?t:()=>+t}function Fq(t,e,n){return Math.max(e,Math.min(t,n))}function Rq(){var t=Dq,e=Tq,n=Eq,i=Nq,r=Oq(0),o=r,a=r,s=r,l=null;function u(u,c,h){var d,p=null!=c?c:+t.call(this,u),f=null!=h?h:+e.call(this,u),g=+n.call(this,u),m=+i.call(this,u),y=Math.min(g,m)/2,v=Fq(+r.call(this,u),0,y),x=Fq(+o.call(this,u),0,y),b=Fq(+a.call(this,u),0,y),w=Fq(+s.call(this,u),0,y);if(l||(l=d=JV()),v<=0&&x<=0&&b<=0&&w<=0)l.rect(p,f,g,m);else{var _=p+g,k=f+m;l.moveTo(p+v,f),l.lineTo(_-x,f),l.bezierCurveTo(_-Mq*x,f,_,f+Mq*x,_,f+x),l.lineTo(_,k-w),l.bezierCurveTo(_,k-Mq*w,_-Mq*w,k,_-w,k),l.lineTo(p+b,k),l.bezierCurveTo(p+Mq*b,k,p,k-Mq*b,p,k-b),l.lineTo(p,f+v),l.bezierCurveTo(p,f+Mq*v,p+Mq*v,f,p+v,f),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(e){return arguments.length?(t=Oq(e),u):t},u.y=function(t){return arguments.length?(e=Oq(t),u):e},u.width=function(t){return arguments.length?(n=Oq(t),u):n},u.height=function(t){return arguments.length?(i=Oq(t),u):i},u.cornerRadius=function(t,e,n,i){return arguments.length?(r=Oq(t),o=null!=e?Oq(e):r,s=null!=n?Oq(n):r,a=null!=i?Oq(i):o,u):r},u.context=function(t){return arguments.length?(l=null==t?null:t,u):l},u}function Lq(){var t,e,n,i,r,o,a,s,l=null;function u(t,e,n){const i=n/2;if(r){var u=a-e,c=t-o;if(u||c){var h=Math.sqrt(u*u+c*c),d=(u/=h)*s,p=(c/=h)*s,f=Math.atan2(c,u);l.moveTo(o-d,a-p),l.lineTo(t-u*i,e-c*i),l.arc(t,e,i,f-Math.PI,f),l.lineTo(o+d,a+p),l.arc(o,a,s,f,f+Math.PI)}else l.arc(t,e,i,0,fq);l.closePath()}else r=1;o=t,a=e,s=i}function c(o){var a,s,c,h=o.length,d=!1;for(null==l&&(l=c=JV()),a=0;a<=h;++a)!(a<h&&i(s=o[a],a,o))===d&&(d=!d)&&(r=0),d&&u(+t(s,a,o),+e(s,a,o),+n(s,a,o));if(c)return l=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(i=t,c):i},c.context=function(t){return arguments.length?(l=null==t?null:t,c):l},c}function $q(t,e){return null!=t?t:e}const Pq=t=>t.x||0,zq=t=>t.y||0,Bq=t=>!(!1===t.defined),Vq=function(){var t=dW,e=pW,n=QV(0),i=null,r=fW,o=gW,a=mW,s=null;function l(){var l,u,c=+t.apply(this,arguments),h=+e.apply(this,arguments),d=r.apply(this,arguments)-lW,p=o.apply(this,arguments)-lW,f=tW(p-d),g=p>d;if(s||(s=l=JV()),h<c&&(u=h,h=c,c=u),h>1e-12)if(f>uW-1e-12)s.moveTo(h*nW(d),h*oW(d)),s.arc(0,0,h,d,p,!g),c>1e-12&&(s.moveTo(c*nW(p),c*oW(p)),s.arc(0,0,c,p,d,g));else{var m,y,v=d,x=p,b=d,w=p,_=f,k=f,S=a.apply(this,arguments)/2,C=S>1e-12&&(i?+i.apply(this,arguments):aW(c*c+h*h)),A=rW(tW(h-c)/2,+n.apply(this,arguments)),I=A,M=A;if(C>1e-12){var D=hW(C/c*oW(S)),T=hW(C/h*oW(S));(_-=2*D)>1e-12?(b+=D*=g?1:-1,w-=D):(_=0,b=w=(d+p)/2),(k-=2*T)>1e-12?(v+=T*=g?1:-1,x-=T):(k=0,v=x=(d+p)/2)}var E=h*nW(v),N=h*oW(v),O=c*nW(w),F=c*oW(w);if(A>1e-12){var R,L=h*nW(x),$=h*oW(x),P=c*nW(b),z=c*oW(b);if(f<sW&&(R=yW(E,N,P,z,L,$,O,F))){var B=E-R[0],V=N-R[1],W=L-R[0],j=$-R[1],U=1/oW(cW((B*W+V*j)/(aW(B*B+V*V)*aW(W*W+j*j)))/2),G=aW(R[0]*R[0]+R[1]*R[1]);I=rW(A,(c-G)/(U-1)),M=rW(A,(h-G)/(U+1))}}k>1e-12?M>1e-12?(m=vW(P,z,E,N,h,M,g),y=vW(L,$,O,F,h,M,g),s.moveTo(m.cx+m.x01,m.cy+m.y01),M<A?s.arc(m.cx,m.cy,M,eW(m.y01,m.x01),eW(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,M,eW(m.y01,m.x01),eW(m.y11,m.x11),!g),s.arc(0,0,h,eW(m.cy+m.y11,m.cx+m.x11),eW(y.cy+y.y11,y.cx+y.x11),!g),s.arc(y.cx,y.cy,M,eW(y.y11,y.x11),eW(y.y01,y.x01),!g))):(s.moveTo(E,N),s.arc(0,0,h,v,x,!g)):s.moveTo(E,N),c>1e-12&&_>1e-12?I>1e-12?(m=vW(O,F,L,$,c,-I,g),y=vW(E,N,P,z,c,-I,g),s.lineTo(m.cx+m.x01,m.cy+m.y01),I<A?s.arc(m.cx,m.cy,I,eW(m.y01,m.x01),eW(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,I,eW(m.y01,m.x01),eW(m.y11,m.x11),!g),s.arc(0,0,c,eW(m.cy+m.y11,m.cx+m.x11),eW(y.cy+y.y11,y.cx+y.x11),g),s.arc(y.cx,y.cy,I,eW(y.y11,y.x11),eW(y.y01,y.x01),!g))):s.arc(0,0,c,w,b,g):s.lineTo(O,F)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-sW/2;return[nW(i)*n,oW(i)*n]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:QV(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:QV(+t),l):e},l.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:QV(+t),l):n},l.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:QV(+t),l):i},l.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:QV(+t),l):r},l.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:QV(+t),l):o},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:QV(+t),l):a},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l}().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),Wq=CW().x(Pq).y1(zq).y0((t=>(t.y||0)+(t.height||0))).defined(Bq),jq=CW().y(zq).x1(Pq).x0((t=>(t.x||0)+(t.width||0))).defined(Bq),Uq=SW().x(Pq).y(zq).defined(Bq),Gq=Rq().x(Pq).y(zq).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>$q(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>$q(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>$q(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>$q(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),Hq=function(t,e){var n=null;function i(){var i;if(n||(n=i=JV()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return t="function"==typeof t?t:QV(t||AW),e="function"==typeof e?e:QV(void 0===e?64:+e),i.type=function(e){return arguments.length?(t="function"==typeof e?e:QV(e),i):t},i.size=function(t){return arguments.length?(e="function"==typeof t?t:QV(+t),i):e},i.context=function(t){return arguments.length?(n=null==t?null:t,i):n},i}().type((t=>Aq(t.shape||"circle"))).size((t=>$q(t.size,64))),qq=Lq().x(Pq).y(zq).defined(Bq).size((t=>t.size||1));function Xq(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Yq(t,e,n,i){return Gq.context(t)(e,n,i)}var Kq=1;function Zq(){Kq=1}function Jq(t,e,n){var i=e.clip,r=t._defs,o=e.clip_id||(e.clip_id="clip"+Kq++),a=r.clipping[o]||(r.clipping[o]={id:o});return yO(i)?a.path=i(null):Xq(n)?a.path=Yq(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+o+")"}function Qq(t){this.clear(),t&&this.union(t)}function tX(t){this.mark=t,this.bounds=this.bounds||new Qq}function eX(t){tX.call(this,t),this.items=this.items||[]}function nX(t){this._pending=0,this._loader=t||VP()}function iX(t){t._pending+=1}function rX(t){t._pending-=1}function oX(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const i=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(i+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,i):0))}return t}Qq.prototype={clone(){return new Qq(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:o,y2:a}=this,s=Math.cos(t),l=Math.sin(t),u=e-e*s+n*l,c=n-e*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*a+u,l*i+s*a+c,s*o-l*r+u,l*o+s*r+c,s*o-l*a+u,l*o+s*a+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},OO(eX,tX),nX.prototype={pending(){return this._pending},sanitizeURL(t){const e=this;return iX(e),e._loader.sanitize(t,{context:"href"}).then((t=>(rX(e),t))).catch((()=>(rX(e),null)))},loadImage(t){const e=this,n="undefined"!=typeof Image?Image:null;return iX(e),e._loader.sanitize(t,{context:"image"}).then((t=>{const i=t.href;if(!i||!n)throw{url:i};const r=new n,o=DO(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=o&&(r.crossOrigin=o),r.onload=()=>rX(e),r.onerror=()=>rX(e),r.src=i,r})).catch((t=>(rX(e),{complete:!1,width:0,height:0,src:t&&t.url||""})))},ready(){const t=this;return new Promise((e=>{!function n(i){t.pending()?setTimeout((()=>{n(!0)}),10):e(i)}(!1)}))}};const aX=fq-1e-8;let sX,lX,uX,cX,hX,dX,pX,fX;const gX=(t,e)=>sX.add(t,e),mX=(t,e)=>gX(lX=t,uX=e),yX=t=>gX(t,sX.y1),vX=t=>gX(sX.x1,t),xX=(t,e)=>hX*t+pX*e,bX=(t,e)=>dX*t+fX*e,wX=(t,e)=>gX(xX(t,e),bX(t,e)),_X=(t,e)=>mX(xX(t,e),bX(t,e));function kX(t,e){return sX=t,e?(cX=e*dq,hX=fX=Math.cos(cX),dX=Math.sin(cX),pX=-dX):(hX=fX=1,cX=dX=pX=0),SX}const SX={beginPath(){},closePath(){},moveTo:_X,lineTo:_X,rect(t,e,n,i){cX?(wX(t+n,e),wX(t+n,e+i),wX(t,e+i),_X(t,e)):(gX(t+n,e+i),mX(t,e))},quadraticCurveTo(t,e,n,i){const r=xX(t,e),o=bX(t,e),a=xX(n,i),s=bX(n,i);CX(lX,r,a,yX),CX(uX,o,s,vX),mX(a,s)},bezierCurveTo(t,e,n,i,r,o){const a=xX(t,e),s=bX(t,e),l=xX(n,i),u=bX(n,i),c=xX(r,o),h=bX(r,o);AX(lX,a,l,c,yX),AX(uX,s,u,h,vX),mX(c,h)},arc(t,e,n,i,r,o){if(i+=cX,r+=cX,lX=n*Math.cos(r)+t,uX=n*Math.sin(r)+e,Math.abs(r-i)>aX)gX(t-n,e-n),gX(t+n,e+n);else{const a=i=>gX(n*Math.cos(i)+t,n*Math.sin(i)+e);let s,l;if(a(i),a(r),r!==i)if((i%=fq)<0&&(i+=fq),(r%=fq)<0&&(r+=fq),r<i&&(o=!o,s=i,i=r,r=s),o)for(r-=fq,s=i-i%pq,l=0;l<4&&s>r;++l,s-=pq)a(s);else for(s=i-i%pq+pq,l=0;l<4&&s<r;++l,s+=pq)a(s)}}};function CX(t,e,n,i){const r=(t-e)/(t+n-2*e);0<r&&r<1&&i(t+(e-t)*r)}function AX(t,e,n,i,r){const o=i-t+3*e-3*n,a=t+n-2*e,s=t-e;let l,u=0,c=0;Math.abs(o)>1e-14?(l=a*a+s*o,l>=0&&(l=Math.sqrt(l),u=(-a+l)/o,c=(-a-l)/o)):u=.5*s/a,0<u&&u<1&&r(IX(u,t,e,n,i)),0<c&&c<1&&r(IX(c,t,e,n,i))}function IX(t,e,n,i,r){const o=1-t,a=o*o,s=t*t;return a*o*e+3*a*t*n+3*o*s*i+s*t*r}var MX=(MX=oj(1,1))?MX.getContext("2d"):null;const DX=new Qq;function TX(t){return function(e,n){if(!MX)return!0;t(MX,e),DX.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:o,y2:a}=DX;for(let t=r;t<=a;++t)for(let e=i;e<=o;++e)if(MX.isPointInPath(e,t))return!0;return!1}}function EX(t,e){return e.contains(t.x||0,t.y||0)}function NX(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,o=t.height||0;return e.intersects(DX.set(n,i,n+r,i+o))}function OX(t,e){const n=t.x||0,i=t.y||0;return FX(e,n,i,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i)}function FX(t,e,n,i,r){const{x1:o,y1:a,x2:s,y2:l}=t,u=i-e,c=r-n;let h,d,p,f,g=0,m=1;for(f=0;f<4;++f){if(0===f&&(h=-u,d=-(o-e)),1===f&&(h=u,d=s-e),2===f&&(h=-c,d=-(a-n)),3===f&&(h=c,d=l-n),Math.abs(h)<1e-10&&d<0)return!1;if(p=d/h,h<0){if(p>m)return!1;p>g&&(g=p)}else if(h>0){if(p<g)return!1;p<m&&(m=p)}}return!0}function RX(t,e){t.globalCompositeOperation=e.blend||"source-over"}function LX(t,e){return null==t?e:t}function $X(t,e){const n=e.length;for(let i=0;i<n;++i)t.addColorStop(e[i].offset,e[i].color);return t}function PX(t,e,n){return iq(n)?function(t,e,n){const i=n.width(),r=n.height();let o;if("radial"===e.gradient)o=t.createRadialGradient(n.x1+LX(e.x1,.5)*i,n.y1+LX(e.y1,.5)*r,Math.max(i,r)*LX(e.r1,0),n.x1+LX(e.x2,.5)*i,n.y1+LX(e.y2,.5)*r,Math.max(i,r)*LX(e.r2,.5));else{const a=LX(e.x1,0),s=LX(e.y1,0),l=LX(e.x2,1),u=LX(e.y2,0);if(a!==l&&s!==u&&i!==r){const n=oj(Math.ceil(i),Math.ceil(r)),o=n.getContext("2d");return o.scale(i,r),o.fillStyle=$X(o.createLinearGradient(a,s,l,u),e.stops),o.fillRect(0,0,i,r),t.createPattern(n,"no-repeat")}o=t.createLinearGradient(n.x1+a*i,n.y1+s*r,n.x1+l*i,n.y1+u*r)}return $X(o,e.stops)}(t,n,e.bounds):n}function zX(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=PX(t,e,e.fill),!0)}var BX=[];function VX(t,e,n){var i=null!=(i=e.strokeWidth)?i:1;return!(i<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=PX(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||BX),t.lineDashOffset=e.strokeDashOffset||0),!0))}function WX(t,e){return t.zindex-e.zindex||t.index-e.index}function jX(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,o=[];for(n=0,i=r.length;n<i;++n)(e=r[n]).index=n,e.zindex&&o.push(e);return t.zdirty=!1,t.zitems=o.sort(WX)}function UX(t,e){var n,i,r=t.items;if(!r||!r.length)return;const o=jX(t);if(o&&o.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=o}for(n=0,i=r.length;n<i;++n)e(r[n])}function GX(t,e){var n,i,r=t.items;if(!r||!r.length)return null;const o=jX(t);for(o&&o.length&&(r=o),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===o)for(i=(r=t.items).length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n;return null}function HX(t){return function(e,n,i){UX(n,(n=>{i&&!i.intersects(n.bounds)||qX(t,e,n,n)}))}}function qX(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(t(e,i)||(RX(e,n),n.fill&&zX(e,n,r)&&e.fill(),n.stroke&&VX(e,n,r)&&e.stroke()))}function XX(t){return t=t||BN,function(e,n,i,r,o,a){return i*=e.pixelRatio,r*=e.pixelRatio,GX(n,(n=>{const s=n.bounds;if((!s||s.contains(o,a))&&s)return t(e,n,i,r,o,a)?n:void 0}))}}function YX(t,e){return function(n,i,r,o){var a,s,l=Array.isArray(i)?i[0]:i,u=null==e?l.fill:e,c=l.stroke&&n.isPointInStroke;return c&&(a=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=a?a:1,n.lineCap=null!=s?s:"butt"),!t(n,i)&&(u&&n.isPointInPath(r,o)||c&&n.isPointInStroke(r,o))}}function KX(t){return XX(YX(t))}function ZX(t,e){return"translate("+t+","+e+")"}function JX(t){return"rotate("+t+")"}function QX(t){return ZX(t.x||0,t.y||0)}function tY(t,e,n){function i(t,n){var i=n.x||0,r=n.y||0,o=n.angle||0;t.translate(i,r),o&&t.rotate(o*=dq),t.beginPath(),e(t,n),o&&t.rotate(-o),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return ZX(t.x||0,t.y||0)+(t.angle?" "+JX(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){return e(kX(t,n.angle),n),oX(t,n).translate(n.x||0,n.y||0)},draw:HX(i),pick:KX(i),isect:n||TX(i)}}var eY=tY("arc",(function(t,e){return Vq.context(t)(e)}));function nY(t,e,n){function i(t,n){t.beginPath(),e(t,n)}const r=YX(i);return{type:t,tag:"path",nested:!0,attr:function(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))},bound:function(t,n){var i=n.items;return 0===i.length?t:(e(kX(t),i),oX(t,i[0]))},draw:(o=i,function(t,e,n){!e.items.length||n&&!n.intersects(e.bounds)||qX(o,t,e.items[0],e.items)}),pick:function(t,e,n,i,o,a){var s=e.items,l=e.bounds;return!s||!s.length||l&&!l.contains(o,a)?null:(n*=t.pixelRatio,i*=t.pixelRatio,r(t,s,n,i)?s[0]:null)},isect:EX,tip:n};var o}var iY=nY("area",(function(t,e){const n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?jq:Wq).curve(lq(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r="horizontal"===t[0].orient?e[1]:e[0],o="horizontal"===t[0].orient?"y":"x",a=t.length,s=1/0;--a>=0;)!1!==t[a].defined&&(i=Math.abs(t[a][o]-r))<s&&(s=i,n=t[a]);return n}));function rY(t,e){t.beginPath(),Xq(e)?Yq(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function oY(t){const e=LX(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function aY(t,e){const n=oY(e);t("d",Yq(null,e,n,n))}function sY(t,e,n,i){const r=oY(e);t.beginPath(),Yq(t,e,(n||0)+r,(i||0)+r)}const lY=YX(sY),uY=YX(sY,!1),cY=YX(sY,!0);var hY={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",QX(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,i=n.length;for(let e=0;e<i;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),oX(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){UX(e,(e=>{const i=e.x||0,r=e.y||0,o=e.strokeForeground,a=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&a&&(sY(t,e,i,r),RX(t,e),e.fill&&zX(t,e,a)&&t.fill(),e.stroke&&!o&&VX(t,e,a)&&t.stroke()),t.save(),t.translate(i,r),e.clip&&rY(t,e),n&&n.translate(-i,-r),UX(e,(e=>{this.draw(t,e,n)})),n&&n.translate(i,r),t.restore(),o&&e.stroke&&a&&(sY(t,e,i,r),RX(t,e),VX(t,e,a)&&t.stroke())}))},pick:function(t,e,n,i,r,o){if(e.bounds&&!e.bounds.contains(r,o)||!e.items)return null;const a=n*t.pixelRatio,s=i*t.pixelRatio;return GX(e,(l=>{let u,c,h;const d=l.bounds;if(d&&!d.contains(r,o))return;c=l.x||0,h=l.y||0;const p=c+(l.width||0),f=h+(l.height||0),g=l.clip;if(g&&(r<c||r>p||o<h||o>f))return;if(t.save(),t.translate(c,h),c=r-c,h=o-h,g&&Xq(l)&&!cY(t,l,a,s))return t.restore(),null;const m=l.strokeForeground,y=!1!==e.interactive;return y&&m&&l.stroke&&uY(t,l,a,s)?(t.restore(),l):(u=GX(l,(t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,c,h)?this.pick(t,n,i,c,h):null)),!u&&y&&(l.fill||!m&&l.stroke)&&lY(t,l,a,s)&&(u=l),t.restore(),u||null)}))},isect:NX,content:function(t,e,n){t("clip-path",e.clip?Jq(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),aY(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?aY(t,e):t("d","")}},dY={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function pY(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then((e=>{t.image=e,t.image.url=t.url}))),n}function fY(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function gY(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function mY(t,e){return"center"===t?e/2:"right"===t?e:0}function yY(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var vY={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const i=pY(e,n),r=fY(e,i),o=gY(e,i),a=(e.x||0)-mY(e.align,r),s=(e.y||0)-yY(e.baseline,o);t("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",dY["xmlns:xlink"],"xlink:href"),t("transform",ZX(a,s)),t("width",r),t("height",o),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,i=fY(e,n),r=gY(e,n),o=(e.x||0)-mY(e.align,i),a=(e.y||0)-yY(e.baseline,r);return t.set(o,a,o+i,a+r)},draw:function(t,e,n){UX(e,(e=>{if(n&&!n.intersects(e.bounds))return;const i=pY(e,this);let r=fY(e,i),o=gY(e,i);if(0===r||0===o)return;let a,s,l,u,c=(e.x||0)-mY(e.align,r),h=(e.y||0)-yY(e.baseline,o);!1!==e.aspect&&(s=i.width/i.height,l=e.width/e.height,s==s&&l==l&&s!==l&&(l<s?(u=r/s,h+=(o-u)/2,o=u):(u=o*s,c+=(r-u)/2,r=u))),(i.complete||i.toDataURL)&&(RX(t,e),t.globalAlpha=null!=(a=e.opacity)?a:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(i,c,h,r,o))}))},pick:XX(),isect:BN,get:pY,xOffset:mY,yOffset:yY},xY=nY("line",(function(t,e){const n=e[0],i=n.interpolate||"linear";return Uq.curve(lq(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r=Math.pow(t[0].strokeWidth||1,2),o=t.length;--o>=0;)if(!1!==t[o].defined&&(n=t[o].x-e[0])*n+(i=t[o].y-e[1])*i<r)return t[o];return null}));function bY(t,e){var n=e.path;if(null==n)return!0;var i=e.x||0,r=e.y||0,o=e.scaleX||1,a=e.scaleY||1,s=(e.angle||0)*dq,l=e.pathCache;l&&l.path===n||((e.pathCache=l=hq(n)).path=n),s&&t.rotate&&t.translate?(t.translate(i,r),t.rotate(s),_q(t,l,0,0,o,a),t.rotate(-s),t.translate(-i,-r)):_q(t,l,i,r,o,a)}var wY={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,i=e.scaleY||1;1===n&&1===i||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return ZX(t.x||0,t.y||0)+(t.angle?" "+JX(t.angle):"")+(t.scaleX||t.scaleY?" "+(e=t.scaleX||1,n=t.scaleY||1,"scale("+e+","+n+")"):"");var e,n}(e)),t("d",e.path)},bound:function(t,e){return bY(kX(t,e.angle),e)?t.set(0,0,0,0):oX(t,e,!0)},draw:HX(bY),pick:KX(bY),isect:TX(bY)};function _Y(t,e){t.beginPath(),Yq(t,e)}var kY={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",Yq(null,e))},bound:function(t,e){var n,i;return oX(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)},draw:HX(_Y),pick:KX(_Y),isect:NX};function SY(t,e,n){var i,r,o,a;return!(!e.stroke||!VX(t,e,n))&&(i=e.x||0,r=e.y||0,o=null!=e.x2?e.x2:i,a=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(o,a),!0)}var CY={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",QX(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,i;return oX(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)},draw:function(t,e,n){UX(e,(e=>{if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&SY(t,e,i)&&(RX(t,e),t.stroke())}}))},pick:XX((function(t,e,n,i){return!!t.isPointInStroke&&(SY(t,e,1)&&t.isPointInStroke(n,i))})),isect:OX},AY=tY("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),IY=tY("symbol",(function(t,e){return Hq.context(t)(e)}),EX);const MY=jO();var DY={height:RY,measureWidth:OY,estimateWidth:EY,width:EY,canvas:TY};function TY(t){DY.width=t&&MX?OY:EY}function EY(t,e){return NY(zY(t,e),RY(t))}function NY(t,e){return~~(.8*t.length*e)}function OY(t,e){return RY(t)<=0||!(e=zY(t,e))?0:FY(e,VY(t))}function FY(t,e){const n=`(${e}) ${t}`;let i=MY.get(n);return void 0===i&&(MX.font=e,i=MX.measureText(t).width,MY.set(n,i)),i}function RY(t){return null!=t.fontSize?+t.fontSize||0:11}function LY(t){return null!=t.lineHeight?t.lineHeight:RY(t)+2}function $Y(t){return e=t.lineBreak&&t.text&&!UN(t.text)?t.text.split(t.lineBreak):t.text,UN(e)?e.length>1?e:e[0]:e;var e}function PY(t){const e=$Y(t);return(UN(e)?e.length-1:0)*LY(t)}function zY(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,i=function(t){if(DY.width===OY){const e=VY(t);return t=>FY(t,e)}{const e=RY(t);return t=>NY(t,e)}}(t);if(i(e)<n)return e;var r,o=t.ellipsis||"…",a="rtl"===t.dir,s=0,l=e.length;if(n-=i(o),a){for(;s<l;)r=s+l>>>1,i(e.slice(r))>n?s=r+1:l=r;return o+e.slice(s)}for(;s<l;)r=1+(s+l>>>1),i(e.slice(0,r))<n?s=r:l=r-1;return e.slice(0,s)+o}(t,n):n}function BY(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function VY(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+RY(t)+"px "+BY(t,e)}function WY(t){var e=t.baseline,n=RY(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*LY(t):"line-bottom"===e?.29*n-.5*LY(t):0)}TY(!0);const jY={left:"start",center:"middle",right:"end"},UY=new Qq;function GY(t){var e,n=t.x||0,i=t.y||0,r=t.radius||0;return r&&(e=(t.theta||0)-pq,n+=r*Math.cos(e),i+=r*Math.sin(e)),UY.x1=n,UY.y1=i,UY}function HY(t,e,n){var i,r=DY.height(e),o=e.align,a=GY(e),s=a.x1,l=a.y1,u=e.dx||0,c=(e.dy||0)+WY(e)-Math.round(.8*r),h=$Y(e);if(UN(h)?(r+=LY(e)*(h.length-1),i=h.reduce(((t,n)=>Math.max(t,DY.width(e,n))),0)):i=DY.width(e,h),"center"===o?u-=i/2:"right"===o&&(u-=i),t.set(u+=s,c+=l,u+i,c+r),e.angle&&!n)t.rotate(e.angle*dq,s,l);else if(2===n)return t.rotatedPoints(e.angle*dq,s,l);return t}var qY={arc:eY,area:iY,group:hY,image:vY,line:xY,path:wY,rect:kY,rule:CY,shape:AY,symbol:IY,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,i=e.dx||0,r=(e.dy||0)+WY(e),o=GY(e),a=o.x1,s=o.y1,l=e.angle||0;t("text-anchor",jY[e.align]||"start"),l?(n=ZX(a,s)+" "+JX(l),(i||r)&&(n+=" "+ZX(i,r))):n=ZX(a+i,s+r),t("transform",n)},bound:HY,draw:function(t,e,n){UX(e,(e=>{var i,r,o,a,s,l,u,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=VY(e),t.textAlign=e.align||"left",r=(i=GY(e)).x1,o=i.y1,e.angle&&(t.save(),t.translate(r,o),t.rotate(e.angle*dq),r=o=0),r+=e.dx||0,o+=(e.dy||0)+WY(e),l=$Y(e),RX(t,e),UN(l))for(s=LY(e),a=0;a<l.length;++a)u=zY(e,l[a]),e.fill&&zX(t,e,c)&&t.fillText(u,r,o),e.stroke&&VX(t,e,c)&&t.strokeText(u,r,o),o+=s;else u=zY(e,l),e.fill&&zX(t,e,c)&&t.fillText(u,r,o),e.stroke&&VX(t,e,c)&&t.strokeText(u,r,o);e.angle&&t.restore()}}))},pick:XX((function(t,e,n,i,r,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var a=GY(e),s=a.x1,l=a.y1,u=HY(UY,e,1),c=-e.angle*dq,h=Math.cos(c),d=Math.sin(c),p=h*r-d*o+(s-h*s+d*l),f=d*r+h*o+(l-d*s-h*l);return u.contains(p,f)})),isect:function(t,e){const n=HY(UY,t,2);return FX(e,n[0],n[1],n[2],n[3])||FX(e,n[0],n[1],n[4],n[5])||FX(e,n[4],n[5],n[6],n[7])||FX(e,n[2],n[3],n[6],n[7])}},trail:nY("trail",(function(t,e){return qq.context(t)(e)}),(function(t,e){for(var n,i,r=t.length;--r>=0;)if(!1!==t[r].defined&&(n=t[r].x-e[0])*n+(i=t[r].y-e[1])*i<(n=t[r].size||1)*n)return t[r];return null}))};function XY(t,e,n){var i=qY[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new Qq),t,n)}var YY={mark:null};function KY(t,e,n){var i,r,o,a,s=qY[t.marktype],l=s.bound,u=t.items,c=u&&u.length;if(s.nested)return c?o=u[0]:(YY.mark=t,o=YY),a=XY(o,l,n),e=e&&e.union(a)||a;if(e=e||t.bounds&&t.bounds.clear()||new Qq,c)for(i=0,r=u.length;i<r;++i)e.union(XY(u[i],l,n));return t.bounds=e}const ZY=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function JY(t,e){return JSON.stringify(t,ZY,e)}function QY(t){return tK("string"==typeof t?JSON.parse(t):t)}function tK(t){var e,n,i,r=t.marktype,o=t.items;if(o)for(n=0,i=o.length;n<i;++n)e=r?"mark":"group",o[n][e]=t,o[n].zindex&&(o[n][e].zdirty=!0),"group"===(r||e)&&tK(o[n]);return r&&KY(t),t}function eK(t){arguments.length?this.root=QY(t):(this.root=nK({marktype:"group",name:"root",role:"frame"}),this.root.items=[new eX(this.root)])}function nK(t,e){const n={bounds:new Qq,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function iK(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function rK(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function oK(t,e,n,i){var r,o=t.childNodes[e];return o&&o.tagName.toLowerCase()===n.toLowerCase()||(r=o||null,o=iK(t.ownerDocument,n,i),t.insertBefore(o,r)),o}function aK(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function sK(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function lK(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function uK(t,e){this._active=null,this._handlers={},this._loader=t||VP(),this._tooltip=e||cK}function cK(t,e,n,i){t.element().setAttribute("title",i||"")}function hK(t){this._el=null,this._bgcolor=null,this._loader=new nX(t)}eK.prototype={toJSON(t){return JY(this.root,t||0)},mark(t,e,n){const i=nK(t,e=e||this.root.items[0]);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},uK.prototype={initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return-1},handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const t in e)n.push(...e[t]);return n},eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),i=iK(null,"a");for(const t in e)i.setAttribute(t,e[t]);i.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,i){var r,o,a=t&&t.mark;if(a&&(r=qY[a.marktype]).tip){for((o=lK(e,n))[0]-=i[0],o[1]-=i[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=r.tip(a.items,o)}return t}(e,t,this.canvas(),this._origin);const i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,o=r.width(),a=r.height();let s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;t.mark&&(t=t.mark.group);)s+=t.x||0,l+=t.y||0;return{x:s,y:l,width:o,height:a,left:s,top:l,right:s+o,bottom:l+a}}},hK.prototype={initialize(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},resize(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(t){const e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},_render(){},renderAsync(t){const e=this.render(t);return this._ready?this._ready.then((()=>e)):Promise.resolve(e)},_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{e&&t(),n._ready=null}))}return i},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const dK="dragleave",pK="mousedown",fK="mousemove",gK="mouseout",mK="click",yK=fK,vK=gK,xK=mK;function bK(t,e){uK.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}function wK(t,e){(t=>"touchstart"===t||"touchmove"===t||"touchend"===t?["touchstart","touchmove","touchend"]:[t])(e).forEach((e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e)))}function _K(t,e,n){return function(i){const r=this._active,o=this.pickEvent(i);o===r||(r&&r.exit||this.fire(n,i),this._active=o,this.fire(e,i)),this.fire(t,i)}}function kK(t){return function(e){this.fire(t,e),this._active=null}}OO(bK,uK,{initialize(t,e,n){return this._canvas=t&&rK(t,"canvas"),[mK,pK,fK,gK,dK].forEach((t=>wK(this,t))),uK.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup","dragenter",dK,"dragover",pK,"mouseup",fK,gK,"mouseover",mK,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],DOMMouseScroll(t){this.fire("mousewheel",t)},mousemove:_K(fK,"mouseover",gK),dragover:_K("dragover","dragenter",dK),mouseout:kK(gK),dragleave:kK(dK),mousedown(t){this._down=this._active,this.fire(pK,t)},click(t){this._down===this._active&&(this.fire(mK,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},touchmove(t){this.fire("touchmove",t,!0)},touchend(t){this.fire("touchend",t,!0),this._touch=null},fire(t,e,n){const i=n?this._touch:this._active,r=this._handlers[t];if(e.vegaType=t,t===xK&&i&&i.href?this.handleHref(e,i,i.href):t!==yK&&t!==vK||this.handleTooltip(e,i,t!==vK),r)for(let t=0,n=r.length;t<n;++t)r[t].handler.call(this._obj,e,i)},on(t,e){const n=this.eventName(t),i=this._handlers;return this._handlerIndex(i[n],t,e)<0&&(wK(this,t),(i[n]||(i[n]=[])).push({type:t,handler:e})),this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this},pickEvent(t){const e=lK(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,i,r){const o=this.context();return qY[t.marktype].pick.call(this,o,t,e,n,i,r)}});var SK="undefined"!=typeof window&&window.devicePixelRatio||1;function CK(t){hK.call(this,t),this._options={},this._redraw=!1,this._dirty=new Qq,this._tempb=new Qq}const AK=hK.prototype;function IK(t,e){uK.call(this,t,e);const n=this;n._hrefHandler=MK(n,((t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=MK(n,((t,e)=>{n.handleTooltip(t,e,t.type!==vK)}))}OO(CK,hK,{initialize(t,e,n,i,r,o){return this._options=o||{},this._canvas=this._options.externalContext?null:oj(1,1,this._options.type),t&&this._canvas&&(aK(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),AK.initialize.call(this,t,e,n,i,r)},resize(t,e,n,i){if(AK.resize.call(this,t,e,n,i),this._canvas)!function(t,e,n,i,r,o){const a="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,s=t.getContext("2d"),l=a?SK:r;t.width=e*l,t.height=n*l;for(const t in o)s[t]=o[t];a&&1!==l&&(t.style.width=e+"px",t.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||ON("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},_render(t){const e=this.context(),n=this._origin,i=this._width,r=this._height,o=this._dirty,a=(s=n,l=i,u=r,(new Qq).set(0,0,l,u).translate(-s[0],-s[1]));var s,l,u;e.save();const c=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,a.intersect(o),n);return this.clear(-n[0],-n[1],i,r),this.draw(e,t,c),e.restore(),o.clear(),this},draw(t,e,n){const i=qY[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),yO(n)?(t.beginPath(),n(t),t.clip()):rY(t,e.group)}(t,e),i.draw.call(this,t,e,n),e.clip&&t.restore()},clear(t,e,n,i){const r=this._options,o=this.context();"pdf"===r.type||r.externalContext||o.clearRect(t,e,n,i),null!=this._bgcolor&&(o.fillStyle=this._bgcolor,o.fillRect(t,e,n,i))}});const MK=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,e.call(t._obj,n,i)};OO(IK,uK,{initialize(t,e,n){let i=this._svg;return i&&(i.removeEventListener(xK,this._hrefHandler),i.removeEventListener(yK,this._tooltipHandler),i.removeEventListener(vK,this._tooltipHandler)),this._svg=i=t&&rK(t,"svg"),i&&(i.addEventListener(xK,this._hrefHandler),i.addEventListener(yK,this._tooltipHandler),i.addEventListener(vK,this._tooltipHandler)),uK.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){const n=this.eventName(t),i=this._handlers;if(this._handlerIndex(i[n],t,e)<0){const r={type:t,handler:e,listener:MK(this,e)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const DK=(t,e,n)=>({role:t,"aria-roledescription":e,"aria-label":n||void 0}),TK=QO(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),EK={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,i=e.title?LK(t):null,r=t.context,o=r.scales[e.scale].value,a=r.dataflow.locale(),s=o.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(i?` titled '${i}'`:"")+` for a ${_H(s)?"discrete":s} scale with ${eq(a,o,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?LK(t):null,i=`${e.type||""} legend`.trim(),r=e.scales,o=Object.keys(r),a=t.context,s=a.scales[r[o[0]]].value,l=a.dataflow.locale();return u=i,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?` titled '${n}'`:"")+` for ${function(t){return(t=t.map((t=>t+("fill"===t||"stroke"===t?" color":"")))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+KN(t)}(o)} with ${eq(l,s,t)}`;var u}},"title-text":{desc:"title",caption:t=>`Title text '${RK(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${RK(t)}'`}},NK={ariaRole:"role",ariaRoleDescription:"aria-roledescription",description:"aria-label"};function OK(t,e){const n=!1===e.aria;if(t("aria-hidden",n||void 0),n||null==e.description)for(const e in NK)t(NK[e],void 0);else{const n=e.mark.marktype;t("aria-label",e.description),t("role",e.ariaRole||("group"===n?"graphics-object":"graphics-symbol")),t("aria-roledescription",e.ariaRoleDescription||`${n} mark`)}}function FK(t){return!1===t.aria?{"aria-hidden":!0}:TK[t.role]?null:EK[t.role]?function(t,e){try{const n=t.items[0],i=e.caption||(()=>"");return DK(e.role||"graphics-symbol",e.desc,n.description||i(n))}catch(t){return null}}(t,EK[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some((t=>null!=t.description&&!1!==t.aria));return DK(n?"graphics-object":"graphics-symbol",`${e} mark container`,t.description)}(t)}function RK(t){return gO(t.text).join(" ")}function LK(t){try{return gO(KN(t.items).items[0].text).join(" ")}catch(t){return null}}const $K=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function PK(){let t="",e="",n="";const i=[],r=()=>e=n="",o=(t,n)=>{var i;return null!=n&&(e+=` ${t}="${i=n,$K(i).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),a},a={open(s,...l){(o=>{e&&(t+=`${e}>${n}`,r()),i.push(o)})(s),e="<"+s;for(const t of l)for(const e in t)o(e,t[e]);return a},close(){const o=i.pop();return t+=e?e+(n?`>${n}</${o}>`:"/>"):`</${o}>`,r(),a},attr:o,text:t=>(n+=$K(t),a),toString:()=>t};return a}const zK=t=>BK(PK(),t)+"";function BK(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,i=n.length;for(let e=0;e<i;++e)t.attr(n[e].name,n[e].value)}if(e.hasChildNodes()){const n=e.childNodes,i=n.length;for(let e=0;e<i;e++){const i=n[e];3===i.nodeType?t.text(i.nodeValue):BK(t,i)}}return t.close()}const VK={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},WK={fill:"none","stroke-miterlimit":10},jK="http://www.w3.org/2000/xmlns/",UK=dY.xmlns;function GK(t){hK.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const HK=hK.prototype;function qK(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function XK(t,e,n){let i,r,o;if("radial"===e.gradient){let i=oK(t,n++,"pattern",UK);nZ(i,{id:"p_"+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),i=oK(i,0,"rect",UK),nZ(i,{width:1,height:1,fill:`url(${rZ()}#${e.id})`}),nZ(t=oK(t,n++,"radialGradient",UK),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else nZ(t=oK(t,n++,"linearGradient",UK),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,r=e.stops.length;i<r;++i)o=oK(t,i,"stop",UK),o.setAttribute("offset",e.stops[i].offset),o.setAttribute("stop-color",e.stops[i].color);return aK(t,i),n}function YK(t,e,n){let i;return(t=oK(t,n,"clipPath",UK)).setAttribute("id",e.id),e.path?(i=oK(t,0,"path",UK),i.setAttribute("d",e.path)):(i=oK(t,0,"rect",UK),nZ(i,{x:0,y:0,width:e.width,height:e.height})),aK(t,1),n+1}function KK(t,e,n,i,r){let o,a=t._svg;if(!a&&(o=e.ownerDocument,a=iK(o,i,UK),t._svg=a,t.mark&&(a.__data__=t,a.__values__={fill:"default"},"g"===i))){const e=iK(o,"path",UK);a.appendChild(e),e.__data__=t;const n=iK(o,"g",UK);a.appendChild(n),n.__data__=t;const i=iK(o,"path",UK);a.appendChild(i),i.__data__=t,i.__values__={fill:"default"}}return(a.ownerSVGElement!==r||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(a,n))&&e.insertBefore(a,n?n.nextSibling:e.firstChild),a}OO(GK,hK,{initialize(t,e,n,i,r){return this._defs={},this._clearDefs(),t&&(this._svg=oK(t,0,"svg",UK),this._svg.setAttributeNS(jK,"xmlns",UK),this._svg.setAttributeNS(jK,"xmlns:xlink",dY["xmlns:xlink"]),this._svg.setAttribute("version",dY.version),this._svg.setAttribute("class","marks"),aK(t,1),this._root=oK(this._svg,0,"g",UK),nZ(this._root,WK),aK(this._svg,1)),this.background(this._bgcolor),HK.initialize.call(this,t,e,n,i,r)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),HK.background.apply(this,arguments)},resize(t,e,n,i){return HK.resize.call(this,t,e,n,i),this._svg&&(nZ(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=oK(t,0,"rect",UK),nZ(n,{width:this._width,height:this._height,fill:e}));const i=zK(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),i},_render(t){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t),aK(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,i,r,o,a,s,l;for(a=0,s=t.length;a<s;++a)n=t[a],i=n.mark,i.marktype!==r&&(r=i.marktype,o=qY[r]),i.zdirty&&i.dirty!==e&&(this._dirtyAll=!1,qK(n,e),i.items.forEach((t=>{t.dirty=e}))),i.zdirty||(n.exit?(o.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(o,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=o.nested?i.items[0]:n,n._update!==e&&(n._svg&&n._svg.ownerSVGElement?this._update(o,n._svg,n):(this._dirtyAll=!1,qK(n,e)),n._update=e)));return!this._dirtyAll},mark(t,e,n){if(!this.isDirty(e))return e._svg;const i=this._svg,r=qY[e.marktype],o=!1===e.interactive?"none":null,a="g"===r.tag;let s=null,l=0;const u=KK(e,t,n,"g",i);u.setAttribute("class",sK(e));const c=FK(e);for(const t in c)iZ(u,t,c[t]);a||iZ(u,"pointer-events",o),iZ(u,"clip-path",e.clip?Jq(this,e,e.group):null);const h=t=>{const e=this.isDirty(t),n=KK(t,u,s,r.tag,i);e&&(this._update(r,n,t),a&&function(t,e,n){e=e.lastChild.previousSibling;let i,r=0;UX(n,(n=>{i=t.mark(e,n,i),++r})),aK(e,1+r)}(this,n,t)),s=n,++l};return r.nested?e.items.length&&h(e.items[0]):UX(e,h),aK(u,l),u},_update(t,e,n){ZK=e,JK=e.__values__,OK(tZ,n),t.attr(tZ,n,this);const i=QK[t.type];i&&i.call(this,t,e,n),ZK&&this.style(ZK,n)},style(t,e){if(null!=e)for(const n in VK){let i="font"===n?BY(e):e[n];if(i===JK[n])continue;const r=VK[n];null==i?t.removeAttribute(r):(iq(i)&&(i=rq(i,this._defs.gradient,rZ())),t.setAttribute(r,i+"")),JK[n]=i}},defs(){const t=this._svg,e=this._defs;let n=e.el,i=0;for(const r in e.gradient)n||(e.el=n=oK(t,1,"defs",UK)),i=XK(n,e.gradient[r],i);for(const r in e.clipping)n||(e.el=n=oK(t,1,"defs",UK)),i=YK(n,e.clipping[r],i);n&&(0===i?(t.removeChild(n),e.el=null):aK(n,i))},_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}});let ZK=null,JK=null;const QK={group(t,e,n){const i=ZK=e.childNodes[2];JK=i.__values__,t.foreground(tZ,n,this),JK=e.__values__,ZK=e.childNodes[1],t.content(tZ,n,this);const r=ZK=e.childNodes[0];t.background(tZ,n,this);const o=!1===n.mark.interactive?"none":null;if(o!==JK.events&&(iZ(i,"pointer-events",o),iZ(r,"pointer-events",o),JK.events=o),n.strokeForeground&&n.stroke){const t=n.fill;iZ(i,"display",null),this.style(r,n),iZ(r,"stroke",null),t&&(n.fill=null),JK=i.__values__,this.style(i,n),t&&(n.fill=t),ZK=null}else iZ(i,"display","none")},image(t,e,n){!1===n.smooth?(eZ(e,"image-rendering","optimizeSpeed"),eZ(e,"image-rendering","pixelated")):eZ(e,"image-rendering",null)},text(t,e,n){const i=$Y(n);let r,o,a,s;UN(i)?(o=i.map((t=>zY(n,t))),r=o.join("\n"),r!==JK.text&&(aK(e,0),a=e.ownerDocument,s=LY(n),o.forEach(((t,i)=>{const r=iK(a,"tspan",UK);r.__data__=n,r.textContent=t,i&&(r.setAttribute("x",0),r.setAttribute("dy",s)),e.appendChild(r)})),JK.text=r)):(o=zY(n,i),o!==JK.text&&(e.textContent=o,JK.text=o)),iZ(e,"font-family",BY(n)),iZ(e,"font-size",RY(n)+"px"),iZ(e,"font-style",n.fontStyle),iZ(e,"font-variant",n.fontVariant),iZ(e,"font-weight",n.fontWeight)}};function tZ(t,e,n){e!==JK[t]&&(n?function(t,e,n,i){null!=n?t.setAttributeNS(i,e,n):t.removeAttributeNS(i,e)}(ZK,t,e,n):iZ(ZK,t,e),JK[t]=e)}function eZ(t,e,n){n!==JK[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),JK[e]=n)}function nZ(t,e){for(const n in e)iZ(t,n,e[n])}function iZ(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function rZ(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function oZ(t){hK.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}OO(oZ,hK,{svg(){return this._text},_render(t){const e=PK();e.open("svg",CO({},dY,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",WK,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){const n=qY[e.marktype],i=n.tag,r=[OK,n.attr];t.open("g",{class:sK(e),"clip-path":e.clip?Jq(this,e,e.group):null},FK(e),{"pointer-events":"g"!==i&&!1===e.interactive?"none":null});const o=o=>{const a=this.href(o);if(a&&t.open("a",a),t.open(i,this.attr(e,o,r,"g"!==i?i:null)),"text"===i){const e=$Y(o);if(UN(e)){const n={x:0,dy:LY(o)};for(let i=0;i<e.length;++i)t.open("tspan",i?n:null).text(zY(o,e[i])).close()}else t.text(zY(o,e))}else if("g"===i){const i=o.strokeForeground,r=o.fill,a=o.stroke;i&&a&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),UX(o,(e=>this.mark(t,e))),t.close(),i&&a?(r&&(o.fill=null),o.stroke=a,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),r&&(o.fill=r)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),a&&t.close()};return n.nested?e.items&&e.items.length&&o(e.items[0]):UX(e,o),t.close()},href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[e]=t}))}return null},attr(t,e,n,i){const r={},o=(t,e,n,i)=>{r[i||t]=e};return Array.isArray(n)?n.forEach((t=>t(o,e,this))):n(o,e,this),i&&function(t,e,n,i,r){if(null==e)return t;"bgrect"===i&&!1===n.interactive&&(t["pointer-events"]="none");if("bgfore"===i&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===i&&!1===e.smooth&&(t.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===i&&(t["font-family"]=BY(e),t["font-size"]=RY(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const n in VK){let i=e[n];const o=VK[n];("transparent"!==i||"fill"!==o&&"stroke"!==o)&&null!=i&&(iq(i)&&(i=rq(i,r.gradient,"")),t[o]=i)}}(r,e,t,i,this._defs),r},defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){t.open("defs");for(const n in e){const i=e[n],r=i.stops;"radial"===i.gradient?(t.open("pattern",{id:"p_"+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):t.open("linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let e=0;e<r.length;++e)t.open("stop",{offset:r[e].offset,"stop-color":r[e].color}).close();t.close()}for(const e in n){const i=n[e];t.open("clipPath",{id:e}),i.path?t.open("path",{d:i.path}).close():t.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),t.close()}t.close()}}});const aZ={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},sZ={};function lZ(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(sZ[t]=e,this):sZ[t]}function uZ(t,e,n){const i=[],r=(new Qq).union(e),o=t.marktype;return o?cZ(t,r,n,i):"group"===o?hZ(t,r,n,i):ON("Intersect scene must be mark node or group item.")}function cZ(t,e,n,i){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const r=t.items,o=t.marktype,a=r.length;let s=0;if("group"===o)for(;s<a;++s)hZ(r[s],e,n,i);else for(const t=qY[o].isect;s<a;++s){const n=r[s];dZ(n,e,t)&&i.push(n)}}return i}function hZ(t,e,n,i){n&&n(t.mark)&&dZ(t,e,qY.group.isect)&&i.push(t);const r=t.items,o=r&&r.length;if(o){const a=t.x||0,s=t.y||0;e.translate(-a,-s);for(let t=0;t<o;++t)cZ(r[t],e,n,i);e.translate(a,s)}return i}function dZ(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}sZ.canvas=sZ.png={renderer:CK,headless:CK,handler:bK},sZ.svg={renderer:GK,headless:oZ,handler:IK},sZ.none={};const pZ=new Qq;function fZ(t){const e=t.clip;if(yO(e))e(kX(pZ.clear()));else{if(!e)return;pZ.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(pZ)}function gZ(t,e,n){return t===e||("path"===n?mZ(t,e):t instanceof Date&&e instanceof Date?+t==+e:PO(t)&&PO(e)?Math.abs(t-e)<=1e-9:t&&e&&(GN(t)||GN(e))?function(t,e){var n,i,r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(r.sort(),o.sort(),i=r.length-1;i>=0;i--)if(r[i]!=o[i])return!1;for(i=r.length-1;i>=0;i--)if(!gZ(t[n=r[i]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function mZ(t,e){return gZ(hq(t),hq(e))}const yZ="row";function vZ(t){Iz.call(this,null,t)}function xZ(t,e,n){return e(t.bounds.clear(),t,n)}OO(vZ,Iz,{transform(t,e){const n=e.dataflow,i=t.mark,r=i.marktype,o=qY[r],a=o.bound;let s,l=i.bounds;if(o.nested)i.items.length&&n.dirty(i.items[0]),l=xZ(i,a),i.items.forEach((t=>{t.bounds.clear().union(l)}));else if("group"===r||t.modified())switch(e.visit(e.MOD,(t=>n.dirty(t))),l.clear(),i.items.forEach((t=>l.union(xZ(t,a)))),i.role){case"axis":case"legend":case"title":e.reflow()}else s=e.changed(e.REM),e.visit(e.ADD,(t=>{l.union(xZ(t,a))})),e.visit(e.MOD,(t=>{s=s||l.alignsWith(t.bounds),n.dirty(t),l.union(xZ(t,a))})),s&&(l.clear(),i.items.forEach((t=>l.union(t.bounds))));return fZ(i),e.modifies("bounds")}});function bZ(t){Iz.call(this,0,t)}function wZ(t){Iz.call(this,null,t)}function _Z(t){Iz.call(this,null,t)}bZ.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},OO(bZ,Iz,{transform(t,e){const n=(r=e.dataflow)._signals[":vega_identifier:"]||(r._signals[":vega_identifier:"]=r.add(0)),i=t.as;var r;let o=n.value;return e.visit(e.ADD,(t=>t[i]=t[i]||++o)),n.set(this.value=o),e}}),OO(wZ,Iz,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const i="group"===n.marktype?eX:tX;return e.visit(e.ADD,(t=>i.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const kZ={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,i)=>i&&SZ(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},SZ=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),CZ=(t,e)=>{for(var n,i=1,r=t.length,o=t[0].bounds;i<r;o=n,++i)if(SZ(o,n=t[i].bounds,e))return!0},AZ=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},IZ=t=>(t.forEach((t=>t.opacity=1)),t),MZ=(t,e)=>t.reflow(e.modified()).modifies("opacity");function DZ(t){Iz.call(this,null,t)}OO(_Z,Iz,{transform(t,e){const n=kZ[t.method]||kZ.parity,i=t.separation||0;let r,o,a=e.materialize(e.SOURCE).source;if(!a||!a.length)return;if(!t.method)return t.modified("method")&&(IZ(a),e=MZ(e,t)),e;if(a=a.filter(AZ),!a.length)return;if(t.sort&&(a=a.slice().sort(t.sort)),r=IZ(a),e=MZ(e,t),r.length>=3&&CZ(r,i)){do{r=n(r,i)}while(r.length>=3&&CZ(r,i));r.length<3&&!KN(a).opacity&&(r.length>1&&(KN(r).opacity=0),KN(a).opacity=1)}var s,l,u,c,h;t.boundScale&&t.boundTolerance>=0&&(s=t.boundScale,l=t.boundOrient,u=+t.boundTolerance,c=s.range(),h=new Qq,"top"===l||"bottom"===l?h.set(c[0],-1/0,c[1],1/0):h.set(-1/0,c[0],1/0,c[1]),h.expand(u||1),o=t=>h.encloses(t.bounds),a.forEach((t=>{o(t)||(t.opacity=0)})));const d=r[0].mark.bounds.clear();return a.forEach((t=>{t.opacity&&d.union(t.bounds)})),e}}),OO(DZ,Iz,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const TZ=new Qq;function EZ(t,e,n){return t[e]===n?0:(t[e]=n,1)}function NZ(t){var e=t.items[0].orient;return"left"===e||"right"===e}function OZ(t,e,n,i){var r,o,a=e.items[0],s=a.datum,l=null!=a.translate?a.translate:.5,u=a.orient,c=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(s),h=a.range,d=a.offset,p=a.position,f=a.minExtent,g=a.maxExtent,m=s.title&&a.items[c[2]].items[0],y=a.titlePadding,v=a.bounds,x=m&&PY(m),b=0,w=0;switch(TZ.clear().union(v),v.clear(),(r=c[0])>-1&&v.union(a.items[r].bounds),(r=c[1])>-1&&v.union(a.items[r].bounds),u){case"top":b=p||0,w=-d,o=Math.max(f,Math.min(g,-v.y1)),v.add(0,-o).add(h,0),m&&FZ(t,m,o,y,x,0,-1,v);break;case"left":b=-d,w=p||0,o=Math.max(f,Math.min(g,-v.x1)),v.add(-o,0).add(0,h),m&&FZ(t,m,o,y,x,1,-1,v);break;case"right":b=n+d,w=p||0,o=Math.max(f,Math.min(g,v.x2)),v.add(0,0).add(o,h),m&&FZ(t,m,o,y,x,1,1,v);break;case"bottom":b=p||0,w=i+d,o=Math.max(f,Math.min(g,v.y2)),v.add(0,0).add(h,o),m&&FZ(t,m,o,y,0,0,1,v);break;default:b=a.x,w=a.y}return oX(v.translate(b,w),a),EZ(a,"x",b+l)|EZ(a,"y",w+l)&&(a.bounds=TZ,t.dirty(a),a.bounds=v,t.dirty(a)),a.mark.bounds.clear().union(v)}function FZ(t,e,n,i,r,o,a,s){const l=e.bounds;if(e.auto){const s=a*(n+r+i);let u=0,c=0;t.dirty(e),o?u=(e.x||0)-(e.x=s):c=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(l.translate(-u,-c)),t.dirty(e)}s.union(l)}const RZ=(t,e)=>Math.floor(Math.min(t,e)),LZ=(t,e)=>Math.ceil(Math.max(t,e));function $Z(t){return(new Qq).set(0,0,t.width||0,t.height||0)}function PZ(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function zZ(t,e,n){const i=GN(t)?t[e]:t;return null!=i?i:void 0!==n?n:0}function BZ(t){return t<0?Math.ceil(-t):0}function VZ(t,e,n){var i,r,o,a,s,l,u,c,h,d,p,f=!n.nodirty,g="flush"===n.bounds?$Z:PZ,m=TZ.set(0,0,0,0),y=zZ(n.align,"column"),v=zZ(n.align,yZ),x=zZ(n.padding,"column"),b=zZ(n.padding,yZ),w=n.columns||e.length,_=w<=0?1:Math.ceil(e.length/w),k=e.length,S=Array(k),C=Array(w),A=0,I=Array(k),M=Array(_),D=0,T=Array(k),E=Array(k),N=Array(k);for(r=0;r<w;++r)C[r]=0;for(r=0;r<_;++r)M[r]=0;for(r=0;r<k;++r)l=e[r],s=N[r]=g(l),l.x=l.x||0,T[r]=0,l.y=l.y||0,E[r]=0,o=r%w,a=~~(r/w),A=Math.max(A,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),C[o]=Math.max(C[o],u),M[a]=Math.max(M[a],c),S[r]=x+BZ(s.x1),I[r]=b+BZ(s.y1),f&&t.dirty(e[r]);for(r=0;r<k;++r)r%w==0&&(S[r]=0),r<w&&(I[r]=0);if("each"===y)for(o=1;o<w;++o){for(p=0,r=o;r<k;r+=w)p<S[r]&&(p=S[r]);for(r=o;r<k;r+=w)S[r]=p+C[o-1]}else if("all"===y){for(p=0,r=0;r<k;++r)r%w&&p<S[r]&&(p=S[r]);for(r=0;r<k;++r)r%w&&(S[r]=p+A)}else for(y=!1,o=1;o<w;++o)for(r=o;r<k;r+=w)S[r]+=C[o-1];if("each"===v)for(a=1;a<_;++a){for(p=0,i=(r=a*w)+w;r<i;++r)p<I[r]&&(p=I[r]);for(r=a*w;r<i;++r)I[r]=p+M[a-1]}else if("all"===v){for(p=0,r=w;r<k;++r)p<I[r]&&(p=I[r]);for(r=w;r<k;++r)I[r]=p+D}else for(v=!1,a=1;a<_;++a)for(i=(r=a*w)+w;r<i;++r)I[r]+=M[a-1];for(h=0,r=0;r<k;++r)h=S[r]+(r%w?h:0),T[r]+=h-e[r].x;for(o=0;o<w;++o)for(d=0,r=o;r<k;r+=w)d+=I[r],E[r]+=d-e[r].y;if(y&&zZ(n.center,"column")&&_>1)for(r=0;r<k;++r)(h=(s="all"===y?A:C[r%w])-N[r].x2-e[r].x-T[r])>0&&(T[r]+=h/2);if(v&&zZ(n.center,yZ)&&1!==w)for(r=0;r<k;++r)(d=(s="all"===v?D:M[~~(r/w)])-N[r].y2-e[r].y-E[r])>0&&(E[r]+=d/2);for(r=0;r<k;++r)m.union(N[r].translate(T[r],E[r]));switch(h=zZ(n.anchor,"x"),d=zZ(n.anchor,"y"),zZ(n.anchor,"column")){case"end":h-=m.width();break;case"middle":h-=m.width()/2}switch(zZ(n.anchor,yZ)){case"end":d-=m.height();break;case"middle":d-=m.height()/2}for(h=Math.round(h),d=Math.round(d),m.clear(),r=0;r<k;++r)e[r].mark.bounds.clear();for(r=0;r<k;++r)(l=e[r]).x+=T[r]+=h,l.y+=E[r]+=d,m.union(l.mark.bounds.union(l.bounds.translate(T[r],E[r]))),f&&t.dirty(l);return m}function WZ(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function jZ(t,e){return t.bounds[e]}function UZ(t,e,n,i,r,o,a,s,l,u,c,h,d,p){var f,g,m,y,v,x,b,w,_,k=n.length,S=0,C=0;if(!k)return S;for(f=c;f<k;f+=h)n[f]&&(S=a(S,l(n[f],u)));if(!e.length)return S;for(e.length>r&&(t.warn("Grid headers exceed limit: "+r),e=e.slice(0,r)),S+=o,g=0,y=e.length;g<y;++g)t.dirty(e[g]),e[g].mark.bounds.clear();for(f=c,g=0,y=e.length;g<y;++g,f+=h){for(v=(x=e[g]).mark.bounds,m=f;m>=0&&null==(b=n[m]);m-=d);s?(w=null==p?b.x:Math.round(b.bounds.x1+p*b.bounds.width()),_=S):(w=S,_=null==p?b.y:Math.round(b.bounds.y1+p*b.bounds.height())),v.union(x.bounds.translate(w-(x.x||0),_-(x.y||0))),x.x=w,x.y=_,t.dirty(x),C=a(C,v[u])}return C}function GZ(t,e,n,i,r,o){if(e){t.dirty(e);var a=n,s=n;i?a=Math.round(r.x1+o*r.width()):s=Math.round(r.y1+o*r.height()),e.bounds.translate(a-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=a,e.y=s,t.dirty(e)}}function HZ(t,e,n,i,r,o,a){const s=function(t,e){const n=t[e]||{};return(e,i)=>null!=n[e]?n[e]:null!=t[e]?t[e]:i}(n,e),l=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,s("offset",0)),u=s("anchor","start"),c="end"===u?1:"middle"===u?.5:0,h={align:"each",bounds:s("bounds","flush"),columns:"vertical"===s("direction")?1:t.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(e){case"left":h.anchor={x:Math.floor(i.x1)-l,column:"end",y:c*(a||i.height()+2*i.y1),row:u};break;case"right":h.anchor={x:Math.ceil(i.x2)+l,y:c*(a||i.height()+2*i.y1),row:u};break;case"top":h.anchor={y:Math.floor(r.y1)-l,row:"end",x:c*(o||r.width()+2*r.x1),column:u};break;case"bottom":h.anchor={y:Math.ceil(r.y2)+l,x:c*(o||r.width()+2*r.x1),column:u};break;case"top-left":h.anchor={x:l,y:l};break;case"top-right":h.anchor={x:o-l,y:l,column:"end"};break;case"bottom-left":h.anchor={x:l,y:a-l,row:"end"};break;case"bottom-right":h.anchor={x:o-l,y:a-l,column:"end",row:"end"}}return h}function qZ(t,e){var n,i,r=e.items[0],o=r.datum,a=r.orient,s=r.bounds,l=r.x,u=r.y;return r._bounds?r._bounds.clear().union(s):r._bounds=s.clone(),s.clear(),function(t,e,n){var i=e.padding,r=i-n.x,o=i-n.y;if(e.datum.title){var a=e.items[1].items[0],s=a.anchor,l=e.titlePadding||0,u=i-a.x,c=i-a.y;switch(a.orient){case"left":r+=Math.ceil(a.bounds.width())+l;break;case"right":case"bottom":break;default:o+=a.bounds.height()+l}switch((r||o)&&YZ(t,n,r,o),a.orient){case"left":c+=XZ(e,n,a,s,1,1);break;case"right":u+=XZ(e,n,a,"end",0,0)+l,c+=XZ(e,n,a,s,1,1);break;case"bottom":u+=XZ(e,n,a,s,0,0),c+=XZ(e,n,a,"end",-1,0,1)+l;break;default:u+=XZ(e,n,a,s,0,0)}(u||c)&&YZ(t,a,u,c),(u=Math.round(a.bounds.x1-i))<0&&(YZ(t,n,-u,0),YZ(t,a,-u,0))}else(r||o)&&YZ(t,n,r,o)}(t,r,r.items[0].items[0]),s=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(r,s),n=2*r.padding,i=2*r.padding,s.empty()||(n=Math.ceil(s.width()+n),i=Math.ceil(s.height()+i)),"symbol"===o.type&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(r.items[0].items[0].items[0].items),"none"!==a&&(r.x=l=0,r.y=u=0),r.width=n,r.height=i,oX(s.set(l,u,l+n,u+i),r),r.mark.bounds.clear().union(s),r}function XZ(t,e,n,i,r,o,a){const s="symbol"!==t.datum.type,l=n.datum.vgrad,u=(!s||!o&&l||a?e:e.items[0]).bounds[r?"y2":"x2"]-t.padding,c=l&&o?u:0,h=l&&o?0:u,d=r<=0?0:PY(n);return Math.round("start"===i?c:"end"===i?h-d:.5*(u-d))}function YZ(t,e,n,i){e.x+=n,e.y+=i,e.bounds.translate(n,i),e.mark.bounds.translate(n,i),t.dirty(e)}function KZ(t){Iz.call(this,null,t)}OO(KZ,Iz,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&function(t,e,n){var i,r,o,a,s,l,u,c=function(t){var e,n,i=t.items,r=i.length,o=0;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;o<r;++o)if(n=(e=i[o]).items,"group"===e.marktype)switch(e.role){case"axis":case"legend":case"title":break;case"row-header":a.rowheaders.push(...n);break;case"row-footer":a.rowfooters.push(...n);break;case"column-header":a.colheaders.push(...n);break;case"column-footer":a.colfooters.push(...n);break;case"row-title":a.rowtitle=n[0];break;case"column-title":a.coltitle=n[0];break;default:a.marks.push(...n)}return a}(e),h=c.marks,d="flush"===n.bounds?WZ:jZ,p=n.offset,f=n.columns||h.length,g=f<=0?1:Math.ceil(h.length/f),m=g*f;const y=VZ(t,h,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=zZ(n.headerBand,yZ,null),i=UZ(t,c.rowheaders,h,0,g,-zZ(p,"rowHeader"),RZ,0,d,"x1",0,f,1,l)),c.colheaders&&(l=zZ(n.headerBand,"column",null),r=UZ(t,c.colheaders,h,0,f,-zZ(p,"columnHeader"),RZ,1,d,"y1",0,1,f,l)),c.rowfooters&&(l=zZ(n.footerBand,yZ,null),o=UZ(t,c.rowfooters,h,0,g,zZ(p,"rowFooter"),LZ,0,d,"x2",f-1,f,1,l)),c.colfooters&&(l=zZ(n.footerBand,"column",null),a=UZ(t,c.colfooters,h,0,f,zZ(p,"columnFooter"),LZ,1,d,"y2",m-f,1,f,l)),c.rowtitle&&(s=zZ(n.titleAnchor,yZ),u=zZ(p,"rowTitle"),u="end"===s?o+u:i-u,l=zZ(n.titleBand,yZ,.5),GZ(t,c.rowtitle,u,0,y,l)),c.coltitle&&(s=zZ(n.titleAnchor,"column"),u=zZ(p,"columnTitle"),u="end"===s?a+u:r-u,l=zZ(n.titleBand,"column",.5),GZ(t,c.coltitle,u,1,y,l))}(n,e,t.layout),function(t,e,n){var i,r,o,a,s,l=e.items,u=Math.max(0,e.width||0),c=Math.max(0,e.height||0),h=(new Qq).set(0,0,u,c),d=h.clone(),p=h.clone(),f=[];for(a=0,s=l.length;a<s;++a)switch((r=l[a]).role){case"axis":(NZ(r)?d:p).union(OZ(t,r,u,c));break;case"title":i=r;break;case"legend":f.push(qZ(t,r));break;case"frame":case"scope":case"row-header":case"row-footer":case"row-title":case"column-header":case"column-footer":case"column-title":d.union(r.bounds),p.union(r.bounds);break;default:h.union(r.bounds)}if(f.length){const e={};f.forEach((t=>{"none"!==(o=t.orient||"right")&&(e[o]||(e[o]=[])).push(t)}));for(const i in e){const r=e[i];VZ(t,r,HZ(r,i,n.legends,d,p,u,c))}f.forEach((e=>{const i=e.bounds;if(i.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=i,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case"left":case"right":h.add(i.x1,0).add(i.x2,0);break;case"top":case"bottom":h.add(0,i.y1).add(0,i.y2)}else h.union(i)}))}h.union(d).union(p),i&&h.union(function(t,e,n,i,r){var o,a=e.items[0],s=a.frame,l=a.orient,u=a.anchor,c=a.offset,h=a.padding,d=a.items[0].items[0],p=a.items[1]&&a.items[1].items[0],f="left"===l||"right"===l?i:n,g=0,m=0,y=0,v=0,x=0;if("group"!==s?"left"===l?(g=r.y2,f=r.y1):"right"===l?(g=r.y1,f=r.y2):(g=r.x1,f=r.x2):"left"===l&&(g=i,f=0),o="start"===u?g:"end"===u?f:(g+f)/2,p&&p.text){switch(l){case"top":case"bottom":x=d.bounds.height()+h;break;case"left":v=d.bounds.width()+h;break;case"right":v=-d.bounds.width()-h}TZ.clear().union(p.bounds),TZ.translate(v-(p.x||0),x-(p.y||0)),EZ(p,"x",v)|EZ(p,"y",x)&&(t.dirty(p),p.bounds.clear().union(TZ),p.mark.bounds.clear().union(TZ),t.dirty(p)),TZ.clear().union(p.bounds)}else TZ.clear();switch(TZ.union(d.bounds),l){case"top":m=o,y=r.y1-TZ.height()-c;break;case"left":m=r.x1-TZ.width()-c,y=o;break;case"right":m=r.x2+TZ.width()+c,y=o;break;case"bottom":m=o,y=r.y2+c;break;default:m=a.x,y=a.y}return EZ(a,"x",m)|EZ(a,"y",y)&&(TZ.translate(m,y),t.dirty(a),a.bounds.clear().union(TZ),e.bounds.clear().union(TZ),t.dirty(a)),a.bounds}(t,i,u,c,h));e.clip&&h.set(0,0,e.width||0,e.height||0);!function(t,e,n,i){const r=i.autosize||{},o=r.type;if(t._autosize<1||!o)return;let a=t._width,s=t._height,l=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),h=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),p=Math.max(0,Math.ceil(n.y2-c));if("padding"===r.contains){const e=t.padding();a-=e.left+e.right,s-=e.top+e.bottom}"none"===o?(u=0,h=0,l=a,c=s):"fit"===o?(l=Math.max(0,a-u-d),c=Math.max(0,s-h-p)):"fit-x"===o?(l=Math.max(0,a-u-d),s=c+h+p):"fit-y"===o?(a=l+u+d,c=Math.max(0,s-h-p)):"pad"===o&&(a=l+u+d,s=c+h+p);t._resizeView(a,s,l,c,[u,h],r.resize)}(t,e,h,n)}(n,e,t)})),(i=t.mark.group)&&"legend-entry"!==i.mark.role?e.reflow():e;var i}});var ZZ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",bound:vZ,identifier:bZ,mark:wZ,overlap:_Z,render:DZ,viewlayout:KZ});function JZ(t){Iz.call(this,null,t)}function QZ(t){Iz.call(this,null,t)}function tJ(){return ZP({})}function eJ(t){Iz.call(this,null,t)}function nJ(t){Iz.call(this,[],t)}OO(JZ,Iz,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,o=t.scale,a=BH(o,null==t.count?t.values?t.values.length:10:t.count,t.minstep),s=t.format||jH(n,o,a,t.formatSpecifier,t.formatType,!!t.values),l=t.values?VH(o,t.values,a):WH(o,a);return r&&(i.rem=r),r=l.map(((t,e)=>ZP({index:e/(l.length-1||1),value:t,label:s(t)}))),t.extra&&r.length&&r.push(ZP({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}}),OO(QZ,Iz,{transform(t,e){var n=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.item||tJ,o=t.key||YP,a=this.value;return UN(i.encode)&&(i.encode=null),a&&(t.modified("key")||e.modified(o))&&ON("DataJoin does not support modified key function or fields."),a||(e=e.addAll(),this.value=a=function(t){const e=EO().test((t=>t.exit));return e.lookup=n=>e.get(t(n)),e}(o)),e.visit(e.ADD,(t=>{const e=o(t);let n=a.get(e);n?n.exit?(a.empty--,i.add.push(n)):i.mod.push(n):(n=r(t),a.set(e,n),i.add.push(n)),n.datum=t,n.exit=!1})),e.visit(e.MOD,(t=>{const e=o(t),n=a.get(e);n&&(n.datum=t,i.mod.push(n))})),e.visit(e.REM,(t=>{const e=o(t),n=a.get(e);t!==n.datum||n.exit||(i.rem.push(n),n.exit=!0,++a.empty)})),e.changed(e.ADD_MOD)&&i.modifies("datum"),(e.clean()||t.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),i}}),OO(eJ,Iz,{transform(t,e){var n=e.fork(e.ADD_REM),i=t.mod||!1,r=t.encoders,o=e.encode;if(UN(o)){if(!n.changed()&&!o.every((t=>r[t])))return e.StopPropagation;o=o[0],n.encode=null}var a="enter"===o,s=r.update||VN,l=r.enter||VN,u=r.exit||VN,c=(o&&!a?r[o]:s)||VN;if(e.changed(e.ADD)&&(e.visit(e.ADD,(e=>{l(e,t),s(e,t)})),n.modifies(l.output),n.modifies(s.output),c!==VN&&c!==s&&(e.visit(e.ADD,(e=>{c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&u!==VN&&(e.visit(e.REM,(e=>{u(e,t)})),n.modifies(u.output)),a||c!==VN){const r=e.MOD|(t.modified()?e.REFLOW:0);a?(e.visit(r,(e=>{const r=l(e,t)||i;(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(l.output)):e.visit(r,(e=>{(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation}}),OO(nJ,Iz,{transform(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,i,r,o,a,s=e.dataflow.locale(),l=e.fork(e.NO_SOURCE|e.NO_FIELDS),u=this.value,c=t.type||"symbol",h=t.scale,d=+t.limit,p=BH(h,null==t.count?5:t.count,t.minstep),f=!!t.values||"symbol"===c,g=t.format||XH(s,h,p,c,t.formatSpecifier,t.formatType,f),m=t.values||qH(h,p);return u&&(l.rem=u),"symbol"===c?(d&&m.length>d?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=m.slice(0,d-1),a=!0):u=m,yO(r=t.size)?(t.values||0!==h(u[0])||(u=u.slice(1)),o=u.reduce(((e,n)=>Math.max(e,r(n,t))),0)):r=kO(o=r||8),u=u.map(((e,n)=>ZP({index:n,label:g(e,n,u),value:e,offset:o,size:r(e,t)}))),a&&(a=m[u.length],u.push(ZP({index:u.length,label:"…".concat(m.length-u.length," entries"),value:a,offset:o,size:r(a,t)})))):"gradient"===c?(n=h.domain(),i=EH(h,n[0],KN(n)),m.length<3&&!t.values&&n[0]!==KN(n)&&(m=[n[0],KN(n)]),u=m.map(((t,e)=>ZP({index:e,label:g(t,e,m),value:t,perc:i(t)})))):(r=m.length-1,i=function(t){const e=t.domain(),n=e.length-1;let i=+e[0],r=+KN(e),o=r-i;if("threshold"===t.type){const t=n?o/n:.1;i-=t,r+=t,o=r-i}return t=>(t-i)/o}(h),u=m.map(((t,e)=>ZP({index:e,label:g(t,e,m),value:t,perc:e?i(t):0,perc2:e===r?1:i(m[e+1])})))),l.source=u,l.add=u,this.value=u,l}});const iJ=t=>t.source.x,rJ=t=>t.source.y,oJ=t=>t.target.x,aJ=t=>t.target.y;function sJ(t){Iz.call(this,{},t)}sJ.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},OO(sJ,Iz,{transform(t,e){var n=t.sourceX||iJ,i=t.sourceY||rJ,r=t.targetX||oJ,o=t.targetY||aJ,a=t.as||"path",s=t.orient||"vertical",l=t.shape||"line",u=hJ.get(l+"-"+s)||hJ.get(l);return u||ON("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(t=>{t[a]=u(n(t),i(t),r(t),o(t))})),e.reflow(t.modified()).modifies(a)}});const lJ=(t,e,n,i)=>"M"+t+","+e+"L"+n+","+i,uJ=(t,e,n,i)=>{var r=n-t,o=i-e,a=Math.sqrt(r*r+o*o)/2;return"M"+t+","+e+"A"+a+","+a+" "+180*Math.atan2(o,r)/Math.PI+" 0 1 "+n+","+i},cJ=(t,e,n,i)=>{const r=n-t,o=i-e,a=.2*(r+o),s=.2*(o-r);return"M"+t+","+e+"C"+(t+a)+","+(e+s)+" "+(n+s)+","+(i-a)+" "+n+","+i},hJ=EO({line:lJ,"line-radial":(t,e,n,i)=>lJ(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),arc:uJ,"arc-radial":(t,e,n,i)=>uJ(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),curve:cJ,"curve-radial":(t,e,n,i)=>cJ(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(t,e,n,i)=>"M"+t+","+e+"V"+i+"H"+n,"orthogonal-vertical":(t,e,n,i)=>"M"+t+","+e+"H"+n+"V"+i,"orthogonal-radial":(t,e,n,i)=>{const r=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n);return"M"+e*r+","+e*o+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*a+","+e*s+"L"+i*a+","+i*s},"diagonal-horizontal":(t,e,n,i)=>{const r=(t+n)/2;return"M"+t+","+e+"C"+r+","+e+" "+r+","+i+" "+n+","+i},"diagonal-vertical":(t,e,n,i)=>{const r=(e+i)/2;return"M"+t+","+e+"C"+t+","+r+" "+n+","+r+" "+n+","+i},"diagonal-radial":(t,e,n,i)=>{const r=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n),l=(e+i)/2;return"M"+e*r+","+e*o+"C"+l*r+","+l*o+" "+l*a+","+l*s+" "+i*a+","+i*s}});function dJ(t){Iz.call(this,null,t)}dJ.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},OO(dJ,Iz,{transform(t,e){var n,i,r,o=t.as||["startAngle","endAngle"],a=o[0],s=o[1],l=t.field||zN,u=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,h=e.source,d=h.map(l),p=d.length,f=u,g=(c-u)/lR(d),m=sR(p);for(t.sort&&m.sort(((t,e)=>d[t]-d[e])),n=0;n<p;++n)r=d[m[n]],(i=h[m[n]])[a]=f,i[s]=f+=r*g;return this.value=d,e.reflow(t.modified()).modifies(o)}});function pJ(t){return wH(t)&&"sequential"!==t}const fJ=QO(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function gJ(t){Iz.call(this,null,t),this.modified(!0)}function mJ(t,e,n){SH(t)&&(Math.abs(e.reduce(((t,e)=>t+(e<0?-1:e>0?1:0)),0))!==e.length&&n.warn("Log scale domain includes zero: "+XO(e)));return e}function yJ(t,e,n){return yO(t)&&(e||n)?MH(t,vJ(e||[0,1],n)):t}function vJ(t,e){return e?t.slice().reverse():t}function xJ(t){Iz.call(this,null,t)}OO(gJ,Iz,{transform(t,e){var n=e.dataflow,i=this.value,r=function(t){var e,n=t.type,i="";if(n===uH)return"sequential-linear";(function(t){const e=t.type;return wH(e)&&e!==sH&&e!==lH&&(t.scheme||t.range&&t.range.length&&t.range.every(BO))})(t)&&(i=2===(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?"sequential-":3===e?"diverging-":"");return(i+n||"linear").toLowerCase()}(t);for(r in i&&r===i.type||(this.value=i=vH(r)()),t)if(!fJ[r]){if("padding"===r&&pJ(i.type))continue;yO(i[r])?i[r](t[r]):n.warn("Unsupported scale property: "+r)}return function(t,e,n){var i=t.type,r=e.round||!1,o=e.range;if(null!=e.rangeStep)o=function(t,e,n){"band"!==t&&"point"!==t&&ON("Only band and point scales support rangeStep.");var i=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,r="point"===t?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*rH(n,r,i)]}(i,e,n);else if(e.scheme&&(o=function(t,e,n){var i,r=e.schemeExtent;UN(e.scheme)?i=DH(e.scheme,e.interpolate,e.interpolateGamma):(i=LH(e.scheme.toLowerCase()))||ON("Unrecognized scheme name: ".concat(e.scheme));return n="threshold"===t?n+1:"bin-ordinal"===t?n-1:"quantile"===t||"quantize"===t?+e.schemeCount||5:n,CH(t)?yJ(i,r,e.reverse):yO(i)?TH(yJ(i,r),n):"ordinal"===t?i:i.slice(0,n)}(i,e,n),yO(o))){if(t.interpolator)return t.interpolator(o);ON("Scale type ".concat(i," does not support interpolating color schemes."))}if(o&&CH(i))return t.interpolator(DH(vJ(o,e.reverse),e.interpolate,e.interpolateGamma));o&&e.interpolate&&t.interpolate?t.interpolate(NH(e.interpolate,e.interpolateGamma)):yO(t.round)?t.round(r):yO(t.rangeRound)&&t.interpolate(r?LU:RU);o&&t.range(vJ(o,e.reverse))}(i,t,function(t,e,n){let i=e.bins;if(i&&!UN(i)){const e=t.domain(),n=e[0],r=KN(e),o=i.step;let a=null==i.start?n:i.start,s=null==i.stop?r:i.stop;o||ON("Scale bins parameter missing step property."),a<n&&(a=o*Math.ceil(n/o)),s>r&&(s=o*Math.floor(r/o)),i=sR(a,s+o/2,o)}i?t.bins=i:t.bins&&delete t.bins;"bin-ordinal"===t.type&&(i?e.domain||e.domainRaw||(t.domain(i),n=i.length):t.bins=t.domain());return n}(i,t,function(t,e,n){const i=function(t,e,n){return e?(t.domain(mJ(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(i>-1)return i;var r,o,a=e.domain,s=t.type,l=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&("linear"===e||"pow"===e||"sqrt"===e)}(t);if(!a)return 0;pJ(s)&&e.padding&&a[0]!==KN(a)&&(a=function(t,e,n,i,r,o){var a=Math.abs(KN(n)-n[0]),s=a/(a-2*i),l=t===oH?cO(e,null,s):"sqrt"===t?hO(e,null,s,.5):t===aH?hO(e,null,s,r||1):"symlog"===t?dO(e,null,s,o||1):uO(e,null,s);return(e=e.slice())[0]=l[0],e[e.length-1]=l[1],e}(s,a,e.range,e.padding,e.exponent,e.constant));if((l||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(r=(a=a.slice()).length-1||1,l&&(a[0]>0&&(a[0]=0),a[r]<0&&(a[r]=0)),null!=e.domainMin&&(a[0]=e.domainMin),null!=e.domainMax&&(a[r]=e.domainMax),null!=e.domainMid)){const t=(o=e.domainMid)>a[r]?r+1:o<a[0]?0:r;t!==r&&n.warn("Scale domainMid exceeds domain min or max.",o),a.splice(t,0,o)}t.domain(mJ(s,a,n)),"ordinal"===s&&t.unknown(e.domainImplicit?lj:void 0);e.nice&&t.nice&&t.nice(!0!==e.nice&&BH(t,e.nice)||null);return a.length}(i,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),OO(xJ,Iz,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(ez(t.sort)),this.modified(n),e}});const bJ=["y0","y1"];function wJ(t){Iz.call(this,null,t)}function _J(t,e,n,i,r){for(var o,a=(e-t.sum)/2,s=t.length,l=0;l<s;++l)(o=t[l])[i]=a,o[r]=a+=Math.abs(n(o))}function kJ(t,e,n,i,r){for(var o,a=1/t.sum,s=0,l=t.length,u=0,c=0;u<l;++u)(o=t[u])[i]=s,o[r]=s=a*(c+=Math.abs(n(o)))}function SJ(t,e,n,i,r){for(var o,a,s=0,l=0,u=t.length,c=0;c<u;++c)(o=+n(a=t[c]))<0?(a[i]=l,a[r]=l+=o):(a[i]=s,a[r]=s+=o)}wJ.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:bJ}]},OO(wJ,Iz,{transform(t,e){var n,i,r,o,a=t.as||bJ,s=a[0],l=a[1],u=ez(t.sort),c=t.field||zN,h="center"===t.offset?_J:"normalize"===t.offset?kJ:SJ;for(n=function(t,e,n,i){var r,o,a,s,l,u,c,h,d,p=[],f=t=>t(l);if(null==e)p.push(t.slice());else for(r={},o=0,a=t.length;o<a;++o)l=t[o],(c=r[u=e.map(f)])||(r[u]=c=[],p.push(c)),c.push(l);for(u=0,d=0,s=p.length;u<s;++u){for(o=0,h=0,a=(c=p[u]).length;o<a;++o)h+=Math.abs(i(c[o]));c.sum=h,h>d&&(d=h),n&&c.sort(n)}return p.max=d,p}(e.source,t.groupby,u,c),i=0,r=n.length,o=n.max;i<r;++i)h(n[i],o,c,s,l);return e.reflow(t.modified()).modifies(a)}});var CJ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",axisticks:JZ,datajoin:QZ,encode:eJ,legendentries:nJ,linkpath:sJ,pie:dJ,scale:gJ,sortitems:xJ,stack:wJ}),AJ=Math.PI,IJ=AJ/2,MJ=AJ/4,DJ=2*AJ,TJ=180/AJ,EJ=AJ/180,NJ=Math.abs,OJ=Math.atan,FJ=Math.atan2,RJ=Math.cos,LJ=Math.ceil,$J=Math.exp,PJ=Math.hypot,zJ=Math.log,BJ=Math.pow,VJ=Math.sin,WJ=Math.sign||function(t){return t>0?1:t<0?-1:0},jJ=Math.sqrt,UJ=Math.tan;function GJ(t){return t>1?0:t<-1?AJ:Math.acos(t)}function HJ(t){return t>1?IJ:t<-1?-IJ:Math.asin(t)}function qJ(){}function XJ(t,e){t&&KJ.hasOwnProperty(t.type)&&KJ[t.type](t,e)}var YJ={Feature:function(t,e){XJ(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)XJ(n[i].geometry,e)}},KJ={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){ZJ(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ZJ(n[i],e,0)},Polygon:function(t,e){JJ(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)JJ(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)XJ(n[i],e)}};function ZJ(t,e,n){var i,r=-1,o=t.length-n;for(e.lineStart();++r<o;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function JJ(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)ZJ(t[n],e,1);e.polygonEnd()}function QJ(t,e){t&&YJ.hasOwnProperty(t.type)?YJ[t.type](t,e):XJ(t,e)}var tQ,eQ,nQ,iQ,rQ,oQ,aQ,sQ,lQ,uQ,cQ,hQ,dQ,pQ,fQ,gQ,mQ=new HF,yQ=new HF,vQ={point:qJ,lineStart:qJ,lineEnd:qJ,polygonStart:function(){mQ=new HF,vQ.lineStart=xQ,vQ.lineEnd=bQ},polygonEnd:function(){var t=+mQ;yQ.add(t<0?DJ+t:t),this.lineStart=this.lineEnd=this.point=qJ},sphere:function(){yQ.add(DJ)}};function xQ(){vQ.point=wQ}function bQ(){_Q(tQ,eQ)}function wQ(t,e){vQ.point=_Q,tQ=t,eQ=e,nQ=t*=EJ,iQ=RJ(e=(e*=EJ)/2+MJ),rQ=VJ(e)}function _Q(t,e){var n=(t*=EJ)-nQ,i=n>=0?1:-1,r=i*n,o=RJ(e=(e*=EJ)/2+MJ),a=VJ(e),s=rQ*a,l=iQ*o+s*RJ(r),u=s*i*VJ(r);mQ.add(FJ(u,l)),nQ=t,iQ=o,rQ=a}function kQ(t){return[FJ(t[1],t[0]),HJ(t[2])]}function SQ(t){var e=t[0],n=t[1],i=RJ(n);return[i*RJ(e),i*VJ(e),VJ(n)]}function CQ(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function AQ(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function IQ(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function MQ(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function DQ(t){var e=jJ(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var TQ,EQ,NQ,OQ,FQ,RQ,LQ,$Q,PQ,zQ,BQ,VQ,WQ,jQ,UQ,GQ,HQ={point:qQ,lineStart:YQ,lineEnd:KQ,polygonStart:function(){HQ.point=ZQ,HQ.lineStart=JQ,HQ.lineEnd=QQ,pQ=new HF,vQ.polygonStart()},polygonEnd:function(){vQ.polygonEnd(),HQ.point=qQ,HQ.lineStart=YQ,HQ.lineEnd=KQ,mQ<0?(oQ=-(sQ=180),aQ=-(lQ=90)):pQ>1e-6?lQ=90:pQ<-1e-6&&(aQ=-90),gQ[0]=oQ,gQ[1]=sQ},sphere:function(){oQ=-(sQ=180),aQ=-(lQ=90)}};function qQ(t,e){fQ.push(gQ=[oQ=t,sQ=t]),e<aQ&&(aQ=e),e>lQ&&(lQ=e)}function XQ(t,e){var n=SQ([t*EJ,e*EJ]);if(dQ){var i=AQ(dQ,n),r=AQ([i[1],-i[0],0],i);DQ(r),r=kQ(r);var o,a=t-uQ,s=a>0?1:-1,l=r[0]*TJ*s,u=NJ(a)>180;u^(s*uQ<l&&l<s*t)?(o=r[1]*TJ)>lQ&&(lQ=o):u^(s*uQ<(l=(l+360)%360-180)&&l<s*t)?(o=-r[1]*TJ)<aQ&&(aQ=o):(e<aQ&&(aQ=e),e>lQ&&(lQ=e)),u?t<uQ?t0(oQ,t)>t0(oQ,sQ)&&(sQ=t):t0(t,sQ)>t0(oQ,sQ)&&(oQ=t):sQ>=oQ?(t<oQ&&(oQ=t),t>sQ&&(sQ=t)):t>uQ?t0(oQ,t)>t0(oQ,sQ)&&(sQ=t):t0(t,sQ)>t0(oQ,sQ)&&(oQ=t)}else fQ.push(gQ=[oQ=t,sQ=t]);e<aQ&&(aQ=e),e>lQ&&(lQ=e),dQ=n,uQ=t}function YQ(){HQ.point=XQ}function KQ(){gQ[0]=oQ,gQ[1]=sQ,HQ.point=qQ,dQ=null}function ZQ(t,e){if(dQ){var n=t-uQ;pQ.add(NJ(n)>180?n+(n>0?360:-360):n)}else cQ=t,hQ=e;vQ.point(t,e),XQ(t,e)}function JQ(){vQ.lineStart()}function QQ(){ZQ(cQ,hQ),vQ.lineEnd(),NJ(pQ)>1e-6&&(oQ=-(sQ=180)),gQ[0]=oQ,gQ[1]=sQ,dQ=null}function t0(t,e){return(e-=t)<0?e+360:e}function e0(t,e){return t[0]-e[0]}function n0(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var i0={sphere:qJ,point:r0,lineStart:a0,lineEnd:u0,polygonStart:function(){i0.lineStart=c0,i0.lineEnd=h0},polygonEnd:function(){i0.lineStart=a0,i0.lineEnd=u0}};function r0(t,e){t*=EJ;var n=RJ(e*=EJ);o0(n*RJ(t),n*VJ(t),VJ(e))}function o0(t,e,n){++TQ,NQ+=(t-NQ)/TQ,OQ+=(e-OQ)/TQ,FQ+=(n-FQ)/TQ}function a0(){i0.point=s0}function s0(t,e){t*=EJ;var n=RJ(e*=EJ);jQ=n*RJ(t),UQ=n*VJ(t),GQ=VJ(e),i0.point=l0,o0(jQ,UQ,GQ)}function l0(t,e){t*=EJ;var n=RJ(e*=EJ),i=n*RJ(t),r=n*VJ(t),o=VJ(e),a=FJ(jJ((a=UQ*o-GQ*r)*a+(a=GQ*i-jQ*o)*a+(a=jQ*r-UQ*i)*a),jQ*i+UQ*r+GQ*o);EQ+=a,RQ+=a*(jQ+(jQ=i)),LQ+=a*(UQ+(UQ=r)),$Q+=a*(GQ+(GQ=o)),o0(jQ,UQ,GQ)}function u0(){i0.point=r0}function c0(){i0.point=d0}function h0(){p0(VQ,WQ),i0.point=r0}function d0(t,e){VQ=t,WQ=e,t*=EJ,e*=EJ,i0.point=p0;var n=RJ(e);jQ=n*RJ(t),UQ=n*VJ(t),GQ=VJ(e),o0(jQ,UQ,GQ)}function p0(t,e){t*=EJ;var n=RJ(e*=EJ),i=n*RJ(t),r=n*VJ(t),o=VJ(e),a=UQ*o-GQ*r,s=GQ*i-jQ*o,l=jQ*r-UQ*i,u=PJ(a,s,l),c=HJ(u),h=u&&-c/u;PQ.add(h*a),zQ.add(h*s),BQ.add(h*l),EQ+=c,RQ+=c*(jQ+(jQ=i)),LQ+=c*(UQ+(UQ=r)),$Q+=c*(GQ+(GQ=o)),o0(jQ,UQ,GQ)}function f0(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function g0(t,e){return[NJ(t)>AJ?t+Math.round(-t/DJ)*DJ:t,e]}function m0(t,e,n){return(t%=DJ)?e||n?f0(v0(t),x0(e,n)):v0(t):e||n?x0(e,n):g0}function y0(t){return function(e,n){return[(e+=t)>AJ?e-DJ:e<-AJ?e+DJ:e,n]}}function v0(t){var e=y0(t);return e.invert=y0(-t),e}function x0(t,e){var n=RJ(t),i=VJ(t),r=RJ(e),o=VJ(e);function a(t,e){var a=RJ(e),s=RJ(t)*a,l=VJ(t)*a,u=VJ(e),c=u*n+s*i;return[FJ(l*r-c*o,s*n-u*i),HJ(c*r+l*o)]}return a.invert=function(t,e){var a=RJ(e),s=RJ(t)*a,l=VJ(t)*a,u=VJ(e),c=u*r-l*o;return[FJ(l*r+u*o,s*n+c*i),HJ(c*n-s*i)]},a}function b0(t,e){(e=SQ(e))[0]-=t,DQ(e);var n=GJ(-e[1]);return((-e[2]<0?-n:n)+DJ-1e-6)%DJ}function w0(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:qJ,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function _0(t,e){return NJ(t[0]-e[0])<1e-6&&NJ(t[1]-e[1])<1e-6}function k0(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function S0(t,e,n,i,r){var o,a,s=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],a=t[e];if(_0(i,a)){if(!i[2]&&!a[2]){for(r.lineStart(),o=0;o<e;++o)r.point((i=t[o])[0],i[1]);return void r.lineEnd()}a[0]+=2e-6}s.push(n=new k0(i,t,null,!0)),l.push(n.o=new k0(i,null,n,!1)),s.push(n=new k0(a,t,null,!1)),l.push(n.o=new k0(a,null,n,!0))}})),s.length){for(l.sort(e),C0(s),C0(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var u,c,h=s[0];;){for(var d=h,p=!0;d.v;)if((d=d.n)===h)return;u=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(p)for(o=0,a=u.length;o<a;++o)r.point((c=u[o])[0],c[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(p)for(u=d.p.z,o=u.length-1;o>=0;--o)r.point((c=u[o])[0],c[1]);else i(d.x,d.p.x,-1,r);d=d.p}u=(d=d.o).z,p=!p}while(!d.v);r.lineEnd()}}}function C0(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function A0(t){return NJ(t[0])<=AJ?t[0]:WJ(t[0])*((NJ(t[0])+AJ)%DJ-AJ)}function I0(t,e,n,i){return function(r){var o,a,s,l=e(r),u=w0(),c=e(u),h=!1,d={point:p,lineStart:g,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=x,a=[],o=[]},polygonEnd:function(){d.point=p,d.lineStart=g,d.lineEnd=m,a=aR(a);var t=function(t,e){var n=A0(e),i=e[1],r=VJ(i),o=[VJ(n),-RJ(n),0],a=0,s=0,l=new HF;1===r?i=IJ+1e-6:-1===r&&(i=-IJ-1e-6);for(var u=0,c=t.length;u<c;++u)if(d=(h=t[u]).length)for(var h,d,p=h[d-1],f=A0(p),g=p[1]/2+MJ,m=VJ(g),y=RJ(g),v=0;v<d;++v,f=b,m=_,y=k,p=x){var x=h[v],b=A0(x),w=x[1]/2+MJ,_=VJ(w),k=RJ(w),S=b-f,C=S>=0?1:-1,A=C*S,I=A>AJ,M=m*_;if(l.add(FJ(M*C*VJ(A),y*k+M*RJ(A))),a+=I?S+C*DJ:S,I^f>=n^b>=n){var D=AQ(SQ(p),SQ(x));DQ(D);var T=AQ(o,D);DQ(T);var E=(I^S>=0?-1:1)*HJ(T[2]);(i>E||i===E&&(D[0]||D[1]))&&(s+=I^S>=0?1:-1)}}return(a<-1e-6||a<1e-6&&l<-1e-12)^1&s}(o,i);a.length?(h||(r.polygonStart(),h=!0),S0(a,D0,t,n,r)):t&&(h||(r.polygonStart(),h=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),h&&(r.polygonEnd(),h=!1),a=o=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function p(e,n){t(e,n)&&r.point(e,n)}function f(t,e){l.point(t,e)}function g(){d.point=f,l.lineStart()}function m(){d.point=p,l.lineEnd()}function y(t,e){s.push([t,e]),c.point(t,e)}function v(){c.lineStart(),s=[]}function x(){y(s[0][0],s[0][1]),c.lineEnd();var t,e,n,i,l=c.clean(),d=u.result(),p=d.length;if(s.pop(),o.push(s),s=null,p)if(1&l){if((e=(n=d[0]).length-1)>0){for(h||(r.polygonStart(),h=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}}else p>1&&2&l&&d.push(d.pop().concat(d.shift())),a.push(d.filter(M0))}return d}}function M0(t){return t.length>1}function D0(t,e){return((t=t.x)[0]<0?t[1]-IJ-1e-6:IJ-t[1])-((e=e.x)[0]<0?e[1]-IJ-1e-6:IJ-e[1])}g0.invert=g0;var T0=I0((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?AJ:-AJ,l=NJ(o-n);NJ(l-AJ)<1e-6?(t.point(n,i=(i+a)/2>0?IJ:-IJ),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(o,i),e=0):r!==s&&l>=AJ&&(NJ(n-r)<1e-6&&(n-=1e-6*r),NJ(o-s)<1e-6&&(o-=1e-6*s),i=function(t,e,n,i){var r,o,a=VJ(t-n);return NJ(a)>1e-6?OJ((VJ(e)*(o=RJ(i))*VJ(n)-VJ(i)*(r=RJ(e))*VJ(t))/(r*o*a)):(e+i)/2}(n,i,o,a),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=o,i=a),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*IJ,i.point(-AJ,r),i.point(0,r),i.point(AJ,r),i.point(AJ,0),i.point(AJ,-r),i.point(0,-r),i.point(-AJ,-r),i.point(-AJ,0),i.point(-AJ,r);else if(NJ(t[0]-e[0])>1e-6){var o=t[0]<e[0]?AJ:-AJ;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(e[0],e[1])}),[-AJ,-IJ]);function E0(t){var e=RJ(t),n=6*EJ,i=e>0,r=NJ(e)>1e-6;function o(t,n){return RJ(t)*RJ(n)>e}function a(t,n,i){var r=[1,0,0],o=AQ(SQ(t),SQ(n)),a=CQ(o,o),s=o[0],l=a-s*s;if(!l)return!i&&t;var u=e*a/l,c=-e*s/l,h=AQ(r,o),d=MQ(r,u);IQ(d,MQ(o,c));var p=h,f=CQ(d,p),g=CQ(p,p),m=f*f-g*(CQ(d,d)-1);if(!(m<0)){var y=jJ(m),v=MQ(p,(-f-y)/g);if(IQ(v,d),v=kQ(v),!i)return v;var x,b=t[0],w=n[0],_=t[1],k=n[1];w<b&&(x=b,b=w,w=x);var S=w-b,C=NJ(S-AJ)<1e-6;if(!C&&k<_&&(x=_,_=k,k=x),C||S<1e-6?C?_+k>0^v[1]<(NJ(v[0]-b)<1e-6?_:k):_<=v[1]&&v[1]<=k:S>AJ^(b<=v[0]&&v[0]<=w)){var A=MQ(p,(-f+y)/g);return IQ(A,d),[v,kQ(A)]}}}function s(e,n){var r=i?t:AJ-t,o=0;return e<-r?o|=1:e>r&&(o|=2),n<-r?o|=4:n>r&&(o|=8),o}return I0(o,(function(t){var e,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,d){var p,f=[h,d],g=o(h,d),m=i?g?0:s(h,d):g?s(h+(h<0?AJ:-AJ),d):0;if(!e&&(u=l=g)&&t.lineStart(),g!==l&&(!(p=a(e,f))||_0(e,p)||_0(f,p))&&(f[2]=1),g!==l)c=0,g?(t.lineStart(),p=a(f,e),t.point(p[0],p[1])):(p=a(e,f),t.point(p[0],p[1],2),t.lineEnd()),e=p;else if(r&&e&&i^g){var y;m&n||!(y=a(f,e,!0))||(c=0,i?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!g||e&&_0(e,f)||t.point(f[0],f[1]),e=f,l=g,n=m},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return c|(u&&l)<<1}}}),(function(e,i,r,o){!function(t,e,n,i,r,o){if(n){var a=RJ(e),s=VJ(e),l=i*n;null==r?(r=e+i*DJ,o=e-l/2):(r=b0(a,r),o=b0(a,o),(i>0?r<o:r>o)&&(r+=i*DJ));for(var u,c=r;i>0?c>o:c<o;c-=l)u=kQ([a,-s*RJ(c),-s*VJ(c)]),t.point(u[0],u[1])}}(o,t,n,r,e,i)}),i?[0,-t]:[-AJ,t-AJ])}function N0(t,e,n,i){function r(r,o){return t<=r&&r<=n&&e<=o&&o<=i}function o(r,o,s,u){var c=0,h=0;if(null==r||(c=a(r,s))!==(h=a(o,s))||l(r,o)<0^s>0)do{u.point(0===c||3===c?t:n,c>1?i:e)}while((c=(c+s+4)%4)!==h);else u.point(o[0],o[1])}function a(i,r){return NJ(i[0]-t)<1e-6?r>0?0:3:NJ(i[0]-n)<1e-6?r>0?2:1:NJ(i[1]-e)<1e-6?r>0?1:0:r>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),i=a(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,u,c,h,d,p,f,g,m,y,v,x=a,b=w0(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]);y=!0,m=!1,f=g=NaN},lineEnd:function(){l&&(k(h,d),p&&m&&b.rejoin(),l.push(b.result()));w.point=_,m&&x.lineEnd()},polygonStart:function(){x=b,l=[],u=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=u.length;n<r;++n)for(var o,a,s=u[n],l=1,c=s.length,h=s[0],d=h[0],p=h[1];l<c;++l)o=d,a=p,d=(h=s[l])[0],p=h[1],a<=i?p>i&&(d-o)*(i-a)>(p-a)*(t-o)&&++e:p<=i&&(d-o)*(i-a)<(p-a)*(t-o)&&--e;return e}(),n=v&&e,r=(l=aR(l)).length;(n||r)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),r&&S0(l,s,e,o,a),a.polygonEnd());x=a,l=u=c=null}};function _(t,e){r(t,e)&&x.point(t,e)}function k(o,a){var s=r(o,a);if(u&&c.push([o,a]),y)h=o,d=a,p=s,y=!1,s&&(x.lineStart(),x.point(o,a));else if(s&&m)x.point(o,a);else{var l=[f=Math.max(-1e9,Math.min(1e9,f)),g=Math.max(-1e9,Math.min(1e9,g))],b=[o=Math.max(-1e9,Math.min(1e9,o)),a=Math.max(-1e9,Math.min(1e9,a))];!function(t,e,n,i,r,o){var a,s=t[0],l=t[1],u=0,c=1,h=e[0]-s,d=e[1]-l;if(a=n-s,h||!(a>0)){if(a/=h,h<0){if(a<u)return;a<c&&(c=a)}else if(h>0){if(a>c)return;a>u&&(u=a)}if(a=r-s,h||!(a<0)){if(a/=h,h<0){if(a>c)return;a>u&&(u=a)}else if(h>0){if(a<u)return;a<c&&(c=a)}if(a=i-l,d||!(a>0)){if(a/=d,d<0){if(a<u)return;a<c&&(c=a)}else if(d>0){if(a>c)return;a>u&&(u=a)}if(a=o-l,d||!(a<0)){if(a/=d,d<0){if(a>c)return;a>u&&(u=a)}else if(d>0){if(a<u)return;a<c&&(c=a)}return u>0&&(t[0]=s+u*h,t[1]=l+u*d),c<1&&(e[0]=s+c*h,e[1]=l+c*d),!0}}}}}(l,b,t,e,n,i)?s&&(x.lineStart(),x.point(o,a),v=!1):(m||(x.lineStart(),x.point(l[0],l[1])),x.point(b[0],b[1]),s||x.lineEnd(),v=!1)}f=o,g=a,m=s}return w}}function O0(t,e,n){var i=sR(t,e-1e-6,n).concat(e);return function(t){return i.map((function(e){return[t,e]}))}}function F0(t,e,n){var i=sR(t,e-1e-6,n).concat(e);return function(t){return i.map((function(e){return[e,t]}))}}var R0,L0,$0,P0,z0=t=>t,B0=new HF,V0=new HF,W0={point:qJ,lineStart:qJ,lineEnd:qJ,polygonStart:function(){W0.lineStart=j0,W0.lineEnd=H0},polygonEnd:function(){W0.lineStart=W0.lineEnd=W0.point=qJ,B0.add(NJ(V0)),V0=new HF},result:function(){var t=B0/2;return B0=new HF,t}};function j0(){W0.point=U0}function U0(t,e){W0.point=G0,R0=$0=t,L0=P0=e}function G0(t,e){V0.add(P0*t-$0*e),$0=t,P0=e}function H0(){G0(R0,L0)}var q0=1/0,X0=q0,Y0=-q0,K0=Y0,Z0={point:function(t,e){t<q0&&(q0=t);t>Y0&&(Y0=t);e<X0&&(X0=e);e>K0&&(K0=e)},lineStart:qJ,lineEnd:qJ,polygonStart:qJ,polygonEnd:qJ,result:function(){var t=[[q0,X0],[Y0,K0]];return Y0=K0=-(X0=q0=1/0),t}};var J0,Q0,t1,e1,n1=0,i1=0,r1=0,o1=0,a1=0,s1=0,l1=0,u1=0,c1=0,h1={point:d1,lineStart:p1,lineEnd:m1,polygonStart:function(){h1.lineStart=y1,h1.lineEnd=v1},polygonEnd:function(){h1.point=d1,h1.lineStart=p1,h1.lineEnd=m1},result:function(){var t=c1?[l1/c1,u1/c1]:s1?[o1/s1,a1/s1]:r1?[n1/r1,i1/r1]:[NaN,NaN];return n1=i1=r1=o1=a1=s1=l1=u1=c1=0,t}};function d1(t,e){n1+=t,i1+=e,++r1}function p1(){h1.point=f1}function f1(t,e){h1.point=g1,d1(t1=t,e1=e)}function g1(t,e){var n=t-t1,i=e-e1,r=jJ(n*n+i*i);o1+=r*(t1+t)/2,a1+=r*(e1+e)/2,s1+=r,d1(t1=t,e1=e)}function m1(){h1.point=d1}function y1(){h1.point=x1}function v1(){b1(J0,Q0)}function x1(t,e){h1.point=b1,d1(J0=t1=t,Q0=e1=e)}function b1(t,e){var n=t-t1,i=e-e1,r=jJ(n*n+i*i);o1+=r*(t1+t)/2,a1+=r*(e1+e)/2,s1+=r,l1+=(r=e1*t-t1*e)*(t1+t),u1+=r*(e1+e),c1+=3*r,d1(t1=t,e1=e)}function w1(t){this._context=t}w1.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,DJ)}},result:qJ};var _1,k1,S1,C1,A1,I1=new HF,M1={point:qJ,lineStart:function(){M1.point=D1},lineEnd:function(){_1&&T1(k1,S1),M1.point=qJ},polygonStart:function(){_1=!0},polygonEnd:function(){_1=null},result:function(){var t=+I1;return I1=new HF,t}};function D1(t,e){M1.point=T1,k1=C1=t,S1=A1=e}function T1(t,e){C1-=t,A1-=e,I1.add(jJ(C1*C1+A1*A1)),C1=t,A1=e}function E1(){this._string=[]}function N1(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function O1(t,e){var n,i,r=4.5;function o(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),QJ(t,n(i))),i.result()}return o.area=function(t){return QJ(t,n(W0)),W0.result()},o.measure=function(t){return QJ(t,n(M1)),M1.result()},o.bounds=function(t){return QJ(t,n(Z0)),Z0.result()},o.centroid=function(t){return QJ(t,n(h1)),h1.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,z0):(t=e).stream,o):t},o.context=function(t){return arguments.length?(i=null==t?(e=null,new E1):new w1(e=t),"function"!=typeof r&&i.pointRadius(r),o):e},o.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(i.pointRadius(+t),+t),o):r},o.projection(t).context(e)}function F1(t){return function(e){var n=new R1;for(var i in t)n[i]=t[i];return n.stream=e,n}}function R1(){}function L1(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),QJ(n,t.stream(Z0)),e(Z0.result()),null!=i&&t.clipExtent(i),t}function $1(t,e,n){return L1(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+e[0][0]+(i-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])}),n)}function P1(t,e,n){return $1(t,[[0,0],e],n)}function z1(t,e,n){return L1(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),o=(i-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];t.scale(150*r).translate([o,a])}),n)}function B1(t,e,n){return L1(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),o=-r*n[0][0],a=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([o,a])}),n)}E1.prototype={_radius:4.5,_circle:N1(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=N1(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},R1.prototype={constructor:R1,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var V1=RJ(30*EJ);function W1(t,e){return+e?function(t,e){function n(i,r,o,a,s,l,u,c,h,d,p,f,g,m){var y=u-i,v=c-r,x=y*y+v*v;if(x>4*e&&g--){var b=a+d,w=s+p,_=l+f,k=jJ(b*b+w*w+_*_),S=HJ(_/=k),C=NJ(NJ(_)-1)<1e-6||NJ(o-h)<1e-6?(o+h)/2:FJ(w,b),A=t(C,S),I=A[0],M=A[1],D=I-i,T=M-r,E=v*D-y*T;(E*E/x>e||NJ((y*D+v*T)/x-.5)>.3||a*d+s*p+l*f<V1)&&(n(i,r,o,a,s,l,I,M,C,b/=k,w/=k,_,g,m),m.point(I,M),n(I,M,C,b,w,_,u,c,h,d,p,f,g,m))}}return function(e){var i,r,o,a,s,l,u,c,h,d,p,f,g={point:m,lineStart:y,lineEnd:x,polygonStart:function(){e.polygonStart(),g.lineStart=b},polygonEnd:function(){e.polygonEnd(),g.lineStart=y}};function m(n,i){n=t(n,i),e.point(n[0],n[1])}function y(){c=NaN,g.point=v,e.lineStart()}function v(i,r){var o=SQ([i,r]),a=t(i,r);n(c,h,u,d,p,f,c=a[0],h=a[1],u=i,d=o[0],p=o[1],f=o[2],16,e),e.point(c,h)}function x(){g.point=m,e.lineEnd()}function b(){y(),g.point=w,g.lineEnd=_}function w(t,e){v(i=t,e),r=c,o=h,a=d,s=p,l=f,g.point=v}function _(){n(c,h,u,d,p,f,r,o,i,a,s,l,16,e),g.lineEnd=x,x()}return g}}(t,e):function(t){return F1({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var j1=F1({point:function(t,e){this.stream.point(t*EJ,e*EJ)}});function U1(t,e,n,i,r,o){if(!o)return function(t,e,n,i,r){function o(o,a){return[e+t*(o*=i),n-t*(a*=r)]}return o.invert=function(o,a){return[(o-e)/t*i,(n-a)/t*r]},o}(t,e,n,i,r);var a=RJ(o),s=VJ(o),l=a*t,u=s*t,c=a/t,h=s/t,d=(s*n-a*e)/t,p=(s*e+a*n)/t;function f(t,o){return[l*(t*=i)-u*(o*=r)+e,n-u*t-l*o]}return f.invert=function(t,e){return[i*(c*t-h*e+d),r*(p-h*t-c*e)]},f}function G1(t){return H1((function(){return t}))()}function H1(t){var e,n,i,r,o,a,s,l,u,c,h=150,d=480,p=250,f=0,g=0,m=0,y=0,v=0,x=0,b=1,w=1,_=null,k=T0,S=null,C=z0,A=.5;function I(t){return l(t[0]*EJ,t[1]*EJ)}function M(t){return(t=l.invert(t[0],t[1]))&&[t[0]*TJ,t[1]*TJ]}function D(){var t=U1(h,0,0,b,w,x).apply(null,e(f,g)),i=U1(h,d-t[0],p-t[1],b,w,x);return n=m0(m,y,v),s=f0(e,i),l=f0(n,s),a=W1(s,A),T()}function T(){return u=c=null,I}return I.stream=function(t){return u&&c===t?u:u=j1(function(t){return F1({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}(n)(k(a(C(c=t)))))},I.preclip=function(t){return arguments.length?(k=t,_=void 0,T()):k},I.postclip=function(t){return arguments.length?(C=t,S=i=r=o=null,T()):C},I.clipAngle=function(t){return arguments.length?(k=+t?E0(_=t*EJ):(_=null,T0),T()):_*TJ},I.clipExtent=function(t){return arguments.length?(C=null==t?(S=i=r=o=null,z0):N0(S=+t[0][0],i=+t[0][1],r=+t[1][0],o=+t[1][1]),T()):null==S?null:[[S,i],[r,o]]},I.scale=function(t){return arguments.length?(h=+t,D()):h},I.translate=function(t){return arguments.length?(d=+t[0],p=+t[1],D()):[d,p]},I.center=function(t){return arguments.length?(f=t[0]%360*EJ,g=t[1]%360*EJ,D()):[f*TJ,g*TJ]},I.rotate=function(t){return arguments.length?(m=t[0]%360*EJ,y=t[1]%360*EJ,v=t.length>2?t[2]%360*EJ:0,D()):[m*TJ,y*TJ,v*TJ]},I.angle=function(t){return arguments.length?(x=t%360*EJ,D()):x*TJ},I.reflectX=function(t){return arguments.length?(b=t?-1:1,D()):b<0},I.reflectY=function(t){return arguments.length?(w=t?-1:1,D()):w<0},I.precision=function(t){return arguments.length?(a=W1(s,A=t*t),T()):jJ(A)},I.fitExtent=function(t,e){return $1(I,t,e)},I.fitSize=function(t,e){return P1(I,t,e)},I.fitWidth=function(t,e){return z1(I,t,e)},I.fitHeight=function(t,e){return B1(I,t,e)},function(){return e=t.apply(this,arguments),I.invert=e.invert&&M,D()}}function q1(t){var e=0,n=AJ/3,i=H1(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*EJ,n=t[1]*EJ):[e*TJ,n*TJ]},r}function X1(t,e){var n=VJ(t),i=(n+VJ(e))/2;if(NJ(i)<1e-6)return function(t){var e=RJ(t);function n(t,n){return[t*e,VJ(n)/e]}return n.invert=function(t,n){return[t/e,HJ(n*e)]},n}(t);var r=1+n*(2*i-n),o=jJ(r)/i;function a(t,e){var n=jJ(r-2*i*VJ(e))/i;return[n*VJ(t*=i),o-n*RJ(t)]}return a.invert=function(t,e){var n=o-e,a=FJ(t,NJ(n))*WJ(n);return n*i<0&&(a-=AJ*WJ(t)*WJ(n)),[a/i,HJ((r-(t*t+n*n)*i*i)/(2*i))]},a}function Y1(){return q1(X1).scale(155.424).center([0,33.6442])}function K1(){return Y1().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Z1(t){return function(e,n){var i=RJ(e),r=RJ(n),o=t(i*r);return o===1/0?[2,0]:[o*r*VJ(e),o*VJ(n)]}}function J1(t){return function(e,n){var i=jJ(e*e+n*n),r=t(i),o=VJ(r),a=RJ(r);return[FJ(e*o,i*a),HJ(i&&n*o/i)]}}var Q1=Z1((function(t){return jJ(2/(1+t))}));Q1.invert=J1((function(t){return 2*HJ(t/2)}));var t2=Z1((function(t){return(t=GJ(t))&&t/VJ(t)}));function e2(t,e){return[t,zJ(UJ((IJ+e)/2))]}function n2(t){var e,n,i,r=G1(t),o=r.center,a=r.scale,s=r.translate,l=r.clipExtent,u=null;function c(){var o=AJ*a(),s=r(function(t){function e(e){return(e=t(e[0]*EJ,e[1]*EJ))[0]*=TJ,e[1]*=TJ,e}return t=m0(t[0]*EJ,t[1]*EJ,t.length>2?t[2]*EJ:0),e.invert=function(e){return(e=t.invert(e[0]*EJ,e[1]*EJ))[0]*=TJ,e[1]*=TJ,e},e}(r.rotate()).invert([0,0]));return l(null==u?[[s[0]-o,s[1]-o],[s[0]+o,s[1]+o]]:t===e2?[[Math.max(s[0]-o,u),e],[Math.min(s[0]+o,n),i]]:[[u,Math.max(s[1]-o,e)],[n,Math.min(s[1]+o,i)]])}return r.scale=function(t){return arguments.length?(a(t),c()):a()},r.translate=function(t){return arguments.length?(s(t),c()):s()},r.center=function(t){return arguments.length?(o(t),c()):o()},r.clipExtent=function(t){return arguments.length?(null==t?u=e=n=i=null:(u=+t[0][0],e=+t[0][1],n=+t[1][0],i=+t[1][1]),c()):null==u?null:[[u,e],[n,i]]},c()}function i2(t){return UJ((IJ+t)/2)}function r2(t,e){var n=RJ(t),i=t===e?VJ(t):zJ(n/RJ(e))/zJ(i2(e)/i2(t)),r=n*BJ(i2(t),i)/i;if(!i)return e2;function o(t,e){r>0?e<1e-6-IJ&&(e=1e-6-IJ):e>IJ-1e-6&&(e=IJ-1e-6);var n=r/BJ(i2(e),i);return[n*VJ(i*t),r-n*RJ(i*t)]}return o.invert=function(t,e){var n=r-e,o=WJ(i)*jJ(t*t+n*n),a=FJ(t,NJ(n))*WJ(n);return n*i<0&&(a-=AJ*WJ(t)*WJ(n)),[a/i,2*OJ(BJ(r/o,1/i))-IJ]},o}function o2(t,e){return[t,e]}function a2(t,e){var n=RJ(t),i=t===e?VJ(t):(n-RJ(e))/(e-t),r=n/i+t;if(NJ(i)<1e-6)return o2;function o(t,e){var n=r-e,o=i*t;return[n*VJ(o),r-n*RJ(o)]}return o.invert=function(t,e){var n=r-e,o=FJ(t,NJ(n))*WJ(n);return n*i<0&&(o-=AJ*WJ(t)*WJ(n)),[o/i,r-WJ(i)*jJ(t*t+n*n)]},o}t2.invert=J1((function(t){return t})),e2.invert=function(t,e){return[t,2*OJ($J(e))-IJ]},o2.invert=o2;var s2=1.340264,l2=-.081106,u2=893e-6,c2=.003796,h2=jJ(3)/2;function d2(t,e){var n=HJ(h2*VJ(e)),i=n*n,r=i*i*i;return[t*RJ(n)/(h2*(s2+3*l2*i+r*(7*u2+9*c2*i))),n*(s2+l2*i+r*(u2+c2*i))]}function p2(t,e){var n=RJ(e),i=RJ(t)*n;return[n*VJ(t)/i,VJ(e)/i]}function f2(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),e*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function g2(t,e){return[RJ(e)*VJ(t),VJ(e)]}function m2(t,e){var n=RJ(e),i=1+RJ(t)*n;return[n*VJ(t)/i,VJ(e)/i]}function y2(t,e){return[zJ(UJ((IJ+e)/2)),-t]}d2.invert=function(t,e){for(var n,i=e,r=i*i,o=r*r*r,a=0;a<12&&(o=(r=(i-=n=(i*(s2+l2*r+o*(u2+c2*r))-e)/(s2+3*l2*r+o*(7*u2+9*c2*r)))*i)*r*r,!(NJ(n)<1e-12));++a);return[h2*t*(s2+3*l2*r+o*(7*u2+9*c2*r))/RJ(i),HJ(VJ(i)/h2)]},p2.invert=J1(OJ),f2.invert=function(t,e){var n,i=e,r=25;do{var o=i*i,a=o*o;i-=n=(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(NJ(n)>1e-6&&--r>0);return[t/(.8707+(o=i*i)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),i]},g2.invert=J1(HJ),m2.invert=J1((function(t){return 2*OJ(t)})),y2.invert=function(t,e){return[-e,2*OJ($J(t))-IJ]};var v2,x2=Math.abs,b2=Math.cos,w2=Math.sin,_2=Math.PI,k2=_2/2,S2=(v2=2)>0?Math.sqrt(v2):0;function C2(t){return t>1?k2:t<-1?-k2:Math.asin(t)}function A2(t,e){var n,i=t*w2(e),r=30;do{e-=n=(e+w2(e)-i)/(1+b2(e))}while(x2(n)>1e-6&&--r>0);return e/2}var I2=function(t,e,n){function i(i,r){return[t*i*b2(r=A2(n,r)),e*w2(r)]}return i.invert=function(i,r){return r=C2(r/e),[i/(t*b2(r)),C2((2*r+w2(2*r))/n)]},i}(S2/k2,S2,_2);const M2=O1(),D2=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function T2(t,e){return function n(){const i=e();return i.type=t,i.path=O1().projection(i),i.copy=i.copy||function(){const t=n();return D2.forEach((e=>{i[e]&&t[e](i[e]())})),t.path.pointRadius(i.path.pointRadius()),t},i}}function E2(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(O2[t]=T2(t,e),this):O2[t]||null}function N2(t){return t&&t.path||M2}const O2={albers:K1,albersusa:function(){var t,e,n,i,r,o,a=K1(),s=Y1().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=Y1().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,e){o=[t,e]}};function c(t){var e=t[0],a=t[1];return o=null,n.point(e,a),o||(i.point(e,a),o)||(r.point(e,a),o)}function h(){return t=e=null,c}return c.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?s:r>=.166&&r<.234&&i>=-.214&&i<-.115?l:a).invert(t)},c.stream=function(n){return t&&e===n?t:(i=[a.stream(e=n),s.stream(n),l.stream(n)],r=i.length,t={point:function(t,e){for(var n=-1;++n<r;)i[n].point(t,e)},sphere:function(){for(var t=-1;++t<r;)i[t].sphere()},lineStart:function(){for(var t=-1;++t<r;)i[t].lineStart()},lineEnd:function(){for(var t=-1;++t<r;)i[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<r;)i[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<r;)i[t].polygonEnd()}});var i,r},c.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),l.precision(t),h()):a.precision()},c.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),l.scale(t),c.translate(a.translate())):a.scale()},c.translate=function(t){if(!arguments.length)return a.translate();var e=a.scale(),o=+t[0],c=+t[1];return n=a.translate(t).clipExtent([[o-.455*e,c-.238*e],[o+.455*e,c+.238*e]]).stream(u),i=s.translate([o-.307*e,c+.201*e]).clipExtent([[o-.425*e+1e-6,c+.12*e+1e-6],[o-.214*e-1e-6,c+.234*e-1e-6]]).stream(u),r=l.translate([o-.205*e,c+.212*e]).clipExtent([[o-.214*e+1e-6,c+.166*e+1e-6],[o-.115*e-1e-6,c+.234*e-1e-6]]).stream(u),h()},c.fitExtent=function(t,e){return $1(c,t,e)},c.fitSize=function(t,e){return P1(c,t,e)},c.fitWidth=function(t,e){return z1(c,t,e)},c.fitHeight=function(t,e){return B1(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return G1(Q1).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return G1(t2).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return q1(r2).scale(109.5).parallels([30,30])},conicequalarea:Y1,conicequidistant:function(){return q1(a2).scale(131.154).center([0,13.9389])},equalEarth:function(){return G1(d2).scale(177.158)},equirectangular:function(){return G1(o2).scale(152.63)},gnomonic:function(){return G1(p2).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,i,r,o,a,s=1,l=0,u=0,c=1,h=1,d=0,p=null,f=1,g=1,m=F1({point:function(t,e){var n=x([t,e]);this.stream.point(n[0],n[1])}}),y=z0;function v(){return f=s*c,g=s*h,o=a=null,x}function x(n){var i=n[0]*f,r=n[1]*g;if(d){var o=r*t-i*e;i=i*t+r*e,r=o}return[i+l,r+u]}return x.invert=function(n){var i=n[0]-l,r=n[1]-u;if(d){var o=r*t+i*e;i=i*t-r*e,r=o}return[i/f,r/g]},x.stream=function(t){return o&&a===t?o:o=m(y(a=t))},x.postclip=function(t){return arguments.length?(y=t,p=n=i=r=null,v()):y},x.clipExtent=function(t){return arguments.length?(y=null==t?(p=n=i=r=null,z0):N0(p=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),v()):null==p?null:[[p,n],[i,r]]},x.scale=function(t){return arguments.length?(s=+t,v()):s},x.translate=function(t){return arguments.length?(l=+t[0],u=+t[1],v()):[l,u]},x.angle=function(n){return arguments.length?(e=VJ(d=n%360*EJ),t=RJ(d),v()):d*TJ},x.reflectX=function(t){return arguments.length?(c=t?-1:1,v()):c<0},x.reflectY=function(t){return arguments.length?(h=t?-1:1,v()):h<0},x.fitExtent=function(t,e){return $1(x,t,e)},x.fitSize=function(t,e){return P1(x,t,e)},x.fitWidth=function(t,e){return z1(x,t,e)},x.fitHeight=function(t,e){return B1(x,t,e)},x},mercator:function(){return n2(e2).scale(961/DJ)},mollweide:function(){return G1(I2).scale(169.529)},naturalEarth1:function(){return G1(f2).scale(175.295)},orthographic:function(){return G1(g2).scale(249.5).clipAngle(90.000001)},stereographic:function(){return G1(m2).scale(250).clipAngle(142)},transversemercator:function(){var t=n2(y2),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(const t in O2)E2(t,O2[t]);function F2(){}const R2=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function L2(){var t=1,e=1,n=a;function i(t,e){return e.map((e=>r(t,e)))}function r(i,r){var a=[],s=[];return function(n,i,r){var a,s,l,u,c,h,d=new Array,p=new Array;a=s=-1,u=n[0]>=i,R2[u<<1].forEach(f);for(;++a<t-1;)l=u,u=n[a+1]>=i,R2[l|u<<1].forEach(f);R2[u<<0].forEach(f);for(;++s<e-1;){for(a=-1,u=n[s*t+t]>=i,c=n[s*t]>=i,R2[u<<1|c<<2].forEach(f);++a<t-1;)l=u,u=n[s*t+t+a+1]>=i,h=c,c=n[s*t+a+1]>=i,R2[l|u<<1|c<<2|h<<3].forEach(f);R2[u|c<<3].forEach(f)}a=-1,c=n[s*t]>=i,R2[c<<2].forEach(f);for(;++a<t-1;)h=c,c=n[s*t+a+1]>=i,R2[c<<2|h<<3].forEach(f);function f(t){var e,n,i=[t[0][0]+a,t[0][1]+s],l=[t[1][0]+a,t[1][1]+s],u=o(i),c=o(l);(e=p[u])?(n=d[c])?(delete p[e.end],delete d[n.start],e===n?(e.ring.push(l),r(e.ring)):d[e.start]=p[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete p[e.end],e.ring.push(l),p[e.end=c]=e):(e=d[c])?(n=p[u])?(delete d[e.start],delete p[n.end],e===n?(e.ring.push(l),r(e.ring)):d[n.start]=p[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(i),d[e.start=u]=e):d[u]=p[c]={start:u,end:c,ring:[i,l]}}R2[c<<3].forEach(f)}(i,r,(t=>{n(t,i,r),function(t){var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];for(;++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}(t)>0?a.push([t]):s.push(t)})),s.forEach((t=>{for(var e,n=0,i=a.length;n<i;++n)if(-1!==$2((e=a[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:r,coordinates:a}}function o(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,i,r){n.forEach((n=>{var o,a=n[0],s=n[1],l=0|a,u=0|s,c=i[u*t+l];a>0&&a<t&&l===a&&(o=i[u*t+l-1],n[0]=a+(r-o)/(c-o)-.5),s>0&&s<e&&u===s&&(o=i[(u-1)*t+l],n[1]=s+(r-o)/(c-o)-.5)}))}return i.contour=r,i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),o=Math.floor(n[1]);return r>=0&&o>=0||ON("invalid size"),t=r,e=o,i},i.smooth=function(t){return arguments.length?(n=t?a:F2,i):n===a},i}function $2(t,e){for(var n,i=-1,r=e.length;++i<r;)if(n=P2(t,e[i]))return n;return 0}function P2(t,e){for(var n=e[0],i=e[1],r=-1,o=0,a=t.length,s=a-1;o<a;s=o++){var l=t[o],u=l[0],c=l[1],h=t[s],d=h[0],p=h[1];if(z2(l,h,e))return 0;c>i!=p>i&&n<(d-u)*(i-c)/(p-c)+u&&(r=-r)}return r}function z2(t,e,n){var i,r,o,a;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(r=t[i=+(t[0]===e[0])],o=n[i],a=e[i],r<=o&&o<=a||a<=o&&o<=r)}function B2(t,e,n){return function(i){var r=AO(i),o=n?Math.min(r[0],0):r[0],a=r[1],s=a-o,l=e?JF(o,a,t):s/(t+1);return sR(o+l,a,l)}}function V2(t){Iz.call(this,null,t)}function W2(t,e,n,i,r){const o=t.x1||0,a=t.y1||0,s=e*n<0;function l(t){t.forEach(u)}function u(t){s&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-o)*e+i,t[1]=(t[1]-a)*n+r}return function(t){return t.coordinates.forEach(l),t}}function j2(t,e,n){const i=t>=0?t:Fz(e,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function U2(t){return yO(t)?t:kO(+t)}function G2(){var t=t=>t[0],e=t=>t[1],n=zN,i=[-1,-1],r=960,o=500,a=2;function s(s,l){const u=j2(i[0],s,t)>>a,c=j2(i[1],s,e)>>a,h=u?u+2:0,d=c?c+2:0,p=2*h+(r>>a),f=2*d+(o>>a),g=new Float32Array(p*f),m=new Float32Array(p*f);let y=g;s.forEach((i=>{const r=h+(+t(i)>>a),o=d+(+e(i)>>a);r>=0&&r<p&&o>=0&&o<f&&(g[r+o*p]+=+n(i))})),u>0&&c>0?(H2(p,f,g,m,u),q2(p,f,m,g,c),H2(p,f,g,m,u),q2(p,f,m,g,c),H2(p,f,g,m,u),q2(p,f,m,g,c)):u>0?(H2(p,f,g,m,u),H2(p,f,m,g,u),H2(p,f,g,m,u),y=m):c>0&&(q2(p,f,g,m,c),q2(p,f,m,g,c),q2(p,f,g,m,c),y=m);const v=l?Math.pow(2,-2*a):1/lR(y);for(let t=0,e=p*f;t<e;++t)y[t]*=v;return{values:y,scale:1<<a,width:p,height:f,x1:h,y1:d,x2:h+(r>>a),y2:d+(o>>a)}}return s.x=function(e){return arguments.length?(t=U2(e),s):t},s.y=function(t){return arguments.length?(e=U2(t),s):e},s.weight=function(t){return arguments.length?(n=U2(t),s):n},s.size=function(t){if(!arguments.length)return[r,o];var e=+t[0],n=+t[1];return e>=0&&n>=0||ON("invalid size"),r=e,o=n,s},s.cellSize=function(t){return arguments.length?((t=+t)>=1||ON("invalid cell size"),a=Math.floor(Math.log(t)/Math.LN2),s):1<<a},s.bandwidth=function(t){return arguments.length?(1===(t=gO(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&ON("invalid bandwidth"),i=t,s):i},s}function H2(t,e,n,i,r){const o=1+(r<<1);for(let a=0;a<e;++a)for(let e=0,s=0;e<t+r;++e)e<t&&(s+=n[e+a*t]),e>=r&&(e>=o&&(s-=n[e-o+a*t]),i[e-r+a*t]=s/Math.min(e+1,t-1+o-e,o))}function q2(t,e,n,i,r){const o=1+(r<<1);for(let a=0;a<t;++a)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[a+s*t]),s>=r&&(s>=o&&(l-=n[a+(s-o)*t]),i[a+(s-r)*t]=l/Math.min(s+1,e-1+o-s,o))}function X2(t){Iz.call(this,null,t)}V2.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},OO(V2,Iz,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=t.field||$N,o=L2().smooth(!1!==t.smooth),a=t.thresholds||function(t,e,n){const i=B2(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(t.map((t=>QF(e(t).values))))}(i,r,t),s=null===t.as?null:t.as||"contour",l=[];return i.forEach((e=>{const n=r(e),i=o.size([n.width,n.height])(n.values,UN(a)?a:a(n.values));!function(t,e,n,i){let r=i.scale||e.scale,o=i.translate||e.translate;yO(r)&&(r=r(n,i));yO(o)&&(o=o(n,i));if((1===r||null==r)&&!o)return;const a=(PO(r)?r:r[0])||1,s=(PO(r)?r:r[1])||1,l=o&&o[0]||0,u=o&&o[1]||0;t.forEach(W2(e,a,s,l,u))}(i,n,e,t),i.forEach((t=>{l.push(QP(e,ZP(null!=s?{[s]:t}:t)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),X2.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Y2=["x","y","weight","size","cellSize","bandwidth"];function K2(t,e){return Y2.forEach((n=>null!=e[n]?t[n](e[n]):0)),t}function Z2(t){Iz.call(this,null,t)}OO(X2,Iz,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=function(t,e){var n,i,r,o,a,s,l=[],u=t=>t(o);if(null==e)l.push(t);else for(n={},i=0,r=t.length;i<r;++i)o=t[i],(s=n[a=e.map(u)])||(n[a]=s=[],s.dims=a,l.push(s)),s.push(o);return l}(e.materialize(e.SOURCE).source,t.groupby),o=(t.groupby||[]).map(MN),a=K2(G2(),t),s=t.as||"grid";return n=r.map((e=>ZP(function(t,e){for(let n=0;n<o.length;++n)t[o[n]]=e[n];return t}({[s]:a(e,t.counts)},e.dims)))),this.value&&(i.rem=this.value),this.value=i.source=i.add=n,i}}),Z2.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},OO(Z2,Iz,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,i,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),o=L2().smooth(!1!==t.smooth),a=t.values,s=t.thresholds||B2(t.count||10,t.nice,!!a),l=t.size;return a||(a=e.materialize(e.SOURCE).source,i=W2(n=K2(G2(),t)(a,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],a=n.values),s=UN(s)?s:s(a),a=o.size(l)(a,s),i&&a.forEach(i),this.value&&(r.rem=this.value),this.value=r.source=r.add=(a||[]).map(ZP),r}});function J2(t){Iz.call(this,null,t)}function Q2(t){Iz.call(this,null,t)}function t3(t){Iz.call(this,null,t)}function e3(t){Iz.call(this,null,t)}function n3(t){Iz.call(this,[],t),this.generator=function(){var t,e,n,i,r,o,a,s,l,u,c,h,d=10,p=d,f=90,g=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return sR(LJ(i/f)*f,n,f).map(c).concat(sR(LJ(s/g)*g,a,g).map(h)).concat(sR(LJ(e/d)*d,t,d).filter((function(t){return NJ(t%f)>1e-6})).map(l)).concat(sR(LJ(o/p)*p,r,p).filter((function(t){return NJ(t%g)>1e-6})).map(u))}return y.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(i).concat(h(a).slice(1),c(n).reverse().slice(1),h(s).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],i>n&&(t=i,i=n,n=t),s>a&&(t=s,s=a,a=t),y.precision(m)):[[i,s],[n,a]]},y.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],o=+n[0][1],r=+n[1][1],e>t&&(n=e,e=t,t=n),o>r&&(n=o,o=r,r=n),y.precision(m)):[[e,o],[t,r]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(f=+t[0],g=+t[1],y):[f,g]},y.stepMinor=function(t){return arguments.length?(d=+t[0],p=+t[1],y):[d,p]},y.precision=function(d){return arguments.length?(m=+d,l=O0(o,r,90),u=F0(e,t,m),c=O0(s,a,90),h=F0(i,n,m),y):m},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function i3(t){Iz.call(this,null,t)}function r3(t){if(!yO(t))return!1;const e=QO(DN(t));return e.$x||e.$y||e.$value||e.$max}function o3(t){Iz.call(this,null,t),this.modified(!0)}function a3(t,e,n){yO(t[e])&&t[e](n)}J2.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},OO(J2,Iz,{transform(t,e){var n,i=this._features,r=this._points,o=t.fields,a=o&&o[0],s=o&&o[1],l=t.geojson||!o&&$N,u=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(DN(l))||a&&e.modified(DN(a))||s&&e.modified(DN(s)),this.value&&!n||(u=e.SOURCE,this._features=i=[],this._points=r=[]),l&&e.visit(u,(t=>i.push(l(t)))),a&&s&&(e.visit(u,(t=>{var e=a(t),n=s(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&r.push([e,n])})),i=i.concat({type:"Feature",geometry:{type:"MultiPoint",coordinates:r}})),this.value={type:"FeatureCollection",features:i}}}),Q2.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},OO(Q2,Iz,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.field||$N,o=t.as||"path",a=n.SOURCE;!i||t.modified()?(this.value=i=N2(t.projection),n.materialize().reflow()):a=r===$N||e.modified(r.fields)?n.ADD_MOD:n.ADD;const s=function(t,e){const n=t.pointRadius();t.context(null),null!=e&&t.pointRadius(e);return n}(i,t.pointRadius);return n.visit(a,(t=>t[o]=i(r(t)))),i.pointRadius(s),n.modifies(o)}}),t3.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},OO(t3,Iz,{transform(t,e){var n,i=t.projection,r=t.fields[0],o=t.fields[1],a=t.as||["x","y"],s=a[0],l=a[1];function u(t){const e=i([r(t),o(t)]);e?(t[s]=e[0],t[l]=e[1]):(t[s]=void 0,t[l]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,u):(n=e.modified(r.fields)||e.modified(o.fields),e.visit(n?e.ADD_MOD:e.ADD,u)),e.modifies(a)}}),e3.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},OO(e3,Iz,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.as||"shape",o=n.ADD;return i&&!t.modified()||(this.value=i=function(t,e,n){const i=null==n?n=>t(e(n)):i=>{var r=t.pointRadius(),o=t.pointRadius(n)(e(i));return t.pointRadius(r),o};return i.context=e=>(t.context(e),i),i}(N2(t.projection),t.field||RN("datum"),t.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,(t=>t[r]=i)),n.modifies(r)}}),n3.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},OO(n3,Iz,{transform(t,e){var n,i=this.value,r=this.generator;if(!i.length||t.modified())for(const e in t)yO(r[e])&&r[e](t[e]);return n=r(),i.length?e.mod.push(tz(i[0],n)):e.add.push(ZP(n)),i[0]=n,e}}),i3.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},OO(i3,Iz,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,i="shared"===t.resolve,r=t.field||$N,o=function(t,e){let n;yO(t)?(n=n=>t(n,e),n.dep=r3(t)):t?n=kO(t):(n=t=>t.$value/t.$max||0,n.dep=!0);return n}(t.opacity,t),a=function(t,e){let n;yO(t)?(n=n=>Ej(t(n,e)),n.dep=r3(t)):n=kO(Ej(t||"#888"));return n}(t.color,t),s=t.as||"image",l={$x:0,$y:0,$value:0,$max:i?QF(n.map((t=>QF(r(t).values)))):0};return n.forEach((t=>{const e=r(t),n=CO({},t,l);i||(n.$max=QF(e.values||[])),t[s]=function(t,e,n,i){const r=t.width,o=t.height,a=t.x1||0,s=t.y1||0,l=t.x2||r,u=t.y2||o,c=t.values,h=c?t=>c[t]:PN,d=oj(l-a,u-s),p=d.getContext("2d"),f=p.getImageData(0,0,l-a,u-s),g=f.data;for(let t=s,o=0;t<u;++t){e.$y=t-s;for(let s=a,u=t*r;s<l;++s,o+=4){e.$x=s-a,e.$value=h(s+u);const t=n(e);g[o+0]=t.r,g[o+1]=t.g,g[o+2]=t.b,g[o+3]=~~(255*i(e))}}return p.putImageData(f,0,0),d}(e,n,a.dep?a:kO(a(n)),o.dep?o:kO(o(n)))})),e.reflow(!0).modifies(s)}}),OO(o3,Iz,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=function(t){const e=E2((t||"mercator").toLowerCase());e||ON("Unrecognized projection type: "+t);return e()}(t.type),D2.forEach((e=>{null!=t[e]&&a3(n,e,t[e])}))):D2.forEach((e=>{t.modified(e)&&a3(n,e,t[e])})),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){const n=function(t){return 1===(t=gO(t)).length?t[0]:{type:"FeatureCollection",features:t.reduce(((t,e)=>t.concat(function(t){return"FeatureCollection"===t.type?t.features:gO(t).filter((t=>null!=t)).map((t=>"Feature"===t.type?t:{type:"Feature",geometry:t}))}(e))),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});var s3=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",contour:Z2,geojson:J2,geopath:Q2,geopoint:t3,geoshape:e3,graticule:n3,heatmap:i3,isocontour:V2,kde2d:X2,projection:o3});function l3(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,o,a,s,l,u,c,h,d,p=t._root,f={data:i},g=t._x0,m=t._y0,y=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a,r=p,!(p=p[h=c<<1|u]))return r[h]=f,t;if(s=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===s&&n===l)return f.next=p,r?r[h]=f:t._root=f,t;do{r=r?r[h]=new Array(4):t._root=new Array(4),(u=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a}while((h=c<<1|u)==(d=(l>=a)<<1|s>=o));return r[d]=p,r[h]=f,t}function u3(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function c3(t){return t[0]}function h3(t){return t[1]}function d3(t,e,n){var i=new p3(null==e?c3:e,null==n?h3:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function p3(t,e,n,i,r,o){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function f3(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var g3=d3.prototype=p3.prototype;function m3(t){return function(){return t}}function y3(t){return 1e-6*(t()-.5)}function v3(t){return t.x+t.vx}function x3(t){return t.y+t.vy}function b3(t){return t.index}function w3(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}g3.copy=function(){var t,e,n=new p3(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=f3(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=f3(e));return n},g3.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return l3(this.cover(e,n),e,n,t)},g3.addAll=function(t){var e,n,i,r,o=t.length,a=new Array(o),s=new Array(o),l=1/0,u=1/0,c=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(a[n]=i,s[n]=r,i<l&&(l=i),i>c&&(c=i),r<u&&(u=r),r>h&&(h=r));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),n=0;n<o;++n)l3(this,a[n],s[n],t[n]);return this},g3.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var a,s,l=r-n||1,u=this._root;n>t||t>=r||i>e||e>=o;)switch(s=(e<i)<<1|t<n,(a=new Array(4))[s]=u,u=a,l*=2,s){case 0:r=n+l,o=i+l;break;case 1:n=r-l,o=i+l;break;case 2:r=n+l,i=o-l;break;case 3:n=r-l,i=o-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this},g3.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},g3.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},g3.find=function(t,e,n){var i,r,o,a,s,l,u,c=this._x0,h=this._y0,d=this._x1,p=this._y1,f=[],g=this._root;for(g&&f.push(new u3(g,c,h,d,p)),null==n?n=1/0:(c=t-n,h=e-n,d=t+n,p=e+n,n*=n);l=f.pop();)if(!(!(g=l.node)||(r=l.x0)>d||(o=l.y0)>p||(a=l.x1)<c||(s=l.y1)<h))if(g.length){var m=(r+a)/2,y=(o+s)/2;f.push(new u3(g[3],m,y,a,s),new u3(g[2],r,y,m,s),new u3(g[1],m,o,a,y),new u3(g[0],r,o,m,y)),(u=(e>=y)<<1|t>=m)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-u],f[f.length-1-u]=l)}else{var v=t-+this._x.call(null,g.data),x=e-+this._y.call(null,g.data),b=v*v+x*x;if(b<n){var w=Math.sqrt(n=b);c=t-w,h=e-w,d=t+w,p=e+w,i=g.data}}return i},g3.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,i,r,o,a,s,l,u,c,h,d,p=this._root,f=this._x0,g=this._y0,m=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((u=o>=(s=(f+m)/2))?f=s:m=s,(c=a>=(l=(g+y)/2))?g=l:y=l,e=p,!(p=p[h=c<<1|u]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;p.data!==t;)if(i=p,!(p=p.next))return this;return(r=p.next)&&delete p.next,i?(r?i.next=r:delete i.next,this):e?(r?e[h]=r:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=r,this)},g3.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},g3.root=function(){return this._root},g3.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},g3.visit=function(t){var e,n,i,r,o,a,s=[],l=this._root;for(l&&s.push(new u3(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,i=e.x0,r=e.y0,o=e.x1,a=e.y1)&&l.length){var u=(i+o)/2,c=(r+a)/2;(n=l[3])&&s.push(new u3(n,u,c,o,a)),(n=l[2])&&s.push(new u3(n,i,c,u,a)),(n=l[1])&&s.push(new u3(n,u,r,o,c)),(n=l[0])&&s.push(new u3(n,i,r,u,c))}return this},g3.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new u3(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var o,a=e.x0,s=e.y0,l=e.x1,u=e.y1,c=(a+l)/2,h=(s+u)/2;(o=r[0])&&n.push(new u3(o,a,s,c,h)),(o=r[1])&&n.push(new u3(o,c,s,l,h)),(o=r[2])&&n.push(new u3(o,a,h,c,u)),(o=r[3])&&n.push(new u3(o,c,h,l,u))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},g3.x=function(t){return arguments.length?(this._x=t,this):this._x},g3.y=function(t){return arguments.length?(this._y=t,this):this._y};var _3={value:()=>{}};function k3(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new S3(i)}function S3(t){this._=t}function C3(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function A3(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function I3(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=_3,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}S3.prototype=k3.prototype={constructor:S3,on:function(t,e){var n,i=this._,r=C3(t+"",i),o=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=r[o]).type)i[n]=I3(i[n],t.name,e);else if(null==e)for(n in i)i[n]=I3(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=r[o]).type)&&(n=A3(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new S3(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(i=this._[t]).length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};var M3,D3,T3=0,E3=0,N3=0,O3=0,F3=0,R3=0,L3="object"==typeof performance&&performance.now?performance:Date,$3="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function P3(){return F3||($3(z3),F3=L3.now()+R3)}function z3(){F3=0}function B3(){this._call=this._time=this._next=null}function V3(t,e,n){var i=new B3;return i.restart(t,e,n),i}function W3(){F3=(O3=L3.now())+R3,T3=E3=0;try{!function(){P3(),++T3;for(var t,e=M3;e;)(t=F3-e._time)>=0&&e._call.call(null,t),e=e._next;--T3}()}finally{T3=0,function(){var t,e,n=M3,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:M3=e);D3=t,U3(i)}(),F3=0}}function j3(){var t=L3.now(),e=t-O3;e>1e3&&(R3-=e,O3=t)}function U3(t){T3||(E3&&(E3=clearTimeout(E3)),t-F3>24?(t<1/0&&(E3=setTimeout(W3,t-L3.now()-R3)),N3&&(N3=clearInterval(N3))):(N3||(O3=L3.now(),N3=setInterval(j3,1e3)),T3=1,$3(W3)))}B3.prototype=V3.prototype={constructor:B3,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?P3():+n)+(null==e?0:+e),this._next||D3===this||(D3?D3._next=this:M3=this,D3=this),this._call=t,this._time=n,U3()},stop:function(){this._call&&(this._call=null,this._time=1/0,U3())}};function G3(t){return t.x}function H3(t){return t.y}var q3=Math.PI*(3-Math.sqrt(5));const X3={center:function(t,e){var n,i=1;function r(){var r,o,a=n.length,s=0,l=0;for(r=0;r<a;++r)s+=(o=n[r]).x,l+=o.y;for(s=(s/a-t)*i,l=(l/a-e)*i,r=0;r<a;++r)(o=n[r]).x-=s,o.y-=l}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r},collide:function(t){var e,n,i,r=1,o=1;function a(){for(var t,a,l,u,c,h,d,p=e.length,f=0;f<o;++f)for(a=d3(e,v3,x3).visitAfter(s),t=0;t<p;++t)l=e[t],h=n[l.index],d=h*h,u=l.x+l.vx,c=l.y+l.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,p=t.r,f=h+p;if(!s)return e>u+f||o<u-f||n>c+f||a<c-f;if(s.index>l.index){var g=u-s.x-s.vx,m=c-s.y-s.vy,y=g*g+m*m;y<f*f&&(0===g&&(y+=(g=y3(i))*g),0===m&&(y+=(m=y3(i))*m),y=(f-(y=Math.sqrt(y)))/y*r,l.vx+=(g*=y)*(f=(p*=p)/(d+p)),l.vy+=(m*=y)*f,s.vx-=g*(f=1-f),s.vy-=m*f)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var i,r,o=e.length;for(n=new Array(o),i=0;i<o;++i)r=e[i],n[r.index]=+t(r,i,e)}}return"function"!=typeof t&&(t=m3(null==t?1:+t)),a.initialize=function(t,n){e=t,i=n,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(r=+t,a):r},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:m3(+e),l(),a):t},a},nbody:function(){var t,e,n,i,r,o=m3(-30),a=1,s=1/0,l=.81;function u(n){var r,o=t.length,a=d3(t,G3,H3).visitAfter(h);for(i=n,r=0;r<o;++r)e=t[r],a.visit(d)}function c(){if(t){var e,n,i=t.length;for(r=new Array(i),e=0;e<i;++e)n=t[e],r[n.index]=+o(n,e,t)}}function h(t){var e,n,i,o,a,s=0,l=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,i+=n*e.x,o+=n*e.y);t.x=i/l,t.y=o/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function d(t,o,u,c){if(!t.value)return!0;var h=t.x-e.x,d=t.y-e.y,p=c-o,f=h*h+d*d;if(p*p/l<f)return f<s&&(0===h&&(f+=(h=y3(n))*h),0===d&&(f+=(d=y3(n))*d),f<a&&(f=Math.sqrt(a*f)),e.vx+=h*t.value*i/f,e.vy+=d*t.value*i/f),!0;if(!(t.length||f>=s)){(t.data!==e||t.next)&&(0===h&&(f+=(h=y3(n))*h),0===d&&(f+=(d=y3(n))*d),f<a&&(f=Math.sqrt(a*f)));do{t.data!==e&&(p=r[t.data.index]*i/f,e.vx+=h*p,e.vy+=d*p)}while(t=t.next)}}return u.initialize=function(e,i){t=e,n=i,c()},u.strength=function(t){return arguments.length?(o="function"==typeof t?t:m3(+t),c(),u):o},u.distanceMin=function(t){return arguments.length?(a=t*t,u):Math.sqrt(a)},u.distanceMax=function(t){return arguments.length?(s=t*t,u):Math.sqrt(s)},u.theta=function(t){return arguments.length?(l=t*t,u):Math.sqrt(l)},u},link:function(t){var e,n,i,r,o,a,s=b3,l=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},u=m3(30),c=1;function h(i){for(var r=0,s=t.length;r<c;++r)for(var l,u,h,d,p,f,g,m=0;m<s;++m)u=(l=t[m]).source,d=(h=l.target).x+h.vx-u.x-u.vx||y3(a),p=h.y+h.vy-u.y-u.vy||y3(a),d*=f=((f=Math.sqrt(d*d+p*p))-n[m])/f*i*e[m],p*=f,h.vx-=d*(g=o[m]),h.vy-=p*g,u.vx+=d*(g=1-g),u.vy+=p*g}function d(){if(i){var a,l,u=i.length,c=t.length,h=new Map(i.map(((t,e)=>[s(t,e,i),t])));for(a=0,r=new Array(u);a<c;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=w3(h,l.source)),"object"!=typeof l.target&&(l.target=w3(h,l.target)),r[l.source.index]=(r[l.source.index]||0)+1,r[l.target.index]=(r[l.target.index]||0)+1;for(a=0,o=new Array(c);a<c;++a)l=t[a],o[a]=r[l.source.index]/(r[l.source.index]+r[l.target.index]);e=new Array(c),p(),n=new Array(c),f()}}function p(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+l(t[n],n,t)}function f(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+u(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){i=t,a=e,d()},h.links=function(e){return arguments.length?(t=e,d(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(l="function"==typeof t?t:m3(+t),p(),h):l},h.distance=function(t){return arguments.length?(u="function"==typeof t?t:m3(+t),f(),h):u},h},x:function(t){var e,n,i,r=m3(.1);function o(t){for(var r,o=0,a=e.length;o<a;++o)(r=e[o]).vx+=(i[o]-r.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),i=new Array(a),o=0;o<a;++o)n[o]=isNaN(i[o]=+t(e[o],o,e))?0:+r(e[o],o,e)}}return"function"!=typeof t&&(t=m3(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(r="function"==typeof t?t:m3(+t),a(),o):r},o.x=function(e){return arguments.length?(t="function"==typeof e?e:m3(+e),a(),o):t},o},y:function(t){var e,n,i,r=m3(.1);function o(t){for(var r,o=0,a=e.length;o<a;++o)(r=e[o]).vy+=(i[o]-r.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),i=new Array(a),o=0;o<a;++o)n[o]=isNaN(i[o]=+t(e[o],o,e))?0:+r(e[o],o,e)}}return"function"!=typeof t&&(t=m3(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(r="function"==typeof t?t:m3(+t),a(),o):r},o.y=function(e){return arguments.length?(t="function"==typeof e?e:m3(+e),a(),o):t},o}},Y3=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],K3=["static","iterations"],Z3=["x","y","vx","vy"];function J3(t){Iz.call(this,null,t)}function Q3(t,e,n,i){var r,o,a,s,l=gO(e.forces);for(r=0,o=Y3.length;r<o;++r)"forces"!==(a=Y3[r])&&e.modified(a)&&t[a](e[a]);for(r=0,o=l.length;r<o;++r)s="forces"+r,(a=n||e.modified("forces",r)?e5(l[r]):i&&t5(l[r],i)?t.force(s):null)&&t.force(s,a);for(o=t.numForces||0;r<o;++r)t.force("forces"+r,null);return t.numForces=l.length,t}function t5(t,e){var n,i;for(n in t)if(yO(i=t[n])&&e.modified(DN(i)))return 1;return 0}function e5(t){var e,n;for(n in DO(X3,t.force)||ON("Unrecognized force: "+t.force),e=X3[t.force](),t)yO(e[n])&&n5(e[n],t[n],t);return e}function n5(t,e,n){t(yO(e)?t=>e(t,n):e)}J3.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Z3}]},OO(J3,Iz,{transform(t,e){var n,i,r=this.value,o=e.changed(e.ADD_REM),a=t.modified(Y3),s=t.iterations||300;if(r?(o&&(e.modifies("index"),r.nodes(e.source)),(a||e.changed(e.MOD))&&Q3(r,t,0,e)):(this.value=r=function(t,e){const n=function(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,a=.6,s=new Map,l=V3(h),u=k3("tick","end"),c=function(){let t=1;return()=>(t=(1664525*t+1013904223)%4294967296)/4294967296}();function h(){d(),u.call("tick",e),n<i&&(l.stop(),u.call("end",e))}function d(i){var l,u,c=t.length;void 0===i&&(i=1);for(var h=0;h<i;++h)for(n+=(o-n)*r,s.forEach((function(t){t(n)})),l=0;l<c;++l)null==(u=t[l]).fx?u.x+=u.vx*=a:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=a:(u.y=u.fy,u.vy=0);return e}function p(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),o=n*q3;e.x=r*Math.cos(o),e.y=r*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),p(),e={tick:d,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,p(),s.forEach(f),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(c=t,s.forEach(f),e):c},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,f(n)),e):s.get(t)},find:function(e,n,i){var r,o,a,s,l,u=0,c=t.length;for(null==i?i=1/0:i*=i,u=0;u<c;++u)(a=(r=e-(s=t[u]).x)*r+(o=n-s.y)*o)<i&&(l=s,i=a);return l},on:function(t,n){return arguments.length>1?(u.on(t,n),e):u.on(t)}}}(t),i=n.stop,r=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,r()),n.stop=()=>(o=!0,i()),Q3(n,e,!0).on("end",(()=>o=!0))}(e.source,t),r.on("tick",(n=e.dataflow,i=this,()=>n.touch(i).run())),t.static||(o=!0,r.tick()),e.modifies("index")),a||o||t.modified(K3)||e.changed()&&t.restart)if(r.alpha(Math.max(r.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/s)),t.static)for(r.stop();--s>=0;)r.tick();else if(r.stopped()&&r.restart(),!o)return e.StopPropagation;return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let t,e=this._argops,s=0,l=e.length;s<l;++s)if(t=e[s],"forces"===t.name&&"link"===t.op._argval.force)for(var i,r=t.op._argops,o=0,a=r.length;o<a;++o)if("links"===r[o].name&&(i=r[o].op.source)){n.pulse(i,n.changeset().reflow());break}return e.reflow(t.modified()).modifies(Z3)}});var i5=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",force:J3});function r5(t,e){return t.parent===e.parent?1:2}function o5(t,e){return t+e.x}function a5(t,e){return Math.max(t,e.y)}function s5(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function l5(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=c5)):void 0===e&&(e=u5);for(var n,i,r,o,a,s=new p5(t),l=[s];n=l.pop();)if((r=e(n.data))&&(a=(r=Array.from(r)).length))for(n.children=r,o=a-1;o>=0;--o)l.push(i=r[o]=new p5(r[o])),i.parent=n,i.depth=n.depth+1;return s.eachBefore(d5)}function u5(t){return t.children}function c5(t){return Array.isArray(t)?t[1]:null}function h5(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function d5(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function p5(t){this.data=t,this.depth=this.height=0,this.parent=null}function f5(t){for(var e,n,i=0,r=(t=function(t){for(var e,n,i=t.length;i;)n=Math.random()*i--|0,e=t[i],t[i]=t[n],t[n]=e;return t}(Array.from(t))).length,o=[];i<r;)e=t[i],n&&y5(n,e)?++i:(n=x5(o=g5(o,e)),i=0);return n}function g5(t,e){var n,i;if(v5(e,t))return[e];for(n=0;n<t.length;++n)if(m5(e,t[n])&&v5(b5(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(i=n+1;i<t.length;++i)if(m5(b5(t[n],t[i]),e)&&m5(b5(t[n],e),t[i])&&m5(b5(t[i],e),t[n])&&v5(w5(t[n],t[i],e),t))return[t[n],t[i],e];throw new Error}function m5(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function y5(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function v5(t,e){for(var n=0;n<e.length;++n)if(!y5(t,e[n]))return!1;return!0}function x5(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return b5(t[0],t[1]);case 3:return w5(t[0],t[1],t[2])}var e}function b5(t,e){var n=t.x,i=t.y,r=t.r,o=e.x,a=e.y,s=e.r,l=o-n,u=a-i,c=s-r,h=Math.sqrt(l*l+u*u);return{x:(n+o+l/h*c)/2,y:(i+a+u/h*c)/2,r:(h+r+s)/2}}function w5(t,e,n){var i=t.x,r=t.y,o=t.r,a=e.x,s=e.y,l=e.r,u=n.x,c=n.y,h=n.r,d=i-a,p=i-u,f=r-s,g=r-c,m=l-o,y=h-o,v=i*i+r*r-o*o,x=v-a*a-s*s+l*l,b=v-u*u-c*c+h*h,w=p*f-d*g,_=(f*b-g*x)/(2*w)-i,k=(g*m-f*y)/w,S=(p*x-d*b)/(2*w)-r,C=(d*y-p*m)/w,A=k*k+C*C-1,I=2*(o+_*k+S*C),M=_*_+S*S-o*o,D=-(A?(I+Math.sqrt(I*I-4*A*M))/(2*A):M/I);return{x:i+_+k*D,y:r+S+C*D,r:D}}function _5(t,e,n){var i,r,o,a,s=t.x-e.x,l=t.y-e.y,u=s*s+l*l;u?(r=e.r+n.r,r*=r,a=t.r+n.r,r>(a*=a)?(i=(u+a-r)/(2*u),o=Math.sqrt(Math.max(0,a/u-i*i)),n.x=t.x-i*s-o*l,n.y=t.y-i*l+o*s):(i=(u+r-a)/(2*u),o=Math.sqrt(Math.max(0,r/u-i*i)),n.x=e.x+i*s-o*l,n.y=e.y+i*l+o*s)):(n.x=e.x+n.r,n.y=e.y)}function k5(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function S5(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,o=(e.y*n.r+n.y*e.r)/i;return r*r+o*o}function C5(t){this._=t,this.next=null,this.previous=null}function A5(t){if(!(r=(t=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(t)).length))return 0;var e,n,i,r,o,a,s,l,u,c,h;if((e=t[0]).x=0,e.y=0,!(r>1))return e.r;if(n=t[1],e.x=-n.r,n.x=e.r,n.y=0,!(r>2))return e.r+n.r;_5(n,e,i=t[2]),e=new C5(e),n=new C5(n),i=new C5(i),e.next=i.previous=n,n.next=e.previous=i,i.next=n.previous=e;t:for(s=3;s<r;++s){_5(e._,n._,i=t[s]),i=new C5(i),l=n.next,u=e.previous,c=n._.r,h=e._.r;do{if(c<=h){if(k5(l._,i._)){n=l,e.next=n,n.previous=e,--s;continue t}c+=l._.r,l=l.next}else{if(k5(u._,i._)){(e=u).next=n,n.previous=e,--s;continue t}h+=u._.r,u=u.previous}}while(l!==u.next);for(i.previous=e,i.next=n,e.next=n.previous=n=i,o=S5(e);(i=i.next)!==n;)(a=S5(i))<o&&(e=i,o=a);n=e.next}for(e=[n._],i=n;(i=i.next)!==n;)e.push(i._);for(i=f5(e),s=0;s<r;++s)(e=t[s]).x-=i.x,e.y-=i.y;return i.r}function I5(t){return null==t?null:M5(t)}function M5(t){if("function"!=typeof t)throw new Error;return t}function D5(){return 0}function T5(t){return function(){return t}}function E5(t){return Math.sqrt(t.value)}function N5(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function O5(t,e){return function(n){if(i=n.children){var i,r,o,a=i.length,s=t(n)*e||0;if(s)for(r=0;r<a;++r)i[r].r+=s;if(o=A5(i),s)for(r=0;r<a;++r)i[r].r-=s;n.r=o+s}}}function F5(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function R5(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function L5(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,u=t.value&&(i-e)/t.value;++s<l;)(o=a[s]).y0=n,o.y1=r,o.x0=e,o.x1=e+=o.value*u}p5.prototype=l5.prototype={constructor:p5,count:function(){return this.eachAfter(s5)},each:function(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,o=this,a=[o],s=[],l=-1;o=a.pop();)if(s.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)a.push(n[i]);for(;o=s.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,o=[r],a=-1;r=o.pop();)if(t.call(e,r,++a,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;t=n.pop(),e=i.pop();for(;t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return l5(this).eachBefore(h5)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,o=[r];do{for(t=o.reverse(),o=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)o.push(e[n])}while(o.length)}};var $5={depth:-1},P5={};function z5(t){return t.id}function B5(t){return t.parentId}function V5(){var t=z5,e=B5;function n(n){var i,r,o,a,s,l,u,c=Array.from(n),h=c.length,d=new Map;for(r=0;r<h;++r)i=c[r],s=c[r]=new p5(i),null!=(l=t(i,r,n))&&(l+="")&&(u=s.id=l,d.set(u,d.has(u)?P5:s)),null!=(l=e(i,r,n))&&(l+="")&&(s.parent=l);for(r=0;r<h;++r)if(l=(s=c[r]).parent){if(!(a=d.get(l)))throw new Error("missing: "+l);if(a===P5)throw new Error("ambiguous: "+l);a.children?a.children.push(s):a.children=[s],s.parent=a}else{if(o)throw new Error("multiple roots");o=s}if(!o)throw new Error("no root");if(o.parent=$5,o.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(d5),o.parent=null,h>0)throw new Error("cycle");return o}return n.id=function(e){return arguments.length?(t=M5(e),n):t},n.parentId=function(t){return arguments.length?(e=M5(t),n):e},n}function W5(t,e){return t.parent===e.parent?1:2}function j5(t){var e=t.children;return e?e[0]:t.t}function U5(t){var e=t.children;return e?e[e.length-1]:t.t}function G5(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function H5(t,e,n){return t.a.parent===e.parent?t.a:n}function q5(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function X5(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,u=t.value&&(r-n)/t.value;++s<l;)(o=a[s]).x0=e,o.x1=i,o.y0=n,o.y1=n+=o.value*u}q5.prototype=Object.create(p5.prototype);var Y5=(1+Math.sqrt(5))/2;function K5(t,e,n,i,r,o){for(var a,s,l,u,c,h,d,p,f,g,m,y=[],v=e.children,x=0,b=0,w=v.length,_=e.value;x<w;){l=r-n,u=o-i;do{c=v[b++].value}while(!c&&b<w);for(h=d=c,m=c*c*(g=Math.max(u/l,l/u)/(_*t)),f=Math.max(d/m,m/h);b<w;++b){if(c+=s=v[b].value,s<h&&(h=s),s>d&&(d=s),m=c*c*g,(p=Math.max(d/m,m/h))>f){c-=s;break}f=p}y.push(a={value:c,dice:l<u,children:v.slice(x,b)}),a.dice?L5(a,n,i,r,_?i+=u*c/_:o):X5(a,n,i,_?n+=l*c/_:r,o),_-=c,x=b}return y}var Z5=function t(e){function n(t,n,i,r,o){K5(e,t,n,i,r,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Y5);var J5=function t(e){function n(t,n,i,r,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,l,u,c,h=-1,d=a.length,p=t.value;++h<d;){for(l=(s=a[h]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?L5(s,n,i,r,p?i+=(o-i)*s.value/p:o):X5(s,n,i,p?n+=(r-n)*s.value/p:r,o),p-=s.value}else t._squarify=a=K5(e,t,n,i,r,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Y5);function Q5(t,e,n){const i={};return t.each((t=>{const r=t.data;n(r)&&(i[e(r)]=t)})),t.lookup=i,t}function t4(t){Iz.call(this,null,t)}t4.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const e4=t=>t.values;function n4(){const t=[],e={entries:t=>i(n(t,0),0),key:n=>(t.push(n),e)};function n(e,i){if(i>=t.length)return e;const r=e.length,o=t[i++],a={},s={};let l,u,c,h=-1;for(;++h<r;)l=o(u=e[h])+"",(c=a[l])?c.push(u):a[l]=[u];for(l in a)s[l]=n(a[l],i);return s}function i(e,n){if(++n>t.length)return e;const r=[];for(const t in e)r.push({key:t,values:i(e[t],n)});return r}return e}function i4(t){Iz.call(this,null,t)}OO(t4,Iz,{transform(t,e){e.source||ON("Nest transform requires an upstream data source.");var n=t.generate,i=t.modified(),r=e.clone(),o=this.value;return(!o||i||e.changed())&&(o&&o.each((t=>{t.children&&XP(t.data)&&r.rem.push(t.data)})),this.value=o=l5({values:gO(t.keys).reduce(((t,e)=>(t.key(e),t)),n4()).entries(r.source)},e4),n&&o.each((t=>{t.children&&(t=ZP(t.data),r.add.push(t),r.source.push(t))})),Q5(o,YP,YP)),r.source.root=o,r}});const r4=(t,e)=>t.parent===e.parent?1:2;OO(i4,Iz,{transform(t,e){e.source&&e.source.root||ON(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),i=this.fields,r=e.source.root,o=t.as||i;t.field?r.sum(t.field):r.count(),t.sort&&r.sort(ez(t.sort,(t=>t.data))),function(t,e,n){for(let i,r=0,o=e.length;r<o;++r)i=e[r],i in n&&t[i](n[i])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?r4:zN);try{this.value=n(r)}catch(t){ON(t)}return r.each((t=>function(t,e,n){const i=t.data,r=e.length-1;for(let o=0;o<r;++o)i[n[o]]=t[e[o]];i[n[r]]=t.children?t.children.length:0}(t,i,o))),e.reflow(t.modified()).modifies(o).modifies("leaf")}});const o4=["x","y","r","depth","children"];function a4(t){i4.call(this,t)}a4.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:o4.length,default:o4}]},OO(a4,i4,{layout:function(){var t=null,e=1,n=1,i=D5;function r(r){return r.x=e/2,r.y=n/2,t?r.eachBefore(N5(t)).eachAfter(O5(i,.5)).eachBefore(F5(1)):r.eachBefore(N5(E5)).eachAfter(O5(D5,1)).eachAfter(O5(i,r.r/Math.min(e,n))).eachBefore(F5(Math.min(e,n)/(2*r.r))),r}return r.radius=function(e){return arguments.length?(t=I5(e),r):t},r.size=function(t){return arguments.length?(e=+t[0],n=+t[1],r):[e,n]},r.padding=function(t){return arguments.length?(i="function"==typeof t?t:T5(+t),r):i},r},params:["radius","size","padding"],fields:o4});const s4=["x0","y0","x1","y1","depth","children"];function l4(t){i4.call(this,t)}function u4(t){Iz.call(this,null,t)}l4.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:s4.length,default:s4}]},OO(l4,i4,{layout:function(){var t=1,e=1,n=0,i=!1;function r(r){var o=r.height+1;return r.x0=r.y0=n,r.x1=t,r.y1=e/o,r.eachBefore(function(t,e){return function(i){i.children&&L5(i,i.x0,t*(i.depth+1)/e,i.x1,t*(i.depth+2)/e);var r=i.x0,o=i.y0,a=i.x1-n,s=i.y1-n;a<r&&(r=a=(r+a)/2),s<o&&(o=s=(o+s)/2),i.x0=r,i.y0=o,i.x1=a,i.y1=s}}(e,o)),i&&r.eachBefore(R5),r}return r.round=function(t){return arguments.length?(i=!!t,r):i},r.size=function(n){return arguments.length?(t=+n[0],e=+n[1],r):[t,e]},r.padding=function(t){return arguments.length?(n=+t,r):n},r},params:["size","round","padding"],fields:s4}),u4.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},OO(u4,Iz,{transform(t,e){e.source||ON("Stratify transform requires an upstream data source.");let n=this.value;const i=t.modified(),r=e.fork(e.ALL).materialize(e.SOURCE),o=!n||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return r.source=r.source.slice(),o&&(n=r.source.length?Q5(V5().id(t.key).parentId(t.parentKey)(r.source),t.key,BN):Q5(V5()([{}]),t.key,t.key)),r.source.root=this.value=n,r}});const c4={tidy:function(){var t=W5,e=1,n=1,i=null;function r(r){var l=function(t){for(var e,n,i,r,o,a=new q5(t,0),s=[a];e=s.pop();)if(i=e._.children)for(e.children=new Array(o=i.length),r=o-1;r>=0;--r)s.push(n=e.children[r]=new q5(i[r],r)),n.parent=e;return(a.parent=new q5(null,0)).children=[a],a}(r);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(a),i)r.eachBefore(s);else{var u=r,c=r,h=r;r.eachBefore((function(t){t.x<u.x&&(u=t),t.x>c.x&&(c=t),t.depth>h.depth&&(h=t)}));var d=u===c?1:t(u,c)/2,p=d-u.x,f=e/(c.x+d+p),g=n/(h.depth||1);r.eachBefore((function(t){t.x=(t.x+p)*f,t.y=t.depth*g}))}return r}function o(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){!function(t){for(var e,n=0,i=0,r=t.children,o=r.length;--o>=0;)(e=r[o]).z+=n,e.m+=n,n+=e.s+(i+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-o):e.z=o}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,n,i){if(n){for(var r,o=e,a=e,s=n,l=o.parent.children[0],u=o.m,c=a.m,h=s.m,d=l.m;s=U5(s),o=j5(o),s&&o;)l=j5(l),(a=U5(a)).a=e,(r=s.z+h-o.z-u+t(s._,o._))>0&&(G5(H5(s,e,i),e,r),u+=r,c+=r),h+=s.m,u+=o.m,d+=l.m,c+=a.m;s&&!U5(a)&&(a.t=s,a.m+=h-c),o&&!j5(l)&&(l.t=o,l.m+=u-d,i=e)}return i}(e,r,e.parent.A||i[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r},cluster:function(){var t=r5,e=1,n=1,i=!1;function r(r){var o,a=0;r.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(o5,0)/t.length}(n),e.y=function(t){return 1+t.reduce(a5,0)}(n)):(e.x=o?a+=t(e,o):0,e.y=0,o=e)}));var s=function(t){for(var e;e=t.children;)t=e[0];return t}(r),l=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(r),u=s.x-t(s,l)/2,c=l.x+t(l,s)/2;return r.eachAfter(i?function(t){t.x=(t.x-r.x)*e,t.y=(r.y-t.y)*n}:function(t){t.x=(t.x-u)/(c-u)*e,t.y=(1-(r.y?t.y/r.y:1))*n})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r}},h4=["x","y","depth","children"];function d4(t){i4.call(this,t)}function p4(t){Iz.call(this,[],t)}d4.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:h4.length,default:h4}]},OO(d4,i4,{layout(t){const e=t||"tidy";if(DO(c4,e))return c4[e]();ON("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:h4}),p4.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},OO(p4,Iz,{transform(t,e){const n=this.value,i=e.source&&e.source.root,r=e.fork(e.NO_SOURCE),o={};return i||ON("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(r.rem=n,e.visit(e.SOURCE,(t=>o[YP(t)]=1)),i.each((t=>{const e=t.data,n=t.parent&&t.parent.data;n&&o[YP(e)]&&o[YP(n)]&&r.add.push(ZP({source:n,target:e}))})),this.value=r.add):e.changed(e.MOD)&&(e.visit(e.MOD,(t=>o[YP(t)]=1)),n.forEach((t=>{(o[YP(t.source)]||o[YP(t.target)])&&r.mod.push(t)}))),r}});const f4={binary:function(t,e,n,i,r){var o,a,s=t.children,l=s.length,u=new Array(l+1);for(u[0]=a=o=0;o<l;++o)u[o+1]=a+=s[o].value;!function t(e,n,i,r,o,a,l){if(e>=n-1){var c=s[e];return c.x0=r,c.y0=o,c.x1=a,void(c.y1=l)}var h=u[e],d=i/2+h,p=e+1,f=n-1;for(;p<f;){var g=p+f>>>1;u[g]<d?p=g+1:f=g}d-u[p-1]<u[p]-d&&e+1<p&&--p;var m=u[p]-h,y=i-m;if(a-r>l-o){var v=i?(r*y+a*m)/i:a;t(e,p,m,r,o,v,l),t(p,n,y,v,o,a,l)}else{var x=i?(o*y+l*m)/i:l;t(e,p,m,r,o,a,x),t(p,n,y,r,x,a,l)}}(0,l,t.value,e,n,i,r)},dice:L5,slice:X5,slicedice:function(t,e,n,i,r){(1&t.depth?X5:L5)(t,e,n,i,r)},squarify:Z5,resquarify:J5},g4=["x0","y0","x1","y1","depth","children"];function m4(t){i4.call(this,t)}m4.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:g4.length,default:g4}]},OO(m4,i4,{layout(){const t=function(){var t=Z5,e=!1,n=1,i=1,r=[0],o=D5,a=D5,s=D5,l=D5,u=D5;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=i,t.eachBefore(h),r=[0],e&&t.eachBefore(R5),t}function h(e){var n=r[e.depth],i=e.x0+n,c=e.y0+n,h=e.x1-n,d=e.y1-n;h<i&&(i=h=(i+h)/2),d<c&&(c=d=(c+d)/2),e.x0=i,e.y0=c,e.x1=h,e.y1=d,e.children&&(n=r[e.depth+1]=o(e)/2,i+=u(e)-n,c+=a(e)-n,(h-=s(e)-n)<i&&(i=h=(i+h)/2),(d-=l(e)-n)<c&&(c=d=(c+d)/2),t(e,i,c,h,d))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],i=+t[1],c):[n,i]},c.tile=function(e){return arguments.length?(t=M5(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:T5(+t),c):o},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:T5(+t),c):a},c.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:T5(+t),c):s},c.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:T5(+t),c):l},c.paddingLeft=function(t){return arguments.length?(u="function"==typeof t?t:T5(+t),c):u},c}();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{DO(f4,e)?t.tile(f4[e]):ON("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:g4});var y4=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nest:t4,pack:a4,partition:l4,stratify:u4,tree:d4,treelinks:p4,treemap:m4});function v4(t,e,n,i){const r=t.width,o=t.height,a=n||i,s=oj(r,o).getContext("2d");e.forEach((t=>x4(s,t,a)));const l=new Uint32Array(s.getImageData(0,0,r,o).data.buffer),u=t.bitmap(),c=a&&t.bitmap();let h,d,p,f,g;for(d=0;d<o;++d)for(h=0;h<r;++h)g=4278190080&l[d*r+h],g&&(p=t(h),f=t(d),i||u.set(p,f),a&&268435456^g&&c.set(p,f));return[u,c]}function x4(t,e,n){if(!e.length)return;const i=e[0].mark.marktype;"group"===i?e.forEach((e=>{e.items.forEach((e=>x4(t,e.items,n)))})):qY[i].draw(t,{items:n?e.map(b4):e})}function b4(t){const e=QP(t,{});return e.stroke&&(e.strokeOpacity=1),e.fill&&(e.fillOpacity=.0625,e.stroke="#000",e.strokeOpacity=1,e.strokeWidth=2),e}const w4=new Uint32Array(33),_4=new Uint32Array(33);_4[0]=0,w4[0]=~_4[0];for(let t=1;t<=32;++t)_4[t]=_4[t-1]<<1|1,w4[t]=~_4[t];function k4(t,e,n){const i=Math.max(1,Math.sqrt(t*e/1e6)),r=~~((t+2*n+i)/i),o=~~((e+2*n+i)/i),a=t=>~~((t+n)/i);return a.invert=t=>t*i-n,a.bitmap=()=>function(t,e){const n=new Uint32Array(~~((t*e+32)/32));function i(t,e){n[t]|=e}function r(t,e){n[t]&=e}return{array:n,get:(e,i)=>{const r=i*t+e;return n[r>>>5]&1<<(31&r)},set:(e,n)=>{const r=n*t+e;i(r>>>5,1<<(31&r))},clear:(e,n)=>{const i=n*t+e;r(i>>>5,~(1<<(31&i)))},getRange:(e,i,r,o)=>{let a,s,l,u,c=o;for(;c>=i;--c)if(a=c*t+e,s=c*t+r,l=a>>>5,u=s>>>5,l===u){if(n[l]&w4[31&a]&_4[1+(31&s)])return!0}else{if(n[l]&w4[31&a])return!0;if(n[u]&_4[1+(31&s)])return!0;for(let t=l+1;t<u;++t)if(n[t])return!0}return!1},setRange:(e,n,r,o)=>{let a,s,l,u,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+r,l=a>>>5,u=s>>>5,l===u)i(l,w4[31&a]&_4[1+(31&s)]);else for(i(l,w4[31&a]),i(u,_4[1+(31&s)]),c=l+1;c<u;++c)i(c,4294967295)},clearRange:(e,n,i,o)=>{let a,s,l,u,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+i,l=a>>>5,u=s>>>5,l===u)r(l,_4[31&a]|w4[1+(31&s)]);else for(r(l,_4[31&a]),r(u,w4[1+(31&s)]),c=l+1;c<u;++c)r(c,0)},outOfBounds:(n,i,r,o)=>n<0||i<0||o>=e||r>=t}}(r,o),a.ratio=i,a.padding=n,a.width=t,a.height=e,a}function S4(t,e,n,i,r,o){let a=n/2;return t-a<0||t+a>r||e-(a=i/2)<0||e+a>o}function C4(t,e,n,i,r,o,a,s){const l=r*o/(2*i),u=t(e-l),c=t(e+l),h=t(n-(o/=2)),d=t(n+o);return a.outOfBounds(u,h,c,d)||a.getRange(u,h,c,d)||s&&s.getRange(u,h,c,d)}const A4=[-1,-1,1,1],I4=[-1,1,-1,1];const M4=["right","center","left"],D4=["bottom","middle","top"];function T4(t,e,n,i,r,o,a,s,l,u,c,h){return!(r.outOfBounds(t,n,e,i)||(h&&o?o.getRange(t,n,e,i)||!function(t,e,n,i,r){return r[0]<=t&&n<=r[2]&&r[3]<=e&&i<=r[5]}(a,l,s,u,c):r.getRange(t,n,e,i)))}const E4={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},N4={naive:function(t,e,n,i){const r=t.width,o=t.height;return function(t){const e=t.datum.datum.items[i].items,n=e.length,a=t.datum.fontSize,s=DY.width(t.datum,t.datum.text);let l,u,c,h,d,p,f,g=0;for(let i=0;i<n;++i)l=e[i].x,c=e[i].y,u=void 0===e[i].x2?l:e[i].x2,h=void 0===e[i].y2?c:e[i].y2,d=(l+u)/2,p=(c+h)/2,f=Math.abs(u-l+h-c),f>=g&&(g=f,t.x=d,t.y=p);return d=s/2,p=a/2,l=t.x-d,u=t.x+d,c=t.y-p,h=t.y+p,t.align="center",l<0&&u<=r?t.align="left":0<=l&&r<u&&(t.align="right"),t.baseline="middle",c<0&&h<=o?t.baseline="top":0<=c&&o<h&&(t.baseline="bottom"),!0}},"reduced-search":function(t,e,n,i){const r=t.width,o=t.height,a=e[0],s=e[1];function l(e,n,i,l,u){const c=t.invert(e),h=t.invert(n);let d,p=i,f=o;if(!S4(c,h,l,u,r,o)&&!C4(t,c,h,u,l,p,a,s)&&!C4(t,c,h,u,l,u,a,null)){for(;f-p>=1;)d=(p+f)/2,C4(t,c,h,u,l,d,a,s)?f=d:p=d;if(p>i)return[c,h,p,!0]}}return function(e){const s=e.datum.datum.items[i].items,u=s.length,c=e.datum.fontSize,h=DY.width(e.datum,e.datum.text);let d,p,f,g,m,y,v,x,b,w,_,k,S,C,A,I,M,D=n?c:0,T=!1,E=!1,N=0;for(let i=0;i<u;++i){for(d=s[i].x,f=s[i].y,p=void 0===s[i].x2?d:s[i].x2,g=void 0===s[i].y2?f:s[i].y2,d>p&&(M=d,d=p,p=M),f>g&&(M=f,f=g,g=M),b=t(d),_=t(p),w=~~((b+_)/2),k=t(f),C=t(g),S=~~((k+C)/2),v=w;v>=b;--v)for(x=S;x>=k;--x)I=l(v,x,D,h,c),I&&([e.x,e.y,D,T]=I);for(v=w;v<=_;++v)for(x=S;x<=C;++x)I=l(v,x,D,h,c),I&&([e.x,e.y,D,T]=I);T||n||(A=Math.abs(p-d+g-f),m=(d+p)/2,y=(f+g)/2,A>=N&&!S4(m,y,h,c,r,o)&&!C4(t,m,y,c,h,c,a,null)&&(N=A,e.x=m,e.y=y,E=!0))}return!(!T&&!E)&&(m=h/2,y=c/2,a.setRange(t(e.x-m),t(e.y-y),t(e.x+m),t(e.y+y)),e.align="center",e.baseline="middle",!0)}},floodfill:function(t,e,n,i){const r=t.width,o=t.height,a=e[0],s=e[1],l=t.bitmap();return function(e){const u=e.datum.datum.items[i].items,c=u.length,h=e.datum.fontSize,d=DY.width(e.datum,e.datum.text),p=[];let f,g,m,y,v,x,b,w,_,k,S,C,A=n?h:0,I=!1,M=!1,D=0;for(let i=0;i<c;++i){for(f=u[i].x,m=u[i].y,g=void 0===u[i].x2?f:u[i].x2,y=void 0===u[i].y2?m:u[i].y2,p.push([t((f+g)/2),t((m+y)/2)]);p.length;)if([b,w]=p.pop(),!(a.get(b,w)||s.get(b,w)||l.get(b,w))){l.set(b,w);for(let t=0;t<4;++t)v=b+A4[t],x=w+I4[t],l.outOfBounds(v,x,v,x)||p.push([v,x]);if(v=t.invert(b),x=t.invert(w),_=A,k=o,!S4(v,x,d,h,r,o)&&!C4(t,v,x,h,d,_,a,s)&&!C4(t,v,x,h,d,h,a,null)){for(;k-_>=1;)S=(_+k)/2,C4(t,v,x,h,d,S,a,s)?k=S:_=S;_>A&&(e.x=v,e.y=x,A=_,I=!0)}}I||n||(C=Math.abs(g-f+y-m),v=(f+g)/2,x=(m+y)/2,C>=D&&!S4(v,x,d,h,r,o)&&!C4(t,v,x,h,d,h,a,null)&&(D=C,e.x=v,e.y=x,M=!0))}return!(!I&&!M)&&(v=d/2,x=h/2,a.setRange(t(e.x-v),t(e.y-x),t(e.x+v),t(e.y+x)),e.align="center",e.baseline="middle",!0)}}};function O4(t,e,n,i,r,o,a,s,l,u,c){if(!t.length)return t;const h=Math.max(i.length,r.length),d=function(t,e){const n=new Float64Array(e),i=t.length;for(let e=0;e<i;++e)n[e]=t[e]||0;for(let t=i;t<e;++t)n[t]=n[i-1];return n}(i,h),p=function(t,e){const n=new Int8Array(e),i=t.length;for(let e=0;e<i;++e)n[e]|=E4[t[e]];for(let t=i;t<e;++t)n[t]=n[i-1];return n}(r,h),f=(b=t[0].datum)&&b.mark&&b.mark.marktype,g="group"===f&&t[0].datum.items[l].marktype,m="area"===g,y=function(t,e,n,i){const r=t=>[t.x,t.x,t.x,t.y,t.y,t.y];return t?"line"===t||"area"===t?t=>r(t.datum):"line"===e?t=>{const e=t.datum.items[i].items;return r(e.length?e["start"===n?0:e.length-1]:{x:NaN,y:NaN})}:t=>{const e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}:r}(f,g,s,l),v=k4(e[0],e[1],u),x=m&&"naive"===c;var b;const w=t.map((t=>({datum:t,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(t)})));let _;if(!x){n&&w.sort(((t,e)=>n(t.datum,e.datum)));let e=!1;for(let t=0;t<p.length&&!e;++t)e=5===p[t]||d[t]<0;f&&(a||m)&&(o=[t.map((t=>t.datum))].concat(o)),_=o.length?v4(v,o,e,m):function(t,e){const n=t.bitmap();return(e||[]).forEach((e=>n.set(t(e.boundary[0]),t(e.boundary[3])))),[n,void 0]}(v,a&&w)}const k=m?N4[c](v,_,a,l):function(t,e,n,i){const r=t.width,o=t.height,a=e[0],s=e[1],l=i.length;return function(e){const u=e.boundary,c=e.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>r||u[3]>o)return!1;let h,d,p,f,g,m,y,v,x,b,w,_,k,S,C,A=0;for(let r=0;r<l;++r){if(h=(3&n[r])-1,d=(n[r]>>>2&3)-1,p=0===h&&0===d||i[r]<0,f=h&&d?Math.SQRT1_2:1,g=i[r]<0?-1:1,m=u[1+h]+i[r]*h*f,w=u[4+d]+g*c*d/2+i[r]*d*f,v=w-c/2,x=w+c/2,_=t(m),S=t(v),C=t(x),!A){if(!T4(_,_,S,C,a,s,m,m,v,x,u,p))continue;A=DY.width(e.datum,e.datum.text)}if(b=m+g*A*h/2,m=b-A/2,y=b+A/2,_=t(m),k=t(y),T4(_,k,S,C,a,s,m,y,v,x,u,p))return e.x=h?h*g<0?y:m:b,e.y=d?d*g<0?x:v:w,e.align=M4[h*g+1],e.baseline=D4[d*g+1],a.setRange(_,S,k,C),!0}return!1}}(v,_,p,d);return w.forEach((t=>t.opacity=+k(t))),w}const F4=["x","y","opacity","align","baseline"],R4=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function L4(t){Iz.call(this,null,t)}L4.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:R4},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:F4.length,default:F4}]},OO(L4,Iz,{transform(t,e){const n=t.modified();if(!(n||e.changed(e.ADD_REM)||function(n){const i=t[n];return yO(i)&&e.modified(i.fields)}("sort")))return;t.size&&2===t.size.length||ON("Size parameter should be specified as a [width, height] array.");const i=t.as||F4;return O4(e.materialize(e.SOURCE).source,t.size,t.sort,gO(t.offset||1),gO(t.anchor||R4),t.avoidMarks||[],!1!==t.avoidBaseMark,t.lineAnchor||"end",t.markIndex||0,t.padding||0,t.method||"naive").forEach((t=>{const e=t.datum;e[i[0]]=t.x,e[i[1]]=t.y,e[i[2]]=t.opacity,e[i[3]]=t.align,e[i[4]]=t.baseline})),e.reflow(n).modifies(i)}});var $4=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",label:L4});function P4(t,e){var n,i,r,o,a,s,l=[],u=function(t){return t(o)};if(null==e)l.push(t);else for(n={},i=0,r=t.length;i<r;++i)o=t[i],(s=n[a=e.map(u)])||(n[a]=s=[],s.dims=a,l.push(s)),s.push(o);return l}function z4(t){Iz.call(this,null,t)}z4.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},OO(z4,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=P4(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(MN),o=r.length,a=t.as||[MN(t.x),MN(t.y)],s=[];i.forEach((e=>{mB(e,t.x,t.y,t.bandwidth||.3).forEach((t=>{const n={};for(let t=0;t<o;++t)n[r[t]]=e.dims[t];n[a[0]]=t[0],n[a[1]]=t[1],s.push(ZP(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const B4={linear:uB,log:cB,exp:hB,pow:dB,quad:pB,poly:fB};function V4(t){Iz.call(this,null,t)}V4.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(B4)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},OO(V4,Iz,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=P4(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(MN),o=t.method||"linear",a=t.order||3,s=((t,e)=>"poly"===t?e:"quad"===t?2:1)(o,a),l=t.as||[MN(t.x),MN(t.y)],u=B4[o],c=[];let h=t.extent;DO(B4,o)||ON("Invalid regression method: "+o),null!=h&&"log"===o&&h[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach((n=>{if(n.length<=s)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const i=u(n,t.x,t.y,a);if(t.params)return void c.push(ZP({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));const d=h||AO(n,t.x),p=t=>{const e={};for(let t=0;t<r.length;++t)e[r[t]]=n.dims[t];e[l[0]]=t[0],e[l[1]]=t[1],c.push(ZP(e))};"linear"===o?d.forEach((t=>p([t,i.predict(t)]))):bB(i.predict,d,25,200).forEach(p)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});var W4=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",loess:z4,regression:V4});const j4=Math.pow(2,-52),U4=new Uint32Array(512);class G4{static from(t,e=Q4,n=t6){const i=t.length,r=new Float64Array(2*i);for(let o=0;o<i;o++){const i=t[o];r[2*o]=e(i),r[2*o+1]=n(i)}return new G4(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:r}=this,o=t.length>>1;let a=1/0,s=1/0,l=-1/0,u=-1/0;for(let e=0;e<o;e++){const n=t[2*e],i=t[2*e+1];n<a&&(a=n),i<s&&(s=i),n>l&&(l=n),i>u&&(u=i),this._ids[e]=e}const c=(a+l)/2,h=(s+u)/2;let d,p,f,g=1/0;for(let e=0;e<o;e++){const n=H4(c,h,t[2*e],t[2*e+1]);n<g&&(d=e,g=n)}const m=t[2*d],y=t[2*d+1];g=1/0;for(let e=0;e<o;e++){if(e===d)continue;const n=H4(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(p=e,g=n)}let v=t[2*p],x=t[2*p+1],b=1/0;for(let e=0;e<o;e++){if(e===d||e===p)continue;const n=K4(m,y,v,x,t[2*e],t[2*e+1]);n<b&&(f=e,b=n)}let w=t[2*f],_=t[2*f+1];if(b===1/0){for(let e=0;e<o;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];Z4(this._ids,this._dists,0,o-1);const e=new Uint32Array(o);let n=0;for(let t=0,i=-1/0;t<o;t++){const r=this._ids[t];this._dists[r]>i&&(e[n++]=r,i=this._dists[r])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(X4(m,y,v,x,w,_)){const t=p,e=v,n=x;p=f,v=w,x=_,f=t,w=e,_=n}const k=function(t,e,n,i,r,o){const a=n-t,s=i-e,l=r-t,u=o-e,c=a*a+s*s,h=l*l+u*u,d=.5/(a*u-s*l);return{x:t+(u*c-s*h)*d,y:e+(a*h-l*c)*d}}(m,y,v,x,w,_);this._cx=k.x,this._cy=k.y;for(let e=0;e<o;e++)this._dists[e]=H4(t[2*e],t[2*e+1],k.x,k.y);Z4(this._ids,this._dists,0,o-1),this._hullStart=d;let S=3;n[d]=e[f]=p,n[p]=e[d]=f,n[f]=e[p]=d,i[d]=0,i[p]=1,i[f]=2,r.fill(-1),r[this._hashKey(m,y)]=d,r[this._hashKey(v,x)]=p,r[this._hashKey(w,_)]=f,this.trianglesLen=0,this._addTriangle(d,p,f,-1,-1,-1);for(let o,a,s=0;s<this._ids.length;s++){const l=this._ids[s],u=t[2*l],c=t[2*l+1];if(s>0&&Math.abs(u-o)<=j4&&Math.abs(c-a)<=j4)continue;if(o=u,a=c,l===d||l===p||l===f)continue;let h=0;for(let t=0,e=this._hashKey(u,c);t<this._hashSize&&(h=r[(e+t)%this._hashSize],-1===h||h===n[h]);t++);h=e[h];let g,m=h;for(;g=n[m],!X4(u,c,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)if(m=g,m===h){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,l,n[m],-1,-1,i[m]);i[l]=this._legalize(y+2),i[m]=y,S++;let v=n[m];for(;g=n[v],X4(u,c,t[2*v],t[2*v+1],t[2*g],t[2*g+1]);)y=this._addTriangle(v,l,g,i[l],-1,i[v]),i[l]=this._legalize(y+2),n[v]=v,S--,v=g;if(m===h)for(;g=e[m],X4(u,c,t[2*g],t[2*g+1],t[2*m],t[2*m+1]);)y=this._addTriangle(g,l,m,-1,i[m],i[g]),this._legalize(y+2),i[g]=y,n[m]=m,S--,m=g;this._hullStart=e[l]=m,n[m]=e[v]=l,n[l]=v,r[this._hashKey(u,c)]=l,r[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let r=0,o=0;for(;;){const a=n[t],s=t-t%3;if(o=s+(t+2)%3,-1===a){if(0===r)break;t=U4[--r];continue}const l=a-a%3,u=s+(t+1)%3,c=l+(a+2)%3,h=e[o],d=e[t],p=e[u],f=e[c];if(Y4(i[2*h],i[2*h+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*f],i[2*f+1])){e[t]=f,e[a]=h;const i=n[c];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(a,n[o]),this._link(o,c);const s=l+(a+1)%3;r<U4.length&&(U4[r++]=s)}else{if(0===r)break;t=U4[--r]}}return o}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,r,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}}function H4(t,e,n,i){const r=t-n,o=e-i;return r*r+o*o}function q4(t,e,n,i,r,o){const a=(i-e)*(r-t),s=(n-t)*(o-e);return Math.abs(a-s)>=33306690738754716e-32*Math.abs(a+s)?a-s:0}function X4(t,e,n,i,r,o){return(q4(r,o,t,e,n,i)||q4(t,e,n,i,r,o)||q4(n,i,r,o,t,e))<0}function Y4(t,e,n,i,r,o,a,s){const l=t-a,u=e-s,c=n-a,h=i-s,d=r-a,p=o-s,f=c*c+h*h,g=d*d+p*p;return l*(h*g-f*p)-u*(c*g-f*d)+(l*l+u*u)*(c*p-h*d)<0}function K4(t,e,n,i,r,o){const a=n-t,s=i-e,l=r-t,u=o-e,c=a*a+s*s,h=l*l+u*u,d=.5/(a*u-s*l),p=(u*c-s*h)*d,f=(a*h-l*c)*d;return p*p+f*f}function Z4(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=t[r],o=e[i];let a=r-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=i}else{let r=n+1,o=i;J4(t,n+i>>1,r),e[t[n]]>e[t[i]]&&J4(t,n,i),e[t[r]]>e[t[i]]&&J4(t,r,i),e[t[n]]>e[t[r]]&&J4(t,n,r);const a=t[r],s=e[a];for(;;){do{r++}while(e[t[r]]<s);do{o--}while(e[t[o]]>s);if(o<r)break;J4(t,r,o)}t[n+1]=t[o],t[o]=a,i-r+1>=o-n?(Z4(t,e,r,i),Z4(t,e,n,o-1)):(Z4(t,e,n,o-1),Z4(t,e,r,i))}}function J4(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Q4(t){return t[0]}function t6(t){return t[1]}class e6{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const i=(t=+t)+(n=+n),r=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>1e-6||Math.abs(this._y1-r)>1e-6)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class n6{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class i6{constructor(t,[e,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(e=+e)&&(r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,i,o=0,a=0,s=n.length;o<s;o+=3,a+=2){const s=2*n[o],l=2*n[o+1],u=2*n[o+2],c=t[s],h=t[s+1],d=t[l],p=t[l+1],f=t[u],g=t[u+1],m=d-c,y=p-h,v=f-c,x=g-h,b=m*m+y*y,w=v*v+x*x,_=2*(m*x-y*v);if(_)if(Math.abs(_)<1e-8)e=(c+f)/2,i=(h+g)/2;else{const t=1/_;e=c+(x*b-y*w)*t,i=h+(m*w-v*b)*t}else e=(c+f)/2-1e8*x,i=(h+g)/2+1e8*v;r[a]=e,r[a+1]=i}let o,a,s,l=e[e.length-1],u=4*l,c=t[2*l],h=t[2*l+1];i.fill(0);for(let n=0;n<e.length;++n)l=e[n],o=u,a=c,s=h,u=4*l,c=t[2*l],h=t[2*l+1],i[o+2]=i[u]=s-h,i[o+3]=i[u+1]=c-a}render(t){const e=null==t?t=new e6:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:o,vectors:a}=this;if(r.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const r=2*Math.floor(e/3),a=2*Math.floor(i/3),s=o[r],l=o[r+1],u=o[a],c=o[a+1];this._renderSegment(s,l,u,c,t)}let s,l=r[r.length-1];for(let e=0;e<r.length;++e){s=l,l=r[e];const n=2*Math.floor(i[l]/3),u=o[n],c=o[n+1],h=4*s,d=this._project(u,c,a[h+2],a[h+3]);d&&this._renderSegment(u,c,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new e6:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new e6:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let t=2;t<r;t+=2)i[t]===i[t-2]&&i[t+1]===i[t-1]||e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new n6;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,r){let o;const a=this._regioncode(t,e),s=this._regioncode(n,i);0===a&&0===s?(r.moveTo(t,e),r.lineTo(n,i)):(o=this._clipSegment(t,e,n,i,a,s))&&(r.moveTo(o[0],o[1]),r.lineTo(o[2],o[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,r=e.length;i<r;i+=2)for(let o=0,a=t.length;o<a;o+=2)if(e[i]==t[o]&&e[i+1]==t[o+1]&&e[(i+2)%r]==t[(o+a-2)%a]&&e[(i+3)%r]==t[(o+a-1)%a]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,o=n[t];if(-1===o)return null;const a=[];let s=o;do{const n=Math.floor(s/3);if(a.push(e[2*n],e[2*n+1]),s=s%3==2?s-2:s+1,r[s]!==t)break;s=i[s]}while(s!==o&&-1!==s);return a}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,i=4*t;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i,r,o,a,s,l=null,u=e[n-2],c=e[n-1],h=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(i=u,r=c,u=e[d],c=e[d+1],o=h,h=this._regioncode(u,c),0===o&&0===h)a=s,s=0,l?l.push(u,c):l=[u,c];else{let e,n,d,p,f;if(0===o){if(null===(e=this._clipSegment(i,r,u,c,o,h)))continue;[n,d,p,f]=e}else{if(null===(e=this._clipSegment(u,c,i,r,h,o)))continue;[p,f,n,d]=e,a=s,s=this._edgecode(n,d),a&&s&&this._edge(t,a,s,l,l.length),l?l.push(n,d):l=[n,d]}a=s,s=this._edgecode(p,f),a&&s&&this._edge(t,a,s,l,l.length),l?l.push(p,f):l=[p,f]}if(l)a=s,s=this._edgecode(l[0],l[1]),a&&s&&this._edge(t,a,s,l,l.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(t,e,n,i,r,o){for(;;){if(0===r&&0===o)return[t,e,n,i];if(r&o)return null;let a,s,l=r||o;8&l?(a=t+(n-t)*(this.ymax-e)/(i-e),s=this.ymax):4&l?(a=t+(n-t)*(this.ymin-e)/(i-e),s=this.ymin):2&l?(s=e+(i-e)*(this.xmax-t)/(n-t),a=this.xmax):(s=e+(i-e)*(this.xmin-t)/(n-t),a=this.xmin),r?(t=a,e=s,r=this._regioncode(t,e)):(n=a,i=s,o=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,r,o){let a,s=Array.from(e);if((a=this._project(s[0],s[1],n,i))&&s.unshift(a[0],a[1]),(a=this._project(s[s.length-2],s[s.length-1],r,o))&&s.push(a[0],a[1]),s=this._clipFinite(t,s))for(let e,n=0,i=s.length,r=this._edgecode(s[i-2],s[i-1]);n<i;n+=2)e=r,r=this._edgecode(s[n],s[n+1]),e&&r&&(n=this._edge(t,e,r,s,n),i=s.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(t,e,n,i,r){for(;e!==n;){let n,o;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,o=this.ymin}i[r]===n&&i[r+1]===o||!this.contains(t,n,o)||(i.splice(r,0,n,o),r+=2)}if(i.length>4)for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])&&(i.splice(e,2),t-=2)}return r}_project(t,e,n,i){let r,o,a,s=1/0;if(i<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/i)<s&&(a=this.ymin,o=t+(s=r)*n)}else if(i>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/i)<s&&(a=this.ymax,o=t+(s=r)*n)}if(n>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/n)<s&&(o=this.xmax,a=e+(s=r)*i)}else if(n<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/n)<s&&(o=this.xmin,a=e+(s=r)*i)}return[o,a]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const r6=2*Math.PI,o6=Math.pow;function a6(t){return t[0]}function s6(t){return t[1]}function l6(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class u6{static from(t,e=a6,n=s6,i){return new u6("length"in t?function(t,e,n,i){const r=t.length,o=new Float64Array(2*r);for(let a=0;a<r;++a){const r=t[a];o[2*a]=e.call(i,r,a,t),o[2*a+1]=n.call(i,r,a,t)}return o}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let r=0;for(const o of t)yield e.call(i,o,r,t),yield n.call(i,o,r,t),++r}(t,e,n,i)))}constructor(t){this._delaunator=new G4(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const i=2*e[t],r=2*e[t+1],o=2*e[t+2];if((n[o]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],r=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let t=0,n=e.length/2;t<n;++t){const n=l6(e[2*t],e[2*t+1],r);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new G4(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=r[t%3==2?t-2:t+1];-1!==n[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=i.length;t<e;++t)a[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,2===i.length&&(o[i[1]]=0))}voronoi(t){return new i6(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:r,triangles:o,collinear:a}=this;if(a){const e=a.indexOf(t);return e>0&&(yield a[e-1]),void(e<a.length-1&&(yield a[e+1]))}const s=e[t];if(-1===s)return;let l=s,u=-1;do{if(yield u=o[l],l=l%3==2?l-2:l+1,o[l]!==t)return;if(l=r[l],-1===l){const e=n[(i[t]+1)%n.length];return void(e!==u&&(yield e))}}while(l!==s)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const i=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==i;)n=r;return r}_step(t,e,n){const{inedges:i,hull:r,_hullIndex:o,halfedges:a,triangles:s,points:l}=this;if(-1===i[t]||!l.length)return(t+1)%(l.length>>1);let u=t,c=o6(e-l[2*t],2)+o6(n-l[2*t+1],2);const h=i[t];let d=h;do{let i=s[d];const h=o6(e-l[2*i],2)+o6(n-l[2*i+1],2);if(h<c&&(c=h,u=i),d=d%3==2?d-2:d+1,s[d]!==t)break;if(d=a[d],-1===d){if(d=r[(o[t]+1)%r.length],d!==i&&o6(e-l[2*d],2)+o6(n-l[2*d+1],2)<c)return d;break}}while(d!==h);return u}render(t){const e=null==t?t=new e6:void 0,{points:n,halfedges:i,triangles:r}=this;for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o<e)continue;const a=2*r[e],s=2*r[o];t.moveTo(n[a],n[a+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new e6:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){const r=i[n],o=i[n+1];t.moveTo(r+e,o),t.arc(r,o,e,0,r6)}return n&&n.value()}renderHull(t){const e=null==t?t=new e6:void 0,{hull:n,points:i}=this,r=2*n[0],o=n.length;t.moveTo(i[r],i[r+1]);for(let e=1;e<o;++e){const r=2*n[e];t.lineTo(i[r],i[r+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new n6;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new e6:void 0,{points:i,triangles:r}=this,o=2*r[t*=3],a=2*r[t+1],s=2*r[t+2];return e.moveTo(i[o],i[o+1]),e.lineTo(i[a],i[a+1]),e.lineTo(i[s],i[s+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new n6;return this.renderTriangle(t,e),e.value()}}function c6(t){Iz.call(this,null,t)}c6.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const h6=[-1e5,-1e5,1e5,1e5];function d6(t){const e=t[0][0],n=t[0][1];let i=t.length-1;for(;t[i][0]===e&&t[i][1]===n;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}OO(c6,Iz,{transform(t,e){const n=t.as||"path",i=e.source;if(!i||!i.length)return e;let r=t.size;r=r?[0,0,r[0],r[1]]:(r=t.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:h6;const o=this.value=u6.from(i,t.x,t.y).voronoi(r);for(let t=0,e=i.length;t<e;++t){const e=o.cellPolygon(t);i[t][n]=e?d6(e):null}return e.reflow(t.modified()).modifies(n)}});var p6=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",voronoi:c6}),f6=Math.PI/180,g6=2048;function m6(){var t,e,n,i,r,o,a,s=[256,256],l=b6,u=[],c=Math.random,h={};function d(t,e,n){for(var i,r,o,a,u,h=e.x,d=e.y,p=Math.sqrt(s[0]*s[0]+s[1]*s[1]),f=l(s),g=c()<.5?1:-1,m=-g;(i=f(m+=g))&&(r=~~i[0],o=~~i[1],!(Math.min(Math.abs(r),Math.abs(o))>=p));)if(e.x=h+r,e.y=d+o,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>s[0]||e.y+e.y1>s[1]||n&&v6(e,t,s[0])||n&&(u=n,!((a=e).x+a.x1>u[0].x&&a.x+a.x0<u[1].x&&a.y+a.y1>u[0].y&&a.y+a.y0<u[1].y)))){for(var y,v=e.sprite,x=e.width>>5,b=s[0]>>5,w=e.x-(x<<4),_=127&w,k=32-_,S=e.y1-e.y0,C=(e.y+e.y0)*b+(w>>5),A=0;A<S;A++){y=0;for(var I=0;I<=x;I++)t[C+I]|=y<<k|(I<x?(y=v[A*x+I])>>>_:0);C+=b}return e.sprite=null,!0}return!1}return h.layout=function(){for(var l=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=g6/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(oj()),h=function(t){var e=[],n=-1;for(;++n<t;)e[n]=0;return e}((s[0]>>5)*s[1]),p=null,f=u.length,g=-1,m=[],y=u.map((s=>({text:t(s),font:e(s),style:i(s),weight:r(s),rotate:o(s),size:~~(n(s)+1e-14),padding:a(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((t,e)=>e.size-t.size));++g<f;){var v=y[g];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,y6(l,v,y,g),v.hasText&&d(h,v,p)&&(m.push(v),p?x6(p,v):p=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return m},h.words=function(t){return arguments.length?(u=t,h):u},h.size=function(t){return arguments.length?(s=[+t[0],+t[1]],h):s},h.font=function(t){return arguments.length?(e=w6(t),h):e},h.fontStyle=function(t){return arguments.length?(i=w6(t),h):i},h.fontWeight=function(t){return arguments.length?(r=w6(t),h):r},h.rotate=function(t){return arguments.length?(o=w6(t),h):o},h.text=function(e){return arguments.length?(t=w6(e),h):t},h.spiral=function(t){return arguments.length?(l=_6[t]||t,h):l},h.fontSize=function(t){return arguments.length?(n=w6(t),h):n},h.padding=function(t){return arguments.length?(a=w6(t),h):a},h.random=function(t){return arguments.length?(c=t,h):c},h}function y6(t,e,n,i){if(!e.sprite){var r=t.context,o=t.ratio;r.clearRect(0,0,2048/o,g6/o);var a,s,l,u,c,h=0,d=0,p=0,f=n.length;for(--i;++i<f;){if(e=n[i],r.save(),r.font=e.style+" "+e.weight+" "+~~((e.size+1)/o)+"px "+e.font,a=r.measureText(e.text+"m").width*o,l=e.size<<1,e.rotate){var g=Math.sin(e.rotate*f6),m=Math.cos(e.rotate*f6),y=a*m,v=a*g,x=l*m,b=l*g;a=Math.max(Math.abs(y+b),Math.abs(y-b))+31>>5<<5,l=~~Math.max(Math.abs(v+x),Math.abs(v-x))}else a=a+31>>5<<5;if(l>p&&(p=l),h+a>=2048&&(h=0,d+=p,p=0),d+l>=g6)break;r.translate((h+(a>>1))/o,(d+(l>>1))/o),e.rotate&&r.rotate(e.rotate*f6),r.fillText(e.text,0,0),e.padding&&(r.lineWidth=2*e.padding,r.strokeText(e.text,0,0)),r.restore(),e.width=a,e.height=l,e.xoff=h,e.yoff=d,e.x1=a>>1,e.y1=l>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,h+=a}for(var w=r.getImageData(0,0,2048/o,g6/o).data,_=[];--i>=0;)if((e=n[i]).hasText){for(s=(a=e.width)>>5,l=e.y1-e.y0,u=0;u<l*s;u++)_[u]=0;if(null==(h=e.xoff))return;d=e.yoff;var k=0,S=-1;for(c=0;c<l;c++){for(u=0;u<a;u++){var C=s*c+(u>>5),A=w[2048*(d+c)+(h+u)<<2]?1<<31-u%32:0;_[C]|=A,k|=A}k?S=c:(e.y0++,l--,c--,d++)}e.y1=e.y0+S,e.sprite=_.slice(0,(e.y1-e.y0)*s)}}}function v6(t,e,n){n>>=5;for(var i,r=t.sprite,o=t.width>>5,a=t.x-(o<<4),s=127&a,l=32-s,u=t.y1-t.y0,c=(t.y+t.y0)*n+(a>>5),h=0;h<u;h++){i=0;for(var d=0;d<=o;d++)if((i<<l|(d<o?(i=r[h*o+d])>>>s:0))&e[c+d])return!0;c+=n}return!1}function x6(t,e){var n=t[0],i=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}function b6(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function w6(t){return"function"==typeof t?t:function(){return t}}var _6={archimedean:b6,rectangular:function(t){var e=4*t[0]/t[1],n=0,i=0;return function(t){var r=t<0?-1:1;switch(Math.sqrt(1+4*r*t)-r&3){case 0:n+=e;break;case 1:i+=4;break;case 2:n-=e;break;default:i-=4}return[n,i]}}};const k6=["x","y","font","fontSize","fontStyle","fontWeight","angle"],S6=["text","font","rotate","fontSize","fontStyle","fontWeight"];function C6(t){Iz.call(this,m6(),t)}C6.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:k6}]},OO(C6,Iz,{transform(t,e){!t.size||t.size[0]&&t.size[1]||ON("Wordcloud size dimensions must be non-zero.");const n=t.modified();if(!(n||e.changed(e.ADD_REM)||S6.some((function(n){const i=t[n];return yO(i)&&e.modified(i.fields)}))))return;const i=e.materialize(e.SOURCE).source,r=this.value,o=t.as||k6;let a,s=t.fontSize||14;if(yO(s)?a=t.fontSizeRange:s=kO(s),a){const t=s,e=vH("sqrt")().domain(AO(i,t)).range(a);s=n=>e(t(n))}i.forEach((t=>{t[o[0]]=NaN,t[o[1]]=NaN,t[o[3]]=0}));const l=r.words(i).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(s).random(Lz).layout(),u=r.size(),c=u[0]>>1,h=u[1]>>1,d=l.length;for(let t,e,n=0;n<d;++n)t=l[n],e=t.datum,e[o[0]]=t.x+c,e[o[1]]=t.y+h,e[o[2]]=t.font,e[o[3]]=t.size,e[o[4]]=t.style,e[o[5]]=t.weight,e[o[6]]=t.rotate;return e.reflow(n).modifies(o)}});var A6=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",wordcloud:C6});const I6=t=>new Uint8Array(t),M6=t=>new Uint16Array(t),D6=t=>new Uint32Array(t);function T6(t,e,n){const i=(e<257?I6:e<65537?M6:D6)(t);return n&&i.set(n),i}function E6(t,e,n){const i=1<<e;return{one:i,zero:~i,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){const n=this,r=n.bisect(n.range,t.value),o=t.index,a=r[0],s=r[1],l=o.length;let u;for(u=0;u<a;++u)e[o[u]]|=i;for(u=s;u<l;++u)e[o[u]]|=i;return n}}}function N6(){let t=D6(0),e=[],n=0;return{insert:function(i,r,o){if(!r.length)return[];const a=n,s=r.length,l=D6(s);let u,c,h,d=Array(s);for(h=0;h<s;++h)d[h]=i(r[h]),l[h]=h;if(d=function(t,e){return t.sort.call(e,((e,n)=>{const i=t[e],r=t[n];return i<r?-1:i>r?1:0})),function(t,e){return Array.from(e,(e=>t[e]))}(t,e)}(d,l),a)u=e,c=t,e=Array(a+s),t=D6(a+s),function(t,e,n,i,r,o,a,s,l){let u,c=0,h=0;for(u=0;c<i&&h<a;++u)e[c]<r[h]?(s[u]=e[c],l[u]=n[c++]):(s[u]=r[h],l[u]=o[h++]+t);for(;c<i;++c,++u)s[u]=e[c],l[u]=n[c];for(;h<a;++h,++u)s[u]=r[h],l[u]=o[h]+t}(o,u,c,a,d,l,s,e,t);else{if(o>0)for(h=0;h<s;++h)l[h]+=o;e=d,t=l}return n=a+s,{index:l,value:d}},remove:function(i,r){const o=n;let a,s,l;for(s=0;!r[t[s]]&&s<o;++s);for(l=s;s<o;++s)r[a=t[s]]||(t[l]=a,e[l]=e[s],++l);n=o-i},bisect:function(t,i){let r;return i?r=i.length:(i=e,r=n),[GF(i,t[0],0,r),UF(i,t[1],0,r)]},reindex:function(e){for(let i=0,r=n;i<r;++i)t[i]=e[t[i]]},index:()=>t,size:()=>n}}function O6(t){Iz.call(this,function(){let t=8,e=[],n=D6(0),i=T6(0,t),r=T6(0,t);return{data:()=>e,seen:()=>{return t=n,i=e.length,n=t.length>=i?t:((r=r||new t.constructor(i)).set(t),r);var t,i,r},add(t){for(let n,i=0,r=e.length,o=t.length;i<o;++i)n=t[i],n._index=r++,e.push(n)},remove(t,n){const o=e.length,a=Array(o-t),s=e;let l,u,c;for(u=0;!n[u]&&u<o;++u)a[u]=e[u],s[u]=u;for(c=u;u<o;++u)l=e[u],n[u]?s[u]=-1:(s[u]=c,i[c]=i[u],r[c]=r[u],a[c]=l,l._index=c++),i[u]=0;return e=a,s},size:()=>e.length,curr:()=>i,prev:()=>r,reset:t=>r[t]=i[t],all:()=>t<257?255:t<65537?65535:4294967295,set(t,e){i[t]|=e},clear(t,e){i[t]&=~e},resize(e,n){(e>i.length||n>t)&&(t=Math.max(n,t),i=T6(e,t,i),r=T6(e,t))}}}(),t),this._indices=null,this._dims=null}function F6(t){Iz.call(this,null,t)}O6.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},OO(O6,Iz,{transform(t,e){return this._dims?t.modified("fields")||t.fields.some((t=>e.modified(t.fields)))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},init(t,e){const n=t.fields,i=t.query,r=this._indices={},o=this._dims=[],a=i.length;let s,l,u=0;for(;u<a;++u)s=n[u].fname,l=r[s]||(r[s]=N6()),o.push(E6(l,u,i[u]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),i=t.fields,r=t.query,o=this._indices,a=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),h=n.rem=n.add,d=n.mod,p=r.length,f={};let g,m,y,v,x,b,w,_,k;if(u.set(l),e.rem.length&&(x=this.remove(t,e,n)),e.add.length&&s.add(e.add),e.mod.length)for(b={},v=e.mod,w=0,_=v.length;w<_;++w)b[v[w]._index]=1;for(w=0;w<p;++w)k=i[w],(!a[w]||t.modified("fields",w)||e.modified(k.fields))&&(y=k.fname,(g=f[y])||(o[y]=m=N6(),f[y]=g=m.insert(k,e.source,0)),a[w]=E6(m,w,r[w]).onAdd(g,l));for(w=0,_=s.data().length;w<_;++w)x[w]||(u[w]!==l[w]?h.push(w):b[w]&&l[w]!==c&&d.push(w));return s.mask=(1<<p)-1,n},eval(t,e){const n=e.materialize().fork(),i=this._dims.length;let r=0;return e.rem.length&&(this.remove(t,e,n),r|=(1<<i)-1),t.modified("query")&&!t.modified("fields")&&(r|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),r|=(1<<i)-1),e.mod.length&&(this.modify(e,n),r|=(1<<i)-1),this.value.mask=r,n},insert(t,e,n){const i=e.add,r=this.value,o=this._dims,a=this._indices,s=t.fields,l={},u=n.add,c=r.size()+i.length,h=o.length;let d,p,f,g=r.size();r.resize(c,h),r.add(i);const m=r.curr(),y=r.prev(),v=r.all();for(d=0;d<h;++d)p=s[d].fname,f=l[p]||(l[p]=a[p].insert(s[d],i,g)),o[d].onAdd(f,m);for(;g<c;++g)y[g]=v,m[g]!==v&&u.push(g)},modify(t,e){const n=e.mod,i=this.value,r=i.curr(),o=i.all(),a=t.mod;let s,l,u;for(s=0,l=a.length;s<l;++s)u=a[s]._index,r[u]!==o&&n.push(u)},remove(t,e,n){const i=this._indices,r=this.value,o=r.curr(),a=r.prev(),s=r.all(),l={},u=n.rem,c=e.rem;let h,d,p,f;for(h=0,d=c.length;h<d;++h)p=c[h]._index,l[p]=1,a[p]=f=o[p],o[p]=s,f!==s&&u.push(p);for(p in i)i[p].remove(d,l);return this.reindex(e,d,l),l},reindex(t,e,n){const i=this._indices,r=this.value;t.runAfter((()=>{const t=r.remove(e,n);for(const e in i)i[e].reindex(t)}))},update(t,e,n){const i=this._dims,r=t.query,o=e.stamp,a=i.length;let s,l,u=0;for(n.filters=0,l=0;l<a;++l)t.modified("query",l)&&(s=l,++u);if(1===u)u=i[s].one,this.incrementOne(i[s],r[s],n.add,n.rem);else for(l=0,u=0;l<a;++l)t.modified("query",l)&&(u|=i[l].one,this.incrementAll(i[l],r[l],o,n.add),n.rem=n.add);return u},incrementAll(t,e,n,i){const r=this.value,o=r.seen(),a=r.curr(),s=r.prev(),l=t.index(),u=t.bisect(t.range),c=t.bisect(e),h=c[0],d=c[1],p=u[0],f=u[1],g=t.one;let m,y,v;if(h<p)for(m=h,y=Math.min(p,d);m<y;++m)v=l[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=g;else if(h>p)for(m=p,y=Math.min(h,f);m<y;++m)v=l[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=g;if(d>f)for(m=Math.max(h,f),y=d;m<y;++m)v=l[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=g;else if(d<f)for(m=Math.max(p,d),y=f;m<y;++m)v=l[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=g;t.range=e.slice()},incrementOne(t,e,n,i){const r=this.value.curr(),o=t.index(),a=t.bisect(t.range),s=t.bisect(e),l=s[0],u=s[1],c=a[0],h=a[1],d=t.one;let p,f,g;if(l<c)for(p=l,f=Math.min(c,u);p<f;++p)g=o[p],r[g]^=d,n.push(g);else if(l>c)for(p=c,f=Math.min(l,h);p<f;++p)g=o[p],r[g]^=d,i.push(g);if(u>h)for(p=Math.max(l,h),f=u;p<f;++p)g=o[p],r[g]^=d,n.push(g);else if(u<h)for(p=Math.max(c,u),f=h;p<f;++p)g=o[p],r[g]^=d,i.push(g);t.range=e.slice()}}),F6.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},OO(F6,Iz,{transform(t,e){const n=~(t.ignore||0),i=t.filter,r=i.mask;if(0==(r&n))return e.StopPropagation;const o=e.fork(e.ALL),a=i.data(),s=i.curr(),l=i.prev(),u=t=>s[t]&n?null:a[t];return o.filter(o.MOD,u),r&r-1?(o.filter(o.ADD,(t=>{const e=s[t]&n;return!e&&e^l[t]&n?a[t]:null})),o.filter(o.REM,(t=>{const e=s[t]&n;return e&&!(e^e^l[t]&n)?a[t]:null}))):(o.filter(o.ADD,u),o.filter(o.REM,(t=>(s[t]&n)===r?a[t]:null))),o.filter(o.SOURCE,(t=>u(t._index)))}});var R6=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",crossfilter:O6,resolvefilter:F6});function L6(t){this.type=t}var $6,P6,z6,B6,V6;L6.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1};($6={})[1]="Boolean",$6[2]="<end>",$6[3]="Identifier",$6[4]="Keyword",$6[5]="Null",$6[6]="Numeric",$6[7]="Punctuator",$6[8]="String",$6[9]="RegularExpression";var W6=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),j6=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function U6(t,e){if(!t)throw new Error("ASSERT: "+e)}function G6(t){return t>=48&&t<=57}function H6(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function q6(t){return"01234567".indexOf(t)>=0}function X6(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function Y6(t){return 10===t||13===t||8232===t||8233===t}function K6(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&W6.test(String.fromCharCode(t))}function Z6(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&j6.test(String.fromCharCode(t))}const J6={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Q6(){for(;z6<B6;){const t=P6.charCodeAt(z6);if(!X6(t)&&!Y6(t))break;++z6}}function t8(t){var e,n,i,r=0;for(n="u"===t?4:2,e=0;e<n;++e)z6<B6&&H6(P6[z6])?(i=P6[z6++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):m8({},"Unexpected token %0","ILLEGAL");return String.fromCharCode(r)}function e8(){var t,e,n,i;for(e=0,"}"===(t=P6[z6])&&m8({},"Unexpected token %0","ILLEGAL");z6<B6&&H6(t=P6[z6++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&m8({},"Unexpected token %0","ILLEGAL"),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),i=56320+(e-65536&1023),String.fromCharCode(n,i))}function n8(){var t,e;for(t=P6.charCodeAt(z6++),e=String.fromCharCode(t),92===t&&(117!==P6.charCodeAt(z6)&&m8({},"Unexpected token %0","ILLEGAL"),++z6,(t=t8("u"))&&"\\"!==t&&K6(t.charCodeAt(0))||m8({},"Unexpected token %0","ILLEGAL"),e=t);z6<B6&&Z6(t=P6.charCodeAt(z6));)++z6,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==P6.charCodeAt(z6)&&m8({},"Unexpected token %0","ILLEGAL"),++z6,(t=t8("u"))&&"\\"!==t&&Z6(t.charCodeAt(0))||m8({},"Unexpected token %0","ILLEGAL"),e+=t);return e}function i8(){var t,e;return t=z6,{type:1===(e=92===P6.charCodeAt(z6)?n8():function(){var t,e;for(t=z6++;z6<B6;){if(92===(e=P6.charCodeAt(z6)))return z6=t,n8();if(!Z6(e))break;++z6}return P6.slice(t,z6)}()).length?3:J6.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:z6}}function r8(){var t,e,n,i,r=z6,o=P6.charCodeAt(z6),a=P6[z6];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++z6,{type:7,value:String.fromCharCode(o),start:r,end:z6};default:if(61===(t=P6.charCodeAt(z6+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return z6+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(t),start:r,end:z6};case 33:case 61:return z6+=2,61===P6.charCodeAt(z6)&&++z6,{type:7,value:P6.slice(r,z6),start:r,end:z6}}}return">>>="===(i=P6.substr(z6,4))?{type:7,value:i,start:r,end:z6+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:z6+=3}:a===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===e?{type:7,value:e,start:r,end:z6+=2}:("//"===e&&m8({},"Unexpected token %0","ILLEGAL"),"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:r,end:++z6}:void m8({},"Unexpected token %0","ILLEGAL"))}function o8(){var t,e,n;if(U6(G6((n=P6[z6]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=z6,t="","."!==n){if(t=P6[z6++],n=P6[z6],"0"===t){if("x"===n||"X"===n)return++z6,function(t){let e="";for(;z6<B6&&H6(P6[z6]);)e+=P6[z6++];return 0===e.length&&m8({},"Unexpected token %0","ILLEGAL"),K6(P6.charCodeAt(z6))&&m8({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt("0x"+e,16),start:t,end:z6}}(e);if(q6(n))return function(t){let e="0"+P6[z6++];for(;z6<B6&&q6(P6[z6]);)e+=P6[z6++];return(K6(P6.charCodeAt(z6))||G6(P6.charCodeAt(z6)))&&m8({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt(e,8),octal:!0,start:t,end:z6}}(e);n&&G6(n.charCodeAt(0))&&m8({},"Unexpected token %0","ILLEGAL")}for(;G6(P6.charCodeAt(z6));)t+=P6[z6++];n=P6[z6]}if("."===n){for(t+=P6[z6++];G6(P6.charCodeAt(z6));)t+=P6[z6++];n=P6[z6]}if("e"===n||"E"===n)if(t+=P6[z6++],"+"!==(n=P6[z6])&&"-"!==n||(t+=P6[z6++]),G6(P6.charCodeAt(z6)))for(;G6(P6.charCodeAt(z6));)t+=P6[z6++];else m8({},"Unexpected token %0","ILLEGAL");return K6(P6.charCodeAt(z6))&&m8({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseFloat(t),start:e,end:z6}}function a8(){var t,e,n,i;return V6=null,Q6(),t=z6,e=function(){var t,e,n,i;for(U6("/"===(t=P6[z6]),"Regular expression literal must start with a slash"),e=P6[z6++],n=!1,i=!1;z6<B6;)if(e+=t=P6[z6++],"\\"===t)Y6((t=P6[z6++]).charCodeAt(0))&&m8({},"Invalid regular expression: missing /"),e+=t;else if(Y6(t.charCodeAt(0)))m8({},"Invalid regular expression: missing /");else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||m8({},"Invalid regular expression: missing /"),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";z6<B6&&Z6((t=P6[z6]).charCodeAt(0));)++z6,"\\"===t&&z6<B6?m8({},"Unexpected token %0","ILLEGAL"):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&m8({},"Invalid regular expression",n),{value:n,literal:e}}(),i=function(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111)return"x";m8({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){m8({},"Invalid regular expression")}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:z6}}function s8(){if(Q6(),z6>=B6)return{type:2,start:z6,end:z6};const t=P6.charCodeAt(z6);return K6(t)?i8():40===t||41===t||59===t?r8():39===t||34===t?function(){var t,e,n,i,r="",o=!1;for(U6("'"===(t=P6[z6])||'"'===t,"String literal must starts with a quote"),e=z6,++z6;z6<B6;){if((n=P6[z6++])===t){t="";break}if("\\"===n)if((n=P6[z6++])&&Y6(n.charCodeAt(0)))"\r"===n&&"\n"===P6[z6]&&++z6;else switch(n){case"u":case"x":"{"===P6[z6]?(++z6,r+=e8()):r+=t8(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:q6(n)?(0!==(i="01234567".indexOf(n))&&(o=!0),z6<B6&&q6(P6[z6])&&(o=!0,i=8*i+"01234567".indexOf(P6[z6++]),"0123".indexOf(n)>=0&&z6<B6&&q6(P6[z6])&&(i=8*i+"01234567".indexOf(P6[z6++]))),r+=String.fromCharCode(i)):r+=n}else{if(Y6(n.charCodeAt(0)))break;r+=n}}return""!==t&&m8({},"Unexpected token %0","ILLEGAL"),{type:8,value:r,octal:o,start:e,end:z6}}():46===t?G6(P6.charCodeAt(z6+1))?o8():r8():G6(t)?o8():r8()}function l8(){const t=V6;return z6=t.end,V6=s8(),z6=t.end,t}function u8(){const t=z6;V6=s8(),z6=t}function c8(t,e,n){const i=new L6("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function h8(t,e){const n=new L6("CallExpression");return n.callee=t,n.arguments=e,n}function d8(t){const e=new L6("Identifier");return e.name=t,e}function p8(t){const e=new L6("Literal");return e.value=t.value,e.raw=P6.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function f8(t,e,n){const i=new L6("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function g8(t,e,n){const i=new L6("Property");return i.key=e,i.value=n,i.kind=t,i}function m8(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,((t,e)=>(U6(e<i.length,"Message reference must be in range"),i[e])));throw(n=new Error(r)).index=z6,n.description=r,n}function y8(t){2===t.type&&m8(t,"Unexpected end of input"),6===t.type&&m8(t,"Unexpected number"),8===t.type&&m8(t,"Unexpected string"),3===t.type&&m8(t,"Unexpected identifier"),4===t.type&&m8(t,"Unexpected reserved word"),m8(t,"Unexpected token %0",t.value)}function v8(t){const e=l8();7===e.type&&e.value===t||y8(e)}function x8(t){return 7===V6.type&&V6.value===t}function b8(t){return 4===V6.type&&V6.value===t}function w8(){const t=[];for(z6=V6.start,v8("[");!x8("]");)x8(",")?(l8(),t.push(null)):(t.push(O8()),x8("]")||v8(","));return l8(),function(t){const e=new L6("ArrayExpression");return e.elements=t,e}(t)}function _8(){z6=V6.start;const t=l8();return 8===t.type||6===t.type?(t.octal&&m8(t,"Octal literals are not allowed in strict mode."),p8(t)):d8(t.value)}function k8(){var t,e,n;return z6=V6.start,3===(t=V6).type?(n=_8(),v8(":"),g8("init",n,O8())):2!==t.type&&7!==t.type?(e=_8(),v8(":"),g8("init",e,O8())):void y8(t)}function S8(){var t,e,n=[],i={},r=String;for(z6=V6.start,v8("{");!x8("}");)e="$"+("Identifier"===(t=k8()).key.type?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?m8({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),x8("}")||v8(",");return v8("}"),function(t){const e=new L6("ObjectExpression");return e.properties=t,e}(n)}const C8={if:1};function A8(){var t,e,n;if(x8("("))return function(){v8("(");const t=F8();return v8(")"),t}();if(x8("["))return w8();if(x8("{"))return S8();if(t=V6.type,z6=V6.start,3===t||C8[V6.value])n=d8(l8().value);else if(8===t||6===t)V6.octal&&m8(V6,"Octal literals are not allowed in strict mode."),n=p8(l8());else{if(4===t)throw new Error("Disabled.");1===t?((e=l8()).value="true"===e.value,n=p8(e)):5===t?((e=l8()).value=null,n=p8(e)):x8("/")||x8("/=")?(n=p8(a8()),u8()):y8(l8())}return n}function I8(){const t=[];if(v8("("),!x8(")"))for(;z6<B6&&(t.push(O8()),!x8(")"));)v8(",");return v8(")"),t}function M8(){return v8("."),function(){z6=V6.start;const t=l8();return function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t)||y8(t),d8(t.value)}()}function D8(){v8("[");const t=F8();return v8("]"),t}function T8(){const t=function(){var t;for(t=A8();;)if(x8("."))t=f8(".",t,M8());else if(x8("("))t=h8(t,I8());else{if(!x8("["))break;t=f8("[",t,D8())}return t}();if(7===V6.type&&(x8("++")||x8("--")))throw new Error("Disabled.");return t}function E8(){var t,e;if(7!==V6.type&&4!==V6.type)e=T8();else{if(x8("++")||x8("--"))throw new Error("Disabled.");if(x8("+")||x8("-")||x8("~")||x8("!"))t=l8(),e=E8(),e=function(t,e){const n=new L6("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(b8("delete")||b8("void")||b8("typeof"))throw new Error("Disabled.");e=T8()}}return e}function N8(t){let e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function O8(){var t,e;return t=function(){var t,e,n,i,r,o,a,s,l,u;if(t=V6,l=E8(),0===(r=N8(i=V6)))return l;for(i.prec=r,l8(),e=[t,V6],o=[l,i,a=E8()];(r=N8(V6))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,l=o.pop(),e.pop(),n=c8(s,l,a),o.push(n);(i=l8()).prec=r,o.push(i),e.push(V6),n=E8(),o.push(n)}for(n=o[u=o.length-1],e.pop();u>1;)e.pop(),n=c8(o[u-1].value,o[u-2],n),u-=2;return n}(),x8("?")&&(l8(),e=O8(),v8(":"),t=function(t,e,n){const i=new L6("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,O8())),t}function F8(){const t=O8();if(x8(","))throw new Error("Disabled.");return t}function R8(t){z6=0,B6=(P6=t).length,V6=null,u8();const e=F8();if(2!==V6.type)throw new Error("Unexpect token after expression.");return e}var L8={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function $8(t){function e(e,n,i){return r=>function(e,n,i,r){let o=t(n[0]);return i&&(o=i+"("+o+")",0===i.lastIndexOf("new ",0)&&(o="("+o+")")),o+"."+e+(r<0?"":0===r?"()":"("+n.slice(1).map(t).join(",")+")")}(e,r,n,i)}const n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&ON("Missing arguments to clamp function."),e.length>3&&ON("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",i,0),lower:e("toLowerCase",i,0),substring:e("substring",i),split:e("split",i),trim:e("trim",i,0),regexp:r,test:e("test",r),if:function(e){e.length<3&&ON("Missing arguments to if function."),e.length>3&&ON("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function P8(t){const e=(t=t||{}).allowed?QO(t.allowed):{},n=t.forbidden?QO(t.forbidden):{},i=t.constants||L8,r=(t.functions||$8)(h),o=t.globalvar,a=t.fieldvar,s=yO(o)?o:t=>"".concat(o,'["').concat(t,'"]');let l={},u={},c=0;function h(t){if(BO(t))return t;const e=d[t.type];return null==e&&ON("Unsupported type: "+t.type),e(t)}const d={Literal:t=>t.raw,Identifier:t=>{const r=t.name;return c>0?r:DO(n,r)?ON("Illegal identifier: "+r):DO(i,r)?i[r]:DO(e,r)?r:(l[r]=1,s(r))},MemberExpression:t=>{const e=!t.computed,n=h(t.object);e&&(c+=1);const i=h(t.property);return n===a&&(u[function(t){const e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(i)]=1),e&&(c-=1),n+(e?"."+i:"["+i+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&ON("Illegal callee type: "+t.callee.type);const e=t.callee.name,n=t.arguments,i=DO(r,e)&&r[e];return i||ON("Unrecognized function: "+e),yO(i)?i(n):i+"("+n.map(h).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(h).join(",")+"]",BinaryExpression:t=>"("+h(t.left)+" "+t.operator+" "+h(t.right)+")",UnaryExpression:t=>"("+t.operator+h(t.argument)+")",ConditionalExpression:t=>"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")",LogicalExpression:t=>"("+h(t.left)+t.operator+h(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(h).join(",")+"}",Property:t=>{c+=1;const e=h(t.key);return c-=1,e+":"+h(t.value)}};function p(t){const e={code:h(t),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},e}return p.functions=r,p.constants=i,p}function z8(t,e){for(var n,i,r=e.fields,o=e.values,a=r.length,s=0;s<a;++s)if((i=r[s]).getter=RN.getter||RN(i.field),LO(n=i.getter(t))&&(n=ZN(n)),LO(o[s])&&(o[s]=ZN(o[s])),LO(o[s][0])&&(o[s]=o[s].map(ZN)),"E"===i.type){if(UN(o[s])?o[s].indexOf(n)<0:n!==o[s])return!1}else if("R"===i.type){if(!FO(n,o[s]))return!1}else if("R-RE"===i.type){if(!FO(n,o[s],!0,!1))return!1}else if("R-E"===i.type){if(!FO(n,o[s],!1,!1))return!1}else if("R-LE"===i.type&&!FO(n,o[s],!1,!0))return!1;return!0}const B8=RN("_vgsid_"),V8=function(t){let e=t,n=t;function i(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)<0?i=o+1:r=o}return i}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>{return(i=t(e))<(r=n)?-1:i>r?1:i>=r?0:NaN;var i,r}}(t)),{left:i,center:function(t,n,r,o){null==r&&(r=0),null==o&&(o=t.length);const a=i(t,n,r,o-1);return a>r&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)>0?r=o:i=o+1}return i}}}(B8),W8=V8.left,j8=V8.right;var U8={E_union:function(t,e){if(!t.length)return e;for(var n=0,i=e.length;n<i;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((t=>e.indexOf(t)>=0)):e},R_union:function(t,e){var n=ZN(e[0]),i=ZN(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<i&&(t[1]=i),t):[n,i]},R_intersect:function(t,e){var n=ZN(e[0]),i=ZN(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?i<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>i&&(t[1]=i),t):[n,i]}};function G8(t,e,n,i){"Literal"!==e[0].type&&ON("First argument to selection functions must be a string literal.");const r=e[0].value,o="unit",a="@unit",s=":"+r;"intersect"!==(e.length>=2&&KN(e).value)||DO(i,a)||(i["@unit"]=n.getData(r).indataRef(n,o)),DO(i,s)||(i[s]=n.getData(r).tuplesRef())}function H8(t){const e=this.context.data[t];return e?e.values.value:[]}const q8=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},X8=q8("format"),Y8=q8("timeFormat"),K8=q8("utcFormat"),Z8=q8("timeParse"),J8=q8("utcParse"),Q8=new Date(2e3,0,1);function t9(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(Q8.setYear(2e3),Q8.setMonth(t),Q8.setDate(e),Y8.call(this,Q8,n)):""}function e9(t,e,n,i){"Literal"!==e[0].type&&ON("First argument to data functions must be a string literal.");const r=e[0].value,o=":"+r;if(!DO(o,i))try{i[o]=n.getData(r).tuplesRef()}catch(t){}}function n9(t,e,n,i){if("Literal"===e[0].type)i9(n,i,e[0].value);else for(t in n.scales)i9(n,i,t)}function i9(t,e,n){const i="%"+n;if(!DO(e,i))try{e[i]=t.scaleRef(n)}catch(t){}}function r9(t,e){let n;return yO(t)?t:BO(t)?(n=e.scales[t])&&n.value:void 0}function o9(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=n9,n._range=n9,n._scale=n9;const i=e=>"_["+("Literal"===e.type?XO("%"+e.value):XO("%")+"+"+t(e))+"]";return{_bandwidth:t=>"this.__bandwidth(".concat(i(t[0]),")"),_range:t=>"".concat(i(t[0]),".range()"),_scale:e=>"".concat(i(e[0]),"(").concat(t(e[1]),")")}}function a9(t,e){return function(n,i,r){if(n){const e=r9(n,(r||this).context);return e&&e.path[t](i)}return e(i)}}const s9=a9("area",(function(t){return yQ=new HF,QJ(t,vQ),2*yQ})),l9=a9("bounds",(function(t){var e,n,i,r,o,a,s;if(lQ=sQ=-(oQ=aQ=1/0),fQ=[],QJ(t,HQ),n=fQ.length){for(fQ.sort(e0),e=1,o=[i=fQ[0]];e<n;++e)n0(i,(r=fQ[e])[0])||n0(i,r[1])?(t0(i[0],r[1])>t0(i[0],i[1])&&(i[1]=r[1]),t0(r[0],i[1])>t0(i[0],i[1])&&(i[0]=r[0])):o.push(i=r);for(a=-1/0,e=0,i=o[n=o.length-1];e<=n;i=r,++e)r=o[e],(s=t0(i[1],r[0]))>a&&(a=s,oQ=r[0],sQ=i[1])}return fQ=gQ=null,oQ===1/0||aQ===1/0?[[NaN,NaN],[NaN,NaN]]:[[oQ,aQ],[sQ,lQ]]})),u9=a9("centroid",(function(t){TQ=EQ=NQ=OQ=FQ=RQ=LQ=$Q=0,PQ=new HF,zQ=new HF,BQ=new HF,QJ(t,i0);var e=+PQ,n=+zQ,i=+BQ,r=PJ(e,n,i);return r<1e-12&&(e=RQ,n=LQ,i=$Q,EQ<1e-6&&(e=NQ,n=OQ,i=FQ),(r=PJ(e,n,i))<1e-12)?[NaN,NaN]:[FJ(n,e)*TJ,HJ(i/r)*TJ]}));function c9(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function h9(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function d9(t){const e=Ej(t);return.2126*h9(e.r)+.7152*h9(e.g)+.0722*h9(e.b)}function p9(t,e){return t===e||t!=t&&e!=e||(UN(t)?!(!UN(e)||t.length!==e.length)&&function(t,e){for(let n=0,i=t.length;n<i;++n)if(!p9(t[n],e[n]))return!1;return!0}(t,e):!(!GN(t)||!GN(e))&&f9(t,e))}function f9(t,e){for(const n in t)if(!p9(t[n],e[n]))return!1;return!0}function g9(t){return e=>f9(t,e)}const m9={};function y9(t){return UN(t)||ArrayBuffer.isView(t)?t:null}function v9(t){return y9(t)||(BO(t)?t:null)}const x9=t=>t.data;function b9(t,e){const n=H8.call(e,t);return n.root&&n.root.lookup||{}}const w9=()=>"undefined"!=typeof window&&window||null;const _9={random:()=>Lz(),cumulativeNormal:Uz,cumulativeLogNormal:Kz,cumulativeUniform:nB,densityNormal:jz,densityLogNormal:Yz,densityUniform:eB,quantileNormal:Gz,quantileLogNormal:Zz,quantileUniform:iB,sampleNormal:Wz,sampleLogNormal:Xz,sampleUniform:tB,isArray:UN,isBoolean:RO,isDate:LO,isDefined:t=>void 0!==t,isNumber:PO,isObject:GN,isRegExp:zO,isString:BO,isTuple:XP,isValid:t=>null!=t&&t==t,toBoolean:YO,toDate:ZO,toNumber:ZN,toString:JO,indexof:function(t,...e){return v9(t).indexOf(...e)},join:function(t,...e){return y9(t).join(...e)},lastindexof:function(t,...e){return v9(t).lastIndexOf(...e)},replace:function(t,e,n){return yO(n)&&ON("Function argument passed to replace."),String(t).replace(e,n)},reverse:function(t){return y9(t).slice().reverse()},slice:function(t,...e){return v9(t).slice(...e)},flush:NO,lerp:WO,merge:function(){const t=[].slice.call(arguments);return t.unshift({}),CO(...t)},pad:HO,peek:KN,pluck:function(t,e){const n=m9[e]||(m9[e]=RN(e));return UN(t)?t.map(n):n(t)},span:qO,inrange:FO,truncate:tF,rgb:Ej,lab:qj,hcl:tU,hsl:Pj,luminance:d9,contrast:function(t,e){const n=d9(t),i=d9(e);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:sR,format:X8,utcFormat:K8,utcParse:J8,utcOffset:BL,utcSequence:jL,timeFormat:Y8,timeParse:Z8,timeOffset:zL,timeSequence:WL,timeUnitSpecifier:hL,monthFormat:function(t){return t9.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return t9.call(this,t,1,"%b")},dayFormat:function(t){return t9.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return t9.call(this,0,2+t,"%a")},quarter:pO,utcquarter:fO,week:gL,utcweek:wL,dayofyear:fL,utcdayofyear:bL,warn:function(){return c9(this.context.dataflow,"warn",arguments)},info:function(){return c9(this.context.dataflow,"info",arguments)},debug:function(){return c9(this.context.dataflow,"debug",arguments)},extent:AO,inScope:function(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:function(t,e,n){if(!t)return[];const[i,r]=t,o=(new Qq).set(i[0],i[1],r[0],r[1]);return uZ(n||this.context.dataflow.scenegraph().root,o,function(t){let e=null;if(t){const n=gO(t.marktype),i=gO(t.markname);e=t=>(!n.length||n.some((e=>t.marktype===e)))&&(!i.length||i.some((e=>t.name===e)))}return e}(e))},clampRange:mO,pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+i*i)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=w9();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=w9();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return rH(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow,i=this.context.data[t].input;return n.pulse(i,n.changeset().remove(BN).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?_q(n,e=e||hq(t)):t}},panLinear:rO,panLog:oO,panPow:aO,panSymlog:sO,zoomLinear:uO,zoomLog:cO,zoomPow:hO,zoomSymlog:dO,encode:function(t,e,n){if(t){const n=this.context.dataflow,i=t.mark.source;n.pulse(i,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,i,r,o){const a=this.context.dataflow,s=this.context.data[t],l=s.input,u=a.stamp();let c,h,d=s.changes;if(!1===a._trigger||!(l.value.length||e||i))return 0;if((!d||d.stamp<u)&&(s.changes=d=a.changeset(),d.stamp=u,a.runAfter((()=>{s.modified=!0,a.pulse(l,d).run()}),!0,1)),n&&(c=!0===n?BN:UN(n)||XP(n)?n:g9(n),d.remove(c)),e&&d.insert(e),i&&(c=g9(i),l.value.some(c)?d.remove(c):d.insert(i)),r)for(h in o)d.modify(r,h,o[h]);return 1}},k9=["view","item","group","xy","x","y"],S9={},C9={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>"_[".concat(XO("$"+t),"]"),functions:function(t){const e=$8(t);k9.forEach((t=>e[t]="event.vega."+t));for(const t in _9)e[t]="this."+t;return CO(e,o9(t,_9,S9)),e},constants:L8,visitors:S9},A9=P8(C9);function I9(t,e,n){return 1===arguments.length?_9[t]:(_9[t]=e,n&&(S9[t]=n),A9&&(A9.functions[t]="this."+t),this)}function M9(t,e){const n={};let i;try{i=R8(t=BO(t)?t:XO(t)+"")}catch(e){ON("Expression parse error: "+t)}i.visit((t=>{if("CallExpression"!==t.type)return;const i=t.callee.name,r=C9.visitors[i];r&&r(i,t.arguments,e,n)}));const r=A9(i);return r.globals.forEach((t=>{const i="$"+t;!DO(n,i)&&e.getSignal(t)&&(n[i]=e.signalRef(t))})),{$expr:CO({code:r.code},e.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}I9("bandwidth",(function(t,e){const n=r9(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),n9),I9("copy",(function(t,e){const n=r9(t,(e||this).context);return n?n.copy():void 0}),n9),I9("domain",(function(t,e){const n=r9(t,(e||this).context);return n?n.domain():[]}),n9),I9("range",(function(t,e){const n=r9(t,(e||this).context);return n&&n.range?n.range():[]}),n9),I9("invert",(function(t,e,n){const i=r9(t,(n||this).context);return i?UN(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e):void 0}),n9),I9("scale",(function(t,e,n){const i=r9(t,(n||this).context);return i?i(e):void 0}),n9),I9("gradient",(function(t,e,n,i,r){t=r9(t,(r||this).context);const o=aq(e,n);let a=t.domain(),s=a[0],l=KN(a),u=$N;return l-s?u=EH(t,s,l):t=(t.interpolator?vH("sequential")().interpolator(t.interpolator()):vH("linear")().interpolate(t.interpolate()).range(t.range())).domain([s=0,l=1]),t.ticks&&(a=t.ticks(+i||15),s!==a[0]&&a.unshift(s),l!==KN(a)&&a.push(l)),a.forEach((e=>o.stop(u(e),t(e)))),o}),n9),I9("geoArea",s9,n9),I9("geoBounds",l9,n9),I9("geoCentroid",u9,n9),I9("geoShape",(function(t,e,n){const i=r9(t,(n||this).context);return function(t){return i?i.path.context(t)(e):""}}),n9),I9("indata",(function(t,e,n){const i=this.context.data[t]["index:"+e],r=i?i.value.get(n):void 0;return r?r.count:r}),(function(t,e,n,i){"Literal"!==e[0].type&&ON("First argument to indata must be a string literal."),"Literal"!==e[1].type&&ON("Second argument to indata must be a string literal.");const r=e[0].value,o=e[1].value,a="@"+o;DO(a,i)||(i[a]=n.getData(r).indataRef(n,o))})),I9("data",H8,e9),I9("treePath",(function(t,e,n){const i=b9(t,this),r=i[e],o=i[n];return r&&o?r.path(o).map(x9):void 0}),e9),I9("treeAncestors",(function(t,e){const n=b9(t,this)[e];return n?n.ancestors().map(x9):void 0}),e9),I9("vlSelectionTest",(function(t,e,n){for(var i,r,o,a,s,l=this.context.data[t],u=l?l.values.value:[],c=l?l["index:unit"]&&l["index:unit"].value:void 0,h="intersect"===n,d=u.length,p=0;p<d;++p)if(i=u[p],c&&h){if(-1===(o=(r=r||{})[a=i.unit]||0))continue;if(s=z8(e,i),r[a]=s?-1:++o,s&&1===c.size)return!0;if(!s&&o===c.get(a).count)return!1}else if(h^(s=z8(e,i)))return s;return d&&h}),G8),I9("vlSelectionIdTest",(function(t,e,n){const i=this.context.data[t],r=i?i.values.value:[],o=i?i["index:unit"]&&i["index:unit"].value:void 0,a="intersect"===n,s=B8(e),l=W8(r,s);if(l===r.length)return!1;if(B8(r[l])!==s)return!1;if(o&&a){if(1===o.size)return!0;if(j8(r,s)-l<o.size)return!1}return!0}),G8),I9("vlSelectionResolve",(function(t,e,n,i){for(var r,o,a,s,l,u,c,h,d,p,f,g=this.context.data[t],m=g?g.values.value:[],y={},v={},x={},b=m.length,w=0;w<b;++w){for(s=(r=m[w]).unit,o=r.fields,a=r.values,p=0,f=o.length;p<f;++p)l=o[p],c=(u=y[l.field]||(y[l.field]={}))[s]||(u[s]=[]),x[l.field]=h=l.type.charAt(0),d=U8[h+"_union"],u[s]=d(c,gO(a[p]));n&&(c=v[s]||(v[s]=[])).push(gO(a).reduce(((t,e,n)=>(t[o[n].field]=e,t)),{}))}if(e=e||"union",Object.keys(y).forEach((t=>{y[t]=Object.keys(y[t]).map((e=>y[t][e])).reduce(((n,i)=>void 0===n?i:U8[x[t]+"_"+e](n,i)))})),m=Object.keys(v),n&&m.length){y[i?"vlPoint":"vlMulti"]="union"===e?{or:m.reduce(((t,e)=>(t.push(...v[e]),t)),[])}:{and:m.map((t=>({or:v[t]})))}}return y}),G8),I9("vlSelectionTuples",(function(t,e){return t.map((t=>CO({values:e.fields.map((e=>(e.getter||(e.getter=RN(e.field)))(t.datum)))},e)))}));const D9=QO(["rule"]),T9=QO(["group","image","rect"]);function E9(t){return(t+"").toLowerCase()}function N9(t,e,n){";"!==n[n.length-1]&&(n="return("+n+");");const i=Function(...e.concat(n));return t&&t.functions?i.bind(t.functions):i}var O9={operator:(t,e)=>N9(t,["_"],e.code),parameter:(t,e)=>N9(t,["datum","_"],e.code),event:(t,e)=>N9(t,["event"],e.code),handler:(t,e)=>N9(t,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(e.code,";")),encode:(t,e)=>{const{marktype:n,channels:i}=e;let r="var o=item,datum=o.datum,m=0,$;";for(const t in i){const e="o["+XO(t)+"]";r+="$=".concat(i[t].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return r+=function(t,e){let n="";return D9[e]||(t.x2&&(t.x?(T9[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(T9[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(i,n),r+="return m;",N9(t,["item","_"],r)},codegen:{get(t){const e="[".concat(t.map(XO).join("]["),"]"),n=Function("_","return _".concat(e,";"));return n.path=e,n},comparator(t,e){let n;const i=Function("a","b","var u, v; return "+t.map(((t,i)=>{const r=e[i];let o,a;return t.path?(o="a".concat(t.path),a="b".concat(t.path)):((n=n||{})["f"+i]=t,o="this.f".concat(i,"(a)"),a="this.f".concat(i,"(b)")),function(t,e,n,i){return"((u = ".concat(t,") < (v = ").concat(e,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(i,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(i," : ")}(o,a,-r,r)})).join("")+"0;");return n?i.bind(n):i}}};function F9(t,e,n){if(!t||!GN(t))return t;for(let i,r=0,o=R9.length;r<o;++r)if(i=R9[r],DO(t,i.key))return i.parse(t,e,n);return t}var R9=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||ON("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=VO(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,e,n){t.$params&&e.parseParameters(t.$params,n);const i="e:"+t.$expr.code+"_"+t.$name;return e.fn[i]||(e.fn[i]=IN(e.parameterExpression(t.$expr),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=RN(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,e){const n=t.$encode,i={};for(const t in n){const r=n[t];i[t]=IN(e.encodeExpression(r.$expr),r.$fields),i[t].output=r.$output}return i}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,i=gO(t.$compare).map((t=>t&&t.$tupleid?YP:t));return e.fn[n]||(e.fn[n]=vO(i,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,i,r){const o=e.fork().parse(n),a=o.get(n.operators[0].id),s=o.signals.parent;return s&&s.set(r),a.detachSubflow=()=>e.detach(o),a}}},{key:"$tupleid",parse:function(){return YP}}];const L9={skip:!0};function $9(t,e,n,i){return new P9(t,e,n,i)}function P9(t,e,n,i){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=i||O9,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function z9(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function B9(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}P9.prototype=z9.prototype={fork(){const t=new z9(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter((e=>e!==t));const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,i=n.dataflow,r=t.value;if(n.set(t.id,e),"collect"===E9(t.type)&&r&&(r.$ingest?i.ingest(e,r.$ingest,r.$format):r.$request?i.preload(e,r.$request,r.$format):i.pulse(e,i.changeset().insert(r))),t.root&&(n.root=e),t.parent){let r=n.get(t.parent.$ref);r?(i.connect(r,[e]),e.targets().add(r)):(n.unresolved=n.unresolved||[]).push((()=>{r=n.get(t.parent.$ref),i.connect(r,[e]),e.targets().add(r)}))}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const i in t.data){const r=n.data[i]||(n.data[i]={});t.data[i].forEach((t=>r[t]=e))}},resolve(){return(this.unresolved||[]).forEach((t=>t())),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[E9(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,i,r){this.dataflow.on(e,n,i,r,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach((t=>e.parseOperator(t))),n.forEach((t=>e.parseOperatorParameters(t))),(t.streams||[]).forEach((t=>e.parseStream(t))),(t.updates||[]).forEach((t=>e.parseUpdate(t))),e.resolve()},parseOperator:function(t){const e=this;"operator"!==E9(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?e.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||ON("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const i in t){const r=t[i];e[i]=UN(r)?r.map((t=>F9(t,n,e))):F9(r,n,e)}return e},parseStream:function(t){var e,n=this,i=null!=t.filter?n.eventExpression(t.filter):void 0,r=null!=t.stream?n.get(t.stream):void 0;t.source?r=n.events(t.source,t.type,i):t.merge&&(r=(e=t.merge.map((t=>n.get(t))))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map((t=>n.get(t))),r=r.between(e[0],e[1])),t.filter&&(r=r.filter(i)),null!=t.throttle&&(r=r.throttle(+t.throttle)),null!=t.debounce&&(r=r.debounce(+t.debounce)),null==r&&ON("Invalid stream definition: "+JSON.stringify(t)),t.consume&&r.consume(!0),n.stream(t,r)},parseUpdate:function(t){var e,n=this,i=GN(i=t.source)?i.$ref:i,r=n.get(i),o=t.update,a=void 0;r||ON("Source not defined: "+t.source),e=t.target&&t.target.$expr?n.eventExpression(t.target.$expr):n.get(t.target),o&&o.$expr&&(o.$params&&(a=n.parseParameters(o.$params)),o=n.handlerExpression(o.$expr)),n.update(t,r,e,o,a)},getState:function(t){var e=this,n={};if(t.signals){var i=n.signals={};Object.keys(e.signals).forEach((n=>{const r=e.signals[n];t.signals(n,r)&&(i[n]=r.value)}))}if(t.data){var r=n.data={};Object.keys(e.data).forEach((n=>{const i=e.data[n];t.data(n,i)&&(r[n]=i.input.value)}))}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map((e=>e.getState(t)))),n},setState:function(t){var e=this,n=e.dataflow,i=t.data,r=t.signals;Object.keys(r||{}).forEach((t=>{n.update(e.signals[t],r[t],L9)})),Object.keys(i||{}).forEach((t=>{n.pulse(e.data[t].input,n.changeset().remove(BN).insert(i[t]))})),(t.subcontext||[]).forEach(((t,n)=>{const i=e.subcontext[n];i&&i.setState(t)}))}};function V9(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function W9(t,e){var n=t._runtime.data;return DO(n,e)||ON("Unrecognized data set: "+e),n[e]}function j9(t,e){nz(e)||ON("Second argument to changes must be a changeset.");const n=W9(this,t);return n.modified=!0,this.pulse(n.input,e)}function U9(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function G9(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function H9(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function q9(t,e,n){var i,r,o=t._renderer,a=o&&o.canvas();return a&&(r=H9(t),(i=lK(e.changedTouches?e.changedTouches[0]:e,a))[0]-=r[0],i[1]-=r[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){const i=e?"group"===e.mark.marktype?e:e.mark.group:null;function r(t){var n,r=i;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){r=n;break}return r&&r.mark&&r.mark.interactive?r:{}}function o(t){if(!t)return n;BO(t)&&(t=r(t));const e=n.slice();for(;t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:kO(t),item:kO(e||{}),group:r,xy:o,x:t=>o(t)[0],y:t=>o(t)[1]}}(t,n,i),e}const X9={trap:!1};function Y9(t,e,n,i){t._eventListeners.push({type:n,sources:gO(e),handler:i})}function K9(t,e,n){const i=t._eventConfig&&t._eventConfig[e];return!(!1===i||GN(i)&&!i[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function Z9(t){return t.item}function J9(t){return t.item.mark.source}function Q9(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function t7(t,e,n){const i=document.createElement(t);for(const t in e)i.setAttribute(t,e[t]);return null!=n&&(i.textContent=n),i}function e7(t,e,n,i){const r=n.event||"input",o=()=>t.update(e.value);i.signal(n.signal,e.value),e.addEventListener(r,o),Y9(i,e,r,o),t.set=t=>{e.value=t,e.dispatchEvent(function(t){return"undefined"!=typeof Event?new Event(t):{type:t}}(r))}}function n7(t,e,n,i){const r=i.signal(n.signal),o=t7("div",{class:"vega-bind"}),a="radio"===n.input?o:o.appendChild(t7("label"));a.appendChild(t7("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(o);let s=i7;switch(n.input){case"checkbox":s=r7;break;case"select":s=o7;break;case"radio":s=a7;break;case"range":s=s7}s(t,a,n,r)}function i7(t,e,n,i){const r=t7("input");for(const t in n)"signal"!==t&&"element"!==t&&r.setAttribute("input"===t?"type":t,n[t]);r.setAttribute("name",n.signal),r.value=i,e.appendChild(r),r.addEventListener("input",(()=>t.update(r.value))),t.elements=[r],t.set=t=>r.value=t}function r7(t,e,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const o=t7("input",r);e.appendChild(o),o.addEventListener("change",(()=>t.update(o.checked))),t.elements=[o],t.set=t=>o.checked=!!t||null}function o7(t,e,n,i){const r=t7("select",{name:n.signal}),o=n.labels||[];n.options.forEach(((t,e)=>{const n={value:t};l7(t,i)&&(n.selected=!0),r.appendChild(t7("option",n,(o[e]||t)+""))})),e.appendChild(r),r.addEventListener("change",(()=>{t.update(n.options[r.selectedIndex])})),t.elements=[r],t.set=t=>{for(let e=0,i=n.options.length;e<i;++e)if(l7(n.options[e],t))return void(r.selectedIndex=e)}}function a7(t,e,n,i){const r=t7("span",{class:"vega-bind-radio"}),o=n.labels||[];e.appendChild(r),t.elements=n.options.map(((e,a)=>{const s={type:"radio",name:n.signal,value:e};l7(e,i)&&(s.checked=!0);const l=t7("input",s);l.addEventListener("change",(()=>t.update(e)));const u=t7("label",{},(o[a]||e)+"");return u.prepend(l),r.appendChild(u),l})),t.set=e=>{const n=t.elements,i=n.length;for(let t=0;t<i;++t)l7(n[t].value,e)&&(n[t].checked=!0)}}function s7(t,e,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;const r=null!=n.max?n.max:Math.max(100,+i)||100,o=n.min||Math.min(0,r,+i)||0,a=n.step||JF(o,r,100),s=t7("input",{type:"range",name:n.signal,min:o,max:r,step:a});s.value=i;const l=t7("span",{},+i);e.appendChild(s),e.appendChild(l);const u=()=>{l.textContent=s.value,t.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),t.elements=[s],t.set=t=>{s.value=t,l.textContent=t}}function l7(t,e){return t===e||t+""==e+""}function u7(t,e,n,i,r,o){return(e=e||new i(t.loader())).initialize(n,U9(t),G9(t),H9(t),r,o).background(t.background())}function c7(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function h7(t,e,n){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e&&n)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}const d7=t=>+t||0;function p7(t){return GN(t)?{top:d7(t.top),bottom:d7(t.bottom),left:d7(t.left),right:d7(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(d7(t))}async function f7(t,e,n,i){const r=lZ(e),o=r&&r.headless;return o||ON("Unrecognized renderer type: "+e),await t.runAsync(),u7(t,null,null,o,n,i).renderAsync(t._scenegraph.root)}var g7={skip:!0};function m7(t,e){var n=t.autosize(),i=t.padding();return e-(n&&"padding"===n.contains?i.left+i.right:0)}function y7(t,e){var n=t.autosize(),i=t.padding();return e-(n&&"padding"===n.contains?i.top+i.bottom:0)}function v7(t,e){return e.modified&&UN(e.input.value)&&t.indexOf("_:vega:_")}function x7(t,e){return!("parent"===t||e instanceof Mz.proxy)}function b7(t,e,n,i){const r=t.element();r&&r.setAttribute("title",function(t){return null==t?"":UN(t)?w7(t):GN(t)&&!LO(t)?(e=t,Object.keys(e).map((t=>{const n=e[t];return t+": "+(UN(n)?w7(n):_7(n))})).join("\n")):t+"";var e}(i))}function w7(t){return"["+t.map(_7).join(", ")+"]"}function _7(t){return UN(t)?"[…]":GN(t)&&!LO(t)?"{…}":t}function k7(t,e){const n=this;if(e=e||{},Cz.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const i=CO({},t.locale,e.locale);n.locale(PP(i.number,i.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||aZ.Canvas,n._scenegraph=new eK;const i=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||b7,n._redraw=!0,n._handler=(new bK).scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=CO({defaults:{}},t),n=(t,e)=>{e.forEach((e=>{UN(t[e])&&(t[e]=QO(t[e]))}))};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=function(t,e,n){return $9(t,Mz,_9,n).parse(e)}(n,t,e.expr);n._runtime=r,n._signals=r.signals,n._bind=(t.bindings||[]).map((t=>({state:null,param:CO({},t)}))),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=m7(n,n._width),n._viewHeight=y7(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e.width,i=e.height,r=e.padding;function o(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(e=>{t._width=e.size,t._viewWidth=m7(t,e.size),o()}),{size:n}),t._resizeHeight=t.add(null,(e=>{t._height=e.size,t._viewHeight=y7(t,e.size),o()}),{size:i});const a=t.add(null,o,{pad:r});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=i.rank+1,a.rank=r.rank+1}(n),function(t){t.add(null,(e=>(t._background=e.bg,t._resize=1,e.bg)),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:"default",item:null}));t.on(t.events("view","mousemove"),e,((t,n)=>{const i=e.value,r=i?BO(i)?i:i.user:"default",o=n.item&&n.item.cursor||null;return i&&r===i.user&&o==i.item?i:{user:r,item:o}})),t.add(null,(function(e){let n=e.cursor,i=this.value;return BO(n)||(i=n.item,n=n.user),V9(t,n&&"default"!==n?n:i||n),i}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind)}function S7(t,e){return DO(t._signals,e)?t._signals[e]:ON("Unrecognized signal name: "+XO(e))}function C7(t,e){const n=(t._targets||[]).filter((t=>t._update&&t._update.handler===e));return n.length?n[0]:null}function A7(t,e,n,i){let r=C7(n,i);return r||(r=c7(t,(()=>i(e,n.value))),r.handler=i,t.on(n,null,r)),t}function I7(t,e,n){const i=C7(e,n);return i&&e._targets.remove(i),t}OO(k7,Cz,{async evaluate(t,e,n){if(await Cz.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,r=H9(i=this),o=U9(i),a=G9(i),i._renderer.background(i.background()),i._renderer.resize(o,a,r),i._handler.origin(r),i._resizeListeners.forEach((t=>{try{t(o,a)}catch(t){i.error(t)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}var i,r,o,a;return n&&GP(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&B9(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const i=S7(this,t);return 1===arguments.length?i.value:this.update(i,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",p7(t)):p7(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(lZ(t)||ON("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(Cz.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(S7(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(t,e,n,i,r,o){this.runAfter((a=>{let s=0;a._autosize=0,a.width()!==n&&(s=1,a.signal("width",n,g7),a._resizeWidth.skip(!0)),a.height()!==i&&(s=1,a.signal("height",i,g7),a._resizeHeight.skip(!0)),a._viewWidth!==t&&(a._resize=1,a._viewWidth=t),a._viewHeight!==e&&(a._resize=1,a._viewHeight=e),a._origin[0]===r[0]&&a._origin[1]===r[1]||(a._resize=1,a._origin=r),s&&a.run("enter"),o&&a.runAfter((t=>t.resize()))}),!1,1)},addEventListener(t,e,n){let i=e;return n&&!1===n.trap||(i=c7(this,e),i.raw=e),this._handler.on(t,i),this},removeEventListener(t,e){for(var n,i,r=this._handler.handlers(t),o=r.length;--o>=0;)if(i=r[o].type,n=r[o].handler,t===i&&(e===n||e===n.raw)){this._handler.off(i,n);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return A7(this,t,S7(this,t),e)},removeSignalListener(t,e){return I7(this,S7(this,t),e)},addDataListener(t,e){return A7(this,t,W9(this,t).values,e)},removeDataListener(t,e){return I7(this,W9(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=V9(this,null);this._globalCursor=!!t,e&&V9(this,e)}return this}return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:function(t,e){this._timers.push(function(t,e,n){var i=new B3,r=e;return null==e?(i.restart(t,e,n),i):(i._restart=i.restart,i.restart=function(t,e,n){e=+e,n=null==n?P3():+n,i._restart((function o(a){a+=r,i._restart(o,r+=e,n),t(a)}),e,n)},i.restart(t,e,n),i)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},events:function(t,e,n){var i,r=this,o=new cz(n),a=function(n,i){r.runAsync(null,(()=>{"view"===t&&function(t,e){var n=t._eventConfig.defaults,i=n.prevent,r=n.allow;return!1!==i&&!0!==r&&(!0===i||!1===r||(i?i[e]:r?!r[e]:t.preventDefault()))}(r,e)&&n.preventDefault(),o.receive(q9(r,n,i))}))};if("timer"===t)K9(r,"timer",e)&&r.timer(a,e);else if("view"===t)K9(r,"view",e)&&r.addEventListener(e,a,X9);else if("window"===t?K9(r,"window",e)&&"undefined"!=typeof window&&(i=[window]):"undefined"!=typeof document&&K9(r,"selector",e)&&(i=document.querySelectorAll(t)),i){for(var s=0,l=i.length;s<l;++s)i[s].addEventListener(e,a);Y9(r,i,e,a)}else r.warn("Can not resolve event source: "+t);return o},finalize:function(){var t,e,n,i=this._tooltip,r=this._timers,o=this._eventListeners;for(t=r.length;--t>=0;)r[t].stop();for(t=o.length;--t>=0;)for(e=(n=o[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return i&&i.call(this,this._handler,null,null,null),this},hover:function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",Z9),J9,Q9(t)),this.on(this.events("view","mouseout",Z9),J9,Q9(e)),this},data:function(t,e){return arguments.length<2?W9(this,t).values.value:j9.call(this,t,iz().remove(BN).insert(e))},change:j9,insert:function(t,e){return j9.call(this,t,iz().insert(e))},remove:function(t,e){return j9.call(this,t,iz().remove(e))},scale:function(t){var e=this._runtime.scales;return DO(e,t)||ON("Unrecognized scale or projection: "+t),e[t].value},initialize:function(t,e){const n=this,i=n._renderType,r=n._eventConfig.bind,o=lZ(i);t=n._el=t?h7(n,t,!0):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),B9(e,t.description()))}(n),o||n.error("Unrecognized renderer type: "+i);const a=o.handler||bK,s=t?o.renderer:o.headless;return n._renderer=s?u7(n,n._renderer,t,s):null,n._handler=function(t,e,n,i){const r=new i(t.loader(),c7(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,H9(t),t);return e&&e.handlers().forEach((t=>{r.on(t.type,t.handler)})),r}(n,n._handler,t,a),n._redraw=!0,t&&"none"!==r&&(e=e?n._elBind=h7(n,e,!0):t.appendChild(t7("form",{class:"vega-bindings"})),n._bind.forEach((t=>{t.param.element&&"container"!==r&&(t.element=h7(n,t.param.element,!!t.param.input))})),n._bind.forEach((t=>{!function(t,e,n){if(!e)return;const i=n.param;let r=n.state;r||(r=n.state={elements:null,active:!1,set:null,update:e=>{e!=t.signal(i.signal)&&t.runAsync(null,(()=>{r.source=!0,t.signal(i.signal,e)}))}},i.debounce&&(r.update=SO(i.debounce,r.update))),(null==i.input&&i.element?e7:n7)(r,e,i,t),r.active||(t.on(t._signals[i.signal],null,(()=>{r.source?r.source=!1:r.set(t.signal(i.signal))})),r.active=!0)}(n,t.element||e,t)}))),n},toImageURL:async function(t,e){t!==aZ.Canvas&&t!==aZ.SVG&&t!==aZ.PNG&&ON("Unrecognized image type: "+t);const n=await f7(this,t,e);return t===aZ.SVG?function(t,e){const n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(t,e){return(await f7(this,aZ.Canvas,t,e)).canvas()},toSVG:async function(t){return(await f7(this,aZ.SVG,t)).svg()},getState:function(t){return this._runtime.getState(t||{data:v7,signals:x7,recurse:!0})},setState:function(t){return this.runAsync(null,(e=>{e._trigger=!1,e._runtime.setState(t)}),(t=>{t._trigger=!0})),this}});const M7=/[[\]{}]/,D7={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let T7,E7;function N7(t,e,n){return T7=e||"view",E7=n||D7,F7(t.trim()).map(R7)}function O7(t,e,n,i,r){const o=t.length;let a,s=0;for(;e<o;++e){if(a=t[e],!s&&a===n)return e;r&&r.indexOf(a)>=0?--s:i&&i.indexOf(a)>=0&&++s}return e}function F7(t){const e=[],n=t.length;let i=0,r=0;for(;r<n;)r=O7(t,r,",","[{","]}"),e.push(t.substring(i,r).trim()),i=++r;if(0===e.length)throw"Empty event selector: "+t;return e}function R7(t){return"["===t[0]?function(t){const e=t.length;let n,i=1;if(i=O7(t,i,"]","[","]"),i===e)throw"Empty between selector: "+t;if(n=F7(t.substring(1,i)),2!==n.length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;n=n.map(R7);const r=R7(t.slice(1).trim());if(r.between)return{between:n,stream:r};r.between=n;return r}(t):function(t){const e={source:T7},n=[];let i,r,o=[0,0],a=0,s=0,l=t.length,u=0;if("}"===t[l-1]){if(u=t.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+t;try{o=function(t){const e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!=n)throw t;return n}))}(t.substring(u+1,l-1))}catch(e){throw"Invalid throttle specification: "+t}l=(t=t.slice(0,u).trim()).length,u=0}if(!l)throw t;"@"===t[0]&&(a=++u);i=O7(t,u,":"),i<l&&(n.push(t.substring(s,i).trim()),s=u=++i);if(u=O7(t,u,"["),u===l)n.push(t.substring(s,l).trim());else if(n.push(t.substring(s,u).trim()),r=[],s=++u,s===l)throw"Unmatched left bracket: "+t;for(;u<l;){if(u=O7(t,u,"]"),u===l)throw"Unmatched left bracket: "+t;if(r.push(t.substring(s,u).trim()),u<l-1&&"["!==t[++u])throw"Expected left bracket: "+t;s=++u}if(!(l=n.length)||M7.test(n[l-1]))throw"Invalid event selector: "+t;l>1?(e.type=n[1],a?e.markname=n[0].slice(1):(c=n[0],E7[c]?e.marktype=n[0]:e.source=n[0])):e.type=n[0];var c;"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1));null!=r&&(e.filter=r);o[0]&&(e.throttle=o[0]);o[1]&&(e.debounce=o[1]);return e}(t)}function L7(t){return GN(t)?t:{type:t||"pad"}}const $7=t=>+t||0;function P7(t){return GN(t)?t.signal?t:{top:$7(t.top),bottom:$7(t.bottom),left:$7(t.left),right:$7(t.right)}:{top:e=$7(t),bottom:e,left:e,right:e};var e}const z7=t=>GN(t)&&!UN(t)?CO({},t):{value:t};function B7(t,e,n,i){if(null!=n){return GN(n)&&!UN(n)||UN(n)&&n.length&&GN(n[0])?t.update[e]=n:t[i||"enter"][e]={value:n},1}return 0}function V7(t,e,n){for(const n in e)B7(t,n,e[n]);for(const e in n)B7(t,e,n[e],"update")}function W7(t,e,n){for(const i in e)n&&DO(n,i)||(t[i]=CO(t[i]||{},e[i]));return t}function j7(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}function U7(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const G7=t=>BO(t)?XO(t):t.signal?"(".concat(t.signal,")"):Y7(t);function H7(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map((t=>null==t?null:XO(t)));for(;e.length&&null==KN(e);)e.pop();return e.unshift(G7(t.gradient)),"gradient(".concat(e.join(","),")")}(t);let e=t.signal?"(".concat(t.signal,")"):t.color?function(t){return t.c?q7("hcl",t.h,t.c,t.l):t.h||t.s?q7("hsl",t.h,t.s,t.l):t.l||t.a?q7("lab",t.l,t.a,t.b):t.r||t.g||t.b?q7("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?Y7(t.field):void 0!==t.value?XO(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=G7(t.scale);null!=t.range?e="lerp(_range(".concat(n,"), ").concat(+t.range,")"):(void 0!==e&&(e="_scale(".concat(n,", ").concat(e,")")),t.band&&(e=(e?e+"+":"")+"_bandwidth(".concat(n,")")+(1==+t.band?"":"*"+X7(t.band)),t.extra&&(e="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(e,")"))),null==e&&(e="0"));return e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e="pow(".concat(e,",").concat(X7(t.exponent),")")),null!=t.mult&&(e+="*".concat(X7(t.mult))),null!=t.offset&&(e+="+".concat(X7(t.offset))),t.round&&(e="round(".concat(e,")")),e}const q7=(t,e,n,i)=>"(".concat(t,"(").concat([e,n,i].map(H7).join(","),")+'')");function X7(t){return GN(t)?"("+H7(t)+")":t}function Y7(t){return K7(GN(t)?t:{datum:t})}function K7(t){let e,n,i;if(t.signal)e="datum",i=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(i=t.parent,e+=".datum"):i=t.group}else t.datum?(e="datum",i=t.datum):ON("Invalid field reference: "+XO(t));return t.signal||(i=BO(i)?FN(i).map(XO).join("]["):K7(i)),e+"["+i+"]"}function Z7(t,e,n,i,r,o){const a={};(o=o||{}).encoders={$encode:a},t=function(t,e,n,i,r){const o={},a={};let s,l,u,c;for(l in l="lineBreak","text"!==e||null==r[l]||j7(l,t)||U7(o,l,r[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c="frame"===n?r.group:"mark"===n?CO({},r.mark,r[e]):null,c)u=j7(l,t)||("fill"===l||"stroke"===l)&&(j7("fill",t)||j7("stroke",t)),u||U7(o,l,c[l]);for(l in gO(i).forEach((e=>{const n=r.style&&r.style[e];for(const e in n)j7(e,t)||U7(o,e,n[e])})),t=CO({},t),o)c=o[l],c.signal?(s=s||{})[l]=c:a[l]=c;return t.enter=CO(a,t.enter),s&&(t.update=CO(s,t.update)),t}(t,e,n,i,r.config);for(const n in t)a[n]=J7(t[n],e,o,r);return o}function J7(t,e,n,i){const r={},o={};for(const e in t)null!=t[e]&&(r[e]=Q7((a=t[e],UN(a)?function(t){let e="";return t.forEach((t=>{const n=H7(t);e+=t.test?"(".concat(t.test,")?").concat(n,":"):n})),":"===KN(e)&&(e+="null"),e}(a):H7(a)),i,n,o));var a;return{$expr:{marktype:e,channels:r},$fields:Object.keys(o),$output:Object.keys(t)}}function Q7(t,e,n,i){const r=M9(t,e);return r.$fields.forEach((t=>i[t]=1)),CO(n,r.$params),r.$expr}const ttt=["value","update","init","react","bind"];function ett(t,e){ON(t+' for "outer" push: '+XO(e))}function ntt(t,e){const n=t.name;if("outer"===t.push)e.signals[n]||ett("No prior signal definition",n),ttt.forEach((e=>{void 0!==t[e]&&ett("Invalid property ",e)}));else{const i=e.addSignal(n,t.value);!1===t.react&&(i.react=!1),t.bind&&e.addBinding(n,t.bind)}}function itt(t,e,n,i){this.id=-1,this.type=t,this.value=e,this.params=n,i&&(this.parent=i)}function rtt(t,e,n,i){return new itt(t,e,n,i)}function ott(t,e){return rtt("operator",t,e)}function att(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function stt(t,e){return e?{$field:t,$name:e}:{$field:t}}const ltt=stt("key");function utt(t,e){return{$compare:t,$order:e}}function ctt(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}function htt(t){return t&&t.signal}function dtt(t){if(htt(t))return!0;if(GN(t))for(const e in t)if(dtt(t[e]))return!0;return!1}function ptt(t,e){return null!=t?t:e}function ftt(t){return t&&t.signal||t}function gtt(t,e){return(t.merge?mtt:t.stream?ytt:t.type?vtt:ON("Invalid stream specification: "+XO(t)))(t,e)}function mtt(t,e){const n=xtt({merge:t.merge.map((t=>gtt(t,e)))},t,e);return e.addStream(n).id}function ytt(t,e){const n=xtt({stream:gtt(t.stream,e)},t,e);return e.addStream(n).id}function vtt(t,e){let n;var i;"timer"===t.type?(n=e.event("timer",t.throttle),t={between:t.between,filter:t.filter}):n=e.event("scope"===(i=t.source)?"view":i||"view",t.type);const r=xtt({stream:n},t,e);return 1===Object.keys(r).length?n:e.addStream(r).id}function xtt(t,e,n){let i=e.between;return i&&(2!==i.length&&ON('Stream "between" parameter must have 2 entries: '+XO(e)),t.between=[gtt(i[0],n),gtt(i[1],n)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(function(t,e,n){const i="event.item";return i+(t&&"*"!==t?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),"scope"===e.source&&i.push("inScope(event.item)"),i.length&&(t.filter=M9("("+i.join(")&&(")+")",n).$expr),null!=(i=e.throttle)&&(t.throttle=+i),null!=(i=e.debounce)&&(t.debounce=+i),e.consume&&(t.consume=!0),t}const btt={code:"_.$value",ast:{type:"Identifier",value:"value"}};function wtt(t,e,n){const i=t.encode,r={target:n};let o=t.events,a=t.update,s=[];o||ON("Signal update missing events specification."),BO(o)&&(o=N7(o,e.isSubscope()?"scope":"view")),o=gO(o).filter((t=>t.signal||t.scale?(s.push(t),0):1)),s.length>1&&(s=[_tt(s)]),o.length&&s.push(o.length>1?{merge:o}:o[0]),null!=i&&(a&&ON("Signal encode and update are mutually exclusive."),a="encode(item(),"+XO(i)+")"),r.update=BO(a)?M9(a,e):null!=a.expr?M9(a.expr,e):null!=a.value?a.value:null!=a.signal?{$expr:btt,$params:{$value:e.signalRef(a.signal)}}:ON("Invalid signal update specification."),t.force&&(r.options={force:!0}),s.forEach((t=>e.addUpdate(CO(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):gtt(t,e)}}(t,e),r))))}function _tt(t){return{signal:"["+t.map((t=>t.scale?'scale("'+t.scale+'")':t.signal))+"]"}}const ktt=t=>(e,n,i)=>rtt(t,n,e||void 0,i),Stt=ktt("aggregate"),Ctt=ktt("axisticks"),Att=ktt("bound"),Itt=ktt("collect"),Mtt=ktt("compare"),Dtt=ktt("datajoin"),Ttt=ktt("encode"),Ett=ktt("expression"),Ntt=ktt("facet"),Ott=ktt("field"),Ftt=ktt("key"),Rtt=ktt("legendentries"),Ltt=ktt("load"),$tt=ktt("mark"),Ptt=ktt("multiextent"),ztt=ktt("multivalues"),Btt=ktt("overlap"),Vtt=ktt("params"),Wtt=ktt("prefacet"),jtt=ktt("projection"),Utt=ktt("proxy"),Gtt=ktt("relay"),Htt=ktt("render"),qtt=ktt("scale"),Xtt=ktt("sieve"),Ytt=ktt("sortitems"),Ktt=ktt("viewlayout"),Ztt=ktt("values");let Jtt=0;const Qtt={min:"min",max:"max",count:"sum"};function tet(t,e){const n=e.getScale(t.name).params;let i;var r;for(i in n.domain=ret(t.domain,t,e),null!=t.range&&(n.range=pet(t,e,n)),null!=t.interpolate&&function(t,e){e.interpolate=eet(t.type||t),null!=t.gamma&&(e.interpolateGamma=eet(t.gamma))}(t.interpolate,n),null!=t.nice&&(n.nice=GN(r=t.nice)?{interval:eet(r.interval),step:eet(r.step)}:eet(r)),null!=t.bins&&(n.bins=function(t,e){return t.signal||UN(t)?net(t,e):e.objectProperty(t)}(t.bins,e)),t)DO(n,i)||"name"===i||(n[i]=eet(t[i],e))}function eet(t,e){return GN(t)?t.signal?e.signalRef(t.signal):ON("Unsupported object: "+XO(t)):t}function net(t,e){return t.signal?e.signalRef(t.signal):t.map((t=>eet(t,e)))}function iet(t){ON("Can not find data set: "+XO(t))}function ret(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(UN(t)?oet:t.fields?set:aet)(t,e,n);null==e.domainMin&&null==e.domainMax||ON("No scale domain defined for domainMin/domainMax to override.")}function oet(t,e,n){return t.map((t=>eet(t,n)))}function aet(t,e,n){const i=n.getData(t.data);return i||iet(t.data),_H(e.type)?i.valuesRef(n,t.field,cet(t.sort,!1)):AH(e.type)?i.domainRef(n,t.field):i.extentRef(n,t.field)}function set(t,e,n){const i=t.data,r=t.fields.reduce(((t,e)=>(e=BO(e)?{data:i,field:e}:UN(e)||e.signal?function(t,e){const n="_:vega:_"+Jtt++,i=Itt({});if(UN(t))i.value={$ingest:t};else if(t.signal){const r="setdata("+XO(n)+","+t.signal+")";i.params.input=e.signalRef(r)}return e.addDataPipeline(n,[i,Xtt({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t)),[]);return(_H(e.type)?uet:AH(e.type)?het:det)(t,n,r)}function uet(t,e,n){const i=cet(t.sort,!0);let r,o;const a=n.map((t=>{const n=e.getData(t.data);return n||iet(t.data),n.countsRef(e,t.field,i)})),s={groupby:ltt,pulse:a};i&&(r=i.op||"count",o=i.field?ctt(r,i.field):"count",s.ops=[Qtt[r]],s.fields=[e.fieldRef(o)],s.as=[o]),r=e.add(Stt(s));const l=e.add(Itt({pulse:att(r)}));return o=e.add(Ztt({field:ltt,sort:e.sortRef(i),pulse:att(l)})),att(o)}function cet(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!Qtt[t.op]&&ON("Multiple domain scales can not be sorted using "+t.op):ON("No field provided for sort aggregate op: "+t.op):GN(t)?t.field="key":t={field:"key"}),t}function het(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);return n||iet(t.data),n.domainRef(e,t.field)}));return att(e.add(ztt({values:i})))}function det(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);return n||iet(t.data),n.extentRef(e,t.field)}));return att(e.add(Ptt({extents:i})))}function pet(t,e,n){const i=e.config.range;let r=t.range;if(r.signal)return e.signalRef(r.signal);if(BO(r)){if(i&&DO(i,r))return pet(t=CO({},t,{range:i[r]}),e,n);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=_H(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:ON("Unrecognized scale range value: "+XO(r))}else{if(r.scheme)return n.scheme=UN(r.scheme)?net(r.scheme,e):eet(r.scheme,e),r.extent&&(n.schemeExtent=net(r.extent,e)),void(r.count&&(n.schemeCount=eet(r.count,e)));if(r.step)return void(n.rangeStep=eet(r.step,e));if(_H(t.type)&&!UN(r))return ret(r,t,e);UN(r)||ON("Unsupported range type: "+XO(r))}return r.map((t=>(UN(t)?net:eet)(t,e)))}function fet(t,e,n){return UN(t)?t.map((t=>fet(t,e,n))):GN(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:ON("Unsupported parameter object: "+XO(t)):t}const get="top",met="value",yet=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],vet={name:1,style:1,interactive:1},xet={value:0},bet={value:1};function wet(t){return t.type="group",t.interactive=t.interactive||!1,t}function _et(t,e){const n=(n,i)=>ptt(t[n],ptt(e[n],i));return n.isVertical=n=>"vertical"===ptt(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>ptt(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>ptt(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>ptt(t.columns,ptt(e.columns,+n.isVertical(!0))),n}function ket(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function Cet(t,e,n){return"item.anchor === '".concat("start","' ? ").concat(t," : item.anchor === '").concat("end","' ? ").concat(e," : ").concat(n)}const Aet=Cet(XO("left"),XO("right"),XO("center"));function Iet(t,e){return e?t?GN(t)?Object.assign({},t,{offset:Iet(t.offset,e)}):{value:t,offset:e}:e:t}function Met(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=W7(t.encode,e,vet)):t.interactive=!1,t}function Det(t,e,n,i){const r=_et(t,n),o=r.isVertical(),a=r.gradientThickness(),s=r.gradientLength();let l,u,c,h,d;o?(u=[0,1],c=[0,0],h=a,d=s):(u=[0,0],c=[1,0],h=s,d=a);const p={enter:l={opacity:xet,x:xet,y:xet,width:z7(h),height:z7(d)},update:CO({},l,{opacity:bet,fill:{gradient:e,start:u,stop:c}}),exit:{opacity:xet}};return V7(p,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),Met({type:"rect",role:"legend-gradient",encode:p},i)}function Tet(t,e,n,i,r){const o=_et(t,n),a=o.isVertical(),s=o.gradientThickness(),l=o.gradientLength();let u,c,h,d,p="";a?(u="y",h="y2",c="x",d="width",p="1-"):(u="x",h="x2",c="y",d="height");const f={opacity:xet,fill:{scale:e,field:met}};f[u]={signal:p+"datum.perc",mult:l},f[c]=xet,f[h]={signal:p+"datum.perc2",mult:l},f[d]=z7(s);const g={enter:f,update:CO({},f,{opacity:bet}),exit:{opacity:xet}};return V7(g,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),Met({type:"rect",role:"legend-band",key:met,from:r,encode:g},i)}const Eet="datum.".concat("perc",'<=0?"').concat("left",'":datum.').concat("perc",'>=1?"').concat("right",'":"').concat("center",'"'),Net="datum.".concat("perc",'<=0?"').concat("bottom",'":datum.').concat("perc",'>=1?"').concat(get,'":"').concat("middle",'"');function Oet(t,e,n,i){const r=_et(t,e),o=r.isVertical(),a=z7(r.gradientThickness()),s=r.gradientLength();let l,u,c,h,d=r("labelOverlap"),p="";const f={enter:l={opacity:xet},update:u={opacity:bet,text:{field:"label"}},exit:{opacity:xet}};return V7(f,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:ptt(t.labelLimit,e.gradientLabelLimit)}),o?(l.align={value:"left"},l.baseline=u.baseline={signal:Net},c="y",h="x",p="1-"):(l.align=u.align={signal:Eet},l.baseline={value:"top"},c="x",h="y"),l[c]=u[c]={signal:p+"datum.perc",mult:s},l[h]=u[h]=a,a.offset=ptt(t.labelOffset,e.gradientLabelOffset)||0,d=d?{separation:r("labelSeparation"),method:d,order:"datum.index"}:void 0,Met({type:"text",role:"legend-label",style:"guide-label",key:met,from:i,encode:f,overlap:d},n)}function Fet(t,e,n,i,r){const o=_et(t,e),a=n.entries,s=!(!a||!a.interactive),l=a?a.name:void 0,u=o("clipHeight"),c=o("symbolOffset"),h={data:"value"},d="(".concat(r,") ? datum.").concat("offset"," : datum.").concat("size"),p=u?z7(u):{field:"size"},f="datum.".concat("index"),g="max(1, ".concat(r,")");let m,y,v,x,b;p.mult=.5,m={enter:y={opacity:xet,x:{signal:d,mult:.5,offset:c},y:p},update:v={opacity:bet,x:y.x,y:y.y},exit:{opacity:xet}};let w=null,_=null;t.fill||(w=e.symbolBaseFillColor,_=e.symbolBaseStrokeColor),V7(m,{fill:o("symbolFillColor",w),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",_),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),yet.forEach((e=>{t[e]&&(v[e]=y[e]={scale:t[e],field:met})}));const k=Met({type:"symbol",role:"legend-symbol",key:met,from:h,clip:!!u||void 0,encode:m},n.symbols),S=z7(c);S.offset=o("labelOffset"),m={enter:y={opacity:xet,x:{signal:d,offset:S},y:p},update:v={opacity:bet,text:{field:"label"},x:y.x,y:y.y},exit:{opacity:xet}},V7(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const C=Met({type:"text",role:"legend-label",style:"guide-label",key:met,from:h,encode:m},n.labels);return m={enter:{noBound:{value:!u},width:xet,height:u?z7(u):xet,opacity:xet},exit:{opacity:xet},update:v={opacity:bet,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(x="ceil(item.mark.items.length / ".concat(g,")"),v.row.signal="".concat(f,"%").concat(x),v.column.signal="floor(".concat(f," / ").concat(x,")"),b={field:["row",f]}):(v.row.signal="floor(".concat(f," / ").concat(g,")"),v.column.signal="".concat(f," % ").concat(g),b={field:f}),v.column.signal="(".concat(r,")?").concat(v.column.signal,":").concat(f),wet({role:"scope",from:i={facet:{data:i,name:"value",groupby:"index"}},encode:W7(m,a,vet),marks:[k,C],name:l,interactive:s,sort:b})}const Ret='item.orient === "left"',Let='item.orient === "right"',$et="(".concat(Ret," || ").concat(Let,")"),Pet="datum.vgrad && ".concat($et),zet=Cet('"top"','"bottom"','"middle"'),Bet=Cet('"right"','"left"','"center"'),Vet="datum.vgrad && ".concat(Let," ? (").concat(Bet,") : (").concat($et," && !(datum.vgrad && ").concat(Ret,')) ? "left" : ').concat(Aet),Wet="item._anchor || (".concat($et,' ? "middle" : "start")'),jet="".concat(Pet," ? (").concat(Ret," ? -90 : 90) : 0"),Uet="".concat($et," ? (datum.vgrad ? (").concat(Let,' ? "bottom" : "top") : ').concat(zet,') : "top"');function Get(t,e){let n;return GN(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+Het(t.path)+")":t.sphere&&(n="geoShape("+Het(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function Het(t){return GN(t)&&t.signal?t.signal:XO(t)}function qet(t){const e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?"group"===t.type?"scope":e||"mark":e}function Xet(t){return{marktype:t.type,name:t.name||void 0,role:t.role||qet(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function Yet(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t}function Ket(t,e){const n=Dz(t.type);n||ON("Unrecognized transform type: "+XO(t.type));const i=rtt(n.type.toLowerCase(),null,Zet(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=n.metadata||{},i}function Zet(t,e,n){const i={},r=t.params.length;for(let o=0;o<r;++o){const r=t.params[o];i[r.name]=Jet(r,e,n)}return i}function Jet(t,e,n){const i=t.type,r=e[t.name];return"index"===i?function(t,e,n){BO(e.from)||ON('Lookup "from" parameter must be a string literal.');return n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==r?"param"===i?function(t,e,n){const i=e[t.name];return t.array?(UN(i)||ON("Expected an array of sub-parameters. Instead: "+XO(i)),i.map((e=>tnt(t,e,n)))):tnt(t,i,n)}(t,e,n):"projection"===i?n.projectionRef(e[t.name]):t.array&&!htt(r)?r.map((e=>Qet(t,e,n))):Qet(t,r,n):void(t.required&&ON("Missing required "+XO(e.type)+" parameter: "+XO(t.name)))}function Qet(t,e,n){const i=t.type;if(htt(e))return rnt(i)?ON("Expression references can not be signals."):ont(i)?n.fieldRef(e):ant(i)?n.compareRef(e):n.signalRef(e.signal);{const r=t.expr||ont(i);return r&&ent(e)?n.exprRef(e.expr,e.as):r&&nnt(e)?stt(e.field,e.as):rnt(i)?M9(e,n):int(i)?att(n.getData(e).values):ont(i)?stt(e):ant(i)?n.compareRef(e):e}}function tnt(t,e,n){const i=t.params.length;let r;for(let n=0;n<i;++n){r=t.params[n];for(const t in r.key)if(r.key[t]!==e[t]){r=null;break}if(r)break}r||ON("Unsupported parameter: "+XO(e));const o=CO(Zet(r,e,n),r.key);return att(n.add(Vtt(o)))}const ent=t=>t&&t.expr,nnt=t=>t&&t.field,int=t=>"data"===t,rnt=t=>"expr"===t,ont=t=>"field"===t,ant=t=>"compare"===t;function snt(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:att(e.getData(t.data).output)}function lnt(t,e,n,i,r){this.scope=t,this.input=e,this.output=n,this.values=i,this.aggregate=r,this.index={}}function unt(t){return BO(t)?t:null}function cnt(t,e,n){const i=ctt(n.op,n.field);let r;if(e.ops){for(let t=0,n=e.as.length;t<n;++t)if(e.as[t]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((r=n.op.signal)?t.signalRef(r):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function hnt(t,e,n,i,r,o,a){const s=e[n]||(e[n]={}),l=function(t){return GN(t)?("descending"===t.order?"-":"+")+ctt(t.op,t.field):""}(o);let u,c,h=unt(r);if(null!=h&&(t=e.scope,h+=l?"|"+l:"",u=s[h]),!u){const n=o?{field:ltt,pulse:e.countsRef(t,r,o)}:{field:t.fieldRef(r),pulse:att(e.output)};l&&(n.sort=t.sortRef(o)),c=t.add(rtt(i,void 0,n)),a&&(e.index[r]=c),u=att(c),null!=h&&(s[h]=u)}return u}function dnt(t,e,n){const i=t.remove,r=t.insert,o=t.toggle,a=t.modify,s=t.values,l=e.add(ott()),u=M9("if("+t.trigger+',modify("'+n+'",'+[r,i,o,a,s].map((t=>null==t?"null":t)).join(",")+"),0)",e);l.update=u.$expr,l.params=u.$params}function pnt(t,e){const n=qet(t),i="group"===t.type,r=t.from&&t.from.facet,o=t.overlap;let a,s,l,u,c,h,d,p=t.layout||"scope"===n||"frame"===n;const f="mark"===n||p||r,g=function(t,e,n){let i,r,o,a,s;return t?(i=t.facet)&&(e||ON("Only group marks can be faceted."),null!=i.field?a=s=snt(i,n):(t.data?s=att(n.getData(t.data).aggregate):(o=Ket(CO({type:"aggregate",groupby:gO(i.groupby)},i.aggregate),n),o.params.key=n.keyRef(i.groupby),o.params.pulse=snt(i,n),a=s=att(n.add(o))),r=n.keyRef(i.groupby,!0))):a=att(n.add(Itt(null,[{}]))),a||(a=snt(t,n)),{key:r,pulse:a,parent:s}}(t.from,i,e);s=e.add(Dtt({key:g.key||(t.key?stt(t.key):void 0),pulse:g.pulse,clean:!i}));const m=att(s);s=l=e.add(Itt({pulse:m})),s=e.add($tt({markdef:Xet(t),interactive:Yet(t.interactive,e),clip:Get(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:att(s)}));const y=att(s);s=u=e.add(Ttt(Z7(t.encode,t.type,n,t.style,e,{mod:!1,pulse:y}))),s.params.parent=e.encode(),t.transform&&t.transform.forEach((t=>{const n=Ket(t,e),i=n.metadata;(i.generates||i.changes)&&ON("Mark transforms should not generate new data."),i.nomod||(u.params.mod=!0),n.params.pulse=att(s),e.add(s=n)})),t.sort&&(s=e.add(Ytt({sort:e.compareRef(t.sort),pulse:att(s)})));const v=att(s);(r||p)&&(p=e.add(Ktt({layout:e.objectProperty(t.layout),legends:e.legends,mark:y,pulse:v})),h=att(p));const x=e.add(Att({mark:y,pulse:h||v}));d=att(x),i&&(f&&(a=e.operators,a.pop(),p&&a.pop()),e.pushState(v,h||d,m),r?function(t,e,n){const i=t.from.facet,r=i.name,o=snt(i,e);let a;i.name||ON("Facet must have a name: "+XO(i)),i.data||ON("Facet must reference a data set: "+XO(i)),i.field?a=e.add(Wtt({field:e.fieldRef(i.field),pulse:o})):i.groupby?a=e.add(Ntt({key:e.keyRef(i.groupby),group:att(e.proxy(n.parent)),pulse:o})):ON("Facet must specify groupby or field: "+XO(i));const s=e.fork(),l=s.add(Itt()),u=s.add(Xtt({pulse:att(l)}));s.addData(r,new lnt(s,l,l,u)),s.addSignal("parent",null),a.params.subflow={$subflow:s.parse(t).toRuntime()}}(t,e,g):f?function(t,e,n){const i=e.add(Wtt({pulse:n.pulse})),r=e.fork();r.add(Xtt()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(t).toRuntime()}}(t,e,g):e.parse(t),e.popState(),f&&(p&&a.push(p),a.push(x))),o&&(d=function(t,e,n){const i=t.method,r=t.bound,o=t.separation,a={separation:htt(o)?n.signalRef(o.signal):o,method:htt(i)?n.signalRef(i.signal):i,pulse:e};t.order&&(a.sort=n.compareRef({field:t.order}));if(r){const t=r.tolerance;a.boundTolerance=htt(t)?n.signalRef(t.signal):+t,a.boundScale=n.scaleRef(r.scale),a.boundOrient=r.orient}return att(n.add(Btt(a)))}(o,d,e));const b=e.add(Htt({pulse:d})),w=e.add(Xtt({pulse:att(b)},void 0,e.parent()));null!=t.name&&(c=t.name,e.addData(c,new lnt(e,l,b,w)),t.on&&t.on.forEach((t=>{(t.insert||t.remove||t.toggle)&&ON("Marks only support modify triggers."),dnt(t,e,c)})))}function fnt(t,e){const n=e.config.legend,i=t.encode||{},r=_et(t,n),o=i.legend||{},a=o.name||void 0,s=o.interactive,l=o.style,u={};let c,h,d,p=0;yet.forEach((e=>t[e]?(u[e]=t[e],p=p||t[e]):0)),p||ON("Missing valid scale for legend.");const f=function(t,e){let n=t.type||"symbol";t.type||1!==function(t){return yet.reduce(((e,n)=>e+(t[n]?1:0)),0)}(t)||!t.fill&&!t.stroke||(n=wH(e)?"gradient":kH(e)?"discrete":"symbol");return"gradient"!==n?n:kH(e)?"discrete":"gradient"}(t,e.scaleType(p)),g={title:null!=t.title,scales:u,type:f,vgrad:"symbol"!==f&&r.isVertical()},m=att(e.add(Itt(null,[g]))),y=att(e.add(Rtt(h={type:f,scale:e.scaleRef(p),count:e.objectProperty(r("tickCount")),limit:e.property(r("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return"gradient"===f?(d=[Det(t,p,n,i.gradient),Oet(t,n,i.labels,y)],h.count=h.count||e.signalRef("max(2,2*floor((".concat(ftt(r.gradientLength()),")/100))"))):"discrete"===f?d=[Tet(t,p,n,i.gradient,y),Oet(t,n,i.labels,y)]:(c=function(t,e){const n=_et(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,n),d=[Fet(t,n,i,y,ftt(c.columns))],h.size=function(t,e,n){const i=ftt(mnt("size",t,n)),r=ftt(mnt("strokeWidth",t,n)),o=ftt(function(t,e,n){return ket("fontSize",t)||function(t,e,n){const i=e.config.style[n];return i&&i[t]}("fontSize",e,n)}(n[1].encode,e,"guide-label"));return M9("max(ceil(sqrt(".concat(i,")+").concat(r,"),").concat(o,")"),e)}(t,e,d[0].marks)),d=[wet({role:"legend-entry",from:m,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:c,interactive:s})],g.title&&d.push(function(t,e,n,i){const r=_et(t,e),o={enter:{opacity:xet},update:{opacity:bet,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:xet}};return V7(o,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Wet},angle:{signal:jet},align:{signal:Vet},baseline:{signal:Uet},text:t.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Met({type:"text",role:"legend-title",style:"guide-title",from:i,encode:o},n)}(t,n,i.title,m)),pnt(wet({role:"legend",from:m,encode:W7(gnt(r,t,n),o,vet),marks:d,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:a,interactive:s,style:l}),e)}function gnt(t,e,n){const i={enter:{},update:{}};return V7(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}function mnt(t,e,n){return e[t]?'scale("'.concat(e[t],'",datum)'):ket(t,n[0].encode)}lnt.fromEntries=function(t,e){const n=e.length,i=e[n-1],r=e[n-2];let o=e[0],a=null,s=1;for(o&&"load"===o.type&&(o=e[1]),t.add(e[0]);s<n;++s)e[s].params.pulse=att(e[s-1]),t.add(e[s]),"aggregate"===e[s].type&&(a=e[s]);return new lnt(t,o,r,i,a)},lnt.prototype={countsRef(t,e,n){const i=this,r=i.counts||(i.counts={}),o=unt(e);let a,s,l;return null!=o&&(t=i.scope,a=r[o]),a?n&&n.field&&cnt(t,a.agg.params,n):(l={groupby:t.fieldRef(e,"key"),pulse:att(i.output)},n&&n.field&&cnt(t,l,n),s=t.add(Stt(l)),a=t.add(Itt({pulse:att(s)})),a={agg:s,ref:att(a)},null!=o&&(r[o]=a)),a.ref},tuplesRef(){return att(this.values)},extentRef(t,e){return hnt(t,this,"extent","extent",e,!1)},domainRef(t,e){return hnt(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return hnt(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return hnt(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return hnt(t,this,"indata","tupleindex",e,!0,!0)}};const ynt='item.orient==="'.concat("left",'"?-90:item.orient==="').concat("right",'"?90:0');function vnt(t,e){const n=_et(t=BO(t)?{text:t}:t,e.config.title),i=t.encode||{},r=i.group||{},o=r.name||void 0,a=r.interactive,s=r.style,l=[],u=att(e.add(Itt(null,[{}])));return l.push(function(t,e,n,i){const r={value:0},o=t.text,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return V7(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),Met({type:"text",role:"title-text",style:"group-title",from:i,encode:a},n)}(t,n,function(t){const e=t.encode;return e&&e.title||CO({name:t.name,interactive:t.interactive,style:t.style},e)}(t),u)),t.subtitle&&l.push(function(t,e,n,i){const r={value:0},o=t.subtitle,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return V7(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),Met({type:"text",role:"title-subtitle",style:"group-subtitle",from:i,encode:a},n)}(t,n,i.subtitle,u)),pnt(wet({role:"title",from:u,encode:xnt(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:a,style:s}),e)}function xnt(t,e){const n={enter:{},update:{}};return V7(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:Aet},angle:{signal:ynt},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),W7(n,e,vet)}function bnt(t,e){const n=[];t.transform&&t.transform.forEach((t=>{n.push(Ket(t,e))})),t.on&&t.on.forEach((n=>{dnt(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){const i=[];let r,o,a,s,l,u=null,c=!1,h=!1;t.values?htt(t.values)||dtt(t.format)?(i.push(_nt(e,t)),i.push(u=wnt())):i.push(u=wnt({$ingest:t.values,$format:t.format})):t.url?dtt(t.url)||dtt(t.format)?(i.push(_nt(e,t)),i.push(u=wnt())):i.push(u=wnt({$request:t.url,$format:t.format})):t.source&&(u=r=gO(t.source).map((t=>att(e.getData(t).output))),i.push(null));for(o=0,a=n.length;o<a;++o)s=n[o],l=s.metadata,u||l.source||i.push(u=wnt()),i.push(s),l.generates&&(h=!0),l.modifies&&!h&&(c=!0),l.source?u=s:l.changes&&(u=null);r&&(a=r.length-1,i[0]=Gtt({derive:c,pulse:a?r:r[0]}),(c||a)&&i.splice(1,0,wnt()));u||i.push(wnt());return i.push(Xtt({})),i}(t,e,n))}function wnt(t){const e=Itt({},t);return e.metadata={source:!0},e}function _nt(t,e){return Ltt({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const knt=t=>"bottom"===t||t===get,Snt=(t,e,n)=>htt(t)?Tnt(t.signal,e,n):"left"===t||t===get?e:n,Cnt=(t,e,n)=>htt(t)?Mnt(t.signal,e,n):knt(t)?e:n,Ant=(t,e,n)=>htt(t)?Dnt(t.signal,e,n):knt(t)?n:e,Int=(t,e,n)=>htt(t)?Ent(t.signal,e,n):t===get?{value:e}:{value:n},Mnt=(t,e,n)=>Ont("".concat(t," === '").concat(get,"' || ").concat(t," === '").concat("bottom","'"),e,n),Dnt=(t,e,n)=>Ont("".concat(t," !== '").concat(get,"' && ").concat(t," !== '").concat("bottom","'"),e,n),Tnt=(t,e,n)=>Rnt("".concat(t," === '").concat("left","' || ").concat(t," === '").concat(get,"'"),e,n),Ent=(t,e,n)=>Rnt("".concat(t," === '").concat(get,"'"),e,n),Nnt=(t,e,n)=>Rnt("".concat(t," === '").concat("right","'"),e,n),Ont=(t,e,n)=>(e=null!=e?z7(e):e,n=null!=n?z7(n):n,Fnt(e)&&Fnt(n)?(e=e?e.signal||XO(e.value):null,n=n?n.signal||XO(n.value):null,{signal:"".concat(t," ? (").concat(e,") : (").concat(n,")")}):[CO({test:t},e)].concat(n||[])),Fnt=t=>null==t||1===Object.keys(t).length,Rnt=(t,e,n)=>({signal:"".concat(t," ? (").concat(Lnt(e),") : (").concat(Lnt(n),")")}),Lnt=t=>htt(t)?t.signal:null==t?null:XO(t),$nt=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function Pnt(t,e,n,i){let r;if(e&&DO(e,t))return e[t];if(DO(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=t[5].toLowerCase()+t.slice(6)}return i["guide-title"][r]}if(t.startsWith("label")){switch(t){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=t[5].toLowerCase()+t.slice(6)}return i["guide-label"][r]}return null}function znt(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function Bnt(t,e){return{scale:t.scale,range:e}}function Vnt(t,e,n,i,r){const o=_et(t,e),a=t.orient,s=t.gridScale,l=Snt(a,1,-1),u=function(t,e){if(1===e);else if(GN(t)){let n=t=CO({},t);for(;null!=n.mult;){if(!GN(n.mult))return n.mult=htt(e)?{signal:"(".concat(n.mult,") * (").concat(e.signal,")")}:n.mult*e,t;n=n.mult=CO({},n.mult)}n.mult=e}else t=htt(e)?{signal:"(".concat(e.signal,") * (").concat(t||0,")")}:e*(t||0);return t}(t.offset,l);let c,h,d;const p={enter:c={opacity:xet},update:d={opacity:bet},exit:h={opacity:xet}};V7(p,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const f={scale:t.scale,field:met,band:r.band,extra:r.extra,offset:r.offset,round:o("tickRound")},g=Cnt(a,{signal:"height"},{signal:"width"}),m=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:CO(g,{mult:l,offset:u});return c.x=d.x=Cnt(a,f,m),c.y=d.y=Ant(a,f,m),c.x2=d.x2=Ant(a,y),c.y2=d.y2=Cnt(a,y),h.x=Cnt(a,f),h.y=Ant(a,f),Met({type:"rule",role:"axis-grid",key:met,from:i,encode:p},n)}function Wnt(t,e,n,i,r){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+i+","+r+")"}}function jnt(t,e,n,i,r,o){const a=_et(t,e),s=t.orient,l=t.scale,u=Snt(s,-1,1),c=ftt(a("labelFlush")),h=ftt(a("labelFlushOffset")),d=a("labelAlign"),p=a("labelBaseline");let f,g=0===c||!!c;const m=z7(r);m.mult=u,m.offset=z7(a("labelPadding")||0),m.offset.mult=u;const y={scale:l,field:met,band:.5,offset:Iet(o.offset,a("labelOffset"))},v=Cnt(s,g?Wnt(l,c,'"left"','"right"','"center"'):{value:"center"},((t,e,n)=>htt(t)?Nnt(t.signal,e,n):"right"===t?{value:e}:{value:n})(s,"left","right")),x=Cnt(s,Int(s,"bottom","top"),g?Wnt(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),b=Wnt(l,c,"-(".concat(h,")"),h,0);g=g&&h;const w={opacity:xet,x:Cnt(s,y,m),y:Ant(s,y,m)},_={enter:w,update:f={opacity:bet,text:{field:"label"},x:w.x,y:w.y,align:v,baseline:x},exit:{opacity:xet,x:w.x,y:w.y}};V7(_,{dx:!d&&g?Cnt(s,b):null,dy:!p&&g?Ant(s,b):null}),V7(_,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:d,baseline:p});const k=a("labelBound");let S=a("labelOverlap");return S=S||k?{separation:a("labelSeparation"),method:S,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,f.align!==v&&(f.align=$nt(f.align,v)),f.baseline!==x&&(f.baseline=$nt(f.baseline,x)),Met({type:"text",role:"axis-label",style:"guide-label",key:met,from:i,encode:_,overlap:S},n)}function Unt(t,e,n,i){const r=_et(t,e),o=t.orient,a=Snt(o,-1,1);let s,l;const u={enter:s={opacity:xet,anchor:z7(r("titleAnchor",null)),align:{signal:Aet}},update:l=CO({},s,{opacity:bet,text:z7(t.title)}),exit:{opacity:xet}},c={signal:'lerp(range("'.concat(t.scale,'"), ').concat(Cet(0,1,.5),")")};return l.x=Cnt(o,c),l.y=Ant(o,c),s.angle=Cnt(o,xet,((t,e)=>0===e?0:htt(t)?{signal:"(".concat(t.signal,") * ").concat(e)}:{value:t*e})(a,90)),s.baseline=Cnt(o,Int(o,"bottom",get),{value:"bottom"}),l.angle=s.angle,l.baseline=s.baseline,V7(u,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),function(t,e,n,i){const r=(t,e)=>null!=t?(n.update[e]=$nt(z7(t),n.update[e]),!1):!j7(e,i),o=r(t("titleX"),"x"),a=r(t("titleY"),"y");n.enter.auto=a===o?z7(a):Cnt(e,z7(a),z7(o))}(r,o,u,n),u.update.align=$nt(u.update.align,s.align),u.update.angle=$nt(u.update.angle,s.angle),u.update.baseline=$nt(u.update.baseline,s.baseline),Met({type:"text",role:"axis-title",style:"guide-title",from:i,encode:u},n)}function Gnt(t,e){const n=function(t,e){var n,i,r,o,a,s,l,u,c=e.config,h=c.style,d=c.axis,p="band"===e.scaleType(t.scale)&&c.axisBand,f=t.orient;if(htt(f)){const t=znt([c.axisX,c.axisY]),e=znt([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);for(r of(n={},t))n[r]=Cnt(f,Pnt(r,c.axisX,d,h),Pnt(r,c.axisY,d,h));for(r of(i={},e))i[r]=(o=f.signal,a=Pnt(r,c.axisTop,d,h),s=Pnt(r,c.axisBottom,d,h),l=Pnt(r,c.axisLeft,d,h),u=Pnt(r,c.axisRight,d,h),{signal:(null!=l?"".concat(o," === '").concat("left","' ? (").concat(Lnt(l),") : "):"")+(null!=s?"".concat(o," === '").concat("bottom","' ? (").concat(Lnt(s),") : "):"")+(null!=u?"".concat(o," === '").concat("right","' ? (").concat(Lnt(u),") : "):"")+(null!=a?"".concat(o," === '").concat(get,"' ? (").concat(Lnt(a),") : "):"")+"(null)"})}else n=f===get||"bottom"===f?c.axisX:c.axisY,i=c["axis"+f[0].toUpperCase()+f.slice(1)];return n||i||p?CO({},d,n,i,p):d}(t,e),i=t.encode||{},r=i.axis||{},o=r.name||void 0,a=r.interactive,s=r.style,l=_et(t,n),u=function(t){const e=t("tickBand");let n,i,r=t("tickOffset");return e?e.signal?(n={signal:"(".concat(e.signal,") === 'extent' ? 1 : 0.5")},i={signal:"(".concat(e.signal,") === 'extent'")},GN(r)||(r={signal:"(".concat(e.signal,") === 'extent' ? 0 : ").concat(r)})):"extent"===e?(n=1,i=!0,r=0):(n=.5,i=!1):(n=t("bandPosition"),i=t("tickExtra")),{extra:i,band:n,offset:r}}(l),c={scale:t.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=t.title},h=att(e.add(Itt({},[c]))),d=att(e.add(Ctt({scale:e.scaleRef(t.scale),extra:e.property(u.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),p=[];let f;return c.grid&&p.push(Vnt(t,n,i.grid,d,u)),c.ticks&&(f=l("tickSize"),p.push(function(t,e,n,i,r,o){const a=_et(t,e),s=t.orient,l=Snt(s,-1,1);let u,c,h;const d={enter:u={opacity:xet},update:h={opacity:bet},exit:c={opacity:xet}};V7(d,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const p=z7(r);p.mult=l;const f={scale:t.scale,field:met,band:o.band,extra:o.extra,offset:o.offset,round:a("tickRound")};return h.y=u.y=Cnt(s,xet,f),h.y2=u.y2=Cnt(s,p),c.x=Cnt(s,f),h.x=u.x=Ant(s,xet,f),h.x2=u.x2=Ant(s,p),c.y=Ant(s,f),Met({type:"rule",role:"axis-tick",key:met,from:i,encode:d},n)}(t,n,i.ticks,d,f,u))),c.labels&&(f=c.ticks?f:0,p.push(jnt(t,n,i.labels,d,f,u))),c.domain&&p.push(function(t,e,n,i){const r=_et(t,e),o=t.orient;let a,s;const l={enter:a={opacity:xet},update:s={opacity:bet},exit:{opacity:xet}};V7(l,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=Bnt(t,0),c=Bnt(t,1);return a.x=s.x=Cnt(o,u,xet),a.x2=s.x2=Cnt(o,c),a.y=s.y=Ant(o,u,xet),a.y2=s.y2=Ant(o,c),Met({type:"rule",role:"axis-domain",from:i,encode:l},n)}(t,n,i.domain,h)),c.title&&p.push(Unt(t,n,i.title,h)),pnt(wet({role:"axis",from:h,encode:W7(Hnt(l,t),r,vet),marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:o,interactive:a,style:s}),e)}function Hnt(t,e){const n={enter:{},update:{}};return V7(n,{orient:t("orient"),offset:t("offset")||0,position:ptt(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:'abs(span(range("'.concat(e.scale,'")))')},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function qnt(t,e,n){const i=gO(t.signals),r=gO(t.scales);return n||i.forEach((t=>ntt(t,e))),gO(t.projections).forEach((t=>function(t,e){const n=e.config.projection||{},i={};for(const n in t)"name"!==n&&(i[n]=fet(t[n],n,e));for(const t in n)null==i[t]&&(i[t]=fet(n[t],t,e));e.addProjection(t.name,i)}(t,e))),r.forEach((t=>function(t,e){const n=t.type||"linear";xH(n)||ON("Unrecognized scale type: "+XO(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e))),gO(t.data).forEach((t=>bnt(t,e))),r.forEach((t=>tet(t,e))),(n||i).forEach((t=>function(t,e){const n=e.getSignal(t.name);let i=t.update;t.init&&(i?ON("Signals can not include both init and update expressions."):(i=t.init,n.initonly=!0)),i&&(i=M9(i,e),n.update=i.$expr,n.params=i.$params),t.on&&t.on.forEach((t=>wtt(t,e,n.id)))}(t,e))),gO(t.axes).forEach((t=>Gnt(t,e))),gO(t.marks).forEach((t=>pnt(t,e))),gO(t.legends).forEach((t=>fnt(t,e))),t.title&&vnt(t.title,e),e.parseLambdas(),e}function Xnt(t,e){const n=e.config,i=att(e.root=e.add(ott())),r=function(t,e){const n=n=>ptt(t[n],e[n]),i=[Ynt("background",n("background")),Ynt("autosize",L7(n("autosize"))),Ynt("padding",P7(n("padding"))),Ynt("width",n("width")||0),Ynt("height",n("height")||0)],r=i.reduce(((t,e)=>(t[e.name]=e,t)),{}),o={};return gO(t.signals).forEach((t=>{DO(r,t.name)?t=CO(r[t.name],t):i.push(t),o[t.name]=t})),gO(e.signals).forEach((t=>{DO(o,t.name)||DO(r,t.name)||i.push(t)})),i}(t,n);r.forEach((t=>ntt(t,e))),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const o=e.add(Itt()),a=e.add(Ttt(Z7((t=>W7({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t))(t.encode),"group","frame",t.style,e,{pulse:att(o)}))),s=e.add(Ktt({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:att(a)}));e.operators.pop(),e.pushState(att(a),att(s),null),qnt(t,e,r),e.operators.push(s);let l=e.add(Att({mark:i,pulse:att(s)}));return l=e.add(Htt({pulse:att(l)})),l=e.add(Xtt({pulse:att(l)})),e.addData("root",new lnt(e,o,o,l)),e}function Ynt(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function Knt(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Znt(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}function Jnt(t){return(UN(t)?Qnt:tit)(t)}function Qnt(t){const e=t.length;let n="[";for(let i=0;i<e;++i){const e=t[i];n+=(i>0?",":"")+(GN(e)?e.signal||Jnt(e):XO(e))}return n+"]"}function tit(t){let e,n,i="{",r=0;for(e in t)n=t[e],i+=(++r>1?",":"")+XO(e)+":"+(GN(n)?n.signal||Jnt(n):XO(n));return i+"}"}Knt.prototype=Znt.prototype={parse(t){return qnt(t,this)},fork(){return new Znt(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((e=>{e.$ref=t.id})),t.refs=null),t},proxy(t){const e=t instanceof itt?att(t):t;return this.add(Utt({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){let i,r;t&&(i=t.data||(t.data={}),r=i[e]||(i[e]=[]),r.push(n))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const i in e.index)n(e.index[i],t,"index:"+i)}return this},pushState(t,e,n){this._encode.push(att(this.add(Xtt({pulse:t})))),this._parent.push(e),this._lookup.push(n?att(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return KN(this._parent)},encode(){return KN(this._encode)},lookup(){return KN(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(BO(t))return stt(t,e);t.signal||ON("Unsupported field reference: "+XO(t));const n=t.signal;let i=this.field[n];if(!i){const t={name:this.signalRef(n)};e&&(t.as=e),this.field[n]=i=att(this.add(Ott(t)))}return i},compareRef(t){let e=!1;const n=t=>htt(t)?(e=!0,this.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(e=!0,this.exprRef(t.expr)):t,i=gO(t.field).map(n),r=gO(t.order).map(n);return e?att(this.add(Mtt({fields:i,orders:r}))):utt(i,r)},keyRef(t,e){let n=!1;const i=this.signals;return t=gO(t).map((t=>htt(t)?(n=!0,att(i[t.signal])):t)),n?att(this.add(Ftt({fields:t,flat:e}))):function(t,e){const n={$key:t};return e&&(n.$flat=!0),n}(t,e)},sortRef(t){if(!t)return t;const e=ctt(t.op,t.field),n=t.order||"ascending";return n.signal?att(this.add(Mtt({fields:e,orders:this.signalRef(n.signal)}))):utt(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[n]=i}return this.events[n]},hasOwnSignal(t){return DO(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&ON("Duplicate signal name: "+XO(t));const n=e instanceof itt?e:this.add(ott(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||ON("Unrecognized signal name: "+XO(t)),this.signals[t]},signalRef(t){return this.signals[t]?att(this.signals[t]):(DO(this.lambdas,t)||(this.lambdas[t]=this.add(ott(null))),att(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const n=t[e],i=M9(n,this),r=this.lambdas[n];r.params=i.$params,r.update=i.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return t&&GN(t)?this.signalRef(t.signal||Jnt(t)):t},exprRef(t,e){const n={expr:M9(t,this)};return e&&(n.expr.$name=e),att(this.add(Ett(n)))},addBinding(t,e){this.bindings||ON("Nested signals do not support binding: "+XO(t)),this.bindings.push(CO({signal:t},e))},addScaleProj(t,e){DO(this.scales,t)&&ON("Duplicate scale or projection name: "+XO(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,qtt(e))},addProjection(t,e){this.addScaleProj(t,jtt(e))},getScale(t){return this.scales[t]||ON("Unrecognized scale name: "+XO(t)),this.scales[t]},scaleRef(t){return att(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return DO(this.data,t)&&ON("Duplicate data set name: "+XO(t)),this.data[t]=e},getData(t){return this.data[t]||ON("Undefined data set name: "+XO(t)),this.data[t]},addDataPipeline(t,e){return DO(this.data,t)&&ON("Duplicate data set name: "+XO(t)),this.addData(t,lnt.fromEntries(this,e))}};var eit="5.20.0";CO(Mz,qV,ZZ,CJ,s3,i5,$4,y4,W4,p6,A6,R6);const nit=eit;var iit=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",version:nit,Dataflow:Cz,EventStream:cz,MultiPulse:bz,Operator:sz,Parameters:rz,Pulse:mz,Transform:Iz,changeset:iz,definition:Dz,ingest:ZP,isTuple:XP,transform:Tz,transforms:Mz,tupleid:YP,interpolate:NH,interpolateColors:DH,interpolateRange:MH,quantizeInterpolator:TH,scale:vH,scheme:LH,projection:E2,View:k7,defaultLocale:zP,formatLocale:EP,locale:PP,resetDefaultLocale:function(){return DP(),FP(),zP()},timeFormatLocale:LP,expressionFunction:I9,parse:function(t,e,n){return GN(t)||ON("Input Vega specification must be an object."),Xnt(t,new Knt(e=qN(function(){const t="sans-serif",e="#4c78a8",n="#000",i="#888",r="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:e},area:{fill:e},image:null,line:{stroke:e,strokeWidth:2},path:{stroke:e},rect:{fill:e},rule:{stroke:n},shape:{stroke:e},symbol:{fill:e,size:64},text:{fill:n,font:t,fontSize:11},trail:{fill:e,size:2},style:{"guide-label":{fill:n,font:t,fontSize:10},"guide-title":{fill:n,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:r}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:r,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:r,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),e,t.config),n)).toRuntime()},runtimeContext:$9,codegenExpression:P8,parseExpression:R8,parseSelector:N7,Debug:4,Error:1,Info:3,None:0,Warn:2,accessor:IN,accessorFields:DN,accessorName:MN,array:gO,ascending:xO,clampRange:mO,compare:vO,constant:kO,debounce:SO,error:ON,extend:CO,extent:AO,extentIndex:IO,falsy:VN,fastmap:EO,field:RN,flush:NO,hasOwnProperty:DO,id:LN,identity:$N,inherits:OO,inrange:FO,isArray:UN,isBoolean:RO,isDate:LO,isFunction:yO,isIterable:$O,isNumber:PO,isObject:GN,isRegExp:zO,isString:BO,key:VO,lerp:WO,logger:jN,lruCache:jO,merge:UO,mergeConfig:qN,one:zN,pad:HO,panLinear:rO,panLog:oO,panPow:aO,panSymlog:sO,peek:KN,quarter:pO,repeat:GO,span:qO,splitAccessPath:FN,stringValue:XO,toBoolean:YO,toDate:ZO,toNumber:ZN,toSet:QO,toString:JO,truncate:tF,truthy:BN,utcquarter:fO,visitArray:eF,writeConfig:XN,zero:PN,zoomLinear:uO,zoomLog:cO,zoomPow:hO,zoomSymlog:dO,bandwidthNRD:Fz,bin:Rz,bootstrapCI:$z,cumulativeLogNormal:Kz,cumulativeNormal:Uz,cumulativeUniform:nB,densityLogNormal:Yz,densityNormal:jz,densityUniform:eB,dotbin:Pz,quantileLogNormal:Zz,quantileNormal:Gz,quantileUniform:iB,quantiles:Nz,quartiles:Oz,get random(){return Lz},randomInteger:function(t,e){let n,i,r;null==e&&(e=t,t=0);const o={min(t){return arguments.length?(n=t||0,r=i-n,o):n},max(t){return arguments.length?(i=t||0,r=i-n,o):i},sample:()=>n+Math.floor(r*Lz()),pdf:t=>t===Math.floor(t)&&t>=n&&t<i?1/r:0,cdf(t){const e=Math.floor(t);return e<n?0:e>=i?1:(e-n+1)/r},icdf:t=>t>=0&&t<=1?n-1+Math.floor(t*r):NaN};return o.min(t).max(e)},randomKDE:qz,randomLCG:function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},randomLogNormal:Jz,randomMixture:Qz,randomNormal:Hz,randomUniform:rB,regressionExp:hB,regressionLinear:uB,regressionLoess:mB,regressionLog:cB,regressionPoly:fB,regressionPow:dB,regressionQuad:pB,sampleCurve:bB,sampleLogNormal:Xz,sampleNormal:Wz,sampleUniform:tB,setRandom:function(t){Lz=t},DATE:nL,DAY:iL,DAYOFYEAR:"dayofyear",HOURS:rL,MILLISECONDS:"milliseconds",MINUTES:oL,MONTH:tL,QUARTER:QR,SECONDS:aL,TIME_UNITS:sL,WEEK:eL,YEAR:JR,dayofyear:fL,timeBin:JL,timeFloor:TL,timeInterval:LL,timeOffset:zL,timeSequence:WL,timeUnitSpecifier:hL,timeUnits:uL,utcFloor:OL,utcInterval:$L,utcOffset:BL,utcSequence:jL,utcdayofyear:bL,utcweek:wL,week:gL,read:BP,inferType:gF,inferTypes:mF,typeParsers:dF,format:$F,formats:PF,responseType:zF,loader:VP,Bounds:Qq,CanvasHandler:bK,CanvasRenderer:CK,Gradient:aq,GroupItem:eX,Handler:uK,Item:tX,Marks:qY,RenderType:aZ,Renderer:hK,ResourceLoader:nX,SVGHandler:IK,SVGRenderer:GK,SVGStringRenderer:oZ,Scenegraph:eK,boundClip:fZ,boundContext:kX,boundItem:XY,boundMark:KY,boundStroke:oX,domChild:oK,domClear:aK,domCreate:iK,domFind:rK,font:VY,fontFamily:BY,fontSize:RY,intersect:uZ,intersectBoxLine:FX,intersectPath:TX,intersectPoint:EX,intersectRule:OX,lineHeight:LY,markup:PK,multiLineOffset:PY,pathCurves:lq,pathEqual:mZ,pathParse:hq,pathRectangle:Rq,pathRender:_q,pathSymbols:Aq,pathTrail:Lq,point:lK,renderModule:lZ,resetSVGClipId:Zq,resetSVGDefIds:function(){Zq(),nq=0},sceneEqual:gZ,sceneFromJSON:QY,scenePickVisit:GX,sceneToJSON:JY,sceneVisit:UX,sceneZOrder:jX,serializeXML:zK,textMetrics:DY});var rit="4.13.1";function oit(t,e,n){return t.fields=e||[],t.fname=n,t}function ait(t){return 1===t.length?sit(t[0]):lit(t)}const sit=t=>function(e){return e[t]},lit=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function uit(t){throw Error(t)}function cit(t){var e,n,i,r=[],o=null,a=0,s=t.length,l="";function u(){r.push(l+t.substring(e,n)),l="",e=n+1}for(t+="",e=n=0;n<s;++n)if("\\"===(i=t[n]))l+=t.substring(e,n),l+=t.substring(++n,++n),e=n;else if(i===o)u(),o=null,a=-1;else{if(o)continue;e===a&&'"'===i||e===a&&"'"===i?(e=n+1,o=i):"."!==i||a?"["===i?(n>e&&u(),a=e=n+1):"]"===i&&(a||uit("Access path missing open bracket: "+t),a>0&&u(),a=0,e=n+1):n>e?u():e=n+1}return a&&uit("Access path missing closing bracket: "+t),o&&uit("Access path missing closing quote: "+t),n>e&&(n++,u()),r}var hit=[];!function(t,e,n){const i=cit(t);t=1===i.length?i[0]:t,oit((n&&n.get||ait)(i),[t],e||t)}("id");var dit=oit((function(t){return t}),hit,"identity");function pit(t,e,n){var i=[e].concat([].slice.call(n));console[t].apply(console,i)}oit((function(){return 0}),hit,"zero"),oit((function(){return 1}),hit,"one"),oit((function(){return!0}),hit,"true"),oit((function(){return!1}),hit,"false");var fit=Array.isArray;function git(t){return t===Object(t)}const mit=t=>"__proto__"!==t;function yit(...t){return t.reduce(((t,e)=>{for(var n in e)if("signals"===n)t.signals=xit(t.signals,e.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;vit(t,n,e[n],i)}return t}),{})}function vit(t,e,n,i){var r,o;if(mit(e))if(git(n)&&!fit(n))for(r in o=git(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?vit(o,r,n[r]):mit(r)&&(o[r]=n[r]);else t[e]=n}function xit(t,e){if(null==t)return e;const n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}function bit(t){return null!=t?fit(t)?t:[t]:[]}const wit=Object.prototype.hasOwnProperty;function _it(t,e){return wit.call(t,e)}function kit(t){return"boolean"==typeof t}function Sit(t){return"number"==typeof t}function Cit(t){return"string"==typeof t}function Ait(t){return fit(t)?"["+t.map(Ait)+"]":git(t)||Cit(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function Iit(t){for(var e={},n=0,i=t.length;n<i;++n)e[t[n]]=!0;return e}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mit=function(t,e){return(Mit=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Dit(t,e){function n(){this.constructor=t}Mit(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Tit=function(){return(Tit=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Eit(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}function Nit(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,t.call(i,e-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Oit=$a((function(t){var e=function(){function t(t,e){return null!=e&&t instanceof e}var e,n,i;try{e=Map}catch(t){e=function(){}}try{n=Set}catch(t){n=function(){}}try{i=Promise}catch(t){i=function(){}}function r(o,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var h=[],d=[],p="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function o(l,f){if(null===l)return null;if(0===f)return l;var g,m;if("object"!=typeof l)return l;if(t(l,e))g=new e;else if(t(l,n))g=new n;else if(t(l,i))g=new i((function(t,e){l.then((function(e){t(o(e,f-1))}),(function(t){e(o(t,f-1))}))}));else if(r.__isArray(l))g=[];else if(r.__isRegExp(l))g=new RegExp(l.source,a(l)),l.lastIndex&&(g.lastIndex=l.lastIndex);else if(r.__isDate(l))g=new Date(l.getTime());else{if(p&&Buffer.isBuffer(l))return g=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(g),g;t(l,Error)?g=Object.create(l):void 0===u?(m=Object.getPrototypeOf(l),g=Object.create(m)):(g=Object.create(u),m=u)}if(s){var y=h.indexOf(l);if(-1!=y)return d[y];h.push(l),d.push(g)}for(var v in t(l,e)&&l.forEach((function(t,e){var n=o(e,f-1),i=o(t,f-1);g.set(n,i)})),t(l,n)&&l.forEach((function(t){var e=o(t,f-1);g.add(e)})),l){var x;m&&(x=Object.getOwnPropertyDescriptor(m,v)),x&&null==x.set||(g[v]=o(l[v],f-1))}if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(l);for(v=0;v<b.length;v++){var w=b[v];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(g[w]=o(l[w],f-1),k.enumerable||Object.defineProperty(g,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(v=0;v<_.length;v++){var k,S=_[v];(k=Object.getOwnPropertyDescriptor(l,S))&&k.enumerable||(g[S]=o(l[S],f-1),Object.defineProperty(g,S,{enumerable:!1}))}}return g}(o,l)}function o(t){return Object.prototype.toString.call(t)}function a(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return r.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},r.__objToStr=o,r.__isDate=function(t){return"object"==typeof t&&"[object Date]"===o(t)},r.__isArray=function(t){return"object"==typeof t&&"[object Array]"===o(t)},r.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===o(t)},r.__getRegExpFlags=a,r}();t.exports&&(t.exports=e)})),Fit=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,i="boolean"==typeof e.cycles&&e.cycles,r=e.cmp&&(n=e.cmp,function(t){return function(e,i){var r={key:e,value:t[e]},o={key:i,value:t[i]};return n(r,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,a;if(Array.isArray(e)){for(a="[",n=0;n<e.length;n++)n&&(a+=","),a+=t(e[n])||"null";return a+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=o.push(e)-1,l=Object.keys(e).sort(r&&r(e));for(a="",n=0;n<l.length;n++){var u=l[n],c=t(e[u]);c&&(a&&(a+=","),a+=JSON.stringify(u)+":"+c)}return o.splice(s,1),"{"+a+"}"}}(t)};function Rit(t){return!!t.or}function Lit(t){return!!t.and}function $it(t){return!!t.not}function Pit(t,e){if($it(t))Pit(t.not,e);else if(Lit(t))for(const n of t.and)Pit(n,e);else if(Rit(t))for(const n of t.or)Pit(n,e);else e(t)}function zit(t,e){return $it(t)?{not:zit(t.not,e)}:Lit(t)?{and:t.and.map((t=>zit(t,e)))}:Rit(t)?{or:t.or.map((t=>zit(t,e)))}:e(t)}const Bit=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(e)){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((i=(o=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;0!=r--;){var a=o[r];if(!t(e[a],n[a]))return!1}return!0}return e!=e&&n!=n},Vit=Oit;function Wit(t,e){const n={};for(const i of e)_it(t,i)&&(n[i]=t[i]);return n}function jit(t,e){const n=Object.assign({},t);for(const t of e)delete n[t];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((t=>Fit(t))).join(",")})`};const Uit=Fit;function Git(t){if(Sit(t))return t;const e=Cit(t)?t:Fit(t);if(e.length<250)return e;let n=0;for(let t=0;t<e.length;t++){n=(n<<5)-n+e.charCodeAt(t),n&=n}return n}function Hit(t){return!1===t||null===t}function qit(t,e){return t.indexOf(e)>-1}function Xit(t,e){let n=0;for(const[i,r]of t.entries())if(e(r,i,n++))return!0;return!1}function Yit(t,e){let n=0;for(const[i,r]of t.entries())if(!e(r,i,n++))return!1;return!0}function Kit(t,e){for(const n of nrt(e))vit(t,n,e[n],!0)}function Zit(t,e){const n=[],i={};let r;for(const o of t)r=e(o),r in i||(i[r]=1,n.push(o));return n}function Jit(t,e){for(const n of t)if(e.has(n))return!0;return!1}function Qit(t){const e=new Set;for(const n of t){const t=cit(n).map(((t,e)=>0===e?t:`[${t}]`)),i=t.map(((e,n)=>t.slice(0,n+1).join("")));for(const t of i)e.add(t)}return e}function trt(t,e){return void 0===t||void 0===e||Jit(Qit(t),Qit(e))}function ert(t){return 0===nrt(t).length}const nrt=Object.keys,irt=Object.values;function rrt(t){const e=[];for(const n in t)_it(t,n)&&e.push({key:n,value:t[n]});return e}function ort(t){return!0===t||!1===t}function art(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function srt(t,e){return $it(t)?"!("+srt(t.not,e)+")":Lit(t)?"("+t.and.map((t=>srt(t,e))).join(") && (")+")":Rit(t)?"("+t.or.map((t=>srt(t,e))).join(") || (")+")":e(t)}function lrt(t,e){if(0===e.length)return!0;const n=e.shift();return n in t&&lrt(t[n],e)&&delete t[n],ert(t)}function urt(t){return t.charAt(0).toUpperCase()+t.substr(1)}function crt(t,e="datum"){const n=cit(t),i=[];for(let t=1;t<=n.length;t++){const r=`[${n.slice(0,t).map(Ait).join("][")}]`;i.push(`${e}${r}`)}return i.join(" && ")}function hrt(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function drt(t){return`${cit(t).map(hrt).join("\\.")}`}function prt(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function frt(t){return`${cit(t).join(".")}`}function grt(t){return t?cit(t).length:0}function mrt(...t){for(const e of t)if(void 0!==e)return e}let yrt=42;function vrt(t){if(void 0!==t)return(t%360+360)%360}function xrt(t){return!!Sit(t)||!isNaN(t)&&!isNaN(parseFloat(t))}const brt={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function wrt(t){return t&&t.condition}const _rt=["domain","grid","labels","ticks","title"],krt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Srt={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Crt=Object.assign(Object.assign({},Srt),{style:1,labelExpr:1,encoding:1});function Art(t){return!!Crt[t]}const Irt={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Mrt=Irt.arc,Drt=Irt.area,Trt=Irt.bar,Ert=Irt.image,Nrt=Irt.line,Ort=Irt.point,Frt=Irt.rect,Rrt=Irt.rule,Lrt=Irt.text,$rt=Irt.tick,Prt=Irt.trail,zrt=Irt.circle,Brt=Irt.square,Vrt=Irt.geoshape;function Wrt(t){return qit(["line","area","trail"],t)}function jrt(t){return qit(["rect","bar","image","arc"],t)}const Urt=nrt(Irt);function Grt(t){return t.type}Iit(Urt);const Hrt=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],qrt=nrt({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),Xrt={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Yrt={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},Krt={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function Zrt(t){return"mark"in t}class Jrt{constructor(t,e){this.name=t,this.run=e}hasMatchingType(t){return!!Zrt(t)&&(Grt(e=t.mark)?e.type:e)===this.name;var e}}const Qrt={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},tot={count:1,min:1,max:1};function eot(t){return!!t&&!!t.argmin}function not(t){return!!t&&!!t.argmax}function iot(t){return Cit(t)&&!!Qrt[t]}const rot=["count","valid","missing","distinct"];function oot(t){return Cit(t)&&qit(rot,t)}const aot=["count","sum","distinct","valid","missing"],sot=Iit(["mean","average","median","q1","q3","min","max"]),lot="row",uot="column",cot="x",hot="y",dot="x2",pot="y2",fot="radius",got="radius2",mot="theta",yot="theta2",vot="latitude",xot="longitude",bot="latitude2",wot="longitude2",_ot="color",kot="fill",Sot="stroke",Cot="shape",Aot="size",Iot="angle",Mot="opacity",Dot="text",Tot="key",Eot={theta:1,theta2:1,radius:1,radius2:1};function Not(t){return t in Eot}const Oot={longitude:1,longitude2:1,latitude:1,latitude2:1};const Fot=nrt(Oot),Rot=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),Eot),Oot),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Lot(t){return t===_ot||t===kot||t===Sot}const $ot={row:1,column:1,facet:1},Pot=nrt($ot),zot=Object.assign(Object.assign({},Rot),$ot),Bot=nrt(zot),Vot=Eit(zot,["order","detail","tooltip"]),Wot=Eit(Vot,["row","column","facet"]);function jot(t){return!!zot[t]}const Uot=[dot,pot,"latitude2","longitude2",yot,"radius2"];function Got(t){return Hot(t)!==t}function Hot(t){switch(t){case dot:return cot;case pot:return hot;case"latitude2":return"latitude";case"longitude2":return"longitude";case yot:return mot;case"radius2":return fot}return t}function qot(t){if(Not(t))switch(t){case mot:return"startAngle";case yot:return"endAngle";case fot:return"outerRadius";case"radius2":return"innerRadius"}return t}function Xot(t){switch(t){case cot:return dot;case hot:return pot;case"latitude":return"latitude2";case"longitude":return"longitude2";case mot:return yot;case fot:return"radius2"}}function Yot(t){switch(t){case cot:case dot:return"width";case hot:case pot:return"height"}}const Kot=Eit(Rot,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Zot=nrt(Kot),Jot={x:1,y:1},Qot=nrt(Jot);function tat(t){return t in Jot}const eat={theta:1,radius:1},nat=nrt(eat);function iat(t){return"width"===t?cot:hot}const rat=Eit(Kot,["text","tooltip","href","url","description","detail","key","order"]),oat=nrt(rat);const aat=Object.assign(Object.assign(Object.assign({},Jot),eat),rat),sat=nrt(aat);function lat(t){return!!aat[t]}function uat(t,e){return function(t){switch(t){case _ot:case kot:case Sot:case"description":case"detail":case"key":case"tooltip":case"href":case"order":case Mot:case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"facet":case lot:case uot:return cat;case cot:case hot:case vot:case"longitude":return hat;case dot:case pot:case bot:case wot:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Aot:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case"strokeDash":return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Cot:return{point:"always",geoshape:"always"};case"text":return{text:"always"};case Iot:return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case mot:case fot:return{text:"always",arc:"always"};case yot:case got:return{arc:"always"}}}(t)[e]}const cat={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},hat=Eit(cat,["geoshape"]);function dat(t){switch(t){case cot:case hot:case mot:case fot:case Aot:case Iot:case"strokeWidth":case Mot:case"fillOpacity":case"strokeOpacity":case dot:case pot:case yot:case got:return;case"facet":case lot:case uot:case Cot:case"strokeDash":case"text":case"tooltip":case"href":case"url":case"description":return"discrete";case _ot:case kot:case Sot:return"flexible";case vot:case"longitude":case bot:case wot:case"detail":case"key":case"order":return}}function pat(t){return kit(t)&&(t=Aut(t,void 0)),"bin"+nrt(t).map((e=>yat(t[e])?art(`_${e}_${Object.entries(t[e])}`):art(`_${e}_${t[e]}`))).join("")}function fat(t){return!0===t||mat(t)&&!t.binned}function gat(t){return"binned"===t||mat(t)&&!0===t.binned}function mat(t){return git(t)}function yat(t){return null==t?void 0:t.selection}function vat(t){switch(t){case lot:case uot:case Aot:case _ot:case kot:case Sot:case"strokeWidth":case Mot:case"fillOpacity":case"strokeOpacity":case Cot:return 6;case"strokeDash":return 4;default:return 10}}function xat(t){return`Invalid specification ${JSON.stringify(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const bat='Autosize "fit" only works for single views and layered views.';function wat(t){return`${"width"==t?"Width":"Height"} "container" only works for single views and layered views.`}function _at(t){return`${"width"==t?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==t?"x":"y"}".`}function kat(t){return t?`Dropping "fit-${t}" because spec has discrete ${Yot(t)}.`:'Dropping "fit" because spec has discrete size.'}function Sat(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function Cat(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function Aat(t){return`Selection not supported for ${t} yet.`}function Iat(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}function Mat(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}function Dat(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function Tat(t){return`Invalid field type "${t}".`}function Eat(t,e){const{fill:n,stroke:i}=e;return`Dropping color ${t} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Nat(t,e){return`Dropping ${Uit(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}function Oat(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?` when ${n}`:""}.`}function Fat(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function Rat(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${"ordinal"===e?"order":"magnitude"}.`}function Lat(t){return`Using unaggregated domain with raw field has no effect (${Uit(t)}).`}function $at(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function Pat(t){return`Unaggregated domain is currently unsupported for log scale (${Uit(t)}).`}function zat(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function Bat(t){return`The step for "${t}" is dropped because the ${"width"===t?"x":"y"} is continuous.`}const Vat="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function Wat(t,e){return`Invalid ${t}: ${Uit(e)}.`}function jat(t){return`1D error band does not support ${t}.`}function Uat(t){return`Channel ${t} is required for "binned" bin.`}const Gat=(qat=2||0,{level:function(t){return arguments.length?(qat=+t,this):qat},error:function(){return qat>=1&&pit(Hat||"error","ERROR",arguments),this},warn:function(){return qat>=2&&pit(Hat||"warn","WARN",arguments),this},info:function(){return qat>=3&&pit(Hat||"log","INFO",arguments),this},debug:function(){return qat>=4&&pit(Hat||"log","DEBUG",arguments),this}});var Hat,qat;let Xat=Gat;function Yat(...t){Xat.warn(...t)}function Kat(t){if(t&&git(t))for(const e of rst)if(e in t)return!0;return!1}const Zat=["january","february","march","april","may","june","july","august","september","october","november","december"],Jat=Zat.map((t=>t.substr(0,3))),Qat=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],tst=Qat.map((t=>t.substr(0,3)));function est(t,e){const n=[];if(e&&void 0!==t.day&&nrt(t).length>1&&(Yat(function(t){return`Dropping day from datetime ${Uit(t)} as day cannot be combined with other units.`}(t)),delete(t=Vit(t)).day),void 0!==t.year?n.push(t.year):n.push(2012),void 0!==t.month){const i=e?function(t){if(xrt(t)&&(t=+t),Sit(t))return t-1;{const e=t.toLowerCase(),n=Zat.indexOf(e);if(-1!==n)return n;const i=e.substr(0,3),r=Jat.indexOf(i);if(-1!==r)return r;throw new Error(Wat("month",t))}}(t.month):t.month;n.push(i)}else if(void 0!==t.quarter){const i=e?function(t){if(xrt(t)&&(t=+t),Sit(t))return t>4&&Yat(Wat("quarter",t)),t-1;throw new Error(Wat("quarter",t))}(t.quarter):t.quarter;n.push(Sit(i)?3*i:i+"*3")}else n.push(0);if(void 0!==t.date)n.push(t.date);else if(void 0!==t.day){const i=e?function(t){if(xrt(t)&&(t=+t),Sit(t))return t%7;{const e=t.toLowerCase(),n=Qat.indexOf(e);if(-1!==n)return n;const i=e.substr(0,3),r=tst.indexOf(i);if(-1!==r)return r;throw new Error(Wat("day",t))}}(t.day):t.day;n.push(Sit(i)?i+1:i+"+1")}else n.push(1);for(const e of["hours","minutes","seconds","milliseconds"]){const i=t[e];n.push(void 0===i?0:i)}return n}function nst(t){const e=est(t,!0).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}const ist={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},rst=nrt(ist);function ost(t){return t.startsWith("utc")}const ast={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function sst(t){const e=[];for(const n of rst)lst(t,n)&&e.push(n);return e}function lst(t,e){const n=t.indexOf(e);return!(n<0)&&(!(n>0&&"seconds"===e&&"i"===t.charAt(n-1))&&(!(t.length>n+3&&"day"===e&&"o"===t.charAt(n+3))&&!(n>0&&"year"===e&&"f"===t.charAt(n-1))))}function ust(t,e,{end:n}={end:!1}){const i=crt(e),r=ost(t)?"utc":"";let o;const a={};for(const e of rst)lst(t,e)&&(a[e]="quarter"===(s=e)?`(${r}quarter(${i})-1)`:`${r}${s}(${i})`,o=e);var s;return n&&(a[o]+="+1"),function(t){const e=est(t,!1).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}(a)}function cst(t){if(!t)return;const e=sst(t);return`timeUnitSpecifier(${Fit(e)}, ${Fit(ast)})`}function hst(t){if(!t)return;let e;return Cit(t)?e={unit:t}:git(t)&&(e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})),ost(e.unit)&&(e.utc=!0,e.unit=e.unit.substr(3)),e}function dst(t){return t&&!!t.signal}function pst(t){return!!t.step}function fst(t){return!fit(t)&&("field"in t&&"data"in t)}const gst=nrt({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),mst={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},yst=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function vst(t){return t&&!!t.field&&void 0!==t.equal}function xst(t){return t&&!!t.field&&void 0!==t.lt}function bst(t){return t&&!!t.field&&void 0!==t.lte}function wst(t){return t&&!!t.field&&void 0!==t.gt}function _st(t){return t&&!!t.field&&void 0!==t.gte}function kst(t){if(t&&t.field){if(fit(t.range)&&2===t.range.length)return!0;if(dst(t.range))return!0}return!1}function Sst(t){return t&&!!t.field&&(fit(t.oneOf)||fit(t.in))}function Cst(t){return Sst(t)||vst(t)||kst(t)||xst(t)||wst(t)||bst(t)||_st(t)}function Ast(t,e){return Dut(t,{timeUnit:e,wrapTime:!0})}function Ist(t,e=!0){var n;const{field:i}=t,r=null===(n=hst(t.timeUnit))||void 0===n?void 0:n.unit,o=r?"time("+ust(r,i)+")":hut(t,{expr:"datum"});if(vst(t))return o+"==="+Ast(t.equal,r);if(xst(t)){return`${o}<${Ast(t.lt,r)}`}if(wst(t)){return`${o}>${Ast(t.gt,r)}`}if(bst(t)){return`${o}<=${Ast(t.lte,r)}`}if(_st(t)){return`${o}>=${Ast(t.gte,r)}`}if(Sst(t))return`indexof([${function(t,e){return t.map((t=>Ast(t,e)))}(t.oneOf,r).join(",")}], ${o}) !== -1`;if(function(t){return t&&!!t.field&&void 0!==t.valid}(t))return Mst(o,t.valid);if(kst(t)){const{range:n}=t,i=dst(n)?{signal:`${n.signal}[0]`}:n[0],a=dst(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==i&&null!==a&&e)return"inrange("+o+", ["+Ast(i,r)+", "+Ast(a,r)+"])";const s=[];return null!==i&&s.push(`${o} >= ${Ast(i,r)}`),null!==a&&s.push(`${o} <= ${Ast(a,r)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(t)}`)}function Mst(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function Dst(t){var e;return Cst(t)&&t.timeUnit?Object.assign(Object.assign({},t),{timeUnit:null===(e=hst(t.timeUnit))||void 0===e?void 0:e.unit}):t}const Tst={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Est=Tst.quantitative,Nst=Tst.ordinal,Ost=Tst.temporal,Fst=Tst.nominal,Rst=Tst.geojson,Lst=nrt(Tst);const $st="linear",Pst="log",zst="pow",Bst="sqrt",Vst="symlog",Wst="time",jst="utc",Ust="quantile",Gst="quantize",Hst="threshold",qst="point",Xst="band",Yst={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},Kst=nrt(Yst);function Zst(t,e){const n=Yst[t],i=Yst[e];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const Jst={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Qst(t){return Jst[t]}const tlt=["linear","log","pow","sqrt","symlog","time","utc"],elt=Iit(tlt),nlt=Iit(["linear","log","pow","sqrt","symlog"]);const ilt=Iit(["quantile","quantize","threshold"]),rlt=Iit(tlt.concat(["quantile","quantize","threshold","sequential","identity"])),olt=Iit(["ordinal","bin-ordinal","point","band"]);function alt(t){return t in olt}function slt(t){return t in rlt}function llt(t){return t in elt}function ult(t){return t in ilt}function clt(t){return null==t?void 0:t.selection}const hlt=Eit({type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","scheme"]),dlt=nrt(hlt);function plt(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!qit(["point","band","identity"],t);case"bins":return!qit(["point","band","identity","ordinal"],t);case"round":return llt(t)||"band"===t||"point"===t;case"padding":return llt(t)||qit(["point","band"],t);case"paddingOuter":case"align":return qit(["point","band"],t);case"paddingInner":return"band"===t;case"domainMid":case"clamp":return llt(t);case"nice":return llt(t)||"quantize"===t||"threshold"===t;case"exponent":return"pow"===t;case"base":return"log"===t;case"constant":return"symlog"===t;case"zero":return slt(t)&&!qit(["log","time","utc","threshold","quantile"],t)}}function flt(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return Lot(t)?void 0:`Cannot use the scale property "${t}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function glt(t,e){return qit([Nst,Fst],e)?void 0===t||alt(t):e===Ost?qit([Wst,jst,void 0],t):e!==Est||qit([Pst,zst,Bst,Vst,Ust,Gst,Hst,$st,void 0],t)}function mlt(t,e){if(!lat(t))return!1;switch(t){case cot:case hot:case mot:case fot:return llt(e)||qit(["band","point"],e);case Aot:case"strokeWidth":case Mot:case"fillOpacity":case"strokeOpacity":case Iot:return llt(e)||ult(e)||qit(["band","point","ordinal"],e);case _ot:case kot:case Sot:return"band"!==e;case"strokeDash":return"ordinal"===e||ult(e);case Cot:return"ordinal"===e}}function ylt(t,e){return t+"_"+e}function vlt(t){const{channel:e,channelDef:n,markDef:i,scale:r,config:o}=t,a=Slt(t);return Qlt(n)&&!oot(n.aggregate)&&r&&llt(r.get("type"))&&!1===r.get("zero")?xlt({fieldDef:n,channel:e,markDef:i,ref:a,config:o}):a}function xlt({fieldDef:t,channel:e,markDef:n,ref:i,config:r}){if(Wrt(n.type))return i;return null===Put("invalid",n,r)?i:[blt(t,e),i]}function blt(t,e){const n=wlt(t,!0),i="y"===Hot(e)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function wlt(t,e=!0){return Mst(Cit(t)?t:hut(t,{expr:"datum"}),!e)}function _lt(t,e,n,i){const r={};if(e&&(r.scale=e),eut(t)){const{datum:e}=t;Kat(e)?r.signal=nst(e):dst(e)?r.signal=e.signal:r.value=e}else r.field=hut(t,n);if(i){const{offset:t,band:e}=i;t&&(r.offset=t),e&&(r.band=e)}return r}function klt({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:o=.5}){const a=0<o&&o<1?"datum":void 0,s=hut(e,{expr:a,suffix:r}),l=void 0!==n?hut(n,{expr:a}):hut(e,{suffix:"end",expr:a}),u={};if(0===o||1===o){u.scale=t;const e=0===o?s:l;u.field=e}else{const e=`${o} * ${s} + ${1-o} * ${l}`;u.signal=`scale("${t}", ${e})`}return i&&(u.offset=i),u}function Slt({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:o,scale:a,stack:s,offset:l,defaultRef:u,band:c}){var h;if(e){if(rut(e)){if(out(e)){c=null!=c?c:Xlt({channel:t,fieldDef:e,fieldDef2:n,markDef:i,stack:s,config:r,isMidPoint:!0});const{bin:a,timeUnit:u,type:h}=e;if(fat(a)||c&&u&&h===Ost)return s&&s.impute?_lt(e,o,{binSuffix:"mid"},{offset:l}):c?klt({scaleName:o,fieldOrDatumDef:e,band:c,offset:l}):_lt(e,o,Eut(e,t)?{binSuffix:"range"}:{},{offset:l});if(gat(a)){if(Qlt(n))return klt({scaleName:o,fieldOrDatumDef:e,fieldOrDatumDef2:n,band:c,offset:l});Yat(Uat(t===cot?dot:pot))}}const u=null==a?void 0:a.get("type");return _lt(e,o,alt(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(h=null!=c?c:e.band)&&void 0!==h?h:.5:void 0})}if(aut(e)){const n=e.value,i=l?{offset:l}:{};return Object.assign(Object.assign({},Clt(t,n)),i)}}return function(t){return"function"==typeof t}(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function Clt(t,e){return qit(["x","x2"],t)&&"width"===e?{field:{group:"width"}}:qit(["y","y2"],t)&&"height"===e?{field:{group:"height"}}:Fut(e)}function Alt(t){return t&&"number"!==t&&"time"!==t}function Ilt(t,e,n){return`${t}(${e}${n?`, ${JSON.stringify(n)}`:""})`}!function(){var t;const e={};for(const n of Bot)for(const i of Lst)for(const r of Kst){const o=ylt(n,i);mlt(n,r)&&glt(r,i)&&(e[o]=null!==(t=e[o])&&void 0!==t?t:[],e[o].push(r))}}();function Mlt({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:o}){var a,s;if(Alt(n))return Tlt({fieldOrDatumDef:t,format:e,formatType:n,expr:i,config:o});const l=Dlt(t,i,r);if(Mut(t)){const n=function(t,e,n,i,r){return!e||n?`${r?"utc":"time"}Format(${t}, '${n=Cit(n)?n:i}')`:function(t,e,n){if(!t)return;const i=cst(t);return`${n||ost(t)?"utc":"time"}Format(${e}, ${i})`}(e,t,r)}(l,Qlt(t)?null===(a=hst(t.timeUnit))||void 0===a?void 0:a.unit:void 0,e,o.timeFormat,sut(t)&&(null===(s=t.scale)||void 0===s?void 0:s.type)===jst);return n?{signal:n}:void 0}if(e=Olt(tut(t),e,o),Qlt(t)&&fat(t.bin)){return{signal:Llt(l,hut(t,{expr:i,binSuffix:"end"}),e,n,o)}}return e||"quantitative"===tut(t)?{signal:`${Flt(l,e)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function Dlt(t,e,n){return Qlt(t)?n?`${hut(t,{expr:e,suffix:"end"})}-${hut(t,{expr:e,suffix:"start"})}`:hut(t,{expr:e}):function(t){const{datum:e}=t;return Kat(e)?nst(e):`${JSON.stringify(e)}`}(t)}function Tlt({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:o,field:a}){if(a=null!=a?a:Dlt(t,i,r),Qlt(t)&&fat(t.bin)){return{signal:Llt(a,hut(t,{expr:i,binSuffix:"end"}),e,n,o)}}return{signal:Ilt(n,a,e)}}function Elt(t,e,n,i,r,o){var a;if(!Alt(i)){if(Mut(t)){return function(t,e,n,i){if(t)return t;if(e)return{signal:cst(e)};return i?void 0:n.timeFormat}(n,Qlt(t)?null===(a=hst(t.timeUnit))||void 0===a?void 0:a.unit:void 0,r,o)}return Olt(e,n,r)}}function Nlt(t,e,n){return t&&(dst(t)||"number"===t||"time"===t)?t:Mut(e)&&"time"!==n&&"utc"!==n?"time":void 0}function Olt(t,e,n){return Cit(e)?e:t===Est?n.numberFormat:void 0}function Flt(t,e){return`format(${t}, "${e||""}")`}function Rlt(t,e,n,i){var r;return Alt(n)?Ilt(n,t,e):Flt(t,null!==(r=Cit(e)?e:void 0)&&void 0!==r?r:i.numberFormat)}function Llt(t,e,n,i,r){const o=Rlt(t,n,i,r),a=Rlt(e,n,i,r);return`${Mst(t,!1)} ? "null" : ${o} + " – " + ${a}`}const $lt="min",Plt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function zlt(t){return t in Plt}function Blt(t){return!!t&&!!t.encoding}function Vlt(t){return!(!t||"count"!==t.op&&!t.field)}function Wlt(t){return!!t&&fit(t)}function jlt(t){return"row"in t||"column"in t}function Ult(t){return!!t&&"header"in t}function Glt(t){return"facet"in t}function Hlt(t){const{field:e,timeUnit:n,bin:i,aggregate:r}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:e})}function qlt(t){return out(t)&&"sort"in t}function Xlt({channel:t,fieldDef:e,fieldDef2:n,markDef:i,stack:r,config:o,isMidPoint:a}){if(rut(e)&&void 0!==e.band)return e.band;if(Qlt(e)){const{timeUnit:t,bin:r}=e;if(t&&!n)return a?zut("timeUnitBandPosition",i,o):jrt(i.type)?zut("timeUnitBand",i,o):0;if(fat(r))return jrt(i.type)&&!a?1:.5}return(null==r?void 0:r.fieldChannel)===t&&a?.5:void 0}function Ylt(t,e,n,i,r,o){return!!(fat(e.bin)||e.timeUnit&&out(e)&&"temporal"===e.type)&&!!Xlt({channel:t,fieldDef:e,fieldDef2:n,stack:i,markDef:r,config:o})}function Klt(t){return!!t&&"condition"in t}function Zlt(t){const e=t&&t.condition;return!!e&&!fit(e)&&Qlt(e)}function Jlt(t){const e=t&&t.condition;return!!e&&!fit(e)&&rut(e)}function Qlt(t){return!(!t||!t.field&&"count"!==t.aggregate)}function tut(t){return t&&t.type}function eut(t){return!!t&&"datum"in t}function nut(t){return out(t)&&put(t)||iut(t)}function iut(t){return eut(t)&&Sit(t.datum)}function rut(t){return Qlt(t)||eut(t)}function out(t){return!!t&&("field"in t&&"type"in t||"count"===t.aggregate)}function aut(t){return t&&"value"in t&&"value"in t}function sut(t){return!!t&&("scale"in t||"sort"in t)}function lut(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function uut(t){return!!t&&"legend"in t}function cut(t){return!!t&&("format"in t||"formatType"in t)}function hut(t,e={}){var n,i,r;let o=t.field;const a=e.prefix;let s=e.suffix,l="";if(function(t){return"count"===t.aggregate}(t))o=function(t){return 0===t.indexOf("__")}(u="count")?u:`__${u}`;else{let a;if(!e.nofn)if(function(t){return"op"in t}(t))a=t.op;else{const{bin:u,aggregate:c,timeUnit:h}=t;fat(u)?(a=pat(u),s=(null!==(n=e.binSuffix)&&void 0!==n?n:"")+(null!==(i=e.suffix)&&void 0!==i?i:"")):c?not(c)?(l=`["${o}"]`,o=`argmax_${c.argmax}`):eot(c)?(l=`["${o}"]`,o=`argmin_${c.argmin}`):a=String(c):h&&(a=function(t){const e=hst(t),{utc:n}=e,i=Eit(e,["utc"]);return i.unit?(n?"utc":"")+nrt(i).map((t=>art(`${"unit"===t?"":`_${t}_`}${i[t]}`))).join(""):(n?"utc":"")+"timeunit"+nrt(i).map((t=>art(`_${t}_${i[t]}`))).join("")}(h),s=(!qit(["range","mid"],e.binSuffix)&&e.binSuffix||"")+(null!==(r=e.suffix)&&void 0!==r?r:""))}a&&(o=o?`${a}_${o}`:a)}var u;return s&&(o=`${o}_${s}`),a&&(o=`${a}_${o}`),e.forAs?frt(o):e.expr?function(t,e="datum"){return`${e}[${Ait(cit(t).join("."))}]`}(o,e.expr)+l:drt(o)+l}function dut(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Qlt(t)&&!!t.bin;case"temporal":return!1}throw new Error(Tat(t.type))}function put(t){return!dut(t)}const fut=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return function(t){const{aggregate:e,bin:n,timeUnit:i,field:r}=t;if(not(e))return`${r} for argmax(${e.argmax})`;if(eot(e))return`${r} for argmin(${e.argmin})`;const o=hst(i),a=e||(null==o?void 0:o.unit)||(null==o?void 0:o.maxbins)&&"timeunit"||fat(n)&&"bin";return a?a.toUpperCase()+"("+r+")":r}(t);default:return function(t,e){var n;const{field:i,bin:r,timeUnit:o,aggregate:a}=t;if("count"===a)return e.countTitle;if(fat(r))return`${i} (binned)`;if(o){const t=null===(n=hst(o))||void 0===n?void 0:n.unit;if(t)return`${i} (${sst(t).join("-")})`}else if(a)return not(a)?`${i} for max ${a.argmax}`:eot(a)?`${i} for min ${a.argmin}`:`${urt(a)} of ${i}`;return i}(t,e)}};let gut=fut;function mut(t){gut=t}function yut(t,e,{allowDisabling:n,includeDefault:i=!0}){var r,o;const a=(null!==(r=vut(t))&&void 0!==r?r:{}).title;if(!Qlt(t))return a;const s=t,l=i?xut(s,e):void 0;return n?mrt(a,s.title,l):null!==(o=null!=a?a:s.title)&&void 0!==o?o:l}function vut(t){return lut(t)&&t.axis?t.axis:uut(t)&&t.legend?t.legend:Ult(t)&&t.header?t.header:void 0}function xut(t,e){return gut(t,e)}function but(t){var e;if(cut(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}{const n=null!==(e=vut(t))&&void 0!==e?e:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function wut(t){return Qlt(t)?t:Zlt(t)?t.condition:void 0}function _ut(t){return rut(t)?t:Jlt(t)?t.condition:void 0}function kut(t,e,n){if(Cit(t)||Sit(t)||kit(t)){return Yat(function(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${Uit(n)}}.`}(e,Cit(t)?"string":Sit(t)?"number":"boolean",t)),{value:t}}return rut(t)?Sut(t,e,n):Jlt(t)?Object.assign(Object.assign({},t),{condition:Sut(t.condition,e,n)}):t}function Sut(t,e,n){if(cut(t)){const{format:i,formatType:r}=t,o=Eit(t,["format","formatType"]);if(Alt(r)&&!n.customFormatTypes)return Yat(Dat(e)),Sut(o,e,n)}else{const i=lut(t)?"axis":uut(t)?"legend":Ult(t)?"header":null;if(i&&t[i]){const r=t[i],{format:o,formatType:a}=r,s=Eit(r,["format","formatType"]);if(Alt(a)&&!n.customFormatTypes)return Yat(Dat(e)),Sut(Object.assign(Object.assign({},t),{[i]:s}),e,n)}}return Qlt(t)?Cut(t,e):function(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=Sit(n)?"quantitative":Cit(n)?"nominal":Kat(n)?"temporal":void 0,Object.assign(Object.assign({},t),{type:e})}(t)}function Cut(t,e){const{aggregate:n,timeUnit:i,bin:r,field:o}=t,a=Object.assign({},t);if(!n||iot(n)||not(n)||eot(n)||(Yat(function(t){return`Invalid aggregation operator "${t}".`}(n)),delete a.aggregate),i&&(a.timeUnit=hst(i)),o&&(a.field=`${o}`),fat(r)&&(a.bin=Aut(r,e)),gat(r)&&!tat(e)&&Yat(`Channel ${e} should not be used with "binned" bin.`),out(a)){const{type:t}=a,e=function(t){if(t)switch(t=t.toLowerCase()){case"q":case Est:return"quantitative";case"t":case Ost:return"temporal";case"o":case Nst:return"ordinal";case"n":case Fst:return"nominal";case Rst:return"geojson"}}(t);t!==e&&(a.type=e),"quantitative"!==t&&oot(n)&&(Yat(function(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}(t,n)),a.type="quantitative")}else if(!Got(e)){const t=function(t,e){if(t.timeUnit)return"temporal";if(fat(t.bin))return"quantitative";switch(dat(e)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(a,e);Yat(function(t,e){return`Missing type for channel "${t}", using "${e}" instead.`}(e,t)),a.type=t}if(out(a)){const{compatible:t,warning:n}=function(t,e){const n=t.type;if("geojson"===n&&"shape"!==e)return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case lot:case uot:case"facet":return put(t)?{compatible:!1,warning:Fat(e)}:Iut;case cot:case hot:case _ot:case kot:case Sot:case Dot:case"detail":case Tot:case"tooltip":case"href":case"url":case Iot:case mot:case fot:case"description":return Iut;case xot:case wot:case vot:case bot:return n!==Est?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:Iut;case Mot:case"fillOpacity":case"strokeOpacity":case"strokeWidth":case Aot:case yot:case got:case dot:case pot:return"nominal"!==n||t.sort?Iut:{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`};case"strokeDash":return qit(["ordinal","nominal"],t.type)?Iut:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Cot:return qit(["ordinal","nominal","geojson"],t.type)?Iut:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==t.type||"sort"in t?Iut:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(a,e);t||Yat(n)}if(qlt(a)&&Cit(a.sort)){const{sort:t}=a;if(zlt(t))return Object.assign(Object.assign({},a),{sort:{encoding:t}});const e=t.substr(1);if("-"===t.charAt(0)&&zlt(e))return Object.assign(Object.assign({},a),{sort:{encoding:e,order:"descending"}})}if(Ult(a)){const{header:t}=a,{orient:e}=t,n=Eit(t,["orient"]);if(e)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},n),{labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e})})}return a}function Aut(t,e){return kit(t)?{maxbins:vat(e)}:"binned"===t?{binned:!0}:t.maxbins||t.step?t:Object.assign(Object.assign({},t),{maxbins:vat(e)})}const Iut={compatible:!0};function Mut(t){const{formatType:e}=but(t);return"time"===e||!e&&((n=t)&&("temporal"===n.type||Qlt(n)&&!!n.timeUnit));var n}function Dut(t,{timeUnit:e,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var o;const a=e&&(null===(o=hst(e))||void 0===o?void 0:o.unit);let s,l=a||"temporal"===n;return dst(t)?s=t.signal:Kat(t)?(l=!0,s=nst(t)):(Cit(t)||Sit(t))&&l&&(s=`datetime(${JSON.stringify(t)})`,function(t){return!!ist[t]}(a)&&(Sit(t)&&t<1e4||Cit(t)&&isNaN(Date.parse(t)))&&(s=nst({[a]:t}))),s?i&&l?`time(${s})`:s:r?void 0:JSON.stringify(t)}function Tut(t,e){const{type:n}=t;return e.map((e=>{const i=Dut(e,{timeUnit:Qlt(t)?t.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:e}))}function Eut(t,e){return fat(t.bin)?lat(e)&&qit(["ordinal","nominal"],t.type):(console.warn("Only call this method for binned field defs."),!1)}function Nut(t){const{anchor:e,frame:n,offset:i,orient:r,color:o,subtitleColor:a,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:h,subtitlePadding:d}=t,p=Eit(t,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),f=Object.assign(Object.assign({},p),o?{fill:o}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a?{subtitleColor:a}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),h?{subtitleLineHeight:h}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:f,subtitleMarkConfig:Wit(f,["align","baseline","dx","dy","limit"]),nonMark:g,subtitle:m}}function Out(t){return Cit(t)||fit(t)&&Cit(t[0])}function Fut(t){return dst(t)?t:void 0!==t?{value:t}:void 0}function Rut(t){return dst(t)?t.signal:Ait(t.value)}function Lut(t){return dst(t)?t.signal:null==t?null:Ait(t)}function $ut(t){var e;return[].concat(t.type,null!==(e=t.style)&&void 0!==e?e:[])}function Put(t,e,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&void 0!==e[r]?e[r]:void 0!==e[t]?e[t]:!o||r&&r!==t?zut(t,e,n,i):void 0}function zut(t,e,n,{vgChannel:i}={}){return mrt(i?But(t,e,n.style):void 0,But(t,e,n.style),i?n[e.type][i]:void 0,n[e.type][t],i?n.mark[i]:n.mark[t])}function But(t,e,n){return Vut(t,$ut(e),n)}function Vut(t,e,n){let i;e=bit(e);for(const r of e){const e=n[r];e&&void 0!==e[t]&&(i=e[t])}return i}function Wut(t,e){return bit(t).reduce(((t,n)=>{var i;return t.field.push(hut(n,e)),t.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),t}),{field:[],order:[]})}function jut(t,e){const n=[...t];return e.forEach((t=>{for(const e of n)if(Bit(e,t))return;n.push(t)})),n}function Uut(t,e){return Bit(t,e)||!e?t:t?[...bit(t),...bit(e)].join(", "):e}function Gut(t,e){const n=t.value,i=e.value;if(null==n||null===i)return{explicit:t.explicit,value:null};if((Out(n)||dst(n))&&(Out(i)||dst(i)))return{explicit:t.explicit,value:Uut(n,i)};if(Out(n)||dst(n))return{explicit:t.explicit,value:n};if(Out(i)||dst(i))return{explicit:t.explicit,value:i};if(!(Out(n)||dst(n)||Out(i)||dst(i)))return{explicit:t.explicit,value:jut(n,i)};throw new Error("It should never reach here")}function Hut(t,e){const n=t&&t[e];return!!n&&(fit(n)?Xit(n,(t=>!!t.field)):Qlt(n)||Zlt(n))}function qut(t){return Xit(Bot,(e=>{if(Hut(t,e)){const n=t[e];if(fit(n))return Xit(n,(t=>!!t.aggregate));{const t=wut(n);return t&&!!t.aggregate}}return!1}))}function Xut(t,e){const n=[],i=[],r=[],o=[],a={};return Zut(t,((s,l)=>{if(Qlt(s)){const{field:u,aggregate:c,bin:h,timeUnit:d}=s,p=Eit(s,["field","aggregate","bin","timeUnit"]);if(c||d||h){const t=vut(s),f=t&&t.title;let g=hut(s,{forAs:!0});const m=Object.assign(Object.assign(Object.assign({},f?[]:{title:yut(s,e,{allowDisabling:!0})}),p),{field:g});if(c){let t;if(not(c)?(t="argmax",g=hut({op:"argmax",field:c.argmax},{forAs:!0}),m.field=`${g}.${u}`):eot(c)?(t="argmin",g=hut({op:"argmin",field:c.argmin},{forAs:!0}),m.field=`${g}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(t=c),t){const e={op:t,as:g};u&&(e.field=u),o.push(e)}}else if(n.push(g),out(s)&&fat(h)){if(i.push({bin:h,field:u,as:g}),n.push(hut(s,{binSuffix:"end"})),Eut(s,l)&&n.push(hut(s,{binSuffix:"range"})),tat(l)){const t={field:g+"_end"};a[l+"2"]=t}m.bin="binned",Got(l)||(m.type=Est)}else if(d){r.push({timeUnit:d,field:u,as:g});const t=out(s)&&s.type!==Ost&&"time";t&&(l===Dot||"tooltip"===l?m.formatType=t:!function(t){return!!Kot[t]}(l)?tat(l)&&(m.axis=Object.assign({formatType:t},m.axis)):m.legend=Object.assign({formatType:t},m.legend))}a[l]=m}else n.push(u),a[l]=t[l]}else a[l]=t[l]})),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:a}}function Yut(t,e,n){const i=e.type;return nrt(t).reduce(((r,o)=>{if(!jot(o))return Yat(function(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}(o)),r;const a=t[o];if("angle"!==o||"arc"!==i||t.theta||(Yat("Arc marks uses theta channel rather than angle, replacing angle with theta."),o=mot),!function(t,e,n){const i=uat(e,n);if(!i)return!1;if("binned"===i){const n=t[e===dot?cot:hot];return!!(Qlt(n)&&Qlt(t[e])&&gat(n.bin))}return!0}(t,o,i))return Yat(Oat(o,i)),r;if(o===Aot&&"line"===i){const e=wut(t[o]);if(null==e?void 0:e.aggregate)return Yat("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),r}if(o===_ot&&(e.filled?"fill"in t:"stroke"in t))return Yat(Eat("encoding",{fill:"fill"in t,stroke:"stroke"in t})),r;if("detail"===o||"order"===o&&!fit(a)&&!aut(a)||"tooltip"===o&&fit(a))a&&(r[o]=bit(a).reduce(((t,e)=>(Qlt(e)?t.push(Cut(e,o)):Yat(Nat(e,o)),t)),[]));else{if("tooltip"===o&&null===a)r[o]=null;else if(!(Qlt(a)||eut(a)||aut(a)||Klt(a)||dst(a)))return Yat(Nat(a,o)),r;r[o]=kut(a,o,n)}return r}),{})}function Kut(t){const e=[];for(const n of nrt(t))if(Hut(t,n)){const i=bit(t[n]);for(const t of i)Qlt(t)?e.push(t):Zlt(t)&&e.push(t.condition)}return e}function Zut(t,e,n){if(t)for(const i of nrt(t)){const r=t[i];if(fit(r))for(const t of r)e.call(n,t,i);else e.call(n,r,i)}}function Jut(t,e,n,i){return t?nrt(t).reduce(((n,r)=>{const o=t[r];return fit(o)?o.reduce(((t,n)=>e.call(i,t,n,r)),n):e.call(i,n,o,r)}),n):n}function Qut(t,e){return nrt(e).reduce(((n,i)=>{switch(i){case cot:case hot:case"href":case"description":case"url":case dot:case pot:case mot:case yot:case fot:case got:case vot:case xot:case bot:case wot:case Dot:case Cot:case Iot:case"tooltip":return n;case"order":if("line"===t||"trail"===t)return n;case"detail":case Tot:{const t=e[i];if(fit(t)||Qlt(t))for(const e of bit(t))e.aggregate||n.push(hut(e,{}));return n}case Aot:if("trail"===t)return n;case _ot:case kot:case Sot:case Mot:case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const t=wut(e[i]);return t&&!t.aggregate&&n.push(hut(t,{})),n}}}),[])}function tct(t,e,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...t.map((({fieldPrefix:t,titlePrefix:n})=>{const r=i?` of ${e.field}`:"";return{field:t+e.field,type:e.type,title:dst(n)?{signal:n+`"${escape(r)}"`}:n+r}})),...Kut(n)]}}function ect(t){const{axis:e,title:n,field:i}=t;return e&&void 0!==e.title?void 0:mrt(n,i)}function nct(t,e,n,i,r){const{scale:o,axis:a}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,aria:h,extraEncoding:d={}})=>{const p=ect(n);return ict(t,s,r,h,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==p?{title:p}:{}),void 0!==o?{scale:o}:{}),void 0!==a?{axis:a}:{})},Cit(c)?{[e+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function ict(t,e,n,i,r){const{clip:o,color:a,opacity:s}=t,l=t.type;return t[e]||void 0===t[e]&&n[e]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[e]),o?{clip:o}:{}),a?{color:a}:{}),s?{opacity:s}:{}),Grt(r.mark)?r.mark:{type:r.mark}),{style:`${l}-${e}`}),kit(t[e])?{}:t[e]),!1===i?{aria:i}:{})})]:[]}function rct(t,e,n){const{encoding:i}=t,r="vertical"===e?"y":"x",o=i[r],a=i[r+"2"],s=i[r+"Error"],l=i[r+"Error2"];return{continuousAxisChannelDef:oct(o,n),continuousAxisChannelDef2:oct(a,n),continuousAxisChannelDefError:oct(s,n),continuousAxisChannelDefError2:oct(l,n),continuousAxis:r}}function oct(t,e){if(t&&t.aggregate){const{aggregate:n}=t,i=Eit(t,["aggregate"]);return n!==e&&Yat(function(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}(n,e)),i}return t}function act(t,e){const{mark:n,encoding:i}=t,{x:r,y:o}=i;if(nut(r)){if(nut(o)){const t=Qlt(r)&&r.aggregate,i=Qlt(o)&&o.aggregate;if(t||i!==e){if(i||t!==e){if(t===e&&i===e)throw new Error("Both x and y cannot have aggregate");return Grt(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(nut(o))return"vertical";throw new Error("Need a valid continuous axis for "+e+"s")}const sct=new Jrt("boxplot",uct);function lct(t){return Sit(t)?"tukey":t}function uct(t,{config:e}){var n,i;const{mark:r,encoding:o,selection:a,projection:s}=t,l=Eit(t,["mark","encoding","selection","projection"]),u=Grt(r)?r:{type:r};a&&Yat(Aat("boxplot"));const c=null!==(n=u.extent)&&void 0!==n?n:e.boxplot.extent,h=Put("size",u,e),d=lct(c),{transform:p,continuousAxisChannelDef:f,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:x,boxOrient:b,customTooltipWithoutAggregatedField:w}=function(t,e,n){const i=act(t,"boxplot"),{continuousAxisChannelDef:r,continuousAxis:o}=rct(t,i,"boxplot"),a=r.field,s=lct(e),l=[...cct(a),{op:"median",field:a,as:"mid_box_"+a},{op:"min",field:a,as:("min-max"===s?"lower_whisker_":"min_")+a},{op:"max",field:a,as:("min-max"===s?"upper_whisker_":"max_")+a}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${a}"] - datum["lower_box_${a}"]`,as:"iqr_"+a},{calculate:`min(datum["upper_box_${a}"] + datum["iqr_${a}"] * ${e}, datum["max_${a}"])`,as:"upper_whisker_"+a},{calculate:`max(datum["lower_box_${a}"] - datum["iqr_${a}"] * ${e}, datum["min_${a}"])`,as:"lower_whisker_"+a}],c=t.encoding,h=o;c[h];const d=Eit(c,["symbol"==typeof h?h:h+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:f}=function(t){const{tooltip:e}=t,n=Eit(t,["tooltip"]);if(!e)return{filteredEncoding:t};let i,r;if(fit(e)){for(const t of e)t.aggregate?(i||(i=[]),i.push(t)):(r||(r=[]),r.push(t));i&&(n.tooltip=i)}else e.aggregate?n.tooltip=e:r=e;return fit(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}(d),{bins:g,timeUnits:m,aggregate:y,groupby:v,encoding:x}=Xut(f,n),b="vertical"===i?"horizontal":"vertical",w=i;return{transform:[...g,...m,{aggregate:[...y,...l],groupby:v},...u],groupby:v,aggregate:y,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:x,ticksOrient:b,boxOrient:w,customTooltipWithoutAggregatedField:p}}(t,c,e),{color:_,size:k}=v,S=Eit(v,["color","size"]),C=t=>nct(u,g,f,t,e.boxplot),A=C(S),I=C(v),M=C(Object.assign(Object.assign({},S),k?{size:k}:{})),D=tct([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],f,v),T={type:"tick",color:"black",opacity:1,orient:x,invalid:null},E="min-max"===d?D:tct([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],f,v),N=[...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:E}),...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:E}),...A({partName:"ticks",mark:T,positionPrefix:"lower_whisker",aria:!1,extraEncoding:E}),...A({partName:"ticks",mark:T,positionPrefix:"upper_whisker",aria:!1,extraEncoding:E})],O=[..."tukey"!==d?N:[],...I({partName:"box",mark:Object.assign(Object.assign({type:"bar"},h?{size:h}:{}),{orient:b,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...M({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},git(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),h?{size:h}:{}),{orient:x,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let F;if("min-max"!==d){const t=`datum["lower_box_${f.field}"]`,n=`datum["upper_box_${f.field}"]`,i=`(${n} - ${t})`,r=`${t} - ${c} * ${i}`,o=`${n} + ${c} * ${i}`,a=`datum["${f.field}"]`,s={joinaggregate:cct(f.field),groupby:m};let l;"tukey"===d&&(l={transform:[{filter:`(${r} <= ${a}) && (${a} <= ${o})`},{aggregate:[{op:"min",field:f.field,as:"lower_whisker_"+f.field},{op:"max",field:f.field,as:"upper_whisker_"+f.field},{op:"min",field:"lower_box_"+f.field,as:"lower_box_"+f.field},{op:"max",field:"upper_box_"+f.field,as:"upper_box_"+f.field},...y],groupby:m}],layer:N});const h=Eit(S,["tooltip"]),{scale:p,axis:v}=f,x=ect(f),b=ict(u,"outliers",e.boxplot,!0,{transform:[{filter:`(${a} < ${r}) || (${a} > ${o})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:f.field,type:f.type},void 0!==x?{title:x}:{}),void 0!==p?{scale:p}:{}),void 0!==v?{axis:v}:{})},h),w?{tooltip:w}:{})})[0];b&&l?F={transform:[s],layer:[b,l]}:b?(F=b,F.transform.unshift(s)):l&&(F=l,F.transform.unshift(s))}return F?Object.assign(Object.assign({},l),{layer:[F,{transform:p,layer:O}]}):Object.assign(Object.assign({},l),{transform:(null!==(i=l.transform)&&void 0!==i?i:[]).concat(p),layer:O})}function cct(t){return[{op:"q1",field:t,as:"lower_box_"+t},{op:"q3",field:t,as:"upper_box_"+t}]}const hct=new Jrt("errorbar",dct);function dct(t,{config:e}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:a,markDef:s,outerSpec:l,tooltipEncoding:u}=fct(t,"errorbar",e),c=nct(s,r,i,o,e.errorbar),h={type:"tick",orient:a},d=[...c({partName:"ticks",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function pct(t,e){const{encoding:n}=t;if(function(t){return(rut(t.x)||rut(t.y))&&!rut(t.x2)&&!rut(t.y2)&&!rut(t.xError)&&!rut(t.xError2)&&!rut(t.yError)&&!rut(t.yError2)}(n))return{orient:act(t,e),inputType:"raw"};const i=function(t){return rut(t.x2)||rut(t.y2)}(n),r=function(t){return rut(t.xError)||rut(t.xError2)||rut(t.yError)||rut(t.yError2)}(n),o=n.x,a=n.y;if(i){if(r)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const t=n.x2,i=n.y2;if(rut(t)&&rut(i))throw new Error(`${e} cannot have both x2 and y2`);if(rut(t)){if(nut(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}if(rut(i)){if(nut(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}{const t=n.xError,i=n.xError2,r=n.yError,s=n.yError2;if(rut(i)&&!rut(t))throw new Error(`${e} cannot have xError2 without xError`);if(rut(s)&&!rut(r))throw new Error(`${e} cannot have yError2 without yError`);if(rut(t)&&rut(r))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(rut(t)){if(nut(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(rut(r)){if(nut(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function fct(t,e,n){var i;const{mark:r,encoding:o,selection:a,projection:s}=t,l=Eit(t,["mark","encoding","selection","projection"]),u=Grt(r)?r:{type:r};a&&Yat(Aat(e));const{orient:c,inputType:h}=pct(t,e),{continuousAxisChannelDef:d,continuousAxisChannelDef2:p,continuousAxisChannelDefError:f,continuousAxisChannelDefError2:g,continuousAxis:m}=rct(t,c,e),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:x,tooltipTitleWithFieldName:b}=function(t,e,n,i,r,o,a,s){let l=[],u=[];const c=e.field;let h,d=!1;if("raw"===o){const e=t.center?t.center:t.extent?"iqr"===t.extent?"median":"mean":s.errorbar.center,n=t.extent?t.extent:"mean"===e?"stderr":"iqr";if("median"===e!=("iqr"===n)&&Yat(function(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}(e,n,a)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:e,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],h=[{fieldPrefix:"center_",titlePrefix:urt(e)},{fieldPrefix:"upper_",titlePrefix:gct(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:gct(e,n,"-")}],d=!0;else{let e,i,r;t.center&&t.extent&&Yat(function(t,e){return`Center is not needed to be specified in ${e} when extent is ${t}.`}(t.extent,a)),"ci"===n?(e="mean",i="ci0",r="ci1"):(e="median",i="q1",r="q3"),l=[{op:i,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],h=[{fieldPrefix:"upper_",titlePrefix:yut({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:yut({field:c,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:yut({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&Yat((p=t.center,`${(f=t.extent)?"extent ":""}${f&&p?"and ":""}${p?"center ":""}${f&&p?"are ":"is "}not needed when data are aggregated.`)),"aggregated-upper-lower"===o?(h=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===o&&(h=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?u.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const t of u)h.push({fieldPrefix:t.as.substring(0,6),titlePrefix:prt(prt(t.calculate,'datum["',""),'"]',"")})}var p,f;return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:h,tooltipTitleWithFieldName:d}}(u,d,p,f,g,h,e,n),w=o,_=m;w[_];const k="x"===m?"x2":"y2";w[k];const S="x"===m?"xError":"yError";w[S];const C="x"===m?"xError2":"yError2";w[C];const A=Eit(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof S?S:S+"","symbol"==typeof C?C:C+""]),{bins:I,timeUnits:M,aggregate:D,groupby:T,encoding:E}=Xut(A,n),N=[...D,...y],O="raw"!==h?[]:T,F=tct(x,d,E,b);return{transform:[...null!==(i=l.transform)&&void 0!==i?i:[],...I,...M,...0===N.length?[]:[{aggregate:N,groupby:O}],...v],groupby:O,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:E,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:F}}function gct(t,e,n){return urt(t)+" "+n+" "+e}const mct=new Jrt("errorband",yct);function yct(t,{config:e}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:a,outerSpec:s,tooltipEncoding:l}=fct(t,"errorband",e),u=a,c=nct(u,r,i,o,e.errorband),h=void 0!==t.encoding.x&&void 0!==t.encoding.y;let d={type:h?"area":"rect"},p={type:h?"line":"rule"};const f=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return h?(d=Object.assign(Object.assign(Object.assign({},d),f),{ariaRoleDescription:"errorband"}),p=Object.assign(Object.assign({},p),f)):u.interpolate?Yat(jat("interpolate")):u.tension&&Yat(jat("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:p,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"borders",mark:p,positionPrefix:"upper",aria:!1,extraEncoding:l})]})}const vct={};function xct(t,e,n){const i=new Jrt(t,e);vct[t]={normalizer:i,parts:n}}xct("boxplot",uct,["box","median","outliers","rule","ticks"]),xct("errorbar",dct,["ticks","rule"]),xct("errorband",yct,["band","borders"]);const bct=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],wct=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],_ct={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},kct={single:{on:"click",fields:["_vgsid_"],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Sct(t){return!(!t||"legend"!==t&&!t.legend)}function Cct(t){return Sct(t)&&git(t)}function Act(t){return"concat"in t}function Ict(t){return"vconcat"in t}function Mct(t){return"hconcat"in t}function Dct(t){return git(t)&&void 0!==t.step}function Tct(t){return t.view||t.width||t.height}const Ect=nrt({align:1,bounds:1,center:1,columns:1,spacing:1});function Nct(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:t["width"===e?"continuousWidth":"continuousHeight"]}function Oct(t,e){const n=Fct(t,e);return Dct(n)?n.step:Rct}function Fct(t,e){var n;return mrt(null!==(n=t[e])&&void 0!==n?n:t["width"===e?"discreteWidth":"discreteHeight"],{step:t.step})}const Rct=20,Lct={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:Rct},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:Yrt,circle:{},geoshape:{},image:{},line:{},point:{},rect:Krt,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:kct,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},$ct=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Pct={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},zct={blue:$ct[0],orange:$ct[1],red:$ct[2],teal:$ct[3],green:$ct[4],yellow:$ct[5],purple:$ct[6],pink:$ct[7],brown:$ct[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Bct(t={}){const{color:e,font:n,fontSize:i}=t,r=Eit(t,["color","font","fontSize"]);return yit({},Lct,n?function(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}(n):{},e?function(t={}){return{signals:[{name:"color",value:git(t)?Object.assign(Object.assign({},zct),t):zct}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(e):{},i?function(t){return{signals:[{name:"fontSize",value:git(t)?Object.assign(Object.assign({},Pct),t):Pct}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},r||{})}const Vct=["view",...Urt],Wct=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],jct=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function Uct(t){t=Vit(t);for(const e of Wct)delete t[e];if(t.axis)for(const e in t.axis)wrt(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of bct)delete t.legend[e];if(t.mark){for(const e of qrt)delete t.mark[e];t.mark.tooltip&&git(t.mark.tooltip)&&delete t.mark.tooltip}for(const e of Vct){for(const n of qrt)delete t[e][n];const n=jct[e];if(n)for(const i of n)delete t[e][i];Gct(t,e)}for(const e of nrt(vct))delete t[e];!function(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:i}=Nut(t.title);ert(e)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e));ert(n)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),n));ert(i)?delete t.title:t.title=i}(t);for(const e in t)git(t[e])&&ert(t[e])&&delete t[e];return ert(t)?void 0:t}function Gct(t,e,n,i){const r=i?t[e][i]:t[e];"view"===e&&(n="cell");const o=Object.assign(Object.assign({},r),t.style[null!=n?n:e]);ert(o)||(t.style[null!=n?n:e]=o),i||delete t[e]}function Hct(t){return"layer"in t}class qct{map(t,e){return Glt(t)?this.mapFacet(t,e):function(t){return"repeat"in t}(t)?this.mapRepeat(t,e):Mct(t)?this.mapHConcat(t,e):Ict(t)?this.mapVConcat(t,e):Act(t)?this.mapConcat(t,e):this.mapLayerOrUnit(t,e)}mapLayerOrUnit(t,e){if(Hct(t))return this.mapLayer(t,e);if(Zrt(t))return this.mapUnit(t,e);throw new Error(xat(t))}mapLayer(t,e){return Object.assign(Object.assign({},t),{layer:t.layer.map((t=>this.mapLayerOrUnit(t,e)))})}mapHConcat(t,e){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map((t=>this.map(t,e)))})}mapVConcat(t,e){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map((t=>this.map(t,e)))})}mapConcat(t,e){const{concat:n}=t,i=Eit(t,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map((t=>this.map(t,e)))})}mapFacet(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}mapRepeat(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}}const Xct={zero:1,center:1,normalize:1};const Yct=new Set([Mrt,Trt,Drt,Rrt,Ort,zrt,Brt,Nrt,Lrt,$rt]),Kct=new Set([Trt,Drt,Mrt]);function Zct(t,e){var n,i;const r="x"===e?"y":"radius",o=t[e],a=t[r];if(Qlt(o)&&Qlt(a))if("quantitative"===tut(o)&&"quantitative"===tut(a)){if(o.stack)return e;if(a.stack)return r;const t=Qlt(o)&&!!o.aggregate;if(t!==(Qlt(a)&&!!a.aggregate))return t?e:r;{const t=null===(n=o.scale)||void 0===n?void 0:n.type,s=null===(i=a.scale)||void 0===i?void 0:i.type;if(t&&"linear"!==t)return r;if(s&&"linear"!==s)return e}}else{if("quantitative"===tut(o))return e;if("quantitative"===tut(a))return r}else{if("quantitative"===tut(o))return e;if("quantitative"===tut(a))return r}}function Jct(t,e,n={}){const i=Grt(t)?t.type:t;if(!Yct.has(i))return null;const r=Zct(e,"x")||Zct(e,"theta");if(!r)return null;const o=e[r],a=Qlt(o)?hut(o,{}):void 0;let s=function(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(r),l=e[s],u=Qlt(l)?hut(l,{}):void 0;u===a&&(u=void 0,l=void 0,s=void 0);const c=Zot.reduce(((t,n)=>{if("tooltip"!==n&&Hut(e,n)){const i=e[n];for(const e of bit(i)){const i=wut(e);if(i.aggregate)continue;const r=hut(i,{});r&&r===u||t.push({channel:n,fieldDef:i})}}return t}),[]);let h;if(void 0!==o.stack?h=kit(o.stack)?o.stack?"zero":null:o.stack:c.length>0&&Kct.has(i)&&(h="zero"),!h||!(h in Xct))return null;var d;if(qut(e)&&0===c.length)return null;if(o.scale&&o.scale.type&&o.scale.type!==$st){if(n.disallowNonLinearStack)return null;Yat(`Cannot stack non-linear scale (${o.scale.type}).`)}return rut(e[Xot(r)])?(void 0!==o.stack&&Yat(`Cannot stack "${d=r}" if there is already "${d}2".`),null):(Qlt(o)&&o.aggregate&&!qit(aot,o.aggregate)&&Yat(`Stacking is applied even though the aggregate function is non-summative ("${o.aggregate}").`),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:r,impute:null!==o.impute&&Wrt(i),stackBy:c,offset:h})}function Qct(t){const e=Eit(t,["point","line"]);return nrt(e).length>1?e:e.type}function tht(t){for(const e of["line","area","rule","trail"])t[e]&&(t=Object.assign(Object.assign({},t),{[e]:jit(t[e],["point","line"])}));return t}function eht(t,e={},n){return"transparent"===t.point?{opacity:0}:t.point?git(t.point)?t.point:{}:void 0!==t.point?null:e.point||n.shape?git(e.point)?e.point:{}:void 0}function nht(t,e={}){return t.line?!0===t.line?{}:t.line:void 0!==t.line?null:e.line?!0===e.line?{}:e.line:void 0}class iht{constructor(){this.name="path-overlay"}hasMatchingType(t,e){if(Zrt(t)){const{mark:n,encoding:i}=t,r=Grt(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!eht(r,e[r.type],i);case"area":return!!eht(r,e[r.type],i)||!!nht(r,e[r.type])}}return!1}run(t,e,n){const{config:i}=e,{selection:r,projection:o,encoding:a,mark:s}=t,l=Eit(t,["selection","projection","encoding","mark"]),u=Grt(s)?s:{type:s},c=eht(u,i[u.type],a),h="area"===u.type&&nht(u,i[u.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:Qct(Object.assign(Object.assign({},"area"===u.type&&void 0===u.opacity&&void 0===u.fillOpacity?{opacity:.7}:{}),u)),encoding:jit(a,["shape"])})],p=Jct(u,a);let f=a;if(p){const{fieldChannel:t,offset:e}=p;f=Object.assign(Object.assign({},a),{[t]:Object.assign(Object.assign({},a[t]),e?{stack:e}:{})})}return h&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},Wit(u,["clip","interpolate","tension","tooltip"])),h),encoding:f})),c&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Wit(u,["clip","tooltip"])),c),encoding:f})),n(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},e),{config:tht(i)}))}}class rht{constructor(){this.name="RangeStep"}hasMatchingType(t){var e;if(Zrt(t)&&t.encoding)for(const n of Qot){const i=t.encoding[n];if(i&&rut(i)&&(null===(e=null==i?void 0:i.scale)||void 0===e?void 0:e.rangeStep))return!0}return!1}run(t){var e;const n={};let i=Object.assign({},t.encoding);for(const t of Qot){const r=Yot(t),o=i[t];if(o&&rut(o)&&(null===(e=null==o?void 0:o.scale)||void 0===e?void 0:e.rangeStep)){const{scale:e}=o,a=Eit(o,["scale"]),s=Eit(e,["rangeStep"]);n[r]={step:e.rangeStep},Yat('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),i=Object.assign(Object.assign({},i),{[t]:Object.assign(Object.assign({},a),ert(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),t),{encoding:i})}}function oht(t,e){return e?jlt(t)?hht(t,e):lht(t,e):t}function aht(t,e){return e?hht(t,e):t}function sht(t,e,n){const i=e[t];return(r=i)&&!Cit(r)&&"repeat"in r?i.repeat in n?Object.assign(Object.assign({},e),{[t]:n[i.repeat]}):void Yat(function(t){return`Unknown repeated value "${t}".`}(i.repeat)):e;var r}function lht(t,e){if(void 0!==(t=sht("field",t,e))){if(null===t)return null;if(qlt(t)&&Vlt(t.sort)){const n=sht("field",t.sort,e);t=Object.assign(Object.assign({},t),n?{sort:n}:{})}return t}}function uht(t,e){if(Qlt(t))return lht(t,e);{const n=sht("datum",t,e);return n===t||n.type||(n.type="nominal"),n}}function cht(t,e){if(!rut(t)){if(Jlt(t)){const n=uht(t.condition,e);if(n)return Object.assign(Object.assign({},t),{condition:n});return Eit(t,["condition"])}return t}{const n=uht(t,e);if(n)return n;if(Klt(t))return{condition:t.condition}}}function hht(t,e){const n={};for(const i in t)if(_it(t,i)){const r=t[i];if(fit(r))n[i]=r.map((t=>cht(t,e))).filter((t=>t));else{const t=cht(r,e);void 0!==t&&(n[i]=t)}}return n}class dht{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Zrt(t)){const{encoding:e,mark:n}=t;if("line"===n)for(const t of Uot){const n=e[Hot(t)];if(e[t]&&(Qlt(n)&&!gat(n.bin)||eut(n)))return!0}}return!1}run(t,e,n){const{encoding:i}=t;var r,o;return Yat((r=!!i.x2,o=!!i.y2,`Line mark is for continuous lines and thus cannot be used with ${r&&o?"x2 and y2":r?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},t),{mark:"rule"}),e)}}function pht(t){const{parentEncoding:e,encoding:n}=t;if(e&&n){const t=nrt(e).reduce(((t,e)=>(n[e]&&t.push(e),t)),[]);t.length>0&&Yat(`Layer's shared ${(i=t).join(",")} channel ${1===i.length?"is":"are"} overriden.`)}var i;const r=Object.assign(Object.assign({},null!=e?e:{}),null!=n?n:{});return ert(r)?void 0:r}function fht(t){const{parentProjection:e,projection:n}=t;return e&&n&&Yat(function(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${Uit(e)} is overridden by a child projection ${Uit(n)}.`}({parentProjection:e,projection:n})),null!=n?n:e}function ght(t,e){void 0===e&&(e=Bct(t.config));const n=function(t,e={}){return mht.map(t,{config:e})}(t,e),{width:i,height:r}=t,o=function(t,e,n){let{width:i,height:r}=e;const o=Zrt(t)||Hct(t),a={};o?"container"==i&&"container"==r?(a.type="fit",a.contains="padding"):"container"==i?(a.type="fit-x",a.contains="padding"):"container"==r&&(a.type="fit-y",a.contains="padding"):("container"==i&&(Yat(wat("width")),i=void 0),"container"==r&&(Yat(wat("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},a),n?yht(n.autosize):{}),yht(t.autosize));"fit"!==s.type||o||(Yat(bat),s.type="pad");"container"==i&&"fit"!=s.type&&"fit-x"!=s.type&&Yat(_at("width"));"container"==r&&"fit"!=s.type&&"fit-y"!=s.type&&Yat(_at("height"));if(Bit(s,{type:"pad"}))return;return s}(n,{width:i,height:r,autosize:t.autosize},e);return Object.assign(Object.assign({},n),o?{autosize:o}:{})}const mht=new class extends qct{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[sct,hct,mct,new iht,new dht,new rht]}map(t,e){if(Zrt(t)){const n=Hut(t.encoding,lot),i=Hut(t.encoding,uot),r=Hut(t.encoding,"facet");if(n||i||r)return this.mapFacetedUnit(t,e)}return super.map(t,e)}mapUnit(t,e){const{parentEncoding:n,parentProjection:i}=e,r=Object.assign(Object.assign({},t),{encoding:aht(t.encoding,e.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,e);const o=this.mapLayerOrUnit.bind(this);for(const t of this.nonFacetUnitNormalizers)if(t.hasMatchingType(r,e.config))return t.run(r,e,o);return r}mapRepeat(t,e){return function(t){return!fit(t.repeat)&&t.repeat.layer}(t)?this.mapLayerRepeat(t,e):this.mapNonLayerRepeat(t,e)}mapLayerRepeat(t,e){const{repeat:n,spec:i}=t,r=Eit(t,["repeat","spec"]),{row:o,column:a,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=e;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:s},spec:i}}),e):Object.assign(Object.assign({},r),{layer:s.map((t=>{const n=Object.assign(Object.assign({},l),{layer:t}),r=(i.name||"")+u+`child__layer_${art(t)}`,o=this.mapLayerOrUnit(i,Object.assign(Object.assign({},e),{repeater:n,repeaterPrefix:r}));return o.name=r,o}))})}mapNonLayerRepeat(t,e){var n;const{repeat:i,spec:r,data:o}=t,a=Eit(t,["repeat","spec","data"]);!fit(i)&&t.columns&&(t=jit(t,["columns"]),Yat(Iat("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=e,c=!fit(i)&&i.row||[l?l.row:null],h=!fit(i)&&i.column||[l?l.column:null],d=fit(i)&&i||[l?l.repeat:null];for(const t of d)for(const n of c)for(const o of h){const a={repeat:t,row:n,column:o,layer:l.layer},c=(r.name||"")+u+"child__"+(fit(i)?`${art(t)}`:(i.row?`row_${art(n)}`:"")+(i.column?`column_${art(o)}`:"")),h=this.map(r,Object.assign(Object.assign({},e),{repeater:a,repeaterPrefix:c}));h.name=c,s.push(jit(h,["data"]))}const p=fit(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=r.data)&&void 0!==n?n:o,align:"all"},a),{columns:p,concat:s})}mapFacet(t,e){const{facet:n}=t;return jlt(n)&&t.columns&&(t=jit(t,["columns"]),Yat(Iat("facet"))),super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){const{encoding:n,projection:i}=t,{parentEncoding:r,parentProjection:o,config:a}=e,s=fht({parentProjection:o,projection:i}),l=pht({parentEncoding:r,encoding:aht(n,e.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),s?{projection:s}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,e){const n=t.encoding,{row:i,column:r,facet:o}=n,a=Eit(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:h,selection:d,encoding:p}=t,f=Eit(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:o},e),y=aht(a,e.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},f),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),h?{view:h}:{}),u?{projection:u}:{}),{mark:s,encoding:y}),d?{selection:d}:{})}),e)}getFacetMappingAndLayout(t,e){var n;const{row:i,column:r,facet:o}=t;if(i||r){o&&Yat(`Facet encoding dropped as ${(a=[...i?[lot]:[],...r?[uot]:[]]).join(" and ")} ${a.length>1?"are":"is"} also specified.`);const e={},s={};for(const i of[lot,uot]){const r=t[i];if(r){const t=Eit(r,["align","center","spacing","columns"]);e[i]=t;for(const t of["align","center","spacing"])void 0!==r[t]&&(s[t]=null!==(n=s[t])&&void 0!==n?n:{},s[t][i]=r[t])}}return{facetMapping:e,layout:s}}{const{align:t,center:n,spacing:i,columns:r}=o;return{facetMapping:oht(Eit(o,["align","center","spacing","columns"]),e.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},t?{align:t}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}var a}mapLayer(t,e){var{parentEncoding:n,parentProjection:i}=e,r=Eit(e,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,s=Eit(t,["encoding","projection"]),l=Object.assign(Object.assign({},r),{parentEncoding:pht({parentEncoding:n,encoding:o}),parentProjection:fht({parentProjection:i,projection:a})});return super.mapLayer(s,l)}};function yht(t){return Cit(t)?{type:t}:null!=t?t:{}}const vht=["background","padding"];function xht(t){return vht.reduce(((e,n)=>(t&&void 0!==t[n]&&(e[n]=t[n]),e)),{})}class bht{constructor(t={},e={}){this.explicit=t,this.implicit=e}clone(){return new bht(Vit(this.explicit),Vit(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return mrt(this.explicit[t],this.implicit[t])}getWithExplicit(t){return void 0!==this.explicit[t]?{explicit:!0,value:this.explicit[t]}:void 0!==this.implicit[t]?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,e){void 0!==e.value&&this.set(t,e.value,e.explicit)}set(t,e,n){return delete this[n?"implicit":"explicit"][t],this[n?"explicit":"implicit"][t]=e,this}copyKeyFromSplit(t,e){void 0!==e.explicit[t]?this.set(t,e.explicit[t],!0):void 0!==e.implicit[t]&&this.set(t,e.implicit[t],!1)}copyKeyFromObject(t,e){void 0!==e[t]&&this.set(t,e[t],!0)}copyAll(t){for(const e of nrt(t.combine())){const n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}}function wht(t){return{explicit:!0,value:t}}function _ht(t){return{explicit:!1,value:t}}function kht(t){return(e,n,i,r)=>{const o=t(e.value,n.value);return o>0?e:o<0?n:Sht(e,n,i,r)}}function Sht(t,e,n,i){return t.explicit&&e.explicit&&Yat(function(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${Uit(n)} and ${Uit(i)}). Using ${Uit(n)}.`}(n,i,t.value,e.value)),t}function Cht(t,e,n,i,r=Sht){return void 0===t||void 0===t.value?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:Bit(t.value,e.value)?t:r(t,e,n,i)}class Aht extends bht{constructor(t={},e={},n=!1){super(t,e),this.explicit=t,this.implicit=e,this.parseNothing=n}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Iht(t){return"url"in t}function Mht(t){return"values"in t}function Dht(t){return"name"in t&&!Iht(t)&&!Mht(t)&&!Tht(t)}function Tht(t){return t&&(Eht(t)||Nht(t)||Oht(t))}function Eht(t){return"sequence"in t}function Nht(t){return"sphere"in t}function Oht(t){return"graticule"in t}const Fht="main";function Rht(t){return"filter"in t}function Lht(t){return"lookup"in t}function $ht(t){return"pivot"in t}function Pht(t){return"density"in t}function zht(t){return"quantile"in t}function Bht(t){return"regression"in t}function Vht(t){return"loess"in t}function Wht(t){return"sample"in t}function jht(t){return"window"in t}function Uht(t){return"joinaggregate"in t}function Ght(t){return"flatten"in t}function Hht(t){return"calculate"in t}function qht(t){return"bin"in t}function Xht(t){return"impute"in t}function Yht(t){return"timeUnit"in t}function Kht(t){return"aggregate"in t}function Zht(t){return"stack"in t}function Jht(t){return"fold"in t}function Qht(t,e,n,i){const r=Klt(e)&&e.condition,o=i(e);if(r){return{[n]:[...bit(r).map((e=>{const n=i(e),r=function(t){return t.selection}(e)?mft(t,e.selection):vft(t,e.test);return Object.assign({test:r},n)})),...void 0!==o?[o]:[]]}}return void 0!==o?{[n]:o}:{}}function tdt(t,e="text"){const n=t.encoding[e];return Qht(t,n,e,(e=>edt(e,t.config)))}function edt(t,e,n="datum"){if(t){if(aut(t))return Fut(t.value);if(rut(t)){const{format:i,formatType:r}=but(t);return Mlt({fieldOrDatumDef:t,format:i,formatType:r,expr:n,config:e})}}}function ndt(t,e={}){const{encoding:n,markDef:i,config:r,stack:o}=t,a=n.tooltip;if(fit(a))return{tooltip:rdt({tooltip:a},o,r,e)};{const s=e.reactiveGeom?"datum.datum":"datum";return Qht(t,a,"tooltip",(t=>{const a=edt(t,r,s);if(a)return a;if(null===t)return;let l=Put("tooltip",i,r);return!0===l&&(l={content:"encoding"}),Cit(l)?{value:l}:git(l)?"encoding"===l.content?rdt(n,o,r,e):{signal:s}:void 0}))}}function idt(t,e,n,{reactiveGeom:i}={}){const r={},o=i?"datum.datum":"datum",a=[];function s(i,s){const l=Hot(s),u=out(i)?i:Object.assign(Object.assign({},i),{type:t[l].type}),c=bit(yut(u,n,{allowDisabling:!1})).join(", ");let h;if(tat(s)){const i="x"===s?"x2":"y2",a=wut(t[i]);if(gat(u.bin)&&a){const t=hut(u,{expr:o}),e=hut(a,{expr:o}),{format:s,formatType:l}=but(u);h=Llt(t,e,s,l,n),r[i]=!0}else if(e&&e.fieldChannel===s&&"normalize"===e.offset){const{format:t,formatType:e}=but(u);h=Mlt({fieldOrDatumDef:u,format:t,formatType:e,expr:o,config:n,normalizeStack:!0}).signal}}h=null!=h?h:edt(u,n,o).signal,a.push({channel:s,key:c,value:h})}Zut(t,((t,e)=>{Qlt(t)?s(t,e):Zlt(t)&&s(t.condition,e)}));const l={};for(const{channel:t,key:e,value:n}of a)r[t]||l[e]||(l[Ait(e)]=n);return l}function rdt(t,e,n,{reactiveGeom:i}={}){const r=rrt(idt(t,e,n,{reactiveGeom:i})).map((({key:t,value:e})=>`${t}: ${e}`));return r.length>0?{signal:`{${r.join(", ")}}`}:void 0}function odt(t){const{markDef:e,config:n}=t,i=Put("aria",e,n);return!1===i?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(t){const{mark:e,markDef:n,config:i}=t;if(!1===i.aria)return{};const r=Put("ariaRoleDescription",n,i);if(null!=r)return{ariaRoleDescription:{value:r}};return e in mst?{}:{ariaRoleDescription:{value:e}}}(t)),function(t){const{encoding:e,markDef:n,config:i,stack:r}=t,o=e.description;if(o)return Qht(t,o,"description",(e=>edt(e,t.config)));const a=Put("description",n,i);if(null!=a)return{description:Fut(a)};if(!1===i.aria)return{};const s=idt(e,r,i);if(ert(s))return;return{description:{signal:rrt(s).map((({key:t,value:e})=>`${t} + ": " + (${e})`)).join(' + "; " + ')}}}(t))}function adt(t,e,n={}){const{markDef:i,encoding:r,config:o}=e,{vgChannel:a}=n;let{defaultRef:s,defaultValue:l}=n;void 0===s&&(l=null!=l?l:Put(t,i,o,{vgChannel:a,ignoreVgConfig:!0}),void 0!==l&&(s=Fut(l)));const u=r[t];return Qht(e,u,null!=a?a:t,(n=>Slt({channel:t,channelDef:n,markDef:i,config:o,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:s})))}function sdt(t,e={filled:void 0}){var n,i,r,o;const{markDef:a,encoding:s,config:l}=t,{type:u}=a,c=null!==(n=e.filled)&&void 0!==n?n:Put("filled",a,l),h=qit(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(r=null!==(i=Put(!0===c?"color":void 0,a,l,{vgChannel:"fill"}))&&void 0!==i?i:l.mark[!0===c&&"color"])&&void 0!==r?r:h,p=null!==(o=Put(!1===c?"color":void 0,a,l,{vgChannel:"stroke"}))&&void 0!==o?o:l.mark[!1===c&&"color"],f=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:Fut(d)}:{}),p?{stroke:Fut(p)}:{});return a.color&&(c?a.fill:a.stroke)&&Yat(Eat("property",{fill:"fill"in a,stroke:"stroke"in a})),Object.assign(Object.assign(Object.assign(Object.assign({},g),adt("color",t,{vgChannel:f,defaultValue:c?d:p})),adt("fill",t,{defaultValue:s.fill?d:void 0})),adt("stroke",t,{defaultValue:s.stroke?p:void 0}))}function ldt(t,e){const n=e[function(t){switch(t){case cot:return"xOffset";case hot:return"yOffset";case dot:return"x2Offset";case pot:return"y2Offset";case mot:return"thetaOffset";case fot:return"radiusOffset";case yot:return"theta2Offset";case"radius2":return"radius2Offset"}}(t)];if(n)return n}function udt(t,e,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:o,markDef:a,config:s,stack:l}=e,u=o[t],c=o[Xot(t)],h=e.scaleName(t),d=e.getScaleComponent(t),p=ldt(t,a),f=cdt({model:e,defaultPos:n,channel:t,scaleName:h,scale:d}),g=!u&&tat(t)&&(o.latitude||o.longitude)?{field:e.getName(t)}:function(t){const{channel:e,channelDef:n,isMidPoint:i,scaleName:r,stack:o,offset:a,markDef:s,config:l}=t;if(rut(n)&&o&&e===o.fieldChannel){if(Qlt(n)){const t=Xlt({channel:e,fieldDef:n,isMidPoint:i,markDef:s,stack:o,config:l});if(void 0!==t)return klt({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:t,offset:a})}return _lt(n,r,{suffix:"end"},{offset:a})}return vlt(t)}({channel:t,channelDef:u,channel2Def:c,markDef:a,config:s,isMidPoint:r,scaleName:h,scale:d,stack:l,offset:p,defaultRef:f});return g?{[i||t]:g}:void 0}function cdt({model:t,defaultPos:e,channel:n,scaleName:i,scale:r}){const{markDef:o,config:a}=t;return()=>{const s=Hot(n),l=qot(n),u=Put(n,o,a,{vgChannel:l});if(void 0!==u)return Clt(n,u);switch(e){case"zeroOrMin":case"zeroOrMax":if(i){const t=r.get("type");if(qit([Pst,Wst,jst],t));else if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===e)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const e=t[Yot(n)];return Object.assign(Object.assign({},e),{mult:.5})}}}}const hdt={left:"x",center:"xc",right:"x2"},ddt={top:"y",middle:"yc",bottom:"y2"};function pdt(t,e,n,i="middle"){if("radius"===t||"theta"===t)return qot(t);const r=Put("x"===t?"align":"baseline",e,n);return"x"===t?hdt[r||("top"===i?"left":"center")]:ddt[r||i]}function fdt(t,e,{defaultPos:n,defaultPos2:i,range:r}){return r?gdt(t,e,{defaultPos:n,defaultPos2:i}):udt(t,e,{defaultPos:n})}function gdt(t,e,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=e,a=Xot(t),s=Yot(t),l=function(t,e,n){const{encoding:i,mark:r,markDef:o,stack:a,config:s}=t,l=Hot(n),u=Yot(n),c=qot(n),h=i[l],d=t.scaleName(l),p=t.getScaleComponent(l),f=ldt(n in i||n in o?n:l,t.markDef);if(!h&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return{[c]:{field:t.getName(n)}};const g=function({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:o,scale:a,stack:s,offset:l,defaultRef:u}){if(rut(e)&&s&&t.charAt(0)===s.fieldChannel.charAt(0))return _lt(e,o,{suffix:"start"},{offset:l});return vlt({channel:t,channelDef:n,scaleName:o,scale:a,stack:s,markDef:i,config:r,offset:l,defaultRef:u})}({channel:n,channelDef:h,channel2Def:i[n],markDef:o,config:s,scaleName:d,scale:p,stack:a,offset:f,defaultRef:void 0});if(void 0!==g)return{[c]:g};return mdt(n,o)||mdt(n,{[n]:But(n,o,s.style),[u]:But(u,o,s.style)})||mdt(n,s[r])||mdt(n,s.mark)||{[c]:cdt({model:t,defaultPos:e,channel:n,scaleName:d,scale:p})()}}(e,i,a),u=l[s]?pdt(t,r,o):qot(t);return Object.assign(Object.assign({},udt(t,e,{defaultPos:n,vgChannel:u})),l)}function mdt(t,e){const n=Yot(t),i=qot(t);return void 0!==e[i]?{[i]:Clt(t,e[i])}:void 0!==e[t]?{[i]:Clt(t,e[t])}:e[n]?{[n]:Clt(t,e[n])}:void 0}function ydt(t,e,n){var i,r,o,a;const{config:s,encoding:l,markDef:u,stack:c}=t,h=Xot(e),d=Yot(e),p=l[e],f=l[h],g=t.getScaleComponent(e),m=g?g.get("type"):void 0,y=t.scaleName(e),v=u.orient,x=null!==(r=null!==(i=l[d])&&void 0!==i?i:l.size)&&void 0!==r?r:Put("size",u,s,{vgChannel:d}),b="bar"===n&&("x"===e?"vertical"===v:"horizontal"===v);if(Qlt(p)&&(fat(p.bin)||gat(p.bin)||p.timeUnit&&!f)&&!x&&!alt(m)){const n=Xlt({channel:e,fieldDef:p,stack:c,markDef:u,config:s}),i=null===(o=t.component.axes[e])||void 0===o?void 0:o[0];return function({fieldDef:t,fieldDef2:e,channel:n,band:i,scaleName:r,markDef:o,spacing:a=0,axisTranslate:s,reverse:l,config:u}){const c=Xot(n),h=qot(n),d=qot(c),p=ldt(n,o);if(fat(t.bin)||t.timeUnit)return{[d]:bdt({channel:n,fieldDef:t,scaleName:r,markDef:o,band:(1-i)/2,offset:xdt(c,a,l,s,p),config:u}),[h]:bdt({channel:n,fieldDef:t,scaleName:r,markDef:o,band:1-(1-i)/2,offset:xdt(n,a,l,s,p),config:u})};if(gat(t.bin)){const i=_lt(t,r,{},{offset:xdt(c,a,l,s,p)});if(Qlt(e))return{[d]:i,[h]:_lt(e,r,{},{offset:xdt(n,a,l,s,p)})};if(mat(t.bin)&&t.bin.step)return{[d]:i,[h]:{signal:`scale("${r}", ${hut(t,{expr:"datum"})} + ${t.bin.step})`,offset:xdt(n,a,l,s,p)}}}return void Yat(Uat(c))}({fieldDef:p,fieldDef2:f,channel:e,markDef:u,scaleName:y,band:n,axisTranslate:null!==(a=null==i?void 0:i.get("translate"))&&void 0!==a?a:.5,spacing:tat(e)?Put("binSpacing",u,s):void 0,reverse:g.get("reverse"),config:s})}return(rut(p)&&alt(m)||b)&&!f?function(t,e,n,i){var r;const{markDef:o,encoding:a,config:s,stack:l}=i,u=o.orient,c=i.scaleName(n),h=i.getScaleComponent(n),d=Yot(n),p=Xot(n),f="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,g=Put(f?"size":d,o,s,{vgChannel:d});let m;(a.size||void 0!==g)&&(f?m=adt("size",i,{vgChannel:d,defaultValue:g}):Yat(function(t){return`Cannot apply size to non-oriented mark "${t}".`}(o.type)));const y=null!==(r=rut(e)?Xlt({channel:n,fieldDef:e,markDef:o,stack:l,config:s}):void 0)&&void 0!==r?r:1;m=m||{[d]:vdt(t,d,c,h,s,y)};const v="band"!==(null==h?void 0:h.get("type"))||!("band"in m[d]),x=pdt(n,o,s,v?"middle":"top"),b=ldt(n,o),w=vlt({channel:n,channelDef:e,markDef:o,config:s,scaleName:c,scale:h,stack:l,offset:b,defaultRef:cdt({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:h}),band:v?.5:(1-y)/2});if(d)return Object.assign({[x]:w},m);{const t=qot(p),e=m[d],n=b?Object.assign(Object.assign({},e),{offset:b}):e;return{[x]:w,[t]:fit(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,p,e,t):gdt(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function vdt(t,e,n,i,r,o){if(i){const e=i.get("type");if("point"===e||"band"===e){if(void 0!==r[t].discreteBandSize)return{value:r[t].discreteBandSize};if(e===qst){const t=i.get("range");return pst(t)&&Sit(t.step)?{value:t.step-2}:{value:Rct-2}}return{scale:n,band:o}}return{value:r[t].continuousBandSize}}const a=Oct(r.view,e),s=mrt(r[t].discreteBandSize,a-2);return void 0!==s?{value:s}:void 0}function xdt(t,e,n,i,r){if(Not(t))return 0;const o="x"===t||"y2"===t?-e/2:e/2;if(dst(n)){const t=Lut(r);return{signal:`${n.signal} ? ${i-o}${t?"-"+t:""} : ${i+o}${t?"+"+t:""}`}}if(dst(r)){const t=i+(n?-o:o);return{signal:`${t||""}${n?" - ":t?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-o:+r+o)}function bdt({channel:t,fieldDef:e,scaleName:n,markDef:i,band:r,offset:o,config:a}){return xlt({fieldDef:e,channel:t,markDef:i,ref:klt({scaleName:n,fieldOrDatumDef:e,band:r,offset:o}),config:a})}const wdt=new Set(["aria"]);function _dt(t,e){const{fill:n,stroke:i}="include"===e.color?sdt(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(t,e){return gst.reduce(((n,i)=>(wdt.has(i)||void 0===t[i]||"ignore"===e[i]||(n[i]=Fut(t[i])),n)),{})}(t.markDef,e)),kdt(t,"fill",n)),kdt(t,"stroke",i)),adt("opacity",t)),adt("fillOpacity",t)),adt("strokeOpacity",t)),adt("strokeWidth",t)),adt("strokeDash",t)),ndt(t)),tdt(t,"href")),odt(t))}function kdt(t,e,n){const{config:i,mark:r,markDef:o}=t;if("hide"===Put("invalid",o,i)&&n&&!Wrt(r)){const i=function(t,{invalid:e=!1,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type"),o=t.vgField(n,{expr:"datum"});o&&slt(r)&&(e[o]=!0)}return e}),{}),r=nrt(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>wlt(t,e))).join(` ${t} `)}return}(t,{invalid:!0,channels:sat});if(i)return{[e]:[{test:i,value:null},...bit(n)]}}return n?{[e]:n}:{}}function Sdt(t){const{config:e,markDef:n}=t;if(Put("invalid",n,e)){const e=function(t,{invalid:e=!1,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type"),o=t.vgField(n,{expr:"datum"});o&&slt(r)&&(e[o]=!0)}return e}),{}),r=nrt(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>wlt(t,e))).join(` ${t} `)}return}(t,{channels:Qot});if(e)return{defined:{signal:e}}}return{}}function Cdt(t,e){if(void 0!==e)return{[t]:Fut(e)}}const Adt={has:t=>"interval"!==t.type&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName("voronoi")},marks:(t,e,n)=>{const{x:i,y:r}=e.project.hasChannel,o=t.mark;if(Wrt(o))return Yat(`The "nearest" transform is not supported for ${o} marks.`),n;const a={name:t.getName("voronoi"),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},ndt(t,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach(((e,n)=>{var i;const r=null!==(i=e.name)&&void 0!==i?i:"";r===t.component.mark[0].name?s=n:r.indexOf("voronoi")>=0&&(l=!0)})),l||n.splice(s+1,0,a),n}};class Idt{constructor(t,e){this.debugName=e,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):void 0!==e?this._children.splice(e,0,t):this._children.push(t)}removeChild(t){const e=this._children.indexOf(t);return this._children.splice(e,1),e}remove(){let t=this._parent.removeChild(this);for(const e of this._children)e._parent=this._parent,this._parent.addChild(e,t++)}insertAsParentOf(t){const e=t.parent;e.removeChild(this),this.parent=e,t.parent=this}swapWithParent(){const t=this._parent,e=t.parent;for(const e of this._children)e.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=e,t.parent=this}}class Mdt extends Idt{constructor(t,e,n,i){super(t,e),this.type=n,this.refCounts=i,this._source=this._name=e,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(t){const e=++yrt;return t?String(t)+e:e}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class Ddt extends Idt{constructor(t,e){super(t),this.formula=e}clone(){return new Ddt(null,Vit(this.formula))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,i)=>{const{field:r,timeUnit:o}=n,a=Hmt(e)?e.encoding[Xot(i)]:void 0,s=Hmt(e)&&Ylt(i,n,a,e.stack,e.markDef,e.config);if(o){const e=hut(n,{forAs:!0});t[Git({as:e,field:r,timeUnit:o})]=Object.assign({as:e,field:r,timeUnit:o},s?{band:!0}:{})}return t}),{});return ert(n)?null:new Ddt(t,n)}static makeFromTransform(t,e){const n=Object.assign({},e),{timeUnit:i}=n,r=Eit(n,["timeUnit"]),o=hst(i),a=Object.assign(Object.assign({},r),{timeUnit:o});return new Ddt(t,{[Git(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const e in t.formula)this.formula[e]&&!t.formula[e].band||(this.formula[e]=t.formula[e]);for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(irt(this.formula).map((t=>t.as)))}dependentFields(){return new Set(irt(this.formula).map((t=>t.field)))}hash(){return`TimeUnit ${Git(this.formula)}`}assemble(){const t=[];for(const e of irt(this.formula)){const{field:n,as:i,timeUnit:r}=e,o=hst(r),{unit:a,utc:s}=o,l=Eit(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:drt(n),type:"timeunit"},a?{units:sst(a)}:{}),s?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return t}}class Tdt{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const Edt={has:t=>"single"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind&&!Sct(t.bind),parse:(t,e,n,i)=>{i.on||delete e.events,i.clear||delete e.clear},topLevelSignals:(t,e,n)=>{const i=e.name,r=e.project,o=e.bind,a=e.init&&e.init[0],s=Adt.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach(((t,r)=>{var l,u;const c=art(`${i}_${t.field}`);n.filter((t=>t.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},a?{init:Udt(a[r])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Ait(t.field)}] : null`}]:[],bind:null!==(u=null!==(l=o[t.field])&&void 0!==l?l:o[t.channel])&&void 0!==u?u:o}))})),n},signals:(t,e,n)=>{const i=e.name,r=e.project,o=n.filter((t=>t.name===i+tpt))[0],a=i+"_tuple_fields",s=r.items.map((t=>art(`${i}_${t.field}`))),l=s.map((t=>`${t} !== null`)).join(" && ");return s.length&&(o.update=`${l} ? {fields: ${a}, values: [${s.join(", ")}]} : null`),delete o.value,delete o.on,n}},Ndt={has:t=>"multi"===t.type&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+"_toggle",value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+tpt,i=e.name+"_toggle";return`${i} ? null : ${n}, `+("global"===e.resolve?`${i} ? null : true, `:`${i} ? null : {unit: ${opt(t)}}, `)+`${i} ? ${n} : null`}},Odt={has:t=>void 0!==t.clear&&!1!==t.clear,parse:(t,e,n)=>{n.clear&&(e.clear=Cit(n.clear)?N7(n.clear,"scope"):n.clear)},topLevelSignals:(t,e,n)=>{if(Edt.has(e))for(const t of e.project.items){const i=n.findIndex((n=>n.name===art(`${e.name}_${t.field}`)));-1!==i&&n[i].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function i(t,i){-1!==t&&n[t].on&&n[t].on.push({events:e.clear,update:i})}if("interval"===e.type)for(const t of e.project.items){const e=n.findIndex((e=>e.name===t.signals.visual));if(i(e,"[0, 0]"),-1===e){i(n.findIndex((e=>e.name===t.signals.data)),"null")}}else{let t=n.findIndex((t=>t.name===e.name+tpt));i(t,"null"),Ndt.has(e)&&(t=n.findIndex((t=>t.name===e.name+"_toggle")),i(t,"false"))}return n}},Fdt={has:t=>"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind,parse:(t,e)=>{const n=e.scales=[];for(const i of e.project.items){const r=i.channel;if(!lat(r))continue;const o=t.getScaleComponent(r),a=o?o.get("type"):void 0;if(!o||!slt(a)){Yat("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:e.name,field:i.field};o.set("selectionExtent",s,!0),n.push(i)}},topLevelSignals:(t,e,n)=>{const i=e.scales.filter((t=>0===n.filter((e=>e.name===t.signals.data)).length));if(!t.parent||Ldt(t)||0===i.length)return n;const r=n.filter((t=>t.name===e.name))[0];let o=r.update;if(o.indexOf(npt)>=0)r.update=`{${i.map((t=>`${Ait(t.field)}: ${t.signals.data}`)).join(", ")}}`;else{for(const t of i){const e=`${Ait(t.field)}: ${t.signals.data}`;o.indexOf(e)<0&&(o=`${o.substring(0,o.length-1)}, ${e}}`)}r.update=o}return n.concat(i.map((t=>({name:t.signals.data}))))},signals:(t,e,n)=>{if(t.parent&&!Ldt(t))for(const t of e.scales){const e=n.filter((e=>e.name===t.signals.data))[0];e.push="outer",delete e.value,delete e.update}return n}};function Rdt(t,e){return`domain(${Ait(t.scaleName(e))})`}function Ldt(t){var e;return t.parent&&Ymt(t.parent)&&(null!==(e=!t.parent.parent)&&void 0!==e?e:Ldt(t.parent.parent))}const $dt={has:t=>{const e="global"===t.resolve&&t.bind&&Sct(t.bind),n=1===t.project.items.length&&"_vgsid_"!==t.project.items[0].field;return e&&!n&&Yat("Legend bindings are only supported for selections over an individual field or encoding channel."),e&&n},parse:(t,e,n,i)=>{var r;if(i.on||delete e.events,i.clear||delete e.clear,i.on||i.clear){const t='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of e.events)n.filter=bit(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(t)<0&&n.filter.push(t)}const o=Cct(e.bind)?e.bind.legend:"click",a=Cit(o)?N7(o,"view"):bit(o);e.bind={legend:{merge:a}}},topLevelSignals:(t,e,n)=>{const i=e.name,r=Cct(e.bind)&&e.bind.legend,o=t=>e=>{const n=Vit(e);return n.markname=t,n};for(const t of e.project.items){if(!t.hasLegend)continue;const a=`${art(t.field)}_legend`,s=`${i}_${a}`;if(0===n.filter((t=>t.name===s)).length){const t=r.merge.map(o(`${a}_symbols`)).concat(r.merge.map(o(`${a}_labels`))).concat(r.merge.map(o(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:s},e.init?{}:{value:null}),{on:[{events:t,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(t,e,n)=>{const i=e.name,r=e.project,o=n.find((t=>t.name===i+tpt)),a=i+"_tuple_fields",s=r.items.filter((t=>t.hasLegend)).map((t=>art(`${i}_${art(t.field)}_legend`))),l=`${s.map((t=>`${t} !== null`)).join(" && ")} ? {fields: ${a}, values: [${s.join(", ")}]} : null`;e.events&&s.length>0?o.on.push({events:s.map((t=>({signal:t}))),update:l}):s.length>0&&(o.update=l,delete o.value,delete o.on);const u=n.find((t=>t.name===i+"_toggle")),c=Cct(e.bind)&&e.bind.legend;return u&&(e.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}};const Pdt={has:t=>"interval"===t.type&&t.translate,signals:(t,e,n)=>{const i=e.name,r=Fdt.has(e),o=i+"_translate_anchor",{x:a,y:s}=e.project.hasChannel;let l=N7(e.translate,"scope");return r||(l=l.map((t=>(t.between[0].markname=i+qdt,t)))),n.push({name:o,value:{},on:[{events:l.map((t=>t.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==a?", extent_x: "+(r?Rdt(t,cot):`slice(${a.signals.visual})`):"")+(void 0!==s?", extent_y: "+(r?Rdt(t,hot):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+"_translate_delta",value:{},on:[{events:l,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),void 0!==a&&zdt(t,e,a,"width",n),void 0!==s&&zdt(t,e,s,"height",n),n}};function zdt(t,e,n,i,r){var o;const a=e.name,s=a+"_translate_anchor",l=a+"_translate_delta",u=n.channel,c=Fdt.has(e),h=r.filter((t=>t.name===n.signals[c?"data":"visual"]))[0],d=t.getSizeSignalRef(i).signal,p=t.getScaleComponent(u),f=p.get("type"),g=`${s}.extent_${u}`,m=`${c?"log"===f?"panLog":"pow"===f?"panPow":"panLinear":"panLinear"}(${g}, ${`${c&&u===cot?"-":""}${l}.${u} / `+(c?`${d}`:`span(${g})`)}`+(c&&"pow"===f?`, ${null!==(o=p.get("exponent"))&&void 0!==o?o:1}`:"")+")";h.on.push({events:{signal:l},update:c?m:`clampRange(${m}, 0, ${d})`})}const Bdt={has:t=>"interval"===t.type&&t.zoom,signals:(t,e,n)=>{const i=e.name,r=Fdt.has(e),o=i+"_zoom_delta",{x:a,y:s}=e.project.hasChannel,l=Ait(t.scaleName(cot)),u=Ait(t.scaleName(hot));let c=N7(e.zoom,"scope");return r||(c=c.map((t=>(t.markname=i+qdt,t)))),n.push({name:i+"_zoom_anchor",on:[{events:c,update:r?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter((t=>!!t)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==a&&Vdt(t,e,a,"width",n),void 0!==s&&Vdt(t,e,s,"height",n),n}};function Vdt(t,e,n,i,r){var o;const a=e.name,s=n.channel,l=Fdt.has(e),u=r.filter((t=>t.name===n.signals[l?"data":"visual"]))[0],c=t.getSizeSignalRef(i).signal,h=t.getScaleComponent(s),d=h.get("type"),p=l?Rdt(t,s):u.name,f=a+"_zoom_delta",g=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${p}, ${`${a}_zoom_anchor.${s}`}, ${f}`+(l&&"pow"===d?`, ${null!==(o=h.get("exponent"))&&void 0!==o?o:1}`:"")+")";u.on.push({events:{signal:f},update:l?g:`clampRange(${g}, 0, ${c})`})}const Wdt=[{has:()=>!0,parse:(t,e,n)=>{var i,r,o;const a=e.name,s=null!==(i=e.project)&&void 0!==i?i:e.project=new Tdt,l={},u={},c=new Set,h=(t,e)=>{const n="visual"===e?t.channel:t.field;let i=art(`${a}_${n}`);for(let t=1;c.has(i);t++)i=art(`${a}_${n}_${t}`);return c.add(i),{[e]:i}};if(!n.fields&&!n.encodings){const e=t.config.selection[n.type];if(n.init)for(const t of bit(n.init))for(const i of nrt(t))Wot[i]?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(Yat('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=e.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=e.encodings,n.fields=e.fields}for(const t of null!==(r=n.fields)&&void 0!==r?r:[]){const e={type:"E",field:t};e.signals=Object.assign({},h(e,"data")),s.items.push(e),s.hasField[t]=e}for(const i of null!==(o=n.encodings)&&void 0!==o?o:[]){const n=t.fieldDef(i);if(n){let r=n.field;if(n.aggregate){Yat(Cat(i,n.aggregate));continue}if(!r){Yat(Sat(i));continue}if(n.timeUnit){r=t.vgField(i);const e={timeUnit:n.timeUnit,as:r,field:n.field};u[Git(e)]=e}if(!l[r]){let o="E";if("interval"===e.type){slt(t.getScaleComponent(i).get("type"))&&(o="R")}else n.bin&&(o="R-RE");const a={field:r,channel:i,type:o};a.signals=Object.assign(Object.assign({},h(a,"data")),h(a,"visual")),s.items.push(l[r]=a),s.hasField[r]=s.hasChannel[i]=l[r]}}else Yat(Sat(i))}if(n.init){const t=t=>s.items.map((e=>void 0!==t[e.channel]?t[e.channel]:t[e.field]));if("interval"===n.type)e.init=t(n.init);else{const i=bit(n.init);e.init=i.map(t)}}ert(u)||(s.timeUnit=new Ddt(null,u))},signals:(t,e,n)=>{const i=e.name+"_tuple_fields";return n.filter((t=>t.name===i)).length>0?n:n.concat({name:i,value:e.project.items.map((t=>{const e=Eit(t,["signals","hasLegend"]);return e.field=drt(e.field),e}))})}},Ndt,Fdt,$dt,Pdt,Bdt,Edt,Adt,Odt];function jdt(t,e){for(const n of Wdt)n.has(t)&&e(n)}function Udt(t,e=!0,n=dit){if(fit(t)){const i=t.map((t=>Udt(t,e,n)));return e?`[${i.join(", ")}]`:i}return Kat(t)?n(e?nst(t):function(t){const e=est(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}(t)):e?n(JSON.stringify(t)):t}function Gdt(t,e){return rpt(t,((n,i)=>{e=i.marks?i.marks(t,n,e):e,jdt(n,(i=>{i.marks&&(e=i.marks(t,n,e))}))})),e}function Hdt(t){return t.map((t=>(t.on&&!t.on.length&&delete t.on,t)))}const qdt="_brush",Xdt={signals:(t,e)=>{const n=e.name,i=n+"_tuple_fields",r=Fdt.has(e),o=[],a=[],s=[];if(e.translate&&!r){const t=`!event.item || event.item.mark.name !== ${Ait(n+qdt)}`;Ydt(e,((e,n)=>{var i;const r=bit(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(t)<0&&r.push(t),e}))}e.project.items.forEach(((n,i)=>{const r=n.channel;if(r!==cot&&r!==hot)return void Yat("Interval selections only support x and y encoding channels.");const l=e.init?e.init[i]:null,u=function(t,e,n,i){const r=n.channel,o=n.signals.visual,a=n.signals.data,s=Fdt.has(e),l=Ait(t.scaleName(r)),u=t.getScaleComponent(r),c=u?u.get("type"):void 0,h=t=>`scale(${l}, ${t})`,d=t.getSizeSignalRef(r===cot?"width":"height").signal,p=`${r}(unit)`,f=Ydt(e,((t,e)=>[...t,{events:e.between[0],update:`[${p}, ${p}]`},{events:e,update:`[${o}[0], clamp(${p}, 0, ${d})]`}]));return f.push({events:{signal:e.name+"_scale_trigger"},update:slt(c)?`[${h(`${a}[0]`)}, ${h(`${a}[1]`)}]`:"[0, 0]"}),s?[{name:a,on:[]}]:[Object.assign(Object.assign({name:o},i?{init:Udt(i,!0,h)}:{value:[]}),{on:f}),Object.assign(Object.assign({name:a},i?{init:Udt(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${l}, ${o})`}]})]}(t,e,n,l),c=n.signals.data,h=n.signals.visual,d=Ait(t.scaleName(r)),p=slt(t.getScaleComponent(r).get("type"))?"+":"";o.push(...u),a.push(c),s.push({scaleName:t.scaleName(r),expr:`(!isArray(${c}) || (${p}invert(${d}, ${h})[0] === ${p}${c}[0] && ${p}invert(${d}, ${h})[1] === ${p}${c}[1]))`})})),r||o.push({name:n+"_scale_trigger",value:{},on:[{events:s.map((t=>({scale:t.scaleName}))),update:s.map((t=>t.expr)).join(" && ")+` ? ${n+"_scale_trigger"} : {}`}]});const l=e.init,u=`unit: ${opt(t)}, fields: ${i}, values`;return o.concat(Object.assign(Object.assign({name:n+tpt},l?{init:`{${u}: ${Udt(l)}}`}:{}),{on:[{events:[{signal:a.join(" || ")}],update:a.join(" && ")+` ? {${u}: [${a}]} : null`}]}))},modifyExpr:(t,e)=>e.name+tpt+", "+("global"===e.resolve?"true":`{unit: ${opt(t)}}`),marks:(t,e,n)=>{const i=e.name,{x:r,y:o}=e.project.hasChannel,a=r&&r.signals.visual,s=o&&o.signals.visual,l=`data(${Ait(e.name+Qdt)})`;if(Fdt.has(e))return n;const u={x:void 0!==r?{signal:`${a}[0]`}:{value:0},y:void 0!==o?{signal:`${s}[0]`}:{value:0},x2:void 0!==r?{signal:`${a}[1]`}:{field:{group:"width"}},y2:void 0!==o?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===e.resolve)for(const e of nrt(u))u[e]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${opt(t)}`},u[e]),{value:0}];const c=e.mark,{fill:h,fillOpacity:d,cursor:p}=c,f=Eit(c,["fill","fillOpacity","cursor"]),g=nrt(f).reduce(((t,e)=>(t[e]=[{test:[void 0!==r&&`${a}[0] !== ${a}[1]`,void 0!==o&&`${s}[0] !== ${s}[1]`].filter((t=>t)).join(" && "),value:f[e]},{value:null}],t)),{});return[{name:i+qdt+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:h},fillOpacity:{value:d}},update:u}},...n,{name:i+qdt,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},p?{cursor:{value:p}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),g)}}]}};function Ydt(t,e){return t.events.reduce(((t,n)=>n.between?e(t,n):(Yat(`${n} is not an ordered event stream for interval selections.`),t)),[])}function Kdt(t,e){const n=e.name,i=n+"_tuple_fields",r=e.project,o="(item().isVoronoi ? datum.datum : datum)",a=r.items.map((e=>{const n=t.fieldDef(e.channel);return n&&n.bin?`[${o}[${Ait(t.vgField(e.channel,{}))}], ${o}[${Ait(t.vgField(e.channel,{binSuffix:"end"}))}]]`:`${o}[${Ait(e.field)}]`})).join(", "),s=`unit: ${opt(t)}, fields: ${i}, values`,l=e.events;return[{name:n+tpt,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${a}]} : null`,force:!0}]:[]}]}const Zdt={signals:Kdt,modifyExpr:(t,e)=>e.name+tpt+", "+("global"===e.resolve?"null":`{unit: ${opt(t)}}`)},Jdt={signals:Kdt,modifyExpr:(t,e)=>e.name+tpt+", "+("global"===e.resolve?"true":`{unit: ${opt(t)}}`)},Qdt="_store",tpt="_tuple",ept="_modify",npt="vlSelectionResolve",ipt={single:Jdt,multi:Zdt,interval:Xdt};function rpt(t,e){const n=t.component.selection;if(n)for(const t of irt(n)){if(!0===e(t,ipt[t.type]))break}}function opt(t,{escape:e}={escape:!0}){let n=e?Ait(t.name):t.name;const i=function(t){let e=t.parent;for(;e&&!qmt(e);)e=e.parent;return e}(t);if(i){const{facet:t}=i;for(const e of Pot)t[e]&&(n+=` + '__facet_${e}_' + (facet[${Ait(i.vgField(e))}])`)}return n}function apt(t){let e=!1;return rpt(t,(t=>{e=e||t.project.items.some((t=>"_vgsid_"===t.field))})),e}function spt(t){this.type=t}var lpt,upt,cpt,hpt,dpt;spt.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1};(lpt={})[1]="Boolean",lpt[2]="<end>",lpt[3]="Identifier",lpt[4]="Keyword",lpt[5]="Null",lpt[6]="Numeric",lpt[7]="Punctuator",lpt[8]="String",lpt[9]="RegularExpression";var ppt="ILLEGAL",fpt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),gpt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function mpt(t,e){if(!t)throw new Error("ASSERT: "+e)}function ypt(t){return t>=48&&t<=57}function vpt(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function xpt(t){return"01234567".indexOf(t)>=0}function bpt(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function wpt(t){return 10===t||13===t||8232===t||8233===t}function _pt(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&fpt.test(String.fromCharCode(t))}function kpt(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&gpt.test(String.fromCharCode(t))}var Spt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Cpt(){for(var t;cpt<hpt&&(bpt(t=upt.charCodeAt(cpt))||wpt(t));)++cpt}function Apt(t){var e,n,i,r=0;for(n="u"===t?4:2,e=0;e<n;++e)cpt<hpt&&vpt(upt[cpt])?(i=upt[cpt++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):Wpt({},"Unexpected token %0",ppt);return String.fromCharCode(r)}function Ipt(){var t,e,n,i;for(e=0,"}"===(t=upt[cpt])&&Wpt({},"Unexpected token %0",ppt);cpt<hpt&&vpt(t=upt[cpt++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&Wpt({},"Unexpected token %0",ppt),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),i=56320+(e-65536&1023),String.fromCharCode(n,i))}function Mpt(){var t,e;for(t=upt.charCodeAt(cpt++),e=String.fromCharCode(t),92===t&&(117!==upt.charCodeAt(cpt)&&Wpt({},"Unexpected token %0",ppt),++cpt,(t=Apt("u"))&&"\\"!==t&&_pt(t.charCodeAt(0))||Wpt({},"Unexpected token %0",ppt),e=t);cpt<hpt&&kpt(t=upt.charCodeAt(cpt));)++cpt,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==upt.charCodeAt(cpt)&&Wpt({},"Unexpected token %0",ppt),++cpt,(t=Apt("u"))&&"\\"!==t&&kpt(t.charCodeAt(0))||Wpt({},"Unexpected token %0",ppt),e+=t);return e}function Dpt(){var t,e;return t=cpt,{type:1===(e=92===upt.charCodeAt(cpt)?Mpt():function(){var t,e;for(t=cpt++;cpt<hpt;){if(92===(e=upt.charCodeAt(cpt)))return cpt=t,Mpt();if(!kpt(e))break;++cpt}return upt.slice(t,cpt)}()).length?3:Spt.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:cpt}}function Tpt(){var t,e,n,i,r=cpt,o=upt.charCodeAt(cpt),a=upt[cpt];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++cpt,{type:7,value:String.fromCharCode(o),start:r,end:cpt};default:if(61===(t=upt.charCodeAt(cpt+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return cpt+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(t),start:r,end:cpt};case 33:case 61:return cpt+=2,61===upt.charCodeAt(cpt)&&++cpt,{type:7,value:upt.slice(r,cpt),start:r,end:cpt}}}return">>>="===(i=upt.substr(cpt,4))?{type:7,value:i,start:r,end:cpt+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:cpt+=3}:a===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===e?{type:7,value:e,start:r,end:cpt+=2}:"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:r,end:++cpt}:void Wpt({},"Unexpected token %0",ppt)}function Ept(){var t,e,n;if(mpt(ypt((n=upt[cpt]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=cpt,t="","."!==n){if(t=upt[cpt++],n=upt[cpt],"0"===t){if("x"===n||"X"===n)return++cpt,function(t){for(var e="";cpt<hpt&&vpt(upt[cpt]);)e+=upt[cpt++];return 0===e.length&&Wpt({},"Unexpected token %0",ppt),_pt(upt.charCodeAt(cpt))&&Wpt({},"Unexpected token %0",ppt),{type:6,value:parseInt("0x"+e,16),start:t,end:cpt}}(e);if(xpt(n))return function(t){for(var e="0"+upt[cpt++];cpt<hpt&&xpt(upt[cpt]);)e+=upt[cpt++];return(_pt(upt.charCodeAt(cpt))||ypt(upt.charCodeAt(cpt)))&&Wpt({},"Unexpected token %0",ppt),{type:6,value:parseInt(e,8),octal:!0,start:t,end:cpt}}(e);n&&ypt(n.charCodeAt(0))&&Wpt({},"Unexpected token %0",ppt)}for(;ypt(upt.charCodeAt(cpt));)t+=upt[cpt++];n=upt[cpt]}if("."===n){for(t+=upt[cpt++];ypt(upt.charCodeAt(cpt));)t+=upt[cpt++];n=upt[cpt]}if("e"===n||"E"===n)if(t+=upt[cpt++],"+"!==(n=upt[cpt])&&"-"!==n||(t+=upt[cpt++]),ypt(upt.charCodeAt(cpt)))for(;ypt(upt.charCodeAt(cpt));)t+=upt[cpt++];else Wpt({},"Unexpected token %0",ppt);return _pt(upt.charCodeAt(cpt))&&Wpt({},"Unexpected token %0",ppt),{type:6,value:parseFloat(t),start:e,end:cpt}}function Npt(){var t,e,n,i;return dpt=null,Cpt(),t=cpt,e=function(){var t,e,n,i;for(mpt("/"===(t=upt[cpt]),"Regular expression literal must start with a slash"),e=upt[cpt++],n=!1,i=!1;cpt<hpt;)if(e+=t=upt[cpt++],"\\"===t)wpt((t=upt[cpt++]).charCodeAt(0))&&Wpt({},"Invalid regular expression: missing /"),e+=t;else if(wpt(t.charCodeAt(0)))Wpt({},"Invalid regular expression: missing /");else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||Wpt({},"Invalid regular expression: missing /"),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";cpt<hpt&&kpt((t=upt[cpt]).charCodeAt(0));)++cpt,"\\"===t&&cpt<hpt?Wpt({},"Unexpected token %0",ppt):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&Wpt({},"Invalid regular expression",n),{value:n,literal:e}}(),i=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";Wpt({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){Wpt({},"Invalid regular expression")}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:cpt}}function Opt(){var t;return Cpt(),cpt>=hpt?{type:2,start:cpt,end:cpt}:_pt(t=upt.charCodeAt(cpt))?Dpt():40===t||41===t||59===t?Tpt():39===t||34===t?function(){var t,e,n,i,r="",o=!1;for(mpt("'"===(t=upt[cpt])||'"'===t,"String literal must starts with a quote"),e=cpt,++cpt;cpt<hpt;){if((n=upt[cpt++])===t){t="";break}if("\\"===n)if((n=upt[cpt++])&&wpt(n.charCodeAt(0)))"\r"===n&&"\n"===upt[cpt]&&++cpt;else switch(n){case"u":case"x":"{"===upt[cpt]?(++cpt,r+=Ipt()):r+=Apt(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:xpt(n)?(0!==(i="01234567".indexOf(n))&&(o=!0),cpt<hpt&&xpt(upt[cpt])&&(o=!0,i=8*i+"01234567".indexOf(upt[cpt++]),"0123".indexOf(n)>=0&&cpt<hpt&&xpt(upt[cpt])&&(i=8*i+"01234567".indexOf(upt[cpt++]))),r+=String.fromCharCode(i)):r+=n}else{if(wpt(n.charCodeAt(0)))break;r+=n}}return""!==t&&Wpt({},"Unexpected token %0",ppt),{type:8,value:r,octal:o,start:e,end:cpt}}():46===t?ypt(upt.charCodeAt(cpt+1))?Ept():Tpt():ypt(t)?Ept():Tpt()}function Fpt(){var t;return cpt=(t=dpt).end,dpt=Opt(),cpt=t.end,t}function Rpt(){var t;t=cpt,dpt=Opt(),cpt=t}function Lpt(t,e,n){var i=new spt("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function $pt(t,e){var n=new spt("CallExpression");return n.callee=t,n.arguments=e,n}function Ppt(t){var e=new spt("Identifier");return e.name=t,e}function zpt(t){var e=new spt("Literal");return e.value=t.value,e.raw=upt.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function Bpt(t,e,n){var i=new spt("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function Vpt(t,e,n){var i=new spt("Property");return i.key=e,i.value=n,i.kind=t,i}function Wpt(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,(function(t,e){return mpt(e<i.length,"Message reference must be in range"),i[e]}));throw(n=new Error(r)).index=cpt,n.description=r,n}function jpt(t){2===t.type&&Wpt(t,"Unexpected end of input"),6===t.type&&Wpt(t,"Unexpected number"),8===t.type&&Wpt(t,"Unexpected string"),3===t.type&&Wpt(t,"Unexpected identifier"),4===t.type&&Wpt(t,"Unexpected reserved word"),Wpt(t,"Unexpected token %0",t.value)}function Upt(t){var e=Fpt();7===e.type&&e.value===t||jpt(e)}function Gpt(t){return 7===dpt.type&&dpt.value===t}function Hpt(t){return 4===dpt.type&&dpt.value===t}function qpt(){var t=[];for(cpt=dpt.start,Upt("[");!Gpt("]");)Gpt(",")?(Fpt(),t.push(null)):(t.push(oft()),Gpt("]")||Upt(","));return Fpt(),function(t){var e=new spt("ArrayExpression");return e.elements=t,e}(t)}function Xpt(){var t;return cpt=dpt.start,8===(t=Fpt()).type||6===t.type?(t.octal&&Wpt(t,"Octal literals are not allowed in strict mode."),zpt(t)):Ppt(t.value)}function Ypt(){var t,e,n;return cpt=dpt.start,3===(t=dpt).type?(n=Xpt(),Upt(":"),Vpt("init",n,oft())):2!==t.type&&7!==t.type?(e=Xpt(),Upt(":"),Vpt("init",e,oft())):void jpt(t)}function Kpt(){var t,e,n=[],i={},r=String;for(cpt=dpt.start,Upt("{");!Gpt("}");)e="$"+("Identifier"===(t=Ypt()).key.type?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?Wpt({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),Gpt("}")||Upt(",");return Upt("}"),function(t){var e=new spt("ObjectExpression");return e.properties=t,e}(n)}var Zpt={if:1};function Jpt(){var t,e,n;if(Gpt("("))return function(){var t;return Upt("("),t=aft(),Upt(")"),t}();if(Gpt("["))return qpt();if(Gpt("{"))return Kpt();if(t=dpt.type,cpt=dpt.start,3===t||Zpt[dpt.value])n=Ppt(Fpt().value);else if(8===t||6===t)dpt.octal&&Wpt(dpt,"Octal literals are not allowed in strict mode."),n=zpt(Fpt());else{if(4===t)throw new Error("Disabled.");1===t?((e=Fpt()).value="true"===e.value,n=zpt(e)):5===t?((e=Fpt()).value=null,n=zpt(e)):Gpt("/")||Gpt("/=")?(n=zpt(Npt()),Rpt()):jpt(Fpt())}return n}function Qpt(){var t=[];if(Upt("("),!Gpt(")"))for(;cpt<hpt&&(t.push(oft()),!Gpt(")"));)Upt(",");return Upt(")"),t}function tft(){return Upt("."),cpt=dpt.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t=Fpt())||jpt(t),Ppt(t.value);var t}function eft(){var t;return Upt("["),t=aft(),Upt("]"),t}function nft(){var t=function(){var t;for(t=Jpt();;)if(Gpt("."))t=Bpt(".",t,tft());else if(Gpt("("))t=$pt(t,Qpt());else{if(!Gpt("["))break;t=Bpt("[",t,eft())}return t}();if(7===dpt.type&&(Gpt("++")||Gpt("--")))throw new Error("Disabled.");return t}function ift(){var t,e,n,i,r;if(7!==dpt.type&&4!==dpt.type)e=nft();else{if(Gpt("++")||Gpt("--"))throw new Error("Disabled.");if(Gpt("+")||Gpt("-")||Gpt("~")||Gpt("!"))t=Fpt(),e=ift(),n=t.value,i=e,(r=new spt("UnaryExpression")).operator=n,r.argument=i,r.prefix=!0,e=r;else{if(Hpt("delete")||Hpt("void")||Hpt("typeof"))throw new Error("Disabled.");e=nft()}}return e}function rft(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function oft(){var t,e;return t=function(){var t,e,n,i,r,o,a,s,l,u;if(t=dpt,l=ift(),0===(r=rft(i=dpt)))return l;for(i.prec=r,Fpt(),e=[t,dpt],o=[l,i,a=ift()];(r=rft(dpt))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,l=o.pop(),e.pop(),n=Lpt(s,l,a),o.push(n);(i=Fpt()).prec=r,o.push(i),e.push(dpt),n=ift(),o.push(n)}for(n=o[u=o.length-1],e.pop();u>1;)e.pop(),n=Lpt(o[u-1].value,o[u-2],n),u-=2;return n}(),Gpt("?")&&(Fpt(),e=oft(),Upt(":"),t=function(t,e,n){var i=new spt("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,oft())),t}function aft(){var t=oft();if(Gpt(","))throw new Error("Disabled.");return t}function sft(t,e,n){return t.fields=e||[],t.fname=n,t}function lft(t){return 1===t.length?uft(t[0]):cft(t)}const uft=t=>function(e){return e[t]},cft=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function hft(t){throw Error(t)}function dft(t){const e=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(e.push(...dft(t.object)),e.push(...dft(t.property))),e)}function pft(t){return"MemberExpression"===t.object.type?pft(t.object):"datum"===t.object.name}function fft(t){const e=function(t){cpt=0,hpt=(upt=t).length,dpt=null,Rpt();var e=aft();if(2!==dpt.type)throw new Error("Unexpect token after expression.");return e}(t),n=new Set;return e.visit((t=>{"MemberExpression"===t.type&&pft(t)&&n.add(dft(t).slice(1).join("."))})),n}!function(t,e,n){const i=function(t){const e=[],n=t.length;let i,r,o,a=null,s=0,l="";function u(){e.push(l+t.substring(i,r)),l="",i=r+1}for(t+="",i=r=0;r<n;++r)if(o=t[r],"\\"===o)l+=t.substring(i,r),l+=t.substring(++r,++r),i=r;else if(o===a)u(),a=null,s=-1;else{if(a)continue;i===s&&'"'===o||i===s&&"'"===o?(i=r+1,a=o):"."!==o||s?"["===o?(r>i&&u(),s=i=r+1):"]"===o&&(s||hft("Access path missing open bracket: "+t),s>0&&u(),s=0,i=r+1):r>i?u():i=r+1}return s&&hft("Access path missing closing bracket: "+t),a&&hft("Access path missing closing quote: "+t),r>i&&(r++,u()),e}(t);t=1===i.length?i[0]:t,sft((n&&n.get||lft)(i),[t],e||t)}("id"),sft((t=>t),[],"identity"),sft((()=>0),[],"zero"),sft((()=>1),[],"one"),sft((()=>!0),[],"true"),sft((()=>!1),[],"false");class gft extends Idt{constructor(t,e,n){super(t),this.model=e,this.filter=n,this.expr=vft(this.model,this.filter,this),this._dependentFields=fft(this.expr)}clone(){return new gft(null,this.model,Vit(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function mft(t,e,n,i="datum"){const r=[];const o=srt(e,(function(e){const o=art(e),a=t.getSelectionComponent(o,e),s=Ait(o+Qdt);if(a.project.timeUnit){const e=null!=n?n:t.component.data.raw,i=a.project.timeUnit.clone();e.parent?i.insertAsParentOf(e):e.parent=i}return"none"!==a.empty&&r.push(s),`vlSelectionTest(${s}, ${i}`+("global"===a.resolve?")":`, ${Ait(a.resolve)})`)}));return(r.length?"!("+r.map((t=>`length(data(${t}))`)).join(" || ")+") || ":"")+`(${o})`}function yft(t,e){const n=e.encoding;let i=e.field;if(n||i){if(n&&!i){const r=t.project.items.filter((t=>t.channel===n));!r.length||r.length>1?(i=t.project.items[0].field,Yat((r.length?"Multiple ":"No ")+`matching ${Ait(n)} encoding found for selection ${Ait(e.selection)}. Using "field": ${Ait(i)}.`)):i=r[0].field}}else i=t.project.items[0].field,t.project.items.length>1&&Yat(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Ait(i)}.`);return`${t.name}[${Ait(i)}]`}function vft(t,e,n){return srt(e,(e=>Cit(e)?e:function(t){return null==t?void 0:t.selection}(e)?mft(t,e.selection,n):Ist(e)))}function xft(t,e,n,i){var r,o,a;t.encode=null!==(r=t.encode)&&void 0!==r?r:{},t.encode[e]=null!==(o=t.encode[e])&&void 0!==o?o:{},t.encode[e].update=null!==(a=t.encode[e].update)&&void 0!==a?a:{},t.encode[e].update[n]=i}function bft(t,e,n,i={header:!1}){var r,o;const a=t.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:h,zindex:d}=a,p=Eit(a,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const t in p){const n=krt[t],i=p[t];if(n&&n!==e&&"both"!==n)delete p[t];else if(wrt(i)){const{condition:e}=i,n=Eit(i,["condition"]),r=bit(e),o=brt[t];if(o){const{vgProp:e,part:i}=o;xft(p,i,e,[...r.map((t=>{const{test:e}=t,n=Eit(t,["test"]);return Object.assign({test:vft(null,e)},n)})),n]),delete p[t]}else if(null===o){const e={signal:r.map((t=>{const{test:e}=t,n=Eit(t,["test"]);return`${vft(null,e)} ? ${Rut(n)} : `})).join("")+Rut(n)};p[t]=e}}else if(dst(i)){const e=brt[t];if(e){const{vgProp:n,part:r}=e;xft(p,r,n,i),delete p[t]}}}if("grid"===e){if(!p.grid)return;if(p.encode){const{grid:t}=p.encode;p.encode=Object.assign({},t?{grid:t}:{}),ert(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:u,orient:l},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:mrt(d,0)})}{if(!i.header&&t.mainExtracted)return;if(void 0!==c){let t=c;(null===(o=null===(r=p.encode)||void 0===r?void 0:r.labels)||void 0===o?void 0:o.update)&&dst(p.encode.labels.update.text)&&(t=prt(c,"datum.label",p.encode.labels.update.text.signal)),xft(p,"labels","text",{signal:t})}if(null===p.labelAlign&&delete p.labelAlign,p.encode){for(const e of _rt)t.hasAxisPart(e)||delete p.encode[e];ert(p.encode)&&delete p.encode}const e=function(t,e){if(t)return fit(t)&&!Out(t)?t.map((t=>xut(t,e))).join(", "):t}(h,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},e?{title:e}:{}),p),!1===n.aria?{aria:!1}:{}),{zindex:mrt(d,0)})}}}function wft(t){const{axes:e}=t.component,n=[];for(const i of Qot)if(e[i])for(const r of e[i])if(!r.get("disable")&&!r.get("gridScale")){const e="x"===i?"height":"width",r=t.getSizeSignalRef(e).signal;e!==r&&n.push({name:e,update:r})}return n}const _ft={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},kft={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Sft=nrt(_ft),Cft=nrt(kft);function Aft(t,e,n,i){return Object.assign.apply(null,[{},...t.map((t=>{if("axisOrient"===t){const t="x"===n?"bottom":"left",r=e["x"===n?"axisBottom":"axisLeft"]||{},o=e["x"===n?"axisTop":"axisRight"]||{},a=new Set([...nrt(r),...nrt(o)]),s={};for(const e of a.values())s[e]={signal:`${i.signal} === "${t}" ? ${Lut(r[e])} : ${Lut(o[e])}`};return s}return e[t]}))])}function Ift(t,e,n,i){const r="band"===e?["axisDiscrete","axisBand"]:"point"===e?["axisDiscrete","axisPoint"]:e in nlt?["axisQuantitative"]:"time"===e||"utc"===e?["axisTemporal"]:[];const o="x"===t?"axisX":"axisY",a=dst(n)?"axisOrient":"axis"+urt(n),s=[...r,...r.map((t=>o+t.substr(4)))],l=["axis",a,o];return{vlOnlyAxisConfig:Aft(s,i,t,n),vgAxisConfig:Aft(l,i,t,n),axisConfigStyle:Mft([...l,...s],i)}}function Mft(t,e){var n;const i=[{}];for(const r of t){let t=null===(n=e[r])||void 0===n?void 0:n.style;if(t){t=bit(t);for(const n of t)i.push(e.style[n])}}return Object.assign.apply(null,i)}function Dft(t,e,n,i={}){var r;const o=Vut(t,n,e.style);if(void 0!==o)return{configFrom:"style",configValue:o};for(const e of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(r=i[e])||void 0===r?void 0:r[t]))return{configFrom:e,configValue:i[e][t]};return{}}const Tft={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:n})=>{const{format:i,formatType:r}=n;return Elt(t,t.type,i,r,e,!0)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return Nlt(i,e,n)},grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>{var i;return(!Qlt(t)||!gat(t.bin))&&(null!==(i=e.grid)&&void 0!==i?i:function(t,e){return!alt(t)&&Qlt(e)&&!fat(null==e?void 0:e.bin)}(n,t))},gridScale:({model:t,channel:e})=>function(t,e){const n="x"===e?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n);return}(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelAlign||Oft(e,n,i),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelBaseline||Nft(e,n,i),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>{var i;return null!==(i=t.labelFlush)&&void 0!==i?i:function(t,e){if("x"===e&&qit(["quantitative","temporal"],t))return!0;return}(e.type,n)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{var i;return null!==(i=t.labelOverlap)&&void 0!==i?i:function(t,e){if("nominal"!==t)return"log"!==e||"greedy";return}(e.type,n)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var o;const a="x"===t?"width":"y"===t?"height":void 0,s=a?e.getSizeSignalRef(a):void 0;return null!==(o=n.tickCount)&&void 0!==o?o:function({fieldOrDatumDef:t,scaleType:e,size:n,values:i}){var r;if(!i&&!alt(e)&&"log"!==e){if(Qlt(t)){if(fat(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&qit(["month","hours","day","quarter"],null===(r=hst(t.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:t,model:e,channel:n})=>{if(void 0!==t.title)return t.title;const i=Fft(e,n);if(void 0!==i)return i;const r=e.typedFieldDef(n),o="x"===n?"x2":"y2",a=e.fieldDef(o);return jut(r?[Hlt(r)]:[],Qlt(a)?[Hlt(a)]:[])},values:({axis:t,fieldOrDatumDef:e})=>function(t,e){const n=t.values;if(fit(n))return Tut(e,n);if(dst(n))return n;return}(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>{var i;return null!==(i=t.zindex)&&void 0!==i?i:function(t,e){if("rect"===t&&dut(e))return 1;return 0}(n,e)}};function Eft(t){return`(((${t.signal} % 360) + 360) % 360)`}function Nft(t,e,n,i){if(void 0!==t){if("x"===n){if(dst(t)){const n=Eft(t);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${dst(e)?`(${e.signal} === "top")`:"top"===e} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(dst(e)){const n=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${n} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==("top"===e)?"bottom":"top"}if(dst(t)){const n=Eft(t);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${dst(e)?`(${e.signal} === "left")`:"left"===e} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return i?"middle":null;if(dst(e)){const n=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==("left"===e)?"top":"bottom"}}function Oft(t,e,n){if(void 0===t)return;const i="x"===n,r=i?0:90,o=i?"bottom":"left";if(dst(t)){const n=Eft(t);return{signal:`(${r?"("+n+" + 90)":n} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${n} && ${n} < ${180+r}) === ${dst(e)?`(${e.signal} === "${o}")`:e===o} ? "left" : "right"`}}if((t+r)%180==0)return i?null:"center";if(dst(e)){const n=r<t&&t<180+r?"===":"!==";return{signal:`${`${e.signal} ${n} "${o}"`} ? "left" : "right"`}}return(r<t&&t<180+r)==(e===o)?"left":"right"}function Fft(t,e){const n="x"===e?"x2":"y2",i=t.fieldDef(e),r=t.fieldDef(n),o=i?i.title:void 0,a=r?r.title:void 0;return o&&a?Uut(o,a):o||(a||(void 0!==o?o:void 0!==a?a:void 0))}class Rft extends Idt{constructor(t,e){super(t),this.transform=e,this._dependentFields=fft(this.transform.calculate)}clone(){return new Rft(null,Vit(this.transform))}static parseAllForSortIndex(t,e){return e.forEachFieldDef(((e,n)=>{if(sut(e)&&Wlt(e.sort)){const{field:i,timeUnit:r}=e,o=e.sort,a=o.map(((t,e)=>`${Ist({field:i,timeUnit:r,equal:t})} ? ${e} : `)).join("")+o.length;t=new Rft(t,{calculate:a,as:Lft(e,n,{forAs:!0})})}})),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Git(this.transform)}`}}function Lft(t,e,n){return hut(t,Object.assign({prefix:e,suffix:"sort_index"},null!=n?n:{}))}function $ft(t,e){return qit(["top","bottom"],e)?"column":qit(["left","right"],e)||"row"===t?"row":"column"}function Pft(t,e,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return mrt(((null==e?void 0:e.header)||{})[t],r[t],n.header[t])}function zft(t,e,n,i){const r={};for(const o of t){const t=Pft(o,e,n,i);void 0!==t&&(r[o]=t)}return r}const Bft=["row","column"],Vft=["header","footer"];function Wft(t,e){const n=t.component.layoutHeaders[e].title,i=t.config?t.config:void 0,r=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:o,titleAngle:a,titleOrient:s}=zft(["titleAnchor","titleAngle","titleOrient"],r,i,e),l=$ft(e,s),u=vrt(a);return{name:`${e}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===e?{orient:"left"}:{}),{style:"guide-title"}),Uft(u,l)),jft(l,u,o)),Zft(i,r,e,Sft,_ft))}}function jft(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Oft(e,"row"===t?"left":"top","row"===t?"y":"x");return i?{align:i}:{}}function Uft(t,e){const n=Nft(t,"row"===e?"left":"top","row"===e?"y":"x",!0);return n?{baseline:n}:{}}function Gft(t,e){const n=t.component.layoutHeaders[e],i=[];for(const r of Vft)if(n[r])for(const o of n[r]){const a=Xft(t,e,r,n,o);null!=a&&i.push(a)}return i}function Hft(t,e){var n;const{sort:i}=t;return Vlt(i)?{field:hut(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:fit(i)?{field:Lft(t,e,{expr:"datum"}),order:"ascending"}:{field:hut(t,{expr:"datum"}),order:null!=i?i:"ascending"}}function qft(t,e,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:a,labelOrient:s,labelExpr:l}=zft(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t,n,e),u=Mlt({fieldOrDatumDef:t,format:i,formatType:r,expr:"parent",config:n}).signal,c=$ft(e,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?prt(prt(l,"datum.label",u),"datum.value",hut(t,{expr:"parent"})):u}},"row"===e?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Uft(o,c)),jft(c,o,a)),Zft(n,t,e,Cft,kft))}function Xft(t,e,n,i,r){if(r){let o=null;const{facetFieldDef:a}=i,s=t.config?t.config:void 0;if(a&&r.labels){const{labelOrient:t}=zft(["labelOrient"],a,s,e);("row"===e&&!qit(["top","bottom"],t)||"column"===e&&!qit(["left","right"],t))&&(o=qft(a,e,s))}const l=qmt(t)&&!jlt(t.facet),u=r.axes,c=(null==u?void 0:u.length)>0;if(o||c){const s="row"===e?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`},i.facetFieldDef?{from:{data:t.getName(e+"_domain")},sort:Hft(a,e)}:{}),c&&l?{from:{data:t.getName(`facet_domain_${e}`)}}:{}),o?{title:o}:{}),r.sizeSignal?{encode:{update:{[s]:r.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const Yft={column:{start:0,end:1},row:{start:1,end:0}};function Kft(t,e){return Yft[e][t]}function Zft(t,e,n,i,r){const o={};for(const a of i){if(!r[a])continue;const i=Pft(a,e,t,n);void 0!==i&&(o[r[a]]=i)}return o}function Jft(t){return[...Qft(t,"width"),...Qft(t,"height"),...Qft(t,"childWidth"),...Qft(t,"childHeight")]}function Qft(t,e){const n="width"===e?"x":"y",i=t.component.layoutSize.get(e);if(!i||"merged"===i)return[];const r=t.getSizeSignalRef(e).signal;if("step"===i){const e=t.getScaleComponent(n);if(e){const i=e.get("type"),o=e.get("range");if(alt(i)&&pst(o)){const i=t.scaleName(n);if(qmt(t.parent)){if("independent"===t.parent.component.resolve.scale[n])return[tgt(i,o)]}return[tgt(i,o),{name:r,update:egt(i,e,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const e=r.endsWith("width"),n=e?"containerSize()[0]":"containerSize()[1]",i=`isFinite(${n}) ? ${n} : ${Nct(t.config.view,e?"width":"height")}`;return[{name:r,init:i,on:[{update:i,events:"window:resize"}]}]}return[{name:r,value:i}]}function tgt(t,e){return{name:t+"_step",value:e.step}}function egt(t,e,n){const i=e.get("type"),r=e.get("padding"),o=mrt(e.get("paddingOuter"),r);let a=e.get("paddingInner");return a="band"===i?void 0!==a?a:r:1,`bandspace(${n}, ${a}, ${o}) * ${t}_step`}function ngt(t){return"childWidth"===t?"width":"childHeight"===t?"height":t}function igt(t,e){return nrt(t).reduce(((n,i)=>{const r=t[i];return Object.assign(Object.assign({},n),Qht(e,r,i,(t=>dst(t)?t:{value:t.value})))}),{})}function rgt(t,e){if(Ymt(e)||qmt(e))return"shared";if(Xmt(e))return tat(t)?"independent":"shared";throw new Error("invalid model type for resolve")}function ogt(t,e){const n=t.scale[e],i=tat(e)?"axis":"legend";return"independent"===n?("shared"===t[i][e]&&Yat(function(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}(e)),"independent"):t[i][e]||"shared"}const agt=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),sgt=nrt(agt);class lgt extends bht{}const ugt={symbols:function(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r,legendType:o}){var a,s,l,u,c;if("symbol"!==o)return;const{markDef:h,encoding:d,config:p,mark:f}=n,g=h.filled&&"trail"!==f;let m=Object.assign(Object.assign({},function(t,e,n){for(const i of n){const n=zut(i,e.markDef,e.config);void 0!==n&&(t[i]=Fut(n))}return t}({},n,Hrt)),sdt(n,{filled:g}));const y=null!==(a=cgt(d.opacity))&&void 0!==a?a:h.opacity;if(m.fill)if("fill"===i||g&&i===_ot)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=Fut(null!==(s=p.legend.symbolBaseFillColor)&&void 0!==s?s:"black"),m.fillOpacity=Fut(null!=y?y:1));else if(fit(m.fill)){const t=null!==(c=null!==(u=hgt(null!==(l=d.fill)&&void 0!==l?l:d.color))&&void 0!==u?u:h.fill)&&void 0!==c?c:g&&h.color;t&&(m.fill=Fut(t))}if(m.stroke)if("stroke"===i||!g&&i===_ot)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(fit(m.stroke)){const t=mrt(hgt(d.stroke||d.color),h.stroke,g?h.color:void 0);t&&(m.stroke={value:t})}if(i!==Mot){const t=Qlt(e)&&pgt(n,r,e);t?m.opacity=[Object.assign({test:t},Fut(null!=y?y:1)),Fut(p.legend.unselectedOpacity)]:y&&(m.opacity=Fut(y))}return m=Object.assign(Object.assign({},m),t),ert(m)?void 0:m},gradient:function(t,{model:e,legendType:n}){if("gradient"!==n)return;let i={};const r=cgt(e.encoding.opacity)||e.markDef.opacity;r&&(i.opacity=Fut(r));return i=Object.assign(Object.assign({},i),t),ert(i)?void 0:i},labels:function(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},a=n.config,s=Qlt(e)?pgt(n,r,e):void 0,l=s?[{test:s,value:1},{value:a.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=o,h=Alt(c)?Tlt({fieldOrDatumDef:e,field:"datum.value",format:u,formatType:c,config:a}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),h?{text:h}:{}),t);return ert(d)?void 0:d},entries:function(t,{legendCmpt:e}){const n=e.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}};function cgt(t){return dgt(t,((t,e)=>Math.max(t,e.value)))}function hgt(t){return dgt(t,((t,e)=>mrt(t,e.value)))}function dgt(t,e){return function(t){const e=t&&t.condition;return!!e&&(fit(e)||aut(e))}(t)?bit(t.condition).reduce(e,t.value):aut(t)?t.value:void 0}function pgt(t,e,n){const i=e.get("selections");if(!(null==i?void 0:i.length))return;const r=Ait(n.field);return i.map((t=>`(!length(data(${Ait(art(t)+Qdt)})) || (${t}[${r}] && indexof(${t}[${r}], datum.value) >= 0))`)).join(" || ")}const fgt={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:i,formatType:r}=e;return Elt(t,t.type,i,r,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return Nlt(i,e,n)},gradientLength:t=>{var e,n;const{legend:i,legendConfig:r}=t;return null!==(n=null!==(e=i.gradientLength)&&void 0!==e?e:r.gradientLength)&&void 0!==n?n:function({legendConfig:t,model:e,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:a,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=t;if(llt(r))return"horizontal"===n?"top"===i||"bottom"===i?mgt(e,"width",a,o):a:mgt(e,"height",l,s);return}(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>{var i,r;return null!==(r=null!==(i=t.labelOverlap)&&void 0!==i?i:e.labelOverlap)&&void 0!==r?r:function(t){if(qit(["quantile","threshold","log"],t))return"greedy";return}(n)},symbolType:({legend:t,markDef:e,channel:n,encoding:i})=>{var r;return null!==(r=t.symbolType)&&void 0!==r?r:function(t,e,n,i){var r;if("shape"!==e){const t=null!==(r=hgt(n))&&void 0!==r?r:i;if(t)return t}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(e.type,n,i.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>yut(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(Lot(n)&&llt(e)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:({fieldOrDatumDef:t,legend:e})=>function(t,e){const n=t.values;if(fit(n))return Tut(e,n);if(dst(n))return n;return}(e,t)};function ggt(t){const{legend:e}=t;return mrt(e.type,function({channel:t,timeUnit:e,scaleType:n}){if(Lot(t)){if(qit(["quarter","month","day"],e))return"symbol";if(llt(n))return"gradient"}return"symbol"}(t))}function mgt(t,e,n,i){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${i})`}}function ygt(t){const e=Hmt(t)?function(t){const{encoding:e}=t,n={};for(const i of[_ot,...wct]){const r=_ut(e[i]);r&&t.getScaleComponent(i)&&(i===Cot&&Qlt(r)&&r.type===Rst||(n[i]=xgt(t,i)))}return n}(t):function(t){const{legends:e,resolve:n}=t.component;for(const i of t.children){ygt(i);for(const r of nrt(i.component.legends))n.legend[r]=ogt(t.component.resolve,r),"shared"===n.legend[r]&&(e[r]=bgt(e[r],i.component.legends[r]),e[r]||(n.legend[r]="independent",delete e[r]))}for(const i of nrt(e))for(const e of t.children)e.component.legends[i]&&"shared"===n.legend[i]&&delete e.component.legends[i];return e}(t);return t.component.legends=e,e}function vgt(t,e,n,i){switch(e){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===e&&t===(null==i?void 0:i.title))return!0}return t===(n||{})[e]}function xgt(t,e){var n,i,r;let o=t.legend(e);const{markDef:a,encoding:s,config:l}=t,u=l.legend,c=new lgt({},function(t,e){const n=t.scaleName(e);if("trail"===t.mark){if("color"===e)return{stroke:n};if("size"===e)return{strokeWidth:n}}return"color"===e?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}(t,e));!function(t,e,n){var i;const r=null===(i=t.fieldDef(e))||void 0===i?void 0:i.field;rpt(t,(t=>{var i,o;const a=null!==(i=t.project.hasField[r])&&void 0!==i?i:t.project.hasChannel[e];if(a&&$dt.has(t)){const e=null!==(o=n.get("selections"))&&void 0!==o?o:[];e.push(t.name),n.set("selections",e,!1),a.hasLegend=!0}}))}(t,e,c);const h=void 0!==o?!o:u.disable;if(c.set("disable",h,void 0!==o),h)return c;o=o||{};const d=t.getScaleComponent(e).get("type"),p=_ut(s[e]),f=Qlt(p)?null===(n=hst(p.timeUnit))||void 0===n?void 0:n.unit:void 0,g=o.orient||l.legend.orient||"right",m=ggt({legend:o,channel:e,timeUnit:f,scaleType:d}),y={legend:o,channel:e,model:t,markDef:a,encoding:s,fieldOrDatumDef:p,legendConfig:u,config:l,scaleType:d,orient:g,legendType:m,direction:function({legendConfig:t,legendType:e,orient:n,legend:i}){var r,o;return null!==(o=null!==(r=i.direction)&&void 0!==r?r:t[e?"gradientDirection":"symbolDirection"])&&void 0!==o?o:function(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===e?"horizontal":void 0}}(n,e)}({legend:o,legendType:m,orient:g,legendConfig:u})};for(const n of sgt){const i=n in fgt?fgt[n](y):o[n];if(void 0!==i){const r=vgt(i,n,o,t.fieldDef(e));(r||void 0===l.legend[n])&&c.set(n,i,r)}}const v=null!==(i=null==o?void 0:o.encoding)&&void 0!==i?i:{},x=c.get("selections"),b={},w={fieldOrDatumDef:p,model:t,channel:e,legendCmpt:c,legendType:m};for(const e of["labels","legend","title","symbols","gradient","entries"]){const n=igt(null!==(r=v[e])&&void 0!==r?r:{},t),i=e in ugt?ugt[e](n,w):n;void 0===i||ert(i)||(b[e]=Object.assign(Object.assign(Object.assign({},(null==x?void 0:x.length)&&Qlt(p)?{name:`${art(p.field)}_legend_${e}`}:{}),(null==x?void 0:x.length)?{interactive:!!x}:{}),{update:i}))}return ert(b)||c.set("encode",b,!!(null==o?void 0:o.encoding)),c}function bgt(t,e){var n,i,r,o;if(!t)return e.clone();const a=t.getWithExplicit("orient"),s=e.getWithExplicit("orient");if(a.explicit&&s.explicit&&a.value!==s.value)return;let l=!1;for(const n of sgt){const i=Cht(t.getWithExplicit(n),e.getWithExplicit(n),n,"legend",((t,e)=>{switch(n){case"symbolType":return wgt(t,e);case"title":return Gut(t,e);case"type":return l=!0,_ht("symbol")}return Sht(t,e,n,"legend")}));t.setWithExplicit(n,i)}return l&&((null===(i=null===(n=t.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)&&lrt(t.implicit,["encode","gradient"]),(null===(o=null===(r=t.explicit)||void 0===r?void 0:r.encode)||void 0===o?void 0:o.gradient)&&lrt(t.explicit,["encode","gradient"])),t}function wgt(t,e){return"circle"===e.value?e:t}function _gt(t,e,n,i){var r,o,a;t.encode=null!==(r=t.encode)&&void 0!==r?r:{},t.encode[e]=null!==(o=t.encode[e])&&void 0!==o?o:{},t.encode[e].update=null!==(a=t.encode[e].update)&&void 0!==a?a:{},t.encode[e].update[n]=i}function kgt(t){const e=t.component.legends,n={};for(const i of nrt(e)){const r=t.getScaleComponent(i),o=Uit(r.get("domains"));if(n[o])for(const t of n[o]){bgt(t,e[i])||n[o].push(e[i])}else n[o]=[e[i].clone()]}return irt(n).flat().map((e=>function(t,e){var n,i,r;const o=t.combine(),{disable:a,labelExpr:s,selections:l}=o,u=Eit(o,["disable","labelExpr","selections"]);if(a)return;!1===e.aria&&null==u.aria&&(u.aria=!1);if(null===(n=u.encode)||void 0===n?void 0:n.symbols){const t=u.encode.symbols.update;!t.fill||"transparent"===t.fill.value||t.stroke||u.stroke||(t.stroke={value:"transparent"});for(const e of wct)u[e]&&delete t[e]}u.title||delete u.title;if(void 0!==s){let t=s;(null===(r=null===(i=u.encode)||void 0===i?void 0:i.labels)||void 0===r?void 0:r.update)&&dst(u.encode.labels.update.text)&&(t=prt(s,"datum.label",u.encode.labels.update.text.signal)),_gt(u,"labels","text",{signal:t})}for(const t in u){const e=u[t];if(dst(e)){const n=_ct[t];if(n){const{vgProp:i,part:r}=n;_gt(u,r,i,e),delete u[t]}}}return u}(e,t.config))).filter((t=>void 0!==t))}function Sgt(t){return Ymt(t)||Xmt(t)?function(t){return t.children.reduce(((t,e)=>t.concat(e.assembleProjections())),Cgt(t))}(t):Cgt(t)}function Cgt(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:i}=n;if(e.data){const r={signal:`[${e.size.map((t=>t.signal)).join(", ")}]`},o=e.data.reduce(((e,n)=>{const i=dst(n)?n.signal:`data('${t.lookupDataSource(n)}')`;return qit(e,i)||e.push(i),e}),[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Agt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Igt extends bht{constructor(t,e,n,i){super(Object.assign({},e),{name:t}),this.specifiedProjection=e,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function Mgt(t){t.component.projection=Hmt(t)?function(t){var e;if(t.hasProjection){const n=t.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,o=i?function(t){const e=[],{encoding:n}=t;for(const i of[[xot,vot],[wot,bot]])(_ut(n[i[0]])||_ut(n[i[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});t.channelHasField(Cot)&&t.typedFieldDef(Cot).type===Rst&&e.push({signal:t.getName(`geojson_${e.length}`)});0===e.length&&e.push(t.requestDataName(Fht));return e}(t):void 0;return new Igt(t.projectionName(!0),Object.assign(Object.assign({},null!==(e=t.config.projection)&&void 0!==e?e:{}),null!=n?n:{}),r,o)}return}(t):function(t){if(0===t.children.length)return;let e;for(const e of t.children)Mgt(e);const n=Yit(t.children,(t=>{const n=t.component.projection;if(n){if(e){const t=function(t,e){const n=Yit(Agt,(n=>!_it(t.explicit,n)&&!_it(e.explicit,n)||!(!_it(t.explicit,n)||!_it(e.explicit,n)||Uit(t.get(n))!==Uit(e.get(n)))));if(Uit(t.size)===Uit(e.size)){if(n)return t;if(Uit(t.explicit)===Uit({}))return e;if(Uit(e.explicit)===Uit({}))return t}return null}(e,n);return t&&(e=t),!!t}return e=n,!0}return!0}));if(e&&n){const n=t.projectionName(!0),i=new Igt(n,e.specifiedProjection,e.size,Vit(e.data));for(const e of t.children){const t=e.component.projection;t&&(t.isFit&&i.data.push(...e.component.projection.data),e.renameProjection(t.get("name"),n),t.merged=!0)}return i}return}(t)}function Dgt(t,e){return`${pat(t)}_${e}`}function Tgt(t,e,n){var i;const r=Dgt(null!==(i=Aut(n,void 0))&&void 0!==i?i:{},e);return t.getName(`${r}_bins`)}function Egt(t,e,n){let i,r;i=function(t){return"as"in t}(t)?Cit(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:[hut(t,{forAs:!0}),hut(t,{binSuffix:"end",forAs:!0})];const o=Object.assign({},Aut(e,void 0)),a=Dgt(o,t.field),{signal:s,extentSignal:l}=function(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}(n,a);if(yat(o.extent)){const t=o.extent,e=t.selection;r=yft(n.getSelectionComponent(art(e),e),t),delete o.extent}return{key:a,binComponent:Object.assign(Object.assign(Object.assign({bin:o,field:t.field,as:[i]},s?{signal:s}:{}),l?{extentSignal:l}:{}),r?{span:r}:{})}}class Ngt extends Idt{constructor(t,e){super(t),this.bins=e}clone(){return new Ngt(null,Vit(this.bins))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,i)=>{if(out(n)&&fat(n.bin)){const{key:r,binComponent:o}=Egt(n,n.bin,e);t[r]=Object.assign(Object.assign(Object.assign({},o),t[r]),function(t,e,n,i){var r,o;if(Eut(e,n)){const a=Hmt(t)&&null!==(o=null!==(r=t.axis(n))&&void 0!==r?r:t.legend(n))&&void 0!==o?o:{},s=hut(e,{expr:"datum"}),l=hut(e,{expr:"datum",binSuffix:"end"});return{formulaAs:hut(e,{binSuffix:"range",forAs:!0}),formula:Llt(s,l,a.format,a.formatType,i)}}return{}}(e,n,i,e.config))}return t}),{});return ert(n)?null:new Ngt(t,n)}static makeFromTransform(t,e,n){const{key:i,binComponent:r}=Egt(e,e.bin,n);return new Ngt(t,{[i]:r})}merge(t,e){for(const n of nrt(t.bins))n in this.bins?(e(t.bins[n].signal,this.bins[n].signal),this.bins[n].as=Zit([...this.bins[n].as,...t.bins[n].as],Git)):this.bins[n]=t.bins[n];for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(irt(this.bins).map((t=>t.as)).flat(2))}dependentFields(){return new Set(irt(this.bins).map((t=>t.field)))}hash(){return`Bin ${Git(this.bins)}`}assemble(){return irt(this.bins).flatMap((t=>{const e=[],[n,...i]=t.as,r=t.bin,{extent:o}=r,a=Eit(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:drt(t.field),as:n,signal:t.signal},yat(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(e.push({type:"extent",field:drt(t.field),signal:t.extentSignal}),s.extent={signal:t.extentSignal}),e.push(s);for(const t of i)for(let i=0;i<2;i++)e.push({type:"formula",expr:hut({field:n[i]},{expr:"datum"}),as:t[i]});return t.formula&&e.push({type:"formula",expr:t.formula,as:t.formulaAs}),e}))}}class Ogt extends Idt{constructor(t){let e;if(super(null),Tht(t=null!=t?t:{name:"source"})||(e=t.format?Object.assign({},jit(t.format,["parse"])):{}),Mht(t))this._data={values:t.values};else if(Iht(t)){if(this._data={url:t.url},!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];qit(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.type=n}}else Nht(t)?this._data={values:[{type:"Sphere"}]}:(Dht(t)||Tht(t))&&(this._data={});this._generator=Tht(t),t.name&&(this._name=t.name),e&&!ert(e)&&(this._data.format=e)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function Fgt(t){for(const e of t){for(const t of e.children)if(t.parent!==e)return console.error("Dataflow graph is inconsistent.",e,t),!1;if(!Fgt(e.children))return!1}return!0}class Rgt extends Idt{constructor(t,e){super(t),this.params=e}clone(){return new Rgt(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Git(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class Lgt extends Idt{constructor(t,e){super(t),this.params=e}clone(){return new Lgt(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([null!==(t=this.params.as)&&void 0!==t?t:"data"])}hash(){return`Hash ${Git(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function $gt(t){return t instanceof Ogt||t instanceof Rgt||t instanceof Lgt}class Pgt{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class zgt extends Pgt{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:e}){t&&this.setContinue(),e&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if($gt(t))return!1;const e=t.parent,{continueFlag:n}=this.run(t);return n&&this.optimizeNextFromLeaves(e),this.mutatedFlag}}class Bgt extends Pgt{}function Vgt(t,e,n,i){const r=Hmt(i)?i.encoding[Xot(e)]:void 0;if(out(n)&&Hmt(i)&&Ylt(e,n,r,i.stack,i.markDef,i.config))t.add(hut(n,{})),t.add(hut(n,{suffix:"end"})),n.bin&&Eut(n,e)&&t.add(hut(n,{binSuffix:"range"}));else if(e in Oot){const n=function(t){switch(t){case"latitude":return"y";case"latitude2":return"y2";case"longitude":return"x";case"longitude2":return"x2"}}(e);t.add(i.getName(n))}else t.add(hut(n));return t}class Wgt extends Idt{constructor(t,e,n){super(t),this.dimensions=e,this.measures=n}clone(){return new Wgt(null,new Set(this.dimensions),Vit(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=!1;e.forEachFieldDef((t=>{t.aggregate&&(n=!0)}));const i={},r=new Set;return n?(e.forEachFieldDef(((t,n)=>{var o,a,s,l;const{aggregate:u,field:c}=t;if(u)if("count"===u)i["*"]=null!==(o=i["*"])&&void 0!==o?o:{},i["*"].count=new Set([hut(t,{forAs:!0})]);else{if(eot(u)||not(u)){const t=eot(u)?"argmin":"argmax",e=u[t];i[e]=null!==(a=i[e])&&void 0!==a?a:{},i[e][t]=new Set([hut({op:t,field:e},{forAs:!0})])}else i[c]=null!==(s=i[c])&&void 0!==s?s:{},i[c][u]=new Set([hut(t,{forAs:!0})]);lat(n)&&"unaggregated"===e.scaleDomain(n)&&(i[c]=null!==(l=i[c])&&void 0!==l?l:{},i[c].min=new Set([hut({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([hut({field:c,aggregate:"max"},{forAs:!0})]))}else Vgt(r,n,t,e)})),r.size+nrt(i).length===0?null:new Wgt(t,r,i)):null}static makeFromTransform(t,e){var n,i,r;const o=new Set,a={};for(const t of e.aggregate){const{op:e,field:r,as:o}=t;e&&("count"===e?(a["*"]=null!==(n=a["*"])&&void 0!==n?n:{},a["*"].count=new Set([o||hut(t,{forAs:!0})])):(a[r]=null!==(i=a[r])&&void 0!==i?i:{},a[r][e]=new Set([o||hut(t,{forAs:!0})])))}for(const t of null!==(r=e.groupby)&&void 0!==r?r:[])o.add(t);return o.size+nrt(a).length===0?null:new Wgt(t,o,a)}merge(t){return function(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}(this.dimensions,t.dimensions)?(function(t,e){var n;for(const i of nrt(e)){const r=e[i];for(const e of nrt(r))i in t?t[i][e]=new Set([...null!==(n=t[i][e])&&void 0!==n?n:[],...r[e]]):t[i]={[e]:r[e]}}}(this.measures,t.measures),!0):(function(...t){Xat.debug(...t)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...nrt(this.measures)])}producedFields(){const t=new Set;for(const e of nrt(this.measures))for(const n of nrt(this.measures[e])){const i=this.measures[e][n];0===i.size?t.add(`${n}_${e}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${Git({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],e=[],n=[];for(const i of nrt(this.measures))for(const r of nrt(this.measures[i]))for(const o of this.measures[i][r])n.push(o),t.push(r),e.push("*"===i?null:drt(i));return{type:"aggregate",groupby:[...this.dimensions].map(drt),ops:t,fields:e,as:n}}}class jgt extends Idt{constructor(t,e,n,i){super(t),this.model=e,this.name=n,this.data=i;for(const t of Pot){const n=e.facet[t];if(n){const{bin:i,sort:r}=n;this[t]=Object.assign({name:e.getName(`${t}_domain`),fields:[hut(n),...fat(i)?[hut(n,{binSuffix:"end"})]:[]]},Vlt(r)?{sortField:r}:fit(r)?{sortIndexField:Lft(n,t)}:{})}}this.childModel=e.child}hash(){let t="Facet";for(const e of Pot)this[e]&&(t+=` ${e.charAt(0)}:${Git(this[e])}`);return t}get fields(){var t;const e=[];for(const n of Pot)(null===(t=this[n])||void 0===t?void 0:t.fields)&&e.push(...this[n].fields);return e}dependentFields(){const t=new Set(this.fields);for(const e of Pot)this[e]&&(this[e].sortField&&t.add(this[e].sortField.field),this[e].sortIndexField&&t.add(this[e].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const e of Qot){const n=this.childModel.component.scales[e];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(alt(i)&&pst(r)){const n=Amt(Imt(this.childModel,e));n?t[e]=n:Yat(`Unknown field for ${e}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,e,n){const i={row:"y",column:"x"}[t],r=[],o=[],a=[];n&&n[i]&&(e?(r.push(`distinct_${n[i]}`),o.push("max")):(r.push(n[i]),o.push("distinct")),a.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:l}=this[t];if(s){const{op:t=$lt,field:e}=s;r.push(e),o.push(t),a.push(hut(s,{forAs:!0}))}else l&&(r.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:null!=e?e:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},r.length?{fields:r,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var e,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,o=[],a={};for(const t of Bft){for(const i of Vft){const o=null!==(e=r[t]&&r[t][i])&&void 0!==e?e:[];for(const e of o)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){a[t]=!0;break}}if(a[t]){const e=`length(data("${this.facet.name}"))`,n="row"===t?i?{signal:`ceil(${e} / ${i})`}:1:i?{signal:`min(${e}, ${i})`}:{signal:e};o.push({name:`${this.facet.name}_${t}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:l}=a;return(s||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,e;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:s}=this;if(o&&a&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(null!==(t=r.x)&&void 0!==t?t:[],null!==(e=r.y)&&void 0!==e?e:[]),a=o.map((()=>"distinct"));n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:a}]})}for(const t of[uot,lot])this[t]&&n.push(this.assembleRowColumnHeaderData(t,i,r));if(s){const t=this.assembleFacetHeaderData(r);t&&n.push(...t)}return n}}function Ugt(t){return"'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]?t.slice(1,-1):t}function Ggt(t){const e={};return Pit(t.filter,(t=>{var n;if(Cst(t)){let i=null;vst(t)?i=t.equal:kst(t)?i=t.range[0]:Sst(t)&&(i=(null!==(n=t.oneOf)&&void 0!==n?n:t.in)[0]),i&&(Kat(i)?e[t.field]="date":Sit(i)?e[t.field]="number":Cit(i)&&(e[t.field]="string")),t.timeUnit&&(e[t.field]="date")}})),e}function Hgt(t){const e={};function n(t){var n;Mut(t)?e[t.field]="date":"quantitative"===t.type&&(Cit(n=t.aggregate)&&qit(["min","max"],n))?e[t.field]="number":grt(t.field)>1?t.field in e||(e[t.field]="flatten"):sut(t)&&Vlt(t.sort)&&grt(t.sort.field)>1&&(t.sort.field in e||(e[t.sort.field]="flatten"))}if((Hmt(t)||qmt(t))&&t.forEachFieldDef(((e,i)=>{if(out(e))n(e);else{const r=Hot(i),o=t.fieldDef(r);n(Object.assign(Object.assign({},e),{type:o.type}))}})),Hmt(t)){const{mark:n,markDef:i,encoding:r}=t;if(Wrt(n)&&!t.encoding.order){const t=r["horizontal"===i.orient?"y":"x"];Qlt(t)&&"quantitative"===t.type&&!(t.field in e)&&(e[t.field]="number")}}return e}class qgt extends Idt{constructor(t,e){super(t),this._parse=e}clone(){return new qgt(null,Vit(this._parse))}hash(){return`Parse ${Git(this._parse)}`}static makeExplicit(t,e,n){let i={};const r=e.data;return!Tht(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(t,i,{},n)}static makeWithAncestors(t,e,n,i){for(const t of nrt(n)){const e=i.getWithExplicit(t);void 0!==e.value&&(e.explicit||e.value===n[t]||"derived"===e.value||"flatten"===n[t]?delete n[t]:Yat(Mat(t,n[t],e.value)))}for(const t of nrt(e)){const n=i.get(t);void 0!==n&&(n===e[t]?delete e[t]:Yat(Mat(t,e[t],n)))}const r=new bht(e,n);i.copyAll(r);const o={};for(const t of nrt(r.combine())){const e=r.get(t);null!==e&&(o[t]=e)}return 0===nrt(o).length||i.parseNothing?null:new qgt(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const e of nrt(this._parse)){const n=this._parse[e];1===grt(e)&&(t[e]=n)}return t}producedFields(){return new Set(nrt(this._parse))}dependentFields(){return new Set(nrt(this._parse))}assembleTransforms(t=!1){return nrt(this._parse).filter((e=>!t||grt(e)>1)).map((t=>{const e=function(t,e){const n=crt(t);if("number"===e)return`toNumber(${n})`;if("boolean"===e)return`toBoolean(${n})`;if("string"===e)return`toString(${n})`;if("date"===e)return`toDate(${n})`;if("flatten"===e)return n;if(0===e.indexOf("date:"))return`timeParse(${n},'${Ugt(e.slice(5,e.length))}')`;if(0===e.indexOf("utc:"))return`utcParse(${n},'${Ugt(e.slice(4,e.length))}')`;return Yat(`Unrecognized parse "${e}".`),null}(t,this._parse[t]);if(!e)return null;return{type:"formula",expr:e,as:frt(t)}})).filter((t=>null!==t))}}class Xgt extends Idt{clone(){return new Xgt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set(["_vgsid_"])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:"_vgsid_"}}}class Ygt extends Idt{constructor(t,e){super(t),this.transform=e}clone(){return new Ygt(null,Vit(this.transform))}addDimensions(t){this.transform.groupby=Zit(this.transform.groupby.concat(t),(t=>t))}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map((t=>t.field)).filter((t=>void 0!==t)).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:hut(t)}hash(){return`JoinAggregateTransform ${Git(this.transform)}`}assemble(){const t=[],e=[],n=[];for(const i of this.transform.joinaggregate)e.push(i.op),n.push(this.getDefaultName(i)),t.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:e,fields:t},void 0!==i?{groupby:i}:{})}}class Kgt extends Idt{constructor(t,e){super(t),this._stack=e}clone(){return new Kgt(null,Vit(this._stack))}static makeFromTransform(t,e){const{stack:n,groupby:i,as:r,offset:o="zero"}=e,a=[],s=[];if(void 0!==e.sort)for(const t of e.sort)a.push(t.field),s.push(mrt(t.order,"ascending"));const l={field:a,order:s};let u;return u=function(t){return fit(t)&&t.every((t=>Cit(t)))&&t.length>1}(r)?r:Cit(r)?[r,r+"_end"]:[e.stack+"_start",e.stack+"_end"],new Kgt(t,{stackField:n,groupby:i,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,e){const n=e.stack,{encoding:i}=e;if(!n)return null;const{groupbyChannel:r,fieldChannel:o,offset:a,impute:s}=n;let l;if(r){l=wut(i[r])}const u=function(t){return t.stack.stackBy.reduce(((t,e)=>{const n=hut(e.fieldDef);return n&&t.push(n),t}),[])}(e),c=e.encoding.order;let h;return h=fit(c)||Qlt(c)?Wut(c):u.reduce(((t,e)=>(t.field.push(e),t.order.push("y"===o?"descending":"ascending"),t)),{field:[],order:[]}),new Kgt(t,{dimensionFieldDef:l,stackField:e.vgField(o),facetby:[],stackby:u,sort:h,offset:a,impute:s,as:[e.vgField(o,{suffix:"start",forAs:!0}),e.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Git(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:e,groupby:n}=this._stack;return t?t.bin?e?[hut(t,{binSuffix:"mid"})]:[hut(t,{}),hut(t,{binSuffix:"end"})]:[hut(t)]:null!=n?n:[]}assemble(){const t=[],{facetby:e,dimensionFieldDef:n,stackField:i,stackby:r,sort:o,offset:a,impute:s,as:l}=this._stack;if(s&&n){const{band:o=.5,bin:a}=n;a&&t.push({type:"formula",expr:`${o}*`+hut(n,{expr:"datum"})+`+${1-o}*`+hut(n,{expr:"datum",binSuffix:"end"}),as:hut(n,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...r,...e],key:hut(n,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:i,sort:o,as:l,offset:a}),t}}class Zgt extends Idt{constructor(t,e){super(t),this.transform=e}clone(){return new Zgt(null,Vit(this.transform))}addDimensions(t){this.transform.groupby=Zit(this.transform.groupby.concat(t),(t=>t))}dependentFields(){var t,e;const n=new Set;return(null!==(t=this.transform.groupby)&&void 0!==t?t:[]).forEach(n.add,n),(null!==(e=this.transform.sort)&&void 0!==e?e:[]).forEach((t=>n.add(t.field))),this.transform.window.map((t=>t.field)).filter((t=>void 0!==t)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:hut(t)}hash(){return`WindowTransform ${Git(this.transform)}`}assemble(){var t;const e=[],n=[],i=[],r=[];for(const t of this.transform.window)n.push(t.op),i.push(this.getDefaultName(t)),r.push(void 0===t.param?null:t.param),e.push(void 0===t.field?null:t.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&null===o[0]&&null===o[1]&&n.every((t=>iot(t))))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:e},void 0!==a?{groupby:a}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const e of this.transform.sort)s.push(e.field),l.push(null!==(t=e.order)&&void 0!==t?t:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:e,sort:u},void 0!==c?{ignorePeers:c}:{}),void 0!==a?{groupby:a}:{}),void 0!==o?{frame:o}:{})}}class Jgt extends zgt{run(t){const e=t.parent;if(t instanceof qgt){if($gt(e))return this.flags;if(e.numChildren()>1)return this.setContinue(),this.flags;if(e instanceof qgt)this.setMutated(),e.merge(t);else{if(trt(e.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class Qgt extends Bgt{mergeNodes(t,e){const n=e.shift();for(const i of e)t.removeChild(i),i.parent=n,i.remove()}run(t){const e=t.children.map((t=>t.hash())),n={};for(let i=0;i<e.length;i++)void 0===n[e[i]]?n[e[i]]=[t.children[i]]:n[e[i]].push(t.children[i]);for(const e of nrt(n))n[e].length>1&&(this.setMutated(),this.mergeNodes(t,n[e]));for(const e of t.children)this.run(e);return this.mutatedFlag}}class tmt extends zgt{run(t){return t instanceof Mdt||t.numChildren()>0||t instanceof jgt||(this.setMutated(),t.remove()),this.flags}}class emt extends zgt{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof Ddt){const e=t.producedFields();Jit(e,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...e]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class nmt extends zgt{run(t){this.setContinue();const e=t.parent.children.filter((t=>t instanceof Ddt)),n=e.pop();for(const t of e)this.setMutated(),n.merge(t);return this.flags}}function imt(t){if(t instanceof jgt)if(1!==t.numChildren()||t.children[0]instanceof Mdt){const n=t.model.component.data.main;rmt(n);const i=(e=t,function t(n){if(!(n instanceof jgt)){const i=n.clone();if(i instanceof Mdt){const t=hmt+i.getSource();i.setSource(t),e.model.component.data.outputNodes[t]=i}else(i instanceof Wgt||i instanceof Kgt||i instanceof Zgt||i instanceof Ygt)&&i.addDimensions(e.fields);for(const e of n.children.flatMap(t))e.parent=i;return[i]}return n.children.flatMap(t)}),r=t.children.map(i).flat();for(const t of r)t.parent=n}else{const e=t.children[0];(e instanceof Wgt||e instanceof Kgt||e instanceof Zgt||e instanceof Ygt)&&e.addDimensions(t.fields),e.swapWithParent(),imt(t)}else t.children.map(imt);var e}function rmt(t){if(t instanceof Mdt&&t.type===Fht&&1===t.numChildren()){const e=t.children[0];e instanceof jgt||(e.swapWithParent(),rmt(t))}}class omt extends Bgt{constructor(){super()}run(t){t instanceof Mdt&&!t.isRequired()&&(this.setMutated(),t.remove());for(const e of t.children)this.run(e);return this.mutatedFlag}}class amt extends Bgt{constructor(t){super(),this.requiresSelectionId=t&&apt(t)}run(t){t instanceof Xgt&&(this.requiresSelectionId&&($gt(t.parent)||t.parent instanceof Wgt||t.parent instanceof qgt)||(this.setMutated(),t.remove()));for(const e of t.children)this.run(e);return this.mutatedFlag}}class smt extends zgt{run(t){const e=t.parent,n=[...e.children],i=e.children.filter((t=>t instanceof qgt));if(e.numChildren()>1&&i.length>=1){const t={},r=new Set;for(const e of i){const n=e.parse;for(const e of nrt(n))e in t?t[e]!==n[e]&&r.add(e):t[e]=n[e]}for(const e of r)delete t[e];if(!ert(t)){this.setMutated();const i=new qgt(e,t);for(const r of n){if(r instanceof qgt)for(const e of nrt(t))delete r.parse[e];e.removeChild(r),r.parent=i,r instanceof qgt&&0===nrt(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class lmt extends zgt{run(t){const e=t.parent,n=e.children.filter((t=>t instanceof Wgt)),i={};for(const t of n){const e=Git(t.groupBy);e in i||(i[e]=[]),i[e].push(t)}for(const t of nrt(i)){const n=i[t];if(n.length>1){const t=n.pop();for(const i of n)t.merge(i)&&(e.removeChild(i),i.parent=t,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class umt extends zgt{constructor(t){super(),this.model=t}run(t){const e=t.parent,n=!($gt(e)||e instanceof gft||e instanceof qgt||e instanceof Xgt),i=[],r=[];for(const t of e.children)t instanceof Ngt&&(n&&!trt(e.producedFields(),t.dependentFields())?i.push(t):r.push(t));if(i.length>0){const t=i.pop();for(const e of i)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated(),e instanceof Ngt?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const t=r.pop();for(const e of r)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class cmt extends zgt{run(t){const e=t.parent,n=[...e.children];if(!Xit(n,(t=>t instanceof Mdt))||e.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let r;for(const t of n)if(t instanceof Mdt){let n=t;for(;1===n.numChildren();){const t=n.children[0];if(!(t instanceof Mdt))break;n=t}i.push(...n.children),r?(e.removeChild(t),t.parent=r.parent,r.parent.removeChild(r),r.parent=n,this.setMutated()):r=n}else i.push(t);if(i.length){this.setMutated();for(const t of i)t.parent.removeChild(t),t.parent=r}return this.setContinue(),this.flags}}const hmt="scale_";function dmt(t){const e=[];function n(t){if(0===t.numChildren())e.push(t);else for(const e of t.children)n(e)}for(const e of t)n(e);return e}function pmt(t){return t}function fmt(t,e){return e.map((e=>{if(t instanceof zgt){const n=t.optimizeNextFromLeaves(e);return t.reset(),n}return t.run(e)})).some(pmt)}function gmt(t,e){let n=t.sources;const i=new Set;return i.add(fmt(new omt,n)),i.add(fmt(new amt(e),n)),n=n.filter((t=>t.numChildren()>0)),i.add(fmt(new tmt,dmt(n))),n=n.filter((t=>t.numChildren()>0)),i.add(fmt(new Jgt,dmt(n))),i.add(fmt(new umt(e),dmt(n))),i.add(fmt(new emt,dmt(n))),i.add(fmt(new smt,dmt(n))),i.add(fmt(new lmt,dmt(n))),i.add(fmt(new nmt,dmt(n))),i.add(fmt(new Qgt,n)),i.add(fmt(new cmt,dmt(n))),t.sources=n,i.has(!0)}class mmt{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,e){return new mmt((()=>t(e)))}}function ymt(t){Hmt(t)?function(t){const e=t.component.scales;for(const n of nrt(e)){const i=vmt(t,n);if(e[n].setWithExplicit("domains",i),_mt(t,n),t.component.data.isFaceted){let e=t;for(;!qmt(e)&&e.parent;)e=e.parent;if("shared"===e.component.resolve.scale[n])for(const t of i.value)fst(t)&&(t.data=hmt+t.data.replace(hmt,""))}}}(t):function(t){for(const e of t.children)ymt(e);const e=t.component.scales;for(const n of nrt(e)){let i,r=null;for(const e of t.children){const t=e.component.scales[n];if(t){i=void 0===i?t.getWithExplicit("domains"):Cht(i,t.getWithExplicit("domains"),"domains","scale",Smt);const e=t.get("selectionExtent");r&&e&&r.selection!==e.selection&&Yat("The same selection must be used to override scale domains in a layered view."),r=e}}e[n].setWithExplicit("domains",i),r&&e[n].set("selectionExtent",r,!0)}}(t)}function vmt(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:i}=t,r=function(t,e,n,i){if("unaggregated"===t){const{valid:t,reason:i}=kmt(e,n);if(!t)return void Yat(i)}else if(void 0===t&&i.useUnaggregatedDomain){const{valid:t}=kmt(e,n);if(t)return"unaggregated"}return t}(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return r!==t.scaleDomain(e)&&(t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:r})),"x"===e&&_ut(i.x2)?_ut(i.x)?Cht(bmt(n,r,t,"x"),bmt(n,r,t,"x2"),"domain","scale",Smt):bmt(n,r,t,"x2"):"y"===e&&_ut(i.y2)?_ut(i.y)?Cht(bmt(n,r,t,"y"),bmt(n,r,t,"y2"),"domain","scale",Smt):bmt(n,r,t,"y2"):bmt(n,r,t,e)}function xmt(t,e,n){var i;const r=null===(i=hst(n))||void 0===i?void 0:i.unit;return"temporal"===e||r?function(t,e,n){return t.map((t=>({signal:`{data: ${Dut(t,{timeUnit:n,type:e})}}`})))}(t,e,r):[t]}function bmt(t,e,n,i){const{encoding:r}=n,o=_ut(r[i]),{type:a}=o,s=o.timeUnit;if(function(t){return t&&t.unionWith}(e)){const r=bmt(t,void 0,n,i),o=xmt(e.unionWith,a,s);return wht([...r.value,...o])}if(dst(e))return wht([e]);if(e&&"unaggregated"!==e&&!clt(e))return wht(xmt(e,a,s));const l=n.stack;if(l&&i===l.fieldChannel){if("normalize"===l.offset)return _ht([[0,1]]);const t=n.requestDataName(Fht);return _ht([{data:t,field:n.vgField(i,{suffix:"start"})},{data:t,field:n.vgField(i,{suffix:"end"})}])}const u=lat(i)&&Qlt(o)?function(t,e,n){if(!alt(n))return;const i=t.fieldDef(e),r=i.sort;if(Wlt(r))return{op:"min",field:Lft(i,e),order:"ascending"};const{stack:o}=t,a=o?[...o.groupbyField?[o.groupbyField]:[],...o.stackBy.map((t=>t.fieldDef.field))]:void 0;if(Vlt(r)){return wmt(r,o&&!qit(a,r.field))}if(Blt(r)){const{encoding:e,order:n}=r,i=t.fieldDef(e),{aggregate:s,field:l}=i,u=o&&!qit(a,l);if(eot(s)||not(s))return wmt({field:hut(i),order:n},u);if(iot(s)||!s)return wmt({op:s,field:l,order:n},u)}else{if("descending"===r)return{op:"min",field:t.vgField(e),order:"descending"};if(qit(["ascending",void 0],r))return!0}return}(n,i,t):void 0;if(eut(o)){return _ht(xmt([o.datum],a,s))}const c=o;if("unaggregated"===e){const t=n.requestDataName(Fht),{field:e}=o;return _ht([{data:t,field:hut({field:e,aggregate:"min"})},{data:t,field:hut({field:e,aggregate:"max"})}])}if(fat(c.bin)){if(alt(t))return _ht("bin-ordinal"===t?[]:[{data:ort(u)?n.requestDataName(Fht):n.requestDataName("raw"),field:n.vgField(i,Eut(c,i)?{binSuffix:"range"}:{}),sort:!0!==u&&git(u)?u:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:t}=c;if(fat(t)){const e=Tgt(n,c.field,t);return _ht([new mmt((()=>{const t=n.getSignalName(e);return`[${t}.start, ${t}.stop]`}))])}return _ht([{data:n.requestDataName(Fht),field:n.vgField(i,{})}])}}if(c.timeUnit&&qit(["time","utc"],t)&&Ylt(i,c,Hmt(n)?n.encoding[Xot(i)]:void 0,n.stack,n.markDef,n.config)){const t=n.requestDataName(Fht);return _ht([{data:t,field:n.vgField(i)},{data:t,field:n.vgField(i,{suffix:"end"})}])}return _ht(u?[{data:ort(u)?n.requestDataName(Fht):n.requestDataName("raw"),field:n.vgField(i),sort:u}]:[{data:n.requestDataName(Fht),field:n.vgField(i)}])}function wmt(t,e){const{op:n,field:i,order:r}=t;return Object.assign(Object.assign({op:null!=n?n:e?"sum":$lt},i?{field:drt(i)}:{}),r?{order:r}:{})}function _mt(t,e){var n;const i=t.component.scales[e],r=t.specifiedScales[e].domain,o=null===(n=t.fieldDef(e))||void 0===n?void 0:n.bin,a=clt(r)&&r,s=mat(o)&&yat(o.extent)&&o.extent;(a||s)&&i.set("selectionExtent",null!=a?a:s,!0)}function kmt(t,e){const{aggregate:n,type:i}=t;return n?Cit(n)&&!sot[n]?{valid:!1,reason:$at(n)}:"quantitative"===i&&"log"===e?{valid:!1,reason:Pat(t)}:{valid:!0}:{valid:!1,reason:Lat(t)}}function Smt(t,e,n,i){return t.explicit&&e.explicit&&Yat(function(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${Uit(n)} and ${Uit(i)}). Using the union of the two domains.`}(n,i,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function Cmt(t){const e=Zit(t.map((t=>{if(fst(t)){return Eit(t,["sort"])}return t})),Git),n=Zit(t.map((t=>{if(fst(t)){const e=t.sort;return void 0===e||ort(e)||("op"in e&&"count"===e.op&&delete e.field,"ascending"===e.order&&delete e.order),e}})).filter((t=>void 0!==t)),Git);if(0===e.length)return;if(1===e.length){const e=t[0];if(fst(e)&&n.length>0){let t=n[0];if(n.length>1)Yat(Vat),t=!0;else if(git(t)&&"field"in t){const n=t.field;e.field===n&&(t=!t.order||{order:t.order})}return Object.assign(Object.assign({},e),{sort:t})}return e}const i=Zit(n.map((t=>ort(t)||!("op"in t)||t.op in tot?t:(Yat(function(t){return`Dropping sort property ${Uit(t)} as unioned domains only support boolean or op "count", "min", and "max".`}(t)),!0))),Git);let r;1===i.length?r=i[0]:i.length>1&&(Yat(Vat),r=!0);const o=Zit(t.map((t=>fst(t)?t.data:null)),(t=>t));if(1===o.length&&null!==o[0]){return Object.assign({data:o[0],fields:e.map((t=>t.field))},r?{sort:r}:{})}return Object.assign({fields:e},r?{sort:r}:{})}function Amt(t){if(fst(t)&&Cit(t.field))return t.field;if(function(t){return!fit(t)&&"fields"in t&&!("data"in t)}(t)){let e;for(const n of t.fields)if(fst(n)&&Cit(n.field))if(e){if(e!==n.field)return Yat("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),e}else e=n.field;return Yat("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),e}if(function(t){return!fit(t)&&"fields"in t&&"data"in t}(t)){Yat("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const e=t.fields[0];return Cit(e)?e:void 0}}function Imt(t,e){return Cmt(t.component.scales[e].get("domains").map((e=>(fst(e)&&(e.data=t.lookupDataSource(e.data)),e))))}function Mmt(t){return Ymt(t)||Xmt(t)?t.children.reduce(((t,e)=>t.concat(Mmt(e))),Dmt(t)):Dmt(t)}function Dmt(t){return nrt(t.component.scales).reduce(((e,n)=>{const i=t.component.scales[n];if(i.merged)return e;const r=i.combine(),{name:o,type:a,selectionExtent:s,domains:l,range:u,reverse:c}=r,h=Eit(r,["name","type","selectionExtent","domains","range","reverse"]),d=function(t,e,n){if(tat(n)&&pst(t))return{step:{signal:e+"_step"}};return t}(r.range,o,n);let p;s&&(p=function(t,e){const n=e.selection;return{signal:yft(t.getSelectionComponent(n,art(n)),e)}}(t,s));const f=Imt(t,n);return e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:a},f?{domain:f}:{}),p?{domainRaw:p}:{}),{range:d}),void 0!==c?{reverse:c}:{}),h)),e}),[])}class Tmt extends bht{constructor(t,e){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",e)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||Xit(this.get("domains"),(t=>fit(t)&&2===t.length&&t[0]<=0&&t[1]>=0))}}const Emt=["range","scheme"];function Nmt(t){return"x"===t?"width":"y"===t?"height":void 0}function Omt(t,e){const n=t.fieldDef(e);if(n&&n.bin&&fat(n.bin)){const i=Tgt(t,n.field,n.bin),r=Nmt(e),o=t.getName(r);return new mmt((()=>{const e=t.getSignalName(i),n=`(${e}.stop - ${e}.start) / ${e}.step`;return`${t.getSignalName(o)} / (${n})`}))}}function Fmt(t,e){const n=e.specifiedScales[t],{size:i}=e,r=e.getScaleComponent(t).get("type");for(const i of Emt)if(void 0!==n[i]){const o=plt(r,i),a=flt(t,i);if(o)if(a)Yat(a);else switch(i){case"range":return fit(n.range)&&tat(t)?wht(n.range.map((t=>{if("width"===t||"height"===t){const n=e.getName(t),i=e.getSignalName.bind(e);return mmt.fromName(i,n)}return t}))):wht(n.range);case"scheme":return wht(Rmt(n[i]))}else Yat(zat(r,i,t))}if(t===cot||t===hot){const e=t===cot?"width":"height",n=i[e];if(Dct(n)){if(alt(r))return wht({step:n.step});Yat(Bat(e))}}return _ht(function(t,e){const{size:n,config:i,mark:r,encoding:o}=e,a=e.getSignalName.bind(e),{type:s}=_ut(o[t]),l=e.getScaleComponent(t).get("type"),{domain:u,domainMid:c}=e.specifiedScales[t];switch(t){case cot:case hot:{if(qit(["point","band"],l))if(t!==cot||n.width){if(t===hot&&!n.height){const t=Fct(i.view,"height");if(Dct(t))return t}}else{const t=Fct(i.view,"width");if(Dct(t))return t}const r=Nmt(t),o=e.getName(r);return t===hot&&slt(l)?[mmt.fromName(a,o),0]:[0,mmt.fromName(a,o)]}case Aot:{const o=Lmt(r,e.component.scales[t].get("zero"),i),a=function(t,e,n,i){const r={x:Omt(n,"x"),y:Omt(n,"y")};switch(t){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const t=$mt(e,r,i.view);return Sit(t)?t-1:new mmt((()=>`${t.signal} - 1`))}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const t=$mt(e,r,i.view);return Sit(t)?Math.pow(.95*t,2):new mmt((()=>`pow(0.95 * ${t.signal}, 2)`))}}throw new Error(Oat("size",t))}(r,n,e,i);return ult(l)?function(t,e,n){const i=()=>{const i=Lut(e),r=Lut(t),o=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${o}, ${o})`};return dst(e)?new mmt(i):{signal:i()}}(o,a,function(t,e,n,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return void 0!==n&&fit(n)?n.length+1:(Yat(function(t){return`Domain for ${t} is required for threshold scale.`}(i)),3)}}(l,i,u,t)):[o,a]}case mot:return[0,2*Math.PI];case Iot:return[0,360];case fot:return[0,new mmt((()=>`min(${e.getSignalName("width")},${e.getSignalName("height")})/2`))];case"strokeWidth":return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case"strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Cot:return"symbol";case _ot:case kot:case Sot:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case Mot:case"fillOpacity":case"strokeOpacity":return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${t}`)}(t,e))}function Rmt(t){return function(t){return!Cit(t)&&!!t.name}(t)?Object.assign({scheme:t.name},jit(t,["name"])):{scheme:t}}function Lmt(t,e,n){if(e)return dst(e)?{signal:`${e.signal} ? 0 : ${Lmt(t,!1,n)}`}:0;switch(t){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Oat("size",t))}function $mt(t,e,n){const i=Dct(t.width)?t.width.step:Oct(n,"width"),r=Dct(t.height)?t.height.step:Oct(n,"height");return e.x||e.y?new mmt((()=>`min(${[e.x?e.x.signal:i,e.y?e.y.signal:r].join(", ")})`)):Math.min(i,r)}function Pmt(t,e){Hmt(t)?function(t,e){const n=t.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:a}=t;for(const s of nrt(n)){const l=a[s],u=n[s],c=t.getScaleComponent(s),h=_ut(r[s]),d=l[e],p=c.get("type"),f=c.get("padding"),g=c.get("paddingInner"),m=plt(p,e),y=flt(s,e);if(void 0!==d&&(m?y&&Yat(y):Yat(zat(p,e,s))),m&&void 0===y)if(void 0!==d)u.copyKeyFromObject(e,l);else{const n=e in zmt?zmt[e]({model:t,channel:s,fieldOrDatumDef:h,scaleType:p,scalePadding:f,scalePaddingInner:g,domain:l.domain,markDef:o,config:i}):i.scale[e];void 0!==n&&u.set(e,n,!1)}}}(t,e):Vmt(t,e)}const zmt={bins:({model:t,fieldOrDatumDef:e})=>Qlt(e)?function(t,e){const n=e.bin;if(fat(n)){const i=Tgt(t,e.field,n);return new mmt((()=>t.getSignalName(i)))}if(gat(n)&&mat(n)&&void 0!==n.step)return{step:n.step};return}(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>function(t,e){if(qit([_ot,kot,Sot],t)&&"nominal"!==e)return"hcl";return}(t,e.type),nice:({scaleType:t,channel:e,fieldOrDatumDef:n})=>function(t,e,n){var i;if((null===(i=wut(n))||void 0===i?void 0:i.bin)||qit([Wst,jst],t))return;return e in Jot||void 0}(t,e,n),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:i,config:r})=>function(t,e,n,i,r,o){if(t in Jot){if(llt(e)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:e,orient:a}=r;if("bar"===e&&(!Qlt(i)||!i.bin&&!i.timeUnit)&&("vertical"===a&&"x"===t||"horizontal"===a&&"y"===t))return o.continuousBandSize}if(e===qst)return n.pointPadding}return}(t,e,r.scale,n,i,r.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,config:i})=>function(t,e,n,i){if(void 0!==t)return;if(e in Jot){const{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:r}=i;return mrt(t,"bar"===n?e:r)}return}(t,e,n.type,i.scale),paddingOuter:({scalePadding:t,channel:e,scaleType:n,markDef:i,scalePaddingInner:r,config:o})=>function(t,e,n,i,r,o){if(void 0!==t)return;if(e in Jot&&n===Xst){const{bandPaddingOuter:t}=o;return mrt(t,dst(r)?{signal:`${r.signal}/2`}:r/2)}return}(t,e,n,i.type,r,o.scale),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:i})=>function(t,e,n,i){if("x"===n&&void 0!==i.xReverse)return slt(t)&&"descending"===e?dst(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(slt(t)&&"descending"===e)return!0;return}(e,Qlt(t)?t.sort:void 0,n,i.scale),zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:i,scaleType:r})=>function(t,e,n,i,r){if(n&&"unaggregated"!==n&&slt(r)){if(fit(n)){const t=n[0],e=n[n.length-1];if(t<=0&&e>=0)return!0}return!1}if("size"===t&&"quantitative"===e.type&&!ult(r))return!0;if((!Qlt(e)||!e.bin)&&qit([...Qot,...nat],t)){const{orient:e,type:n}=i;return!qit(["bar","area","line","trail"],n)||!("horizontal"===e&&"y"===t||"vertical"===e&&"x"===t)}return!1}(t,e,n,i,r)};function Bmt(t){Hmt(t)?function(t){const e=t.component.scales;for(const n of sat){const i=e[n];if(!i)continue;const r=Fmt(n,t);i.setWithExplicit("range",r)}}(t):Vmt(t,"range")}function Vmt(t,e){const n=t.component.scales;for(const n of t.children)"range"===e?Bmt(n):Pmt(n,e);for(const i of nrt(n)){let r;for(const n of t.children){const t=n.component.scales[i];if(t){r=Cht(r,t.getWithExplicit(e),e,"scale",kht(((t,n)=>{switch(e){case"range":return t.step&&n.step?t.step-n.step:0}return 0})))}}n[i].setWithExplicit(e,r)}}function Wmt(t,e,n,i){const r=function(t,e,n){var i;switch(e.type){case"nominal":case"ordinal":if(Lot(t)||"discrete"===dat(t))return"shape"===t&&"ordinal"===e.type&&Yat(Rat(t,"ordinal")),"ordinal";if(t in Jot){if(qit(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&t in eat)return"band";return void 0!==e.band||lut(e)&&(null===(i=e.axis)||void 0===i?void 0:i.tickBand)?"band":"point";case"temporal":return Lot(t)?"time":"discrete"===dat(t)?(Yat(Rat(t,"temporal")),"ordinal"):Qlt(e)&&e.timeUnit&&hst(e.timeUnit).utc?"utc":"time";case"quantitative":return Lot(t)?Qlt(e)&&fat(e.bin)?"bin-ordinal":"linear":"discrete"===dat(t)?(Yat(Rat(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Tat(e.type))}(e,n,i),{type:o}=t;return lat(e)?void 0!==o?mlt(e,o)?Qlt(n)&&!glt(o,n.type)?(Yat(function(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}(o,r)),r):o:(Yat(function(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}(e,o,r)),r):r:null}function jmt(t){Hmt(t)?t.component.scales=function(t){const{encoding:e,mark:n}=t;return sat.reduce(((i,r)=>{const o=_ut(e[r]);if(o&&n===Vrt&&r===Cot&&o.type===Rst)return i;let a=o&&o.scale;if(o&&null!==a&&!1!==a){a=null!=a?a:{};const e=Wmt(a,r,o,n);i[r]=new Tmt(t.scaleName(r+"",!0),{value:e,explicit:a.type===e})}return i}),{})}(t):t.component.scales=function(t){var e;const n=t.component.scales={},i={},r=t.component.resolve;for(const n of t.children){jmt(n);for(const o of nrt(n.component.scales))if(r.scale[o]=null!==(e=r.scale[o])&&void 0!==e?e:rgt(o,t),"shared"===r.scale[o]){const t=i[o],e=n.component.scales[o].getWithExplicit("type");t?Zst(t.value,e.value)?i[o]=Cht(t,e,"type","scale",Umt):(r.scale[o]="independent",delete i[o]):i[o]=e}}for(const e of nrt(i)){const r=t.scaleName(e,!0),o=i[e];n[e]=new Tmt(r,o);for(const n of t.children){const t=n.component.scales[e];t&&(n.renameScale(t.get("name"),r),t.merged=!0)}}return n}(t)}const Umt=kht(((t,e)=>Qst(t)-Qst(e)));class Gmt{constructor(){this.nameMap={}}rename(t,e){this.nameMap[t]=e}has(t){return void 0!==this.nameMap[t]}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Hmt(t){return"unit"===(null==t?void 0:t.type)}function qmt(t){return"facet"===(null==t?void 0:t.type)}function Xmt(t){return"concat"===(null==t?void 0:t.type)}function Ymt(t){return"layer"===(null==t?void 0:t.type)}class Kmt{constructor(t,e,n,i,r,o,a){var s,l;this.type=e,this.parent=n,this.config=r,this.view=a,this.children=[],this.correctDataNames=t=>(t.from&&t.from.data&&(t.from.data=this.lookupDataSource(t.from.data)),t.from&&t.from.facet&&t.from.facet.data&&(t.from.facet.data=this.lookupDataSource(t.from.facet.data)),t),this.parent=n,this.config=r,this.name=null!==(s=t.name)&&void 0!==s?s:i,this.title=Out(t.title)?{text:t.title}:t.title,this.scaleNameMap=n?n.scaleNameMap:new Gmt,this.projectionNameMap=n?n.projectionNameMap:new Gmt,this.signalNameMap=n?n.signalNameMap:new Gmt,this.data=t.data,this.description=t.description,this.transforms=(null!==(l=t.transform)&&void 0!==l?l:[]).map((t=>Rht(t)?{filter:zit(t.filter,Dst)}:t)),this.layout="layer"===e||"unit"===e?{}:function(t,e,n){var i,r;const o=n[e],a={},{spacing:s,columns:l}=o;void 0!==s&&(a.spacing=s),void 0!==l&&(Glt(t)&&!jlt(t.facet)||Act(t))&&(a.columns=l),Ict(t)&&(a.columns=1);for(const e of Ect)if(void 0!==t[e])if("spacing"===e){const n=t[e];a[e]=Sit(n)?n:{row:null!==(i=n.row)&&void 0!==i?i:s,column:null!==(r=n.column)&&void 0!==r?r:s}}else a[e]=t[e];return a}(t,e,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Glt(t)||n&&n.component.data.isFaceted&&void 0===t.data},layoutSize:new bht,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?Vit(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(t,{ignoreRange:e}={}){jmt(t),ymt(t);for(const e of dlt)Pmt(t,e);e||Bmt(t)}(this)}parseProjection(){Mgt(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){ygt(this)}assembleGroupStyle(){var t,e;if("unit"===this.type||"layer"===this.type)return null!==(e=null===(t=this.view)||void 0===t?void 0:t.style)&&void 0!==e?e:"cell"}assembleEncodeFromView(t){const e=Eit(t,["style"]),n={};for(const t of nrt(e)){const i=e[t];void 0!==i&&(n[t]=Fut(i))}return n}assembleGroupEncodeEntry(t){let e={};return this.view&&(e=this.assembleEncodeFromView(this.view)),t||(this.description&&(e.description=Fut(this.description)),"unit"!==this.type&&"layer"!==this.type)?ert(e)?void 0:e:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=e?e:{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:e}=t,n=Eit(t,["spacing"]),{component:i,config:r}=this,o=function(t,e){const n={};for(const i of Pot){const r=t[i];if(null==r?void 0:r.facetFieldDef){const{titleAnchor:t,titleOrient:o}=zft(["titleAnchor","titleOrient"],r.facetFieldDef,e,i),a=$ft(i,o),s=Kft(t,a);void 0!==s&&(n[a]=s)}}return ert(n)?void 0:n}(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:e},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let e=[];for(const n of Pot)t[n].title&&e.push(Wft(this,n));for(const t of Bft)e=e.concat(Gft(this,t));return e}assembleAxes(){return function(t,e){const{x:n=[],y:i=[]}=t;return[...n.map((t=>bft(t,"grid",e))),...i.map((t=>bft(t,"grid",e))),...n.map((t=>bft(t,"main",e))),...i.map((t=>bft(t,"main",e)))].filter((t=>t))}(this.component.axes,this.config)}assembleLegends(){return kgt(this)}assembleProjections(){return Sgt(this)}assembleTitle(){var t,e,n;const i=null!==(t=this.title)&&void 0!==t?t:{},{encoding:r}=i,o=Eit(i,["encoding"]),a=Object.assign(Object.assign(Object.assign({},Nut(this.config.title).nonMark),o),r?{encode:{update:r}}:{});if(a.text)return qit(["unit","layer"],this.type)?qit(["middle",void 0],a.anchor)&&(a.frame=null!==(e=a.frame)&&void 0!==e?e:"group"):a.anchor=null!==(n=a.anchor)&&void 0!==n?n:"start",ert(a)?void 0:a}assembleGroup(t=[]){const e={};(t=t.concat(this.assembleSignals())).length>0&&(e.signals=t);const n=this.assembleLayout();n&&(e.layout=n),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||qmt(this.parent)?Mmt(this):[];i.length>0&&(e.scales=i);const r=this.assembleAxes();r.length>0&&(e.axes=r);const o=this.assembleLegends();return o.length>0&&(e.legends=o),e}getName(t){return art((this.name?this.name+"_":"")+t)}requestDataName(t){var e;const n=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(null!==(e=i[n])&&void 0!==e?e:0)+1,n}getSizeSignalRef(t){if(qmt(this.parent)){const e=iat(ngt(t)),n=this.component.scales[e];if(n&&!n.merged){const t=n.get("type"),i=n.get("range");if(alt(t)&&pst(i)){const t=n.get("name"),i=Amt(Imt(this,e));if(i){return{signal:egt(t,n,hut({aggregate:"distinct",field:i},{expr:"datum"}))}}return Yat(`Unknown field for ${e}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const e=this.component.data.outputNodes[t];return e?e.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){return e?this.getName(t):jot(t)&&lat(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const e=this.component.scales[t];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(t,e)),!n)throw new Error(`Cannot find a selection named "${e}".`);return n}hasAxisOrientSignalRef(){var t,e;return(null===(t=this.component.axes.x)||void 0===t?void 0:t.some((t=>t.hasOrientSignalRef())))||(null===(e=this.component.axes.y)||void 0===e?void 0:e.some((t=>t.hasOrientSignalRef())))}}class Zmt extends Kmt{vgField(t,e={}){const n=this.fieldDef(t);if(n)return hut(n,e)}reduceFieldDef(t,e){return Jut(this.getMapping(),((e,n,i)=>{const r=wut(n);return r?t(e,r,i):e}),e)}forEachFieldDef(t,e){Zut(this.getMapping(),((e,n)=>{const i=wut(e);i&&t(i,n)}),e)}}class Jmt extends Idt{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=Vit(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"value",null!==(r=o[1])&&void 0!==r?r:"density"]}clone(){return new Jmt(null,Vit(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Git(this.transform)}`}assemble(){const t=this.transform,{density:e}=t,n=Eit(t,["density"]);return Object.assign({type:"kde",field:e},n)}}class Qmt extends Idt{constructor(t,e){super(t),this.filter=e}clone(){return new Qmt(null,Object.assign({},this.filter))}static make(t,e){const{config:n,mark:i,markDef:r}=e;if("filter"!==Put("invalid",r,n))return null;const o=e.reduceFieldDef(((t,n,r)=>{const o=lat(r)&&e.getScaleComponent(r);if(o){slt(o.get("type"))&&"count"!==n.aggregate&&!Wrt(i)&&(t[n.field]=n)}return t}),{});return nrt(o).length?new Qmt(t,o):null}dependentFields(){return new Set(nrt(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Git(this.filter)}`}assemble(){const t=nrt(this.filter).reduce(((t,e)=>{const n=this.filter[e],i=hut(n,{expr:"datum"});return null!==n&&("temporal"===n.type?t.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(t.push(`isValid(${i})`),t.push(`isFinite(+${i})`))),t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class tyt extends Idt{constructor(t,e){super(t),this.transform=e,this.transform=Vit(e);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map(((t,e)=>{var n;return null!==(n=i[e])&&void 0!==n?n:t}))}clone(){return new tyt(this.parent,Vit(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Git(this.transform)}`}assemble(){const{flatten:t,as:e}=this.transform;return{type:"flatten",fields:t,as:e}}}class eyt extends Idt{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=Vit(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"key",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new eyt(null,Vit(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Git(this.transform)}`}assemble(){const{fold:t,as:e}=this.transform;return{type:"fold",fields:t,as:e}}}class nyt extends Idt{constructor(t,e,n,i){super(t),this.fields=e,this.geojson=n,this.signal=i}clone(){return new nyt(null,Vit(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit)return t;let n=0;for(const i of[[xot,vot],[wot,bot]]){const r=i.map((t=>{const n=_ut(e.encoding[t]);return Qlt(n)?n.field:eut(n)?{expr:`${n.datum}`}:aut(n)?{expr:`${n.value}`}:void 0}));(r[0]||r[1])&&(t=new nyt(t,r,null,e.getName("geojson_"+n++)))}if(e.channelHasField(Cot)){const i=e.typedFieldDef(Cot);i.type===Rst&&(t=new nyt(t,null,i.field,e.getName("geojson_"+n++)))}return t}dependentFields(){var t;const e=(null!==(t=this.fields)&&void 0!==t?t:[]).filter(Cit);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Git(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class iyt extends Idt{constructor(t,e,n,i){super(t),this.projection=e,this.fields=n,this.as=i}clone(){return new iyt(null,this.projection,Vit(this.fields),Vit(this.as))}static parseAll(t,e){if(!e.projectionName())return t;for(const n of[[xot,vot],[wot,bot]]){const i=n.map((t=>{const n=_ut(e.encoding[t]);return Qlt(n)?n.field:eut(n)?{expr:`${n.datum}`}:aut(n)?{expr:`${n.value}`}:void 0})),r=n[0]===wot?"2":"";(i[0]||i[1])&&(t=new iyt(t,e.projectionName(),i,[e.getName("x"+r),e.getName("y"+r)]))}return t}dependentFields(){return new Set(this.fields.filter(Cit))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Git(this.fields)} ${Git(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class ryt extends Idt{constructor(t,e){super(t),this.transform=e}clone(){return new ryt(null,Vit(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:e=0,stop:n,step:i}=t;return{signal:`sequence(${[e,n,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,e){return new ryt(t,e)}static makeFromEncoding(t,e){const n=e.encoding,i=n.x,r=n.y;if(Qlt(i)&&Qlt(r)){const o=i.impute?i:r.impute?r:void 0;if(void 0===o)return;const a=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=o.impute,h=Qut(e.mark,n);return new ryt(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${Git(this.transform)}`}assemble(){const{impute:t,key:e,keyvals:n,method:i,groupby:r,value:o,frame:a=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:e},n?{keyvals:(l=n,void 0!==(null==l?void 0:l.stop)?this.processSequence(n):n)}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:o});var l;if(i&&"value"!==i){return[s,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:a,ignorePeers:!1},r?{groupby:r}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]}return[s]}}class oyt extends Idt{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=Vit(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:e.on,null!==(r=o[1])&&void 0!==r?r:e.loess]}clone(){return new oyt(null,Vit(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Git(this.transform)}`}assemble(){const t=this.transform,{loess:e,on:n}=t,i=Eit(t,["loess","on"]);return Object.assign({type:"loess",x:n,y:e},i)}}class ayt extends Idt{constructor(t,e,n){super(t),this.transform=e,this.secondary=n}clone(){return new ayt(null,Vit(this.transform),this.secondary)}static make(t,e,n,i){const r=e.component.data.sources,{from:o}=n;let a=null;if(function(t){return"data"in t}(o)){let t=byt(o.data,r);t||(t=new Ogt(o.data),r.push(t));const n=e.getName(`lookup_${i}`);a=new Mdt(t,n,"lookup",e.component.data.outputNodeRefCounts),e.component.data.outputNodes[n]=a}else if(function(t){return"selection"in t}(o)){const t=o.selection;if(n=Object.assign({as:t},n),a=e.getSelectionComponent(art(t),t).materialized,!a)throw new Error(`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new ayt(t,n,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?bit(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Git({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:bit(this.transform.as)}:{});else{let e=this.transform.as;Cit(e)||(Yat('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),e="_lookup"),t={as:[e]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class syt extends Idt{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=Vit(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"prob",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new syt(null,Vit(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Git(this.transform)}`}assemble(){const t=this.transform,{quantile:e}=t,n=Eit(t,["quantile"]);return Object.assign({type:"quantile",field:e},n)}}class lyt extends Idt{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=Vit(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:e.on,null!==(r=o[1])&&void 0!==r?r:e.regression]}clone(){return new lyt(null,Vit(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Git(this.transform)}`}assemble(){const t=this.transform,{regression:e,on:n}=t,i=Eit(t,["regression","on"]);return Object.assign({type:"regression",x:n,y:e},i)}}class uyt extends Idt{constructor(t,e){super(t),this.transform=e}clone(){return new uyt(null,Vit(this.transform))}addDimensions(t){var e;this.transform.groupby=Zit((null!==(e=this.transform.groupby)&&void 0!==e?e:[]).concat(t),(t=>t))}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}hash(){return`PivotTransform ${Git(this.transform)}`}assemble(){const{pivot:t,value:e,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:e},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class cyt extends Idt{constructor(t,e){super(t),this.transform=e}clone(){return new cyt(null,Vit(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Git(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function hyt(t){let e=0;return function n(i,r){var o;if(i instanceof Ogt&&!i.isGenerator&&!Iht(i.data)){t.push(r);r={name:null,source:r.name,transform:[]}}if(i instanceof qgt&&(i.parent instanceof Ogt&&!r.source?(r.format=Object.assign(Object.assign({},null!==(o=r.format)&&void 0!==o?o:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof jgt){r.name||(r.name="data_"+e++),!r.source||r.transform.length>0?(t.push(r),i.data=r.name):i.data=r.source;for(const e of i.assemble())t.push(e)}else{if((i instanceof Rgt||i instanceof Lgt||i instanceof Qmt||i instanceof gft||i instanceof Rft||i instanceof iyt||i instanceof nyt||i instanceof Wgt||i instanceof ayt||i instanceof Zgt||i instanceof Ygt||i instanceof eyt||i instanceof tyt||i instanceof Jmt||i instanceof oyt||i instanceof syt||i instanceof lyt||i instanceof Xgt||i instanceof cyt||i instanceof uyt)&&r.transform.push(i.assemble()),(i instanceof Ngt||i instanceof Ddt||i instanceof ryt||i instanceof Kgt)&&r.transform.push(...i.assemble()),i instanceof Mdt)if(r.source&&0===r.transform.length)i.setSource(r.source);else if(i.parent instanceof Mdt)i.setSource(r.name);else if(r.name||(r.name="data_"+e++),i.setSource(r.name),1===i.numChildren()){t.push(r);r={name:null,source:r.name,transform:[]}}switch(i.numChildren()){case 0:i instanceof Mdt&&(!r.source||r.transform.length>0)&&t.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_"+e++);let o=r.name;!r.source||r.transform.length>0?t.push(r):o=r.source;for(const t of i.children){n(t,{name:null,source:o,transform:[]})}break}}}}}function dyt(t,e){var n;const{facet:i,config:r,child:o,component:a}=t;if(t.channelHasField(e)){const s=i[e],l=Pft("title",null,r,e);let u=yut(s,r,{allowDisabling:!0,includeDefault:void 0===l||!!l});o.component.layoutHeaders[e].title&&(u=fit(u)?u.join(", "):u,u+=" / "+o.component.layoutHeaders[e].title,o.component.layoutHeaders[e].title=null);const c=Pft("labelOrient",s,r,e),h=mrt((null!==(n=s.header)&&void 0!==n?n:{}).labels,r.header.labels,!0),d=qit(["bottom","right"],c)?"footer":"header";a.layoutHeaders[e]={title:u,facetFieldDef:s,[d]:"facet"===e?[]:[pyt(t,e,h)]}}}function pyt(t,e,n){const i="row"===e?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):void 0,axes:[]}}function fyt(t,e){var n;const{child:i}=t;if(i.component.axes[e]){const{layoutHeaders:o,resolve:a}=t.component;if(a.axis[e]=ogt(a,e),"shared"===a.axis[e]){const a="x"===e?"column":"row",s=o[a];for(const o of i.component.axes[e]){const e="top"===(r=o.get("orient"))||"left"===r||dst(r)?"header":"footer";s[e]=null!==(n=s[e])&&void 0!==n?n:[pyt(t,a,!1)];const i=bft(o,"main",t.config,{header:!0});i&&s[e][0].axes.push(i),o.mainExtracted=!0}}}var r}function gyt(t){for(const e of t.children)e.parseLayoutSize()}function myt(t,e){const n=ngt(e),i=iat(n),r=t.component.resolve,o=t.component.layoutSize;let a;for(const e of t.children){const t=e.component.layoutSize.getWithExplicit(n),o=r.scale[i];if("independent"===o&&"step"===t.value){a=void 0;break}if(a){if("independent"===o&&a.value!==t.value){a=void 0;break}a=Cht(a,t,n,"")}else a=t}if(a){for(const i of t.children)t.renameSignal(i.getName(n),t.getName(e)),i.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(e,a)}else o.setWithExplicit(e,{explicit:!1,value:void 0})}function yyt(t,e){const n="width"===e?"x":"y",i=t.config,r=t.getScaleComponent(n);if(r){const t=r.get("type"),n=r.get("range");if(alt(t)){const t=Fct(i.view,e);return pst(n)||Dct(t)?"step":t}return Nct(i.view,e)}if(t.hasProjection||"arc"===t.mark)return Nct(i.view,e);{const t=Fct(i.view,e);return Dct(t)?t.step:t}}function vyt(t,e,n){return hut(e,Object.assign({suffix:`by_${hut(t)}`},null!=n?n:{}))}class xyt extends Zmt{constructor(t,e,n,i){super(t,"facet",e,n,i,t.resolve),this.child=Vyt(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,e){return jlt(t)?Jut(t,((t,n,i)=>qit([lot,uot],i)?void 0===n.field?(Yat(Nat(n,i)),t):(t[i]=kut(n,i,e),t):(Yat(Oat(i,"facet")),t)),{}):{facet:kut(t,"facet",e)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=_yt(this),this.child.parseData()}parseLayoutSize(){gyt(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const e of Pot)dyt(t,e);fyt(t,"x"),fyt(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,e,n;const i={};for(const r of Pot)for(const o of Vft){const a=this.component.layoutHeaders[r],s=a[o],{facetFieldDef:l}=a;if(l){const e=Pft("titleOrient",l,this.config,r);if(qit(["right","bottom"],e)){const n=$ft(r,e);i.titleAnchor=null!==(t=i.titleAnchor)&&void 0!==t?t:{},i.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const t="row"===r?"height":"width",s="header"===o?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(t)||(i[s]=null!==(e=i[s])&&void 0!==e?e:{},i[s][r]=.5),a.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:e}=this.facet,n=t?this.columnDistinctSignal():e?1:void 0;let i="all";return(e||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof xyt)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(t){return this.parent&&this.parent instanceof xyt?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:hut(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],e=[],n=[];if(this.child instanceof xyt){if(this.child.channelHasField("column")){const i=hut(this.child.facet.column);t.push(i),e.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of Qot){const r=this.child.component.scales[i];if(r&&!r.merged){const o=r.get("type"),a=r.get("range");if(alt(o)&&pst(a)){const r=Amt(Imt(this.child,i));r?(t.push(r),e.push("distinct"),n.push(`distinct_${r}`)):Yat(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:e,as:n}}assembleFacet(){const{name:t,data:e}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:o,as:a}=this.getCardinalityAggregateForChild(),s=[];for(const t of Pot){const e=this.facet[t];if(e){s.push(hut(e));const{bin:l,sort:u}=e;if(fat(l)&&s.push(hut(e,{binSuffix:"end"})),Vlt(u)){const{field:t,op:s=$lt}=u,l=vyt(e,u);n&&i?(r.push(l),o.push("max"),a.push(l)):(r.push(t),o.push(s),a.push(l))}else if(fit(u)){const n=Lft(e,t);r.push(n),o.push("max"),a.push(n)}}}const l=!!n&&!!i;return Object.assign({name:t,data:e,groupby:s},l||r.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),r.length?{fields:r,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:e}=this,n=e[t];return n?Vlt(n.sort)?[vyt(n,n.sort,{expr:"datum"})]:fit(n.sort)?[Lft(n,t,{expr:"datum"})]:[hut(n,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:e}=this,n=e[t];if(n){const{sort:t}=n;return[(Vlt(t)?t.order:!fit(t)&&t)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:e}=this;if(t.facet)return qft(t.facet,"facet",e);const n={row:["top","bottom"],column:["left","right"]};for(const i of Bft)if(t[i]){const r=Pft("labelOrient",t[i],e,i);if(qit(n[i],r))return qft(t[i],i,e)}}assembleMarks(){const{child:t}=this,e=function(t){const e=[],n=hyt(e);for(const e of t.children)n(e,{source:t.name,name:null,transform:[]});return e}(this.component.data.facetRoot),n=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),r=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),r?{style:r}:{}),{from:{facet:this.assembleFacet()},sort:{field:Pot.map((t=>this.facetSortFields(t))).flat(),order:Pot.map((t=>this.facetSortOrder(t))).flat()}}),e.length>0?{data:e}:{}),n?{encode:{update:n}}:{}),t.assembleGroup(function(t,e){if(t.component.selection&&nrt(t.component.selection).length){const n=Ait(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:N7("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Hdt(e)}(this,[])))]}getMapping(){return this.facet}}function byt(t,e){var n,i,r,o,a,s,l,u,c,h;for(const d of e){const e=d.data;if((!t.name||!d.hasName()||t.name===d.dataName)&&!((null===(n=t.format)||void 0===n?void 0:n.mesh)&&(null===(i=e.format)||void 0===i?void 0:i.feature)||((null===(r=t.format)||void 0===r?void 0:r.feature)||(null===(o=e.format)||void 0===o?void 0:o.feature))&&(null===(a=t.format)||void 0===a?void 0:a.feature)!==(null===(s=e.format)||void 0===s?void 0:s.feature)||((null===(l=t.format)||void 0===l?void 0:l.mesh)||(null===(u=e.format)||void 0===u?void 0:u.mesh))&&(null===(c=t.format)||void 0===c?void 0:c.mesh)!==(null===(h=e.format)||void 0===h?void 0:h.mesh)))if(Mht(t)&&Mht(e)){if(Bit(t.values,e.values))return d}else if(Iht(t)&&Iht(e)){if(t.url===e.url)return d}else if(Dht(t)&&t.name===d.dataName)return d}return null}function wyt(t,e){if(t.data||!t.parent){if(null===t.data){const t=new Ogt({values:[]});return e.push(t),t}const n=byt(t.data,e);if(n)return Tht(t.data)||(n.data.format=function(t,...e){for(const n of e)Kit(t,null!=n?n:{});return t}({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const n=new Ogt(t.data);return e.push(n),n}}return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}function _yt(t){var e,n,i,r,o,a,s,l,u,c;let h=wyt(t,t.component.data.sources);const{outputNodes:d,outputNodeRefCounts:p}=t.component.data,f=t.parent?t.parent.component.data.ancestorParse.clone():new Aht,g=t.data;Tht(g)?(Eht(g)?h=new Lgt(h,g.sequence):Oht(g)&&(h=new Rgt(h,g.graticule)),f.parseNothing=!0):null===(null===(e=null==g?void 0:g.format)||void 0===e?void 0:e.parse)&&(f.parseNothing=!0),h=null!==(n=qgt.makeExplicit(h,t,f))&&void 0!==n?n:h,h=new Xgt(h);const m=t.parent&&Ymt(t.parent);(Hmt(t)||qmt(t))&&m&&(h=null!==(i=Ngt.makeFromEncoding(h,t))&&void 0!==i?i:h),t.transforms.length>0&&(h=function(t,e,n){var i,r;let o=0;for(const a of e.transforms){let s,l;if(Hht(a))l=t=new Rft(t,a),s="derived";else if(Rht(a)){const r=Ggt(a);l=t=null!==(i=qgt.makeWithAncestors(t,{},r,n))&&void 0!==i?i:t,t=new gft(t,e,a.filter)}else if(qht(a))l=t=Ngt.makeFromTransform(t,a,e),s="number";else if(Yht(a))s="date",void 0===n.getWithExplicit(a.field).value&&(t=new qgt(t,{[a.field]:s}),n.set(a.field,s,!1)),l=t=Ddt.makeFromTransform(t,a);else if(Kht(a))l=t=Wgt.makeFromTransform(t,a),s="number",apt(e)&&(t=new Xgt(t));else if(Lht(a))l=t=ayt.make(t,e,a,o++),s="derived";else if(jht(a))l=t=new Zgt(t,a),s="number";else if(Uht(a))l=t=new Ygt(t,a),s="number";else if(Zht(a))l=t=Kgt.makeFromTransform(t,a),s="derived";else if(Jht(a))l=t=new eyt(t,a),s="derived";else if(Ght(a))l=t=new tyt(t,a),s="derived";else if($ht(a))l=t=new uyt(t,a),s="derived";else if(Wht(a))t=new cyt(t,a);else if(Xht(a))l=t=ryt.makeFromTransform(t,a),s="derived";else if(Pht(a))l=t=new Jmt(t,a),s="derived";else if(zht(a))l=t=new syt(t,a),s="derived";else if(Bht(a))l=t=new lyt(t,a),s="derived";else{if(!Vht(a)){Yat(`Ignoring an invalid transform: ${Uit(a)}.`);continue}l=t=new oyt(t,a),s="derived"}if(l&&void 0!==s)for(const t of null!==(r=l.producedFields())&&void 0!==r?r:[])n.set(t,s,!1)}return t}(h,t,f));const y=function(t){const e={};if(Hmt(t)&&t.component.selection)for(const n of nrt(t.component.selection)){const i=t.component.selection[n];for(const t of i.project.items)!t.channel&&grt(t.field)>1&&(e[t.field]="flatten")}return e}(t),v=Hgt(t);h=null!==(r=qgt.makeWithAncestors(h,{},Object.assign(Object.assign({},y),v),f))&&void 0!==r?r:h,Hmt(t)&&(h=nyt.parseAll(h,t),h=iyt.parseAll(h,t)),(Hmt(t)||qmt(t))&&(m||(h=null!==(o=Ngt.makeFromEncoding(h,t))&&void 0!==o?o:h),h=null!==(a=Ddt.makeFromEncoding(h,t))&&void 0!==a?a:h,h=Rft.parseAllForSortIndex(h,t));const x=t.getName("raw"),b=new Mdt(h,x,"raw",p);if(d[x]=b,h=b,Hmt(t)){const e=Wgt.makeFromEncoding(h,t);e&&(h=e,apt(t)&&(h=new Xgt(h))),h=null!==(s=ryt.makeFromEncoding(h,t))&&void 0!==s?s:h,h=null!==(l=Kgt.makeFromEncoding(h,t))&&void 0!==l?l:h}Hmt(t)&&(h=null!==(u=Qmt.make(h,t))&&void 0!==u?u:h);const w=t.getName(Fht),_=new Mdt(h,w,Fht,p);d[w]=_,h=_,Hmt(t)&&function(t,e){rpt(t,(n=>{const i=n.name,r=t.getName(`lookup_${i}`);t.component.data.outputNodes[r]=n.materialized=new Mdt(new gft(e,t,{selection:i}),r,"lookup",t.component.data.outputNodeRefCounts)}))}(t,_);let k=null;if(qmt(t)){const e=t.getName("facet");h=null!==(c=function(t,e){const{row:n,column:i}=e;if(n&&i){let e=null;for(const r of[n,i])if(Vlt(r.sort)){const{field:n,op:i=$lt}=r.sort;t=e=new Ygt(t,{joinaggregate:[{op:i,field:n,as:vyt(r,r.sort,{forAs:!0})}],groupby:[hut(r)]})}return e}return null}(h,t.facet))&&void 0!==c?c:h,k=new jgt(h,t,e,_.getSource()),d[e]=k}return Object.assign(Object.assign({},t.component.data),{outputNodes:d,outputNodeRefCounts:p,raw:b,main:_,facetRoot:k,ancestorParse:f})}class kyt extends Kmt{constructor(t,e,n,i){var r,o,a,s;super(t,"concat",e,n,i,t.resolve),"shared"!==(null===(o=null===(r=t.resolve)||void 0===r?void 0:r.axis)||void 0===o?void 0:o.x)&&"shared"!==(null===(s=null===(a=t.resolve)||void 0===a?void 0:a.axis)||void 0===s?void 0:s.y)||Yat("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(t).map(((t,e)=>Vyt(t,this,this.getName("concat_"+e),void 0,i)))}parseData(){this.component.data=_yt(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of nrt(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return Ict(t)?t.vconcat:Mct(t)?t.hconcat:t.concat}parseLayoutSize(){!function(t){gyt(t);const e=1===t.layout.columns?"width":"childWidth",n=void 0===t.layout.columns?"height":"childHeight";myt(t,e),myt(t,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.forEach((t=>t.assembleSignals())),[]}assembleLayoutSignals(){const t=Jft(this);for(const e of this.children)t.push(...e.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleMarks(){return this.children.map((t=>{const e=t.assembleTitle(),n=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},e?{title:e}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())}))}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},null!=t?{columns:t}:{}),{bounds:"full",align:"each"})}}const Syt=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Srt),{labelExpr:1,encode:1}),Cyt=nrt(Syt);class Ayt extends bht{constructor(t={},e={},n=!1){super(),this.explicit=t,this.implicit=e,this.mainExtracted=n}clone(){return new Ayt(Vit(this.explicit),Vit(this.implicit),this.mainExtracted)}hasAxisPart(t){return"axis"===t||("grid"===t||"title"===t?!!this.get(t):!(!1===(e=this.get(t))||null===e));var e}hasOrientSignalRef(){return dst(this.explicit.orient)}}const Iyt={bottom:"top",top:"bottom",left:"right",right:"left"};function Myt(t,e){if(!t)return e.map((t=>t.clone()));{if(t.length!==e.length)return;const n=t.length;for(let i=0;i<n;i++){const n=t[i],r=e[i];if(!!n!=!!r)return;if(n&&r){const e=n.getWithExplicit("orient"),o=r.getWithExplicit("orient");if(e.explicit&&o.explicit&&e.value!==o.value)return;t[i]=Dyt(n,r)}}}return t}function Dyt(t,e){for(const n of Cyt){const i=Cht(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",((t,e)=>{switch(n){case"title":return Gut(t,e);case"gridScale":return{explicit:t.explicit,value:mrt(t.value,e.value)}}return Sht(t,e,n,"axis")}));t.setWithExplicit(n,i)}return t}function Tyt(t,e,n,i,r){if("disable"===e)return void 0!==n;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(dst(n.labelAngle)?n.labelAngle:vrt(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===Fft(i,r))return!0}return t===n[e]}const Eyt=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Nyt(t,e){var n,i,r;let o=e.axis(t);const a=new Ayt,s=_ut(e.encoding[t]),{mark:l,config:u}=e,c=(null==o?void 0:o.orient)||(null===(n=u["x"===t?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=u.axis)||void 0===i?void 0:i.orient)||function(t){return"x"===t?"bottom":"left"}(t),h=e.getScaleComponent(t).get("type"),d=Ift(t,h,c,e.config),p=void 0!==o?!o:Dft("disable",u,null==o?void 0:o.style,d).configValue;if(a.set("disable",p,void 0!==o),p)return a;o=o||{};const f=function(t,e,n,i,r){const o=null==e?void 0:e.labelAngle;if(void 0!==o)return dst(o)?o:vrt(o);{const{configValue:o}=Dft("labelAngle",t.config,null==e?void 0:e.style,r);return void 0!==o?vrt(o):n===cot&&qit([Fst,Nst],i.type)?270:void 0}}(e,o,t,s,d),g={fieldOrDatumDef:s,axis:o,channel:t,model:e,scaleType:h,orient:c,labelAngle:f,mark:l,config:u};for(const n of Cyt){const i=n in Tft?Tft[n](g):Art(n)?o[n]:void 0,r=void 0!==i,s=Tyt(i,n,o,e,t);if(r&&s)a.set(n,i,s);else{const{configValue:t,configFrom:l}=Art(n)&&"values"!==n?Dft(n,e.config,o.style,d):{},u=void 0!==t;r&&!u?a.set(n,i,s):("vgAxisConfig"!==l||Eyt.has(n)&&u||wrt(t)||dst(t))&&a.set(n,t,!1)}}const m=null!==(r=o.encoding)&&void 0!==r?r:{},y=_rt.reduce(((n,i)=>{var r;if(!a.hasAxisPart(i))return n;const o=igt(null!==(r=m[i])&&void 0!==r?r:{},e),s="labels"===i?function(t,e,n){var i;const{encoding:r,config:o}=t,a=null!==(i=_ut(r[e]))&&void 0!==i?i:_ut(r[Xot(e)]),s=t.axis(e)||{},{format:l,formatType:u}=s;return Alt(u)?Object.assign({text:Tlt({fieldOrDatumDef:a,field:"datum.value",format:l,formatType:u,config:o})},n):n}(e,t,o):o;return void 0===s||ert(s)||(n[i]={update:s}),n}),{});return ert(y)||a.set("encode",y,!!o.encoding||void 0!==o.labelAngle),a}function Oyt(t,e,n,{graticule:i}){const r=Grt(t)?Object.assign({},t):{type:t},o=Put("orient",r,n);if(r.orient=function(t,e,n){switch(t){case Ort:case zrt:case Brt:case Lrt:case Frt:case Ert:return}const{x:i,y:r,x2:o,y2:a}=e;switch(t){case Trt:if(Qlt(i)&&(gat(i.bin)||Qlt(r)&&r.aggregate&&!i.aggregate))return"vertical";if(Qlt(r)&&(gat(r.bin)||Qlt(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(a||o){if(n)return n;if(!o&&(Qlt(i)&&i.type===Est&&!fat(i.bin)||iut(i)))return"horizontal";if(!a&&(Qlt(r)&&r.type===Est&&!fat(r.bin)||iut(r)))return"vertical"}case Rrt:if(o&&(!Qlt(i)||!gat(i.bin))&&a&&(!Qlt(r)||!gat(r.bin)))return;case Drt:if(a)return Qlt(r)&&gat(r.bin)?"horizontal":"vertical";if(o)return Qlt(i)&&gat(i.bin)?"vertical":"horizontal";if(t===Rrt){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Nrt:case $rt:{const e=nut(i),o=nut(r);if(e&&!o)return"tick"!==t?"horizontal":"vertical";if(!e&&o)return"tick"!==t?"vertical":"horizontal";if(e&&o){const e=i,o=r,a=e.type===Ost,s=o.type===Ost;return a&&!s?"tick"!==t?"vertical":"horizontal":!a&&s?"tick"!==t?"horizontal":"vertical":!e.aggregate&&o.aggregate?"tick"!==t?"vertical":"horizontal":e.aggregate&&!o.aggregate?"tick"!==t?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,e,o),void 0!==o&&o!==r.orient&&Yat(`Specified orient "${r.orient}" overridden with "${o}".`),"bar"===r.type&&r.orient){const t=Put("cornerRadiusEnd",r,n);if(void 0!==t){const n="horizontal"===r.orient&&e.x2||"vertical"===r.orient&&e.y2?["cornerRadius"]:Xrt[r.orient];for(const e of n)r[e]=t;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===Put("opacity",r,n)&&(r.opacity=function(t,e){if(qit([Ort,$rt,zrt,Brt],t)&&!qut(e))return.7;return}(r.type,e));void 0===r.filled&&(r.filled=!i&&function(t,e){const n=zut("filled",t,e),i=t.type;return mrt(n,i!==Ort&&i!==Nrt&&i!==Rrt)}(r,n));return void 0===Put("cursor",r,n)&&(r.cursor=function(t,e,n){if(e.href||t.href||Put("href",t,n))return"pointer";return t.cursor}(r,e,n)),r}function Fyt(t,e){const{config:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),udt("x",t,{defaultPos:"mid"})),udt("y",t,{defaultPos:"mid"})),adt("size",t)),adt("angle",t)),function(t,e,n){if(n)return{shape:{value:n}};return adt("shape",t)}(t,0,e))}function Ryt(t){var e;const{config:n,markDef:i}=t,{orient:r}=i,o="horizontal"===r?"width":"height",a=t.getScaleComponent("horizontal"===r?"x":"y"),s=null!==(e=Put("size",i,n,{vgChannel:o}))&&void 0!==e?e:n.tick.bandSize;if(void 0!==s)return s;{const t=a?a.get("range"):void 0;if(t&&pst(t)&&Sit(t.step))return 3*t.step/4;return 3*Oct(n.view,o)/4}}const Lyt={arc:{vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),udt("x",t,{defaultPos:"mid"})),udt("y",t,{defaultPos:"mid"})),ydt(t,"radius","arc")),ydt(t,"theta","arc"))},area:{vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),fdt("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===t.markDef.orient})),fdt("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===t.markDef.orient})),Sdt(t))},bar:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ydt(t,"x","bar")),ydt(t,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:t=>Fyt(t,"circle")},geoshape:{vgMark:"shape",encodeEntry:t=>Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[Object.assign({type:"geoshape",projection:t.projectionName()},n&&Qlt(n)&&n.type===Rst?{field:hut(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ydt(t,"x","image")),ydt(t,"y","image")),tdt(t,"url"))},line:{vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),udt("x",t,{defaultPos:"mid"})),udt("y",t,{defaultPos:"mid"})),adt("size",t,{vgChannel:"strokeWidth"})),Sdt(t))},point:{vgMark:"symbol",encodeEntry:t=>Fyt(t)},rect:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ydt(t,"x","rect")),ydt(t,"y","rect"))},rule:{vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return t.encoding.x||t.encoding.y||t.encoding.latitude||t.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),fdt("x",t,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),fdt("y",t,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),adt("size",t,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:t=>Fyt(t,"square")},text:{vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),udt("x",t,{defaultPos:"mid"})),udt("y",t,{defaultPos:"mid"})),tdt(t)),adt("size",t,{vgChannel:"fontSize"})),adt("angle",t)),Cdt("align",function(t,e,n){if(void 0===Put("align",t,n))return"center";return}(t.markDef,0,e))),Cdt("baseline",function(t,e,n){if(void 0===Put("baseline",t,n))return"middle";return}(t.markDef,0,e))),udt("radius",t,{defaultPos:null,isMidPoint:!0})),udt("theta",t,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,i=n.orient,r="horizontal"===i?"width":"height",o="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),udt("x",t,{defaultPos:"mid",vgChannel:"xc"})),udt("y",t,{defaultPos:"mid",vgChannel:"yc"})),adt("size",t,{defaultValue:Ryt(t),vgChannel:r})),{[o]:Fut(Put("thickness",n,e))})}},trail:{vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_dt(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),udt("x",t,{defaultPos:"mid"})),udt("y",t,{defaultPos:"mid"})),adt("size",t)),Sdt(t))}};function $yt(t){return qit([Nrt,Drt,Prt],t.mark)?function(t){const e=Qut(t.mark,t.encoding),n=Pyt(t,{fromPrefix:e.length>0?"faceted_path_":""});return e.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+t.requestDataName(Fht),data:t.requestDataName(Fht),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(t):qit([Trt],t.mark)?function(t){const e=yst.some((e=>Put(e,t.markDef,t.config)));if(t.stack&&!t.fieldDef("size")&&e){const[e]=Pyt(t,{fromPrefix:"stack_group_"}),n=t.scaleName(t.stack.fieldChannel),i=(e={})=>t.vgField(t.stack.fieldChannel,e),r=(t,e)=>`${t}(${[i({prefix:"min",suffix:"start",expr:e}),i({prefix:"max",suffix:"start",expr:e}),i({prefix:"min",suffix:"end",expr:e}),i({prefix:"max",suffix:"end",expr:e})].map((t=>`scale('${n}',${t})`)).join(",")})`;let o,a;"x"===t.stack.fieldChannel?(o=Object.assign(Object.assign({},Wit(e.encode.update,["y","yc","y2","height",...yst])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update=Object.assign(Object.assign({},jit(e.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},Wit(e.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update=Object.assign(Object.assign({},jit(e.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of yst){const i=zut(n,t.markDef,t.config);e.encode.update[n]?(o[n]=e.encode.update[n],delete e.encode.update[n]):i&&(o[n]=Fut(i)),i&&(e.encode.update[n]={value:0})}const s=t.fieldDef(t.stack.groupbyChannel),l=hut(s)?[hut(s)]:[];((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(hut(s,{binSuffix:"end"}));return o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,i)=>{if(e.encode.update[i])return Object.assign(Object.assign({},n),{[i]:e.encode.update[i]});{const e=zut(i,t.markDef,t.config);return void 0!==e?Object.assign(Object.assign({},n),{[i]:Fut(e)}):n}}),o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(Fht),name:"stack_group_"+t.requestDataName(Fht),groupby:l,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[e]}]}]}return Pyt(t)}(t):Pyt(t)}function Pyt(t,e={fromPrefix:""}){const{mark:n,markDef:i,config:r}=t,o=mrt(i.clip,function(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return!!(e&&e.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(t),function(t){const e=t.component.projection;return!(!e||e.isFit)||void 0}(t)),a=$ut(i),s=t.encoding.key,l=function(t){const{encoding:e,stack:n,mark:i,markDef:r,config:o}=t,a=e.order;if(!(!fit(a)&&aut(a)&&Hit(a.value)||!a&&Hit(Put("order",r,o)))){if((fit(a)||Qlt(a))&&!n)return Wut(a,{expr:"datum"});if(Wrt(i)){const n="horizontal"===r.orient?"y":"x",i=e[n];if(Qlt(i)){const e=i.sort;return fit(e)?{field:hut(i,{prefix:n,suffix:"sort_index",expr:"datum"})}:Vlt(e)?{field:hut({aggregate:qut(t.encoding)?e.op:void 0,field:e.field},{expr:"datum"})}:Blt(e)?{field:hut(t.fieldDef(e.encoding),{expr:"datum"}),order:e.order}:null===e?void 0:{field:hut(i,{binSuffix:t.stack&&t.stack.impute?"mid":void 0,expr:"datum"})}}}}}(t),u=function(t){if(!t.component.selection)return null;const e=nrt(t.component.selection).length;let n=e,i=t.parent;for(;i&&0===n;)n=nrt(i.component.selection).length,i=i.parent;return n?{interactive:e>0}:null}(t),c=Put("aria",i,r),h=Lyt[n].postEncodingTransform?Lyt[n].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:Lyt[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),u||{}),!1===c?{aria:c}:{}),{from:{data:e.fromPrefix+t.requestDataName(Fht)},encode:{update:Lyt[n].encodeEntry(t)}}),h?{transform:h}:{})]}class zyt extends Zmt{constructor(t,e,n,i={},r){var o,a;super(t,"unit",e,n,r,void 0,Tct(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Grt(t.mark)?t.mark.type:t.mark;this.markDef=Oyt(t.mark,null!==(o=t.encoding)&&void 0!==o?o:{},r,{graticule:t.data&&Oht(t.data)});const l=this.encoding=Yut(null!==(a=t.encoding)&&void 0!==a?a:{},this.markDef,r);this.size=function({encoding:t,size:e}){for(const n of Qot){const i=Yot(n);Dct(e[i])&&nut(t[n])&&(delete e[i],Yat(Bat(i)))}return e}({encoding:l,size:Tct(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=Jct(s,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,e=this.mark===Vrt,n=t&&Fot.some((e=>rut(t[e])));return e||n}scaleDomain(t){const e=this.specifiedScales[t];return e?e.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return sat.reduce(((t,n)=>{var i;const r=_ut(e[n]);return r&&(t[n]=null!==(i=r.scale)&&void 0!==i?i:{}),t}),{})}initAxes(t){return Qot.reduce(((e,n)=>{const i=t[n];if(rut(i)||n===cot&&rut(t.x2)||n===hot&&rut(t.y2)){const t=rut(i)?i.axis:void 0;e[n]=t?Object.assign({},t):t}return e}),{})}initLegend(t){return oat.reduce(((e,n)=>{const i=_ut(t[n]);if(i&&function(t){switch(t){case _ot:case kot:case Sot:case Aot:case Cot:case"opacity":case"strokeWidth":case"strokeDash":return!0;case"fillOpacity":case"strokeOpacity":case"angle":return!1}}(n)){const t=i.legend;e[n]=t?Object.assign({},t):t}return e}),{})}parseData(){this.component.data=_yt(this)}parseLayoutSize(){!function(t){const{size:e,component:n}=t;for(const i of Qot){const r=Yot(i);if(e[r]){const t=e[r];n.layoutSize.set(r,Dct(t)?"step":t,!0)}else{const e=yyt(t,r);n.layoutSize.set(r,e,!1)}}}(this)}parseSelections(){this.component.selection=function(t,e){var n;const i={},r=t.config.selection;for(const o of nrt(null!=e?e:{})){const a=Vit(e[o]),s=Eit(r[a.type],["fields","encodings"]);for(const t in s)"encodings"===t&&a.fields||"fields"===t&&a.encodings||("mark"===t&&(a[t]=Object.assign(Object.assign({},s[t]),a[t])),void 0!==a[t]&&!0!==a[t]||(a[t]=null!==(n=s[t])&&void 0!==n?n:a[t]));const l=art(o),u=i[l]=Object.assign(Object.assign({},a),{name:l,events:Cit(a.on)?N7(a.on,"scope"):Vit(a.on)});jdt(u,(n=>{n.has(u)&&n.parse&&n.parse(t,u,a,e[o])}))}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=$yt(this)}parseAxesAndHeaders(){var t;this.component.axes=(t=this,Qot.reduce(((e,n)=>(t.component.scales[n]&&(e[n]=[Nyt(n,t)]),e)),{}))}assembleSelectionTopLevelSignals(t){return function(t,e){let n=!1;rpt(t,((i,r)=>{const o=i.name,a=Ait(o+Qdt);if(0===e.filter((t=>t.name===o)).length){const t="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";e.push({name:i.name,update:`${npt}(${a}, ${Ait(t)}${n}`})}n=!0,r.topLevelSignals&&(e=r.topLevelSignals(t,i,e)),jdt(i,(n=>{n.topLevelSignals&&(e=n.topLevelSignals(t,i,e))}))})),n&&0===e.filter((t=>"unit"===t.name)).length&&e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return Hdt(e)}(this,t)}assembleSignals(){return[...wft(this),...(t=this,e=[],rpt(t,((n,i)=>{const r=n.name;let o=i.modifyExpr(t,n);e.push(...i.signals(t,n)),jdt(n,(i=>{i.signals&&(e=i.signals(t,n,e)),i.modifyExpr&&(o=i.modifyExpr(t,n,o))})),e.push({name:r+ept,on:[{events:{signal:n.name+tpt},update:`modify(${Ait(n.name+Qdt)}, ${o})`}]})})),Hdt(e))];var t,e}assembleSelectionData(t){return function(t,e){const n=[...e];return rpt(t,(e=>{const i={name:e.name+Qdt};if(e.init){const n=e.project.items.map((t=>Eit(t,["signals"]))),r=e.init.map((t=>Udt(t,!1)));i.values="interval"===e.type?[{unit:opt(t,{escape:!1}),fields:n,values:r}]:r.map((e=>({unit:opt(t,{escape:!1}),fields:n,values:e})))}n.filter((t=>t.name===e.name+Qdt)).length||n.push(i)})),n}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return Jft(this)}assembleMarks(){var t;let e=null!==(t=this.component.mark)&&void 0!==t?t:[];return this.parent&&Ymt(this.parent)||(e=Gdt(this,e)),e.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Hut(this.encoding,t)}fieldDef(t){return wut(this.encoding[t])}typedFieldDef(t){const e=this.fieldDef(t);return out(e)?e:null}}class Byt extends Kmt{constructor(t,e,n,i,r){super(t,"layer",e,n,r,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map(((t,e)=>{if(Hct(t))return new Byt(t,this,this.getName("layer_"+e),o,r);if(Zrt(t))return new zyt(t,this,this.getName("layer_"+e),o,r);throw new Error(xat(t))}))}parseData(){this.component.data=_yt(this);for(const t of this.children)t.parseData()}parseLayoutSize(){var t;gyt(t=this),myt(t,"width"),myt(t,"height")}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of nrt(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){!function(t){var e;const{axes:n,resolve:i}=t.component,r={top:0,bottom:0,right:0,left:0};for(const e of t.children){e.parseAxesAndHeaders();for(const r of nrt(e.component.axes))i.axis[r]=ogt(t.component.resolve,r),"shared"===i.axis[r]&&(n[r]=Myt(n[r],e.component.axes[r]),n[r]||(i.axis[r]="independent",delete n[r]))}for(const o of Qot){for(const a of t.children)if(a.component.axes[o]){if("independent"===i.axis[o]){n[o]=(null!==(e=n[o])&&void 0!==e?e:[]).concat(a.component.axes[o]);for(const t of a.component.axes[o]){const{value:e,explicit:n}=t.getWithExplicit("orient");if(!dst(e)){if(r[e]>0&&!n){const n=Iyt[e];r[e]>r[n]&&t.set("orient",n,!1)}r[e]++}}}delete a.component.axes[o]}if("independent"===i.axis[o]&&n[o]&&n[o].length>1)for(const t of n[o])t.get("grid")&&!t.explicit.grid&&(t.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleSignals())),wft(this))}assembleLayoutSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleLayoutSignals())),Jft(this))}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const e of this.children)if(t=e.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return function(t,e){for(const n of t.children)Hmt(n)&&(e=Gdt(n,e));return e}(this,this.children.flatMap((t=>t.assembleMarks())))}assembleLegends(){return this.children.reduce(((t,e)=>t.concat(e.assembleLegends())),kgt(this))}}function Vyt(t,e,n,i,r){if(Glt(t))return new xyt(t,e,n,r);if(Hct(t))return new Byt(t,e,n,i,r);if(Zrt(t))return new zyt(t,e,n,i,r);if(function(t){return Ict(t)||Mct(t)||Act(t)}(t))return new kyt(t,e,n,r);throw new Error(xat(t))}const Wyt=new class extends qct{mapUnit(t,{config:e}){if(t.encoding){const{encoding:n,transform:i}=t,{bins:r,timeUnits:o,aggregate:a,groupby:s,encoding:l}=Xut(n,e),u=[...i||[],...r,...o,...0===a.length?[]:[{aggregate:a,groupby:s}]];return Object.assign(Object.assign(Object.assign({},t),u.length>0?{transform:u}:{}),{encoding:l})}return t}};const jyt=rit;var Uyt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",normalize:ght,version:jyt,compile:function(t,e={}){var n;e.logger&&(n=e.logger,Xat=n),e.fieldTitle&&mut(e.fieldTitle);try{const n=Bct(yit(e.config,t.config)),i=ght(t,n),r=Vyt(i,null,"",void 0,n);r.parse(),function(t,e){Fgt(t.sources);let n=0,i=0;for(let i=0;i<5&&gmt(t,e);i++)n++;t.sources.map(imt);for(let n=0;n<5&&gmt(t,e);n++)i++;Fgt(t.sources),5===Math.max(n,i)&&Yat("Maximum optimization runs(5) reached.")}(r.component.data,r);return{spec:function(t,e,n={},i){const r=t.config?Uct(t.config):void 0,o=[].concat(t.assembleSelectionData([]),function(t,e){var n,i;const r=[],o=hyt(r);let a=0;for(const e of t.sources){e.hasName()||(e.dataName="source_"+a++);const t=e.assemble();o(e,t)}for(const t of r)0===t.transform.length&&delete t.transform;let s=0;for(const[t,e]of r.entries())0!==(null!==(n=e.transform)&&void 0!==n?n:[]).length||e.source||r.splice(s++,0,r.splice(t,1)[0]);for(const e of r)for(const n of null!==(i=e.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=t.outputNodes[n.from].getSource());for(const t of r)t.name in e&&(t.values=e[t.name]);return r}(t.component.data,n)),a=t.assembleProjections(),s=t.assembleTitle(),l=t.assembleGroupStyle(),u=t.assembleGroupEncodeEntry(!0);let c=t.assembleLayoutSignals();return c=c.filter((t=>"width"!==t.name&&"height"!==t.name||void 0===t.value||(e[t.name]=+t.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),e),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:o}),a.length>0?{projections:a}:{}),t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}(r,function(t,e,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");void 0===e?(e={type:"pad"},i.hasAxisOrientSignalRef()&&(e.resize=!0)):Cit(e)&&(e={type:e});if(r&&o&&(a=e.type,"fit"===a||"fit-x"===a||"fit-y"===a))if("step"===r&&"step"===o)Yat(kat()),e.type="pad";else if("step"===r||"step"===o){const t="step"===r?"width":"height";Yat(kat(iat(t)));const n="width"===t?"height":"width";e.type=function(t){return t?`fit-${iat(t)}`:"fit"}(n)}var a;return Object.assign(Object.assign(Object.assign({},1===nrt(e).length&&e.type?"pad"===e.type?{}:{autosize:e.type}:{autosize:e}),xht(n)),xht(t))}(t,i.autosize,n,r),t.datasets,t.usermeta),normalized:i}}finally{e.logger&&(Xat=Gat),e.fieldTitle&&mut(fut)}},extractTransforms:function(t,e){return Wyt.map(t,{config:e})}});function Gyt(t){const[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}}const Hyt={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},qyt={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Xyt={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Yyt={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Kyt="Benton Gothic Bold, sans-serif",Zyt={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Jyt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Kyt,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:Kyt,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:Kyt,titleFontSize:13,titleFontWeight:"normal"},range:{category:Zyt["category-6"],diverging:Zyt["fireandice-6"],heatmap:Zyt["fire-7"],ordinal:Zyt["fire-7"],ramp:Zyt["fire-7"]}},Qyt={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},tvt={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},evt={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},nvt={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:evt["six-groups-cat-1"],diverging:evt["diverging-colors"],heatmap:evt["diverging-colors"],ordinal:evt["six-groups-seq"],ramp:evt["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},ivt={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},rvt="2.10.0";var ovt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dark:Hyt,excel:qyt,fivethirtyeight:Xyt,ggplot2:Yyt,googlecharts:ivt,latimes:Jyt,quartz:Qyt,urbaninstitute:nvt,version:rvt,vox:tvt}),avt="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const svt="vg-tooltip-element",lvt={offsetX:10,offsetY:10,id:svt,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function uvt(t,e,n){if(UN(t))return`[${t.map((t=>e(BO(t)?t:cvt(t,n)))).join(", ")}]`;if(GN(t)){let i="";const r=t,{title:o,image:a}=r,s=
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(r,["title","image"]);o&&(i+=`<h2>${e(o)}</h2>`),a&&(i+=`<img src="${e(a)}">`);const l=Object.keys(s);if(l.length>0){i+="<table>";for(const t of l){let r=s[t];void 0!==r&&(GN(r)&&(r=cvt(r,n)),i+=`<tr><td class="key">${e(t)}:</td><td class="value">${e(r)}</td></tr>`)}i+="</table>"}return i||"{}"}return e(t)}function cvt(t,e){return JSON.stringify(t,function(t){const e=[];return function(n,i){if("object"!=typeof i||null===i)return i;const r=e.indexOf(this)+1;return e.length=r,e.length>t?"[Object]":e.indexOf(i)>=0?"[Circular]":(e.push(i),i)}}(e))}class hvt{constructor(t){this.options=Object.assign(Object.assign({},lvt),t);const e=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const t=document.createElement("style");t.setAttribute("id",this.options.styleId),t.innerHTML=function(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return avt.toString().replace(svt,t)}(e);const n=document.head;n.childNodes.length>0?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)}}tooltipHandler(t,e,n,i){this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el));if((null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==i||""===i)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=uvt(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:o}=function(t,e,n,i){let r=t.clientX+n;r+e.width>window.innerWidth&&(r=+t.clientX-n-e.width);let o=t.clientY+i;return o+e.height>window.innerHeight&&(o=+t.clientY-i-e.height),{x:r,y:o}}(e,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${o}px; left: ${r}px`)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function dvt(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))}var pvt,fvt='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function gvt(t,...e){for(const n of e)mvt(t,n);return t}function mvt(t,e){for(const n of Object.keys(e))XN(t,n,e[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t});const yvt=iit;let vvt=Uyt;const xvt="undefined"!=typeof window?window:void 0;void 0===vvt&&(null===(pvt=null==xvt?void 0:xvt.vl)||void 0===pvt?void 0:pvt.compile)&&(vvt=xvt.vl);const bvt={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},wvt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},_vt={vega:"Vega","vega-lite":"Vega-Lite"},kvt={vega:yvt.version,"vega-lite":vvt?vvt.version:"not available"},Svt={vega:t=>t,"vega-lite":(t,e)=>vvt.compile(t,{config:e}).spec},Cvt='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';function Avt(t,e,n,i){const r=`<html><head>${e}</head><body><pre><code class="json">`,o=`</code></pre>${n}</body></html>`,a=window.open("");a.document.write(r+t+o),a.document.title=`${_vt[i]} JSON Source`}function Ivt(t,e){var n;if(t.$schema){const i=Gyt(t.$schema);e&&e!==i.library&&console.warn(`The given visualization spec is written in ${_vt[i.library]}, but mode argument sets ${null!==(n=_vt[e])&&void 0!==n?n:e}.`);const r=i.library;return AN.satisfies(kvt[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${_vt[r]} ${i.version}, but the current version of ${_vt[r]} is v${kvt[r]}.`),r}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":null!=e?e:"vega"}function Mvt(t){return(e=t)&&"load"in e?t:yvt.loader(t);var e}function Dvt(t){var e;return null!==(e=t.usermeta&&t.usermeta.embedOptions)&&void 0!==e?e:{}}function Tvt(t,e){var n;return dvt(this,void 0,void 0,(function*(){const i=BO(t.config)?JSON.parse(yield e.load(t.config)):null!==(n=t.config)&&void 0!==n?n:{},r=BO(t.patch)?JSON.parse(yield e.load(t.patch)):t.patch;return Object.assign(Object.assign(Object.assign({},t),r?{patch:r}:{}),i?{config:i}:{})}))}var Evt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:function(t,e,n={}){var i,r,o;return dvt(this,void 0,void 0,(function*(){let a,s;BO(e)?(s=Mvt(n.loader),a=JSON.parse(yield s.load(e))):a=e;const l=Dvt(a).loader;s&&!l||(s=Mvt(null!==(i=n.loader)&&void 0!==i?i:l));const u=yield Tvt(Dvt(a),s),c=yield Tvt(n,s),h=Object.assign(Object.assign({},gvt(c,u)),{config:qN(null!==(r=c.config)&&void 0!==r?r:{},null!==(o=u.config)&&void 0!==o?o:{})});return yield function(t,e,n={},i){var r,o,a,s,l,u;return dvt(this,void 0,void 0,(function*(){const c=n.theme?qN(ovt[n.theme],null!==(r=n.config)&&void 0!==r?r:{}):n.config,h=RO(n.actions)?n.actions:gvt({},bvt,null!==(o=n.actions)&&void 0!==o?o:{}),d=Object.assign(Object.assign({},wvt),n.i18n),p=null!==(a=n.renderer)&&void 0!==a?a:"canvas",f=null!==(s=n.logLevel)&&void 0!==s?s:yvt.Warn,g=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",m="string"==typeof t?document.querySelector(t):t;if(!m)throw new Error(`${t} does not exist`);if(!1!==n.defaultStyle){const t="vega-embed-style",{root:e,rootContainer:i}=function(t){var e;const n=t.getRootNode?t.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(e=document.head)&&void 0!==e?e:document.body}}(m);if(!e.getElementById(t)){const e=document.createElement("style");e.id=t,e.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?fvt.toString():n.defaultStyle,i.appendChild(e)}}const y=Ivt(e,n.mode);let v=Svt[y](e,c);if("vega-lite"===y&&v.$schema){const t=Gyt(v.$schema);AN.satisfies(kvt.vega,`^${t.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${t.version}, but current version is v${kvt.vega}.`)}m.classList.add("vega-embed"),h&&m.classList.add("has-actions"),m.innerHTML="";let x=m;if(h){const t=document.createElement("div");t.classList.add("chart-wrapper"),m.appendChild(t),x=t}const b=n.patch;b&&(v=b instanceof Function?b(v):cT(v,b,!0,!1).newDocument),n.formatLocale&&yvt.formatLocale(n.formatLocale),n.timeFormatLocale&&yvt.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=yvt.parse(v,"vega-lite"===y?{}:c,{ast:w}),k=new(n.viewClass||yvt.View)(_,Object.assign({loader:i,logLevel:f,renderer:p},w?{expr:yvt.expressionInterpreter}:{}));if(!1!==n.tooltip){let t;t="function"==typeof n.tooltip?n.tooltip:new hvt(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(t)}let S,{hover:C}=n;if(void 0===C&&(C="vega"===y),C){const{hoverSet:t,updateSet:e}="boolean"==typeof C?{}:C;k.hover(t,e)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(x,n.bind).runAsync(),!1!==h){let t=m;if(!1!==n.defaultStyle){const e=document.createElement("details");e.title=d.CLICK_TO_VIEW_ACTIONS,m.append(e),t=e;const n=document.createElement("summary");n.innerHTML=Cvt,e.append(n),S=t=>{e.contains(t.target)||e.removeAttribute("open")},document.addEventListener("click",S)}const i=document.createElement("div");if(t.append(i),i.classList.add("vega-actions"),!0===h||!1!==h.export)for(const t of["svg","png"])if(!0===h||!0===h.export||h.export[t]){const e=d[`${t.toUpperCase()}_ACTION`],r=document.createElement("a");r.text=e,r.href="#",r.target="_blank",r.download=`${g}.${t}`,r.addEventListener("mousedown",(function(e){return dvt(this,void 0,void 0,(function*(){e.preventDefault();const i=yield k.toImageURL(t,n.scaleFactor);this.href=i}))})),i.append(r)}if(!0===h||!1!==h.source){const t=document.createElement("a");t.text=d.SOURCE_ACTION,t.href="#",t.addEventListener("click",(function(t){var i,r;Avt(_T(e),null!==(i=n.sourceHeader)&&void 0!==i?i:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"",y),t.preventDefault()})),i.append(t)}if("vega-lite"===y&&(!0===h||!1!==h.compiled)){const t=document.createElement("a");t.text=d.COMPILED_ACTION,t.href="#",t.addEventListener("click",(function(t){var e,i;Avt(_T(v),null!==(e=n.sourceHeader)&&void 0!==e?e:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"","vega"),t.preventDefault()})),i.append(t)}if(!0===h||!1!==h.editor){const t=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",r=document.createElement("a");r.text=d.EDITOR_ACTION,r.href="#",r.addEventListener("click",(function(n){!function(t,e,n){const i=t.open(e),{origin:r}=new URL(e);let o=40;t.addEventListener("message",(function e(n){n.source===i&&(o=0,t.removeEventListener("message",e,!1))}),!1),setTimeout((function t(){o<=0||(i.postMessage(n,r),setTimeout(t,250),o-=1)}),250)}(window,t,{config:c,mode:y,renderer:p,spec:_T(e)}),n.preventDefault()})),i.append(r)}}function A(){S&&document.removeEventListener("click",S),k.finalize()}return{view:k,spec:e,vgSpec:v,finalize:A}}))}(t,a,h,s)}))},DEFAULT_ACTIONS:bvt,guessMode:Ivt,vega:yvt,get vegaLite(){return vvt}}),Nvt=Object.getOwnPropertySymbols,Ovt=Object.prototype.hasOwnProperty,Fvt=Object.prototype.propertyIsEnumerable;
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/function Rvt(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var Lvt=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,i,r=Rvt(t),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))Ovt.call(n,a)&&(r[a]=n[a]);if(Nvt){i=Nvt(n);for(var s=0;s<i.length;s++)Fvt.call(n,i[s])&&(r[i[s]]=n[i[s]])}}return r},$vt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.StyleSheet=u;var n,i=(n=Lvt)&&n.__esModule?n:{default:n};function r(t){return t[t.length-1]}function o(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}var a="undefined"!=typeof window,s=function(){if(a){var t=document.createElement("div");return t.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length}}();function l(){var t=document.createElement("style");return t.type="text/css",t.setAttribute("data-glamor",""),t.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.speedy,n=void 0===e||e,i=t.maxLength,r=void 0===i?a&&s?4e3:65e3:i;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=r,this.ctr=0}(0,i.default)(u.prototype,{getSheet:function(){return o(r(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");a?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(e){t.sheet.cssRules.push({cssText:e})}},this.injected=!0},speedy:function(t){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var e=this.getSheet();e.insertRule(t,-1!==t.indexOf("@import")?0:e.cssRules.length)}catch(t){}},insert:function(t){if(a)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(-1!==t.indexOf("@import")){var e=r(this.tags);e.insertBefore(document.createTextNode(t),e.firstChild)}else r(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,-1!==t.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,a&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){a?(this.tags.forEach((function(t){return t.parentNode.removeChild(t)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!a)return this.sheet.cssRules;var t=[];return this.tags.forEach((function(e){return t.splice.apply(t,[t.length,0].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.from(o(e).cssRules))))})),t}})})),Pvt=/-(.)/g;var zvt=function(t){return t.replace(Pvt,(function(t,e){return e.toUpperCase()}))},Bvt=/^-ms-/;var Vvt=function(t){return zvt(t.replace(Bvt,"ms-"))},Wvt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};var i=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(t){i.forEach((function(e){n[function(t,e){return t+e.charAt(0).toUpperCase()+e.substring(1)}(e,t)]=n[t]}))}));var r={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};e.default=r}));function jvt(t){return function(){return t}}var Uvt=function(){};Uvt.thatReturns=jvt,Uvt.thatReturnsFalse=jvt(!1),Uvt.thatReturnsTrue=jvt(!0),Uvt.thatReturnsNull=jvt(null),Uvt.thatReturnsThis=function(){return this},Uvt.thatReturnsArgument=function(t){return t};var Gvt=Uvt,Hvt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(Wvt);function i(t){return t&&t.__esModule?t:{default:t}}i(Gvt);var r=n.default.isUnitlessNumber;e.default=function(t,e,n){return null==e||"boolean"==typeof e||""===e?"":isNaN(e)||0===e||r.hasOwnProperty(t)&&r[t]?""+e:("string"==typeof e&&(e=e.trim()),e+"px")}})),qvt=/([A-Z])/g;var Xvt=function(t){return t.replace(qvt,"-$1").toLowerCase()},Yvt=/^ms-/;var Kvt=function(t){return Xvt(t).replace(Yvt,"-ms-")};var Zvt=function(t){var e={};return function(n){return e.hasOwnProperty(n)||(e[n]=t.call(this,n)),e[n]}},Jvt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.processStyleName=void 0,e.createMarkupForStyles=function(t,e){var i="";for(var r in t){var o=0===r.indexOf("--");if(t.hasOwnProperty(r)&&"label"!==r){var s=t[r];null!=s&&(o?i+=r+":"+s+";":(i+=a(r)+":",i+=(0,n.default)(r,s,e)+";"))}}return i||null},o(Vvt);var n=o(Hvt),i=o(Kvt),r=o(Zvt);function o(t){return t&&t.__esModule?t:{default:t}}o(Gvt);var a=e.processStyleName=(0,r.default)(i.default)})),Qvt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t){if(function(t){return null==t||!1===t||"object"===(void 0===t?"undefined":n(t))&&0===Object.keys(t).length}(t))return null;if("object"!==(void 0===t?"undefined":n(t)))return t;for(var e={},i=Object.keys(t),o=!1,a=0;a<i.length;a++){var s=t[i[a]],l=r(s);null!==l&&l===s||(o=!0),null!==l&&(e[i[a]]=l)}return 0===Object.keys(e).length?null:o?e:t}function r(t){return Array.isArray(t)?(n=!1,o=[],(e=t).forEach((function(t){var e=r(t);null!==e&&e===t||(n=!0),null!==e&&o.push(e)})),0==o.length?null:n?o:e):i(t);var e,n,o}e.default=r})),txt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=["Webkit"],i=["Moz"],r=["ms"],o=["Webkit","Moz"],a=["Webkit","ms"],s=["Webkit","Moz","ms"];e.default={plugins:[],prefixMap:{appearance:o,userSelect:s,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:s,breakBefore:s,breakInside:s,columnCount:o,columnFill:o,columnGap:o,columnRule:o,columnRuleColor:o,columnRuleStyle:o,columnRuleWidth:o,columns:o,columnSpan:o,columnWidth:o,writingMode:a,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:a,scrollSnapPointsX:a,scrollSnapPointsY:a,scrollSnapDestination:a,scrollSnapCoordinate:a,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:s,flowInto:a,flowFrom:a,regionFragment:a,textAlignLast:i,tabSize:i,wrapFlow:r,wrapThrough:r,wrapMargin:r,gridTemplateColumns:r,gridTemplateRows:r,gridTemplateAreas:r,gridTemplate:r,gridAutoColumns:r,gridAutoRows:r,gridAutoFlow:r,grid:r,gridRowStart:r,gridColumnStart:r,gridRowEnd:r,gridRow:r,gridColumn:r,gridColumnEnd:r,gridColumnGap:r,gridRowGap:r,gridArea:r,gridGap:r,textSizeAdjust:a,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},t.exports=e.default})),ext=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.exports=e.default})),nxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){if(t.hasOwnProperty(e))for(var r=t[e],o=0,a=r.length;o<a;++o)n[r[o]+(0,i.default)(e)]=n[e]};var n,i=(n=ext)&&n.__esModule?n:{default:n};t.exports=e.default})),ixt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i,r){for(var o=0,a=t.length;o<a;++o){var s=t[o](e,n,i,r);if(s)return s}},t.exports=e.default})),rxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("cursor"===t&&i.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],i={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};t.exports=e.default})),oxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"string"==typeof t&&n.test(t)};var n=/-webkit-|-moz-|-ms-/;t.exports=e.default})),axt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("cross-fade(")>-1)return r.map((function(t){return e.replace(/cross-fade\(/g,t+"cross-fade(")}))};var n,i=(n=oxt)&&n.__esModule?n:{default:n};var r=["-webkit-",""];t.exports=e.default})),sxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("filter(")>-1)return r.map((function(t){return e.replace(/filter\(/g,t+"filter(")}))};var n,i=(n=oxt)&&n.__esModule?n:{default:n};var r=["-webkit-",""];t.exports=e.default})),lxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("display"===t&&n.hasOwnProperty(e))return n[e]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};t.exports=e.default})),uxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r){"flexDirection"===t&&"string"==typeof e&&(e.indexOf("column")>-1?r.WebkitBoxOrient="vertical":r.WebkitBoxOrient="horizontal",e.indexOf("reverse")>-1?r.WebkitBoxDirection="reverse":r.WebkitBoxDirection="normal");i.hasOwnProperty(t)&&(r[i[t]]=n[e]||e)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},i={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};t.exports=e.default})),cxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&o.test(e))return r.map((function(t){return t+e}))};var n,i=(n=oxt)&&n.__esModule?n:{default:n};var r=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;t.exports=e.default})),hxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("image-set(")>-1)return r.map((function(t){return e.replace(/image-set\(/g,t+"image-set(")}))};var n,i=(n=oxt)&&n.__esModule?n:{default:n};var r=["-webkit-",""];t.exports=e.default})),dxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("position"===t&&"sticky"===e)return["-webkit-sticky","sticky"]},t.exports=e.default})),pxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(i.hasOwnProperty(t)&&r.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],i={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},r={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};t.exports=e.default})),fxt=/[A-Z]/g,gxt=/^ms-/,mxt={};function yxt(t){return"-"+t.toLowerCase()}var vxt=Pa(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:function(t){if(mxt.hasOwnProperty(t))return mxt[t];var e=t.replace(fxt,yxt);return mxt[t]=gxt.test(e)?"-"+e:e}})),xxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,i.default)(t)};var n,i=(n=vxt)&&n.__esModule?n:{default:n};t.exports=e.default})),bxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,o,l){if("string"==typeof e&&a.hasOwnProperty(t)){var u=function(t,e){if((0,i.default)(t))return t;for(var r=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),o=0,a=r.length;o<a;++o){var l=r[o],u=[l];for(var c in e){var h=(0,n.default)(c);if(l.indexOf(h)>-1&&"order"!==h)for(var d=e[c],p=0,f=d.length;p<f;++p)u.unshift(l.replace(h,s[d[p]]+h))}r[o]=u.join(",")}return r.join(",")}(e,l),c=u.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-moz-|-ms-/.test(t)})).join(",");if(t.indexOf("Webkit")>-1)return c;var h=u.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-webkit-|-ms-/.test(t)})).join(",");return t.indexOf("Moz")>-1?h:(o["Webkit"+(0,r.default)(t)]=c,o["Moz"+(0,r.default)(t)]=h,u)}};var n=o(xxt),i=o(oxt),r=o(ext);function o(t){return t&&t.__esModule?t:{default:t}}var a={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},s={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};t.exports=e.default})),wxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e in t){var n=t[e],o=(0,r.default)(m,e,n,t,y);o&&(t[e]=o),(0,i.default)(y,e,t)}return t};var n=g(txt),i=g(nxt),r=g(ixt),o=g(rxt),a=g(axt),s=g(sxt),l=g(lxt),u=g(uxt),c=g(cxt),h=g(hxt),d=g(dxt),p=g(pxt),f=g(bxt);function g(t){return t&&t.__esModule?t:{default:t}}var m=[a.default,o.default,s.default,u.default,c.default,h.default,d.default,p.default,f.default,l.default],y=n.default.prefixMap})),_xt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};e.PluginSet=a,e.fallbacks=function(t){if(Object.keys(t.style).map((function(e){return Array.isArray(t.style[e])})).indexOf(!0)>=0){var e=t.style,n=Object.keys(e).reduce((function(t,n){return t[n]=Array.isArray(e[n])?e[n].join("; "+(0,Jvt.processStyleName)(n)+": "):e[n],t}),{});return(0,i.default)({},t,{style:n})}return t},e.contentWrap=function(t){if(t.style.content){var e=t.style.content;return s.indexOf(e)>=0||/^(attr|calc|counters?|url)\(/.test(e)?t:e.charAt(0)!==e.charAt(e.length-1)||'"'!==e.charAt(0)&&"'"!==e.charAt(0)?n({},t,{style:n({},t.style,{content:'"'+e+'"'})}):t}return t},e.prefixes=function(t){return(0,i.default)({},t,{style:(0,r.default)(n({},t.style))})};var i=o(Lvt),r=o(wxt);function o(t){return t&&t.__esModule?t:{default:t}}function a(t){this.fns=t||[]}(0,i.default)(a.prototype,{add:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach((function(e){t.fns.indexOf(e)>=0||(t.fns=[e].concat(t.fns))}))},remove:function(t){this.fns=this.fns.filter((function(e){return e!==t}))},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce((function(t,e){return e(t)}),t)}});var s=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]})),kxt=$a((function(t,e){function n(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)+(t.charCodeAt(e++)<<16)+(t.charCodeAt(e)<<24)}function i(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)}function r(t,e){return(65535&(t|=0))*(e|=0)+(((t>>>16)*e&65535)<<16)|0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var o=1540483477,a=e^t.length,s=t.length,l=0;for(;s>=4;){var u=n(t,l);u=r(u,o),u=r(u^=u>>>24,o),a=r(a,o),a^=u,l+=4,s-=4}switch(s){case 3:a^=i(t,l),a=r(a^=t.charCodeAt(l+2)<<16,o);break;case 2:a=r(a^=i(t,l),o);break;case 1:a=r(a^=t.charCodeAt(l),o)}return a=r(a^=a>>>13,o),(a^=a>>>15)>>>0}})),Sxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.compose=e.merge=e.$=e.style=e.presets=e.keyframes=e.fontFace=e.insertGlobal=e.insertRule=e.plugins=e.styleSheet=void 0,e.speedy=function(t){return s.speedy(t)},e.simulations=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h=!!t},e.simulate=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!(e=(0,i.default)(e)))return{};if(!h)return d||(console.warn("can't simulate without once calling simulations(true)"),d=!0),p||(console.warn("don't use simulation outside dev"),p=!0),{};return e.reduce((function(t,e){return t["data-simulate-"+g(e)]="",t}),{})},e.cssLabels=function(t){f=!!t},e.isLikeRule=y,e.idFor=v,e.css=B,e.rehydrate=function(t){(0,n.default)(C,t.reduce((function(t,e){return t[e]=!0,t}),{}))},e.flush=function(){C=s.inserted={},A=s.registered={},M={},s.flush(),s.inject()},e.select=W,e.parent=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return B(a({},t+" &",n))},e.media=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return B(a({},"@media "+t,n))},e.pseudo=j,e.active=function(t){return j(":active",t)},e.any=function(t){return j(":any",t)},e.checked=function(t){return j(":checked",t)},e.disabled=function(t){return j(":disabled",t)},e.empty=function(t){return j(":empty",t)},e.enabled=function(t){return j(":enabled",t)},e._default=function(t){return j(":default",t)},e.first=function(t){return j(":first",t)},e.firstChild=function(t){return j(":first-child",t)},e.firstOfType=function(t){return j(":first-of-type",t)},e.fullscreen=function(t){return j(":fullscreen",t)},e.focus=function(t){return j(":focus",t)},e.hover=function(t){return j(":hover",t)},e.indeterminate=function(t){return j(":indeterminate",t)},e.inRange=function(t){return j(":in-range",t)},e.invalid=function(t){return j(":invalid",t)},e.lastChild=function(t){return j(":last-child",t)},e.lastOfType=function(t){return j(":last-of-type",t)},e.left=function(t){return j(":left",t)},e.link=function(t){return j(":link",t)},e.onlyChild=function(t){return j(":only-child",t)},e.onlyOfType=function(t){return j(":only-of-type",t)},e.optional=function(t){return j(":optional",t)},e.outOfRange=function(t){return j(":out-of-range",t)},e.readOnly=function(t){return j(":read-only",t)},e.readWrite=function(t){return j(":read-write",t)},e.required=function(t){return j(":required",t)},e.right=function(t){return j(":right",t)},e.root=function(t){return j(":root",t)},e.scope=function(t){return j(":scope",t)},e.target=function(t){return j(":target",t)},e.valid=function(t){return j(":valid",t)},e.visited=function(t){return j(":visited",t)},e.dir=function(t,e){return j(":dir("+t+")",e)},e.lang=function(t,e){return j(":lang("+t+")",e)},e.not=function(t,e){var n=t.split(",").map((function(t){return t.trim()})).map((function(t){return":not("+t+")"}));if(1===n.length)return j(":not("+t+")",e);return W(n.join(""),e)},e.nthChild=function(t,e){return j(":nth-child("+t+")",e)},e.nthLastChild=function(t,e){return j(":nth-last-child("+t+")",e)},e.nthLastOfType=function(t,e){return j(":nth-last-of-type("+t+")",e)},e.nthOfType=function(t,e){return j(":nth-of-type("+t+")",e)},e.after=function(t){return j("::after",t)},e.before=function(t){return j("::before",t)},e.firstLetter=function(t){return j("::first-letter",t)},e.firstLine=function(t){return j("::first-line",t)},e.selection=function(t){return j("::selection",t)},e.backdrop=function(t){return j("::backdrop",t)},e.placeholder=function(t){return B({"::placeholder":t})},e.cssFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,i.default)(e))?e.map((function(t){var e={label:[]};return F(e,{src:t}),S(m(e),k(e)).join("")})).join(""):""},e.attribsFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(e=(0,i.default)(e))?e.map((function(t){v(t);var e=Object.keys(t)[0];return e+'="'+(t[e]||"")+'"'})).join(" "):"";return r};var n=o(Lvt),i=o(Qvt),r=o(kxt);function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=e.styleSheet=new $vt.StyleSheet;s.inject();var l=e.plugins=s.plugins=new _xt.PluginSet([_xt.prefixes,_xt.contentWrap,_xt.fallbacks]);l.media=new _xt.PluginSet,l.fontFace=new _xt.PluginSet,l.keyframes=new _xt.PluginSet([_xt.prefixes,_xt.fallbacks]);var u=!1,c="undefined"!=typeof window,h=u,d=!1,p=!1;var f=u;function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.toLowerCase().replace(/[^a-z0-9]/g,e)}function m(t){var e=JSON.stringify(t),n=(0,r.default)(e).toString(36);return t.label&&t.label.length,n}function y(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));return 1===e.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0])}function v(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));if(1!==e.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0]);if(!n)throw new Error("not a rule");return n[1]}var x=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function b(t){if(-1===t.indexOf(","))return[t];for(var e,n=[],i=[],r=0;e=x.exec(t);)switch(e[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;n.push(e.index)}for(e=n.length;e--;)i.unshift(t.slice(n[e]+1)),t=t.slice(0,n[e]);return i.unshift(t),i}function w(t,e){if(!t)return e.replace(/\&/g,"");if(!e)return".css-"+t+",[data-css-"+t+"]";var n=b(e).map((function(e){return e.indexOf("&")>=0?[e.replace(/\&/gm,".css-"+t),e.replace(/\&/gm,"[data-css-"+t+"]")].join(","):".css-"+t+e+",[data-css-"+t+"]"+e})).join(",");return h&&/^\&\:/.exec(e)&&!/\s/.exec(e)&&(n+=",.css-"+t+"[data-simulate-"+g(e)+"],[data-css-"+t+"][data-simulate-"+g(e)+"]"),n}function _(t){var e=t.selector,n=t.style,i=l.transform({selector:e,style:n});return i.selector+"{"+(0,Jvt.createMarkupForStyles)(i.style)+"}"}function k(t){var e=void 0,n=void 0,i=void 0,r=void 0;return Object.keys(t).forEach((function(o){o.indexOf("&")>=0?(n=n||{})[o]=t[o]:0===o.indexOf("@media")?(i=i||{})[o]=k(t[o]):0===o.indexOf("@supports")?(r=r||{})[o]=k(t[o]):"label"===o?t.label.length>0&&((e=e||{}).label=f?t.label.join("."):""):(e=e||{})[o]=t[o]})),{plain:e,selects:n,medias:i,supports:r}}function S(t,e){var n=[],i=e.plain,r=e.selects,o=e.medias,a=e.supports;return i&&n.push(_({style:i,selector:w(t)})),r&&Object.keys(r).forEach((function(e){return n.push(_({style:r[e],selector:w(t,e)}))})),o&&Object.keys(o).forEach((function(e){return n.push(e+"{"+S(t,o[e]).join("")+"}")})),a&&Object.keys(a).forEach((function(e){return n.push(e+"{"+S(t,a[e]).join("")+"}")})),n}var C=s.inserted={};var A=s.registered={};function I(t){A[t.id]||(A[t.id]=t)}var M={};function D(t){if(I(t),function(t){if(!C[t.id]){C[t.id]=!0;var e=k(t.style),n=S(t.id,e);C[t.id]=!!c||n,n.forEach((function(t){return s.insert(t)}))}}(t),M[t.id])return M[t.id];var e=a({},"data-css-"+t.id,f&&t.label||"");return Object.defineProperty(e,"toString",{enumerable:!1,value:function(){return"css-"+t.id}}),M[t.id]=e,e}function T(t,e){var n=b(t).map((function(t){return t.indexOf("&")>=0?t:"&"+t}));return b(e).map((function(t){return t.indexOf("&")>=0?t:"&"+t})).reduce((function(t,e){return t.concat(n.map((function(t){return e.replace(/\&/g,t)})))}),[]).join(",")}function E(t,e){return t?"@supports "+t.substring(9)+" and "+e.substring(9):e}function N(t){for(var e=[],n=0;n<t.length;n++)e=Array.isArray(t[n])?e.concat(N(t[n])):e.concat(t[n]);return e}var O={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function F(t,e){var n=e.selector,r=void 0===n?"":n,o=e.mq,a=void 0===o?"":o,s=e.supp,l=void 0===s?"":s,u=e.src,c=void 0===u?{}:u;Array.isArray(c)||(c=[c]),(c=N(c)).forEach((function(e){if(y(e)){var n=function(t){if(y(t)){var e=A[v(t)];if(null==e)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return e}return t}(e);if("css"!==n.type)throw new Error("cannot merge this rule");e=n.style}(e=(0,i.default)(e))&&e.composes&&F(t,{selector:r,mq:a,supp:l,src:e.composes}),Object.keys(e||{}).forEach((function(n){if(function(t){for(var e=[":",".","[",">"," "],n=!1,i=t.charAt(0),r=0;r<e.length;r++)if(i===e[r]){n=!0;break}return n||t.indexOf("&")>=0}(n))O[n]&&O[n].forEach((function(i){return F(t,{selector:T(r,i),mq:a,supp:l,src:e[n]})})),F(t,{selector:T(r,n),mq:a,supp:l,src:e[n]});else if(function(t){return 0===t.indexOf("@media")}(n))F(t,{selector:r,mq:(o=a,s=n,o?"@media "+o.substring(6)+" and "+s.substring(6):s),supp:l,src:e[n]});else if(function(t){return 0===t.indexOf("@supports")}(n))F(t,{selector:r,mq:a,supp:E(l,n),src:e[n]});else if("composes"===n);else{var i=t;l&&(i[l]=i[l]||{},i=i[l]),a&&(i[a]=i[a]||{},i=i[a]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?f&&(t.label=t.label.concat(e.label)):i[n]=e[n]}var o,s}))}))}function R(t){var e={label:[]};return F(e,{src:t}),D({id:m(e),style:e,label:f?e.label.join("."):"",type:"css"})}var L={};Object.defineProperty(L,"toString",{enumerable:!1,value:function(){return"css-nil"}});var $="undefined"!=typeof WeakMap?[L,new WeakMap,new WeakMap,new WeakMap]:[L];var P,z="undefined"!=typeof WeakMap?(P=R,function(t){if($[t.length]){for(var e=$[t.length],n=0;n<t.length-1;)e.has(t[n])||e.set(t[n],new WeakMap),e=e.get(t[n]),n++;if(e.has(t[t.length-1])){var i=e.get(t[n]);if(A[i.toString().substring(4)])return i}}var r=P(t);if($[t.length]){for(var o=0,a=$[t.length];o<t.length-1;)a=a.get(t[o]),o++;try{a.set(t[o],r)}catch(t){}}return r}):R;function B(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]&&e[0].length&&e[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(e=(0,i.default)(e))?z(e):L}B.insert=function(t){var e={id:m(t),css:t,type:"raw"};I(e),C[e.id]||(s.insert(e.css),C[e.id]=!!c||[e.css])},e.insertRule=B.insert,B.global=function(t,e){if(e=(0,i.default)(e))return B.insert(_({selector:t,style:e}))},e.insertGlobal=B.global,B.keyframes=function(t,e){e||(e=t,t="animation");var n={id:m({name:t,kfs:e=(0,i.default)(e)||{}}),type:"keyframes",name:t,keyframes:e};return I(n),function(t){if(!C[t.id]){var e=Object.keys(t.keyframes).map((function(e){var n=l.keyframes.transform({id:t.id,name:e,style:t.keyframes[e]});return n.name+"{"+(0,Jvt.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+t.name+"_"+t.id+"{"+e+"}"}));n.forEach((function(t){return s.insert(t)})),C[t.id]=!!c||n}}(n),t+"_"+n.id},B.fontFace=function(t){var e={id:m(t=(0,i.default)(t)),type:"font-face",font:t};return I(e),function(t){if(!C[t.id]){var e="@font-face{"+(0,Jvt.createMarkupForStyles)(t.font)+"}";s.insert(e),C[t.id]=!!c||[e]}}(e),t.fontFamily},e.fontFace=B.fontFace,e.keyframes=B.keyframes,e.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var V=e.style=B;function W(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t?B(a({},t,n)):V(n)}function j(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return B(a({},t,n))}e.$=W,e.merge=B,e.compose=B})),Cxt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isSurfaceInfo=function(t){return null!=t.name},e.isSurface=function(t){return t.drawArea instanceof HTMLElement}}));function Axt(){}var Ixt={},Mxt=[],Dxt=[];function Txt(t,e){var n,i,r,o,a=Dxt;for(o=arguments.length;o-- >2;)Mxt.push(arguments[o]);for(e&&null!=e.children&&(Mxt.length||Mxt.push(e.children),delete e.children);Mxt.length;)if((i=Mxt.pop())&&void 0!==i.pop)for(o=i.length;o--;)Mxt.push(i[o]);else"boolean"==typeof i&&(i=null),(r="function"!=typeof t)&&(null==i?i="":"number"==typeof i?i=String(i):"string"!=typeof i&&(r=!1)),r&&n?a[a.length-1]+=i:a===Dxt?a=[i]:a.push(i),n=r;var s=new Axt;return s.nodeName=t,s.children=a,s.attributes=null==e?void 0:e,s.key=null==e?void 0:e.key,void 0!==Ixt.vnode&&Ixt.vnode(s),s}function Ext(t,e){for(var n in e)t[n]=e[n];return t}var Nxt="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function Oxt(t,e){return Txt(t.nodeName,Ext(Ext({},t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}var Fxt=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,Rxt=[];function Lxt(t){!t._dirty&&(t._dirty=!0)&&1==Rxt.push(t)&&(Ixt.debounceRendering||Nxt)($xt)}function $xt(){var t,e=Rxt;for(Rxt=[];t=e.pop();)t._dirty&&ibt(t)}function Pxt(t,e,n){return"string"==typeof e||"number"==typeof e?void 0!==t.splitText:"string"==typeof e.nodeName?!t._componentConstructor&&zxt(t,e.nodeName):n||t._componentConstructor===e.nodeName}function zxt(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function Bxt(t){var e=Ext({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var i in n)void 0===e[i]&&(e[i]=n[i]);return e}function Vxt(t){var e=t.parentNode;e&&e.removeChild(t)}function Wxt(t,e,n,i,r){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)n&&n(null),i&&i(t);else if("class"!==e||r)if("style"===e){if(i&&"string"!=typeof i&&"string"!=typeof n||(t.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof n)for(var o in n)o in i||(t.style[o]="");for(var o in i)t.style[o]="number"==typeof i[o]&&!1===Fxt.test(o)?i[o]+"px":i[o]}}else if("dangerouslySetInnerHTML"===e)i&&(t.innerHTML=i.__html||"");else if("o"==e[0]&&"n"==e[1]){var a=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),i?n||t.addEventListener(e,jxt,a):t.removeEventListener(e,jxt,a),(t._listeners||(t._listeners={}))[e]=i}else if("list"!==e&&"type"!==e&&!r&&e in t)!function(t,e,n){try{t[e]=n}catch(t){}}(t,e,null==i?"":i),null!=i&&!1!==i||t.removeAttribute(e);else{var s=r&&e!==(e=e.replace(/^xlink:?/,""));null==i||!1===i?s?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof i&&(s?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),i):t.setAttribute(e,i))}else t.className=i||""}function jxt(t){return this._listeners[t.type](Ixt.event&&Ixt.event(t)||t)}var Uxt=[],Gxt=0,Hxt=!1,qxt=!1;function Xxt(){for(var t;t=Uxt.pop();)Ixt.afterMount&&Ixt.afterMount(t),t.componentDidMount&&t.componentDidMount()}function Yxt(t,e,n,i,r,o){Gxt++||(Hxt=null!=r&&void 0!==r.ownerSVGElement,qxt=null!=t&&!("__preactattr_"in t));var a=Kxt(t,e,n,i,o);return r&&a.parentNode!==r&&r.appendChild(a),--Gxt||(qxt=!1,o||Xxt()),a}function Kxt(t,e,n,i,r){var o=t,a=Hxt;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||r)?t.nodeValue!=e&&(t.nodeValue=e):(o=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(o,t),Zxt(t,!0))),o.__preactattr_=!0,o;var s,l,u=e.nodeName;if("function"==typeof u)return function(t,e,n,i){var r=t&&t._component,o=r,a=t,s=r&&t._componentConstructor===e.nodeName,l=s,u=Bxt(e);for(;r&&!l&&(r=r._parentComponent);)l=r.constructor===e.nodeName;r&&l&&(!i||r._component)?(nbt(r,u,3,n,i),t=r.base):(o&&!s&&(rbt(o),t=a=null),r=tbt(e.nodeName,u,n),t&&!r.nextBase&&(r.nextBase=t,a=null),nbt(r,u,1,n,i),t=r.base,a&&t!==a&&(a._component=null,Zxt(a,!1)));return t}(t,e,n,i);if(Hxt="svg"===u||"foreignObject"!==u&&Hxt,u=String(u),(!t||!zxt(t,u))&&(s=u,(l=Hxt?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)).normalizedNodeName=s,o=l,t)){for(;t.firstChild;)o.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(o,t),Zxt(t,!0)}var c=o.firstChild,h=o.__preactattr_,d=e.children;if(null==h){h=o.__preactattr_={};for(var p=o.attributes,f=p.length;f--;)h[p[f].name]=p[f].value}return!qxt&&d&&1===d.length&&"string"==typeof d[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=d[0]&&(c.nodeValue=d[0]):(d&&d.length||null!=c)&&function(t,e,n,i,r){var o,a,s,l,u,c=t.childNodes,h=[],d={},p=0,f=0,g=c.length,m=0,y=e?e.length:0;if(0!==g)for(var v=0;v<g;v++){var x=c[v],b=x.__preactattr_;null!=(w=y&&b?x._component?x._component.__key:b.key:null)?(p++,d[w]=x):(b||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(h[m++]=x)}if(0!==y)for(v=0;v<y;v++){var w;if(u=null,null!=(w=(l=e[v]).key))p&&void 0!==d[w]&&(u=d[w],d[w]=void 0,p--);else if(!u&&f<m)for(o=f;o<m;o++)if(void 0!==h[o]&&Pxt(a=h[o],l,r)){u=a,h[o]=void 0,o===m-1&&m--,o===f&&f++;break}u=Kxt(u,l,n,i),s=c[v],u&&u!==t&&u!==s&&(null==s?t.appendChild(u):u===s.nextSibling?Vxt(s):t.insertBefore(u,s))}if(p)for(var v in d)void 0!==d[v]&&Zxt(d[v],!1);for(;f<=m;)void 0!==(u=h[m--])&&Zxt(u,!1)}(o,d,n,i,qxt||null!=h.dangerouslySetInnerHTML),function(t,e,n){var i;for(i in n)e&&null!=e[i]||null==n[i]||Wxt(t,i,n[i],n[i]=void 0,Hxt);for(i in e)"children"===i||"innerHTML"===i||i in n&&e[i]===("value"===i||"checked"===i?t[i]:n[i])||Wxt(t,i,n[i],n[i]=e[i],Hxt)}(o,e.attributes,h),Hxt=a,o}function Zxt(t,e){var n=t._component;n?rbt(n):(null!=t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),!1!==e&&null!=t.__preactattr_||Vxt(t),Jxt(t))}function Jxt(t){for(t=t.lastChild;t;){var e=t.previousSibling;Zxt(t,!0),t=e}}var Qxt={};function tbt(t,e,n){var i,r=Qxt[t.name];if(t.prototype&&t.prototype.render?(i=new t(e,n),obt.call(i,e,n)):((i=new obt(e,n)).constructor=t,i.render=ebt),r)for(var o=r.length;o--;)if(r[o].constructor===t){i.nextBase=r[o].nextBase,r.splice(o,1);break}return i}function ebt(t,e,n){return this.constructor(t,n)}function nbt(t,e,n,i,r){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||r?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,i),i&&i!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=i),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===Ixt.syncComponentUpdates&&t.base?Lxt(t):ibt(t,1,r)),t.__ref&&t.__ref(t))}function ibt(t,e,n,i){if(!t._disable){var r,o,a,s=t.props,l=t.state,u=t.context,c=t.prevProps||s,h=t.prevState||l,d=t.prevContext||u,p=t.base,f=t.nextBase,g=p||f,m=t._component,y=!1;if(p&&(t.props=c,t.state=h,t.context=d,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(s,l,u)?y=!0:t.componentWillUpdate&&t.componentWillUpdate(s,l,u),t.props=s,t.state=l,t.context=u),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!y){r=t.render(s,l,u),t.getChildContext&&(u=Ext(Ext({},u),t.getChildContext()));var v,x,b=r&&r.nodeName;if("function"==typeof b){var w=Bxt(r);(o=m)&&o.constructor===b&&w.key==o.__key?nbt(o,w,1,u,!1):(v=o,t._component=o=tbt(b,w,u),o.nextBase=o.nextBase||f,o._parentComponent=t,nbt(o,w,0,u,!1),ibt(o,1,n,!0)),x=o.base}else a=g,(v=m)&&(a=t._component=null),(g||1===e)&&(a&&(a._component=null),x=Yxt(a,r,u,n||!p,g&&g.parentNode,!0));if(g&&x!==g&&o!==m){var _=g.parentNode;_&&x!==_&&(_.replaceChild(x,g),v||(g._component=null,Zxt(g,!1)))}if(v&&rbt(v),t.base=x,x&&!i){for(var k=t,S=t;S=S._parentComponent;)(k=S).base=x;x._component=k,x._componentConstructor=k.constructor}}if(!p||n?Uxt.unshift(t):y||(t.componentDidUpdate&&t.componentDidUpdate(c,h,d),Ixt.afterUpdate&&Ixt.afterUpdate(t)),null!=t._renderCallbacks)for(;t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);Gxt||i||Xxt()}}function rbt(t){Ixt.beforeUnmount&&Ixt.beforeUnmount(t);var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?rbt(n):e&&(e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t.nextBase=e,Vxt(e),function(t){var e=t.constructor.name;(Qxt[e]||(Qxt[e]=[])).push(t)}(t),Jxt(e)),t.__ref&&t.__ref(null)}function obt(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{}}function abt(t,e,n){return Yxt(n,t,{},!1,e,!1)}Ext(obt.prototype,{setState:function(t,e){var n=this.state;this.prevState||(this.prevState=Ext({},n)),Ext(n,"function"==typeof t?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),Lxt(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),ibt(this,2)},render:function(){}});var sbt={h:Txt,createElement:Txt,cloneElement:Oxt,Component:obt,render:abt,rerender:$xt,options:Ixt},lbt=Pa(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:sbt,h:Txt,createElement:Txt,cloneElement:Oxt,Component:obt,render:abt,rerender:$xt,options:Ixt})),ubt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0});class n extends lbt.Component{componentDidMount(){const{name:t,tab:e}=this.props;this.props.registerSurface(t,e,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:e,styles:i}=this.props,r=Object.assign({},n.defaultStyles,i),{width:o,height:a}=r;let{maxHeight:s,maxWidth:l}=r;s=a===n.defaultStyles.height?s:a,l=o===n.defaultStyles.width?l:o;const u=Sxt.css({display:e?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:a,width:o,maxHeight:s,maxWidth:l,overflow:"auto"}),c=Sxt.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),h=Sxt.css({boxSizing:"border-box"});return lbt.h("div",{className:`${u} tf-surface`,ref:t=>this.container=t,"data-visible":e},lbt.h("div",{className:`${c} tf-label`,ref:t=>this.label=t},t),lbt.h("div",{className:`${h} tf-draw-area`,ref:t=>this.drawArea=t}))}}n.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},e.SurfaceComponent=n})),cbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0});class n extends lbt.Component{render(){const{tabNames:t,activeTab:e,handleClick:n}=this.props,r=t.length>0?t.map((t=>lbt.h(i,{key:t,id:t,handleClick:n,isActive:t===e},t))):null,o=Sxt.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return lbt.h("div",{className:`${o} visor-tabs`},r)}}e.Tabs=n;class i extends lbt.Component{render(){const{children:t,isActive:e,handleClick:n,id:i}=this.props,r=Sxt.css({borderBottomColor:e?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return lbt.h("a",{className:`${r} tf-tab`,"data-isactive":e,onClick:()=>n(i)},t)}}})),hbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0});class n extends lbt.Component{static render(t,e,i){return lbt.render(lbt.h(n,Object.assign({},i)),t,e)}constructor(t){super(t),this.surfaces=new Map;const e=null==t.startOpen||t.startOpen;this.state={isOpen:e,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,e){const n=this.surfaceId(t,e);let i;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return i=this.surfaces.get(n),{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,e){return t+e}setTabs(t){const e=t.map((t=>t.tab)),n=this.state.tabs;let i;for(const t of e)n.has(t)||(n.add(t),i=t);null!=i&&this.setState({tabs:n,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(t,e,n){const i=this.surfaceId(t,e);this.surfaces.set(i,n)}keyHandler(t){192===t.keyCode&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:e,activeTab:n}=this.state,{surfaceList:r}=this.props,o=Array.from(this.getTabs().values()),a=e?"90vw":"550px",s=Sxt.css({width:a,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),l=Sxt.css({right:"0"}),u=Sxt.css({right:`calc(-${a} - 10px)`}),c=t?l:u,h=Sxt.css({});return lbt.h("div",{className:`${s} ${c} visor`,"data-isopen":t,"data-isfullscreen":e},lbt.h(i,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:e}),lbt.h(cbt.Tabs,{tabNames:o,activeTab:n,handleClick:this.setActiveTab.bind(this)}),lbt.h("div",{className:`${h} visor-surfaces`},r.map((t=>lbt.h(ubt.SurfaceComponent,{key:t.name+t.tab,name:t.name,tab:t.tab,styles:t.styles,registerSurface:this.registerSurface.bind(this),visible:n===t.tab})))))}}function i(t){const{isFullScreen:e,fullScreenHandler:n,closeHandler:i}=t,r=Sxt.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),o=Sxt.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),a=Sxt.css({marginLeft:"auto"});return lbt.h("div",{className:`${r} visor-controls`},lbt.h("button",{className:`${o}`,onClick:n},e?"Minimize":"Maximize"),lbt.h("button",{className:`${o} ${a}`,onClick:i},"Hide"))}e.VisorComponent=n})),dbt=$a((function(t,e){let n;
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0});const i="tfjs-visor-container";e.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(i)&&null!=n)return n;let t,e=document.getElementById(i);function o(e,n){let i=null;return t=hbt.VisorComponent.render(e,t,{ref:t=>i=t,surfaceList:Array.from(n.values())}),i}null==e&&(e=document.createElement("div"),e.id=i,document.body.appendChild(e));const a=new Map,s=o(e,a);return n=new r(s,e,a,o),n};class r{constructor(t,e,n,i){this.visorComponent=t,this.el=e,this.surfaceList=n,this.renderVisor=i}surface(t){const{name:e}=t,n=null==t.tab?"Visor":t.tab;if(null==e||!("string"==typeof e||e instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},t,{tab:n}),r=`${e}-${n}`;return this.surfaceList.has(r)||this.surfaceList.set(r,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(e,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}e.Visor=r})),pbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getDrawArea=function(t){if(t instanceof HTMLElement)return t;if(Cxt.isSurface(t))return t.drawArea;if(Cxt.isSurfaceInfo(t)){return dbt.visor().surface({name:t.name,tab:t.tab,styles:t.styles}).drawArea}throw new Error("Not a drawable")},e.shallowEquals=function(t,e){const n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(t[r]!==e[r])return!1}return!0},e.nextFrame=function(){return n(this,void 0,void 0,(function*(){yield new Promise((t=>requestAnimationFrame(t)))}))}})),fbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0});const n={prepend:!1};e.subSurface=function(t,e,i={}){const r=pbt.getDrawArea(t),o=Sxt.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),a=Sxt.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),s=Object.assign({},n,i);let l=r.querySelector(`div[data-name=${e}]`);if(!l){if(l=document.createElement("div"),l.setAttribute("class",`${o}`),l.dataset.name=e,s.title){const t=document.createElement("div");t.setAttribute("class",`subsurface-title ${a}`),t.innerText=s.title,l.appendChild(t)}s.prepend?r.insertBefore(l,r.firstChild):r.appendChild(l)}return l},e.getDefaultWidth=function(t){let e=0,n=t;for(;n&&0===n.clientWidth;)n=n.parentElement,e=50;return n.clientWidth-e},e.getDefaultHeight=function(t){return 0===t.clientHeight?200:t.clientHeight}})),gbt=Pa(Evt),mbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(gbt);e.barchart=function(t,e,i={}){return n(this,void 0,void 0,(function*(){const n=pbt.getDrawArea(t),s=e,l=Object.assign({},o,i);if(a.has(n)){const t=a.get(n);if(pbt.shallowEquals(l,t.lastOptions)){yield pbt.nextFrame();const e=t.view,n=e.changeset().remove((()=>!0)).insert(s);return void(yield e.change("values",n).runAsync())}}const{xLabel:u,yLabel:c,xType:h,yType:d}=l;let p=null;null!=u&&(p={title:u});let f=null;null!=c&&(f={title:c});let g;g=null!=l.color?Array.isArray(l.color)?{field:"index",type:"nominal",scale:{range:l.color}}:{value:l.color}:{value:"#4C78A0"};const m={width:l.width||fbt.getDefaultWidth(n),height:l.height||fbt.getDefaultHeight(n),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:l.fontSize,titleFontSize:l.fontSize},text:{fontSize:l.fontSize},legend:{labelFontSize:l.fontSize,titleFontSize:l.fontSize}},data:{values:s,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:h,axis:p},y:{field:"value",type:d,axis:f},color:g}};yield pbt.nextFrame();const y=yield r.default(n,m,{actions:!1,mode:"vega-lite",defaultStyle:!1});a.set(n,{view:y.view,lastOptions:l})}))};const o={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},a=new Map})),ybt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(gbt);e.confusionMatrix=function(t,e,i={}){return n(this,void 0,void 0,(function*(){const n=Object.assign({},o,i),a=pbt.getDrawArea(t),s=[],l=e.values,u=e.tickLabels||[],c=0===u.length;let h=!0;for(let t=0;t<l.length;t++){const e=c?`Class ${t}`:u[t];c&&u.push(e);for(let i=0;i<l[t].length;i++){const r=c?`Class ${i}`:u[i],o=l[t][i];t!==i||n.shadeDiagonal?(s.push({label:e,prediction:r,count:o,scaleCount:o}),0!==o&&(h=!1)):s.push({label:e,prediction:r,count:o,noFill:!0})}}if(!n.shadeDiagonal&&h)for(const t of s)!0===t.noFill&&(t.noFill=!1,t.scaleCount=t.count);const d={width:n.width||fbt.getDefaultWidth(a),height:n.height||fbt.getDefaultHeight(a),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:n.fontSize,titleFontSize:n.fontSize},text:{fontSize:n.fontSize},legend:{labelFontSize:n.fontSize,titleFontSize:n.fontSize}},data:{values:s},encoding:{x:{field:"prediction",type:"ordinal",title:n.xLabel||"prediction",scale:{domain:u}},y:{field:"label",type:"ordinal",title:n.yLabel||"label",scale:{domain:u}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:n.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===n.shadeDiagonal&&d.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),n.showTextOverlay&&d.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const p="string"==typeof n.colorMap?{scheme:n.colorMap}:n.colorMap;d.layer[0].encoding.color.scale.range=p,yield r.default(a,d,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const o={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}})),vbt=$a((function(t,e){
/*
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
function n(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function i(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=n,e.assertShapesMatch=function(t,e,r=""){n(i(t,e),r+` Shapes ${t} and ${e} must match`)},e.arraysEqual=i,e.DECIMAL_PLACES_TO_CHECK=4})),xbt=Pa(uc),bbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},r=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(xbt),a=r(gbt);function s(t,e,n){const i=t instanceof o.Tensor?t.shape:[t.length,t[0].length];0===n?vbt.assert(i[0]===e.length,`Length of xTickLabels (${e.length}) must match number of rows (${i[0]})`):1===n&&vbt.assert(i[1]===e.length,`Length of yTickLabels (${e.length}) must match number of columns (${i[1]})`)}e.heatmap=function(t,e,i={}){return n(this,void 0,void 0,(function*(){const r=Object.assign({},l,i),u=pbt.getDrawArea(t);let c=e.values;r.rowMajor&&(c=yield function(t){return n(this,void 0,void 0,(function*(){let e,n;t instanceof o.Tensor?(e=t.shape,n=t.transpose()):(e=[t.length,t[0].length],n=o.tidy((()=>o.tensor2d(t).transpose()))),vbt.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const i=yield n.array();n.dispose();const r=[i.length,i[0].length];return vbt.assert(e[0]===r[1]&&e[1]===r[0],`Unexpected transposed shape. Original ${e} : Transposed ${r}`),i}))}(e.values));const{xTickLabels:h,yTickLabels:d}=e;if(null!=h){s(c,h,0)}if(null!=d){s(c,d,1)}const p=[];if(c instanceof o.Tensor){vbt.assert(2===c.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const t=yield c.data(),[e,n]=c.shape;for(let i=0;i<e;i++){const e=h?`${h[i]}@tfidx@${i}`:i;for(let r=0;r<n;r++){const o=d?`${d[r]}@tfidx@${r}`:r,a=t[i*n+r];p.push({x:e,y:o,value:a})}}}else{const t=c;for(let e=0;e<t.length;e++){const n=h?`${h[e]}@tfidx@${e}`:e;for(let i=0;i<t[e].length;i++){const r=d?`${d[i]}@tfidx@${i}`:i,o=t[e][i];p.push({x:n,y:r,value:o})}}}const f={actions:!1,mode:"vega-lite",defaultStyle:!1},g={width:r.width||fbt.getDefaultWidth(u),height:r.height||fbt.getDefaultHeight(u),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:p},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},m="@tfidx@\\d+$",y=new RegExp(m);let v;switch(h&&(g.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),d&&(g.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(h||d)&&(f.tooltip={sanitize:t=>String(t).replace(y,"")}),r.colorMap){case"blues":v=["#f7fbff","#4292c6"];break;case"greyscale":v=["#000000","#ffffff"];break;case"viridis":default:v="viridis"}if("viridis"!==v){g.encoding.fill.scale={range:v}}if(r.domain){const t=g.encoding.fill;null!=t.scale?t.scale=Object.assign({},t.scale,{domain:r.domain}):t.scale={domain:r.domain}}yield a.default(u,g,f)}))};const l={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}})),wbt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.arrayStats=function(t){if(!Array.isArray(t))throw new Error("input must be an array");if(0===t.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const e=t.length;let n=-1/0,i=1/0,r=0,o=0,a=0;for(let s=0;s<e;s++){const e=t[s];e>n&&(n=e),e<i&&(i=e),0===e&&(r+=1),isNaN(e)?o+=1:isFinite(e)||(a+=1)}const s={numVals:e,numZeros:r,numNans:o,max:n,min:i,numInfs:a};return s.max===-1/0&&(s.max=NaN),s.min===1/0&&(s.min=NaN),s},e.tensorStats=function(t){return n(this,void 0,void 0,(function*(){const[e,n,i]=xbt.tidy((()=>{const e=xbt.scalar(0,t.dtype);return[t.min(),t.max(),t.equal(e).sum()]}));return Promise.all([t.data(),e.data(),n.data(),i.data()]).then((([t,e,n,i])=>{const r=t.length;let o=0,a=0;for(let e=0;e<r;e++){const n=t[e];isNaN(n)?o+=1:isFinite(n)||(a+=1)}let s=e[0],l=n[0];o===r&&(s=NaN,l=NaN);return{numVals:r,numZeros:i[0],numNans:o,min:s,max:l,numInfs:a}}))}))},e.confusionMatrix=function(t,e,i,r){return n(this,void 0,void 0,(function*(){vbt.assert(1===t.rank,"labels must be a 1D tensor"),vbt.assert(1===e.rank,"predictions must be a 1D tensor"),vbt.assert(t.size===e.size,"labels and predictions must be the same length"),null!=r&&vbt.assert(r.size===e.size,"labels and predictions must be the same length");const n=t.cast("int32"),o=e.cast("int32");null==i&&(i=xbt.tidy((()=>xbt.maximum(n.max(),o.max()).cast("int32").dataSync()[0]+1)));let a=Promise.resolve(null);return null!=r&&(a=r.data()),Promise.all([n.data(),o.data(),a]).then((([t,e,n])=>{const r=Array(i).fill(0);for(let t=0;t<i;t++)r[t]=Array(i).fill(0);for(let i=0;i<t.length;i++){const o=t[i],a=e[i];r[o][a]+=null!=n?n[i]:1}return r}))}))},e.accuracy=function(t,e){return n(this,void 0,void 0,(function*(){vbt.assertShapesMatch(t.shape,e.shape,"Error computing accuracy.");const n=t.equal(e),i=n.mean(),r=(yield i.data())[0];return xbt.dispose([n,i]),r}))},e.perClassAccuracy=function(t,e,i){return n(this,void 0,void 0,(function*(){return vbt.assert(1===t.rank,"labels must be a 1D tensor"),vbt.assert(1===e.rank,"predictions must be a 1D tensor"),vbt.assert(t.size===e.size,"labels and predictions must be the same length"),null==i&&(i=xbt.tidy((()=>xbt.maximum(t.max(),e.max()).dataSync()[0]+1))),Promise.all([t.data(),e.data()]).then((([t,e])=>{const n=Array(i).fill(0),r=Array(i).fill(0);for(let i=0;i<t.length;i++){const o=t[i],a=e[i];n[o]+=1,o===a&&(r[o]+=1)}const o=[];for(let t=0;t<n.length;t++)o.push({count:n[t],accuracy:0===n[t]?0:r[t]/n[t]});return o}))}))}})),_bt="http://www.w3.org/1999/xhtml",kbt={svg:"http://www.w3.org/2000/svg",xhtml:_bt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Sbt(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),kbt.hasOwnProperty(e)?{space:kbt[e],local:t}:t}function Cbt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===_bt&&e.documentElement.namespaceURI===_bt?e.createElement(t):e.createElementNS(n,t)}}function Abt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ibt(t){var e=Sbt(t);return(e.local?Abt:Cbt)(e)}function Mbt(){}function Dbt(t){return null==t?Mbt:function(){return this.querySelector(t)}}function Tbt(){return[]}function Ebt(t){return null==t?Tbt:function(){return this.querySelectorAll(t)}}var Nbt=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var Obt=document.documentElement;if(!Obt.matches){var Fbt=Obt.webkitMatchesSelector||Obt.msMatchesSelector||Obt.mozMatchesSelector||Obt.oMatchesSelector;Nbt=function(t){return function(){return Fbt.call(this,t)}}}}var Rbt=Nbt;function Lbt(t){return new Array(t.length)}function $bt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}$bt.prototype={constructor:$bt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Pbt(t,e,n,i,r,o){for(var a,s=0,l=e.length,u=o.length;s<u;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new $bt(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function zbt(t,e,n,i,r,o,a){var s,l,u,c={},h=e.length,d=o.length,p=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(p[s]=u="$"+a.call(l,l.__data__,s,e),u in c?r[s]=l:c[u]=l);for(s=0;s<d;++s)(l=c[u="$"+a.call(t,o[s],s,o)])?(i[s]=l,l.__data__=o[s],c[u]=null):n[s]=new $bt(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&c[p[s]]===l&&(r[s]=l)}function Bbt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Vbt(t){return function(){this.removeAttribute(t)}}function Wbt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jbt(t,e){return function(){this.setAttribute(t,e)}}function Ubt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Gbt(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Hbt(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function qbt(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Xbt(t){return function(){this.style.removeProperty(t)}}function Ybt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Kbt(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Zbt(t,e){return t.style.getPropertyValue(e)||qbt(t).getComputedStyle(t,null).getPropertyValue(e)}function Jbt(t){return function(){delete this[t]}}function Qbt(t,e){return function(){this[t]=e}}function twt(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function ewt(t){return t.trim().split(/^|\s+/)}function nwt(t){return t.classList||new iwt(t)}function iwt(t){this._node=t,this._names=ewt(t.getAttribute("class")||"")}function rwt(t,e){for(var n=nwt(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function owt(t,e){for(var n=nwt(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function awt(t){return function(){rwt(this,t)}}function swt(t){return function(){owt(this,t)}}function lwt(t,e){return function(){(e.apply(this,arguments)?rwt:owt)(this,t)}}function uwt(){this.textContent=""}function cwt(t){return function(){this.textContent=t}}function hwt(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function dwt(){this.innerHTML=""}function pwt(t){return function(){this.innerHTML=t}}function fwt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function gwt(){this.nextSibling&&this.parentNode.appendChild(this)}function mwt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ywt(){return null}function vwt(){var t=this.parentNode;t&&t.removeChild(this)}function xwt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function bwt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}iwt.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var wwt={},_wt=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(wwt={mouseenter:"mouseover",mouseleave:"mouseout"}));function kwt(t,e,n){return t=Swt(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function Swt(t,e,n){return function(i){var r=_wt;_wt=i;try{t.call(this,this.__data__,e,n)}finally{_wt=r}}}function Cwt(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Awt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?e.length=r:delete this.__on}}}function Iwt(t,e,n){var i=wwt.hasOwnProperty(t.type)?kwt:Swt;return function(r,o,a){var s,l=this.__on,u=i(e,o,a);if(l)for(var c=0,h=l.length;c<h;++c)if((s=l[c]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=n),void(s.value=e);this.addEventListener(t.type,u,n),s={type:t.type,name:t.name,value:e,listener:u,capture:n},l?l.push(s):this.__on=[s]}}function Mwt(t,e,n){var i=qbt(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Dwt(t,e){return function(){return Mwt(this,t,e)}}function Twt(t,e){return function(){return Mwt(this,t,e.apply(this,arguments))}}var Ewt=[null];function Nwt(t,e){this._groups=t,this._parents=e}function Owt(){return new Nwt([[document.documentElement]],Ewt)}function Fwt(t){return"string"==typeof t?new Nwt([[document.querySelector(t)]],[document.documentElement]):new Nwt([[t]],Ewt)}Nwt.prototype=Owt.prototype={constructor:Nwt,select:function(t){"function"!=typeof t&&(t=Dbt(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,u=i[r]=new Array(l),c=0;c<l;++c)(o=s[c])&&(a=t.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),u[c]=a);return new Nwt(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=Ebt(t));for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,u=0;u<l;++u)(a=s[u])&&(i.push(t.call(a,a.__data__,u,s)),r.push(a));return new Nwt(i,r)},filter:function(t){"function"!=typeof t&&(t=Rbt(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],u=0;u<s;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&l.push(o);return new Nwt(i,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),u=-1,this.each((function(t){p[++u]=t})),p;var n=e?zbt:Pbt,i=this._parents,r=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),u=0;u<o;++u){var c=i[u],h=r[u],d=h.length,p=t.call(c,c&&c.__data__,u,i),f=p.length,g=s[u]=new Array(f),m=a[u]=new Array(f);n(c,h,g,m,l[u]=new Array(d),p,e);for(var y,v,x=0,b=0;x<f;++x)if(y=g[x]){for(x>=b&&(b=x+1);!(v=m[b])&&++b<f;);y._next=v||null}}return(a=new Nwt(a,i))._enter=s,a._exit=l,a},enter:function(){return new Nwt(this._enter||this._groups.map(Lbt),this._parents)},exit:function(){return new Nwt(this._exit||this._groups.map(Lbt),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,u=e[s],c=n[s],h=u.length,d=a[s]=new Array(h),p=0;p<h;++p)(l=u[p]||c[p])&&(d[p]=l);for(;s<i;++s)a[s]=e[s];return new Nwt(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&a!==i.nextSibling&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Bbt);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,u=r[o]=new Array(l),c=0;c<l;++c)(a=s[c])&&(u[c]=a);u.sort(e)}return new Nwt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=Sbt(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Wbt:Vbt:"function"==typeof e?n.local?Hbt:Gbt:n.local?Ubt:jbt)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Xbt:"function"==typeof e?Kbt:Ybt)(t,e,null==n?"":n)):Zbt(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Jbt:"function"==typeof e?twt:Qbt)(t,e)):this.node()[t]},classed:function(t,e){var n=ewt(t+"");if(arguments.length<2){for(var i=nwt(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?lwt:e?awt:swt)(n,e))},text:function(t){return arguments.length?this.each(null==t?uwt:("function"==typeof t?hwt:cwt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?dwt:("function"==typeof t?fwt:pwt)(t)):this.node().innerHTML},raise:function(){return this.each(gwt)},lower:function(){return this.each(mwt)},append:function(t){var e="function"==typeof t?t:Ibt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Ibt(t),i=null==e?ywt:"function"==typeof e?e:Dbt(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(vwt)},clone:function(t){return this.select(t?bwt:xwt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=Cwt(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Iwt:Awt,null==n&&(n=!1),i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,u=0,c=s.length;u<c;++u)for(i=0,l=s[u];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Twt:Dwt)(t,e))}};var Rwt=0;function Lwt(){return new $wt}function $wt(){this._="@"+(++Rwt).toString(36)}function Pwt(){for(var t,e=_wt;t=e.sourceEvent;)e=t;return e}function zwt(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}$wt.prototype=Lwt.prototype={constructor:$wt,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var Bwt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:function(t){return Fwt(Ibt(t).call(document.documentElement))},creator:Ibt,local:Lwt,matcher:Rbt,mouse:function(t){var e=Pwt();return e.changedTouches&&(e=e.changedTouches[0]),zwt(t,e)},namespace:Sbt,namespaces:kbt,clientPoint:zwt,select:Fwt,selectAll:function(t){return"string"==typeof t?new Nwt([document.querySelectorAll(t)],[document.documentElement]):new Nwt([null==t?[]:t],Ewt)},selection:Owt,selector:Dbt,selectorAll:Ebt,style:Zbt,touch:function(t,e,n){arguments.length<3&&(n=e,e=Pwt().changedTouches);for(var i,r=0,o=e?e.length:0;r<o;++r)if((i=e[r]).identifier===n)return zwt(t,i);return null},touches:function(t,e){null==e&&(e=Pwt().touches);for(var n=0,i=e?e.length:0,r=new Array(i);n<i;++n)r[n]=zwt(t,e[n]);return r},window:qbt,get event(){return _wt},customEvent:function(t,e,n,i){var r=_wt;t.sourceEvent=_wt,_wt=t;try{return e.apply(n,i)}finally{_wt=r}}}),Vwt=Pa(TG),Wwt=Pa(Bwt),jwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
Object.defineProperty(e,"__esModule",{value:!0}),e.table=function(t,e,i={}){if(e&&null==e.headers)throw new Error('Data to render must have a "headers" property');if(e&&null==e.values)throw new Error('Data to render must have a "values" property');const r=pbt.getDrawArea(t),o=Object.assign({},n,i);let a=Wwt.select(r).select("table.tf-table");const s=Sxt.css({fontSize:o.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===a.size()&&(a=Wwt.select(r).append("table"),a.attr("class",` ${s} tf-table`),a.append("thead").append("tr"),a.append("tbody")),1!==a.size())throw new Error("Error inserting table");const l=Sxt.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),u=a.select("thead").select("tr").selectAll("th").data(e.headers),c=u.enter().append("th").attr("class",`${l}`);u.merge(c).html((t=>t)),u.exit().remove();const h=Vwt.format(",.4~f"),d=a.select("tbody").selectAll("tr").data(e.values),p=d.enter().append("tr"),f=Sxt.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),g=d.merge(p).selectAll("td").data((t=>t)),m=g.enter().append("td").attr("class",`${f}`);g.merge(m).html((t=>"number"==typeof t?h(t):t)),g.exit().remove(),d.exit().remove()};const n={fontSize:14}})),Uwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(gbt),o={maxBins:12,fontSize:11};e.histogram=function(t,e,i={}){return n(this,void 0,void 0,(function*(){const n=function(t){if(null==t.length)throw new Error("input data must be an array");if(0===t.length)return[];if("object"==typeof t[0]){if(null==t[0].value)throw new Error("input data must have a value field");return t}{const e=Array(t.length);for(let n=0;n<t.length;n++)e[n]={value:t[n]};return e}}(e),a=Object.assign({},o,i),s=fbt.subSurface(t,"histogram");if(!1!==i.stats){const e=fbt.subSurface(t,"stats",{prepend:!0});let r;r=i.stats?i.stats:wbt.arrayStats(n.map((t=>t.value))),function(t,e,n){const i=Vwt.format(",.4~f"),r=Vwt.format(".4~p"),o=[],a=[];null!=t.numVals&&(o.push("Num Vals"),a.push(i(t.numVals)));null!=t.min&&(o.push("Min"),a.push(i(t.min)));null!=t.max&&(o.push("Max"),a.push(i(t.max)));if(null!=t.numZeros){o.push("# Zeros");let e="";t.numVals&&(e=t.numZeros>0?`(${r(t.numZeros/t.numVals)})`:""),a.push(`${i(t.numZeros)} ${e}`)}if(null!=t.numNans){o.push("# NaNs");let e="";t.numVals&&(e=t.numNans>0?`(${r(t.numNans/t.numVals)})`:""),a.push(`${i(t.numNans)} ${e}`)}if(null!=t.numInfs){o.push("# Infinity");let e="";t.numVals&&(e=t.numInfs>0?`(${r(t.numInfs/t.numVals)})`:""),a.push(`${i(t.numInfs)} ${e}`)}jwt.table(e,{headers:o,values:[a]},n)}(r,e,{fontSize:a.fontSize})}if(0===n.length)return;const l=[];for(let t=0;t<n.length;t++){const e=n[t].value;null!=e&&isFinite(e)&&l.push(n[t])}const u={width:a.width||fbt.getDefaultWidth(s),height:a.height||fbt.getDefaultHeight(s),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:l},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},encoding:{x:{bin:{maxbins:a.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:a.color||"#001B44"}}};return r.default(s,u,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}})),Gwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(gbt);e.linechart=function(t,e,i={}){return n(this,void 0,void 0,(function*(){const n=Array.isArray(e.values[0])?e.values:[e.values],a=n[0].length,s=e.series?e.series:n.map(((t,e)=>`Series ${e+1}`));vbt.assert(s.length===n.length,"Must have an equal number of series labels as there are data series"),null!=i.seriesColors&&vbt.assert(i.seriesColors.length===n.length,"Must have an equal number of series colors as there are data series");const l=[];for(let t=0;t<a;t++){const e={x:t};s.forEach(((i,r)=>{const o=n[r][t].y;e[i]=o,e[`${i}-name`]=i})),l.push(e)}const u=Object.assign({},o,i),c={x:{field:"x",type:u.xType,title:u.xLabel},tooltip:[{field:"x",type:"quantitative"},...s.map((t=>({field:t,type:"quantitative"})))]},h=s.map((t=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:t,type:u.yType,title:u.yLabel,scale:u.zoomToFit?{zero:!1}:null!=u.yAxisDomain?{domain:u.yAxisDomain}:void 0},color:{field:`${t}-name`,type:"nominal",legend:{values:s,title:null},scale:{range:u.seriesColors}}}}))),d=pbt.getDrawArea(t),p={width:u.width||fbt.getDefaultWidth(d),height:u.height||fbt.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:u.fontSize,titleFontSize:u.fontSize},text:{fontSize:u.fontSize},legend:{labelFontSize:u.fontSize,titleFontSize:u.fontSize}},data:{values:l},encoding:c,layer:[...h,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield r.default(d,p,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const o={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}})),Hwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))},i=La&&La.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(gbt);e.scatterplot=function(t,e,i={}){return n(this,void 0,void 0,(function*(){let n=e.values;const a=null==e.series?[]:e.series;n=Array.isArray(n[0])?n:[n];const s=[];n.forEach(((t,e)=>{const n=null!=a[e]?a[e]:`Series ${e+1}`,i=t.map((t=>Object.assign({},t,{series:n})));s.push(...i)})),null!=i.seriesColors&&vbt.assert(i.seriesColors.length===n.length,"Must have an equal number of series colors as there are data series");const l=pbt.getDrawArea(t),u=Object.assign({},o,i),c={width:u.width||fbt.getDefaultWidth(l),height:u.height||fbt.getDefaultHeight(l),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:u.fontSize,titleFontSize:u.fontSize},text:{fontSize:u.fontSize},legend:{labelFontSize:u.fontSize,titleFontSize:u.fontSize}},data:{values:s},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:u.xType,title:u.xLabel,scale:u.zoomToFit?{zero:!1}:null!=u.xAxisDomain?{domain:u.xAxisDomain}:void 0},y:{field:"y",type:u.yType,title:u.yLabel,scale:u.zoomToFit?{zero:!1}:null!=u.yAxisDomain?{domain:u.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:u.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield r.default(l,c,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const o={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}})),qwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};function i(t,e,i,a={}){return n(this,void 0,void 0,(function*(){const n=pbt.getDrawArea(t),s={};for(const t of i)if(/val_/.test(t)){const n=t.replace("val_","");r(s,n);const a=o(e,t,i.indexOf(t));s[n].series.push(t),s[n].values.push(a)}else{const n=o(e,t,i.indexOf(t));r(s,t),s[t].series.push(t),s[t].values.push(n)}const l=Object.keys(s),u=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},a),c=[];for(const t of l){const e=fbt.subSurface(n,t),i=s[t].series,r=s[t].values;i.every((t=>Boolean(t.match("acc"))))&&(u.zoomToFitAccuracy?u.zoomToFit=!0:(u.yAxisDomain=[0,1],delete u.zoomToFit));const o=Gwt.linechart(e,{values:r,series:i},u);c.push(o)}yield Promise.all(c)}))}function r(t,e){null==t[e]&&(t[e]={series:[],values:[]})}function o(t,e,n){if(Array.isArray(t)){const i=Array.isArray(t[0])?t[n]:t,r=[];for(let t=0;t<i.length;t++){const n=i[t];r.push({x:t,y:n[e]})}return r}return t.history[e].map(((t,e)=>({x:e,y:t})))}function a(t,e,n){return null==t[e]&&(t[e]={}),null==t[e][n]&&(t[e][n]=[]),t[e][n]}Object.defineProperty(e,"__esModule",{value:!0}),e.history=i,e.fitCallbacks=function(t,e,r={}){const o={},s=r.callbacks||["onEpochEnd","onBatchEnd"],l=pbt.getDrawArea(t),u=Object.assign({},r);delete u.callbacks;const c={};return s.forEach((t=>{c[t]=function(t){return(r,s)=>n(this,void 0,void 0,(function*(){/batch/i.test(t)?u.xLabel="Batch":/epoch/i.test(t)&&(u.xLabel="Epoch");const n=[],r=[];for(const i of e)if(null!=s[i]){r.push(i);const e=a(o,t,i);e.push({[i]:s[i]}),n.push(e)}i(fbt.subSurface(l,t,{title:t}),n,r,u),yield pbt.nextFrame()}))}(t)})),c}})),Xwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};function i(t){let e;if(Array.isArray(t.outputShape[0])){e=`[${t.outputShape.map((t=>r(t))).join(", ")}]`}else e=r(t.outputShape);return{name:t.name,trainable:t.trainable,parameters:t.countParams(),outputShape:e}}function r(t){const e=t.slice();return 0===e.length?"Scalar":(null===e[0]&&(e[0]="batch"),`[${e.join(",")}]`)}Object.defineProperty(e,"__esModule",{value:!0}),e.modelSummary=function(t,e){return n(this,void 0,void 0,(function*(){const n=pbt.getDrawArea(t),r=function(t){return{layers:t.layers.map(i)}}(e).layers.map((t=>[t.name,t.outputShape,t.parameters,t.trainable]));jwt.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:r})}))},e.layer=function(t,e){return n(this,void 0,void 0,(function*(){const i=pbt.getDrawArea(t),o=yield function(t){return n(this,void 0,void 0,(function*(){const e=t.getWeights(),n=t.weights,i=e.map(wbt.tensorStats),o=yield Promise.all(i),a=e.map((t=>t.shape));return e.map(((t,e)=>({name:n[e].name,stats:o[e],shape:r(a[e]),weight:t})))}))}(e),a=fbt.subSurface(i,"layer-weights-info"),s=o.map((t=>[t.name,t.shape,t.stats.min,t.stats.max,t.weight.size,t.stats.numZeros,t.stats.numNans,t.stats.numInfs]));jwt.table(a,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:s});const l=fbt.subSurface(i,"select-layer"),u=fbt.subSurface(i,"param-distribution");!function(t,e,n){const i=`\n    <select>\n      ${t.map((t=>`<option value=${t}>${t}</option>`))}\n    </select>\n  `,r=`<div><button>Show Values Distribution for:</button>${i}</div>`;e.innerHTML=r;const o=e.querySelector("button"),a=e.querySelector("select");o.addEventListener("click",(()=>{n(a.selectedOptions[0].label)}))}(o.map((t=>t.name)),l,(t=>n(this,void 0,void 0,(function*(){const e=o.filter((e=>e.name===t))[0],n=yield e.weight.data();Uwt.histogram(u,n,{height:150,width:460,stats:!1})}))))}))}})),Ywt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.perClassAccuracy=function(t,e,i){return n(this,void 0,void 0,(function*(){const n=pbt.getDrawArea(t),r=[];for(let t=0;t<e.length;t++){const n=i?i[t]:t.toString(),o=e[t];r.push([n,o.accuracy,o.count])}return jwt.table(n,{headers:["Class","Accuracy","# Samples"],values:r})}))}})),Kwt=$a((function(t,e){
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
var n=La&&La.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.valuesDistribution=function(t,e){return n(this,void 0,void 0,(function*(){const n=pbt.getDrawArea(t),i=yield wbt.tensorStats(e),r=yield e.data();Uwt.histogram(n,r,{height:150,stats:i})}))}})),Zwt=$a((function(t,e){
/** @license See the LICENSE file. */
Object.defineProperty(e,"__esModule",{value:!0});e.version="1.5.1"})),Jwt=$a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),
/**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   */
e.version_vis=Zwt.version;const n={barchart:mbt.barchart,table:jwt.table,histogram:Uwt.histogram,linechart:Gwt.linechart,scatterplot:Hwt.scatterplot,confusionMatrix:ybt.confusionMatrix,heatmap:bbt.heatmap};e.render=n;const i={accuracy:wbt.accuracy,perClassAccuracy:wbt.perClassAccuracy,confusionMatrix:wbt.confusionMatrix};e.metrics=i;const r={history:qwt.history,fitCallbacks:qwt.fitCallbacks,perClassAccuracy:Ywt.perClassAccuracy,valuesDistribution:Kwt.valuesDistribution,layer:Xwt.layer,modelSummary:Xwt.modelSummary};e.show=r,e.visor=dbt.visor,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(Cxt)})),Qwt=function(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1},t_t=new function(){this.browser=new Qwt,this.node=!1,this.wxa=!1,this.worker=!1,this.canvasSupported=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(t_t.wxa=!0,t_t.canvasSupported=!0,t_t.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?(t_t.worker=!0,t_t.canvasSupported=!0):"undefined"==typeof navigator?(t_t.node=!0,t_t.canvasSupported=!0,t_t.svgSupported=!0):function(t,e){var n=e.browser,i=t.match(/Firefox\/([\d.]+)/),r=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/.+?rv:(([\d.]+))/),o=t.match(/Edge?\/([\d.]+)/),a=/micromessenger/i.test(t);i&&(n.firefox=!0,n.version=i[1]);r&&(n.ie=!0,n.version=r[1]);o&&(n.edge=!0,n.version=o[1],n.newEdge=+o[1].split(".")[0]>18);a&&(n.weChat=!0);e.canvasSupported=!!document.createElement("canvas").getContext,e.svgSupported="undefined"!=typeof SVGRect,e.touchEventsSupported="ontouchstart"in window&&!n.ie&&!n.edge,e.pointerEventsSupported="onpointerdown"in window&&(n.edge||n.ie&&+n.version>=11),e.domSupported="undefined"!=typeof document;var s=document.documentElement.style;e.transform3dSupported=(n.ie&&"transition"in s||n.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in s)&&!("OTransition"in s),e.transformSupported=e.transform3dSupported||n.ie&&+n.version>=9}(navigator.userAgent,t_t);var e_t={"[object Function]":!0,"[object RegExp]":!0,"[object Date]":!0,"[object Error]":!0,"[object CanvasGradient]":!0,"[object CanvasPattern]":!0,"[object Image]":!0,"[object Canvas]":!0},n_t={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0},i_t=Object.prototype.toString,r_t=Array.prototype,o_t=r_t.forEach,a_t=r_t.filter,s_t=r_t.slice,l_t=r_t.map,u_t=function(){}.constructor,c_t=u_t?u_t.prototype:null,h_t={},d_t=2311;function p_t(){return d_t++}function f_t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"undefined"!=typeof console&&console.error.apply(console,t)}function g_t(t){if(null==t||"object"!=typeof t)return t;var e=t,n=i_t.call(t);if("[object Array]"===n){if(!Y_t(t)){e=[];for(var i=0,r=t.length;i<r;i++)e[i]=g_t(t[i])}}else if(n_t[n]){if(!Y_t(t)){var o=t.constructor;if(o.from)e=o.from(t);else{e=new o(t.length);for(i=0,r=t.length;i<r;i++)e[i]=g_t(t[i])}}}else if(!e_t[n]&&!Y_t(t)&&!z_t(t))for(var a in e={},t)t.hasOwnProperty(a)&&(e[a]=g_t(t[a]));return e}function m_t(t,e,n){if(!L_t(e)||!L_t(t))return n?g_t(e):t;for(var i in e)if(e.hasOwnProperty(i)){var r=t[i],o=e[i];!L_t(o)||!L_t(r)||E_t(o)||E_t(r)||z_t(o)||z_t(r)||$_t(o)||$_t(r)||Y_t(o)||Y_t(r)?!n&&i in t||(t[i]=g_t(e[i])):m_t(r,o,n)}return t}function y_t(t,e){for(var n=t[0],i=1,r=t.length;i<r;i++)n=m_t(n,t[i],e);return n}function v_t(t,e){if(Object.assign)Object.assign(t,e);else for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function x_t(t,e,n){for(var i=M_t(e),r=0;r<i.length;r++){var o=i[r];(n?null!=e[o]:null==t[o])&&(t[o]=e[o])}return t}var b_t=function(){return h_t.createCanvas()};function w_t(t,e){if(t){if(t.indexOf)return t.indexOf(e);for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n}return-1}function __t(t,e,n){if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames)for(var i=Object.getOwnPropertyNames(e),r=0;r<i.length;r++){var o=i[r];"constructor"!==o&&(n?null!=e[o]:null==t[o])&&(t[o]=e[o])}else x_t(t,e,n)}function k_t(t){return!!t&&("string"!=typeof t&&"number"==typeof t.length)}function S_t(t,e,n){if(t&&e)if(t.forEach&&t.forEach===o_t)t.forEach(e,n);else if(t.length===+t.length)for(var i=0,r=t.length;i<r;i++)e.call(n,t[i],i,t);else for(var o in t)t.hasOwnProperty(o)&&e.call(n,t[o],o,t)}function C_t(t,e,n){if(!t)return[];if(!e)return U_t(t);if(t.map&&t.map===l_t)return t.map(e,n);for(var i=[],r=0,o=t.length;r<o;r++)i.push(e.call(n,t[r],r,t));return i}function A_t(t,e,n,i){if(t&&e){for(var r=0,o=t.length;r<o;r++)n=e.call(i,n,t[r],r,t);return n}}function I_t(t,e,n){if(!t)return[];if(!e)return U_t(t);if(t.filter&&t.filter===a_t)return t.filter(e,n);for(var i=[],r=0,o=t.length;r<o;r++)e.call(n,t[r],r,t)&&i.push(t[r]);return i}function M_t(t){if(!t)return[];if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}h_t.createCanvas=function(){return document.createElement("canvas")};var D_t=c_t&&N_t(c_t.bind)?c_t.call.bind(c_t.bind):function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return function(){return t.apply(e,n.concat(s_t.call(arguments)))}};function T_t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){return t.apply(this,e.concat(s_t.call(arguments)))}}function E_t(t){return Array.isArray?Array.isArray(t):"[object Array]"===i_t.call(t)}function N_t(t){return"function"==typeof t}function O_t(t){return"string"==typeof t}function F_t(t){return"[object String]"===i_t.call(t)}function R_t(t){return"number"==typeof t}function L_t(t){var e=typeof t;return"function"===e||!!t&&"object"===e}function $_t(t){return!!e_t[i_t.call(t)]}function P_t(t){return!!n_t[i_t.call(t)]}function z_t(t){return"object"==typeof t&&"number"==typeof t.nodeType&&"object"==typeof t.ownerDocument}function B_t(t){return t!=t}function V_t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=t.length;n<i;n++)if(null!=t[n])return t[n]}function W_t(t,e){return null!=t?t:e}function j_t(t,e,n){return null!=t?t:null!=e?e:n}function U_t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return s_t.apply(t,e)}function G_t(t){if("number"==typeof t)return[t,t,t,t];var e=t.length;return 2===e?[t[0],t[1],t[0],t[1]]:3===e?[t[0],t[1],t[2],t[1]]:t}function H_t(t,e){if(!t)throw new Error(e)}function q_t(t){return null==t?null:"function"==typeof t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function X_t(t){t.__ec_primitive__=!0}function Y_t(t){return t.__ec_primitive__}var K_t=function(){function t(e){this.data={};var n=E_t(e);this.data={};var i=this;function r(t,e){n?i.set(t,e):i.set(e,t)}e instanceof t?e.each(r):e&&S_t(e,r)}return t.prototype.get=function(t){return this.data.hasOwnProperty(t)?this.data[t]:null},t.prototype.set=function(t,e){return this.data[t]=e},t.prototype.each=function(t,e){for(var n in this.data)this.data.hasOwnProperty(n)&&t.call(e,this.data[n],n)},t.prototype.keys=function(){return M_t(this.data)},t.prototype.removeKey=function(t){delete this.data[t]},t}();function Z_t(t){return new K_t(t)}function J_t(t,e){for(var n=new t.constructor(t.length+e.length),i=0;i<t.length;i++)n[i]=t[i];var r=t.length;for(i=0;i<e.length;i++)n[i+r]=e[i];return n}function Q_t(t,e){var n;if(Object.create)n=Object.create(t);else{var i=function(){};i.prototype=t,n=new i}return e&&v_t(n,e),n}function tkt(t,e){return t.hasOwnProperty(e)}function ekt(){}function nkt(t,e){return null==t&&(t=0),null==e&&(e=0),[t,e]}function ikt(t,e){return t[0]=e[0],t[1]=e[1],t}function rkt(t){return[t[0],t[1]]}function okt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function akt(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t}function skt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function lkt(t){return Math.sqrt(function(t){return t[0]*t[0]+t[1]*t[1]}(t))}function ukt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function ckt(t,e){var n=lkt(e);return 0===n?(t[0]=0,t[1]=0):(t[0]=e[0]/n,t[1]=e[1]/n),t}function hkt(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}var dkt=hkt;var pkt=function(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])};function fkt(t,e,n,i){return t[0]=e[0]+i*(n[0]-e[0]),t[1]=e[1]+i*(n[1]-e[1]),t}function gkt(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function mkt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function ykt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}var vkt=function(t,e){this.target=t,this.topTarget=e&&e.topTarget},xkt=function(){function t(t){this.handler=t,t.on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}return t.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent;e&&(this._draggingTarget=e,e.dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new vkt(e,t),"dragstart",t.event))},t.prototype._drag=function(t){var e=this._draggingTarget;if(e){var n=t.offsetX,i=t.offsetY,r=n-this._x,o=i-this._y;this._x=n,this._y=i,e.drift(r,o,t),this.handler.dispatchToElement(new vkt(e,t),"drag",t.event);var a=this.handler.findHover(n,i,e).target,s=this._dropTarget;this._dropTarget=a,e!==a&&(s&&a!==s&&this.handler.dispatchToElement(new vkt(s,t),"dragleave",t.event),a&&a!==s&&this.handler.dispatchToElement(new vkt(a,t),"dragenter",t.event))}},t.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new vkt(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new vkt(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},t}(),bkt=function(){function t(t){t&&(this._$eventProcessor=t)}return t.prototype.on=function(t,e,n,i){this._$handlers||(this._$handlers={});var r=this._$handlers;if("function"==typeof e&&(i=n,n=e,e=null),!n||!t)return this;var o=this._$eventProcessor;null!=e&&o&&o.normalizeQuery&&(e=o.normalizeQuery(e)),r[t]||(r[t]=[]);for(var a=0;a<r[t].length;a++)if(r[t][a].h===n)return this;var s={h:n,query:e,ctx:i||this,callAtLast:n.zrEventfulCallAtLast},l=r[t].length-1,u=r[t][l];return u&&u.callAtLast?r[t].splice(l,0,s):r[t].push(s),this},t.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},t.prototype.off=function(t,e){var n=this._$handlers;if(!n)return this;if(!t)return this._$handlers={},this;if(e){if(n[t]){for(var i=[],r=0,o=n[t].length;r<o;r++)n[t][r].h!==e&&i.push(n[t][r]);n[t]=i}n[t]&&0===n[t].length&&delete n[t]}else delete n[t];return this},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!this._$handlers)return this;var i=this._$handlers[t],r=this._$eventProcessor;if(i)for(var o=e.length,a=i.length,s=0;s<a;s++){var l=i[s];if(!r||!r.filter||null==l.query||r.filter(t,l.query))switch(o){case 0:l.h.call(l.ctx);break;case 1:l.h.call(l.ctx,e[0]);break;case 2:l.h.call(l.ctx,e[0],e[1]);break;default:l.h.apply(l.ctx,e)}}return r&&r.afterTrigger&&r.afterTrigger(t),this},t.prototype.triggerWithContext=function(t){if(!this._$handlers)return this;var e=this._$handlers[t],n=this._$eventProcessor;if(e)for(var i=arguments,r=i.length,o=i[r-1],a=e.length,s=0;s<a;s++){var l=e[s];if(!n||!n.filter||null==l.query||n.filter(t,l.query))switch(r){case 0:l.h.call(o);break;case 1:l.h.call(o,i[0]);break;case 2:l.h.call(o,i[0],i[1]);break;default:l.h.apply(o,i.slice(1,r-1))}}return n&&n.afterTrigger&&n.afterTrigger(t),this},t}(),wkt=Math.log(2);function _kt(t,e,n,i,r,o){var a=i+"-"+r,s=t.length;if(o.hasOwnProperty(a))return o[a];if(1===e){var l=Math.round(Math.log((1<<s)-1&~r)/wkt);return t[n][l]}for(var u=i|1<<n,c=n+1;i&1<<c;)c++;for(var h=0,d=0,p=0;d<s;d++){var f=1<<d;f&r||(h+=(p%2?-1:1)*t[n][d]*_kt(t,e-1,c,u,r|f,o),p++)}return o[a]=h,h}function kkt(t,e){var n=[[t[0],t[1],1,0,0,0,-e[0]*t[0],-e[0]*t[1]],[0,0,0,t[0],t[1],1,-e[1]*t[0],-e[1]*t[1]],[t[2],t[3],1,0,0,0,-e[2]*t[2],-e[2]*t[3]],[0,0,0,t[2],t[3],1,-e[3]*t[2],-e[3]*t[3]],[t[4],t[5],1,0,0,0,-e[4]*t[4],-e[4]*t[5]],[0,0,0,t[4],t[5],1,-e[5]*t[4],-e[5]*t[5]],[t[6],t[7],1,0,0,0,-e[6]*t[6],-e[6]*t[7]],[0,0,0,t[6],t[7],1,-e[7]*t[6],-e[7]*t[7]]],i={},r=_kt(n,8,0,0,0,i);if(0!==r){for(var o=[],a=0;a<8;a++)for(var s=0;s<8;s++)null==o[s]&&(o[s]=0),o[s]+=((a+s)%2?-1:1)*_kt(n,7,0===a?1:0,1<<a,1<<s,i)/r*e[a];return function(t,e,n){var i=e*o[6]+n*o[7]+1;t[0]=(e*o[0]+n*o[1]+o[2])/i,t[1]=(e*o[3]+n*o[4]+o[5])/i}}}var Skt=[];function Ckt(t,e,n,i,r){if(e.getBoundingClientRect&&t_t.domSupported&&!Akt(e)){var o=e.___zrEVENTSAVED||(e.___zrEVENTSAVED={}),a=function(t,e,n){for(var i=n?"invTrans":"trans",r=e[i],o=e.srcCoords,a=[],s=[],l=!0,u=0;u<4;u++){var c=t[u].getBoundingClientRect(),h=2*u,d=c.left,p=c.top;a.push(d,p),l=l&&o&&d===o[h]&&p===o[h+1],s.push(t[u].offsetLeft,t[u].offsetTop)}return l&&r?r:(e.srcCoords=a,e[i]=n?kkt(s,a):kkt(a,s))}(function(t,e){var n=e.markers;if(n)return n;n=e.markers=[];for(var i=["left","right"],r=["top","bottom"],o=0;o<4;o++){var a=document.createElement("div"),s=o%2,l=(o>>1)%2;a.style.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",i[s]+":0",r[l]+":0",i[1-s]+":auto",r[1-l]+":auto",""].join("!important;"),t.appendChild(a),n.push(a)}return n}(e,o),o,r);if(a)return a(t,n,i),!0}return!1}function Akt(t){return"CANVAS"===t.nodeName.toUpperCase()}var Ikt="undefined"!=typeof window&&!!window.addEventListener,Mkt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Dkt=[];function Tkt(t,e,n,i){return n=n||{},i||!t_t.canvasSupported?Ekt(t,e,n):t_t.browser.firefox&&null!=e.layerX&&e.layerX!==e.offsetX?(n.zrX=e.layerX,n.zrY=e.layerY):null!=e.offsetX?(n.zrX=e.offsetX,n.zrY=e.offsetY):Ekt(t,e,n),n}function Ekt(t,e,n){if(t_t.domSupported&&t.getBoundingClientRect){var i=e.clientX,r=e.clientY;if(Akt(t)){var o=t.getBoundingClientRect();return n.zrX=i-o.left,void(n.zrY=r-o.top)}if(Ckt(Dkt,t,i,r))return n.zrX=Dkt[0],void(n.zrY=Dkt[1])}n.zrX=n.zrY=0}function Nkt(t){return t||window.event}function Okt(t,e,n){if(null!=(e=Nkt(e)).zrX)return e;var i=e.type;if(i&&i.indexOf("touch")>=0){var r="touchend"!==i?e.targetTouches[0]:e.changedTouches[0];r&&Tkt(t,r,e,n)}else{Tkt(t,e,e,n);var o=function(t){var e=t.wheelDelta;if(e)return e;var n=t.deltaX,i=t.deltaY;if(null==n||null==i)return e;return 3*(0!==i?Math.abs(i):Math.abs(n))*(i>0?-1:i<0?1:n>0?-1:1)}(e);e.zrDelta=o?o/120:-(e.detail||0)/3}var a=e.button;return null==e.which&&void 0!==a&&Mkt.test(e.type)&&(e.which=1&a?1:2&a?3:4&a?2:0),e}function Fkt(t,e,n,i){Ikt?t.addEventListener(e,n,i):t.attachEvent("on"+e,n)}function Rkt(t,e,n,i){Ikt?t.removeEventListener(e,n,i):t.detachEvent("on"+e,n)}var Lkt=Ikt?function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}:function(t){t.returnValue=!1,t.cancelBubble=!0};function $kt(t){return 2===t.which||3===t.which}var Pkt=function(){function t(){this._track=[]}return t.prototype.recognize=function(t,e,n){return this._doTrack(t,e,n),this._recognize(t)},t.prototype.clear=function(){return this._track.length=0,this},t.prototype._doTrack=function(t,e,n){var i=t.touches;if(i){for(var r={points:[],touches:[],target:e,event:t},o=0,a=i.length;o<a;o++){var s=i[o],l=Tkt(n,s,{});r.points.push([l.zrX,l.zrY]),r.touches.push(s)}this._track.push(r)}},t.prototype._recognize=function(t){for(var e in Bkt)if(Bkt.hasOwnProperty(e)){var n=Bkt[e](this._track,t);if(n)return n}},t}();function zkt(t){var e=t[1][0]-t[0][0],n=t[1][1]-t[0][1];return Math.sqrt(e*e+n*n)}var Bkt={pinch:function(t,e){var n=t.length;if(n){var i,r=(t[n-1]||{}).points,o=(t[n-2]||{}).points||r;if(o&&o.length>1&&r&&r.length>1){var a=zkt(r)/zkt(o);!isFinite(a)&&(a=1),e.pinchScale=a;var s=[((i=r)[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];return e.pinchX=s[0],e.pinchY=s[1],{type:"pinch",target:t[0].target,event:e}}}}};function Vkt(){Lkt(this.event)}var Wkt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handler=null,e}return Dit(e,t),e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e}(bkt),jkt=function(t,e){this.x=t,this.y=e},Ukt=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Gkt=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o._hovered=new jkt(0,0),o.storage=e,o.painter=n,o.painterRoot=r,i=i||new Wkt,o.proxy=null,o.setHandlerProxy(i),o._draggingMgr=new xkt(o),o}return Dit(e,t),e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(S_t(Ukt,(function(e){t.on&&t.on(e,this[e],this)}),this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(t){var e=t.zrX,n=t.zrY,i=qkt(this,e,n),r=this._hovered,o=r.target;o&&!o.__zr&&(o=(r=this.findHover(r.x,r.y)).target);var a=this._hovered=i?new jkt(e,n):this.findHover(e,n),s=a.target,l=this.proxy;l.setCursor&&l.setCursor(s?s.cursor:"default"),o&&s!==o&&this.dispatchToElement(r,"mouseout",t),this.dispatchToElement(a,"mousemove",t),s&&s!==o&&this.dispatchToElement(a,"mouseover",t)},e.prototype.mouseout=function(t){var e=t.zrEventControl;"only_globalout"!==e&&this.dispatchToElement(this._hovered,"mouseout",t),"no_globalout"!==e&&this.trigger("globalout",{type:"globalout",event:t})},e.prototype.resize=function(){this._hovered=new jkt(0,0)},e.prototype.dispatch=function(t,e){var n=this[t];n&&n.call(this,e)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(t){var e=this.proxy;e.setCursor&&e.setCursor(t)},e.prototype.dispatchToElement=function(t,e,n){var i=(t=t||{}).target;if(!i||!i.silent){for(var r="on"+e,o=function(t,e,n){return{type:t,event:n,target:e.target,topTarget:e.topTarget,cancelBubble:!1,offsetX:n.zrX,offsetY:n.zrY,gestureEvent:n.gestureEvent,pinchX:n.pinchX,pinchY:n.pinchY,pinchScale:n.pinchScale,wheelDelta:n.zrDelta,zrByTouch:n.zrByTouch,which:n.which,stop:Vkt}}(e,t,n);i&&(i[r]&&(o.cancelBubble=!!i[r].call(i,o)),i.trigger(e,o),i=i.__hostTarget?i.__hostTarget:i.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(e,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer((function(t){"function"==typeof t[r]&&t[r].call(t,o),t.trigger&&t.trigger(e,o)})))}},e.prototype.findHover=function(t,e,n){for(var i=this.storage.getDisplayList(),r=new jkt(t,e),o=i.length-1;o>=0;o--){var a=void 0;if(i[o]!==n&&!i[o].ignore&&(a=Hkt(i[o],t,e))&&(!r.topTarget&&(r.topTarget=i[o]),"silent"!==a)){r.target=i[o];break}}return r},e.prototype.processGesture=function(t,e){this._gestureMgr||(this._gestureMgr=new Pkt);var n=this._gestureMgr;"start"===e&&n.clear();var i=n.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);if("end"===e&&n.clear(),i){var r=i.type;t.gestureEvent=r;var o=new jkt;o.target=i.target,this.dispatchToElement(o,r,i.event)}},e}(bkt);function Hkt(t,e,n){if(t[t.rectHover?"rectContain":"contain"](e,n)){for(var i=t,r=void 0,o=!1;i;){if(i.ignoreClip&&(o=!0),!o){var a=i.getClipPath();if(a&&!a.contain(e,n))return!1;i.silent&&(r=!0)}var s=i.__hostTarget;i=s||i.parent}return!r||"silent"}return!1}function qkt(t,e,n){var i=t.painter;return e<0||e>i.getWidth()||n<0||n>i.getHeight()}S_t(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],(function(t){Gkt.prototype[t]=function(e){var n,i,r=e.zrX,o=e.zrY,a=qkt(this,r,o);if("mouseup"===t&&a||(i=(n=this.findHover(r,o)).target),"mousedown"===t)this._downEl=i,this._downPoint=[e.zrX,e.zrY],this._upEl=i;else if("mouseup"===t)this._upEl=i;else if("click"===t){if(this._downEl!==this._upEl||!this._downPoint||dkt(this._downPoint,[e.zrX,e.zrY])>4)return;this._downPoint=null}this.dispatchToElement(n,t,e)}}));function Xkt(t,e,n,i){var r=e+1;if(r===n)return 1;if(i(t[r++],t[e])<0){for(;r<n&&i(t[r],t[r-1])<0;)r++;!function(t,e,n){n--;for(;e<n;){var i=t[e];t[e++]=t[n],t[n--]=i}}(t,e,r)}else for(;r<n&&i(t[r],t[r-1])>=0;)r++;return r-e}function Ykt(t,e,n,i,r){for(i===e&&i++;i<n;i++){for(var o,a=t[i],s=e,l=i;s<l;)r(a,t[o=s+l>>>1])<0?l=o:s=o+1;var u=i-s;switch(u){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;u>0;)t[s+u]=t[s+u-1],u--}t[s]=a}}function Kkt(t,e,n,i,r,o){var a=0,s=0,l=1;if(o(t,e[n+r])>0){for(s=i-r;l<s&&o(t,e[n+r+l])>0;)a=l,(l=1+(l<<1))<=0&&(l=s);l>s&&(l=s),a+=r,l+=r}else{for(s=r+1;l<s&&o(t,e[n+r-l])<=0;)a=l,(l=1+(l<<1))<=0&&(l=s);l>s&&(l=s);var u=a;a=r-l,l=r-u}for(a++;a<l;){var c=a+(l-a>>>1);o(t,e[n+c])>0?a=c+1:l=c}return l}function Zkt(t,e,n,i,r,o){var a=0,s=0,l=1;if(o(t,e[n+r])<0){for(s=r+1;l<s&&o(t,e[n+r-l])<0;)a=l,(l=1+(l<<1))<=0&&(l=s);l>s&&(l=s);var u=a;a=r-l,l=r-u}else{for(s=i-r;l<s&&o(t,e[n+r+l])>=0;)a=l,(l=1+(l<<1))<=0&&(l=s);l>s&&(l=s),a+=r,l+=r}for(a++;a<l;){var c=a+(l-a>>>1);o(t,e[n+c])<0?l=c:a=c+1}return l}function Jkt(t,e){var n,i,r=7,o=0,a=[];function s(s){var l=n[s],u=i[s],c=n[s+1],h=i[s+1];i[s]=u+h,s===o-3&&(n[s+1]=n[s+2],i[s+1]=i[s+2]),o--;var d=Zkt(t[c],t,l,u,0,e);l+=d,0!==(u-=d)&&0!==(h=Kkt(t[l+u-1],t,c,h,h-1,e))&&(u<=h?function(n,i,o,s){var l=0;for(l=0;l<i;l++)a[l]=t[n+l];var u=0,c=o,h=n;if(t[h++]=t[c++],0==--s){for(l=0;l<i;l++)t[h+l]=a[u+l];return}if(1===i){for(l=0;l<s;l++)t[h+l]=t[c+l];return void(t[h+s]=a[u])}var d,p,f,g=r;for(;;){d=0,p=0,f=!1;do{if(e(t[c],a[u])<0){if(t[h++]=t[c++],p++,d=0,0==--s){f=!0;break}}else if(t[h++]=a[u++],d++,p=0,1==--i){f=!0;break}}while((d|p)<g);if(f)break;do{if(0!==(d=Zkt(t[c],a,u,i,0,e))){for(l=0;l<d;l++)t[h+l]=a[u+l];if(h+=d,u+=d,(i-=d)<=1){f=!0;break}}if(t[h++]=t[c++],0==--s){f=!0;break}if(0!==(p=Kkt(a[u],t,c,s,0,e))){for(l=0;l<p;l++)t[h+l]=t[c+l];if(h+=p,c+=p,0===(s-=p)){f=!0;break}}if(t[h++]=a[u++],1==--i){f=!0;break}g--}while(d>=7||p>=7);if(f)break;g<0&&(g=0),g+=2}if((r=g)<1&&(r=1),1===i){for(l=0;l<s;l++)t[h+l]=t[c+l];t[h+s]=a[u]}else{if(0===i)throw new Error;for(l=0;l<i;l++)t[h+l]=a[u+l]}}(l,u,c,h):function(n,i,o,s){var l=0;for(l=0;l<s;l++)a[l]=t[o+l];var u=n+i-1,c=s-1,h=o+s-1,d=0,p=0;if(t[h--]=t[u--],0==--i){for(d=h-(s-1),l=0;l<s;l++)t[d+l]=a[l];return}if(1===s){for(p=(h-=i)+1,d=(u-=i)+1,l=i-1;l>=0;l--)t[p+l]=t[d+l];return void(t[h]=a[c])}var f=r;for(;;){var g=0,m=0,y=!1;do{if(e(a[c],t[u])<0){if(t[h--]=t[u--],g++,m=0,0==--i){y=!0;break}}else if(t[h--]=a[c--],m++,g=0,1==--s){y=!0;break}}while((g|m)<f);if(y)break;do{if(0!==(g=i-Zkt(a[c],t,n,i,i-1,e))){for(i-=g,p=(h-=g)+1,d=(u-=g)+1,l=g-1;l>=0;l--)t[p+l]=t[d+l];if(0===i){y=!0;break}}if(t[h--]=a[c--],1==--s){y=!0;break}if(0!==(m=s-Kkt(t[u],a,0,s,s-1,e))){for(s-=m,p=(h-=m)+1,d=(c-=m)+1,l=0;l<m;l++)t[p+l]=a[d+l];if(s<=1){y=!0;break}}if(t[h--]=t[u--],0==--i){y=!0;break}f--}while(g>=7||m>=7);if(y)break;f<0&&(f=0),f+=2}(r=f)<1&&(r=1);if(1===s){for(p=(h-=i)+1,d=(u-=i)+1,l=i-1;l>=0;l--)t[p+l]=t[d+l];t[h]=a[c]}else{if(0===s)throw new Error;for(d=h-(s-1),l=0;l<s;l++)t[d+l]=a[l]}}(l,u,c,h))}return n=[],i=[],{mergeRuns:function(){for(;o>1;){var t=o-2;if(t>=1&&i[t-1]<=i[t]+i[t+1]||t>=2&&i[t-2]<=i[t]+i[t-1])i[t-1]<i[t+1]&&t--;else if(i[t]>i[t+1])break;s(t)}},forceMergeRuns:function(){for(;o>1;){var t=o-2;t>0&&i[t-1]<i[t+1]&&t--,s(t)}},pushRun:function(t,e){n[o]=t,i[o]=e,o+=1}}}function Qkt(t,e,n,i){n||(n=0),i||(i=t.length);var r=i-n;if(!(r<2)){var o=0;if(r<32)Ykt(t,n,i,n+(o=Xkt(t,n,i,e)),e);else{var a=Jkt(t,e),s=function(t){for(var e=0;t>=32;)e|=1&t,t>>=1;return t+e}(r);do{if((o=Xkt(t,n,i,e))<s){var l=r;l>s&&(l=s),Ykt(t,n,n+l,n+o,e),o=l}a.pushRun(n,o),a.mergeRuns(),r-=o,n+=o}while(0!==r);a.forceMergeRuns()}}}var tSt=!1;function eSt(){tSt||(tSt=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function nSt(t,e){return t.zlevel===e.zlevel?t.z===e.z?t.z2-e.z2:t.z-e.z:t.zlevel-e.zlevel}var iSt=function(){function t(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=nSt}return t.prototype.traverse=function(t,e){for(var n=0;n<this._roots.length;n++)this._roots[n].traverse(t,e)},t.prototype.getDisplayList=function(t,e){e=e||!1;var n=this._displayList;return!t&&n.length||this.updateDisplayList(e),n},t.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,n=this._displayList,i=0,r=e.length;i<r;i++)this._updateAndAddDisplayable(e[i],null,t);n.length=this._displayListLen,t_t.canvasSupported&&Qkt(n,nSt)},t.prototype._updateAndAddDisplayable=function(t,e,n){if(!t.ignore||n){t.beforeUpdate(),t.update(),t.afterUpdate();var i=t.getClipPath();if(t.ignoreClip)e=null;else if(i){e=e?e.slice():[];for(var r=i,o=t;r;)r.parent=o,r.updateTransform(),e.push(r),o=r,r=r.getClipPath()}if(t.childrenRef){for(var a=t.childrenRef(),s=0;s<a.length;s++){var l=a[s];t.__dirty&&(l.__dirty|=1),this._updateAndAddDisplayable(l,e,n)}t.__dirty=0}else{var u=t;e&&e.length?u.__clipPaths=e:u.__clipPaths&&u.__clipPaths.length>0&&(u.__clipPaths=[]),isNaN(u.z)&&(eSt(),u.z=0),isNaN(u.z2)&&(eSt(),u.z2=0),isNaN(u.zlevel)&&(eSt(),u.zlevel=0),this._displayList[this._displayListLen++]=u}var c=t.getDecalElement&&t.getDecalElement();c&&this._updateAndAddDisplayable(c,e,n);var h=t.getTextGuideLine();h&&this._updateAndAddDisplayable(h,e,n);var d=t.getTextContent();d&&this._updateAndAddDisplayable(d,e,n)}},t.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},t.prototype.delRoot=function(t){if(t instanceof Array)for(var e=0,n=t.length;e<n;e++)this.delRoot(t[e]);else{var i=w_t(this._roots,t);i>=0&&this._roots.splice(i,1)}},t.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},t.prototype.getRoots=function(){return this._roots},t.prototype.dispose=function(){this._displayList=null,this._roots=null},t}(),rSt="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,16)},oSt={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,n=.1,i=.4;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=i*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-oSt.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*oSt.bounceIn(2*t):.5*oSt.bounceOut(2*t-1)+.5}},aSt=function(){function t(t){this._initialized=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=null!=t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart}return t.prototype.step=function(t,e){if(this._initialized||(this._startTime=t+this._delay,this._initialized=!0),!this._paused){var n=(t-this._startTime-this._pausedTime)/this._life;n<0&&(n=0),n=Math.min(n,1);var i=this.easing,r="string"==typeof i?oSt[i]:i,o="function"==typeof r?r(n):n;if(this.onframe&&this.onframe(o),1===n){if(!this.loop)return!0;this._restart(t),this.onrestart&&this.onrestart()}return!1}this._pausedTime+=e},t.prototype._restart=function(t){var e=(t-this._startTime-this._pausedTime)%this._life;this._startTime=t-e+this.gap,this._pausedTime=0},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1},t}(),sSt=function(t){this.value=t},lSt=function(){function t(){this._len=0}return t.prototype.insert=function(t){var e=new sSt(t);return this.insertEntry(e),e},t.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},t.prototype.remove=function(t){var e=t.prev,n=t.next;e?e.next=n:this.head=n,n?n.prev=e:this.tail=e,t.next=t.prev=null,this._len--},t.prototype.len=function(){return this._len},t.prototype.clear=function(){this.head=this.tail=null,this._len=0},t}(),uSt=function(){function t(t){this._list=new lSt,this._maxSize=10,this._map={},this._maxSize=t}return t.prototype.put=function(t,e){var n=this._list,i=this._map,r=null;if(null==i[t]){var o=n.len(),a=this._lastRemovedEntry;if(o>=this._maxSize&&o>0){var s=n.head;n.remove(s),delete i[s.key],r=s.value,this._lastRemovedEntry=s}a?a.value=e:a=new sSt(e),a.key=t,n.insertEntry(a),i[t]=a}return r},t.prototype.get=function(t){var e=this._map[t],n=this._list;if(null!=e)return e!==n.tail&&(n.remove(e),n.insertEntry(e)),e.value},t.prototype.clear=function(){this._list.clear(),this._map={}},t.prototype.len=function(){return this._list.len()},t}(),cSt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function hSt(t){return(t=Math.round(t))<0?0:t>255?255:t}function dSt(t){return t<0?0:t>1?1:t}function pSt(t){var e=t;return e.length&&"%"===e.charAt(e.length-1)?hSt(parseFloat(e)/100*255):hSt(parseInt(e,10))}function fSt(t){var e=t;return e.length&&"%"===e.charAt(e.length-1)?dSt(parseFloat(e)/100):dSt(parseFloat(e))}function gSt(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}function mSt(t,e,n){return t+(e-t)*n}function ySt(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function vSt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}var xSt=new uSt(20),bSt=null;function wSt(t,e){bSt&&vSt(bSt,e),bSt=xSt.put(t,bSt||e.slice())}function _St(t,e){if(t){e=e||[];var n=xSt.get(t);if(n)return vSt(e,n);var i=(t+="").replace(/ /g,"").toLowerCase();if(i in cSt)return vSt(e,cSt[i]),wSt(t,e),e;var r,o=i.length;if("#"===i.charAt(0))return 4===o||5===o?(r=parseInt(i.slice(1,4),16))>=0&&r<=4095?(ySt(e,(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,5===o?parseInt(i.slice(4),16)/15:1),wSt(t,e),e):void ySt(e,0,0,0,1):7===o||9===o?(r=parseInt(i.slice(1,7),16))>=0&&r<=16777215?(ySt(e,(16711680&r)>>16,(65280&r)>>8,255&r,9===o?parseInt(i.slice(7),16)/255:1),wSt(t,e),e):void ySt(e,0,0,0,1):void 0;var a=i.indexOf("("),s=i.indexOf(")");if(-1!==a&&s+1===o){var l=i.substr(0,a),u=i.substr(a+1,s-(a+1)).split(","),c=1;switch(l){case"rgba":if(4!==u.length)return 3===u.length?ySt(e,+u[0],+u[1],+u[2],1):ySt(e,0,0,0,1);c=fSt(u.pop());case"rgb":return 3!==u.length?void ySt(e,0,0,0,1):(ySt(e,pSt(u[0]),pSt(u[1]),pSt(u[2]),c),wSt(t,e),e);case"hsla":return 4!==u.length?void ySt(e,0,0,0,1):(u[3]=fSt(u[3]),kSt(u,e),wSt(t,e),e);case"hsl":return 3!==u.length?void ySt(e,0,0,0,1):(kSt(u,e),wSt(t,e),e);default:return}}ySt(e,0,0,0,1)}}function kSt(t,e){var n=(parseFloat(t[0])%360+360)%360/360,i=fSt(t[1]),r=fSt(t[2]),o=r<=.5?r*(i+1):r+i-r*i,a=2*r-o;return ySt(e=e||[],hSt(255*gSt(a,o,n+1/3)),hSt(255*gSt(a,o,n)),hSt(255*gSt(a,o,n-1/3)),1),4===t.length&&(e[3]=t[3]),e}function SSt(t,e){var n=_St(t);if(n){for(var i=0;i<3;i++)n[i]=e<0?n[i]*(1-e)|0:(255-n[i])*e+n[i]|0,n[i]>255?n[i]=255:n[i]<0&&(n[i]=0);return DSt(n,4===n.length?"rgba":"rgb")}}function CSt(t){var e=_St(t);if(e)return((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1)}function ASt(t,e,n){if(e&&e.length&&t>=0&&t<=1){n=n||[];var i=t*(e.length-1),r=Math.floor(i),o=Math.ceil(i),a=e[r],s=e[o],l=i-r;return n[0]=hSt(mSt(a[0],s[0],l)),n[1]=hSt(mSt(a[1],s[1],l)),n[2]=hSt(mSt(a[2],s[2],l)),n[3]=dSt(mSt(a[3],s[3],l)),n}}function ISt(t,e,n,i){var r=_St(t);if(t)return r=function(t){if(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,a=Math.min(i,r,o),s=Math.max(i,r,o),l=s-a,u=(s+a)/2;if(0===l)e=0,n=0;else{n=u<.5?l/(s+a):l/(2-s-a);var c=((s-i)/6+l/2)/l,h=((s-r)/6+l/2)/l,d=((s-o)/6+l/2)/l;i===s?e=d-h:r===s?e=1/3+c-d:o===s&&(e=2/3+h-c),e<0&&(e+=1),e>1&&(e-=1)}var p=[360*e,n,u];return null!=t[3]&&p.push(t[3]),p}}(r),null!=e&&(r[0]=function(t){return(t=Math.round(t))<0?0:t>360?360:t}(e)),null!=n&&(r[1]=fSt(n)),null!=i&&(r[2]=fSt(i)),DSt(kSt(r),"rgba")}function MSt(t,e){var n=_St(t);if(n&&null!=e)return n[3]=dSt(e),DSt(n,"rgba")}function DSt(t,e){if(t&&t.length){var n=t[0]+","+t[1]+","+t[2];return"rgba"!==e&&"hsva"!==e&&"hsla"!==e||(n+=","+t[3]),e+"("+n+")"}}function TSt(t,e){var n=_St(t);return n?(.299*n[0]+.587*n[1]+.114*n[2])*n[3]/255+(1-n[3])*e:0}var ESt=Array.prototype.slice;function NSt(t,e,n){return(e-t)*n+t}function OSt(t,e,n,i){for(var r=e.length,o=0;o<r;o++)t[o]=NSt(e[o],n[o],i)}function FSt(t,e,n,i){for(var r=e.length,o=0;o<r;o++)t[o]=e[o]+n[o]*i;return t}function RSt(t,e,n,i){for(var r=e.length,o=r&&e[0].length,a=0;a<r;a++){t[a]||(t[a]=[]);for(var s=0;s<o;s++)t[a][s]=e[a][s]+n[a][s]*i}return t}function LSt(t,e,n){var i=t,r=e;if(i.push&&r.push){var o=i.length,a=r.length;if(o!==a)if(o>a)i.length=a;else for(var s=o;s<a;s++)i.push(1===n?r[s]:ESt.call(r[s]));var l=i[0]&&i[0].length;for(s=0;s<i.length;s++)if(1===n)isNaN(i[s])&&(i[s]=r[s]);else for(var u=0;u<l;u++)isNaN(i[s][u])&&(i[s][u]=r[s][u])}}function $St(t,e){var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function PSt(t,e,n,i,r,o,a){var s=.5*(n-t),l=.5*(i-e);return(2*(e-n)+s+l)*a+(-3*(e-n)-2*s-l)*o+s*r+e}function zSt(t,e,n,i,r,o,a,s){for(var l=e.length,u=0;u<l;u++)t[u]=PSt(e[u],n[u],i[u],r[u],o,a,s)}function BSt(t){if(k_t(t)){var e=t.length;if(k_t(t[0])){for(var n=[],i=0;i<e;i++)n.push(ESt.call(t[i]));return n}return ESt.call(t)}return t}function VSt(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}var WSt,jSt,USt=[0,0,0,0],GSt=function(){function t(t){this.keyframes=[],this.maxTime=0,this.arrDim=0,this.interpolable=!0,this._needsSort=!1,this._isAllValueEqual=!0,this._lastFrame=0,this._lastFramePercent=0,this.propName=t}return t.prototype.isFinished=function(){return this._finished},t.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},t.prototype.needsAnimate=function(){return!this._isAllValueEqual&&this.keyframes.length>=2&&this.interpolable},t.prototype.getAdditiveTrack=function(){return this._additiveTrack},t.prototype.addKeyframe=function(t,e){t>=this.maxTime?this.maxTime=t:this._needsSort=!0;var n=this.keyframes,i=n.length;if(this.interpolable)if(k_t(e)){var r=function(t){return k_t(t&&t[0])?2:1}(e);if(i>0&&this.arrDim!==r)return void(this.interpolable=!1);if(1===r&&"number"!=typeof e[0]||2===r&&"number"!=typeof e[0][0])return void(this.interpolable=!1);if(i>0){var o=n[i-1];this._isAllValueEqual&&(1===r&&$St(e,o.value)||(this._isAllValueEqual=!1))}this.arrDim=r}else{if(this.arrDim>0)return void(this.interpolable=!1);if("string"==typeof e){var a=_St(e);a?(e=a,this.isValueColor=!0):this.interpolable=!1}else if("number"!=typeof e||isNaN(e))return void(this.interpolable=!1);if(this._isAllValueEqual&&i>0){o=n[i-1];(this.isValueColor&&!$St(o.value,e)||o.value!==e)&&(this._isAllValueEqual=!1)}}var s={time:t,value:e,percent:0};return this.keyframes.push(s),s},t.prototype.prepare=function(t){var e=this.keyframes;this._needsSort&&e.sort((function(t,e){return t.time-e.time}));for(var n=this.arrDim,i=e.length,r=e[i-1],o=0;o<i;o++)e[o].percent=e[o].time/this.maxTime,n>0&&o!==i-1&&LSt(e[o].value,r.value,n);if(t&&this.needsAnimate()&&t.needsAnimate()&&n===t.arrDim&&this.isValueColor===t.isValueColor&&!t._finished){this._additiveTrack=t;var a=e[0].value;for(o=0;o<i;o++)0===n?this.isValueColor?e[o].additiveValue=FSt([],e[o].value,a,-1):e[o].additiveValue=e[o].value-a:1===n?e[o].additiveValue=FSt([],e[o].value,a,-1):2===n&&(e[o].additiveValue=RSt([],e[o].value,a,-1))}},t.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var n,i=null!=this._additiveTrack,r=i?"additiveValue":"value",o=this.keyframes,a=this.keyframes.length,s=this.propName,l=this.arrDim,u=this.isValueColor;if(e<0)n=0;else if(e<this._lastFramePercent){for(n=Math.min(this._lastFrame+1,a-1);n>=0&&!(o[n].percent<=e);n--);n=Math.min(n,a-2)}else{for(n=this._lastFrame;n<a&&!(o[n].percent>e);n++);n=Math.min(n-1,a-2)}var c=o[n+1],h=o[n];if(h&&c){this._lastFrame=n,this._lastFramePercent=e;var d=c.percent-h.percent;if(0!==d){var p=(e-h.percent)/d,f=i?this._additiveValue:u?USt:t[s];if((l>0||u)&&!f&&(f=this._additiveValue=[]),this.useSpline){var g=o[n][r],m=o[0===n?n:n-1][r],y=o[n>a-2?a-1:n+1][r],v=o[n>a-3?a-1:n+2][r];if(l>0)1===l?zSt(f,m,g,y,v,p,p*p,p*p*p):function(t,e,n,i,r,o,a,s){for(var l=e.length,u=e[0].length,c=0;c<l;c++){t[c]||(t[1]=[]);for(var h=0;h<u;h++)t[c][h]=PSt(e[c][h],n[c][h],i[c][h],r[c][h],o,a,s)}}(f,m,g,y,v,p,p*p,p*p*p);else if(u)zSt(f,m,g,y,v,p,p*p,p*p*p),i||(t[s]=VSt(f));else{var x=void 0;x=this.interpolable?PSt(m,g,y,v,p,p*p,p*p*p):y,i?this._additiveValue=x:t[s]=x}}else if(l>0)1===l?OSt(f,h[r],c[r],p):function(t,e,n,i){for(var r=e.length,o=r&&e[0].length,a=0;a<r;a++){t[a]||(t[a]=[]);for(var s=0;s<o;s++)t[a][s]=NSt(e[a][s],n[a][s],i)}}(f,h[r],c[r],p);else if(u)OSt(f,h[r],c[r],p),i||(t[s]=VSt(f));else{x=void 0;x=this.interpolable?NSt(h[r],c[r],p):function(t,e,n){return n>.5?e:t}(h[r],c[r],p),i?this._additiveValue=x:t[s]=x}i&&this._addToTarget(t)}}}},t.prototype._addToTarget=function(t){var e=this.arrDim,n=this.propName,i=this._additiveValue;0===e?this.isValueColor?(_St(t[n],USt),FSt(USt,USt,i,1),t[n]=VSt(USt)):t[n]=t[n]+i:1===e?FSt(t[n],t[n],i,1):2===e&&RSt(t[n],t[n],i,1)},t}(),HSt=function(){function t(t,e,n){this._tracks={},this._trackKeys=[],this._delay=0,this._maxTime=0,this._paused=!1,this._started=0,this._clip=null,this._target=t,this._loop=e,e&&n?f_t("Can' use additive animation on looped animation."):this._additiveAnimators=n}return t.prototype.getTarget=function(){return this._target},t.prototype.changeTarget=function(t){this._target=t},t.prototype.when=function(t,e){return this.whenWithKeys(t,e,M_t(e))},t.prototype.whenWithKeys=function(t,e,n){for(var i=this._tracks,r=0;r<n.length;r++){var o=n[r],a=i[o];if(!a){a=i[o]=new GSt(o);var s=void 0,l=this._getAdditiveTrack(o);if(l){var u=l.keyframes[l.keyframes.length-1];s=u&&u.value,l.isValueColor&&s&&(s=VSt(s))}else s=this._target[o];if(null==s)continue;0!==t&&a.addKeyframe(0,BSt(s)),this._trackKeys.push(o)}a.addKeyframe(t,BSt(e[o]))}return this._maxTime=Math.max(this._maxTime,t),this},t.prototype.pause=function(){this._clip.pause(),this._paused=!0},t.prototype.resume=function(){this._clip.resume(),this._paused=!1},t.prototype.isPaused=function(){return!!this._paused},t.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneList;if(t)for(var e=t.length,n=0;n<e;n++)t[n].call(this)},t.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedList;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var n=0;n<e.length;n++)e[n].call(this)},t.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,n=0;n<e.length;n++)t[e[n]].setFinished()},t.prototype._getAdditiveTrack=function(t){var e,n=this._additiveAnimators;if(n)for(var i=0;i<n.length;i++){var r=n[i].getTrack(t);r&&(e=r)}return e},t.prototype.start=function(t,e){if(!(this._started>0)){this._started=1;for(var n=this,i=[],r=0;r<this._trackKeys.length;r++){var o=this._trackKeys[r],a=this._tracks[o],s=this._getAdditiveTrack(o),l=a.keyframes;if(a.prepare(s),a.needsAnimate())i.push(a);else if(!a.interpolable){var u=l[l.length-1];u&&(n._target[a.propName]=u.value)}}if(i.length||e){var c=new aSt({life:this._maxTime,loop:this._loop,delay:this._delay,onframe:function(t){n._started=2;var e=n._additiveAnimators;if(e){for(var r=!1,o=0;o<e.length;o++)if(e[o]._clip){r=!0;break}r||(n._additiveAnimators=null)}for(o=0;o<i.length;o++)i[o].step(n._target,t);var a=n._onframeList;if(a)for(o=0;o<a.length;o++)a[o](n._target,t)},ondestroy:function(){n._doneCallback()}});this._clip=c,this.animation&&this.animation.addClip(c),t&&"spline"!==t&&(c.easing=t)}else this._doneCallback();return this}},t.prototype.stop=function(t){if(this._clip){var e=this._clip;t&&e.onframe(1),this._abortedCallback()}},t.prototype.delay=function(t){return this._delay=t,this},t.prototype.during=function(t){return t&&(this._onframeList||(this._onframeList=[]),this._onframeList.push(t)),this},t.prototype.done=function(t){return t&&(this._doneList||(this._doneList=[]),this._doneList.push(t)),this},t.prototype.aborted=function(t){return t&&(this._abortedList||(this._abortedList=[]),this._abortedList.push(t)),this},t.prototype.getClip=function(){return this._clip},t.prototype.getTrack=function(t){return this._tracks[t]},t.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var n=this._tracks,i=this._trackKeys,r=0;r<t.length;r++){var o=n[t[r]];o&&(e?o.step(this._target,1):1===this._started&&o.step(this._target,0),o.setFinished())}var a=!0;for(r=0;r<i.length;r++)if(!n[i[r]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},t.prototype.saveFinalToTarget=function(t,e){if(t){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var i=e[n],r=this._tracks[i];if(r&&!r.isFinished()){var o=r.keyframes,a=o[o.length-1];if(a){var s=BSt(a.value);r.isValueColor&&(s=VSt(s)),t[i]=s}}}}},t.prototype.__changeFinalValue=function(t,e){e=e||M_t(t);for(var n=0;n<e.length;n++){var i=e[n],r=this._tracks[i];if(r){var o=r.keyframes;if(o.length>1){var a=o.pop();r.addKeyframe(a.time,t[i]),r.prepare(r.getAdditiveTrack())}}}},t}(),qSt=function(t){function e(e){var n=t.call(this)||this;return n._running=!1,n._time=0,n._pausedTime=0,n._pauseStart=0,n._paused=!1,e=e||{},n.stage=e.stage||{},n.onframe=e.onframe||function(){},n}return Dit(e,t),e.prototype.addClip=function(t){t.animation&&this.removeClip(t),this._clipsHead?(this._clipsTail.next=t,t.prev=this._clipsTail,t.next=null,this._clipsTail=t):this._clipsHead=this._clipsTail=t,t.animation=this},e.prototype.addAnimator=function(t){t.animation=this;var e=t.getClip();e&&this.addClip(e)},e.prototype.removeClip=function(t){if(t.animation){var e=t.prev,n=t.next;e?e.next=n:this._clipsHead=n,n?n.prev=e:this._clipsTail=e,t.next=t.prev=t.animation=null}},e.prototype.removeAnimator=function(t){var e=t.getClip();e&&this.removeClip(e),t.animation=null},e.prototype.update=function(t){for(var e=(new Date).getTime()-this._pausedTime,n=e-this._time,i=this._clipsHead;i;){var r=i.next;i.step(e,n)?(i.ondestroy&&i.ondestroy(),this.removeClip(i),i=r):i=r}this._time=e,t||(this.onframe(n),this.trigger("frame",n),this.stage.update&&this.stage.update())},e.prototype._startLoop=function(){var t=this;this._running=!0,rSt((function e(){t._running&&(rSt(e),!t._paused&&t.update())}))},e.prototype.start=function(){this._running||(this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop())},e.prototype.stop=function(){this._running=!1},e.prototype.pause=function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},e.prototype.clear=function(){for(var t=this._clipsHead;t;){var e=t.next;t.prev=t.next=t.animation=null,t=e}this._clipsHead=this._clipsTail=null},e.prototype.isFinished=function(){return null==this._clipsHead},e.prototype.animate=function(t,e){e=e||{},this.start();var n=new HSt(t,e.loop);return this.addAnimator(n),n},e}(bkt),XSt=t_t.domSupported,YSt=(jSt={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},{mouse:WSt=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],touch:["touchstart","touchend","touchmove"],pointer:C_t(WSt,(function(t){var e=t.replace("mouse","pointer");return jSt.hasOwnProperty(e)?e:t}))}),KSt=["mousemove","mouseup"],ZSt=["pointermove","pointerup"],JSt=!1;function QSt(t){var e=t.pointerType;return"pen"===e||"touch"===e}function tCt(t){t&&(t.zrByTouch=!0)}function eCt(t,e){for(var n=e,i=!1;n&&9!==n.nodeType&&!(i=n.domBelongToZr||n!==e&&n===t.painterRoot);)n=n.parentNode;return i}var nCt=function(t,e){this.stopPropagation=ekt,this.stopImmediatePropagation=ekt,this.preventDefault=ekt,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY},iCt={mousedown:function(t){t=Okt(this.dom,t),this.__mayPointerCapture=[t.zrX,t.zrY],this.trigger("mousedown",t)},mousemove:function(t){t=Okt(this.dom,t);var e=this.__mayPointerCapture;!e||t.zrX===e[0]&&t.zrY===e[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",t)},mouseup:function(t){t=Okt(this.dom,t),this.__togglePointerCapture(!1),this.trigger("mouseup",t)},mouseout:function(t){eCt(this,(t=Okt(this.dom,t)).toElement||t.relatedTarget)||(this.__pointerCapturing&&(t.zrEventControl="no_globalout"),this.trigger("mouseout",t))},wheel:function(t){JSt=!0,t=Okt(this.dom,t),this.trigger("mousewheel",t)},mousewheel:function(t){JSt||(t=Okt(this.dom,t),this.trigger("mousewheel",t))},touchstart:function(t){tCt(t=Okt(this.dom,t)),this.__lastTouchMoment=new Date,this.handler.processGesture(t,"start"),iCt.mousemove.call(this,t),iCt.mousedown.call(this,t)},touchmove:function(t){tCt(t=Okt(this.dom,t)),this.handler.processGesture(t,"change"),iCt.mousemove.call(this,t)},touchend:function(t){tCt(t=Okt(this.dom,t)),this.handler.processGesture(t,"end"),iCt.mouseup.call(this,t),+new Date-+this.__lastTouchMoment<300&&iCt.click.call(this,t)},pointerdown:function(t){iCt.mousedown.call(this,t)},pointermove:function(t){QSt(t)||iCt.mousemove.call(this,t)},pointerup:function(t){iCt.mouseup.call(this,t)},pointerout:function(t){QSt(t)||iCt.mouseout.call(this,t)}};S_t(["click","dblclick","contextmenu"],(function(t){iCt[t]=function(e){e=Okt(this.dom,e),this.trigger(t,e)}}));var rCt={pointermove:function(t){QSt(t)||rCt.mousemove.call(this,t)},pointerup:function(t){rCt.mouseup.call(this,t)},mousemove:function(t){this.trigger("mousemove",t)},mouseup:function(t){var e=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",t),e&&(t.zrEventControl="only_globalout",this.trigger("mouseout",t))}};function oCt(t,e){var n=e.domHandlers;t_t.pointerEventsSupported?S_t(YSt.pointer,(function(i){sCt(e,i,(function(e){n[i].call(t,e)}))})):(t_t.touchEventsSupported&&S_t(YSt.touch,(function(i){sCt(e,i,(function(r){n[i].call(t,r),function(t){t.touching=!0,null!=t.touchTimer&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout((function(){t.touching=!1,t.touchTimer=null}),700)}(e)}))})),S_t(YSt.mouse,(function(i){sCt(e,i,(function(r){r=Nkt(r),e.touching||n[i].call(t,r)}))})))}function aCt(t,e){function n(n){sCt(e,n,(function(i){i=Nkt(i),eCt(t,i.target)||(i=function(t,e){return Okt(t.dom,new nCt(t,e),!0)}(t,i),e.domHandlers[n].call(t,i))}),{capture:!0})}t_t.pointerEventsSupported?S_t(ZSt,n):t_t.touchEventsSupported||S_t(KSt,n)}function sCt(t,e,n,i){t.mounted[e]=n,t.listenerOpts[e]=i,Fkt(t.domTarget,e,n,i)}function lCt(t){var e=t.mounted;for(var n in e)e.hasOwnProperty(n)&&Rkt(t.domTarget,n,e[n],t.listenerOpts[n]);t.mounted={}}var uCt=function(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e},cCt=function(t){function e(e,n){var i=t.call(this)||this;return i.__pointerCapturing=!1,i.dom=e,i.painterRoot=n,i._localHandlerScope=new uCt(e,iCt),XSt&&(i._globalHandlerScope=new uCt(document,rCt)),oCt(i,i._localHandlerScope),i}return Dit(e,t),e.prototype.dispose=function(){lCt(this._localHandlerScope),XSt&&lCt(this._globalHandlerScope)},e.prototype.setCursor=function(t){this.dom.style&&(this.dom.style.cursor=t||"default")},e.prototype.__togglePointerCapture=function(t){if(this.__mayPointerCapture=null,XSt&&+this.__pointerCapturing^+t){this.__pointerCapturing=t;var e=this._globalHandlerScope;t?aCt(this,e):lCt(e)}},e}(bkt),hCt=1;"undefined"!=typeof window&&(hCt=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var dCt=hCt;function pCt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function fCt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function gCt(t,e,n){var i=e[0]*n[0]+e[2]*n[1],r=e[1]*n[0]+e[3]*n[1],o=e[0]*n[2]+e[2]*n[3],a=e[1]*n[2]+e[3]*n[3],s=e[0]*n[4]+e[2]*n[5]+e[4],l=e[1]*n[4]+e[3]*n[5]+e[5];return t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t}function mCt(t,e,n){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+n[0],t[5]=e[5]+n[1],t}function yCt(t,e,n){var i=e[0],r=e[2],o=e[4],a=e[1],s=e[3],l=e[5],u=Math.sin(n),c=Math.cos(n);return t[0]=i*c+a*u,t[1]=-i*u+a*c,t[2]=r*c+s*u,t[3]=-r*u+c*s,t[4]=c*o+u*l,t[5]=c*l-u*o,t}function vCt(t,e,n){var i=n[0],r=n[1];return t[0]=e[0]*i,t[1]=e[1]*r,t[2]=e[2]*i,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*r,t}function xCt(t,e){var n=e[0],i=e[2],r=e[4],o=e[1],a=e[3],s=e[5],l=n*a-o*i;return l?(l=1/l,t[0]=a*l,t[1]=-o*l,t[2]=-i*l,t[3]=n*l,t[4]=(i*s-a*r)*l,t[5]=(o*r-n*s)*l,t):null}var bCt=pCt;function wCt(t){return t>5e-5||t<-5e-5}var _Ct,kCt,SCt=[],CCt=[],ACt=[1,0,0,1,0,0],ICt=Math.abs,MCt=function(){function t(){}var e;return t.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},t.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},t.prototype.setSkew=function(t){this.skewX=t[0],this.skewY=t[1]},t.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},t.prototype.needLocalTransform=function(){return wCt(this.rotation)||wCt(this.x)||wCt(this.y)||wCt(this.scaleX-1)||wCt(this.scaleY-1)},t.prototype.updateTransform=function(){var t=this.parent,e=t&&t.transform,n=this.needLocalTransform(),i=this.transform;n||e?(i=i||[1,0,0,1,0,0],n?this.getLocalTransform(i):bCt(i),e&&(n?gCt(i,t.transform,i):fCt(i,t.transform)),this.transform=i,this._resolveGlobalScaleRatio(i)):i&&bCt(i)},t.prototype._resolveGlobalScaleRatio=function(t){var e=this.globalScaleRatio;if(null!=e&&1!==e){this.getGlobalScale(SCt);var n=SCt[0]<0?-1:1,i=SCt[1]<0?-1:1,r=((SCt[0]-n)*e+n)/SCt[0]||0,o=((SCt[1]-i)*e+i)/SCt[1]||0;t[0]*=r,t[1]*=r,t[2]*=o,t[3]*=o}this.invTransform=this.invTransform||[1,0,0,1,0,0],xCt(this.invTransform,t)},t.prototype.getLocalTransform=function(e){return t.getLocalTransform(this,e)},t.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},t.prototype.setLocalTransform=function(t){if(t){var e=t[0]*t[0]+t[1]*t[1],n=t[2]*t[2]+t[3]*t[3],i=Math.atan2(t[1],t[0]),r=Math.PI/2+i-Math.atan2(t[3],t[2]);n=Math.sqrt(n)*Math.cos(r),e=Math.sqrt(e),this.skewX=r,this.skewY=0,this.rotation=-i,this.x=+t[4],this.y=+t[5],this.scaleX=e,this.scaleY=n,this.originX=0,this.originY=0}},t.prototype.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(gCt(CCt,t.invTransform,e),e=CCt);var n=this.originX,i=this.originY;(n||i)&&(ACt[4]=n,ACt[5]=i,gCt(CCt,e,ACt),CCt[4]-=n,CCt[5]-=i,e=CCt),this.setLocalTransform(e)}},t.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1]),t):(t[0]=1,t[1]=1,t)},t.prototype.transformCoordToLocal=function(t,e){var n=[t,e],i=this.invTransform;return i&&gkt(n,n,i),n},t.prototype.transformCoordToGlobal=function(t,e){var n=[t,e],i=this.transform;return i&&gkt(n,n,i),n},t.prototype.getLineScale=function(){var t=this.transform;return t&&ICt(t[0]-1)>1e-10&&ICt(t[3]-1)>1e-10?Math.sqrt(ICt(t[0]*t[3]-t[2]*t[1])):1},t.getLocalTransform=function(t,e){e=e||[];var n=t.originX||0,i=t.originY||0,r=t.scaleX,o=t.scaleY,a=t.rotation||0,s=t.x,l=t.y,u=t.skewX?Math.tan(t.skewX):0,c=t.skewY?Math.tan(-t.skewY):0;return n||i?(e[4]=-n*r-u*i*o,e[5]=-i*o-c*n*r):e[4]=e[5]=0,e[0]=r,e[3]=o,e[1]=c*r,e[2]=u*o,a&&yCt(e,e,a),e[4]+=n+s,e[5]+=i+l,e},t.initDefaultProps=((e=t.prototype).x=0,e.y=0,e.scaleX=1,e.scaleY=1,e.originX=0,e.originY=0,e.skewX=0,e.skewY=0,e.rotation=0,void(e.globalScaleRatio=1)),t}(),DCt=function(){function t(t,e){this.x=t||0,this.y=e||0}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.scale=function(t){this.x*=t,this.y*=t},t.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},t.prototype.distanceSquare=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.transform=function(t){if(t){var e=this.x,n=this.y;return this.x=t[0]*e+t[2]*n+t[4],this.y=t[1]*e+t[3]*n+t[5],this}},t.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},t.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},t.set=function(t,e,n){t.x=e,t.y=n},t.copy=function(t,e){t.x=e.x,t.y=e.y},t.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.lenSquare=function(t){return t.x*t.x+t.y*t.y},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.add=function(t,e,n){t.x=e.x+n.x,t.y=e.y+n.y},t.sub=function(t,e,n){t.x=e.x-n.x,t.y=e.y-n.y},t.scale=function(t,e,n){t.x=e.x*n,t.y=e.y*n},t.scaleAndAdd=function(t,e,n,i){t.x=e.x+n.x*i,t.y=e.y+n.y*i},t.lerp=function(t,e,n,i){var r=1-i;t.x=r*e.x+i*n.x,t.y=r*e.y+i*n.y},t}(),TCt=Math.min,ECt=Math.max,NCt=new DCt,OCt=new DCt,FCt=new DCt,RCt=new DCt,LCt=new DCt,$Ct=new DCt,PCt=function(){function t(t,e,n,i){n<0&&(t+=n,n=-n),i<0&&(e+=i,i=-i),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.union=function(t){var e=TCt(t.x,this.x),n=TCt(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=ECt(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=ECt(t.y+t.height,this.y+this.height)-n:this.height=t.height,this.x=e,this.y=n},t.prototype.applyTransform=function(e){t.applyTransform(this,this,e)},t.prototype.calculateTransform=function(t){var e=this,n=t.width/e.width,i=t.height/e.height,r=[1,0,0,1,0,0];return mCt(r,r,[-e.x,-e.y]),vCt(r,r,[n,i]),mCt(r,r,[t.x,t.y]),r},t.prototype.intersect=function(e,n){if(!e)return!1;e instanceof t||(e=t.create(e));var i=this,r=i.x,o=i.x+i.width,a=i.y,s=i.y+i.height,l=e.x,u=e.x+e.width,c=e.y,h=e.y+e.height,d=!(o<l||u<r||s<c||h<a);if(n){var p=1/0,f=0,g=Math.abs(o-l),m=Math.abs(u-r),y=Math.abs(s-c),v=Math.abs(h-a),x=Math.min(g,m),b=Math.min(y,v);o<l||u<r?x>f&&(f=x,g<m?DCt.set($Ct,-g,0):DCt.set($Ct,m,0)):x<p&&(p=x,g<m?DCt.set(LCt,g,0):DCt.set(LCt,-m,0)),s<c||h<a?b>f&&(f=b,y<v?DCt.set($Ct,0,-y):DCt.set($Ct,0,v)):x<p&&(p=x,y<v?DCt.set(LCt,0,y):DCt.set(LCt,0,-v))}return n&&DCt.copy(n,d?LCt:$Ct),d},t.prototype.contain=function(t,e){var n=this;return t>=n.x&&t<=n.x+n.width&&e>=n.y&&e<=n.y+n.height},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(e){t.copy(this,e)},t.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},t.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},t.prototype.isZero=function(){return 0===this.width||0===this.height},t.create=function(e){return new t(e.x,e.y,e.width,e.height)},t.copy=function(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},t.applyTransform=function(e,n,i){if(i){if(i[1]<1e-5&&i[1]>-1e-5&&i[2]<1e-5&&i[2]>-1e-5){var r=i[0],o=i[3],a=i[4],s=i[5];return e.x=n.x*r+a,e.y=n.y*o+s,e.width=n.width*r,e.height=n.height*o,e.width<0&&(e.x+=e.width,e.width=-e.width),void(e.height<0&&(e.y+=e.height,e.height=-e.height))}NCt.x=FCt.x=n.x,NCt.y=RCt.y=n.y,OCt.x=RCt.x=n.x+n.width,OCt.y=FCt.y=n.y+n.height,NCt.transform(i),RCt.transform(i),OCt.transform(i),FCt.transform(i),e.x=TCt(NCt.x,OCt.x,FCt.x,RCt.x),e.y=TCt(NCt.y,OCt.y,FCt.y,RCt.y);var l=ECt(NCt.x,OCt.x,FCt.x,RCt.x),u=ECt(NCt.y,OCt.y,FCt.y,RCt.y);e.width=l-e.x,e.height=u-e.y}else e!==n&&t.copy(e,n)},t}(),zCt={},BCt="12px sans-serif";var VCt={measureText:function(t,e){return _Ct||(_Ct=b_t().getContext("2d")),kCt!==e&&(kCt=_Ct.font=e||BCt),_Ct.measureText(t)}};function WCt(t,e){var n=zCt[e=e||BCt];n||(n=zCt[e]=new uSt(500));var i=n.get(t);return null==i&&(i=VCt.measureText(t,e).width,n.put(t,i)),i}function jCt(t,e,n,i){var r=WCt(t,e),o=qCt(e),a=GCt(0,r,n),s=HCt(0,o,i);return new PCt(a,s,r,o)}function UCt(t,e,n,i){var r=((t||"")+"").split("\n");if(1===r.length)return jCt(r[0],e,n,i);for(var o=new PCt(0,0,0,0),a=0;a<r.length;a++){var s=jCt(r[a],e,n,i);0===a?o.copy(s):o.union(s)}return o}function GCt(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function HCt(t,e,n){return"middle"===n?t-=e/2:"bottom"===n&&(t-=e),t}function qCt(t){return WCt("国",t)}function XCt(t,e){return"string"==typeof t?t.lastIndexOf("%")>=0?parseFloat(t)/100*e:parseFloat(t):t}function YCt(t,e,n){var i=e.position||"inside",r=null!=e.distance?e.distance:5,o=n.height,a=n.width,s=o/2,l=n.x,u=n.y,c="left",h="top";if(i instanceof Array)l+=XCt(i[0],n.width),u+=XCt(i[1],n.height),c=null,h=null;else switch(i){case"left":l-=r,u+=s,c="right",h="middle";break;case"right":l+=r+a,u+=s,h="middle";break;case"top":l+=a/2,u-=r,c="center",h="bottom";break;case"bottom":l+=a/2,u+=o+r,c="center";break;case"inside":l+=a/2,u+=s,c="center",h="middle";break;case"insideLeft":l+=r,u+=s,h="middle";break;case"insideRight":l+=a-r,u+=s,c="right",h="middle";break;case"insideTop":l+=a/2,u+=r,c="center";break;case"insideBottom":l+=a/2,u+=o-r,c="center",h="bottom";break;case"insideTopLeft":l+=r,u+=r;break;case"insideTopRight":l+=a-r,u+=r,c="right";break;case"insideBottomLeft":l+=r,u+=o-r,h="bottom";break;case"insideBottomRight":l+=a-r,u+=o-r,c="right",h="bottom"}return(t=t||{}).x=l,t.y=u,t.align=c,t.verticalAlign=h,t}var KCt=["x","y","scaleX","scaleY","originX","originY","rotation","ignore"],ZCt={x:!0,y:!0,scaleX:!0,scaleY:!0,originX:!0,originY:!0,rotation:!0,ignore:!1},JCt={},QCt=new PCt(0,0,0,0),tAt=function(){function t(t){this.id=p_t(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return t.prototype._init=function(t){this.attr(t)},t.prototype.drift=function(t,e,n){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0}var i=this.transform;i||(i=this.transform=[1,0,0,1,0,0]),i[4]+=t,i[5]+=e,this.decomposeTransform(),this.markRedraw()},t.prototype.beforeUpdate=function(){},t.prototype.afterUpdate=function(){},t.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},t.prototype.updateInnerText=function(t){var e=this._textContent;if(e&&(!e.ignore||t)){this.textConfig||(this.textConfig={});var n=this.textConfig,i=n.local,r=e.attachedTransform,o=void 0,a=void 0,s=!1;r.parent=i?this:null;var l=!1;if(r.x=e.x,r.y=e.y,r.originX=e.originX,r.originY=e.originY,r.rotation=e.rotation,r.scaleX=e.scaleX,r.scaleY=e.scaleY,null!=n.position){var u=QCt;n.layoutRect?u.copy(n.layoutRect):u.copy(this.getBoundingRect()),i||u.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(JCt,n,u):YCt(JCt,n,u),r.x=JCt.x,r.y=JCt.y,o=JCt.align,a=JCt.verticalAlign;var c=n.origin;if(c&&null!=n.rotation){var h=void 0,d=void 0;"center"===c?(h=.5*u.width,d=.5*u.height):(h=XCt(c[0],u.width),d=XCt(c[1],u.height)),l=!0,r.originX=-r.x+h+(i?0:u.x),r.originY=-r.y+d+(i?0:u.y)}}null!=n.rotation&&(r.rotation=n.rotation);var p=n.offset;p&&(r.x+=p[0],r.y+=p[1],l||(r.originX=-p[0],r.originY=-p[1]));var f=null==n.inside?"string"==typeof n.position&&n.position.indexOf("inside")>=0:n.inside,g=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),m=void 0,y=void 0,v=void 0;f&&this.canBeInsideText()?(m=n.insideFill,y=n.insideStroke,null!=m&&"auto"!==m||(m=this.getInsideTextFill()),null!=y&&"auto"!==y||(y=this.getInsideTextStroke(m),v=!0)):(m=n.outsideFill,y=n.outsideStroke,null!=m&&"auto"!==m||(m=this.getOutsideFill()),null!=y&&"auto"!==y||(y=this.getOutsideStroke(m),v=!0)),(m=m||"#000")===g.fill&&y===g.stroke&&v===g.autoStroke&&o===g.align&&a===g.verticalAlign||(s=!0,g.fill=m,g.stroke=y,g.autoStroke=v,g.align=o,g.verticalAlign=a,e.setDefaultTextStyle(g)),e.__dirty|=1,s&&e.dirtyStyle(!0)}},t.prototype.canBeInsideText=function(){return!0},t.prototype.getInsideTextFill=function(){return"#fff"},t.prototype.getInsideTextStroke=function(t){return"#000"},t.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?"#ccc":"#333"},t.prototype.getOutsideStroke=function(t){var e=this.__zr&&this.__zr.getBackgroundColor(),n="string"==typeof e&&_St(e);n||(n=[255,255,255,1]);for(var i=n[3],r=this.__zr.isDarkMode(),o=0;o<3;o++)n[o]=n[o]*i+(r?0:255)*(1-i);return n[3]=1,DSt(n,"rgba")},t.prototype.traverse=function(t,e){},t.prototype.attrKV=function(t,e){"textConfig"===t?this.setTextConfig(e):"textContent"===t?this.setTextContent(e):"clipPath"===t?this.setClipPath(e):"extra"===t?(this.extra=this.extra||{},v_t(this.extra,e)):this[t]=e},t.prototype.hide=function(){this.ignore=!0,this.markRedraw()},t.prototype.show=function(){this.ignore=!1,this.markRedraw()},t.prototype.attr=function(t,e){if("string"==typeof t)this.attrKV(t,e);else if(L_t(t))for(var n=M_t(t),i=0;i<n.length;i++){var r=n[i];this.attrKV(r,t[r])}return this.markRedraw(),this},t.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,n=0;n<this.animators.length;n++){var i=this.animators[n],r=i.__fromStateTransition;if(!r||"__zr_normal__"===r){var o=i.targetName,a=o?e[o]:e;i.saveFinalToTarget(a)}}},t.prototype._innerSaveToNormal=function(t){var e=this._normalState;e||(e=this._normalState={}),t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,KCt)},t.prototype._savePrimaryToNormal=function(t,e,n){for(var i=0;i<n.length;i++){var r=n[i];null==t[r]||r in e||(e[r]=this[r])}},t.prototype.hasState=function(){return this.currentStates.length>0},t.prototype.getState=function(t){return this.states[t]},t.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},t.prototype.clearStates=function(t){this.useState("__zr_normal__",!1,t)},t.prototype.useState=function(t,e,n,i){var r="__zr_normal__"===t;if(this.hasState()||!r){var o=this.currentStates,a=this.stateTransition;if(!(w_t(o,t)>=0)||!e&&1!==o.length){var s;if(this.stateProxy&&!r&&(s=this.stateProxy(t)),s||(s=this.states&&this.states[t]),s||r){r||this.saveCurrentToNormalState(s);var l=!!(s&&s.hoverLayer||i);l&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,s,this._normalState,e,!n&&!this.__inHover&&a&&a.duration>0,a);var u=this._textContent,c=this._textGuide;return u&&u.useState(t,e,n,l),c&&c.useState(t,e,n,l),r?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!l&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=-2),s}f_t("State "+t+" not exists.")}}},t.prototype.useStates=function(t,e,n){if(t.length){var i=[],r=this.currentStates,o=t.length,a=o===r.length;if(a)for(var s=0;s<o;s++)if(t[s]!==r[s]){a=!1;break}if(a)return;for(s=0;s<o;s++){var l=t[s],u=void 0;this.stateProxy&&(u=this.stateProxy(l,t)),u||(u=this.states[l]),u&&i.push(u)}var c=i[o-1],h=!!(c&&c.hoverLayer||n);h&&this._toggleHoverLayerFlag(!0);var d=this._mergeStates(i),p=this.stateTransition;this.saveCurrentToNormalState(d),this._applyStateObj(t.join(","),d,this._normalState,!1,!e&&!this.__inHover&&p&&p.duration>0,p);var f=this._textContent,g=this._textGuide;f&&f.useStates(t,e,h),g&&g.useStates(t,e,h),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!h&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=-2)}else this.clearStates()},t.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},t.prototype.removeState=function(t){var e=w_t(this.currentStates,t);if(e>=0){var n=this.currentStates.slice();n.splice(e,1),this.useStates(n)}},t.prototype.replaceState=function(t,e,n){var i=this.currentStates.slice(),r=w_t(i,t),o=w_t(i,e)>=0;r>=0?o?i.splice(r,1):i[r]=e:n&&!o&&i.push(e),this.useStates(i)},t.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},t.prototype._mergeStates=function(t){for(var e,n={},i=0;i<t.length;i++){var r=t[i];v_t(n,r),r.textConfig&&v_t(e=e||{},r.textConfig)}return e&&(n.textConfig=e),n},t.prototype._applyStateObj=function(t,e,n,i,r,o){var a=!(e&&i);e&&e.textConfig?(this.textConfig=v_t({},i?this.textConfig:n.textConfig),v_t(this.textConfig,e.textConfig)):a&&n.textConfig&&(this.textConfig=n.textConfig);for(var s={},l=!1,u=0;u<KCt.length;u++){var c=KCt[u],h=r&&ZCt[c];e&&null!=e[c]?h?(l=!0,s[c]=e[c]):this[c]=e[c]:a&&null!=n[c]&&(h?(l=!0,s[c]=n[c]):this[c]=n[c])}if(!r)for(u=0;u<this.animators.length;u++){var d=this.animators[u],p=d.targetName;d.__changeFinalValue(p?(e||n)[p]:e||n)}l&&this._transitionState(t,s,o)},t.prototype._attachComponent=function(t){if(t.__zr&&!t.__hostTarget)throw new Error("Text element has been added to zrender.");if(t===this)throw new Error("Recursive component attachment.");var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this},t.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},t.prototype.getClipPath=function(){return this._clipPath},t.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},t.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},t.prototype.getTextContent=function(){return this._textContent},t.prototype.setTextContent=function(t){var e=this._textContent;if(e!==t){if(e&&e!==t&&this.removeTextContent(),t.__zr&&!t.__hostTarget)throw new Error("Text element has been added to zrender.");t.attachedTransform=new MCt,this._attachComponent(t),this._textContent=t,this.markRedraw()}},t.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),v_t(this.textConfig,t),this.markRedraw()},t.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},t.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.attachedTransform=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},t.prototype.getTextGuideLine=function(){return this._textGuide},t.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},t.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},t.prototype.markRedraw=function(){this.__dirty|=1;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},t.prototype.dirty=function(){this.markRedraw()},t.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,n=this._textGuide;e&&(e.__inHover=t),n&&(n.__inHover=t)},t.prototype.addSelfToZr=function(t){this.__zr=t;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.addAnimator(e[n]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)},t.prototype.removeSelfFromZr=function(t){this.__zr=null;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.removeAnimator(e[n]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)},t.prototype.animate=function(t,e){var n=t?this[t]:this;if(n){var i=new HSt(n,e);return this.addAnimator(i,t),i}f_t('Property "'+t+'" is not existed in element '+this.id)},t.prototype.addAnimator=function(t,e){var n=this.__zr,i=this;t.during((function(){i.updateDuringAnimation(e)})).done((function(){var e=i.animators,n=w_t(e,t);n>=0&&e.splice(n,1)})),this.animators.push(t),n&&n.animation.addAnimator(t),n&&n.wakeUp()},t.prototype.updateDuringAnimation=function(t){this.markRedraw()},t.prototype.stopAnimation=function(t,e){for(var n=this.animators,i=n.length,r=[],o=0;o<i;o++){var a=n[o];t&&t!==a.scope?r.push(a):a.stop(e)}return this.animators=r,this},t.prototype.animateTo=function(t,e,n){eAt(this,t,e,n)},t.prototype.animateFrom=function(t,e,n){eAt(this,t,e,n,!0)},t.prototype._transitionState=function(t,e,n,i){for(var r=eAt(this,e,n,i),o=0;o<r.length;o++)r[o].__fromStateTransition=t},t.prototype.getBoundingRect=function(){return null},t.prototype.getPaintRect=function(){return null},t.initDefaultProps=function(){var e=t.prototype;e.type="element",e.name="",e.ignore=!1,e.silent=!1,e.isGroup=!1,e.draggable=!1,e.dragging=!1,e.ignoreClip=!1,e.__inHover=!1,e.__dirty=1;var n={};function i(t,e,i){n[t+e+i]||(console.warn("DEPRECATED: '"+t+"' has been deprecated. use '"+e+"', '"+i+"' instead"),n[t+e+i]=!0)}function r(t,n,r,o){function a(t,e){Object.defineProperty(e,0,{get:function(){return t[r]},set:function(e){t[r]=e}}),Object.defineProperty(e,1,{get:function(){return t[o]},set:function(e){t[o]=e}})}Object.defineProperty(e,t,{get:function(){(i(t,r,o),this[n])||a(this,this[n]=[]);return this[n]},set:function(e){i(t,r,o),this[r]=e[0],this[o]=e[1],this[n]=e,a(this,e)}})}Object.defineProperty&&(!t_t.browser.ie||t_t.browser.version>8)&&(r("position","_legacyPos","x","y"),r("scale","_legacyScale","scaleX","scaleY"),r("origin","_legacyOrigin","originX","originY"))}(),t}();function eAt(t,e,n,i,r){var o=[];rAt(t,"",t,e,n=n||{},i,o,r);var a=o.length,s=!1,l=n.done,u=n.aborted,c=function(){s=!0,--a<=0&&(s?l&&l():u&&u())},h=function(){--a<=0&&(s?l&&l():u&&u())};a||l&&l(),o.length>0&&n.during&&o[0].during((function(t,e){n.during(e)}));for(var d=0;d<o.length;d++){var p=o[d];c&&p.done(c),h&&p.aborted(h),p.start(n.easing,n.force)}return o}function nAt(t,e,n){for(var i=0;i<n;i++)t[i]=e[i]}function iAt(t,e,n){if(k_t(e[n]))if(k_t(t[n])||(t[n]=[]),P_t(e[n])){var i=e[n].length;t[n].length!==i&&(t[n]=new e[n].constructor(i),nAt(t[n],e[n],i))}else{var r=e[n],o=t[n],a=r.length;if(k_t(r[0]))for(var s=r[0].length,l=0;l<a;l++)o[l]?nAt(o[l],r[l],s):o[l]=Array.prototype.slice.call(r[l]);else nAt(o,r,a);o.length=r.length}else t[n]=e[n]}function rAt(t,e,n,i,r,o,a,s){for(var l=[],u=[],c=M_t(i),h=r.duration,d=r.delay,p=r.additive,f=r.setToFinal,g=!L_t(o),m=0;m<c.length;m++){if(null!=n[C=c[m]]&&null!=i[C]&&(g||o[C]))if(L_t(i[C])&&!k_t(i[C])){if(e){s||(n[C]=i[C],t.updateDuringAnimation(e));continue}rAt(t,C,n[C],i[C],r,o&&o[C],a,s)}else l.push(C),u.push(C);else s||(n[C]=i[C],t.updateDuringAnimation(e),u.push(C))}var y=l.length;if(y>0||r.force&&!a.length){for(var v=t.animators,x=[],b=0;b<v.length;b++)v[b].targetName===e&&x.push(v[b]);if(!p&&x.length)for(b=0;b<x.length;b++){if(x[b].stopTracks(u)){var w=w_t(v,x[b]);v.splice(w,1)}}var _=void 0,k=void 0,S=void 0;if(s){k={},f&&(_={});for(b=0;b<y;b++){k[C=l[b]]=n[C],f?_[C]=i[C]:n[C]=i[C]}}else if(f){S={};for(b=0;b<y;b++){var C;S[C=l[b]]=BSt(n[C]),iAt(n,i,C)}}var A=new HSt(n,!1,p?x:null);A.targetName=e,r.scope&&(A.scope=r.scope),f&&_&&A.whenWithKeys(0,_,l),S&&A.whenWithKeys(0,S,l),A.whenWithKeys(null==h?500:h,s?k:i,l).delay(d||0),t.addAnimator(A,e),a.push(A)}}__t(tAt,bkt),__t(tAt,MCt);var oAt=function(t){function e(e){var n=t.call(this)||this;return n.isGroup=!0,n._children=[],n.attr(e),n}return Dit(e,t),e.prototype.childrenRef=function(){return this._children},e.prototype.children=function(){return this._children.slice()},e.prototype.childAt=function(t){return this._children[t]},e.prototype.childOfName=function(t){for(var e=this._children,n=0;n<e.length;n++)if(e[n].name===t)return e[n]},e.prototype.childCount=function(){return this._children.length},e.prototype.add=function(t){if(t&&(t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),t.__hostTarget))throw"This elemenet has been used as an attachment";return this},e.prototype.addBefore=function(t,e){if(t&&t!==this&&t.parent!==this&&e&&e.parent===this){var n=this._children,i=n.indexOf(e);i>=0&&(n.splice(i,0,t),this._doAdd(t))}return this},e.prototype.replaceAt=function(t,e){var n=this._children,i=n[e];if(t&&t!==this&&t.parent!==this&&t!==i){n[e]=t,i.parent=null;var r=this.__zr;r&&i.removeSelfFromZr(r),this._doAdd(t)}return this},e.prototype._doAdd=function(t){t.parent&&t.parent.remove(t),t.parent=this;var e=this.__zr;e&&e!==t.__zr&&t.addSelfToZr(e),e&&e.refresh()},e.prototype.remove=function(t){var e=this.__zr,n=this._children,i=w_t(n,t);return i<0||(n.splice(i,1),t.parent=null,e&&t.removeSelfFromZr(e),e&&e.refresh()),this},e.prototype.removeAll=function(){for(var t=this._children,e=this.__zr,n=0;n<t.length;n++){var i=t[n];e&&i.removeSelfFromZr(e),i.parent=null}return t.length=0,this},e.prototype.eachChild=function(t,e){for(var n=this._children,i=0;i<n.length;i++){var r=n[i];t.call(e,r,i)}return this},e.prototype.traverse=function(t,e){for(var n=0;n<this._children.length;n++){var i=this._children[n],r=t.call(e,i);i.isGroup&&!r&&i.traverse(t,e)}return this},e.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var n=0;n<this._children.length;n++){this._children[n].addSelfToZr(e)}},e.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var n=0;n<this._children.length;n++){this._children[n].removeSelfFromZr(e)}},e.prototype.getBoundingRect=function(t){for(var e=new PCt(0,0,0,0),n=t||this._children,i=[],r=null,o=0;o<n.length;o++){var a=n[o];if(!a.ignore&&!a.invisible){var s=a.getBoundingRect(),l=a.getLocalTransform(i);l?(PCt.applyTransform(e,s,l),(r=r||e.clone()).union(e)):(r=r||s.clone()).union(s)}}return r||e},e}(tAt);oAt.prototype.type="group";
/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/
var aAt=!t_t.canvasSupported,sAt={},lAt={};var uAt=function(){function t(t,e,n){var i=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,n=n||{},this.dom=e,this.id=t;var r=new iSt,o=n.renderer||"canvas";if(aAt)throw new Error("IE8 support has been dropped since 5.0");if(sAt[o]||(o=M_t(sAt)[0]),!sAt[o])throw new Error("Renderer '"+o+"' is not imported. Please import it first.");n.useDirtyRect=null!=n.useDirtyRect&&n.useDirtyRect;var a=new sAt[o](e,r,n,t);this.storage=r,this.painter=a;var s=t_t.node||t_t.worker?null:new cCt(a.getViewportRoot(),a.root);this.handler=new Gkt(r,a,s,a.root),this.animation=new qSt({stage:{update:function(){return i._flush(!0)}}}),this.animation.start()}return t.prototype.add=function(t){t&&(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},t.prototype.remove=function(t){t&&(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},t.prototype.configLayer=function(t,e){this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh()},t.prototype.setBackgroundColor=function(t){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=function(t){if(!t)return!1;if("string"==typeof t)return TSt(t,1)<.4;if(t.colorStops){for(var e=t.colorStops,n=0,i=e.length,r=0;r<i;r++)n+=TSt(e[r].color,1);return(n/=i)<.4}return!1}(t)},t.prototype.getBackgroundColor=function(){return this._backgroundColor},t.prototype.setDarkMode=function(t){this._darkMode=t},t.prototype.isDarkMode=function(){return this._darkMode},t.prototype.refreshImmediately=function(t){t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},t.prototype.refresh=function(){this._needsRefresh=!0,this.animation.start()},t.prototype.flush=function(){this._flush(!1)},t.prototype._flush=function(t){var e,n=(new Date).getTime();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var i=(new Date).getTime();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:i-n})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},t.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},t.prototype.wakeUp=function(){this.animation.start(),this._stillFrameAccum=0},t.prototype.addHover=function(t){},t.prototype.removeHover=function(t){},t.prototype.clearHover=function(){},t.prototype.refreshHover=function(){this._needsRefreshHover=!0},t.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()},t.prototype.resize=function(t){t=t||{},this.painter.resize(t.width,t.height),this.handler.resize()},t.prototype.clearAnimation=function(){this.animation.clear()},t.prototype.getWidth=function(){return this.painter.getWidth()},t.prototype.getHeight=function(){return this.painter.getHeight()},t.prototype.pathToImage=function(t,e){if(this.painter.pathToImage)return this.painter.pathToImage(t,e)},t.prototype.setCursorStyle=function(t){this.handler.setCursorStyle(t)},t.prototype.findHover=function(t,e){return this.handler.findHover(t,e)},t.prototype.on=function(t,e,n){return this.handler.on(t,e,n),this},t.prototype.off=function(t,e){this.handler.off(t,e)},t.prototype.trigger=function(t,e){this.handler.trigger(t,e)},t.prototype.clear=function(){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof oAt&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()},t.prototype.dispose=function(){var t;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,t=this.id,delete lAt[t]},t}();function cAt(t,e){var n=new uAt(p_t(),t,e);return lAt[n.id]=n,n}function hAt(t,e,n,i){var r=e[0],o=e[1],a=n[0],s=n[1],l=o-r,u=s-a;if(0===l)return 0===u?a:(a+s)/2;if(i)if(l>0){if(t<=r)return a;if(t>=o)return s}else{if(t>=r)return a;if(t<=o)return s}else{if(t===r)return a;if(t===o)return s}return(t-r)/l*u+a}function dAt(t,e){switch(t){case"center":case"middle":t="50%";break;case"left":case"top":t="0%";break;case"right":case"bottom":t="100%"}return"string"==typeof t?(n=t,n.replace(/^\s+|\s+$/g,"")).match(/%$/)?parseFloat(t)/100*e:parseFloat(t):null==t?NaN:+t;var n}function pAt(t,e,n){return null==e&&(e=10),e=Math.min(Math.max(0,e),20),t=(+t).toFixed(e),n?t:+t}function fAt(t){return t.sort((function(t,e){return t-e})),t}function gAt(t){if(t=+t,isNaN(t))return 0;if(t>1e-14)for(var e=1,n=0;n<15;n++,e*=10)if(Math.round(t*e)/e===t)return n;return function(t){var e=t.toString().toLowerCase(),n=e.indexOf("e"),i=n>0?+e.slice(n+1):0,r=n>0?n:e.length,o=e.indexOf("."),a=o<0?0:r-1-o;return Math.max(0,a-i)}(t)}function mAt(t,e){var n=Math.log,i=Math.LN10,r=Math.floor(n(t[1]-t[0])/i),o=Math.round(n(Math.abs(e[1]-e[0]))/i),a=Math.min(Math.max(-r+o,0),20);return isFinite(a)?a:20}function yAt(t,e){var n=Math.max(gAt(t),gAt(e)),i=t+e;return n>20?i:pAt(i,n)}function vAt(t){var e=2*Math.PI;return(t%e+e)%e}function xAt(t){return t>-1e-4&&t<1e-4}var bAt=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function wAt(t){if(t instanceof Date)return t;if("string"==typeof t){var e=bAt.exec(t);if(!e)return new Date(NaN);if(e[8]){var n=+e[4]||0;return"Z"!==e[8].toUpperCase()&&(n-=+e[8].slice(0,3)),new Date(Date.UTC(+e[1],+(e[2]||1)-1,+e[3]||1,n,+(e[5]||0),+e[6]||0,+e[7]||0))}return new Date(+e[1],+(e[2]||1)-1,+e[3]||1,+e[4]||0,+(e[5]||0),+e[6]||0,+e[7]||0)}return null==t?new Date(NaN):new Date(Math.round(t))}function _At(t){if(0===t)return 0;var e=Math.floor(Math.log(t)/Math.LN10);return t/Math.pow(10,e)>=10&&e++,e}function kAt(t,e){var n=_At(t),i=Math.pow(10,n),r=t/i;return t=(e?r<1.5?1:r<2.5?2:r<4?3:r<7?5:10:r<1?1:r<2?2:r<3?3:r<5?5:10)*i,n>=-20?+t.toFixed(n<0?-n:0):t}function SAt(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=+t[i-1],o=n-i;return o?r+o*(t[i]-r):r}function CAt(t){t.sort((function(t,e){return s(t,e,0)?-1:1}));for(var e=-1/0,n=1,i=0;i<t.length;){for(var r=t[i].interval,o=t[i].close,a=0;a<2;a++)r[a]<=e&&(r[a]=e,o[a]=a?1:1-n),e=r[a],n=o[a];r[0]===r[1]&&o[0]*o[1]!=1?t.splice(i,1):i++}return t;function s(t,e,n){return t.interval[n]<e.interval[n]||t.interval[n]===e.interval[n]&&(t.close[n]-e.close[n]==(n?-1:1)||!n&&s(t,e,1))}}function AAt(t){var e=parseFloat(t);return e==t&&(0!==e||"string"!=typeof t||t.indexOf("x")<=0)?e:NaN}function IAt(t){return!isNaN(AAt(t))}function MAt(){return Math.round(9*Math.random())}function DAt(t,e){return 0===e?t:DAt(e,t%e)}function TAt(t,e){return null==t?e:null==e?t:t*e/DAt(t,e)}function EAt(t){throw new Error(t)}function NAt(t){return t instanceof Array?t:null==t?[]:[t]}function OAt(t,e,n){if(t){t[e]=t[e]||{},t.emphasis=t.emphasis||{},t.emphasis[e]=t.emphasis[e]||{};for(var i=0,r=n.length;i<r;i++){var o=n[i];!t.emphasis[e].hasOwnProperty(o)&&t[e].hasOwnProperty(o)&&(t.emphasis[e][o]=t[e][o])}}}var FAt=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function RAt(t){return!L_t(t)||E_t(t)||t instanceof Date?t:t.value}function LAt(t,e,n){var i="normalMerge"===n,r="replaceMerge"===n,o="replaceAll"===n;t=t||[],e=(e||[]).slice();var a=Z_t();S_t(e,(function(t,n){L_t(t)||(e[n]=null)}));var s,l,u=function(t,e,n){var i=[];if("replaceAll"===n)return i;for(var r=0;r<t.length;r++){var o=t[r];o&&null!=o.id&&e.set(o.id,r),i.push({existing:"replaceMerge"===n||VAt(o)?null:o,newOption:null,keyInfo:null,brandNew:null})}return i}(t,a,n);return(i||r)&&function(t,e,n,i){S_t(i,(function(r,o){if(r&&null!=r.id){var a=PAt(r.id),s=n.get(a);if(null!=s){var l=t[s];H_t(!l.newOption,'Duplicated option on id "'+a+'".'),l.newOption=r,l.existing=e[s],i[o]=null}}}))}(u,t,a,e),i&&function(t,e){S_t(e,(function(n,i){if(n&&null!=n.name)for(var r=0;r<t.length;r++){var o=t[r].existing;if(!t[r].newOption&&o&&(null==o.id||null==n.id)&&!VAt(n)&&!VAt(o)&&$At("name",o,n))return t[r].newOption=n,void(e[i]=null)}}))}(u,e),i||r?function(t,e,n){S_t(e,(function(e){if(e){for(var i,r=0;(i=t[r])&&(i.newOption||VAt(i.existing)||i.existing&&null!=e.id&&!$At("id",e,i.existing));)r++;i?(i.newOption=e,i.brandNew=n):t.push({newOption:e,brandNew:n,existing:null,keyInfo:null}),r++}}))}(u,e,r):o&&function(t,e){S_t(e,(function(e){t.push({newOption:e,brandNew:!0,existing:null,keyInfo:null})}))}(u,e),s=u,l=Z_t(),S_t(s,(function(t){var e=t.existing;e&&l.set(e.id,t)})),S_t(s,(function(t){var e=t.newOption;H_t(!e||null==e.id||!l.get(e.id)||l.get(e.id)===t,"id duplicates: "+(e&&e.id)),e&&null!=e.id&&l.set(e.id,t),!t.keyInfo&&(t.keyInfo={})})),S_t(s,(function(t,e){var n=t.existing,i=t.newOption,r=t.keyInfo;if(L_t(i)){if(r.name=null!=i.name?PAt(i.name):n?n.name:"series\0"+e,n)r.id=PAt(n.id);else if(null!=i.id)r.id=PAt(i.id);else{var o=0;do{r.id="\0"+r.name+"\0"+o++}while(l.get(r.id))}l.set(r.id,t)}})),u}function $At(t,e,n){var i=zAt(e[t],null),r=zAt(n[t],null);return null!=i&&null!=r&&i===r}function PAt(t){return zAt(t,"")}function zAt(t,e){if(null==t)return e;var n=typeof t;return"string"===n?t:"number"===n||F_t(t)?t+"":e}function BAt(t){var e=t.name;return!(!e||!e.indexOf("series\0"))}function VAt(t){return t&&null!=t.id&&0===PAt(t.id).indexOf("\0_ec_\0")}function WAt(t,e){return null!=e.dataIndexInside?e.dataIndexInside:null!=e.dataIndex?E_t(e.dataIndex)?C_t(e.dataIndex,(function(e){return t.indexOfRawIndex(e)})):t.indexOfRawIndex(e.dataIndex):null!=e.name?E_t(e.name)?C_t(e.name,(function(e){return t.indexOfName(e)})):t.indexOfName(e.name):void 0}function jAt(){var t="__ec_inner_"+UAt++;return function(e){return e[t]||(e[t]={})}}var UAt=MAt();function GAt(t,e,n){var i=HAt(e,n),r=i.mainTypeSpecified,o=i.queryOptionMap,a=i.others,s=n?n.defaultMainType:null;return!r&&s&&o.set(s,{}),o.each((function(e,i){var r=YAt(t,i,e,{useDefault:s===i,enableAll:!n||null==n.enableAll||n.enableAll,enableNone:!n||null==n.enableNone||n.enableNone});a[i+"Models"]=r.models,a[i+"Model"]=r.models[0]})),a}function HAt(t,e){var n;if(O_t(t)){var i={};i[t+"Index"]=0,n=i}else n=t;var r=Z_t(),o={},a=!1;return S_t(n,(function(t,n){if("dataIndex"!==n&&"dataIndexInside"!==n){var i=n.match(/^(\w+)(Index|Id|Name)$/)||[],s=i[1],l=(i[2]||"").toLowerCase();if(s&&l&&!(e&&e.includeMainTypes&&w_t(e.includeMainTypes,s)<0))a=a||!!s,(r.get(s)||r.set(s,{}))[l]=t}else o[n]=t})),{mainTypeSpecified:a,queryOptionMap:r,others:o}}var qAt={useDefault:!0,enableAll:!1,enableNone:!1},XAt={useDefault:!1,enableAll:!0,enableNone:!0};function YAt(t,e,n,i){i=i||qAt;var r=n.index,o=n.id,a=n.name,s={models:null,specified:null!=r||null!=o||null!=a};if(!s.specified){var l=void 0;return s.models=i.useDefault&&(l=t.getComponent(e))?[l]:[],s}return"none"===r||!1===r?(H_t(i.enableNone,'`"none"` or `false` is not a valid value on index option.'),s.models=[],s):("all"===r&&(H_t(i.enableAll,'`"all"` is not a valid value on index option.'),r=o=a=null),s.models=t.queryComponents({mainType:e,index:r,id:o,name:a}),s)}function KAt(t,e,n){t.setAttribute?t.setAttribute(e,n):t[e]=n}function ZAt(t,e){var n=Z_t(),i=[];return S_t(t,(function(t){var r=e(t);(n.get(r)||(i.push(r),n.set(r,[]))).push(t)})),{keys:i,buckets:n}}function JAt(t,e,n,i,r){var o=null==e||"auto"===e;if(null==i)return i;if("number"==typeof i)return pAt(p=NSt(n||0,i,r),o?Math.max(gAt(n||0),gAt(i)):e);if("string"==typeof i)return r<1?n:i;for(var a=[],s=n,l=i,u=Math.max(s?s.length:0,l.length),c=0;c<u;++c){if("ordinal"===t.getDimensionInfo(c).type)a[c]=(r<1&&s?s:l)[c];else{var h=s&&s[c]?s[c]:0,d=l[c],p=NSt(h,d,r);a[c]=pAt(p,o?Math.max(gAt(h),gAt(d)):e)}}return a}var QAt="___EC__COMPONENT__CONTAINER___";function tIt(t){var e={main:"",sub:""};if(t){var n=t.split(".");e.main=n[0]||"",e.sub=n[1]||""}return e}function eIt(t,e){t.$constructor=t,t.extend=function(t){var e=this;function n(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(t.$constructor)t.$constructor.apply(this,arguments);else{if(nIt(e)){var o=Q_t(n.prototype,new(e.bind.apply(e,Nit([void 0],i))));return o}e.apply(this,arguments)}}return n.___EC__EXTENDED_CLASS___=!0,v_t(n.prototype,t),n.extend=this.extend,n.superCall=oIt,n.superApply=aIt,function(t,e){var n=t.prototype;function i(){}for(var r in i.prototype=e.prototype,t.prototype=new i,n)n.hasOwnProperty(r)&&(t.prototype[r]=n[r]);t.prototype.constructor=t,t.superClass=e}(n,this),n.superClass=e,n}}function nIt(t){return"function"==typeof t&&/^class\s/.test(Function.prototype.toString.call(t))}function iIt(t,e){t.extend=e.extend}var rIt=Math.round(10*Math.random());function oIt(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this.superClass.prototype[e].apply(t,n)}function aIt(t,e,n){return this.superClass.prototype[e].apply(t,n)}function sIt(t){var e={};t.registerClass=function(t){var n,i=t.type||t.prototype.type;if(i){H_t(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(n=i),'componentType "'+n+'" illegal'),t.prototype.type=i;var r=tIt(i);if(r.sub){if(r.sub!==QAt){(function(t){var n=e[t.main];n&&n[QAt]||((n=e[t.main]={})[QAt]=!0);return n}(r))[r.sub]=t}}else e[r.main]=t}return t},t.getClass=function(t,n,i){var r=e[t];if(r&&r[QAt]&&(r=n?r[n]:null),i&&!r)throw new Error(n?"Component "+t+"."+(n||"")+" is used but not imported.":t+".type should be specified.");return r},t.getClassesByMainType=function(t){var n=tIt(t),i=[],r=e[n.main];return r&&r[QAt]?S_t(r,(function(t,e){e!==QAt&&i.push(t)})):i.push(r),i},t.hasClass=function(t){var n=tIt(t);return!!e[n.main]},t.getAllClassMainTypes=function(){var t=[];return S_t(e,(function(e,n){t.push(n)})),t},t.hasSubTypes=function(t){var n=tIt(t),i=e[n.main];return i&&i[QAt]}}function lIt(t,e){for(var n=0;n<t.length;n++)t[n][1]||(t[n][1]=t[n][0]);return e=e||!1,function(n,i,r){for(var o={},a=0;a<t.length;a++){var s=t[a][1];if(!(i&&w_t(i,s)>=0||r&&w_t(r,s)<0)){var l=n.getShallow(s,e);null!=l&&(o[t[a][0]]=l)}}return o}}var uIt=lIt([["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]]),cIt=function(){function t(){}return t.prototype.getAreaStyle=function(t,e){return uIt(this,t,e)},t}(),hIt=new uSt(50);function dIt(t){if("string"==typeof t){var e=hIt.get(t);return e&&e.image}return t}function pIt(t,e,n,i,r){if(t){if("string"==typeof t){if(e&&e.__zrImageSrc===t||!n)return e;var o=hIt.get(t),a={hostEl:n,cb:i,cbPayload:r};return o?!gIt(e=o.image)&&o.pending.push(a):((e=new Image).onload=e.onerror=fIt,hIt.put(t,e.__cachedImgObj={image:e,pending:[a]}),e.src=e.__zrImageSrc=t),e}return t}return e}function fIt(){var t=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var e=0;e<t.pending.length;e++){var n=t.pending[e],i=n.cb;i&&i(this,n.cbPayload),n.hostEl.dirty()}t.pending.length=0}function gIt(t){return t&&t.width&&t.height}var mIt=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function yIt(t,e,n,i,r){if(!e)return"";var o=(t+"").split("\n");r=vIt(e,n,i,r);for(var a=0,s=o.length;a<s;a++)o[a]=xIt(o[a],r);return o.join("\n")}function vIt(t,e,n,i){var r=v_t({},i=i||{});r.font=e,n=W_t(n,"..."),r.maxIterations=W_t(i.maxIterations,2);var o=r.minChar=W_t(i.minChar,0);r.cnCharWidth=WCt("国",e);var a=r.ascCharWidth=WCt("a",e);r.placeholder=W_t(i.placeholder,"");for(var s=t=Math.max(0,t-1),l=0;l<o&&s>=a;l++)s-=a;var u=WCt(n,e);return u>s&&(n="",u=0),s=t-u,r.ellipsis=n,r.ellipsisWidth=u,r.contentWidth=s,r.containerWidth=t,r}function xIt(t,e){var n=e.containerWidth,i=e.font,r=e.contentWidth;if(!n)return"";var o=WCt(t,i);if(o<=n)return t;for(var a=0;;a++){if(o<=r||a>=e.maxIterations){t+=e.ellipsis;break}var s=0===a?bIt(t,r,e.ascCharWidth,e.cnCharWidth):o>0?Math.floor(t.length*r/o):0;o=WCt(t=t.substr(0,s),i)}return""===t&&(t=e.placeholder),t}function bIt(t,e,n,i){for(var r=0,o=0,a=t.length;o<a&&r<e;o++){var s=t.charCodeAt(o);r+=0<=s&&s<=127?n:i}return o}var wIt=function(){},_It=function(t){this.tokens=[],t&&(this.tokens=t)},kIt=function(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]};function SIt(t,e,n,i,r){var o,a,s=""===e,l=r&&n.rich[r]||{},u=t.lines,c=l.font||n.font,h=!1;if(i){var d=l.padding,p=d?d[1]+d[3]:0;if(null!=l.width&&"auto"!==l.width){var f=XCt(l.width,i.width)+p;u.length>0&&f+i.accumWidth>i.width&&(o=e.split("\n"),h=!0),i.accumWidth=f}else{var g=IIt(e,c,i.width,i.breakAll,i.accumWidth);i.accumWidth=g.accumWidth+p,a=g.linesWidths,o=g.lines}}else o=e.split("\n");for(var m=0;m<o.length;m++){var y=o[m],v=new wIt;if(v.styleName=r,v.text=y,v.isLineHolder=!y&&!s,"number"==typeof l.width?v.width=l.width:v.width=a?a[m]:WCt(y,c),m||h)u.push(new _It([v]));else{var x=(u[u.length-1]||(u[0]=new _It)).tokens,b=x.length;1===b&&x[0].isLineHolder?x[0]=v:(y||!b||s)&&x.push(v)}}}var CIt=A_t(",&?/;] ".split(""),(function(t,e){return t[e]=!0,t}),{});function AIt(t){return!function(t){var e=t.charCodeAt(0);return e>=33&&e<=255}(t)||!!CIt[t]}function IIt(t,e,n,i,r){for(var o=[],a=[],s="",l="",u=0,c=0,h=0;h<t.length;h++){var d=t.charAt(h);if("\n"!==d){var p=WCt(d,e),f=!i&&!AIt(d);(o.length?c+p>n:r+c+p>n)?c?(s||l)&&(f?(s||(s=l,l="",c=u=0),o.push(s),a.push(c-u),l+=d,s="",c=u+=p):(l&&(s+=l,c+=u,l="",u=0),o.push(s),a.push(c),s=d,c=p)):f?(o.push(l),a.push(u),l=d,u=p):(o.push(d),a.push(p)):(c+=p,f?(l+=d,u+=p):(l&&(s+=l,l="",u=0),s+=d))}else l&&(s+=l,c+=u),o.push(s),a.push(c),s="",l="",u=0,c=0}return o.length||s||(s=t,l="",u=0),l&&(s+=l),s&&(o.push(s),a.push(c)),1===o.length&&(c+=r),{accumWidth:c,lines:o,linesWidths:a}}var MIt="__zr_style_"+Math.round(10*Math.random()),DIt={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},TIt={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};DIt[MIt]=!0;var EIt=["z","z2","invisible"],NIt=["invisible"],OIt=function(t){function e(e){return t.call(this,e)||this}var n;return Dit(e,t),e.prototype._init=function(e){for(var n=M_t(e),i=0;i<n.length;i++){var r=n[i];"style"===r?this.useStyle(e[r]):t.prototype.attrKV.call(this,r,e[r])}this.style||this.useStyle({})},e.prototype.beforeBrush=function(){},e.prototype.afterBrush=function(){},e.prototype.innerBeforeBrush=function(){},e.prototype.innerAfterBrush=function(){},e.prototype.shouldBePainted=function(t,e,n,i){var r=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&function(t,e,n){FIt.copy(t.getBoundingRect()),t.transform&&FIt.applyTransform(t.transform);return RIt.width=e,RIt.height=n,!FIt.intersect(RIt)}(this,t,e)||r&&!r[0]&&!r[3])return!1;if(n&&this.__clipPaths)for(var o=0;o<this.__clipPaths.length;++o)if(this.__clipPaths[o].isZeroArea())return!1;if(i&&this.parent)for(var a=this.parent;a;){if(a.ignore)return!1;a=a.parent}return!0},e.prototype.contain=function(t,e){return this.rectContain(t,e)},e.prototype.traverse=function(t,e){t.call(e,this)},e.prototype.rectContain=function(t,e){var n=this.transformCoordToLocal(t,e);return this.getBoundingRect().contain(n[0],n[1])},e.prototype.getPaintRect=function(){var t=this._paintRect;if(!this._paintRect||this.__dirty){var e=this.transform,n=this.getBoundingRect(),i=this.style,r=i.shadowBlur||0,o=i.shadowOffsetX||0,a=i.shadowOffsetY||0;t=this._paintRect||(this._paintRect=new PCt(0,0,0,0)),e?PCt.applyTransform(t,n,e):t.copy(n),(r||o||a)&&(t.width+=2*r+Math.abs(o),t.height+=2*r+Math.abs(a),t.x=Math.min(t.x,t.x+o-r),t.y=Math.min(t.y,t.y+a-r));var s=this.dirtyRectTolerance;t.isZero()||(t.x=Math.floor(t.x-s),t.y=Math.floor(t.y-s),t.width=Math.ceil(t.width+1+2*s),t.height=Math.ceil(t.height+1+2*s))}return t},e.prototype.setPrevPaintRect=function(t){t?(this._prevPaintRect=this._prevPaintRect||new PCt(0,0,0,0),this._prevPaintRect.copy(t)):this._prevPaintRect=null},e.prototype.getPrevPaintRect=function(){return this._prevPaintRect},e.prototype.animateStyle=function(t){return this.animate("style",t)},e.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():this.markRedraw()},e.prototype.attrKV=function(e,n){"style"!==e?t.prototype.attrKV.call(this,e,n):this.style?this.setStyle(n):this.useStyle(n)},e.prototype.setStyle=function(t,e){return"string"==typeof t?this.style[t]=e:v_t(this.style,t),this.dirtyStyle(),this},e.prototype.dirtyStyle=function(t){t||this.markRedraw(),this.__dirty|=2,this._rect&&(this._rect=null)},e.prototype.dirty=function(){this.dirtyStyle()},e.prototype.styleChanged=function(){return!!(2&this.__dirty)},e.prototype.styleUpdated=function(){this.__dirty&=-3},e.prototype.createStyle=function(t){return Q_t(DIt,t)},e.prototype.useStyle=function(t){t[MIt]||(t=this.createStyle(t)),this.__inHover?this.__hoverStyle=t:this.style=t,this.dirtyStyle()},e.prototype.isStyleObject=function(t){return t[MIt]},e.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var n=this._normalState;e.style&&!n.style&&(n.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,n,EIt)},e.prototype._applyStateObj=function(e,n,i,r,o,a){t.prototype._applyStateObj.call(this,e,n,i,r,o,a);var s,l=!(n&&r);if(n&&n.style?o?r?s=n.style:(s=this._mergeStyle(this.createStyle(),i.style),this._mergeStyle(s,n.style)):(s=this._mergeStyle(this.createStyle(),r?this.style:i.style),this._mergeStyle(s,n.style)):l&&(s=i.style),s)if(o){var u=this.style;if(this.style=this.createStyle(l?{}:u),l)for(var c=M_t(u),h=0;h<c.length;h++){(p=c[h])in s&&(s[p]=s[p],this.style[p]=u[p])}var d=M_t(s);for(h=0;h<d.length;h++){var p=d[h];this.style[p]=this.style[p]}this._transitionState(e,{style:s},a,this.getAnimationStyleProps())}else this.useStyle(s);var f=this.__inHover?NIt:EIt;for(h=0;h<f.length;h++){p=f[h];n&&null!=n[p]?this[p]=n[p]:l&&null!=i[p]&&(this[p]=i[p])}},e.prototype._mergeStates=function(e){for(var n,i=t.prototype._mergeStates.call(this,e),r=0;r<e.length;r++){var o=e[r];o.style&&(n=n||{},this._mergeStyle(n,o.style))}return n&&(i.style=n),i},e.prototype._mergeStyle=function(t,e){return v_t(t,e),t},e.prototype.getAnimationStyleProps=function(){return TIt},e.initDefaultProps=((n=e.prototype).type="displayable",n.invisible=!1,n.z=0,n.z2=0,n.zlevel=0,n.culling=!1,n.cursor="pointer",n.rectHover=!1,n.incremental=!1,n._rect=null,n.dirtyRectTolerance=0,void(n.__dirty=3)),e}(tAt),FIt=new PCt(0,0,0,0),RIt=new PCt(0,0,0,0);var LIt=Math.pow,$It=Math.sqrt,PIt=$It(3),zIt=1/3,BIt=nkt(),VIt=nkt(),WIt=nkt();function jIt(t){return t>-1e-8&&t<1e-8}function UIt(t){return t>1e-8||t<-1e-8}function GIt(t,e,n,i,r){var o=1-r;return o*o*(o*t+3*r*e)+r*r*(r*i+3*o*n)}function HIt(t,e,n,i,r){var o=1-r;return 3*(((e-t)*o+2*(n-e)*r)*o+(i-n)*r*r)}function qIt(t,e,n,i,r,o){var a=i+3*(e-n)-t,s=3*(n-2*e+t),l=3*(e-t),u=t-r,c=s*s-3*a*l,h=s*l-9*a*u,d=l*l-3*s*u,p=0;if(jIt(c)&&jIt(h)){if(jIt(s))o[0]=0;else(S=-l/s)>=0&&S<=1&&(o[p++]=S)}else{var f=h*h-4*c*d;if(jIt(f)){var g=h/c,m=-g/2;(S=-s/a+g)>=0&&S<=1&&(o[p++]=S),m>=0&&m<=1&&(o[p++]=m)}else if(f>0){var y=$It(f),v=c*s+1.5*a*(-h+y),x=c*s+1.5*a*(-h-y);(S=(-s-((v=v<0?-LIt(-v,zIt):LIt(v,zIt))+(x=x<0?-LIt(-x,zIt):LIt(x,zIt))))/(3*a))>=0&&S<=1&&(o[p++]=S)}else{var b=(2*c*s-3*a*h)/(2*$It(c*c*c)),w=Math.acos(b)/3,_=$It(c),k=Math.cos(w),S=(-s-2*_*k)/(3*a),C=(m=(-s+_*(k+PIt*Math.sin(w)))/(3*a),(-s+_*(k-PIt*Math.sin(w)))/(3*a));S>=0&&S<=1&&(o[p++]=S),m>=0&&m<=1&&(o[p++]=m),C>=0&&C<=1&&(o[p++]=C)}}return p}function XIt(t,e,n,i,r){var o=6*n-12*e+6*t,a=9*e+3*i-3*t-9*n,s=3*e-3*t,l=0;if(jIt(a)){if(UIt(o))(c=-s/o)>=0&&c<=1&&(r[l++]=c)}else{var u=o*o-4*a*s;if(jIt(u))r[0]=-o/(2*a);else if(u>0){var c,h=$It(u),d=(-o-h)/(2*a);(c=(-o+h)/(2*a))>=0&&c<=1&&(r[l++]=c),d>=0&&d<=1&&(r[l++]=d)}}return l}function YIt(t,e,n,i,r,o){var a=(e-t)*r+t,s=(n-e)*r+e,l=(i-n)*r+n,u=(s-a)*r+a,c=(l-s)*r+s,h=(c-u)*r+u;o[0]=t,o[1]=a,o[2]=u,o[3]=h,o[4]=h,o[5]=c,o[6]=l,o[7]=i}function KIt(t,e,n,i,r,o,a,s,l,u,c){var h,d,p,f,g,m=.005,y=1/0;BIt[0]=l,BIt[1]=u;for(var v=0;v<1;v+=.05)VIt[0]=GIt(t,n,r,a,v),VIt[1]=GIt(e,i,o,s,v),(f=pkt(BIt,VIt))<y&&(h=v,y=f);y=1/0;for(var x=0;x<32&&!(m<1e-4);x++)d=h-m,p=h+m,VIt[0]=GIt(t,n,r,a,d),VIt[1]=GIt(e,i,o,s,d),f=pkt(VIt,BIt),d>=0&&f<y?(h=d,y=f):(WIt[0]=GIt(t,n,r,a,p),WIt[1]=GIt(e,i,o,s,p),g=pkt(WIt,BIt),p<=1&&g<y?(h=p,y=g):m*=.5);return c&&(c[0]=GIt(t,n,r,a,h),c[1]=GIt(e,i,o,s,h)),$It(y)}function ZIt(t,e,n,i,r,o,a,s,l){for(var u=t,c=e,h=0,d=1/l,p=1;p<=l;p++){var f=p*d,g=GIt(t,n,r,a,f),m=GIt(e,i,o,s,f),y=g-u,v=m-c;h+=Math.sqrt(y*y+v*v),u=g,c=m}return h}function JIt(t,e,n,i){var r=1-i;return r*(r*t+2*i*e)+i*i*n}function QIt(t,e,n,i){return 2*((1-i)*(e-t)+i*(n-e))}function tMt(t,e,n){var i=t+n-2*e;return 0===i?.5:(t-e)/i}function eMt(t,e,n,i,r){var o=(e-t)*i+t,a=(n-e)*i+e,s=(a-o)*i+o;r[0]=t,r[1]=o,r[2]=s,r[3]=s,r[4]=a,r[5]=n}function nMt(t,e,n,i,r,o,a,s,l){var u,c=.005,h=1/0;BIt[0]=a,BIt[1]=s;for(var d=0;d<1;d+=.05){VIt[0]=JIt(t,n,r,d),VIt[1]=JIt(e,i,o,d),(m=pkt(BIt,VIt))<h&&(u=d,h=m)}h=1/0;for(var p=0;p<32&&!(c<1e-4);p++){var f=u-c,g=u+c;VIt[0]=JIt(t,n,r,f),VIt[1]=JIt(e,i,o,f);var m=pkt(VIt,BIt);if(f>=0&&m<h)u=f,h=m;else{WIt[0]=JIt(t,n,r,g),WIt[1]=JIt(e,i,o,g);var y=pkt(WIt,BIt);g<=1&&y<h?(u=g,h=y):c*=.5}}return l&&(l[0]=JIt(t,n,r,u),l[1]=JIt(e,i,o,u)),$It(h)}function iMt(t,e,n,i,r,o,a){for(var s=t,l=e,u=0,c=1/a,h=1;h<=a;h++){var d=h*c,p=JIt(t,n,r,d),f=JIt(e,i,o,d),g=p-s,m=f-l;u+=Math.sqrt(g*g+m*m),s=p,l=f}return u}var rMt=Math.min,oMt=Math.max,aMt=Math.sin,sMt=Math.cos,lMt=2*Math.PI,uMt=nkt(),cMt=nkt(),hMt=nkt();function dMt(t,e,n){if(0!==t.length){for(var i=t[0],r=i[0],o=i[0],a=i[1],s=i[1],l=1;l<t.length;l++)i=t[l],r=rMt(r,i[0]),o=oMt(o,i[0]),a=rMt(a,i[1]),s=oMt(s,i[1]);e[0]=r,e[1]=a,n[0]=o,n[1]=s}}function pMt(t,e,n,i,r,o){r[0]=rMt(t,n),r[1]=rMt(e,i),o[0]=oMt(t,n),o[1]=oMt(e,i)}var fMt=[],gMt=[];function mMt(t,e,n,i,r,o,a,s,l,u){var c=XIt,h=GIt,d=c(t,n,r,a,fMt);l[0]=1/0,l[1]=1/0,u[0]=-1/0,u[1]=-1/0;for(var p=0;p<d;p++){var f=h(t,n,r,a,fMt[p]);l[0]=rMt(f,l[0]),u[0]=oMt(f,u[0])}d=c(e,i,o,s,gMt);for(p=0;p<d;p++){var g=h(e,i,o,s,gMt[p]);l[1]=rMt(g,l[1]),u[1]=oMt(g,u[1])}l[0]=rMt(t,l[0]),u[0]=oMt(t,u[0]),l[0]=rMt(a,l[0]),u[0]=oMt(a,u[0]),l[1]=rMt(e,l[1]),u[1]=oMt(e,u[1]),l[1]=rMt(s,l[1]),u[1]=oMt(s,u[1])}function yMt(t,e,n,i,r,o,a,s){var l=tMt,u=JIt,c=oMt(rMt(l(t,n,r),1),0),h=oMt(rMt(l(e,i,o),1),0),d=u(t,n,r,c),p=u(e,i,o,h);a[0]=rMt(t,r,d),a[1]=rMt(e,o,p),s[0]=oMt(t,r,d),s[1]=oMt(e,o,p)}function vMt(t,e,n,i,r,o,a,s,l){var u=mkt,c=ykt,h=Math.abs(r-o);if(h%lMt<1e-4&&h>1e-4)return s[0]=t-n,s[1]=e-i,l[0]=t+n,void(l[1]=e+i);if(uMt[0]=sMt(r)*n+t,uMt[1]=aMt(r)*i+e,cMt[0]=sMt(o)*n+t,cMt[1]=aMt(o)*i+e,u(s,uMt,cMt),c(l,uMt,cMt),(r%=lMt)<0&&(r+=lMt),(o%=lMt)<0&&(o+=lMt),r>o&&!a?o+=lMt:r<o&&a&&(r+=lMt),a){var d=o;o=r,r=d}for(var p=0;p<o;p+=Math.PI/2)p>r&&(hMt[0]=sMt(p)*n+t,hMt[1]=aMt(p)*i+e,u(s,hMt,s),c(l,hMt,l))}var xMt={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},bMt=[],wMt=[],_Mt=[],kMt=[],SMt=[],CMt=[],AMt=Math.min,IMt=Math.max,MMt=Math.cos,DMt=Math.sin,TMt=Math.sqrt,EMt=Math.abs,NMt=Math.PI,OMt=2*NMt,FMt="undefined"!=typeof Float32Array,RMt=[];function LMt(t){return Math.round(t/NMt*1e8)/1e8%2*NMt}function $Mt(t,e){var n=LMt(t[0]);n<0&&(n+=OMt);var i=n-t[0],r=t[1];r+=i,!e&&r-n>=OMt?r=n+OMt:e&&n-r>=OMt?r=n-OMt:!e&&n>r?r=n+(OMt-LMt(n-r)):e&&n<r&&(r=n-(OMt-LMt(r-n))),t[0]=n,t[1]=r}var PMt=function(){function t(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}var e;return t.prototype.increaseVersion=function(){this._version++},t.prototype.getVersion=function(){return this._version},t.prototype.setScale=function(t,e,n){(n=n||0)>0&&(this._ux=EMt(n/dCt/t)||0,this._uy=EMt(n/dCt/e)||0)},t.prototype.setDPR=function(t){this.dpr=t},t.prototype.setContext=function(t){this._ctx=t},t.prototype.getContext=function(){return this._ctx},t.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},t.prototype.reset=function(){this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},t.prototype.moveTo=function(t,e){return this._drawPendingPt(),this.addData(xMt.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},t.prototype.lineTo=function(t,e){var n=EMt(t-this._xi),i=EMt(e-this._yi),r=n>this._ux||i>this._uy;if(this.addData(xMt.L,t,e),this._ctx&&r&&(this._needsDash?this._dashedLineTo(t,e):this._ctx.lineTo(t,e)),r)this._xi=t,this._yi=e,this._pendingPtDist=0;else{var o=n*n+i*i;o>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=e,this._pendingPtDist=o)}return this},t.prototype.bezierCurveTo=function(t,e,n,i,r,o){return this.addData(xMt.C,t,e,n,i,r,o),this._ctx&&(this._needsDash?this._dashedBezierTo(t,e,n,i,r,o):this._ctx.bezierCurveTo(t,e,n,i,r,o)),this._xi=r,this._yi=o,this},t.prototype.quadraticCurveTo=function(t,e,n,i){return this.addData(xMt.Q,t,e,n,i),this._ctx&&(this._needsDash?this._dashedQuadraticTo(t,e,n,i):this._ctx.quadraticCurveTo(t,e,n,i)),this._xi=n,this._yi=i,this},t.prototype.arc=function(t,e,n,i,r,o){RMt[0]=i,RMt[1]=r,$Mt(RMt,o),i=RMt[0];var a=(r=RMt[1])-i;return this.addData(xMt.A,t,e,n,n,i,a,0,o?0:1),this._ctx&&this._ctx.arc(t,e,n,i,r,o),this._xi=MMt(r)*n+t,this._yi=DMt(r)*n+e,this},t.prototype.arcTo=function(t,e,n,i,r){return this._ctx&&this._ctx.arcTo(t,e,n,i,r),this},t.prototype.rect=function(t,e,n,i){return this._ctx&&this._ctx.rect(t,e,n,i),this.addData(xMt.R,t,e,n,i),this},t.prototype.closePath=function(){this._drawPendingPt(),this.addData(xMt.Z);var t=this._ctx,e=this._x0,n=this._y0;return t&&(this._needsDash&&this._dashedLineTo(e,n),t.closePath()),this._xi=e,this._yi=n,this},t.prototype.fill=function(t){t&&t.fill(),this.toStatic()},t.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},t.prototype.setLineDash=function(t){if(t instanceof Array){this._lineDash=t,this._dashIdx=0;for(var e=0,n=0;n<t.length;n++)e+=t[n];this._dashSum=e,this._needsDash=!0}else this._lineDash=null,this._needsDash=!1;return this},t.prototype.setLineDashOffset=function(t){return this._dashOffset=t,this},t.prototype.len=function(){return this._len},t.prototype.setData=function(t){var e=t.length;this.data&&this.data.length===e||!FMt||(this.data=new Float32Array(e));for(var n=0;n<e;n++)this.data[n]=t[n];this._len=e},t.prototype.appendPath=function(t){t instanceof Array||(t=[t]);for(var e=t.length,n=0,i=this._len,r=0;r<e;r++)n+=t[r].len();FMt&&this.data instanceof Float32Array&&(this.data=new Float32Array(i+n));for(r=0;r<e;r++)for(var o=t[r].data,a=0;a<o.length;a++)this.data[i++]=o[a];this._len=i},t.prototype.addData=function(t,e,n,i,r,o,a,s,l){if(this._saveData){var u=this.data;this._len+arguments.length>u.length&&(this._expandData(),u=this.data);for(var c=0;c<arguments.length;c++)u[this._len++]=arguments[c]}},t.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},t.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},t.prototype._dashedLineTo=function(t,e){var n,i,r=this._dashSum,o=this._lineDash,a=this._ctx,s=this._dashOffset,l=this._xi,u=this._yi,c=t-l,h=e-u,d=TMt(c*c+h*h),p=l,f=u,g=o.length;for(s<0&&(s=r+s),p-=(s%=r)*(c/=d),f-=s*(h/=d);c>0&&p<=t||c<0&&p>=t||0===c&&(h>0&&f<=e||h<0&&f>=e);)p+=c*(n=o[i=this._dashIdx]),f+=h*n,this._dashIdx=(i+1)%g,c>0&&p<l||c<0&&p>l||h>0&&f<u||h<0&&f>u||a[i%2?"moveTo":"lineTo"](c>=0?AMt(p,t):IMt(p,t),h>=0?AMt(f,e):IMt(f,e));c=p-t,h=f-e,this._dashOffset=-TMt(c*c+h*h)},t.prototype._dashedBezierTo=function(t,e,n,i,r,o){var a,s,l,u,c,h=this._ctx,d=this._dashSum,p=this._dashOffset,f=this._lineDash,g=this._xi,m=this._yi,y=0,v=this._dashIdx,x=f.length,b=0;for(p<0&&(p=d+p),p%=d,a=0;a<1;a+=.1)s=GIt(g,t,n,r,a+.1)-GIt(g,t,n,r,a),l=GIt(m,e,i,o,a+.1)-GIt(m,e,i,o,a),y+=TMt(s*s+l*l);for(;v<x&&!((b+=f[v])>p);v++);for(a=(b-p)/y;a<=1;)u=GIt(g,t,n,r,a),c=GIt(m,e,i,o,a),v%2?h.moveTo(u,c):h.lineTo(u,c),a+=f[v]/y,v=(v+1)%x;v%2!=0&&h.lineTo(r,o),s=r-u,l=o-c,this._dashOffset=-TMt(s*s+l*l)},t.prototype._dashedQuadraticTo=function(t,e,n,i){var r=n,o=i;n=(n+2*t)/3,i=(i+2*e)/3,t=(this._xi+2*t)/3,e=(this._yi+2*e)/3,this._dashedBezierTo(t,e,n,i,r,o)},t.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,FMt&&this._len>11&&(this.data=new Float32Array(t)))}},t.prototype.getBoundingRect=function(){_Mt[0]=_Mt[1]=SMt[0]=SMt[1]=Number.MAX_VALUE,kMt[0]=kMt[1]=CMt[0]=CMt[1]=-Number.MAX_VALUE;var t,e=this.data,n=0,i=0,r=0,o=0;for(t=0;t<this._len;){var a=e[t++],s=1===t;switch(s&&(r=n=e[t],o=i=e[t+1]),a){case xMt.M:n=r=e[t++],i=o=e[t++],SMt[0]=r,SMt[1]=o,CMt[0]=r,CMt[1]=o;break;case xMt.L:pMt(n,i,e[t],e[t+1],SMt,CMt),n=e[t++],i=e[t++];break;case xMt.C:mMt(n,i,e[t++],e[t++],e[t++],e[t++],e[t],e[t+1],SMt,CMt),n=e[t++],i=e[t++];break;case xMt.Q:yMt(n,i,e[t++],e[t++],e[t],e[t+1],SMt,CMt),n=e[t++],i=e[t++];break;case xMt.A:var l=e[t++],u=e[t++],c=e[t++],h=e[t++],d=e[t++],p=e[t++]+d;t+=1;var f=!e[t++];s&&(r=MMt(d)*c+l,o=DMt(d)*h+u),vMt(l,u,c,h,d,p,f,SMt,CMt),n=MMt(p)*c+l,i=DMt(p)*h+u;break;case xMt.R:pMt(r=n=e[t++],o=i=e[t++],r+e[t++],o+e[t++],SMt,CMt);break;case xMt.Z:n=r,i=o}mkt(_Mt,_Mt,SMt),ykt(kMt,kMt,CMt)}return 0===t&&(_Mt[0]=_Mt[1]=kMt[0]=kMt[1]=0),new PCt(_Mt[0],_Mt[1],kMt[0]-_Mt[0],kMt[1]-_Mt[1])},t.prototype._calculateLength=function(){var t=this.data,e=this._len,n=this._ux,i=this._uy,r=0,o=0,a=0,s=0;this._pathSegLen||(this._pathSegLen=[]);for(var l=this._pathSegLen,u=0,c=0,h=0;h<e;){var d=t[h++],p=1===h;p&&(a=r=t[h],s=o=t[h+1]);var f=-1;switch(d){case xMt.M:r=a=t[h++],o=s=t[h++];break;case xMt.L:var g=t[h++],m=(x=t[h++])-o;(EMt(D=g-r)>n||EMt(m)>i||h===e-1)&&(f=Math.sqrt(D*D+m*m),r=g,o=x);break;case xMt.C:var y=t[h++],v=t[h++],x=(g=t[h++],t[h++]),b=t[h++],w=t[h++];f=ZIt(r,o,y,v,g,x,b,w,10),r=b,o=w;break;case xMt.Q:f=iMt(r,o,y=t[h++],v=t[h++],g=t[h++],x=t[h++],10),r=g,o=x;break;case xMt.A:var _=t[h++],k=t[h++],S=t[h++],C=t[h++],A=t[h++],I=t[h++],M=I+A;h+=1,t[h++],p&&(a=MMt(A)*S+_,s=DMt(A)*C+k),f=IMt(S,C)*AMt(OMt,Math.abs(I)),r=MMt(M)*S+_,o=DMt(M)*C+k;break;case xMt.R:a=r=t[h++],s=o=t[h++],f=2*t[h++]+2*t[h++];break;case xMt.Z:var D=a-r;m=s-o;f=Math.sqrt(D*D+m*m),r=a,o=s}f>=0&&(l[c++]=f,u+=f)}return this._pathLen=u,u},t.prototype.rebuildPath=function(t,e){var n,i,r,o,a,s,l,u,c,h,d=this.data,p=this._ux,f=this._uy,g=this._len,m=e<1,y=0,v=0,x=0;if(!m||(this._pathSegLen||this._calculateLength(),l=this._pathSegLen,u=e*this._pathLen))t:for(var b=0;b<g;){var w=d[b++],_=1===b;switch(_&&(n=r=d[b],i=o=d[b+1]),w){case xMt.M:x>0&&(t.lineTo(c,h),x=0),n=r=d[b++],i=o=d[b++],t.moveTo(r,o);break;case xMt.L:a=d[b++],s=d[b++];var k=EMt(a-r),S=EMt(s-o);if(k>p||S>f){if(m){if(y+(X=l[v++])>u){var C=(u-y)/X;t.lineTo(r*(1-C)+a*C,o*(1-C)+s*C);break t}y+=X}t.lineTo(a,s),r=a,o=s,x=0}else{var A=k*k+S*S;A>x&&(c=a,h=s,x=A)}break;case xMt.C:var I=d[b++],M=d[b++],D=d[b++],T=d[b++],E=d[b++],N=d[b++];if(m){if(y+(X=l[v++])>u){YIt(r,I,D,E,C=(u-y)/X,bMt),YIt(o,M,T,N,C,wMt),t.bezierCurveTo(bMt[1],wMt[1],bMt[2],wMt[2],bMt[3],wMt[3]);break t}y+=X}t.bezierCurveTo(I,M,D,T,E,N),r=E,o=N;break;case xMt.Q:I=d[b++],M=d[b++],D=d[b++],T=d[b++];if(m){if(y+(X=l[v++])>u){eMt(r,I,D,C=(u-y)/X,bMt),eMt(o,M,T,C,wMt),t.quadraticCurveTo(bMt[1],wMt[1],bMt[2],wMt[2]);break t}y+=X}t.quadraticCurveTo(I,M,D,T),r=D,o=T;break;case xMt.A:var O=d[b++],F=d[b++],R=d[b++],L=d[b++],$=d[b++],P=d[b++],z=d[b++],B=!d[b++],V=R>L?R:L,W=EMt(R-L)>.001,j=$+P,U=!1;if(m)y+(X=l[v++])>u&&(j=$+P*(u-y)/X,U=!0),y+=X;if(W&&t.ellipse?t.ellipse(O,F,R,L,z,$,j,B):t.arc(O,F,V,$,j,B),U)break t;_&&(n=MMt($)*R+O,i=DMt($)*L+F),r=MMt(j)*R+O,o=DMt(j)*L+F;break;case xMt.R:n=r=d[b],i=o=d[b+1],a=d[b++],s=d[b++];var G=d[b++],H=d[b++];if(m){if(y+(X=l[v++])>u){var q=u-y;t.moveTo(a,s),t.lineTo(a+AMt(q,G),s),(q-=G)>0&&t.lineTo(a+G,s+AMt(q,H)),(q-=H)>0&&t.lineTo(a+IMt(G-q,0),s+H),(q-=G)>0&&t.lineTo(a,s+IMt(H-q,0));break t}y+=X}t.rect(a,s,G,H);break;case xMt.Z:if(x>0&&(t.lineTo(c,h),x=0),m){var X;if(y+(X=l[v++])>u){C=(u-y)/X;t.lineTo(r*(1-C)+n*C,o*(1-C)+i*C);break t}y+=X}t.closePath(),r=n,o=i}}},t.CMD=xMt,t.initDefaultProps=((e=t.prototype)._saveData=!0,e._needsDash=!1,e._dashOffset=0,e._dashIdx=0,e._dashSum=0,e._ux=0,e._uy=0,e._pendingPtDist=0,void(e._version=0)),t}();function zMt(t,e,n,i,r,o,a){if(0===r)return!1;var s=r,l=0;if(a>e+s&&a>i+s||a<e-s&&a<i-s||o>t+s&&o>n+s||o<t-s&&o<n-s)return!1;if(t===n)return Math.abs(o-t)<=s/2;var u=(l=(e-i)/(t-n))*o-a+(t*i-n*e)/(t-n);return u*u/(l*l+1)<=s/2*s/2}function BMt(t,e,n,i,r,o,a,s,l,u,c){if(0===l)return!1;var h=l;return!(c>e+h&&c>i+h&&c>o+h&&c>s+h||c<e-h&&c<i-h&&c<o-h&&c<s-h||u>t+h&&u>n+h&&u>r+h&&u>a+h||u<t-h&&u<n-h&&u<r-h&&u<a-h)&&KIt(t,e,n,i,r,o,a,s,u,c,null)<=h/2}function VMt(t,e,n,i,r,o,a,s,l){if(0===a)return!1;var u=a;return!(l>e+u&&l>i+u&&l>o+u||l<e-u&&l<i-u&&l<o-u||s>t+u&&s>n+u&&s>r+u||s<t-u&&s<n-u&&s<r-u)&&nMt(t,e,n,i,r,o,s,l,null)<=u/2}var WMt=2*Math.PI;function jMt(t){return(t%=WMt)<0&&(t+=WMt),t}var UMt=2*Math.PI;function GMt(t,e,n,i,r,o,a,s,l){if(0===a)return!1;var u=a;s-=t,l-=e;var c=Math.sqrt(s*s+l*l);if(c-u>n||c+u<n)return!1;if(Math.abs(i-r)%UMt<1e-4)return!0;if(o){var h=i;i=jMt(r),r=jMt(h)}else i=jMt(i),r=jMt(r);i>r&&(r+=UMt);var d=Math.atan2(l,s);return d<0&&(d+=UMt),d>=i&&d<=r||d+UMt>=i&&d+UMt<=r}function HMt(t,e,n,i,r,o){if(o>e&&o>i||o<e&&o<i)return 0;if(i===e)return 0;var a=(o-e)/(i-e),s=i<e?1:-1;1!==a&&0!==a||(s=i<e?.5:-.5);var l=a*(n-t)+t;return l===r?1/0:l>r?s:0}var qMt=PMt.CMD,XMt=2*Math.PI;var YMt=[-1,-1,-1],KMt=[-1,-1];function ZMt(t,e,n,i,r,o,a,s,l,u){if(u>e&&u>i&&u>o&&u>s||u<e&&u<i&&u<o&&u<s)return 0;var c,h=qIt(e,i,o,s,u,YMt);if(0===h)return 0;for(var d=0,p=-1,f=void 0,g=void 0,m=0;m<h;m++){var y=YMt[m],v=0===y||1===y?.5:1;GIt(t,n,r,a,y)<l||(p<0&&(p=XIt(e,i,o,s,KMt),KMt[1]<KMt[0]&&p>1&&(c=void 0,c=KMt[0],KMt[0]=KMt[1],KMt[1]=c),f=GIt(e,i,o,s,KMt[0]),p>1&&(g=GIt(e,i,o,s,KMt[1]))),2===p?y<KMt[0]?d+=f<e?v:-v:y<KMt[1]?d+=g<f?v:-v:d+=s<g?v:-v:y<KMt[0]?d+=f<e?v:-v:d+=s<f?v:-v)}return d}function JMt(t,e,n,i,r,o,a,s){if(s>e&&s>i&&s>o||s<e&&s<i&&s<o)return 0;var l=function(t,e,n,i,r){var o=t-2*e+n,a=2*(e-t),s=t-i,l=0;if(jIt(o))UIt(a)&&(c=-s/a)>=0&&c<=1&&(r[l++]=c);else{var u=a*a-4*o*s;if(jIt(u))(c=-a/(2*o))>=0&&c<=1&&(r[l++]=c);else if(u>0){var c,h=$It(u),d=(-a-h)/(2*o);(c=(-a+h)/(2*o))>=0&&c<=1&&(r[l++]=c),d>=0&&d<=1&&(r[l++]=d)}}return l}(e,i,o,s,YMt);if(0===l)return 0;var u=tMt(e,i,o);if(u>=0&&u<=1){for(var c=0,h=JIt(e,i,o,u),d=0;d<l;d++){var p=0===YMt[d]||1===YMt[d]?.5:1;JIt(t,n,r,YMt[d])<a||(YMt[d]<u?c+=h<e?p:-p:c+=o<h?p:-p)}return c}p=0===YMt[0]||1===YMt[0]?.5:1;return JIt(t,n,r,YMt[0])<a?0:o<e?p:-p}function QMt(t,e,n,i,r,o,a,s){if((s-=e)>n||s<-n)return 0;var l=Math.sqrt(n*n-s*s);YMt[0]=-l,YMt[1]=l;var u=Math.abs(i-r);if(u<1e-4)return 0;if(u>=XMt-1e-4){i=0,r=XMt;var c=o?1:-1;return a>=YMt[0]+t&&a<=YMt[1]+t?c:0}if(i>r){var h=i;i=r,r=h}i<0&&(i+=XMt,r+=XMt);for(var d=0,p=0;p<2;p++){var f=YMt[p];if(f+t>a){var g=Math.atan2(s,f);c=o?1:-1;g<0&&(g=XMt+g),(g>=i&&g<=r||g+XMt>=i&&g+XMt<=r)&&(g>Math.PI/2&&g<1.5*Math.PI&&(c=-c),d+=c)}}return d}function tDt(t,e,n,i,r){for(var o,a,s,l,u=t.data,c=t.len(),h=0,d=0,p=0,f=0,g=0,m=0;m<c;){var y=u[m++],v=1===m;switch(y===qMt.M&&m>1&&(n||(h+=HMt(d,p,f,g,i,r))),v&&(f=d=u[m],g=p=u[m+1]),y){case qMt.M:d=f=u[m++],p=g=u[m++];break;case qMt.L:if(n){if(zMt(d,p,u[m],u[m+1],e,i,r))return!0}else h+=HMt(d,p,u[m],u[m+1],i,r)||0;d=u[m++],p=u[m++];break;case qMt.C:if(n){if(BMt(d,p,u[m++],u[m++],u[m++],u[m++],u[m],u[m+1],e,i,r))return!0}else h+=ZMt(d,p,u[m++],u[m++],u[m++],u[m++],u[m],u[m+1],i,r)||0;d=u[m++],p=u[m++];break;case qMt.Q:if(n){if(VMt(d,p,u[m++],u[m++],u[m],u[m+1],e,i,r))return!0}else h+=JMt(d,p,u[m++],u[m++],u[m],u[m+1],i,r)||0;d=u[m++],p=u[m++];break;case qMt.A:var x=u[m++],b=u[m++],w=u[m++],_=u[m++],k=u[m++],S=u[m++];m+=1;var C=!!(1-u[m++]);o=Math.cos(k)*w+x,a=Math.sin(k)*_+b,v?(f=o,g=a):h+=HMt(d,p,o,a,i,r);var A=(i-x)*_/w+x;if(n){if(GMt(x,b,_,k,k+S,C,e,A,r))return!0}else h+=QMt(x,b,_,k,k+S,C,A,r);d=Math.cos(k+S)*w+x,p=Math.sin(k+S)*_+b;break;case qMt.R:if(f=d=u[m++],g=p=u[m++],o=f+u[m++],a=g+u[m++],n){if(zMt(f,g,o,g,e,i,r)||zMt(o,g,o,a,e,i,r)||zMt(o,a,f,a,e,i,r)||zMt(f,a,f,g,e,i,r))return!0}else h+=HMt(o,g,o,a,i,r),h+=HMt(f,a,f,g,i,r);break;case qMt.Z:if(n){if(zMt(d,p,f,g,e,i,r))return!0}else h+=HMt(d,p,f,g,i,r);d=f,p=g}}return n||(s=p,l=g,Math.abs(s-l)<1e-4)||(h+=HMt(d,p,f,g,i,r)||0),0!==h}var eDt=x_t({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},DIt),nDt={style:x_t({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},TIt.style)},iDt=["x","y","rotation","scaleX","scaleY","originX","originY","invisible","culling","z","z2","zlevel","parent"],rDt=function(t){function e(e){return t.call(this,e)||this}var n;return Dit(e,t),e.prototype.update=function(){var n=this;t.prototype.update.call(this);var i=this.style;if(i.decal){var r=this._decalEl=this._decalEl||new e;r.buildPath===e.prototype.buildPath&&(r.buildPath=function(t){n.buildPath(t,n.shape)}),r.silent=!0;var o=r.style;for(var a in i)o[a]!==i[a]&&(o[a]=i[a]);o.fill=i.fill?i.decal:null,o.decal=null,o.shadowColor=null,i.strokeFirst&&(o.stroke=null);for(var s=0;s<iDt.length;++s)r[iDt[s]]=this[iDt[s]];r.__dirty|=1}else this._decalEl&&(this._decalEl=null)},e.prototype.getDecalElement=function(){return this._decalEl},e.prototype._init=function(e){var n=M_t(e);this.shape=this.getDefaultShape();var i=this.getDefaultStyle();i&&this.useStyle(i);for(var r=0;r<n.length;r++){var o=n[r],a=e[o];"style"===o?this.style?v_t(this.style,a):this.useStyle(a):"shape"===o?v_t(this.shape,a):t.prototype.attrKV.call(this,o,a)}this.style||this.useStyle({})},e.prototype.getDefaultStyle=function(){return null},e.prototype.getDefaultShape=function(){return{}},e.prototype.canBeInsideText=function(){return this.hasFill()},e.prototype.getInsideTextFill=function(){var t=this.style.fill;if("none"!==t){if(O_t(t)){var e=TSt(t,0);return e>.5?"#333":e>.2?"#eee":"#ccc"}if(t)return"#ccc"}return"#333"},e.prototype.getInsideTextStroke=function(t){var e=this.style.fill;if(O_t(e)){var n=this.__zr;if(!(!n||!n.isDarkMode())===TSt(t,0)<.4)return e}},e.prototype.buildPath=function(t,e,n){},e.prototype.pathUpdated=function(){this.__dirty&=-5},e.prototype.createPathProxy=function(){this.path=new PMt(!1)},e.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return!(null==e||"none"===e||!(t.lineWidth>0))},e.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},e.prototype.getBoundingRect=function(){var t=this._rect,e=this.style,n=!t;if(n){var i=!1;this.path||(i=!0,this.createPathProxy());var r=this.path;(i||4&this.__dirty)&&(r.beginPath(),this.buildPath(r,this.shape,!1),this.pathUpdated()),t=r.getBoundingRect()}if(this._rect=t,this.hasStroke()&&this.path&&this.path.len()>0){var o=this._rectWithStroke||(this._rectWithStroke=t.clone());if(this.__dirty||n){o.copy(t);var a=e.strokeNoScale?this.getLineScale():1,s=e.lineWidth;if(!this.hasFill()){var l=this.strokeContainThreshold;s=Math.max(s,null==l?4:l)}a>1e-10&&(o.width+=s/a,o.height+=s/a,o.x-=s/a/2,o.y-=s/a/2)}return o}return t},e.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e),i=this.getBoundingRect(),r=this.style;if(t=n[0],e=n[1],i.contain(t,e)){var o=this.path;if(this.hasStroke()){var a=r.lineWidth,s=r.strokeNoScale?this.getLineScale():1;if(s>1e-10&&(this.hasFill()||(a=Math.max(a,this.strokeContainThreshold)),function(t,e,n,i){return tDt(t,e,!0,n,i)}(o,a/s,t,e)))return!0}if(this.hasFill())return function(t,e,n){return tDt(t,0,!1,e,n)}(o,t,e)}return!1},e.prototype.dirtyShape=function(){this.__dirty|=4,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},e.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},e.prototype.animateShape=function(t){return this.animate("shape",t)},e.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():"shape"===t?this.dirtyShape():this.markRedraw()},e.prototype.attrKV=function(e,n){"shape"===e?this.setShape(n):t.prototype.attrKV.call(this,e,n)},e.prototype.setShape=function(t,e){var n=this.shape;return n||(n=this.shape={}),"string"==typeof t?n[t]=e:v_t(n,t),this.dirtyShape(),this},e.prototype.shapeChanged=function(){return!!(4&this.__dirty)},e.prototype.createStyle=function(t){return Q_t(eDt,t)},e.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var n=this._normalState;e.shape&&!n.shape&&(n.shape=v_t({},this.shape))},e.prototype._applyStateObj=function(e,n,i,r,o,a){t.prototype._applyStateObj.call(this,e,n,i,r,o,a);var s,l=!(n&&r);if(n&&n.shape?o?r?s=n.shape:(s=v_t({},i.shape),v_t(s,n.shape)):(s=v_t({},r?this.shape:i.shape),v_t(s,n.shape)):l&&(s=i.shape),s)if(o){this.shape=v_t({},this.shape);for(var u={},c=M_t(s),h=0;h<c.length;h++){var d=c[h];"object"==typeof s[d]?this.shape[d]=s[d]:u[d]=s[d]}this._transitionState(e,{shape:u},a)}else this.shape=s,this.dirtyShape()},e.prototype._mergeStates=function(e){for(var n,i=t.prototype._mergeStates.call(this,e),r=0;r<e.length;r++){var o=e[r];o.shape&&(n=n||{},this._mergeStyle(n,o.shape))}return n&&(i.shape=n),i},e.prototype.getAnimationStyleProps=function(){return nDt},e.prototype.isZeroArea=function(){return!1},e.extend=function(t){var n=function(e){function n(n){var i=e.call(this,n)||this;return t.init&&t.init.call(i,n),i}return Dit(n,e),n.prototype.getDefaultStyle=function(){return g_t(t.style)},n.prototype.getDefaultShape=function(){return g_t(t.shape)},n}(e);for(var i in t)"function"==typeof t[i]&&(n.prototype[i]=t[i]);return n},e.initDefaultProps=((n=e.prototype).type="path",n.strokeContainThreshold=5,n.segmentIgnoreThreshold=0,n.subPixelOptimize=!1,n.autoBatch=!1,void(n.__dirty=7)),e}(OIt),oDt=x_t({strokeFirst:!0,font:BCt,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},eDt),aDt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return null!=e&&"none"!==e&&t.lineWidth>0},e.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},e.prototype.createStyle=function(t){return Q_t(oDt,t)},e.prototype.setBoundingRect=function(t){this._rect=t},e.prototype.getBoundingRect=function(){var t=this.style;if(!this._rect){var e=t.text;null!=e?e+="":e="";var n=UCt(e,t.font,t.textAlign,t.textBaseline);if(n.x+=t.x||0,n.y+=t.y||0,this.hasStroke()){var i=t.lineWidth;n.x-=i/2,n.y-=i/2,n.width+=i,n.height+=i}this._rect=n}return this._rect},e.initDefaultProps=void(e.prototype.dirtyRectTolerance=10),e}(OIt);aDt.prototype.type="tspan";var sDt=x_t({x:0,y:0},DIt),lDt={style:x_t({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},TIt.style)};var uDt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.createStyle=function(t){return Q_t(sDt,t)},e.prototype._getSize=function(t){var e=this.style,n=e[t];if(null!=n)return n;var i,r=(i=e.image)&&"string"!=typeof i&&i.width&&i.height?e.image:this.__image;if(!r)return 0;var o="width"===t?"height":"width",a=e[o];return null==a?r[t]:r[t]/r[o]*a},e.prototype.getWidth=function(){return this._getSize("width")},e.prototype.getHeight=function(){return this._getSize("height")},e.prototype.getAnimationStyleProps=function(){return lDt},e.prototype.getBoundingRect=function(){var t=this.style;return this._rect||(this._rect=new PCt(t.x||0,t.y||0,this.getWidth(),this.getHeight())),this._rect},e}(OIt);uDt.prototype.type="image";var cDt=Math.round;function hDt(t,e,n){if(e){var i=e.x1,r=e.x2,o=e.y1,a=e.y2;t.x1=i,t.x2=r,t.y1=o,t.y2=a;var s=n&&n.lineWidth;return s?(cDt(2*i)===cDt(2*r)&&(t.x1=t.x2=pDt(i,s,!0)),cDt(2*o)===cDt(2*a)&&(t.y1=t.y2=pDt(o,s,!0)),t):t}}function dDt(t,e,n){if(e){var i=e.x,r=e.y,o=e.width,a=e.height;t.x=i,t.y=r,t.width=o,t.height=a;var s=n&&n.lineWidth;return s?(t.x=pDt(i,s,!0),t.y=pDt(r,s,!0),t.width=Math.max(pDt(i+o,s,!1)-t.x,0===o?0:1),t.height=Math.max(pDt(r+a,s,!1)-t.y,0===a?0:1),t):t}}function pDt(t,e,n){if(!e)return t;var i=cDt(2*t);return(i+cDt(e))%2==0?i/2:(i+(n?1:-1))/2}var fDt=function(){this.x=0,this.y=0,this.width=0,this.height=0},gDt={},mDt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new fDt},e.prototype.buildPath=function(t,e){var n,i,r,o;if(this.subPixelOptimize){var a=dDt(gDt,e,this.style);n=a.x,i=a.y,r=a.width,o=a.height,a.r=e.r,e=a}else n=e.x,i=e.y,r=e.width,o=e.height;e.r?function(t,e){var n,i,r,o,a,s=e.x,l=e.y,u=e.width,c=e.height,h=e.r;u<0&&(s+=u,u=-u),c<0&&(l+=c,c=-c),"number"==typeof h?n=i=r=o=h:h instanceof Array?1===h.length?n=i=r=o=h[0]:2===h.length?(n=r=h[0],i=o=h[1]):3===h.length?(n=h[0],i=o=h[1],r=h[2]):(n=h[0],i=h[1],r=h[2],o=h[3]):n=i=r=o=0,n+i>u&&(n*=u/(a=n+i),i*=u/a),r+o>u&&(r*=u/(a=r+o),o*=u/a),i+r>c&&(i*=c/(a=i+r),r*=c/a),n+o>c&&(n*=c/(a=n+o),o*=c/a),t.moveTo(s+n,l),t.lineTo(s+u-i,l),0!==i&&t.arc(s+u-i,l+i,i,-Math.PI/2,0),t.lineTo(s+u,l+c-r),0!==r&&t.arc(s+u-r,l+c-r,r,0,Math.PI/2),t.lineTo(s+o,l+c),0!==o&&t.arc(s+o,l+c-o,o,Math.PI/2,Math.PI),t.lineTo(s,l+n),0!==n&&t.arc(s+n,l+n,n,Math.PI,1.5*Math.PI)}(t,e):t.rect(n,i,r,o)},e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},e}(rDt);mDt.prototype.type="rect";var yDt={fill:"#000"},vDt={style:x_t({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},TIt.style)},xDt=function(t){function e(e){var n=t.call(this)||this;return n.type="text",n._children=[],n._defaultStyle=yDt,n.attr(e),n}return Dit(e,t),e.prototype.childrenRef=function(){return this._children},e.prototype.update=function(){this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var n=this._children[e];n.zlevel=this.zlevel,n.z=this.z,n.z2=this.z2,n.culling=this.culling,n.cursor=this.cursor,n.invisible=this.invisible}var i=this.attachedTransform;if(i){i.updateTransform();var r=i.transform;r?(this.transform=this.transform||[],fCt(this.transform,r)):this.transform=null}else t.prototype.update.call(this)},e.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),this.attachedTransform?this.attachedTransform.getComputedTransform():t.prototype.getComputedTransform.call(this)},e.prototype._updateSubTexts=function(){var t;this._childCursor=0,_Dt(t=this.style),S_t(t.rich,_Dt),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},e.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var n=0;n<this._children.length;n++)this._children[n].__zr=e},e.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var n=0;n<this._children.length;n++)this._children[n].__zr=null},e.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var t=new PCt(0,0,0,0),e=this._children,n=[],i=null,r=0;r<e.length;r++){var o=e[r],a=o.getBoundingRect(),s=o.getLocalTransform(n);s?(t.copy(a),t.applyTransform(s),(i=i||t.clone()).union(t)):(i=i||a.clone()).union(a)}this._rect=i||t}return this._rect},e.prototype.setDefaultTextStyle=function(t){this._defaultStyle=t||yDt},e.prototype.setTextContent=function(t){throw new Error("Can't attach text on another text")},e.prototype._mergeStyle=function(t,e){if(!e)return t;var n=e.rich,i=t.rich||n&&{};return v_t(t,e),n&&i?(this._mergeRich(i,n),t.rich=i):i&&(t.rich=i),t},e.prototype._mergeRich=function(t,e){for(var n=M_t(e),i=0;i<n.length;i++){var r=n[i];t[r]=t[r]||{},v_t(t[r],e[r])}},e.prototype.getAnimationStyleProps=function(){return vDt},e.prototype._getOrCreateChild=function(t){var e=this._children[this._childCursor];return e&&e instanceof t||(e=new t),this._children[this._childCursor++]=e,e.__zr=this.__zr,e.parent=this,e},e.prototype._updatePlainTexts=function(){var t=this.style,e=t.font||BCt,n=t.padding,i=function(t,e){null!=t&&(t+="");var n,i=e.overflow,r=e.padding,o=e.font,a="truncate"===i,s=qCt(o),l=W_t(e.lineHeight,s),u="truncate"===e.lineOverflow,c=e.width,h=(n=null!=c&&"break"===i||"breakAll"===i?t?IIt(t,e.font,c,"breakAll"===i,0).lines:[]:t?t.split("\n"):[]).length*l,d=W_t(e.height,h);if(h>d&&u){var p=Math.floor(d/l);n=n.slice(0,p)}var f=d,g=c;if(r&&(f+=r[0]+r[2],null!=g&&(g+=r[1]+r[3])),t&&a&&null!=g)for(var m=vIt(c,o,e.ellipsis,{minChar:e.truncateMinChar,placeholder:e.placeholder}),y=0;y<n.length;y++)n[y]=xIt(n[y],m);if(null==c){var v=0;for(y=0;y<n.length;y++)v=Math.max(WCt(n[y],o),v);c=v}return{lines:n,height:d,outerHeight:f,lineHeight:l,calculatedLineHeight:s,contentHeight:h,width:c}}(CDt(t),t),r=ADt(t),o=!!t.backgroundColor,a=i.outerHeight,s=i.lines,l=i.lineHeight,u=this._defaultStyle,c=t.x||0,h=t.y||0,d=t.align||u.align||"left",p=t.verticalAlign||u.verticalAlign||"top",f=c,g=HCt(h,i.contentHeight,p);if(r||n){var m=i.width;n&&(m+=n[1]+n[3]);var y=GCt(c,m,d),v=HCt(h,a,p);r&&this._renderBackground(t,t,y,v,m,a)}g+=l/2,n&&(f=SDt(c,d,n),"top"===p?g+=n[0]:"bottom"===p&&(g-=n[2]));for(var x,b=0,w=!1,_=(null==(x="fill"in t?t.fill:(w=!0,u.fill))||"none"===x?null:x.image||x.colorStops?"#000":x),k=(kDt("stroke"in t?t.stroke:o||u.autoStroke&&!w?null:(b=2,u.stroke))),S=t.textShadowBlur>0,C=null!=t.width&&("truncate"===t.overflow||"break"===t.overflow||"breakAll"===t.overflow),A=i.calculatedLineHeight,I=0;I<s.length;I++){var M=this._getOrCreateChild(aDt),D=M.createStyle();M.useStyle(D),D.text=s[I],D.x=f,D.y=g,d&&(D.textAlign=d),D.textBaseline="middle",D.opacity=t.opacity,D.strokeFirst=!0,S&&(D.shadowBlur=t.textShadowBlur||0,D.shadowColor=t.textShadowColor||"transparent",D.shadowOffsetX=t.textShadowOffsetX||0,D.shadowOffsetY=t.textShadowOffsetY||0),k&&(D.stroke=k,D.lineWidth=t.lineWidth||b,D.lineDash=t.lineDash,D.lineDashOffset=t.lineDashOffset||0),_&&(D.fill=_),D.font=e,g+=l,C&&M.setBoundingRect(new PCt(GCt(D.x,t.width,D.textAlign),HCt(D.y,A,D.textBaseline),t.width,A))}},e.prototype._updateRichTexts=function(){var t=this.style,e=function(t,e){var n=new kIt;if(null!=t&&(t+=""),!t)return n;for(var i,r=e.width,o=e.height,a=e.overflow,s="break"!==a&&"breakAll"!==a||null==r?null:{width:r,accumWidth:0,breakAll:"breakAll"===a},l=mIt.lastIndex=0;null!=(i=mIt.exec(t));){var u=i.index;u>l&&SIt(n,t.substring(l,u),e,s),SIt(n,i[2],e,s,i[1]),l=mIt.lastIndex}l<t.length&&SIt(n,t.substring(l,t.length),e,s);var c=[],h=0,d=0,p=e.padding,f="truncate"===a,g="truncate"===e.lineOverflow;function m(t,e,n){t.width=e,t.lineHeight=n,h+=n,d=Math.max(d,e)}t:for(var y=0;y<n.lines.length;y++){for(var v=n.lines[y],x=0,b=0,w=0;w<v.tokens.length;w++){var _=(N=v.tokens[w]).styleName&&e.rich[N.styleName]||{},k=N.textPadding=_.padding,S=k?k[1]+k[3]:0,C=N.font=_.font||e.font;N.contentHeight=qCt(C);var A=W_t(_.height,N.contentHeight);if(N.innerHeight=A,k&&(A+=k[0]+k[2]),N.height=A,N.lineHeight=j_t(_.lineHeight,e.lineHeight,A),N.align=_&&_.align||e.align,N.verticalAlign=_&&_.verticalAlign||"middle",g&&null!=o&&h+N.lineHeight>o){w>0?(v.tokens=v.tokens.slice(0,w),m(v,b,x),n.lines=n.lines.slice(0,y+1)):n.lines=n.lines.slice(0,y);break t}var I=_.width,M=null==I||"auto"===I;if("string"==typeof I&&"%"===I.charAt(I.length-1))N.percentWidth=I,c.push(N),N.contentWidth=WCt(N.text,C);else{if(M){var D=_.backgroundColor,T=D&&D.image;T&&gIt(T=dIt(T))&&(N.width=Math.max(N.width,T.width*A/T.height))}var E=f&&null!=r?r-b:null;null!=E&&E<N.width?!M||E<S?(N.text="",N.width=N.contentWidth=0):(N.text=yIt(N.text,E-S,C,e.ellipsis,{minChar:e.truncateMinChar}),N.width=N.contentWidth=WCt(N.text,C)):N.contentWidth=WCt(N.text,C)}N.width+=S,b+=N.width,_&&(x=Math.max(x,N.lineHeight))}m(v,b,x)}for(n.outerWidth=n.width=W_t(r,d),n.outerHeight=n.height=W_t(o,h),n.contentHeight=h,n.contentWidth=d,p&&(n.outerWidth+=p[1]+p[3],n.outerHeight+=p[0]+p[2]),y=0;y<c.length;y++){var N,O=(N=c[y]).percentWidth;N.width=parseInt(O,10)/100*n.width}return n}(CDt(t),t),n=e.width,i=e.outerWidth,r=e.outerHeight,o=t.padding,a=t.x||0,s=t.y||0,l=this._defaultStyle,u=t.align||l.align,c=t.verticalAlign||l.verticalAlign,h=GCt(a,i,u),d=HCt(s,r,c),p=h,f=d;o&&(p+=o[3],f+=o[0]);var g=p+n;ADt(t)&&this._renderBackground(t,t,h,d,i,r);for(var m=!!t.backgroundColor,y=0;y<e.lines.length;y++){for(var v=e.lines[y],x=v.tokens,b=x.length,w=v.lineHeight,_=v.width,k=0,S=p,C=g,A=b-1,I=void 0;k<b&&(!(I=x[k]).align||"left"===I.align);)this._placeToken(I,t,w,f,S,"left",m),_-=I.width,S+=I.width,k++;for(;A>=0&&"right"===(I=x[A]).align;)this._placeToken(I,t,w,f,C,"right",m),_-=I.width,C-=I.width,A--;for(S+=(n-(S-p)-(g-C)-_)/2;k<=A;)I=x[k],this._placeToken(I,t,w,f,S+I.width/2,"center",m),S+=I.width,k++;f+=w}},e.prototype._placeToken=function(t,e,n,i,r,o,a){var s=e.rich[t.styleName]||{};s.text=t.text;var l=t.verticalAlign,u=i+n/2;"top"===l?u=i+t.height/2:"bottom"===l&&(u=i+n-t.height/2),!t.isLineHolder&&ADt(s)&&this._renderBackground(s,e,"right"===o?r-t.width:"center"===o?r-t.width/2:r,u-t.height/2,t.width,t.height);var c=!!s.backgroundColor,h=t.textPadding;h&&(r=SDt(r,o,h),u-=t.height/2-h[0]-t.innerHeight/2);var d=this._getOrCreateChild(aDt),p=d.createStyle();d.useStyle(p);var f=this._defaultStyle,g=!1,m=0,y=kDt("fill"in s?s.fill:"fill"in e?e.fill:(g=!0,f.fill)),v=kDt("stroke"in s?s.stroke:"stroke"in e?e.stroke:c||a||f.autoStroke&&!g?null:(m=2,f.stroke)),x=s.textShadowBlur>0||e.textShadowBlur>0;p.text=t.text,p.x=r,p.y=u,x&&(p.shadowBlur=s.textShadowBlur||e.textShadowBlur||0,p.shadowColor=s.textShadowColor||e.textShadowColor||"transparent",p.shadowOffsetX=s.textShadowOffsetX||e.textShadowOffsetX||0,p.shadowOffsetY=s.textShadowOffsetY||e.textShadowOffsetY||0),p.textAlign=o,p.textBaseline="middle",p.font=t.font||BCt,p.opacity=j_t(s.opacity,e.opacity,1),v&&(p.lineWidth=j_t(s.lineWidth,e.lineWidth,m),p.lineDash=W_t(s.lineDash,e.lineDash),p.lineDashOffset=e.lineDashOffset||0,p.stroke=v),y&&(p.fill=y);var b=t.contentWidth,w=t.contentHeight;d.setBoundingRect(new PCt(GCt(p.x,b,p.textAlign),HCt(p.y,w,p.textBaseline),b,w))},e.prototype._renderBackground=function(t,e,n,i,r,o){var a,s,l,u=t.backgroundColor,c=t.borderWidth,h=t.borderColor,d=u&&u.image,p=u&&!d,f=t.borderRadius,g=this;if(p||c&&h){(a=this._getOrCreateChild(mDt)).useStyle(a.createStyle()),a.style.fill=null;var m=a.shape;m.x=n,m.y=i,m.width=r,m.height=o,m.r=f,a.dirtyShape()}if(p)(l=a.style).fill=u||null,l.fillOpacity=W_t(t.fillOpacity,1);else if(d){(s=this._getOrCreateChild(uDt)).onload=function(){g.dirtyStyle()};var y=s.style;y.image=u.image,y.x=n,y.y=i,y.width=r,y.height=o}c&&h&&((l=a.style).lineWidth=c,l.stroke=h,l.strokeOpacity=W_t(t.strokeOpacity,1),l.lineDash=t.borderDash,l.lineDashOffset=t.borderDashOffset||0,a.strokeContainThreshold=0,a.hasFill()&&a.hasStroke()&&(l.strokeFirst=!0,l.lineWidth*=2));var v=(a||s).style;v.shadowBlur=t.shadowBlur||0,v.shadowColor=t.shadowColor||"transparent",v.shadowOffsetX=t.shadowOffsetX||0,v.shadowOffsetY=t.shadowOffsetY||0,v.opacity=j_t(t.opacity,e.opacity,1)},e.makeFont=function(t){var e="";if(t.fontSize||t.fontFamily||t.fontWeight){var n="";n="string"!=typeof t.fontSize||-1===t.fontSize.indexOf("px")&&-1===t.fontSize.indexOf("rem")&&-1===t.fontSize.indexOf("em")?isNaN(+t.fontSize)?"12px":t.fontSize+"px":t.fontSize,e=[t.fontStyle,t.fontWeight,n,t.fontFamily||"sans-serif"].join(" ")}return e&&q_t(e)||t.textFont||t.font},e}(OIt),bDt={left:!0,right:1,center:1},wDt={top:1,bottom:1,middle:1};function _Dt(t){if(t){t.font=xDt.makeFont(t);var e=t.align;"middle"===e&&(e="center"),t.align=null==e||bDt[e]?e:"left";var n=t.verticalAlign;"center"===n&&(n="middle"),t.verticalAlign=null==n||wDt[n]?n:"top",t.padding&&(t.padding=G_t(t.padding))}}function kDt(t,e){return null==t||e<=0||"transparent"===t||"none"===t?null:t.image||t.colorStops?"#000":t}function SDt(t,e,n){return"right"===e?t-n[1]:"center"===e?t+n[3]/2-n[1]/2:t+n[3]}function CDt(t){var e=t.text;return null!=e&&(e+=""),e}function ADt(t){return!!(t.backgroundColor||t.borderWidth&&t.borderColor)}var IDt=jAt(),MDt=1,DDt={},TDt=jAt(),EDt=["emphasis","blur","select"],NDt=["normal","emphasis","blur","select"];function ODt(t){return null!=t&&"none"!==t}var FDt=new uSt(100);function RDt(t){if("string"!=typeof t)return t;var e=FDt.get(t);return e||(e=SSt(t,-.1),FDt.put(t,e)),e}function LDt(t,e,n){t.onHoverStateChange&&(t.hoverState||0)!==n&&t.onHoverStateChange(e),t.hoverState=n}function $Dt(t){LDt(t,"emphasis",2)}function PDt(t){2===t.hoverState&&LDt(t,"normal",0)}function zDt(t){LDt(t,"blur",1)}function BDt(t){1===t.hoverState&&LDt(t,"normal",0)}function VDt(t){t.selected=!0}function WDt(t){t.selected=!1}function jDt(t,e,n){e(t,n)}function UDt(t,e,n){jDt(t,e,n),t.isGroup&&t.traverse((function(t){jDt(t,e,n)}))}function GDt(t,e){switch(e){case"emphasis":t.hoverState=2;break;case"normal":t.hoverState=0;break;case"blur":t.hoverState=1;break;case"select":t.selected=!0}}function HDt(t,e){var n=this.states[t];if(this.style){if("emphasis"===t)return function(t,e,n,i){var r=n&&w_t(n,"select")>=0,o=!1;if(t instanceof rDt){var a=TDt(t),s=r&&a.selectFill||a.normalFill,l=r&&a.selectStroke||a.normalStroke;if(ODt(s)||ODt(l)){var u=(i=i||{}).style||{};!ODt(u.fill)&&ODt(s)?(o=!0,i=v_t({},i),(u=v_t({},u)).fill=RDt(s)):!ODt(u.stroke)&&ODt(l)&&(o||(i=v_t({},i),u=v_t({},u)),u.stroke=RDt(l)),i.style=u}}if(i&&null==i.z2){o||(i=v_t({},i));var c=t.z2EmphasisLift;i.z2=t.z2+(null!=c?c:10)}return i}(this,0,e,n);if("blur"===t)return function(t,e,n){var i=w_t(t.currentStates,e)>=0,r=t.style.opacity,o=i?null:function(t,e,n,i){for(var r=t.style,o={},a=0;a<e.length;a++){var s=e[a],l=r[s];o[s]=null==l?i&&i[s]:l}for(a=0;a<t.animators.length;a++){var u=t.animators[a];u.__fromStateTransition&&u.__fromStateTransition.indexOf(n)<0&&"style"===u.targetName&&u.saveFinalToTarget(o,e)}return o}(t,["opacity"],e,{opacity:1}),a=(n=n||{}).style||{};return null==a.opacity&&(n=v_t({},n),a=v_t({opacity:i?r:.1*o.opacity},a),n.style=a),n}(this,t,n);if("select"===t)return function(t,e,n){if(n&&null==n.z2){n=v_t({},n);var i=t.z2SelectLift;n.z2=t.z2+(null!=i?i:9)}return n}(this,0,n)}return n}function qDt(t){t.stateProxy=HDt;var e=t.getTextContent(),n=t.getTextGuideLine();e&&(e.stateProxy=HDt),n&&(n.stateProxy=HDt)}function XDt(t,e){!nTt(t,e)&&!t.__highByOuter&&UDt(t,$Dt)}function YDt(t,e){!nTt(t,e)&&!t.__highByOuter&&UDt(t,PDt)}function KDt(t,e){t.__highByOuter|=1<<(e||0),UDt(t,$Dt)}function ZDt(t,e){!(t.__highByOuter&=~(1<<(e||0)))&&UDt(t,PDt)}function JDt(t){UDt(t,zDt)}function QDt(t){UDt(t,BDt)}function tTt(t){UDt(t,VDt)}function eTt(t){UDt(t,WDt)}function nTt(t,e){return t.__highDownSilentOnTouch&&e.zrByTouch}function iTt(t){t.getModel().eachComponent((function(e,n){("series"===e?t.getViewOfSeriesModel(n):t.getViewOfComponentModel(n)).group.traverse((function(t){BDt(t)}))}))}function rTt(t,e,n,i){var r=i.getModel();function o(t,e){for(var n=0;n<e.length;n++){var i=t.getItemGraphicEl(e[n]);i&&QDt(i)}}if(n=n||"coordinateSystem",null!=t&&e&&"none"!==e){var a=r.getSeriesByIndex(t),s=a.coordinateSystem;s&&s.master&&(s=s.master);var l=[];r.eachSeries((function(t){var r=a===t,u=t.coordinateSystem;if(u&&u.master&&(u=u.master),!("series"===n&&!r||"coordinateSystem"===n&&!(u&&s?u===s:r)||"series"===e&&r)){if(i.getViewOfSeriesModel(t).group.traverse((function(t){zDt(t)})),k_t(e))o(t.getData(),e);else if(L_t(e))for(var c=M_t(e),h=0;h<c.length;h++)o(t.getData(c[h]),e[c[h]]);l.push(t)}})),r.eachComponent((function(t,e){if("series"!==t){var n=i.getViewOfComponentModel(e);n&&n.blurSeries&&n.blurSeries(l,r)}}))}}function oTt(t,e,n){if(null!=t&&null!=e){var i=n.getModel().getComponent(t,e);if(i){var r=n.getViewOfComponentModel(i);r&&r.focusBlurEnabled&&r.group.traverse((function(t){zDt(t)}))}}}function aTt(t,e,n,i){var r={focusSelf:!1,dispatchers:null};if(null==t||"series"===t||null==e||null==n)return r;var o=i.getModel().getComponent(t,e);if(!o)return r;var a=i.getViewOfComponentModel(o);if(!a||!a.findHighDownDispatchers)return r;for(var s,l=a.findHighDownDispatchers(n),u=0;u<l.length;u++)if("self"===IDt(l[u]).focus){s=!0;break}return{focusSelf:s,dispatchers:l}}function sTt(t){S_t(t.getAllData(),(function(e){var n=e.data,i=e.type;n.eachItemGraphicEl((function(e,n){t.isSelected(n,i)?tTt(e):eTt(e)}))}))}function lTt(t){var e=[];return t.eachSeries((function(t){S_t(t.getAllData(),(function(n){n.data;var i=n.type,r=t.getSelectedDataIndices();if(r.length>0){var o={dataIndex:r,seriesIndex:t.seriesIndex};null!=i&&(o.dataType=i),e.push(o)}}))})),e}function uTt(t,e,n){fTt(t,!0),UDt(t,qDt),cTt(t,e,n)}function cTt(t,e,n){var i=IDt(t);null!=e?(i.focus=e,i.blurScope=n):i.focus&&(i.focus=null)}var hTt=["emphasis","blur","select"],dTt={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function pTt(t,e,n,i){n=n||"itemStyle";for(var r=0;r<hTt.length;r++){var o=hTt[r],a=e.getModel([o,n]);t.ensureState(o).style=i?i(a):a[dTt[n]]()}}function fTt(t,e){var n=!1===e,i=t;t.highDownSilentOnTouch&&(i.__highDownSilentOnTouch=t.highDownSilentOnTouch),n&&!i.__highDownDispatcher||(i.__highByOuter=i.__highByOuter||0,i.__highDownDispatcher=!n)}function gTt(t){return!(!t||!t.__highDownDispatcher)}function mTt(t){var e=t.type;return"select"===e||"unselect"===e||"toggleSelect"===e}function yTt(t){var e=t.type;return"highlight"===e||"downplay"===e}var vTt=PMt.CMD,xTt=[[],[],[]],bTt=Math.sqrt,wTt=Math.atan2;var _Tt=Math.sqrt,kTt=Math.sin,STt=Math.cos,CTt=Math.PI;function ATt(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ITt(t,e){return(t[0]*e[0]+t[1]*e[1])/(ATt(t)*ATt(e))}function MTt(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(ITt(t,e))}function DTt(t,e,n,i,r,o,a,s,l,u,c){var h=l*(CTt/180),d=STt(h)*(t-n)/2+kTt(h)*(e-i)/2,p=-1*kTt(h)*(t-n)/2+STt(h)*(e-i)/2,f=d*d/(a*a)+p*p/(s*s);f>1&&(a*=_Tt(f),s*=_Tt(f));var g=(r===o?-1:1)*_Tt((a*a*(s*s)-a*a*(p*p)-s*s*(d*d))/(a*a*(p*p)+s*s*(d*d)))||0,m=g*a*p/s,y=g*-s*d/a,v=(t+n)/2+STt(h)*m-kTt(h)*y,x=(e+i)/2+kTt(h)*m+STt(h)*y,b=MTt([1,0],[(d-m)/a,(p-y)/s]),w=[(d-m)/a,(p-y)/s],_=[(-1*d-m)/a,(-1*p-y)/s],k=MTt(w,_);if(ITt(w,_)<=-1&&(k=CTt),ITt(w,_)>=1&&(k=0),k<0){var S=Math.round(k/CTt*1e6)/1e6;k=2*CTt+S%2*CTt}c.addData(u,v,x,a,s,b,k,h,o)}var TTt=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,ETt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;var NTt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.applyTransform=function(t){},e}(rDt);function OTt(t){return null!=t.setData}function FTt(t,e){var n=function(t){var e=new PMt;if(!t)return e;var n,i=0,r=0,o=i,a=r,s=PMt.CMD,l=t.match(TTt);if(!l)return e;for(var u=0;u<l.length;u++){for(var c=l[u],h=c.charAt(0),d=void 0,p=c.match(ETt)||[],f=p.length,g=0;g<f;g++)p[g]=parseFloat(p[g]);for(var m=0;m<f;){var y=void 0,v=void 0,x=void 0,b=void 0,w=void 0,_=void 0,k=void 0,S=i,C=r,A=void 0,I=void 0;switch(h){case"l":i+=p[m++],r+=p[m++],d=s.L,e.addData(d,i,r);break;case"L":i=p[m++],r=p[m++],d=s.L,e.addData(d,i,r);break;case"m":i+=p[m++],r+=p[m++],d=s.M,e.addData(d,i,r),o=i,a=r,h="l";break;case"M":i=p[m++],r=p[m++],d=s.M,e.addData(d,i,r),o=i,a=r,h="L";break;case"h":i+=p[m++],d=s.L,e.addData(d,i,r);break;case"H":i=p[m++],d=s.L,e.addData(d,i,r);break;case"v":r+=p[m++],d=s.L,e.addData(d,i,r);break;case"V":r=p[m++],d=s.L,e.addData(d,i,r);break;case"C":d=s.C,e.addData(d,p[m++],p[m++],p[m++],p[m++],p[m++],p[m++]),i=p[m-2],r=p[m-1];break;case"c":d=s.C,e.addData(d,p[m++]+i,p[m++]+r,p[m++]+i,p[m++]+r,p[m++]+i,p[m++]+r),i+=p[m-2],r+=p[m-1];break;case"S":y=i,v=r,A=e.len(),I=e.data,n===s.C&&(y+=i-I[A-4],v+=r-I[A-3]),d=s.C,S=p[m++],C=p[m++],i=p[m++],r=p[m++],e.addData(d,y,v,S,C,i,r);break;case"s":y=i,v=r,A=e.len(),I=e.data,n===s.C&&(y+=i-I[A-4],v+=r-I[A-3]),d=s.C,S=i+p[m++],C=r+p[m++],i+=p[m++],r+=p[m++],e.addData(d,y,v,S,C,i,r);break;case"Q":S=p[m++],C=p[m++],i=p[m++],r=p[m++],d=s.Q,e.addData(d,S,C,i,r);break;case"q":S=p[m++]+i,C=p[m++]+r,i+=p[m++],r+=p[m++],d=s.Q,e.addData(d,S,C,i,r);break;case"T":y=i,v=r,A=e.len(),I=e.data,n===s.Q&&(y+=i-I[A-4],v+=r-I[A-3]),i=p[m++],r=p[m++],d=s.Q,e.addData(d,y,v,i,r);break;case"t":y=i,v=r,A=e.len(),I=e.data,n===s.Q&&(y+=i-I[A-4],v+=r-I[A-3]),i+=p[m++],r+=p[m++],d=s.Q,e.addData(d,y,v,i,r);break;case"A":x=p[m++],b=p[m++],w=p[m++],_=p[m++],k=p[m++],DTt(S=i,C=r,i=p[m++],r=p[m++],_,k,x,b,w,d=s.A,e);break;case"a":x=p[m++],b=p[m++],w=p[m++],_=p[m++],k=p[m++],DTt(S=i,C=r,i+=p[m++],r+=p[m++],_,k,x,b,w,d=s.A,e)}}"z"!==h&&"Z"!==h||(d=s.Z,e.addData(d),i=o,r=a),n=d}return e.toStatic(),e}(t),i=v_t({},e);return i.buildPath=function(t){if(OTt(t)){t.setData(n.data),(e=t.getContext())&&t.rebuildPath(e,1)}else{var e=t;n.rebuildPath(e,1)}},i.applyTransform=function(t){!function(t,e){var n,i,r,o,a,s,l=t.data,u=t.len(),c=vTt.M,h=vTt.C,d=vTt.L,p=vTt.R,f=vTt.A,g=vTt.Q;for(r=0,o=0;r<u;){switch(n=l[r++],o=r,i=0,n){case c:case d:i=1;break;case h:i=3;break;case g:i=2;break;case f:var m=e[4],y=e[5],v=bTt(e[0]*e[0]+e[1]*e[1]),x=bTt(e[2]*e[2]+e[3]*e[3]),b=wTt(-e[1]/x,e[0]/v);l[r]*=v,l[r++]+=m,l[r]*=x,l[r++]+=y,l[r++]*=v,l[r++]*=x,l[r++]+=b,l[r++]+=b,o=r+=2;break;case p:s[0]=l[r++],s[1]=l[r++],gkt(s,s,e),l[o++]=s[0],l[o++]=s[1],s[0]+=l[r++],s[1]+=l[r++],gkt(s,s,e),l[o++]=s[0],l[o++]=s[1]}for(a=0;a<i;a++){var w=xTt[a];w[0]=l[r++],w[1]=l[r++],gkt(w,w,e),l[o++]=w[0],l[o++]=w[1]}}t.increaseVersion()}(n,t),this.dirtyShape()},i}function RTt(t,e){return new NTt(FTt(t,e))}var LTt=function(){this.cx=0,this.cy=0,this.r=0},$Tt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new LTt},e.prototype.buildPath=function(t,e,n){n&&t.moveTo(e.cx+e.r,e.cy),t.arc(e.cx,e.cy,e.r,0,2*Math.PI)},e}(rDt);$Tt.prototype.type="circle";var PTt=function(){this.cx=0,this.cy=0,this.rx=0,this.ry=0},zTt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new PTt},e.prototype.buildPath=function(t,e){var n=.5522848,i=e.cx,r=e.cy,o=e.rx,a=e.ry,s=o*n,l=a*n;t.moveTo(i-o,r),t.bezierCurveTo(i-o,r-l,i-s,r-a,i,r-a),t.bezierCurveTo(i+s,r-a,i+o,r-l,i+o,r),t.bezierCurveTo(i+o,r+l,i+s,r+a,i,r+a),t.bezierCurveTo(i-s,r+a,i-o,r+l,i-o,r),t.closePath()},e}(rDt);zTt.prototype.type="ellipse";var BTt=Math.PI,VTt=2*BTt,WTt=Math.sin,jTt=Math.cos,UTt=Math.acos,GTt=Math.atan2,HTt=Math.abs,qTt=Math.sqrt,XTt=Math.max,YTt=Math.min,KTt=1e-4;function ZTt(t,e,n,i,r,o,a){var s=t-n,l=e-i,u=(a?o:-o)/qTt(s*s+l*l),c=u*l,h=-u*s,d=t+c,p=e+h,f=n+c,g=i+h,m=(d+f)/2,y=(p+g)/2,v=f-d,x=g-p,b=v*v+x*x,w=r-o,_=d*g-f*p,k=(x<0?-1:1)*qTt(XTt(0,w*w*b-_*_)),S=(_*x-v*k)/b,C=(-_*v-x*k)/b,A=(_*x+v*k)/b,I=(-_*v+x*k)/b,M=S-m,D=C-y,T=A-m,E=I-y;return M*M+D*D>T*T+E*E&&(S=A,C=I),{cx:S,cy:C,x01:-c,y01:-h,x11:S*(r/w-1),y11:C*(r/w-1)}}function JTt(t,e){var n=XTt(e.r,0),i=XTt(e.r0||0,0),r=n>0;if(r||i>0){if(r||(n=i,i=0),i>n){var o=n;n=i,i=o}var a,s=!!e.clockwise,l=e.startAngle,u=e.endAngle;if(l===u)a=0;else{var c=[l,u];$Mt(c,!s),a=HTt(c[0]-c[1])}var h=e.cx,d=e.cy,p=e.cornerRadius||0,f=e.innerCornerRadius||0;if(n>KTt)if(a>VTt-KTt)t.moveTo(h+n*jTt(l),d+n*WTt(l)),t.arc(h,d,n,l,u,!s),i>KTt&&(t.moveTo(h+i*jTt(u),d+i*WTt(u)),t.arc(h,d,i,u,l,s));else{var g=HTt(n-i)/2,m=YTt(g,p),y=YTt(g,f),v=y,x=m,b=n*jTt(l),w=n*WTt(l),_=i*jTt(u),k=i*WTt(u),S=void 0,C=void 0,A=void 0,I=void 0;if((m>KTt||y>KTt)&&(S=n*jTt(u),C=n*WTt(u),A=i*jTt(l),I=i*WTt(l),a<BTt)){var M=function(t,e,n,i,r,o,a,s){var l=n-t,u=i-e,c=a-r,h=s-o,d=h*l-c*u;if(!(d*d<KTt))return[t+(d=(c*(e-o)-h*(t-r))/d)*l,e+d*u]}(b,w,A,I,S,C,_,k);if(M){var D=b-M[0],T=w-M[1],E=S-M[0],N=C-M[1],O=1/WTt(UTt((D*E+T*N)/(qTt(D*D+T*T)*qTt(E*E+N*N)))/2),F=qTt(M[0]*M[0]+M[1]*M[1]);v=YTt(y,(i-F)/(O-1)),x=YTt(m,(n-F)/(O+1))}}if(a>KTt)if(x>KTt){var R=ZTt(A,I,b,w,n,x,s),L=ZTt(S,C,_,k,n,x,s);t.moveTo(h+R.cx+R.x01,d+R.cy+R.y01),x<m?t.arc(h+R.cx,d+R.cy,x,GTt(R.y01,R.x01),GTt(L.y01,L.x01),!s):(t.arc(h+R.cx,d+R.cy,x,GTt(R.y01,R.x01),GTt(R.y11,R.x11),!s),t.arc(h,d,n,GTt(R.cy+R.y11,R.cx+R.x11),GTt(L.cy+L.y11,L.cx+L.x11),!s),t.arc(h+L.cx,d+L.cy,x,GTt(L.y11,L.x11),GTt(L.y01,L.x01),!s))}else t.moveTo(h+b,d+w),t.arc(h,d,n,l,u,!s);else t.moveTo(h+b,d+w);if(i>KTt&&a>KTt)if(v>KTt){R=ZTt(_,k,S,C,i,-v,s),L=ZTt(b,w,A,I,i,-v,s);t.lineTo(h+R.cx+R.x01,d+R.cy+R.y01),v<y?t.arc(h+R.cx,d+R.cy,v,GTt(R.y01,R.x01),GTt(L.y01,L.x01),!s):(t.arc(h+R.cx,d+R.cy,v,GTt(R.y01,R.x01),GTt(R.y11,R.x11),!s),t.arc(h,d,i,GTt(R.cy+R.y11,R.cx+R.x11),GTt(L.cy+L.y11,L.cx+L.x11),s),t.arc(h+L.cx,d+L.cy,v,GTt(L.y11,L.x11),GTt(L.y01,L.x01),!s))}else t.lineTo(h+_,d+k),t.arc(h,d,i,u,l,s);else t.lineTo(h+_,d+k)}else t.moveTo(h,d);t.closePath()}}var QTt=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0,this.innerCornerRadius=0},tEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new QTt},e.prototype.buildPath=function(t,e){JTt(t,e)},e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},e}(rDt);tEt.prototype.type="sector";var eEt=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0},nEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new eEt},e.prototype.buildPath=function(t,e){var n=e.cx,i=e.cy,r=2*Math.PI;t.moveTo(n+e.r,i),t.arc(n,i,e.r,0,r,!1),t.moveTo(n+e.r0,i),t.arc(n,i,e.r0,0,r,!0)},e}(rDt);function iEt(t,e,n,i,r,o,a){var s=.5*(n-t),l=.5*(i-e);return(2*(e-n)+s+l)*a+(-3*(e-n)-2*s-l)*o+s*r+e}function rEt(t,e,n){var i=e.smooth,r=e.points;if(r&&r.length>=2){if(i&&"spline"!==i){var o=function(t,e,n,i){var r,o,a,s,l=[],u=[],c=[],h=[];if(i){a=[1/0,1/0],s=[-1/0,-1/0];for(var d=0,p=t.length;d<p;d++)mkt(a,a,t[d]),ykt(s,s,t[d]);mkt(a,a,i[0]),ykt(s,s,i[1])}for(d=0,p=t.length;d<p;d++){var f=t[d];if(n)r=t[d?d-1:p-1],o=t[(d+1)%p];else{if(0===d||d===p-1){l.push(rkt(t[d]));continue}r=t[d-1],o=t[d+1]}skt(u,o,r),ukt(u,u,e);var g=hkt(f,r),m=hkt(f,o),y=g+m;0!==y&&(g/=y,m/=y),ukt(c,u,-g),ukt(h,u,m);var v=okt([],f,c),x=okt([],f,h);i&&(ykt(v,v,a),mkt(v,v,s),ykt(x,x,a),mkt(x,x,s)),l.push(v),l.push(x)}return n&&l.push(l.shift()),l}(r,i,n,e.smoothConstraint);t.moveTo(r[0][0],r[0][1]);for(var a=r.length,s=0;s<(n?a:a-1);s++){var l=o[2*s],u=o[2*s+1],c=r[(s+1)%a];t.bezierCurveTo(l[0],l[1],u[0],u[1],c[0],c[1])}}else{"spline"===i&&(r=function(t,e){for(var n=t.length,i=[],r=0,o=1;o<n;o++)r+=hkt(t[o-1],t[o]);var a=r/2;for(a=a<n?n:a,o=0;o<a;o++){var s=o/(a-1)*(e?n:n-1),l=Math.floor(s),u=s-l,c=void 0,h=t[l%n],d=void 0,p=void 0;e?(c=t[(l-1+n)%n],d=t[(l+1)%n],p=t[(l+2)%n]):(c=t[0===l?l:l-1],d=t[l>n-2?n-1:l+1],p=t[l>n-3?n-1:l+2]);var f=u*u,g=u*f;i.push([iEt(c[0],h[0],d[0],p[0],u,f,g),iEt(c[1],h[1],d[1],p[1],u,f,g)])}return i}(r,n)),t.moveTo(r[0][0],r[0][1]);s=1;for(var h=r.length;s<h;s++)t.lineTo(r[s][0],r[s][1])}n&&t.closePath()}}nEt.prototype.type="ring";var oEt=function(){this.points=null,this.smooth=0,this.smoothConstraint=null},aEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new oEt},e.prototype.buildPath=function(t,e){rEt(t,e,!0)},e}(rDt);aEt.prototype.type="polygon";var sEt=function(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null},lEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new sEt},e.prototype.buildPath=function(t,e){rEt(t,e,!1)},e}(rDt);lEt.prototype.type="polyline";var uEt={},cEt=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1},hEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new cEt},e.prototype.buildPath=function(t,e){var n,i,r,o;if(this.subPixelOptimize){var a=hDt(uEt,e,this.style);n=a.x1,i=a.y1,r=a.x2,o=a.y2}else n=e.x1,i=e.y1,r=e.x2,o=e.y2;var s=e.percent;0!==s&&(t.moveTo(n,i),s<1&&(r=n*(1-s)+r*s,o=i*(1-s)+o*s),t.lineTo(r,o))},e.prototype.pointAt=function(t){var e=this.shape;return[e.x1*(1-t)+e.x2*t,e.y1*(1-t)+e.y2*t]},e}(rDt);hEt.prototype.type="line";var dEt=[],pEt=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1};function fEt(t,e,n){var i=t.cpx2,r=t.cpy2;return null===i||null===r?[(n?HIt:GIt)(t.x1,t.cpx1,t.cpx2,t.x2,e),(n?HIt:GIt)(t.y1,t.cpy1,t.cpy2,t.y2,e)]:[(n?QIt:JIt)(t.x1,t.cpx1,t.x2,e),(n?QIt:JIt)(t.y1,t.cpy1,t.y2,e)]}var gEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new pEt},e.prototype.buildPath=function(t,e){var n=e.x1,i=e.y1,r=e.x2,o=e.y2,a=e.cpx1,s=e.cpy1,l=e.cpx2,u=e.cpy2,c=e.percent;0!==c&&(t.moveTo(n,i),null==l||null==u?(c<1&&(eMt(n,a,r,c,dEt),a=dEt[1],r=dEt[2],eMt(i,s,o,c,dEt),s=dEt[1],o=dEt[2]),t.quadraticCurveTo(a,s,r,o)):(c<1&&(YIt(n,a,l,r,c,dEt),a=dEt[1],l=dEt[2],r=dEt[3],YIt(i,s,u,o,c,dEt),s=dEt[1],u=dEt[2],o=dEt[3]),t.bezierCurveTo(a,s,l,u,r,o)))},e.prototype.pointAt=function(t){return fEt(this.shape,t,!1)},e.prototype.tangentAt=function(t){var e=fEt(this.shape,t,!0);return ckt(e,e)},e}(rDt);gEt.prototype.type="bezier-curve";var mEt=function(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0},yEt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new mEt},e.prototype.buildPath=function(t,e){var n=e.cx,i=e.cy,r=Math.max(e.r,0),o=e.startAngle,a=e.endAngle,s=e.clockwise,l=Math.cos(o),u=Math.sin(o);t.moveTo(l*r+n,u*r+i),t.arc(n,i,r,o,a,!s)},e}(rDt);yEt.prototype.type="arc";var vEt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="compound",e}return Dit(e,t),e.prototype._updatePathDirty=function(){for(var t=this.shape.paths,e=this.shapeChanged(),n=0;n<t.length;n++)e=e||t[n].shapeChanged();e&&this.dirtyShape()},e.prototype.beforeBrush=function(){this._updatePathDirty();for(var t=this.shape.paths||[],e=this.getGlobalScale(),n=0;n<t.length;n++)t[n].path||t[n].createPathProxy(),t[n].path.setScale(e[0],e[1],t[n].segmentIgnoreThreshold)},e.prototype.buildPath=function(t,e){for(var n=e.paths||[],i=0;i<n.length;i++)n[i].buildPath(t,n[i].shape,!0)},e.prototype.afterBrush=function(){for(var t=this.shape.paths||[],e=0;e<t.length;e++)t[e].pathUpdated()},e.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),rDt.prototype.getBoundingRect.call(this)},e}(rDt),xEt=function(){function t(t){this.colorStops=t||[]}return t.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},t}(),bEt=function(t){function e(e,n,i,r,o,a){var s=t.call(this,o)||this;return s.x=null==e?0:e,s.y=null==n?0:n,s.x2=null==i?1:i,s.y2=null==r?0:r,s.type="linear",s.global=a||!1,s}return Dit(e,t),e}(xEt),wEt=function(t){function e(e,n,i,r,o){var a=t.call(this,r)||this;return a.x=null==e?.5:e,a.y=null==n?.5:n,a.r=null==i?.5:i,a.type="radial",a.global=o||!1,a}return Dit(e,t),e}(xEt),_Et=[0,0],kEt=[0,0],SEt=new DCt,CEt=new DCt,AEt=function(){function t(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var n=0;n<4;n++)this._corners[n]=new DCt;for(n=0;n<2;n++)this._axes[n]=new DCt;t&&this.fromBoundingRect(t,e)}return t.prototype.fromBoundingRect=function(t,e){var n=this._corners,i=this._axes,r=t.x,o=t.y,a=r+t.width,s=o+t.height;if(n[0].set(r,o),n[1].set(a,o),n[2].set(a,s),n[3].set(r,s),e)for(var l=0;l<4;l++)n[l].transform(e);DCt.sub(i[0],n[1],n[0]),DCt.sub(i[1],n[3],n[0]),i[0].normalize(),i[1].normalize();for(l=0;l<2;l++)this._origin[l]=i[l].dot(n[0])},t.prototype.intersect=function(t,e){var n=!0,i=!e;return SEt.set(1/0,1/0),CEt.set(0,0),!this._intersectCheckOneSide(this,t,SEt,CEt,i,1)&&(n=!1,i)||!this._intersectCheckOneSide(t,this,SEt,CEt,i,-1)&&(n=!1,i)||i||DCt.copy(e,n?SEt:CEt),n},t.prototype._intersectCheckOneSide=function(t,e,n,i,r,o){for(var a=!0,s=0;s<2;s++){var l=this._axes[s];if(this._getProjMinMaxOnAxis(s,t._corners,_Et),this._getProjMinMaxOnAxis(s,e._corners,kEt),_Et[1]<kEt[0]||_Et[0]>kEt[1]){if(a=!1,r)return a;var u=Math.abs(kEt[0]-_Et[1]),c=Math.abs(_Et[0]-kEt[1]);Math.min(u,c)>i.len()&&(u<c?DCt.scale(i,l,-u*o):DCt.scale(i,l,c*o))}else if(n){u=Math.abs(kEt[0]-_Et[1]),c=Math.abs(_Et[0]-kEt[1]);Math.min(u,c)<n.len()&&(u<c?DCt.scale(n,l,u*o):DCt.scale(n,l,-c*o))}}return a},t.prototype._getProjMinMaxOnAxis=function(t,e,n){for(var i=this._axes[t],r=this._origin,o=e[0].dot(i)+r[t],a=o,s=o,l=1;l<e.length;l++){var u=e[l].dot(i)+r[t];a=Math.min(u,a),s=Math.max(u,s)}n[0]=a,n[1]=s},t}(),IEt=[],MEt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return Dit(e,t),e.prototype.traverse=function(t,e){t.call(e,this)},e.prototype.useStyle=function(){this.style={}},e.prototype.getCursor=function(){return this._cursor},e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},e.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},e.prototype.addDisplayable=function(t,e){e?this._temporaryDisplayables.push(t):this._displayables.push(t),this.markRedraw()},e.prototype.addDisplayables=function(t,e){e=e||!1;for(var n=0;n<t.length;n++)this.addDisplayable(t[n],e)},e.prototype.getDisplayables=function(){return this._displayables},e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},e.prototype.eachPendingDisplayable=function(t){for(var e=this._cursor;e<this._displayables.length;e++)t&&t(this._displayables[e]);for(e=0;e<this._temporaryDisplayables.length;e++)t&&t(this._temporaryDisplayables[e])},e.prototype.update=function(){this.updateTransform();for(var t=this._cursor;t<this._displayables.length;t++){(e=this._displayables[t]).parent=this,e.update(),e.parent=null}for(t=0;t<this._temporaryDisplayables.length;t++){var e;(e=this._temporaryDisplayables[t]).parent=this,e.update(),e.parent=null}},e.prototype.getBoundingRect=function(){if(!this._rect){for(var t=new PCt(1/0,1/0,-1/0,-1/0),e=0;e<this._displayables.length;e++){var n=this._displayables[e],i=n.getBoundingRect().clone();n.needLocalTransform()&&i.applyTransform(n.getLocalTransform(IEt)),t.union(i)}this._rect=t}return this._rect},e.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e);if(this.getBoundingRect().contain(n[0],n[1]))for(var i=0;i<this._displayables.length;i++){if(this._displayables[i].contain(t,e))return!0}return!1},e}(OIt),DEt=Math.max,TEt=Math.min,EEt={};var NEt=function(t,e){var n=FTt(t,e);return function(t){function e(e){var i=t.call(this,e)||this;return i.applyTransform=n.applyTransform,i.buildPath=n.buildPath,i}return Dit(e,t),e}(NTt)};function OEt(t,e){EEt[t]=e}function FEt(t){if(EEt.hasOwnProperty(t))return EEt[t]}function REt(t,e,n,i){var r=RTt(t,e);return n&&("center"===i&&(n=$Et(n,r.getBoundingRect())),zEt(r,n)),r}function LEt(t,e,n){var i=new uDt({style:{image:t,x:e.x,y:e.y,width:e.width,height:e.height},onload:function(t){if("center"===n){var r={width:t.width,height:t.height};i.setStyle($Et(e,r))}}});return i}function $Et(t,e){var n,i=e.width/e.height,r=t.height*i;return n=r<=t.width?t.height:(r=t.width)/i,{x:t.x+t.width/2-r/2,y:t.y+t.height/2-n/2,width:r,height:n}}var PEt=function(t,e){for(var n=[],i=t.length,r=0;r<i;r++){var o=t[r];o.path||o.createPathProxy(),o.shapeChanged()&&o.buildPath(o.path,o.shape,!0),n.push(o.path)}var a=new rDt(e);return a.createPathProxy(),a.buildPath=function(t){if(OTt(t)){t.appendPath(n);var e=t.getContext();e&&t.rebuildPath(e,1)}},a};function zEt(t,e){if(t.applyTransform){var n=t.getBoundingRect().calculateTransform(e);t.applyTransform(n)}}var BEt=pDt;function VEt(t,e,n,i,r,o,a){var s,l=!1;"function"==typeof r?(a=o,o=r,r=null):L_t(r)&&(o=r.cb,a=r.during,l=r.isFrom,s=r.removeOpt,r=r.dataIndex);var u,c="update"===t,h="remove"===t;if(i&&i.ecModel){var d=i.ecModel.getUpdatePayload();u=d&&d.animation}var p=i&&i.isAnimationEnabled();if(h||e.stopAnimation("remove"),p){var f=void 0,g=void 0,m=void 0;u?(f=u.duration||0,g=u.easing||"cubicOut",m=u.delay||0):h?(f=W_t((s=s||{}).duration,200),g=W_t(s.easing,"cubicOut"),m=0):(f=i.getShallow(c?"animationDurationUpdate":"animationDuration"),g=i.getShallow(c?"animationEasingUpdate":"animationEasing"),m=i.getShallow(c?"animationDelayUpdate":"animationDelay")),"function"==typeof m&&(m=m(r,i.getAnimationDelayParams?i.getAnimationDelayParams(e,r):null)),"function"==typeof f&&(f=f(r)),f>0?l?e.animateFrom(n,{duration:f,delay:m||0,easing:g,done:o,force:!!o||!!a,scope:t,during:a}):e.animateTo(n,{duration:f,delay:m||0,easing:g,done:o,force:!!o||!!a,setToFinal:!0,scope:t,during:a}):(e.stopAnimation(),!l&&e.attr(n),o&&o())}else e.stopAnimation(),!l&&e.attr(n),a&&a(1),o&&o()}function WEt(t,e,n,i,r,o){VEt("update",t,e,n,i,r,o)}function jEt(t,e,n,i,r,o){VEt("init",t,e,n,i,r,o)}function UEt(t,e,n,i,r,o){qEt(t)||VEt("remove",t,e,n,i,r,o)}function GEt(t,e,n,i){t.removeTextContent(),t.removeTextGuideLine(),UEt(t,{style:{opacity:0}},e,n,i)}function HEt(t,e,n){function i(){t.parent&&t.parent.remove(t)}t.isGroup?t.traverse((function(t){t.isGroup||GEt(t,e,n,i)})):GEt(t,e,n,i)}function qEt(t){if(!t.__zr)return!0;for(var e=0;e<t.animators.length;e++){if("remove"===t.animators[e].scope)return!0}return!1}function XEt(t,e){for(var n=pCt([]);t&&t!==e;)gCt(n,t.getLocalTransform(),n),t=t.parent;return n}function YEt(t,e,n){return e&&!k_t(e)&&(e=MCt.getLocalTransform(e)),n&&(e=xCt([],e)),gkt([],t,e)}function KEt(t,e,n){var i=0===e[4]||0===e[5]||0===e[0]?1:Math.abs(2*e[4]/e[0]),r=0===e[4]||0===e[5]||0===e[2]?1:Math.abs(2*e[4]/e[2]),o=["left"===t?-i:"right"===t?i:0,"top"===t?-r:"bottom"===t?r:0];return o=YEt(o,e,n),Math.abs(o[0])>Math.abs(o[1])?o[0]>0?"right":"left":o[1]>0?"bottom":"top"}function ZEt(t){return!t.isGroup}function JEt(t,e,n){if(t&&e){var i,r=(i={},t.traverse((function(t){ZEt(t)&&t.anid&&(i[t.anid]=t)})),i);e.traverse((function(t){if(ZEt(t)&&t.anid){var e=r[t.anid];if(e){var i=o(t);t.attr(o(e)),WEt(t,i,n,IDt(t).dataIndex)}}}))}function o(t){var e={x:t.x,y:t.y,rotation:t.rotation};return function(t){return null!=t.shape}(t)&&(e.shape=v_t({},t.shape)),e}}function QEt(t,e){return C_t(t,(function(t){var n=t[0];n=DEt(n,e.x),n=TEt(n,e.x+e.width);var i=t[1];return i=DEt(i,e.y),[n,i=TEt(i,e.y+e.height)]}))}function tNt(t,e,n){var i=v_t({rectHover:!0},e),r=i.style={strokeNoScale:!0};if(n=n||{x:-1,y:-1,width:2,height:2},t)return 0===t.indexOf("image://")?(r.image=t.slice(8),x_t(r,n),new uDt(i)):REt(t.replace("path://",""),i,n,"center")}function eNt(t,e,n,i,r){for(var o=0,a=r[r.length-1];o<r.length;o++){var s=r[o];if(nNt(t,e,n,i,s[0],s[1],a[0],a[1]))return!0;a=s}}function nNt(t,e,n,i,r,o,a,s){var l,u=n-t,c=i-e,h=a-r,d=s-o,p=iNt(h,d,u,c);if((l=p)<=1e-6&&l>=-1e-6)return!1;var f=t-r,g=e-o,m=iNt(f,g,u,c)/p;if(m<0||m>1)return!1;var y=iNt(f,g,h,d)/p;return!(y<0||y>1)}function iNt(t,e,n,i){return t*i-n*e}function rNt(t){var e=t.itemTooltipOption,n=t.componentModel,i=t.itemName,r=O_t(e)?{formatter:e}:e,o=n.mainType,a=n.componentIndex,s={componentType:o,name:i,$vars:["name"]};s[o+"Index"]=a;var l=t.formatterParamsExtra;l&&S_t(M_t(l),(function(t){tkt(s,t)||(s[t]=l[t],s.$vars.push(t))}));var u=IDt(t.el);u.componentMainType=o,u.componentIndex=a,u.tooltipConfig={name:i,option:x_t({content:i,formatterParams:s},r)}}OEt("circle",$Tt),OEt("ellipse",zTt),OEt("sector",tEt),OEt("ring",nEt),OEt("polygon",aEt),OEt("polyline",lEt),OEt("rect",mDt),OEt("line",hEt),OEt("bezierCurve",gEt),OEt("arc",yEt);var oNt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",extendShape:function(t){return rDt.extend(t)},extendPath:function(t,e){return NEt(t,e)},registerShape:OEt,getShapeClass:FEt,makePath:REt,makeImage:LEt,mergePath:PEt,resizePath:zEt,subPixelOptimizeLine:function(t){return hDt(t.shape,t.shape,t.style),t},subPixelOptimizeRect:function(t){return dDt(t.shape,t.shape,t.style),t},subPixelOptimize:BEt,updateProps:WEt,initProps:jEt,removeElement:UEt,removeElementWithFadeOut:HEt,isElementRemoved:qEt,getTransform:XEt,applyTransform:YEt,transformDirection:KEt,groupTransition:JEt,clipPointsByRect:QEt,clipRectByRect:function(t,e){var n=DEt(t.x,e.x),i=TEt(t.x+t.width,e.x+e.width),r=DEt(t.y,e.y),o=TEt(t.y+t.height,e.y+e.height);if(i>=n&&o>=r)return{x:n,y:r,width:i-n,height:o-r}},createIcon:tNt,linePolygonIntersect:eNt,lineLineIntersect:nNt,setTooltipConfig:rNt,Group:oAt,Image:uDt,Text:xDt,Circle:$Tt,Ellipse:zTt,Sector:tEt,Ring:nEt,Polygon:aEt,Polyline:lEt,Rect:mDt,Line:hEt,BezierCurve:gEt,Arc:yEt,IncrementalDisplayable:MEt,CompoundPath:vEt,LinearGradient:bEt,RadialGradient:wEt,BoundingRect:PCt,OrientedBoundingRect:AEt,Point:DCt,Path:rDt}),aNt={};function sNt(t,e){for(var n=0;n<EDt.length;n++){var i=EDt[n],r=e[i],o=t.ensureState(i);o.style=o.style||{},o.style.text=r}var a=t.currentStates.slice();t.clearStates(!0),t.setStyle({text:e.normal}),t.useStates(a,!0)}function lNt(t,e,n){var i,r=t.labelFetcher,o=t.labelDataIndex,a=t.labelDimIndex,s=e.normal;r&&(i=r.getFormattedLabel(o,"normal",null,a,s&&s.get("formatter"),null!=n?{interpolatedValue:n}:null)),null==i&&(i=N_t(t.defaultText)?t.defaultText(o,t,n):t.defaultText);for(var l={normal:i},u=0;u<EDt.length;u++){var c=EDt[u],h=e[c];l[c]=W_t(r?r.getFormattedLabel(o,c,null,a,h&&h.get("formatter")):null,i)}return l}function uNt(t,e,n,i){n=n||aNt;for(var r=t instanceof xDt,o=!1,a=0;a<NDt.length;a++){if((d=e[NDt[a]])&&d.getShallow("show")){o=!0;break}}var s=r?t:t.getTextContent();if(o){r||(s||(s=new xDt,t.setTextContent(s)),t.stateProxy&&(s.stateProxy=t.stateProxy));var l=lNt(n,e),u=e.normal,c=!!u.getShallow("show"),h=hNt(u,i&&i.normal,n,!1,!r);h.text=l.normal,r||t.setTextConfig(dNt(u,n,!1));for(a=0;a<EDt.length;a++){var d,p=EDt[a];if(d=e[p]){var f=s.ensureState(p),g=!!W_t(d.getShallow("show"),c);if(g!==c&&(f.ignore=!g),f.style=hNt(d,i&&i[p],n,!0,!r),f.style.text=l[p],!r)t.ensureState(p).textConfig=dNt(d,n,!0)}}s.silent=!!u.getShallow("silent"),null!=s.style.x&&(h.x=s.style.x),null!=s.style.y&&(h.y=s.style.y),s.ignore=!c,s.useStyle(h),s.dirty(),n.enableTextSetter&&(vNt(s).setLabelText=function(t){var i=lNt(n,e,t);sNt(s,i)})}else s&&(s.ignore=!0);t.dirty()}function cNt(t,e){e=e||"label";for(var n={normal:t.getModel(e)},i=0;i<EDt.length;i++){var r=EDt[i];n[r]=t.getModel([r,e])}return n}function hNt(t,e,n,i,r){var o={};return function(t,e,n,i,r){n=n||aNt;var o,a=e.ecModel,s=a&&a.option.textStyle,l=function(t){var e;for(;t&&t!==t.ecModel;){var n=(t.option||aNt).rich;if(n){e=e||{};for(var i=M_t(n),r=0;r<i.length;r++){e[i[r]]=1}}t=t.parentModel}return e}(e);if(l)for(var u in o={},l)if(l.hasOwnProperty(u)){var c=e.getModel(["rich",u]);mNt(o[u]={},c,s,n,i,r,!1,!0)}o&&(t.rich=o);var h=e.get("overflow");h&&(t.overflow=h);var d=e.get("minMargin");null!=d&&(t.margin=d);mNt(t,e,s,n,i,r,!0,!1)}(o,t,n,i,r),e&&v_t(o,e),o}function dNt(t,e,n){e=e||{};var i,r={},o=t.getShallow("rotate"),a=W_t(t.getShallow("distance"),n?null:5),s=t.getShallow("offset");return"outside"===(i=t.getShallow("position")||(n?null:"inside"))&&(i=e.defaultOutsidePosition||"top"),null!=i&&(r.position=i),null!=s&&(r.offset=s),null!=o&&(o*=Math.PI/180,r.rotation=o),null!=a&&(r.distance=a),r.outsideFill="inherit"===t.get("color")?e.inheritColor||null:"auto",r}var pNt=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],fNt=["align","lineHeight","width","height","tag","verticalAlign"],gNt=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function mNt(t,e,n,i,r,o,a,s){n=!r&&n||aNt;var l=i&&i.inheritColor,u=e.getShallow("color"),c=e.getShallow("textBorderColor"),h=W_t(e.getShallow("opacity"),n.opacity);"inherit"!==u&&"auto"!==u||(u=l||null),"inherit"!==c&&"auto"!==c||(c=l||null),o||(u=u||n.color,c=c||n.textBorderColor),null!=u&&(t.fill=u),null!=c&&(t.stroke=c);var d=W_t(e.getShallow("textBorderWidth"),n.textBorderWidth);null!=d&&(t.lineWidth=d);var p=W_t(e.getShallow("textBorderType"),n.textBorderType);null!=p&&(t.lineDash=p);var f=W_t(e.getShallow("textBorderDashOffset"),n.textBorderDashOffset);null!=f&&(t.lineDashOffset=f),r||null!=h||s||(h=i&&i.defaultOpacity),null!=h&&(t.opacity=h),r||o||null==t.fill&&i.inheritColor&&(t.fill=i.inheritColor);for(var g=0;g<pNt.length;g++){var m=pNt[g];null!=(v=W_t(e.getShallow(m),n[m]))&&(t[m]=v)}for(g=0;g<fNt.length;g++){m=fNt[g];null!=(v=e.getShallow(m))&&(t[m]=v)}if(null==t.verticalAlign){var y=e.getShallow("baseline");null!=y&&(t.verticalAlign=y)}if(!a||!i.disableBox){for(g=0;g<gNt.length;g++){var v;m=gNt[g];null!=(v=e.getShallow(m))&&(t[m]=v)}var x=e.getShallow("borderType");null!=x&&(t.borderDash=x),"auto"!==t.backgroundColor&&"inherit"!==t.backgroundColor||!l||(t.backgroundColor=l),"auto"!==t.borderColor&&"inherit"!==t.borderColor||!l||(t.borderColor=l)}}function yNt(t,e){var n=e&&e.getModel("textStyle");return q_t([t.fontStyle||n&&n.getShallow("fontStyle")||"",t.fontWeight||n&&n.getShallow("fontWeight")||"",(t.fontSize||n&&n.getShallow("fontSize")||12)+"px",t.fontFamily||n&&n.getShallow("fontFamily")||"sans-serif"].join(" "))}var vNt=jAt();function xNt(t,e,n,i){if(t){var r=vNt(t);r.prevValue=r.value,r.value=n;var o=e.normal;r.valueAnimation=o.get("valueAnimation"),r.valueAnimation&&(r.precision=o.get("precision"),r.defaultInterpolatedText=i,r.statesModels=e)}}function bNt(t,e,n,i,r){var o=vNt(t);if(o.valueAnimation){var a=o.defaultInterpolatedText,s=W_t(o.interpolatedValue,o.prevValue),l=o.value;(null==s?jEt:WEt)(t,{},i,e,null,(function(i){var u=JAt(n,o.precision,s,l,i);o.interpolatedValue=1===i?null:u;var c=lNt({labelDataIndex:e,labelFetcher:r,defaultText:a?a(u):u+""},o.statesModels,u);sNt(t,c)}))}}var wNt,_Nt,kNt=["textStyle","color"],SNt=new xDt,CNt=function(){function t(){}return t.prototype.getTextColor=function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(kNt):null)},t.prototype.getFont=function(){return yNt({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},t.prototype.getTextRect=function(t){return SNt.useStyle({text:t,fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily"),verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline"),padding:this.getShallow("padding"),lineHeight:this.getShallow("lineHeight"),rich:this.getShallow("rich")}),SNt.update(),SNt.getBoundingRect()},t}(),ANt=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],INt=lIt(ANt),MNt=function(){function t(){}return t.prototype.getLineStyle=function(t){return INt(this,t)},t}(),DNt=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],TNt=lIt(DNt),ENt=function(){function t(){}return t.prototype.getItemStyle=function(t,e){return TNt(this,t,e)},t}(),NNt=function(){function t(t,e,n){this.parentModel=e,this.ecModel=n,this.option=t}return t.prototype.init=function(t,e,n){for(var i=[],r=3;r<arguments.length;r++)i[r-3]=arguments[r]},t.prototype.mergeOption=function(t,e){m_t(this.option,t,!0)},t.prototype.get=function(t,e){return null==t?this.option:this._doGet(this.parsePath(t),!e&&this.parentModel)},t.prototype.getShallow=function(t,e){var n=this.option,i=null==n?n:n[t];if(null==i&&!e){var r=this.parentModel;r&&(i=r.getShallow(t))}return i},t.prototype.getModel=function(e,n){var i=null!=e,r=i?this.parsePath(e):null;return new t(i?this._doGet(r):this.option,n=n||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(r)),this.ecModel)},t.prototype.isEmpty=function(){return null==this.option},t.prototype.restoreData=function(){},t.prototype.clone=function(){return new(0,this.constructor)(g_t(this.option))},t.prototype.parsePath=function(t){return"string"==typeof t?t.split("."):t},t.prototype.resolveParentPath=function(t){return t},t.prototype.isAnimationEnabled=function(){if(!t_t.node&&this.option){if(null!=this.option.animation)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},t.prototype._doGet=function(t,e){var n=this.option;if(!t)return n;for(var i=0;i<t.length&&(!t[i]||null!=(n=n&&"object"==typeof n?n[t[i]]:null));i++);return null==n&&e&&(n=e._doGet(this.resolveParentPath(t),e.parentModel)),n},t}();eIt(NNt),wNt=NNt,_Nt=["__\0is_clz",rIt++].join("_"),wNt.prototype[_Nt]=!0,wNt.isInstance=function(t){return!(!t||!t[_Nt])},__t(NNt,MNt),__t(NNt,ENt),__t(NNt,cIt),__t(NNt,CNt);var ONt=Math.round(10*Math.random());function FNt(t){return[t||"",ONt++].join("_")}function RNt(t,e){return m_t(m_t({},t,!0),e,!0)}var LNt={},$Nt={},PNt=t_t.domSupported&&(document.documentElement.lang||navigator.language||navigator.browserLanguage).toUpperCase().indexOf("ZH")>-1?"ZH":"EN";function zNt(t,e){t=t.toUpperCase(),$Nt[t]=new NNt(e),LNt[t]=e}zNt("EN",{time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}}),zNt("ZH",{time:{month:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthAbbr:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayOfWeekAbbr:["日","一","二","三","四","五","六"]},legend:{selector:{all:"全选",inverse:"反选"}},toolbox:{brush:{title:{rect:"矩形选择",polygon:"圈选",lineX:"横向选择",lineY:"纵向选择",keep:"保持选择",clear:"清除选择"}},dataView:{title:"数据视图",lang:["数据视图","关闭","刷新"]},dataZoom:{title:{zoom:"区域缩放",back:"区域缩放还原"}},magicType:{title:{line:"切换为折线图",bar:"切换为柱状图",stack:"切换为堆叠",tiled:"切换为平铺"}},restore:{title:"还原"},saveAsImage:{title:"保存为图片",lang:["右键另存为图片"]}},series:{typeNames:{pie:"饼图",bar:"柱状图",line:"折线图",scatter:"散点图",effectScatter:"涟漪散点图",radar:"雷达图",tree:"树图",treemap:"矩形树图",boxplot:"箱型图",candlestick:"K线图",k:"K线图",heatmap:"热力图",map:"地图",parallel:"平行坐标图",lines:"线图",graph:"关系图",sankey:"桑基图",funnel:"漏斗图",gauge:"仪表盘图",pictorialBar:"象形柱图",themeRiver:"主题河流图",sunburst:"旭日图"}},aria:{general:{withTitle:"这是一个关于“{title}”的图表。",withoutTitle:"这是一个图表，"},series:{single:{prefix:"",withName:"图表类型是{seriesType}，表示{seriesName}。",withoutName:"图表类型是{seriesType}。"},multiple:{prefix:"它由{seriesCount}个图表系列组成。",withName:"第{seriesId}个系列是一个表示{seriesName}的{seriesType}，",withoutName:"第{seriesId}个系列是一个{seriesType}，",separator:{middle:"；",end:"。"}}},data:{allData:"其数据是——",partialData:"其中，前{displayCnt}项是——",withName:"{name}的数据是{value}",withoutName:"{value}",separator:{middle:"，",end:""}}}});var BNt={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{hh}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {hh}:{mm}:{ss} {SSS}"},VNt={year:"{yyyy}",month:"{yyyy}-{MM}",day:"{yyyy}-{MM}-{dd}",hour:"{yyyy}-{MM}-{dd} "+BNt.hour,minute:"{yyyy}-{MM}-{dd} "+BNt.minute,second:"{yyyy}-{MM}-{dd} "+BNt.second,millisecond:BNt.none},WNt=["year","month","day","hour","minute","second","millisecond"],jNt=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function UNt(t,e){return"0000".substr(0,e-(t+="").length)+t}function GNt(t){switch(t){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return t}}function HNt(t){return t===GNt(t)}function qNt(t,e,n,i){var r=wAt(t),o=r[KNt(n)](),a=r[ZNt(n)]()+1,s=Math.floor((a-1)/4)+1,l=r[JNt(n)](),u=r["get"+(n?"UTC":"")+"Day"](),c=r[QNt(n)](),h=(c-1)%12+1,d=r[tOt(n)](),p=r[eOt(n)](),f=r[nOt(n)](),g=(i instanceof NNt?i:function(t){return $Nt[t]}(i||PNt)||$Nt.EN).getModel("time"),m=g.get("month"),y=g.get("monthAbbr"),v=g.get("dayOfWeek"),x=g.get("dayOfWeekAbbr");return(e||"").replace(/{yyyy}/g,o+"").replace(/{yy}/g,o%100+"").replace(/{Q}/g,s+"").replace(/{MMMM}/g,m[a-1]).replace(/{MMM}/g,y[a-1]).replace(/{MM}/g,UNt(a,2)).replace(/{M}/g,a+"").replace(/{dd}/g,UNt(l,2)).replace(/{d}/g,l+"").replace(/{eeee}/g,v[u]).replace(/{ee}/g,x[u]).replace(/{e}/g,u+"").replace(/{HH}/g,UNt(c,2)).replace(/{H}/g,c+"").replace(/{hh}/g,UNt(h+"",2)).replace(/{h}/g,h+"").replace(/{mm}/g,UNt(d,2)).replace(/{m}/g,d+"").replace(/{ss}/g,UNt(p,2)).replace(/{s}/g,p+"").replace(/{SSS}/g,UNt(f,3)).replace(/{S}/g,f+"")}function XNt(t,e){var n=wAt(t),i=n[ZNt(e)]()+1,r=n[JNt(e)](),o=n[QNt(e)](),a=n[tOt(e)](),s=n[eOt(e)](),l=0===n[nOt(e)](),u=l&&0===s,c=u&&0===a,h=c&&0===o,d=h&&1===r;return d&&1===i?"year":d?"month":h?"day":c?"hour":u?"minute":l?"second":"millisecond"}function YNt(t,e,n){var i="number"==typeof t?wAt(t):t;switch(e=e||XNt(t,n)){case"year":return i[KNt(n)]();case"half-year":return i[ZNt(n)]()>=6?1:0;case"quarter":return Math.floor((i[ZNt(n)]()+1)/4);case"month":return i[ZNt(n)]();case"day":return i[JNt(n)]();case"half-day":return i[QNt(n)]()/24;case"hour":return i[QNt(n)]();case"minute":return i[tOt(n)]();case"second":return i[eOt(n)]();case"millisecond":return i[nOt(n)]()}}function KNt(t){return t?"getUTCFullYear":"getFullYear"}function ZNt(t){return t?"getUTCMonth":"getMonth"}function JNt(t){return t?"getUTCDate":"getDate"}function QNt(t){return t?"getUTCHours":"getHours"}function tOt(t){return t?"getUTCMinutes":"getMinutes"}function eOt(t){return t?"getUTCSeconds":"getSeconds"}function nOt(t){return t?"getUTCSeconds":"getSeconds"}function iOt(t){return t?"setUTCFullYear":"setFullYear"}function rOt(t){return t?"setUTCMonth":"setMonth"}function oOt(t){return t?"setUTCDate":"setDate"}function aOt(t){return t?"setUTCHours":"setHours"}function sOt(t){return t?"setUTCMinutes":"setMinutes"}function lOt(t){return t?"setUTCSeconds":"setSeconds"}function uOt(t){return t?"setUTCSeconds":"setSeconds"}function cOt(t){if(!IAt(t))return O_t(t)?t:"-";var e=(t+"").split(".");return e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:"")}function hOt(t,e){return t=(t||"").toLowerCase().replace(/-(.)/g,(function(t,e){return e.toUpperCase()})),e&&t&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t}var dOt=G_t,pOt=/([&<>"'])/g,fOt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function gOt(t){return null==t?"":(t+"").replace(pOt,(function(t,e){return fOt[e]}))}function mOt(t,e,n){function i(t){return t&&q_t(t)?t:"-"}function r(t){return!(null==t||isNaN(t)||!isFinite(t))}var o="time"===e,a=t instanceof Date;if(o||a){var s=o?wAt(t):t;if(!isNaN(+s))return qNt(s,"{yyyy}-{MM}-{dd} {hh}:{mm}:{ss}",n);if(a)return"-"}if("ordinal"===e)return F_t(t)?i(t):R_t(t)&&r(t)?t+"":"-";var l=AAt(t);return r(l)?cOt(l):F_t(t)?i(t):"-"}var yOt=["a","b","c","d","e","f","g"],vOt=function(t,e){return"{"+t+(null==e?"":e)+"}"};function xOt(t,e,n){E_t(e)||(e=[e]);var i=e.length;if(!i)return"";for(var r=e[0].$vars||[],o=0;o<r.length;o++){var a=yOt[o];t=t.replace(vOt(a),vOt(a,0))}for(var s=0;s<i;s++)for(var l=0;l<r.length;l++){var u=e[s][r[l]];t=t.replace(vOt(yOt[l],s),n?gOt(u):u)}return t}function bOt(t,e){return e=e||"transparent",O_t(t)?t:L_t(t)&&t.colorStops&&(t.colorStops[0]||{}).color||e}function wOt(t,e){if("_blank"===e||"blank"===e){var n=window.open();n.opener=null,n.location.href=t}else window.open(t,e)}var _Ot=S_t,kOt=["left","right","top","bottom","width","height"],SOt=[["width","left","right"],["height","top","bottom"]];function COt(t,e,n,i,r){var o=0,a=0;null==i&&(i=1/0),null==r&&(r=1/0);var s=0;e.eachChild((function(l,u){var c,h,d=l.getBoundingRect(),p=e.childAt(u+1),f=p&&p.getBoundingRect();if("horizontal"===t){var g=d.width+(f?-f.x+d.x:0);(c=o+g)>i||l.newline?(o=0,c=g,a+=s+n,s=d.height):s=Math.max(s,d.height)}else{var m=d.height+(f?-f.y+d.y:0);(h=a+m)>r||l.newline?(o+=s+n,a=0,h=m,s=d.width):s=Math.max(s,d.width)}l.newline||(l.x=o,l.y=a,l.markRedraw(),"horizontal"===t?o=c+n:a=h+n)}))}var AOt=COt;function IOt(t,e,n){n=dOt(n||0);var i=e.width,r=e.height,o=dAt(t.left,i),a=dAt(t.top,r),s=dAt(t.right,i),l=dAt(t.bottom,r),u=dAt(t.width,i),c=dAt(t.height,r),h=n[2]+n[0],d=n[1]+n[3],p=t.aspect;switch(isNaN(u)&&(u=i-s-d-o),isNaN(c)&&(c=r-l-h-a),null!=p&&(isNaN(u)&&isNaN(c)&&(p>i/r?u=.8*i:c=.8*r),isNaN(u)&&(u=p*c),isNaN(c)&&(c=u/p)),isNaN(o)&&(o=i-s-u-d),isNaN(a)&&(a=r-l-c-h),t.left||t.right){case"center":o=i/2-u/2-n[3];break;case"right":o=i-u-d}switch(t.top||t.bottom){case"middle":case"center":a=r/2-c/2-n[0];break;case"bottom":a=r-c-h}o=o||0,a=a||0,isNaN(u)&&(u=i-d-o-(s||0)),isNaN(c)&&(c=r-h-a-(l||0));var f=new PCt(o+n[3],a+n[0],u,c);return f.margin=n,f}function MOt(t,e,n,i,r){var o=!r||!r.hv||r.hv[0],a=!r||!r.hv||r.hv[1],s=r&&r.boundingMode||"all";if(o||a){var l;if("raw"===s)l="group"===t.type?new PCt(0,0,+e.width||0,+e.height||0):t.getBoundingRect();else if(l=t.getBoundingRect(),t.needLocalTransform()){var u=t.getLocalTransform();(l=l.clone()).applyTransform(u)}var c=IOt(x_t({width:l.width,height:l.height},e),n,i),h=o?c.x-l.x:0,d=a?c.y-l.y:0;"raw"===s?(t.x=h,t.y=d):(t.x+=h,t.y+=d),t.markRedraw()}}function DOt(t){var e=t.layoutMode||t.constructor.layoutMode;return L_t(e)?e:e?{type:e}:null}function TOt(t,e,n){var i=n&&n.ignoreSize;!E_t(i)&&(i=[i,i]);var r=a(SOt[0],0),o=a(SOt[1],1);function a(n,r){var o={},a=0,u={},c=0;if(_Ot(n,(function(e){u[e]=t[e]})),_Ot(n,(function(t){s(e,t)&&(o[t]=u[t]=e[t]),l(o,t)&&a++,l(u,t)&&c++})),i[r])return l(e,n[1])?u[n[2]]=null:l(e,n[2])&&(u[n[1]]=null),u;if(2!==c&&a){if(a>=2)return o;for(var h=0;h<n.length;h++){var d=n[h];if(!s(o,d)&&s(t,d)){o[d]=t[d];break}}return o}return u}function s(t,e){return t.hasOwnProperty(e)}function l(t,e){return null!=t[e]&&"auto"!==t[e]}function u(t,e,n){_Ot(t,(function(t){e[t]=n[t]}))}u(SOt[0],t,r),u(SOt[1],t,o)}function EOt(t){return NOt({},t)}function NOt(t,e){return e&&t&&_Ot(kOt,(function(n){e.hasOwnProperty(n)&&(t[n]=e[n])})),t}T_t(COt,"vertical"),T_t(COt,"horizontal");var OOt=jAt(),FOt=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.uid=FNt("ec_cpt_model"),r}var n;return Dit(e,t),e.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n)},e.prototype.mergeDefaultAndTheme=function(t,e){var n=DOt(this),i=n?EOt(t):{};m_t(t,e.getTheme().get(this.mainType)),m_t(t,this.getDefaultOption()),n&&TOt(t,i,n)},e.prototype.mergeOption=function(t,e){m_t(this.option,t,!0);var n=DOt(this);n&&TOt(this.option,t,n)},e.prototype.optionUpdated=function(t,e){},e.prototype.getDefaultOption=function(){var t=this.constructor;if(!function(t){return!(!t||!t.___EC__EXTENDED_CLASS___)}(t))return t.defaultOption;var e=OOt(this);if(!e.defaultOption){for(var n=[],i=t;i;){var r=i.prototype.defaultOption;r&&n.push(r),i=i.superClass}for(var o={},a=n.length-1;a>=0;a--)o=m_t(o,n[a],!0);e.defaultOption=o}return e.defaultOption},e.prototype.getReferringComponents=function(t,e){var n=t+"Index",i=t+"Id";return YAt(this.ecModel,t,{index:this.get(n,!0),id:this.get(i,!0)},e)},e.prototype.getBoxLayoutParams=function(){var t=this;return{left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")}},e.protoInitialize=((n=e.prototype).type="component",n.id="",n.name="",n.mainType="",n.subType="",void(n.componentIndex=0)),e}(NNt);iIt(FOt,NNt),sIt(FOt),function(t){var e={};t.registerSubTypeDefaulter=function(t,n){var i=tIt(t);e[i.main]=n},t.determineSubType=function(n,i){var r=i.type;if(!r){var o=tIt(n).main;t.hasSubTypes(n)&&e[o]&&(r=e[o](i))}return r}}(FOt),function(t,e){function n(t,e){return t[e]||(t[e]={predecessor:[],successor:[]}),t[e]}t.topologicalTravel=function(t,i,r,o){if(t.length){var a=function(t){var i={},r=[];return S_t(t,(function(o){var a=n(i,o),s=function(t,e){var n=[];return S_t(t,(function(t){w_t(e,t)>=0&&n.push(t)})),n}(a.originalDeps=e(o),t);a.entryCount=s.length,0===a.entryCount&&r.push(o),S_t(s,(function(t){w_t(a.predecessor,t)<0&&a.predecessor.push(t);var e=n(i,t);w_t(e.successor,t)<0&&e.successor.push(o)}))})),{graph:i,noEntryList:r}}(i),s=a.graph,l=a.noEntryList,u={};for(S_t(t,(function(t){u[t]=!0}));l.length;){var c=l.pop(),h=s[c],d=!!u[c];d&&(r.call(o,c,h.originalDeps.slice()),delete u[c]),S_t(h.successor,d?f:p)}S_t(u,(function(){throw new Error("")}))}function p(t){s[t].entryCount--,0===s[t].entryCount&&l.push(t)}function f(t){u[t]=!0,p(t)}}}(FOt,(function(t){var e=[];S_t(FOt.getClassesByMainType(t),(function(t){e=e.concat(t.dependencies||t.prototype.dependencies||[])})),e=C_t(e,(function(t){return tIt(t).main})),"dataset"!==t&&w_t(e,"dataset")<=0&&e.unshift("dataset");return e}));var ROt="";"undefined"!=typeof navigator&&(ROt=navigator.platform||"");var LOt="rgba(0, 0, 0, 0.2)",$Ot={darkMode:"auto",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:LOt,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:LOt,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:LOt,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:LOt,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:LOt,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:LOt,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:ROt.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1},POt=Z_t(["tooltip","label","itemName","itemId","seriesName"]),zOt=1,BOt=2,VOt=3,WOt=jAt();function jOt(t,e,n){var i={},r=GOt(e);if(!r||!t)return i;var o,a,s=[],l=[],u=e.ecModel,c=WOt(u).datasetMap,h=r.uid+"_"+n.seriesLayoutBy;S_t(t=t.slice(),(function(e,n){var r=L_t(e)?e:t[n]={name:e};"ordinal"===r.type&&null==o&&(o=n,a=f(r)),i[r.name]=[]}));var d=c.get(h)||c.set(h,{categoryWayDim:a,valueWayDim:0});function p(t,e,n){for(var i=0;i<n;i++)t.push(e+i)}function f(t){var e=t.dimsDef;return e?e.length:1}return S_t(t,(function(t,e){var n=t.name,r=f(t);if(null==o){var a=d.valueWayDim;p(i[n],a,r),p(l,a,r),d.valueWayDim+=r}else if(o===e)p(i[n],0,r),p(s,0,r);else{a=d.categoryWayDim;p(i[n],a,r),p(l,a,r),d.categoryWayDim+=r}})),s.length&&(i.itemName=s),l.length&&(i.seriesName=l),i}function UOt(t,e,n){var i={};if(!GOt(t))return i;var r,o=e.sourceFormat,a=e.dimensionsDefine;"objectRows"!==o&&"keyedColumns"!==o||S_t(a,(function(t,e){"name"===(L_t(t)?t.name:t)&&(r=e)}));var s=function(){for(var t={},i={},s=[],l=0,u=Math.min(5,n);l<u;l++){var c=qOt(e.data,o,e.seriesLayoutBy,a,e.startIndex,l);s.push(c);var h=c===VOt;if(h&&null==t.v&&l!==r&&(t.v=l),(null==t.n||t.n===t.v||!h&&s[t.n]===VOt)&&(t.n=l),d(t)&&s[t.n]!==VOt)return t;h||(c===BOt&&null==i.v&&l!==r&&(i.v=l),null!=i.n&&i.n!==i.v||(i.n=l))}function d(t){return null!=t.v&&null!=t.n}return d(t)?t:d(i)?i:null}();if(s){i.value=[s.v];var l=null!=r?r:s.n;i.itemName=[l],i.seriesName=[l]}return i}function GOt(t){if(!t.get("data",!0))return YAt(t.ecModel,"dataset",{index:t.get("datasetIndex",!0),id:t.get("datasetId",!0)},qAt).models[0]}function HOt(t,e){return qOt(t.data,t.sourceFormat,t.seriesLayoutBy,t.dimensionsDefine,t.startIndex,e)}function qOt(t,e,n,i,r,o){var a,s,l;if(P_t(t))return VOt;if(i){var u=i[o];L_t(u)?(s=u.name,l=u.type):O_t(u)&&(s=u)}if(null!=l)return"ordinal"===l?zOt:VOt;if("arrayRows"===e){var c=t;if("row"===n){for(var h=c[o],d=0;d<(h||[]).length&&d<5;d++)if(null!=(a=v(h[r+d])))return a}else for(d=0;d<c.length&&d<5;d++){var p=c[r+d];if(p&&null!=(a=v(p[o])))return a}}else if("objectRows"===e){var f=t;if(!s)return VOt;for(d=0;d<f.length&&d<5;d++){if((m=f[d])&&null!=(a=v(m[s])))return a}}else if("keyedColumns"===e){if(!s)return VOt;if(!(h=t[s])||P_t(h))return VOt;for(d=0;d<h.length&&d<5;d++)if(null!=(a=v(h[d])))return a}else if("original"===e){var g=t;for(d=0;d<g.length&&d<5;d++){var m,y=RAt(m=g[d]);if(!E_t(y))return VOt;if(null!=(a=v(y[o])))return a}}function v(t){var e=O_t(t);return null!=t&&isFinite(t)&&""!==t?e?BOt:VOt:e&&"-"!==t?zOt:void 0}return VOt}var XOt=Z_t();var YOt,KOt,ZOt,JOt=jAt(),QOt=jAt(),tFt=function(){function t(){}return t.prototype.getColorFromPalette=function(t,e,n){var i=NAt(this.get("color",!0)),r=this.get("colorLayer",!0);return nFt(this,JOt,i,r,t,e,n)},t.prototype.clearColorPalette=function(){var t,e;(e=JOt)(t=this).paletteIdx=0,e(t).paletteNameMap={}},t}();function eFt(t,e,n,i){var r=NAt(t.get(["aria","decal","decals"]));return nFt(t,QOt,r,null,e,n,i)}function nFt(t,e,n,i,r,o,a){var s=e(o=o||t),l=s.paletteIdx||0,u=s.paletteNameMap=s.paletteNameMap||{};if(u.hasOwnProperty(r))return u[r];var c=null!=a&&i?function(t,e){for(var n=t.length,i=0;i<n;i++)if(t[i].length>e)return t[i];return t[n-1]}(i,a):n;if((c=c||n)&&c.length){var h=c[l];return r&&(u[r]=h),s.paletteIdx=(l+1)%c.length,h}}var iFt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.init=function(t,e,n,i,r,o){i=i||{},this.option=null,this._theme=new NNt(i),this._locale=new NNt(r),this._optionManager=o},e.prototype.setOption=function(t,e,n){var i=aFt(e);this._optionManager.setOption(t,n,i),this._resetOption(null,i)},e.prototype.resetOption=function(t,e){return this._resetOption(t,aFt(e))},e.prototype._resetOption=function(t,e){var n=!1,i=this._optionManager;if(!t||"recreate"===t){var r=i.mountOption("recreate"===t);this.option&&"recreate"!==t?(this.restoreData(),this._mergeOption(r,e)):ZOt(this,r),n=!0}if("timeline"!==t&&"media"!==t||this.restoreData(),!t||"recreate"===t||"timeline"===t){var o=i.getTimelineOption(this);o&&(n=!0,this._mergeOption(o,e))}if(!t||"recreate"===t||"media"===t){var a=i.getMediaOption(this);a.length&&S_t(a,(function(t){n=!0,this._mergeOption(t,e)}),this)}return n},e.prototype.mergeOption=function(t){this._mergeOption(t,null)},e.prototype._mergeOption=function(t,e){var n=this.option,i=this._componentsMap,r=this._componentsCount,o=[],a=Z_t(),s=e&&e.replaceMergeMainTypeMap;WOt(this).datasetMap=Z_t(),S_t(t,(function(t,e){null!=t&&(FOt.hasClass(e)?e&&(o.push(e),a.set(e,!0)):n[e]=null==n[e]?g_t(t):m_t(n[e],t,!0))})),s&&s.each((function(t,e){FOt.hasClass(e)&&!a.get(e)&&(o.push(e),a.set(e,!0))})),FOt.topologicalTravel(o,FOt.getAllClassMainTypes(),(function(e){var o=function(t,e,n){var i=XOt.get(e);if(!i)return n;var r=i(t);return r?n.concat(r):n}(this,e,NAt(t[e])),a=i.get(e),l=a?s&&s.get(e)?"replaceMerge":"normalMerge":"replaceAll",u=LAt(a,o,l);(function(t,e,n){S_t(t,(function(t){var i=t.newOption;L_t(i)&&(t.keyInfo.mainType=e,t.keyInfo.subType=function(t,e,n,i){return e.type?e.type:n?n.subType:i.determineSubType(t,e)}(e,i,t.existing,n))}))})(u,e,FOt),n[e]=null,i.set(e,null),r.set(e,0);var c=[],h=[],d=0;S_t(u,(function(t,n){var i=t.existing,r=t.newOption;if(r){var o="series"===e,a=FOt.getClass(e,t.keyInfo.subType,!o);if(!a)return;if(i&&i.constructor===a)i.name=t.keyInfo.name,i.mergeOption(r,this),i.optionUpdated(r,!1);else{var s=v_t({componentIndex:n},t.keyInfo);v_t(i=new a(r,this,this,s),s),t.brandNew&&(i.__requireNewView=!0),i.init(r,this,this),i.optionUpdated(null,!0)}}else i&&(i.mergeOption({},this),i.optionUpdated({},!1));i?(c.push(i.option),h.push(i),d++):(c.push(void 0),h.push(void 0))}),this),n[e]=c,i.set(e,h),r.set(e,d),"series"===e&&YOt(this)}),this),this._seriesIndices||YOt(this)},e.prototype.getOption=function(){var t=g_t(this.option);return S_t(t,(function(e,n){if(FOt.hasClass(n)){for(var i=NAt(e),r=i.length,o=!1,a=r-1;a>=0;a--)i[a]&&!VAt(i[a])?o=!0:(i[a]=null,!o&&r--);i.length=r,t[n]=i}})),delete t["\0_ec_inner"],t},e.prototype.getTheme=function(){return this._theme},e.prototype.getLocaleModel=function(){return this._locale},e.prototype.getLocale=function(t){return this.getLocaleModel().get(t)},e.prototype.setUpdatePayload=function(t){this._payload=t},e.prototype.getUpdatePayload=function(){return this._payload},e.prototype.getComponent=function(t,e){var n=this._componentsMap.get(t);if(n){var i=n[e||0];if(i)return i;if(null==e)for(var r=0;r<n.length;r++)if(n[r])return n[r]}},e.prototype.queryComponents=function(t){var e=t.mainType;if(!e)return[];var n,i=t.index,r=t.id,o=t.name,a=this._componentsMap.get(e);return a&&a.length?(null!=i?(n=[],S_t(NAt(i),(function(t){a[t]&&n.push(a[t])}))):n=null!=r?rFt("id",r,a):null!=o?rFt("name",o,a):I_t(a,(function(t){return!!t})),oFt(n,t)):[]},e.prototype.findComponents=function(t){var e,n,i,r,o,a=t.query,s=t.mainType,l=(n=s+"Index",i=s+"Id",r=s+"Name",!(e=a)||null==e[n]&&null==e[i]&&null==e[r]?null:{mainType:s,index:e[n],id:e[i],name:e[r]}),u=l?this.queryComponents(l):I_t(this._componentsMap.get(s),(function(t){return!!t}));return o=oFt(u,t),t.filter?I_t(o,t.filter):o},e.prototype.eachComponent=function(t,e,n){var i=this._componentsMap;if(N_t(t)){var r=e,o=t;i.each((function(t,e){for(var n=0;t&&n<t.length;n++){var i=t[n];i&&o.call(r,e,i,i.componentIndex)}}))}else for(var a=O_t(t)?i.get(t):L_t(t)?this.findComponents(t):null,s=0;a&&s<a.length;s++){var l=a[s];l&&e.call(n,l,l.componentIndex)}},e.prototype.getSeriesByName=function(t){var e=zAt(t,null);return I_t(this._componentsMap.get("series"),(function(t){return!!t&&null!=e&&t.name===e}))},e.prototype.getSeriesByIndex=function(t){return this._componentsMap.get("series")[t]},e.prototype.getSeriesByType=function(t){return I_t(this._componentsMap.get("series"),(function(e){return!!e&&e.subType===t}))},e.prototype.getSeries=function(){return I_t(this._componentsMap.get("series").slice(),(function(t){return!!t}))},e.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},e.prototype.eachSeries=function(t,e){KOt(this),S_t(this._seriesIndices,(function(n){var i=this._componentsMap.get("series")[n];t.call(e,i,n)}),this)},e.prototype.eachRawSeries=function(t,e){S_t(this._componentsMap.get("series"),(function(n){n&&t.call(e,n,n.componentIndex)}))},e.prototype.eachSeriesByType=function(t,e,n){KOt(this),S_t(this._seriesIndices,(function(i){var r=this._componentsMap.get("series")[i];r.subType===t&&e.call(n,r,i)}),this)},e.prototype.eachRawSeriesByType=function(t,e,n){return S_t(this.getSeriesByType(t),e,n)},e.prototype.isSeriesFiltered=function(t){return KOt(this),null==this._seriesIndicesMap.get(t.componentIndex)},e.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},e.prototype.filterSeries=function(t,e){KOt(this);var n=[];S_t(this._seriesIndices,(function(i){var r=this._componentsMap.get("series")[i];t.call(e,r,i)&&n.push(i)}),this),this._seriesIndices=n,this._seriesIndicesMap=Z_t(n)},e.prototype.restoreData=function(t){YOt(this);var e=this._componentsMap,n=[];e.each((function(t,e){FOt.hasClass(e)&&n.push(e)})),FOt.topologicalTravel(n,FOt.getAllClassMainTypes(),(function(n){S_t(e.get(n),(function(e){!e||"series"===n&&function(t,e){if(e){var n=e.seriesIndex,i=e.seriesId,r=e.seriesName;return null!=n&&t.componentIndex!==n||null!=i&&t.id!==i||null!=r&&t.name!==r}}(e,t)||e.restoreData()}))}))},e.internalField=(YOt=function(t){var e=t._seriesIndices=[];S_t(t._componentsMap.get("series"),(function(t){t&&e.push(t.componentIndex)})),t._seriesIndicesMap=Z_t(e)},KOt=function(t){},void(ZOt=function(t,e){t.option={},t.option["\0_ec_inner"]=1,t._componentsMap=Z_t({series:[]}),t._componentsCount=Z_t();var n,i,r,o=e.aria;L_t(o)&&null==o.enabled&&(o.enabled=!0),n=e,i=t._theme.option,r=n.color&&!n.colorLayer,S_t(i,(function(t,e){"colorLayer"===e&&r||FOt.hasClass(e)||("object"==typeof t?n[e]=n[e]?m_t(n[e],t,!1):g_t(t):null==n[e]&&(n[e]=t))})),m_t(e,$Ot,!1),t._mergeOption(e,null)})),e}(NNt);function rFt(t,e,n){if(E_t(e)){var i=Z_t();return S_t(e,(function(t){null!=t&&(null!=zAt(t,null)&&i.set(t,!0))})),I_t(n,(function(e){return e&&i.get(e[t])}))}var r=zAt(e,null);return I_t(n,(function(e){return e&&null!=r&&e[t]===r}))}function oFt(t,e){return e.hasOwnProperty("subType")?I_t(t,(function(t){return t&&t.subType===e.subType})):t}function aFt(t){var e=Z_t();return t&&S_t(NAt(t.replaceMerge),(function(t){e.set(t,!0)})),{replaceMergeMainTypeMap:e}}__t(iFt,tFt);var sFt=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],lFt=function(t){S_t(sFt,(function(e){this[e]=D_t(t[e],t)}),this)},uFt={},cFt=function(){function t(){this._coordinateSystems=[]}return t.prototype.create=function(t,e){var n=[];S_t(uFt,(function(i,r){var o=i.create(t,e);n=n.concat(o||[])})),this._coordinateSystems=n},t.prototype.update=function(t,e){S_t(this._coordinateSystems,(function(n){n.update&&n.update(t,e)}))},t.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()},t.register=function(t,e){uFt[t]=e},t.get=function(t){return uFt[t]},t}(),hFt=/^(min|max)?(.+)$/,dFt=function(){function t(t){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=t}return t.prototype.setOption=function(t,e,n){t&&(S_t(NAt(t.series),(function(t){t&&t.data&&P_t(t.data)&&X_t(t.data)})),S_t(NAt(t.dataset),(function(t){t&&t.source&&P_t(t.source)&&X_t(t.source)}))),t=g_t(t);var i=this._optionBackup,r=function(t,e,n){var i,r,o=[],a=t.baseOption,s=t.timeline,l=t.options,u=t.media,c=!!t.media,h=!!(l||s||a&&a.timeline);a?(r=a).timeline||(r.timeline=s):((h||c)&&(t.options=t.media=null),r=t);c&&E_t(u)&&S_t(u,(function(t){t&&t.option&&(t.query?o.push(t):i||(i=t))}));function d(t){S_t(e,(function(e){e(t,n)}))}return d(r),S_t(l,(function(t){return d(t)})),S_t(o,(function(t){return d(t.option)})),{baseOption:r,timelineOptions:l||[],mediaDefault:i,mediaList:o}}(t,e,!i);this._newBaseOption=r.baseOption,i?(r.timelineOptions.length&&(i.timelineOptions=r.timelineOptions),r.mediaList.length&&(i.mediaList=r.mediaList),r.mediaDefault&&(i.mediaDefault=r.mediaDefault)):this._optionBackup=r},t.prototype.mountOption=function(t){var e=this._optionBackup;return this._timelineOptions=e.timelineOptions,this._mediaList=e.mediaList,this._mediaDefault=e.mediaDefault,this._currentMediaIndices=[],g_t(t?e.baseOption:this._newBaseOption)},t.prototype.getTimelineOption=function(t){var e,n=this._timelineOptions;if(n.length){var i=t.getComponent("timeline");i&&(e=g_t(n[i.getCurrentIndex()]))}return e},t.prototype.getMediaOption=function(t){var e,n,i=this._api.getWidth(),r=this._api.getHeight(),o=this._mediaList,a=this._mediaDefault,s=[],l=[];if(!o.length&&!a)return l;for(var u=0,c=o.length;u<c;u++)pFt(o[u].query,i,r)&&s.push(u);return!s.length&&a&&(s=[-1]),s.length&&(e=s,n=this._currentMediaIndices,e.join(",")!==n.join(","))&&(l=C_t(s,(function(t){return g_t(-1===t?a.option:o[t].option)}))),this._currentMediaIndices=s,l},t}();function pFt(t,e,n){var i={width:e,height:n,aspectratio:e/n},r=!0;return S_t(t,(function(t,e){var n=e.match(hFt);if(n&&n[1]&&n[2]){var o=n[1],a=n[2].toLowerCase();(function(t,e,n){return"min"===n?t>=e:"max"===n?t<=e:t===e})(i[a],t,o)||(r=!1)}})),r}var fFt=S_t,gFt=L_t,mFt=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function yFt(t){var e=t&&t.itemStyle;if(e)for(var n=0,i=mFt.length;n<i;n++){var r=mFt[n],o=e.normal,a=e.emphasis;o&&o[r]&&(t[r]=t[r]||{},t[r].normal?m_t(t[r].normal,o[r]):t[r].normal=o[r],o[r]=null),a&&a[r]&&(t[r]=t[r]||{},t[r].emphasis?m_t(t[r].emphasis,a[r]):t[r].emphasis=a[r],a[r]=null)}}function vFt(t,e,n){if(t&&t[e]&&(t[e].normal||t[e].emphasis)){var i=t[e].normal,r=t[e].emphasis;i&&(n?(t[e].normal=t[e].emphasis=null,x_t(t[e],i)):t[e]=i),r&&(t.emphasis=t.emphasis||{},t.emphasis[e]=r,r.focus&&(t.emphasis.focus=r.focus),r.blurScope&&(t.emphasis.blurScope=r.blurScope))}}function xFt(t){vFt(t,"itemStyle"),vFt(t,"lineStyle"),vFt(t,"areaStyle"),vFt(t,"label"),vFt(t,"labelLine"),vFt(t,"upperLabel"),vFt(t,"edgeLabel")}function bFt(t,e){var n=gFt(t)&&t[e],i=gFt(n)&&n.textStyle;if(i)for(var r=0,o=FAt.length;r<o;r++){var a=FAt[r];i.hasOwnProperty(a)&&(n[a]=i[a])}}function wFt(t){t&&(xFt(t),bFt(t,"label"),t.emphasis&&bFt(t.emphasis,"label"))}function _Ft(t){return E_t(t)?t:t?[t]:[]}function kFt(t){return(E_t(t)?t[0]:t)||{}}function SFt(t,e){fFt(_Ft(t.series),(function(t){gFt(t)&&function(t){if(gFt(t)){yFt(t),xFt(t),bFt(t,"label"),bFt(t,"upperLabel"),bFt(t,"edgeLabel"),t.emphasis&&(bFt(t.emphasis,"label"),bFt(t.emphasis,"upperLabel"),bFt(t.emphasis,"edgeLabel"));var e=t.markPoint;e&&(yFt(e),wFt(e));var n=t.markLine;n&&(yFt(n),wFt(n));var i=t.markArea;i&&wFt(i);var r=t.data;if("graph"===t.type){r=r||t.nodes;var o=t.links||t.edges;if(o&&!P_t(o))for(var a=0;a<o.length;a++)wFt(o[a]);S_t(t.categories,(function(t){xFt(t)}))}if(r&&!P_t(r))for(a=0;a<r.length;a++)wFt(r[a]);if((e=t.markPoint)&&e.data){var s=e.data;for(a=0;a<s.length;a++)wFt(s[a])}if((n=t.markLine)&&n.data){var l=n.data;for(a=0;a<l.length;a++)E_t(l[a])?(wFt(l[a][0]),wFt(l[a][1])):wFt(l[a])}"gauge"===t.type?(bFt(t,"axisLabel"),bFt(t,"title"),bFt(t,"detail")):"treemap"===t.type?(vFt(t.breadcrumb,"itemStyle"),S_t(t.levels,(function(t){xFt(t)}))):"tree"===t.type&&xFt(t.leaves)}}(t)}));var n=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];e&&n.push("valueAxis","categoryAxis","logAxis","timeAxis"),fFt(n,(function(e){fFt(_Ft(t[e]),(function(t){t&&(bFt(t,"axisLabel"),bFt(t.axisPointer,"label"))}))})),fFt(_Ft(t.parallel),(function(t){var e=t&&t.parallelAxisDefault;bFt(e,"axisLabel"),bFt(e&&e.axisPointer,"label")})),fFt(_Ft(t.calendar),(function(t){vFt(t,"itemStyle"),bFt(t,"dayLabel"),bFt(t,"monthLabel"),bFt(t,"yearLabel")})),fFt(_Ft(t.radar),(function(t){bFt(t,"name"),t.name&&null==t.axisName&&(t.axisName=t.name,delete t.name),null!=t.nameGap&&null==t.axisNameGap&&(t.axisNameGap=t.nameGap,delete t.nameGap)})),fFt(_Ft(t.geo),(function(t){gFt(t)&&(wFt(t),fFt(_Ft(t.regions),(function(t){wFt(t)})))})),fFt(_Ft(t.timeline),(function(t){wFt(t),vFt(t,"label"),vFt(t,"itemStyle"),vFt(t,"controlStyle",!0);var e=t.data;E_t(e)&&S_t(e,(function(t){L_t(t)&&(vFt(t,"label"),vFt(t,"itemStyle"))}))})),fFt(_Ft(t.toolbox),(function(t){vFt(t,"iconStyle"),fFt(t.feature,(function(t){vFt(t,"iconStyle")}))})),bFt(kFt(t.axisPointer),"label"),bFt(kFt(t.tooltip).axisPointer,"label")}function CFt(t){t&&S_t(AFt,(function(e){e[0]in t&&!(e[1]in t)&&(t[e[1]]=t[e[0]])}))}var AFt=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],IFt=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],MFt=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function DFt(t){var e=t&&t.itemStyle;if(e)for(var n=0;n<MFt.length;n++){var i=MFt[n][1],r=MFt[n][0];null!=e[i]&&(e[r]=e[i])}}function TFt(t){t&&"edge"===t.alignTo&&null!=t.margin&&null==t.edgeDistance&&(t.edgeDistance=t.margin)}function EFt(t){t&&t.downplay&&!t.blur&&(t.blur=t.downplay)}function NFt(t,e){if(t)for(var n=0;n<t.length;n++)e(t[n]),t[n]&&NFt(t[n].children,e)}function OFt(t,e){SFt(t,e),t.series=NAt(t.series),S_t(t.series,(function(t){if(L_t(t)){var e=t.type;if("line"===e)null!=t.clipOverflow&&(t.clip=t.clipOverflow);else if("pie"===e||"gauge"===e){if(null!=t.clockWise&&(t.clockwise=t.clockWise),TFt(t.label),(r=t.data)&&!P_t(r))for(var n=0;n<r.length;n++)TFt(r[n]);null!=t.hoverOffset&&(t.emphasis=t.emphasis||{},(t.emphasis.scaleSize=null)&&(t.emphasis.scaleSize=t.hoverOffset))}else if("gauge"===e){var i=function(t,e){for(var n=e.split(","),i=t,r=0;r<n.length&&null!=(i=i&&i[n[r]]);r++);return i}(t,"pointer.color");null!=i&&function(t,e,n,i){for(var r,o=e.split(","),a=t,s=0;s<o.length-1;s++)null==a[r=o[s]]&&(a[r]={}),a=a[r];(i||null==a[o[s]])&&(a[o[s]]=n)}(t,"itemStyle.color",i)}else if("bar"===e){var r;if(DFt(t),DFt(t.backgroundStyle),DFt(t.emphasis),(r=t.data)&&!P_t(r))for(n=0;n<r.length;n++)"object"==typeof r[n]&&(DFt(r[n]),DFt(r[n]&&r[n].emphasis))}else if("sunburst"===e){var o=t.highlightPolicy;o&&(t.emphasis=t.emphasis||{},t.emphasis.focus||(t.emphasis.focus=o)),EFt(t),NFt(t.data,EFt)}else"graph"===e||"sankey"===e?function(t){t&&null!=t.focusNodeAdjacency&&(t.emphasis=t.emphasis||{},null==t.emphasis.focus&&(t.emphasis.focus="adjacency"))}(t):"map"===e&&(t.mapType&&!t.map&&(t.map=t.mapType),t.mapLocation&&x_t(t,t.mapLocation));null!=t.hoverAnimation&&(t.emphasis=t.emphasis||{},t.emphasis&&null==t.emphasis.scale&&(t.emphasis.scale=t.hoverAnimation)),CFt(t)}})),t.dataRange&&(t.visualMap=t.dataRange),S_t(IFt,(function(e){var n=t[e];n&&(E_t(n)||(n=[n]),S_t(n,(function(t){CFt(t)})))}))}function FFt(t){S_t(t,(function(e,n){var i=[],r=[NaN,NaN],o=[e.stackResultDimension,e.stackedOverDimension],a=e.data,s=e.isStackedByIndex,l=a.map(o,(function(o,l,u){var c,h,d=a.get(e.stackedDimension,u);if(isNaN(d))return r;s?h=a.getRawIndex(u):c=a.get(e.stackedByDimension,u);for(var p=NaN,f=n-1;f>=0;f--){var g=t[f];if(s||(h=g.data.rawIndexOf(g.stackedByDimension,c)),h>=0){var m=g.data.getByRawIndex(g.stackResultDimension,h);if(d>=0&&m>0||d<=0&&m<0){d=yAt(d,m),p=m;break}}}return i[0]=d,i[1]=p,i}));a.hostModel.setData(l),e.data=l}))}var RFt,LFt,$Ft,PFt,zFt,BFt=function(t){this.data=t.data||("keyedColumns"===t.sourceFormat?{}:[]),this.sourceFormat=t.sourceFormat||"unknown",this.seriesLayoutBy=t.seriesLayoutBy||"column",this.startIndex=t.startIndex||0,this.dimensionsDefine=t.dimensionsDefine,this.dimensionsDetectedCount=t.dimensionsDetectedCount,this.encodeDefine=t.encodeDefine,this.metaRawOption=t.metaRawOption};function VFt(t){return t instanceof BFt}function WFt(t,e,n,i){n=n||GFt(t);var r=e.seriesLayoutBy,o=function(t,e,n,i,r){var o,a;if(!t)return{dimensionsDefine:HFt(r),startIndex:a,dimensionsDetectedCount:o};if("arrayRows"===e){var s=t;"auto"===i||null==i?qFt((function(t){null!=t&&"-"!==t&&(O_t(t)?null==a&&(a=1):a=0)}),n,s,10):a=R_t(i)?i:i?1:0,r||1!==a||(r=[],qFt((function(t,e){r[e]=null!=t?t+"":""}),n,s,1/0)),o=r?r.length:"row"===n?s.length:s[0]?s[0].length:null}else if("objectRows"===e)r||(r=function(t){var e,n=0;for(;n<t.length&&!(e=t[n++]););if(e){var i=[];return S_t(e,(function(t,e){i.push(e)})),i}}(t));else if("keyedColumns"===e)r||(r=[],S_t(t,(function(t,e){r.push(e)})));else if("original"===e){var l=RAt(t[0]);o=E_t(l)&&l.length||1}return{startIndex:a,dimensionsDefine:HFt(r),dimensionsDetectedCount:o}}(t,n,r,e.sourceHeader,e.dimensions);return new BFt({data:t,sourceFormat:n,seriesLayoutBy:r,dimensionsDefine:o.dimensionsDefine,startIndex:o.startIndex,dimensionsDetectedCount:o.dimensionsDetectedCount,encodeDefine:UFt(i),metaRawOption:g_t(e)})}function jFt(t){return new BFt({data:t,sourceFormat:P_t(t)?"typedArray":"original"})}function UFt(t){return t?Z_t(t):null}function GFt(t){var e="unknown";if(P_t(t))e="typedArray";else if(E_t(t)){0===t.length&&(e="arrayRows");for(var n=0,i=t.length;n<i;n++){var r=t[n];if(null!=r){if(E_t(r)){e="arrayRows";break}if(L_t(r)){e="objectRows";break}}}}else if(L_t(t))for(var o in t)if(tkt(t,o)&&k_t(t[o])){e="keyedColumns";break}return e}function HFt(t){if(t){var e=Z_t();return C_t(t,(function(t,n){var i={name:(t=L_t(t)?t:{name:t}).name,displayName:t.displayName,type:t.type};if(null==i.name)return i;i.name+="",null==i.displayName&&(i.displayName=i.name);var r=e.get(i.name);return r?i.name+="-"+r.count++:e.set(i.name,{count:1}),i}))}}function qFt(t,e,n,i){if("row"===e)for(var r=0;r<n.length&&r<i;r++)t(n[r]?n[r][0]:null,r);else{var o=n[0]||[];for(r=0;r<o.length&&r<i;r++)t(o[r],r)}}var XFt=function(){function t(t,e){var n=VFt(t)?t:jFt(t);this._source=n;var i=this._data=n.data;"typedArray"===n.sourceFormat&&(this._offset=0,this._dimSize=e,this._data=i),zFt(this,i,n)}var e;return t.prototype.getSource=function(){return this._source},t.prototype.count=function(){return 0},t.prototype.getItem=function(t,e){},t.prototype.appendData=function(t){},t.prototype.clean=function(){},t.protoInitialize=((e=t.prototype).pure=!1,void(e.persistent=!0)),t.internalField=function(){var t;zFt=function(t,r,o){var a=o.sourceFormat,s=o.seriesLayoutBy,l=o.startIndex,u=o.dimensionsDefine;if(v_t(t,PFt[rRt(a,s)]),"typedArray"===a)t.getItem=e,t.count=i,t.fillStorage=n;else{var c=ZFt(a,s);t.getItem=D_t(c,null,r,l,u);var h=tRt(a,s);t.count=D_t(h,null,r,l,u)}};var e=function(t,e){t-=this._offset,e=e||[];for(var n=this._data,i=this._dimSize,r=i*t,o=0;o<i;o++)e[o]=n[r+o];return e},n=function(t,e,n,i){for(var r=this._data,o=this._dimSize,a=0;a<o;a++){for(var s=i[a],l=null==s[0]?1/0:s[0],u=null==s[1]?-1/0:s[1],c=e-t,h=n[a],d=0;d<c;d++){var p=r[d*o+a];h[t+d]=p,p<l&&(l=p),p>u&&(u=p)}s[0]=l,s[1]=u}},i=function(){return this._data?this._data.length/this._dimSize:0};function r(t){for(var e=0;e<t.length;e++)this._data.push(t[e])}(t={}).arrayRows_column={pure:!0,appendData:r},t.arrayRows_row={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},t.objectRows={pure:!0,appendData:r},t.keyedColumns={pure:!0,appendData:function(t){var e=this._data;S_t(t,(function(t,n){for(var i=e[n]||(e[n]=[]),r=0;r<(t||[]).length;r++)i.push(t[r])}))}},t.original={appendData:r},t.typedArray={persistent:!1,pure:!0,appendData:function(t){this._data=t},clean:function(){this._offset+=this.count(),this._data=null}},PFt=t}(),t}(),YFt=function(t,e,n,i){return t[i]},KFt=((RFt={}).arrayRows_column=function(t,e,n,i){return t[i+e]},RFt.arrayRows_row=function(t,e,n,i){i+=e;for(var r=[],o=t,a=0;a<o.length;a++){var s=o[a];r.push(s?s[i]:null)}return r},RFt.objectRows=YFt,RFt.keyedColumns=function(t,e,n,i){for(var r=[],o=0;o<n.length;o++){var a=t[n[o].name];r.push(a?a[i]:null)}return r},RFt.original=YFt,RFt);function ZFt(t,e){return KFt[rRt(t,e)]}var JFt=function(t,e,n){return t.length},QFt=((LFt={}).arrayRows_column=function(t,e,n){return Math.max(0,t.length-e)},LFt.arrayRows_row=function(t,e,n){var i=t[0];return i?Math.max(0,i.length-e):0},LFt.objectRows=JFt,LFt.keyedColumns=function(t,e,n){var i=t[n[0].name];return i?i.length:0},LFt.original=JFt,LFt);function tRt(t,e){return QFt[rRt(t,e)]}var eRt=function(t,e,n){return null!=e?t[e]:t},nRt=(($Ft={}).arrayRows=eRt,$Ft.objectRows=function(t,e,n){return null!=e?t[n]:t},$Ft.keyedColumns=eRt,$Ft.original=function(t,e,n){var i=RAt(t);return null!=e&&i instanceof Array?i[e]:i},$Ft.typedArray=eRt,$Ft);function iRt(t){return nRt[t]}function rRt(t,e){return"arrayRows"===t?t+"_"+e:t}function oRt(t,e,n){if(t){var i=t.getRawDataItem(e);if(null!=i){var r,o,a=t.getProvider().getSource().sourceFormat,s=t.getDimensionInfo(n);return s&&(r=s.name,o=s.index),iRt(a)(i,o,r)}}}var aRt=/\{@(.+?)\}/g,sRt=function(){function t(){}return t.prototype.getDataParams=function(t,e){var n=this.getData(e),i=this.getRawValue(t,e),r=n.getRawIndex(t),o=n.getName(t),a=n.getRawDataItem(t),s=n.getItemVisual(t,"style"),l=s&&s[n.getItemVisual(t,"drawType")||"fill"],u=s&&s.stroke,c=this.mainType,h="series"===c,d=n.userOutput;return{componentType:c,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:h?this.subType:null,seriesIndex:this.seriesIndex,seriesId:h?this.id:null,seriesName:h?this.name:null,name:o,dataIndex:r,data:a,dataType:e,value:i,color:l,borderColor:u,dimensionNames:d?d.dimensionNames:null,encode:d?d.encode:null,$vars:["seriesName","name","value"]}},t.prototype.getFormattedLabel=function(t,e,n,i,r,o){e=e||"normal";var a=this.getData(n),s=this.getDataParams(t,n);(o&&(s.value=o.interpolatedValue),null!=i&&E_t(s.value)&&(s.value=s.value[i]),r)||(r=a.getItemModel(t).get("normal"===e?["label","formatter"]:[e,"label","formatter"]));return"function"==typeof r?(s.status=e,s.dimensionIndex=i,r(s)):"string"==typeof r?xOt(r,s).replace(aRt,(function(e,n){var i=n.length,r="["===n.charAt(0)&&"]"===n.charAt(i-1)?+n.slice(1,i-1):n,s=oRt(a,t,r);if(o&&E_t(o.interpolatedValue)){var l=a.getDimensionInfo(r);l&&(s=o.interpolatedValue[l.index])}return null!=s?s+"":""})):void 0},t.prototype.getRawValue=function(t,e){return oRt(this.getData(e),t)},t.prototype.formatTooltip=function(t,e,n){},t}();function lRt(t){var e,n;return L_t(t)?t.type&&(n=t):e=t,{markupText:e,markupFragment:n}}function uRt(t){return new cRt(t)}var cRt=function(){function t(t){t=t||{},this._reset=t.reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}return t.prototype.perform=function(t){var e,n=this._upstream,i=t&&t.skip;if(this._dirty&&n){var r=this.context;r.data=r.outputData=n.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this),this._plan&&!i&&(e=this._plan(this.context));var o,a=c(this._modBy),s=this._modDataCount||0,l=c(t&&t.modBy),u=t&&t.modDataCount||0;function c(t){return!(t>=1)&&(t=1),t}a===l&&s===u||(e="reset"),(this._dirty||"reset"===e)&&(this._dirty=!1,o=this._doReset(i)),this._modBy=l,this._modDataCount=u;var h=t&&t.step;if(this._dueEnd=n?n._outputDueEnd:this._count?this._count(this.context):1/0,this._progress){var d=this._dueIndex,p=Math.min(null!=h?this._dueIndex+h:1/0,this._dueEnd);if(!i&&(o||d<p)){var f=this._progress;if(E_t(f))for(var g=0;g<f.length;g++)this._doProgress(f[g],d,p,l,u);else this._doProgress(f,d,p,l,u)}this._dueIndex=p;var m=null!=this._settedOutputEnd?this._settedOutputEnd:p;this._outputDueEnd=m}else this._dueIndex=this._outputDueEnd=null!=this._settedOutputEnd?this._settedOutputEnd:this._dueEnd;return this.unfinished()},t.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},t.prototype._doProgress=function(t,e,n,i,r){hRt.reset(e,n,i,r),this._callingProgress=t,this._callingProgress({start:e,end:n,count:n-e,next:hRt.next},this.context)},t.prototype._doReset=function(t){var e,n;this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null,!t&&this._reset&&((e=this._reset(this.context))&&e.progress&&(n=e.forceFirstProgress,e=e.progress),E_t(e)&&!e.length&&(e=null)),this._progress=e,this._modBy=this._modDataCount=null;var i=this._downstream;return i&&i.dirty(),n},t.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},t.prototype.pipe=function(t){(this._downstream!==t||this._dirty)&&(this._downstream=t,t._upstream=this,t.dirty())},t.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},t.prototype.getUpstream=function(){return this._upstream},t.prototype.getDownstream=function(){return this._downstream},t.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},t}(),hRt=function(){var t,e,n,i,r,o={reset:function(l,u,c,h){e=l,t=u,n=c,i=h,r=Math.ceil(i/n),o.next=n>1&&i>0?s:a}};return o;function a(){return e<t?e++:null}function s(){var o=e%r*n+Math.ceil(e/r),a=e>=t?null:o<i?o:e;return e++,a}}();function dRt(t,e){var n=e&&e.type;if("ordinal"===n){var i=e&&e.ordinalMeta;return i?i.parseAndCollect(t):t}return"time"===n&&"number"!=typeof t&&null!=t&&"-"!==t&&(t=+wAt(t)),null==t||""===t?NaN:+t}var pRt=Z_t({number:function(t){return parseFloat(t)},time:function(t){return+wAt(t)},trim:function(t){return"string"==typeof t?q_t(t):t}});function fRt(t){return pRt.get(t)}var gRt={lt:function(t,e){return t<e},lte:function(t,e){return t<=e},gt:function(t,e){return t>e},gte:function(t,e){return t>=e}},mRt=function(){function t(t,e){if("number"!=typeof e){EAt("")}this._opFn=gRt[t],this._rvalFloat=AAt(e)}return t.prototype.evaluate=function(t){return"number"==typeof t?this._opFn(t,this._rvalFloat):this._opFn(AAt(t),this._rvalFloat)},t}(),yRt=function(){function t(t,e){var n="desc"===t;this._resultLT=n?1:-1,null==e&&(e=n?"min":"max"),this._incomparable="min"===e?-1/0:1/0}return t.prototype.evaluate=function(t,e){var n=typeof t,i=typeof e,r="number"===n?t:AAt(t),o="number"===i?e:AAt(e),a=isNaN(r),s=isNaN(o);if(a&&(r=this._incomparable),s&&(o=this._incomparable),a&&s){var l="string"===n,u="string"===i;l&&(r=u?t:0),u&&(o=l?e:0)}return r<o?this._resultLT:r>o?-this._resultLT:0},t}(),vRt=function(){function t(t,e){this._rval=e,this._isEQ=t,this._rvalTypeof=typeof e,this._rvalFloat=AAt(e)}return t.prototype.evaluate=function(t){var e=t===this._rval;if(!e){var n=typeof t;n===this._rvalTypeof||"number"!==n&&"number"!==this._rvalTypeof||(e=AAt(t)===this._rvalFloat)}return this._isEQ?e:!e},t}();function xRt(t,e){return"eq"===t||"ne"===t?new vRt("eq"===t,e):tkt(gRt,t)?new mRt(t,e):null}var bRt=function(){function t(){}return t.prototype.getRawData=function(){throw new Error("not supported")},t.prototype.getRawDataItem=function(t){throw new Error("not supported")},t.prototype.cloneRawData=function(){},t.prototype.getDimensionInfo=function(t){},t.prototype.cloneAllDimensionInfo=function(){},t.prototype.count=function(){},t.prototype.retrieveValue=function(t,e){},t.prototype.retrieveValueFromItem=function(t,e){},t.prototype.convertValue=function(t,e){return dRt(t,e)},t}();function wRt(t){if(!IRt(t.sourceFormat)){EAt("")}return t.data}function _Rt(t){var e=t.sourceFormat,n=t.data;if(!IRt(e)){EAt("")}if("arrayRows"===e){for(var i=[],r=0,o=n.length;r<o;r++)i.push(n[r].slice());return i}if("objectRows"===e){for(i=[],r=0,o=n.length;r<o;r++)i.push(v_t({},n[r]));return i}}function kRt(t,e,n){if(null!=n)return"number"==typeof n||!isNaN(n)&&!tkt(e,n)?t[n]:tkt(e,n)?e[n]:void 0}function SRt(t){return g_t(t)}var CRt=Z_t();function ARt(t,e,n,i){e.length||EAt(""),L_t(t)||EAt("");var r=t.type,o=CRt.get(r);o||EAt("");var a=C_t(e,(function(t){return function(t,e){var n=new bRt,i=t.data,r=n.sourceFormat=t.sourceFormat,o=t.startIndex;"column"!==t.seriesLayoutBy&&EAt("");var a=[],s={},l=t.dimensionsDefine;if(l)S_t(l,(function(t,e){var n=t.name,i={index:e,name:n,displayName:t.displayName};a.push(i),null!=n&&(tkt(s,n)&&EAt(""),s[n]=i)}));else for(var u=0;u<t.dimensionsDetectedCount;u++)a.push({index:u});var c=ZFt(r,"column");e.__isBuiltIn&&(n.getRawDataItem=function(t){return c(i,o,a,t)},n.getRawData=D_t(wRt,null,t)),n.cloneRawData=D_t(_Rt,null,t);var h=tRt(r,"column");n.count=D_t(h,null,i,o,a);var d=iRt(r);n.retrieveValue=function(t,e){var n=c(i,o,a,t);return p(n,e)};var p=n.retrieveValueFromItem=function(t,e){if(null!=t){var n=a[e];return n?d(t,e,n.name):void 0}};return n.getDimensionInfo=D_t(kRt,null,a,s),n.cloneAllDimensionInfo=D_t(SRt,null,a),n}(t,o)}));return C_t(NAt(o.transform({upstream:a[0],upstreamList:a,config:g_t(t.config)})),(function(t,n){var i;L_t(t)||EAt(""),t.data||EAt(""),IRt(GFt(t.data))||EAt("");var r=e[0];if(r&&0===n&&!t.dimensions){var o=r.startIndex;o&&(t.data=r.data.slice(0,o).concat(t.data)),i={seriesLayoutBy:"column",sourceHeader:o,dimensions:r.metaRawOption.dimensions}}else i={seriesLayoutBy:"column",sourceHeader:0,dimensions:t.dimensions};return WFt(t.data,i,null,null)}))}function IRt(t){return"arrayRows"===t||"objectRows"===t}var MRt=function(){function t(t){this._sourceList=[],this._upstreamSignList=[],this._versionSignBase=0,this._sourceHost=t}return t.prototype.dirty=function(){this._setLocalSource([],[])},t.prototype._setLocalSource=function(t,e){this._sourceList=t,this._upstreamSignList=e,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},t.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},t.prototype.prepareSource=function(){this._isDirty()&&this._createSource()},t.prototype._createSource=function(){this._setLocalSource([],[]);var t,e,n=this._sourceHost,i=this._getUpstreamSourceManagers(),r=!!i.length;if(TRt(n)){var o=n,a=void 0,s=void 0,l=void 0;if(r){var u=i[0];u.prepareSource(),a=(l=u.getSource()).data,s=l.sourceFormat,e=[u._getVersionSign()]}else s=P_t(a=o.get("data",!0))?"typedArray":"original",e=[];var c=this._getSourceMetaRawOption(),h=l?l.metaRawOption:null;t=[WFt(a,{seriesLayoutBy:W_t(c.seriesLayoutBy,h?h.seriesLayoutBy:null),sourceHeader:W_t(c.sourceHeader,h?h.sourceHeader:null),dimensions:W_t(c.dimensions,h?h.dimensions:null)},s,o.get("encode",!0))]}else{var d=n;if(r){var p=this._applyTransform(i);t=p.sourceList,e=p.upstreamSignList}else{t=[WFt(d.get("source",!0),this._getSourceMetaRawOption(),null,null)],e=[]}}this._setLocalSource(t,e)},t.prototype._applyTransform=function(t){var e,n=this._sourceHost,i=n.get("transform",!0),r=n.get("fromTransformResult",!0);if(null!=r){1!==t.length&&ERt("")}var o,a=[],s=[];return S_t(t,(function(t){t.prepareSource();var e=t.getSource(r||0);null==r||e||ERt(""),a.push(e),s.push(t._getVersionSign())})),i?e=function(t,e,n){var i=NAt(t),r=i.length;r||EAt("");for(var o=0,a=r;o<a;o++)e=ARt(i[o],e),o!==a-1&&(e.length=Math.max(e.length,1));return e}(i,a,n.componentIndex):null!=r&&(e=[(o=a[0],new BFt({data:o.data,sourceFormat:o.sourceFormat,seriesLayoutBy:o.seriesLayoutBy,dimensionsDefine:g_t(o.dimensionsDefine),startIndex:o.startIndex,dimensionsDetectedCount:o.dimensionsDetectedCount,encodeDefine:UFt(o.encodeDefine)}))]),{sourceList:e,upstreamSignList:s}},t.prototype._isDirty=function(){if(!this._sourceList.length)return!0;for(var t=this._getUpstreamSourceManagers(),e=0;e<t.length;e++){var n=t[e];if(n._isDirty()||this._upstreamSignList[e]!==n._getVersionSign())return!0}},t.prototype.getSource=function(t){return this._sourceList[t||0]},t.prototype._getUpstreamSourceManagers=function(){var t=this._sourceHost;if(TRt(t)){var e=GOt(t);return e?[e.getSourceManager()]:[]}return C_t(function(t){return t.get("transform",!0)||t.get("fromTransformResult",!0)?YAt(t.ecModel,"dataset",{index:t.get("fromDatasetIndex",!0),id:t.get("fromDatasetId",!0)},qAt).models:[]}(t),(function(t){return t.getSourceManager()}))},t.prototype._getSourceMetaRawOption=function(){var t,e,n,i=this._sourceHost;if(TRt(i))t=i.get("seriesLayoutBy",!0),e=i.get("sourceHeader",!0),n=i.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var r=i;t=r.get("seriesLayoutBy",!0),e=r.get("sourceHeader",!0),n=r.get("dimensions",!0)}return{seriesLayoutBy:t,sourceHeader:e,dimensions:n}},t}();function DRt(t){t.option.transform&&X_t(t.option.transform)}function TRt(t){return"series"===t.mainType}function ERt(t){throw new Error(t)}function NRt(t,e){var n=t.color||"#6e7079",i=t.fontSize||12,r=t.fontWeight||"400",o=t.color||"#464646",a=t.fontSize||14,s=t.fontWeight||"900";return"html"===e?{nameStyle:"font-size:"+gOt(i+"")+"px;color:"+gOt(n)+";font-weight:"+gOt(r+""),valueStyle:"font-size:"+gOt(a+"")+"px;color:"+gOt(o)+";font-weight:"+gOt(s+"")}:{nameStyle:{fontSize:i,fill:n,fontWeight:r},valueStyle:{fontSize:a,fill:o,fontWeight:s}}}var ORt=[0,10,20,30],FRt=["","\n","\n\n","\n\n\n"];function RRt(t,e){return e.type=t,e}function LRt(t){return tkt($Rt,t.type)&&$Rt[t.type]}var $Rt={section:{planLayout:function(t){var e=t.blocks.length,n=e>1||e>0&&!t.noHeader,i=0;S_t(t.blocks,(function(t){LRt(t).planLayout(t);var e=t.__gapLevelBetweenSubBlocks;e>=i&&(i=e+(!n||e&&("section"!==t.type||t.noHeader)?0:1))})),t.__gapLevelBetweenSubBlocks=i},build:function(t,e,n,i){var r=e.noHeader,o=zRt(e),a=function(t,e,n,i){var r=[],o=e.blocks||[];H_t(!o||E_t(o)),o=o||[];var a=t.orderMode;if(e.sortBlocks&&a){o=o.slice();var s={valueAsc:"asc",valueDesc:"desc"};if(tkt(s,a)){var l=new yRt(s[a],null);o.sort((function(t,e){return l.evaluate(t.sortParam,e.sortParam)}))}else"seriesDesc"===a&&o.reverse()}var u=zRt(e);if(S_t(o,(function(e,n){var o=LRt(e).build(t,e,n>0?u.html:0,i);null!=o&&r.push(o)})),!r.length)return;return"richText"===t.renderMode?r.join(u.richText):BRt(r.join(""),n)}(t,e,r?n:o.html,i);if(r)return a;var s=mOt(e.header,"ordinal",t.useUTC),l=NRt(i,t.renderMode).nameStyle;return"richText"===t.renderMode?VRt(t,s,l)+o.richText+a:BRt('<div style="'+l+';line-height:1;">'+gOt(s)+"</div>"+a,n)}},nameValue:{planLayout:function(t){t.__gapLevelBetweenSubBlocks=0},build:function(t,e,n,i){var r=t.renderMode,o=e.noName,a=e.noValue,s=!e.markerType,l=e.name,u=e.value,c=t.useUTC;if(!o||!a){var h=s?"":t.markupStyleCreator.makeTooltipMarker(e.markerType,e.markerColor||"#333",r),d=o?"":mOt(l,"ordinal",c),p=e.valueType,f=a?[]:E_t(u)?C_t(u,(function(t,e){return mOt(t,E_t(p)?p[e]:p,c)})):[mOt(u,E_t(p)?p[0]:p,c)],g=!s||!o,m=!s&&o,y=NRt(i,r),v=y.nameStyle,x=y.valueStyle;return"richText"===r?(s?"":h)+(o?"":VRt(t,d,v))+(a?"":function(t,e,n,i,r){var o=[r],a=i?10:20;return n&&o.push({padding:[0,0,0,a],align:"right"}),t.markupStyleCreator.wrapRichTextStyle(e.join("  "),o)}(t,f,g,m,x)):BRt((s?"":h)+(o?"":function(t,e,n){return'<span style="'+n+";"+(e?"margin-left:2px":"")+'">'+gOt(t)+"</span>"}(d,!s,v))+(a?"":function(t,e,n,i){var r=n?"10px":"20px";return'<span style="'+(e?"float:right;margin-left:"+r:"")+";"+i+'">'+C_t(t,(function(t){return gOt(t)})).join("&nbsp;&nbsp;")+"</span>"}(f,g,m,x)),n)}}}};function PRt(t,e,n,i,r,o){if(t){var a=LRt(t);a.planLayout(t);var s={useUTC:r,renderMode:n,orderMode:i,markupStyleCreator:e};return a.build(s,t,0,o)}}function zRt(t){var e=t.__gapLevelBetweenSubBlocks;return{html:ORt[e],richText:FRt[e]}}function BRt(t,e){return'<div style="'+("margin: "+e+"px 0 0")+';line-height:1;">'+t+'<div style="clear:both"></div></div>'}function VRt(t,e,n){return t.markupStyleCreator.wrapRichTextStyle(e,n)}function WRt(t,e){return bOt(t.getData().getItemVisual(e,"style")[t.visualDrawType])}function jRt(t,e){var n=t.get("padding");return null!=n?n:"richText"===e?[8,10]:10}var URt=function(){function t(){this.richTextStyles={},this._nextStyleNameId=MAt()}return t.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},t.prototype.makeTooltipMarker=function(t,e,n){var i="richText"===n?this._generateStyleName():null,r=function(t,e){var n=O_t(t)?{color:t,extraCssText:e}:t||{},i=n.color,r=n.type;e=n.extraCssText;var o=n.renderMode||"html";return i?"html"===o?"subItem"===r?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+gOt(i)+";"+(e||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+gOt(i)+";"+(e||"")+'"></span>':{renderMode:o,content:"{"+(n.markerId||"markerX")+"|}  ",style:"subItem"===r?{width:4,height:4,borderRadius:2,backgroundColor:i}:{width:10,height:10,borderRadius:5,backgroundColor:i}}:""}({color:e,type:t,renderMode:n,markerId:i});return O_t(r)?r:(this.richTextStyles[i]=r.style,r.content)},t.prototype.wrapRichTextStyle=function(t,e){var n={};E_t(e)?S_t(e,(function(t){return v_t(n,t)})):v_t(n,e);var i=this._generateStyleName();return this.richTextStyles[i]=n,"{"+i+"|"+t+"}"},t}();function GRt(t){var e,n,i,r,o=t.series,a=t.dataIndex,s=t.multipleSeries,l=o.getData(),u=l.mapDimensionsAll("defaultedTooltip"),c=u.length,h=o.getRawValue(a),d=E_t(h),p=WRt(o,a);if(c>1||d&&!c){var f=function(t,e,n,i,r){var o=e.getData(),a=A_t(t,(function(t,e,n){var i=o.getDimensionInfo(n);return t||i&&!1!==i.tooltip&&null!=i.displayName}),!1),s=[],l=[],u=[];function c(t,e){var n=o.getDimensionInfo(e);n&&!1!==n.otherDims.tooltip&&(a?u.push(RRt("nameValue",{markerType:"subItem",markerColor:r,name:n.displayName,value:t,valueType:n.type})):(s.push(t),l.push(n.type)))}return i.length?S_t(i,(function(t){c(oRt(o,n,t),t)})):S_t(t,c),{inlineValues:s,inlineValueTypes:l,blocks:u}}(h,o,a,u,p);e=f.inlineValues,n=f.inlineValueTypes,i=f.blocks,r=f.inlineValues[0]}else if(c){var g=l.getDimensionInfo(u[0]);r=e=oRt(l,a,u[0]),n=g.type}else r=e=d?h[0]:h;var m=BAt(o),y=m&&o.name||"",v=l.getName(a),x=s?y:v;return RRt("section",{header:y,noHeader:s||!m,sortParam:r,blocks:[RRt("nameValue",{markerType:"item",markerColor:p,name:x,noName:!q_t(x),value:e,valueType:n})].concat(i||[])})}var HRt=jAt();function qRt(t,e){return t.getName(e)||t.getId(e)}var XRt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selectedDataIndicesMap={},e}var n;return Dit(e,t),e.prototype.init=function(t,e,n){this.seriesIndex=this.componentIndex,this.dataTask=uRt({count:KRt,reset:ZRt}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(t,n),(HRt(this).sourceManager=new MRt(this)).prepareSource();var i=this.getInitialData(t,n);QRt(i,this),this.dataTask.context.data=i,HRt(this).dataBeforeProcessed=i,YRt(this),this._initSelectedMapFromData(i)},e.prototype.mergeDefaultAndTheme=function(t,e){var n=DOt(this),i=n?EOt(t):{},r=this.subType;FOt.hasClass(r)&&(r+="Series"),m_t(t,e.getTheme().get(this.subType)),m_t(t,this.getDefaultOption()),OAt(t,"label",["show"]),this.fillDataTextStyle(t.data),n&&TOt(t,i,n)},e.prototype.mergeOption=function(t,e){t=m_t(this.option,t,!0),this.fillDataTextStyle(t.data);var n=DOt(this);n&&TOt(this.option,t,n);var i=HRt(this).sourceManager;i.dirty(),i.prepareSource();var r=this.getInitialData(t,e);QRt(r,this),this.dataTask.dirty(),this.dataTask.context.data=r,HRt(this).dataBeforeProcessed=r,YRt(this),this._initSelectedMapFromData(r)},e.prototype.fillDataTextStyle=function(t){if(t&&!P_t(t))for(var e=["show"],n=0;n<t.length;n++)t[n]&&t[n].label&&OAt(t[n],"label",e)},e.prototype.getInitialData=function(t,e){},e.prototype.appendData=function(t){this.getRawData().appendData(t.data)},e.prototype.getData=function(t){var e=eLt(this);if(e){var n=e.context.data;return null==t?n:n.getLinkedData(t)}return HRt(this).data},e.prototype.getAllData=function(){var t=this.getData();return t&&t.getLinkedDataAll?t.getLinkedDataAll():[{data:t}]},e.prototype.setData=function(t){var e=eLt(this);if(e){var n=e.context;n.outputData=t,e!==this.dataTask&&(n.data=t)}HRt(this).data=t},e.prototype.getSource=function(){return HRt(this).sourceManager.getSource()},e.prototype.getRawData=function(){return HRt(this).dataBeforeProcessed},e.prototype.getBaseAxis=function(){var t=this.coordinateSystem;return t&&t.getBaseAxis&&t.getBaseAxis()},e.prototype.formatTooltip=function(t,e,n){return GRt({series:this,dataIndex:t,multipleSeries:e})},e.prototype.isAnimationEnabled=function(){if(t_t.node)return!1;var t=this.getShallow("animation");return t&&this.getData().count()>this.getShallow("animationThreshold")&&(t=!1),!!t},e.prototype.restoreData=function(){this.dataTask.dirty()},e.prototype.getColorFromPalette=function(t,e,n){var i=this.ecModel,r=tFt.prototype.getColorFromPalette.call(this,t,e,n);return r||(r=i.getColorFromPalette(t,e,n)),r},e.prototype.coordDimToDataDim=function(t){return this.getRawData().mapDimensionsAll(t)},e.prototype.getProgressive=function(){return this.get("progressive")},e.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},e.prototype.select=function(t,e){this._innerSelect(this.getData(e),t)},e.prototype.unselect=function(t,e){var n=this.option.selectedMap;if(n)for(var i=this.getData(e),r=0;r<t.length;r++){var o=qRt(i,t[r]);n[o]=!1,this._selectedDataIndicesMap[o]=-1}},e.prototype.toggleSelect=function(t,e){for(var n=[],i=0;i<t.length;i++)n[0]=t[i],this.isSelected(t[i],e)?this.unselect(n,e):this.select(n,e)},e.prototype.getSelectedDataIndices=function(){for(var t=this._selectedDataIndicesMap,e=M_t(t),n=[],i=0;i<e.length;i++){var r=t[e[i]];r>=0&&n.push(r)}return n},e.prototype.isSelected=function(t,e){var n=this.option.selectedMap;return n&&n[qRt(this.getData(e),t)]||!1},e.prototype._innerSelect=function(t,e){var n,i,r=this.option.selectedMode,o=e.length;if(r&&o)if("multiple"===r)for(var a=this.option.selectedMap||(this.option.selectedMap={}),s=0;s<o;s++){var l=e[s];a[c=qRt(t,l)]=!0,this._selectedDataIndicesMap[c]=t.getRawIndex(l)}else if("single"===r||!0===r){var u=e[o-1],c=qRt(t,u);this.option.selectedMap=((n={})[c]=!0,n),this._selectedDataIndicesMap=((i={})[c]=t.getRawIndex(u),i)}},e.prototype._initSelectedMapFromData=function(t){if(!this.option.selectedMap){var e=[];t.hasItemOption&&t.each((function(n){var i=t.getRawDataItem(n);i&&i.selected&&e.push(n)})),e.length>0&&this._innerSelect(t,e)}},e.registerClass=function(t){return FOt.registerClass(t)},e.protoInitialize=((n=e.prototype).type="series.__base__",n.seriesIndex=0,n.useColorPaletteOnData=!1,n.ignoreStyleOnData=!1,n.hasSymbolVisual=!1,n.defaultSymbol="circle",n.visualStyleAccessPath="itemStyle",void(n.visualDrawType="fill")),e}(FOt);function YRt(t){var e=t.name;BAt(t)||(t.name=function(t){var e=t.getRawData(),n=e.mapDimensionsAll("seriesName"),i=[];return S_t(n,(function(t){var n=e.getDimensionInfo(t);n.displayName&&i.push(n.displayName)})),i.join(" ")}(t)||e)}function KRt(t){return t.model.getRawData().count()}function ZRt(t){var e=t.model;return e.setData(e.getRawData().cloneShallow()),JRt}function JRt(t,e){e.outputData&&t.end>e.outputData.count()&&e.model.getRawData().cloneShallow(e.outputData)}function QRt(t,e){S_t(Nit(t.CHANGABLE_METHODS,t.DOWNSAMPLE_METHODS),(function(n){t.wrapMethod(n,T_t(tLt,e))}))}function tLt(t,e){var n=eLt(t);return n&&n.setOutputEnd((e||this).count()),e}function eLt(t){var e=(t.ecModel||{}).scheduler,n=e&&e.getPipeline(t.uid);if(n){var i=n.currentTask;if(i){var r=i.agentStubMap;r&&(i=r.get(t.uid))}return i}}__t(XRt,sRt),__t(XRt,tFt),iIt(XRt,FOt);var nLt=function(){function t(){this.group=new oAt,this.uid=FNt("viewComponent")}return t.prototype.init=function(t,e){},t.prototype.render=function(t,e,n,i){},t.prototype.dispose=function(t,e){},t.prototype.updateView=function(t,e,n,i){},t.prototype.updateLayout=function(t,e,n,i){},t.prototype.updateVisual=function(t,e,n,i){},t.prototype.blurSeries=function(t,e){},t}();function iLt(){var t=jAt();return function(e){var n=t(e),i=e.pipelineContext,r=!!n.large,o=!!n.progressiveRender,a=n.large=!(!i||!i.large),s=n.progressiveRender=!(!i||!i.progressiveRender);return!(r===a&&o===s)&&"reset"}}eIt(nLt),sIt(nLt);var rLt=jAt(),oLt=iLt(),aLt=function(){function t(){this.group=new oAt,this.uid=FNt("viewChart"),this.renderTask=uRt({plan:uLt,reset:cLt}),this.renderTask.context={view:this}}return t.prototype.init=function(t,e){},t.prototype.render=function(t,e,n,i){},t.prototype.highlight=function(t,e,n,i){lLt(t.getData(),i,"emphasis")},t.prototype.downplay=function(t,e,n,i){lLt(t.getData(),i,"normal")},t.prototype.remove=function(t,e){this.group.removeAll()},t.prototype.dispose=function(t,e){},t.prototype.updateView=function(t,e,n,i){this.render(t,e,n,i)},t.prototype.updateLayout=function(t,e,n,i){this.render(t,e,n,i)},t.prototype.updateVisual=function(t,e,n,i){this.render(t,e,n,i)},t.markUpdateMethod=function(t,e){rLt(t).updateMethod=e},t.protoInitialize=void(t.prototype.type="chart"),t}();function sLt(t,e,n){t&&("emphasis"===e?KDt:ZDt)(t,n)}function lLt(t,e,n){var i=WAt(t,e),r=e&&null!=e.highlightKey?function(t){var e=DDt[t];return null==e&&MDt<=32&&(e=DDt[t]=MDt++),e}(e.highlightKey):null;null!=i?S_t(NAt(i),(function(e){sLt(t.getItemGraphicEl(e),n,r)})):t.eachItemGraphicEl((function(t){sLt(t,n,r)}))}function uLt(t){return oLt(t.model)}function cLt(t){var e=t.model,n=t.ecModel,i=t.api,r=t.payload,o=e.pipelineContext.progressiveRender,a=t.view,s=r&&rLt(r).updateMethod,l=o?"incrementalPrepareRender":s&&a[s]?s:"render";return"render"!==l&&a[l](e,n,i,r),hLt[l]}eIt(aLt),sIt(aLt);var hLt={incrementalPrepareRender:{progress:function(t,e){e.view.incrementalRender(t,e.model,e.ecModel,e.api,e.payload)}},render:{forceFirstProgress:!0,progress:function(t,e){e.view.render(e.model,e.ecModel,e.api,e.payload)}}},dLt="\0__throttleOriginMethod",pLt="\0__throttleRate";function fLt(t,e,n){var i,r,o,a,s,l=0,u=0,c=null;function h(){u=(new Date).getTime(),c=null,t.apply(o,a||[])}e=e||0;var d=function(){for(var t=[],d=0;d<arguments.length;d++)t[d]=arguments[d];i=(new Date).getTime(),o=this,a=t;var p=s||e,f=s||n;s=null,r=i-(f?l:u)-p,clearTimeout(c),f?c=setTimeout(h,p):r>=0?h():c=setTimeout(h,-r),l=i};return d.clear=function(){c&&(clearTimeout(c),c=null)},d.debounceNextCall=function(t){s=t},d}function gLt(t,e,n,i){var r=t[e];if(r){var o=r[dLt]||r,a=r["\0__throttleType"];if(r[pLt]!==n||a!==i){if(null==n||!i)return t[e]=o;(r=t[e]=fLt(o,n,"debounce"===i))[dLt]=o,r["\0__throttleType"]=i,r[pLt]=n}return r}}var mLt=jAt(),yLt={itemStyle:lIt(DNt,!0),lineStyle:lIt(ANt,!0)},vLt={lineStyle:"stroke",itemStyle:"fill"};function xLt(t,e){var n=t.visualStyleMapper||yLt[e];return n||(console.warn("Unkown style type '"+e+"'."),yLt.itemStyle)}function bLt(t,e){var n=t.visualDrawType||vLt[e];return n||(console.warn("Unkown style type '"+e+"'."),"fill")}var wLt={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){var n=t.getData(),i=t.visualStyleAccessPath||"itemStyle",r=t.getModel(i),o=xLt(t,i)(r),a=r.getShallow("decal");a&&(n.setVisual("decal",a),a.dirty=!0);var s=bLt(t,i),l=o[s],u=N_t(l)?l:null,c="auto"===o.fill||"auto"===o.stroke;if(!o[s]||u||c){var h=t.getColorFromPalette(t.name,null,e.getSeriesCount());o[s]||(o[s]=h,n.setVisual("colorFromPalette",!0)),o.fill="auto"===o.fill||"function"==typeof o.fill?h:o.fill,o.stroke="auto"===o.stroke||"function"==typeof o.stroke?h:o.stroke}if(n.setVisual("style",o),n.setVisual("drawType",s),!e.isSeriesFiltered(t)&&u)return n.setVisual("colorFromPalette",!1),{dataEach:function(e,n){var i=t.getDataParams(n),r=v_t({},o);r[s]=u(i),e.setItemVisual(n,"style",r)}}}},_Lt=new NNt,kLt={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){if(!t.ignoreStyleOnData&&!e.isSeriesFiltered(t)){var n=t.getData(),i=t.visualStyleAccessPath||"itemStyle",r=xLt(t,i),o=n.getVisual("drawType");return{dataEach:n.hasItemOption?function(t,e){var n=t.getRawDataItem(e);if(n&&n[i]){_Lt.option=n[i];var a=r(_Lt);v_t(t.ensureUniqueItemVisual(e,"style"),a),_Lt.option.decal&&(t.setItemVisual(e,"decal",_Lt.option.decal),_Lt.option.decal.dirty=!0),o in a&&t.setItemVisual(e,"colorFromPalette",!1)}}:null}}}},SLt={performRawSeries:!0,overallReset:function(t){var e=Z_t();t.eachSeries((function(t){if(t.useColorPaletteOnData){var n=e.get(t.type);n||(n={},e.set(t.type,n)),mLt(t).scope=n}})),t.eachSeries((function(e){if(e.useColorPaletteOnData&&!t.isSeriesFiltered(e)){var n=e.getRawData(),i={},r=e.getData(),o=mLt(e).scope,a=e.visualStyleAccessPath||"itemStyle",s=bLt(e,a);r.each((function(t){var e=r.getRawIndex(t);i[e]=t})),n.each((function(t){var a=i[t];if(r.getItemVisual(a,"colorFromPalette")){var l=r.ensureUniqueItemVisual(a,"style"),u=n.getName(t)||t+"",c=n.count();l[s]=e.getColorFromPalette(u,o,c)}}))}}))}},CLt=Math.PI;var ALt=function(){function t(t,e,n,i){this._stageTaskMap=Z_t(),this.ecInstance=t,this.api=e,n=this._dataProcessorHandlers=n.slice(),i=this._visualHandlers=i.slice(),this._allHandlers=n.concat(i)}return t.prototype.restoreData=function(t,e){t.restoreData(e),this._stageTaskMap.each((function(t){var e=t.overallTask;e&&e.dirty()}))},t.prototype.getPerformArgs=function(t,e){if(t.__pipeline){var n=this._pipelineMap.get(t.__pipeline.id),i=n.context,r=!e&&n.progressiveEnabled&&(!i||i.progressiveRender)&&t.__idxInPipeline>n.blockIndex?n.step:null,o=i&&i.modDataCount;return{step:r,modBy:null!=o?Math.ceil(o/r):null,modDataCount:o}}},t.prototype.getPipeline=function(t){return this._pipelineMap.get(t)},t.prototype.updateStreamModes=function(t,e){var n=this._pipelineMap.get(t.uid),i=t.getData().count(),r=n.progressiveEnabled&&e.incrementalPrepareRender&&i>=n.threshold,o=t.get("large")&&i>=t.get("largeThreshold"),a="mod"===t.get("progressiveChunkMode")?i:null;t.pipelineContext=n.context={progressiveRender:r,modDataCount:a,large:o}},t.prototype.restorePipelines=function(t){var e=this,n=e._pipelineMap=Z_t();t.eachSeries((function(t){var i=t.getProgressive(),r=t.uid;n.set(r,{id:r,head:null,tail:null,threshold:t.getProgressiveThreshold(),progressiveEnabled:i&&!(t.preventIncremental&&t.preventIncremental()),blockIndex:-1,step:Math.round(i||700),count:0}),e._pipe(t,t.dataTask)}))},t.prototype.prepareStageTasks=function(){var t=this._stageTaskMap,e=this.api.getModel(),n=this.api;S_t(this._allHandlers,(function(i){var r=t.get(i.uid)||t.set(i.uid,{});H_t(!(i.reset&&i.overallReset),""),i.reset&&this._createSeriesStageTask(i,r,e,n),i.overallReset&&this._createOverallStageTask(i,r,e,n)}),this)},t.prototype.prepareView=function(t,e,n,i){var r=t.renderTask,o=r.context;o.model=e,o.ecModel=n,o.api=i,r.__block=!t.incrementalPrepareRender,this._pipe(e,r)},t.prototype.performDataProcessorTasks=function(t,e){this._performStageTasks(this._dataProcessorHandlers,t,e,{block:!0})},t.prototype.performVisualTasks=function(t,e,n){this._performStageTasks(this._visualHandlers,t,e,n)},t.prototype._performStageTasks=function(t,e,n,i){i=i||{};var r=!1,o=this;function a(t,e){return t.setDirty&&(!t.dirtyMap||t.dirtyMap.get(e.__pipeline.id))}S_t(t,(function(t,s){if(!i.visualType||i.visualType===t.visualType){var l=o._stageTaskMap.get(t.uid),u=l.seriesTaskMap,c=l.overallTask;if(c){var h,d=c.agentStubMap;d.each((function(t){a(i,t)&&(t.dirty(),h=!0)})),h&&c.dirty(),o.updatePayload(c,n);var p=o.getPerformArgs(c,i.block);d.each((function(t){t.perform(p)})),c.perform(p)&&(r=!0)}else u&&u.each((function(s,l){a(i,s)&&s.dirty();var u=o.getPerformArgs(s,i.block);u.skip=!t.performRawSeries&&e.isSeriesFiltered(s.context.model),o.updatePayload(s,n),s.perform(u)&&(r=!0)}))}})),this.unfinished=r||this.unfinished},t.prototype.performSeriesTasks=function(t){var e;t.eachSeries((function(t){e=t.dataTask.perform()||e})),this.unfinished=e||this.unfinished},t.prototype.plan=function(){this._pipelineMap.each((function(t){var e=t.tail;do{if(e.__block){t.blockIndex=e.__idxInPipeline;break}e=e.getUpstream()}while(e)}))},t.prototype.updatePayload=function(t,e){"remain"!==e&&(t.context.payload=e)},t.prototype._createSeriesStageTask=function(t,e,n,i){var r=this,o=e.seriesTaskMap,a=e.seriesTaskMap=Z_t(),s=t.seriesType,l=t.getTargetSeries;function u(e){var s=e.uid,l=a.set(s,o&&o.get(s)||uRt({plan:ELt,reset:NLt,count:RLt}));l.context={model:e,ecModel:n,api:i,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:r},r._pipe(e,l)}t.createOnAllSeries?n.eachRawSeries(u):s?n.eachRawSeriesByType(s,u):l&&l(n,i).each(u)},t.prototype._createOverallStageTask=function(t,e,n,i){var r=this,o=e.overallTask=e.overallTask||uRt({reset:ILt});o.context={ecModel:n,api:i,overallReset:t.overallReset,scheduler:r};var a=o.agentStubMap,s=o.agentStubMap=Z_t(),l=t.seriesType,u=t.getTargetSeries,c=!0,h=!1;function d(t){var e=t.uid,n=s.set(e,a&&a.get(e)||(h=!0,uRt({reset:MLt,onDirty:TLt})));n.context={model:t,overallProgress:c},n.agent=o,n.__block=c,r._pipe(t,n)}H_t(!t.createOnAllSeries,""),l?n.eachRawSeriesByType(l,d):u?u(n,i).each(d):(c=!1,S_t(n.getSeries(),d)),h&&o.dirty()},t.prototype._pipe=function(t,e){var n=t.uid,i=this._pipelineMap.get(n);!i.head&&(i.head=e),i.tail&&i.tail.pipe(e),i.tail=e,e.__idxInPipeline=i.count++,e.__pipeline=i},t.wrapStageHandler=function(t,e){return N_t(t)&&(t={overallReset:t,seriesType:LLt(t)}),t.uid=FNt("stageHandler"),e&&(t.visualType=e),t},t}();function ILt(t){t.overallReset(t.ecModel,t.api,t.payload)}function MLt(t){return t.overallProgress&&DLt}function DLt(){this.agent.dirty(),this.getDownstream().dirty()}function TLt(){this.agent&&this.agent.dirty()}function ELt(t){return t.plan?t.plan(t.model,t.ecModel,t.api,t.payload):null}function NLt(t){t.useClearVisual&&t.data.clearAllVisual();var e=t.resetDefines=NAt(t.reset(t.model,t.ecModel,t.api,t.payload));return e.length>1?C_t(e,(function(t,e){return FLt(e)})):OLt}var OLt=FLt(0);function FLt(t){return function(e,n){var i=n.data,r=n.resetDefines[t];if(r&&r.dataEach)for(var o=e.start;o<e.end;o++)r.dataEach(i,o);else r&&r.progress&&r.progress(e,i)}}function RLt(t){return t.data.count()}function LLt(t){$Lt=null;try{t(PLt,zLt)}catch(t){}return $Lt}var $Lt,PLt={},zLt={};function BLt(t,e){for(var n in e.prototype)t[n]=ekt}BLt(PLt,iFt),BLt(zLt,lFt),PLt.eachSeriesByType=PLt.eachRawSeriesByType=function(t){$Lt=t},PLt.eachComponent=function(t){"series"===t.mainType&&t.subType&&($Lt=t.subType)};var VLt=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],WLt={color:VLt,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],VLt]},jLt=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],ULt={darkMode:!0,color:jLt,backgroundColor:"#100C2A",axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:"#B9B8CE"}},textStyle:{color:"#B9B8CE"},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:"#B9B8CE"}},dataZoom:{borderColor:"#71708A",textStyle:{color:"#B9B8CE"},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:"#B9B8CE"}},timeline:{lineStyle:{color:"#B9B8CE"},label:{color:"#B9B8CE"},controlStyle:{color:"#B9B8CE",borderColor:"#B9B8CE"}},calendar:{itemStyle:{color:"#100C2A"},dayLabel:{color:"#B9B8CE"},monthLabel:{color:"#B9B8CE"},yearLabel:{color:"#B9B8CE"}},timeAxis:{axisLine:{lineStyle:{color:"#B9B8CE"}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}},logAxis:{axisLine:{lineStyle:{color:"#B9B8CE"}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}},valueAxis:{axisLine:{lineStyle:{color:"#B9B8CE"}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}},categoryAxis:{axisLine:{lineStyle:{color:"#B9B8CE"}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}},line:{symbol:"circle"},graph:{color:jLt},gauge:{title:{color:"#B9B8CE"},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:"#B9B8CE"},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};ULt.categoryAxis.splitLine.show=!1;var GLt=function(){function t(){}return t.prototype.normalizeQuery=function(t){var e={},n={},i={};if(O_t(t)){var r=tIt(t);e.mainType=r.main||null,e.subType=r.sub||null}else{var o=["Index","Name","Id"],a={name:1,dataIndex:1,dataType:1};S_t(t,(function(t,r){for(var s=!1,l=0;l<o.length;l++){var u=o[l],c=r.lastIndexOf(u);if(c>0&&c===r.length-u.length){var h=r.slice(0,c);"data"!==h&&(e.mainType=h,e[u.toLowerCase()]=t,s=!0)}}a.hasOwnProperty(r)&&(n[r]=t,s=!0),s||(i[r]=t)}))}return{cptQuery:e,dataQuery:n,otherQuery:i}},t.prototype.filter=function(t,e){var n=this.eventInfo;if(!n)return!0;var i=n.targetEl,r=n.packedEvent,o=n.model,a=n.view;if(!o||!a)return!0;var s=e.cptQuery,l=e.dataQuery;return u(s,o,"mainType")&&u(s,o,"subType")&&u(s,o,"index","componentIndex")&&u(s,o,"name")&&u(s,o,"id")&&u(l,r,"name")&&u(l,r,"dataIndex")&&u(l,r,"dataType")&&(!a.filterForExposedEvent||a.filterForExposedEvent(t,e.otherQuery,i,r));function u(t,e,n,i){return null==t[n]||e[i||n]===t[n]}},t.prototype.afterTrigger=function(){this.eventInfo=null},t}(),HLt={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){var n=t.getData();if(t.legendIcon&&n.setVisual("legendIcon",t.legendIcon),t.hasSymbolVisual){var i=t.get("symbol"),r=t.get("symbolSize"),o=t.get("symbolKeepAspect"),a=t.get("symbolRotate"),s=t.get("symbolOffset"),l=N_t(i),u=N_t(r),c=N_t(a),h=N_t(s),d=l||u||c||h,p=!l&&i?i:t.defaultSymbol,f=u?null:r,g=c?null:a,m=h?null:s;if(n.setVisual({legendIcon:t.legendIcon||p,symbol:p,symbolSize:f,symbolKeepAspect:o,symbolRotate:g,symbolOffset:m}),!e.isSeriesFiltered(t))return{dataEach:d?function(e,n){var o=t.getRawValue(n),d=t.getDataParams(n);l&&e.setItemVisual(n,"symbol",i(o,d)),u&&e.setItemVisual(n,"symbolSize",r(o,d)),c&&e.setItemVisual(n,"symbolRotate",a(o,d)),h&&e.setItemVisual(n,"symbolOffset",s(o,d))}:null}}}};function qLt(t,e,n){switch(n){case"color":return t.getItemVisual(e,"style")[t.getVisual("drawType")];case"opacity":return t.getItemVisual(e,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return t.getItemVisual(e,n)}}function XLt(t,e){switch(e){case"color":return t.getVisual("style")[t.getVisual("drawType")];case"opacity":return t.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return t.getVisual(e)}}function YLt(t,e,n,i){switch(n){case"color":t.ensureUniqueItemVisual(e,"style")[t.getVisual("drawType")]=i,t.setItemVisual(e,"colorFromPalette",!1);break;case"opacity":t.ensureUniqueItemVisual(e,"style").opacity=i;break;case"symbol":case"symbolSize":case"liftZ":t.setItemVisual(e,n,i)}}var KLt=2*Math.PI,ZLt=PMt.CMD,JLt=["top","right","bottom","left"];function QLt(t,e,n,i,r){var o=n.width,a=n.height;switch(t){case"top":i.set(n.x+o/2,n.y-e),r.set(0,-1);break;case"bottom":i.set(n.x+o/2,n.y+a+e),r.set(0,1);break;case"left":i.set(n.x-e,n.y+a/2),r.set(-1,0);break;case"right":i.set(n.x+o+e,n.y+a/2),r.set(1,0)}}function t$t(t,e,n,i,r,o,a,s,l){a-=t,s-=e;var u=Math.sqrt(a*a+s*s),c=(a/=u)*n+t,h=(s/=u)*n+e;if(Math.abs(i-r)%KLt<1e-4)return l[0]=c,l[1]=h,u-n;if(o){var d=i;i=jMt(r),r=jMt(d)}else i=jMt(i),r=jMt(r);i>r&&(r+=KLt);var p=Math.atan2(s,a);if(p<0&&(p+=KLt),p>=i&&p<=r||p+KLt>=i&&p+KLt<=r)return l[0]=c,l[1]=h,u-n;var f=n*Math.cos(i)+t,g=n*Math.sin(i)+e,m=n*Math.cos(r)+t,y=n*Math.sin(r)+e,v=(f-a)*(f-a)+(g-s)*(g-s),x=(m-a)*(m-a)+(y-s)*(y-s);return v<x?(l[0]=f,l[1]=g,Math.sqrt(v)):(l[0]=m,l[1]=y,Math.sqrt(x))}function e$t(t,e,n,i,r,o,a,s){var l=r-t,u=o-e,c=n-t,h=i-e,d=Math.sqrt(c*c+h*h),p=(l*(c/=d)+u*(h/=d))/d;s&&(p=Math.min(Math.max(p,0),1)),p*=d;var f=a[0]=t+p*c,g=a[1]=e+p*h;return Math.sqrt((f-r)*(f-r)+(g-o)*(g-o))}function n$t(t,e,n,i,r,o,a){n<0&&(t+=n,n=-n),i<0&&(e+=i,i=-i);var s=t+n,l=e+i,u=a[0]=Math.min(Math.max(r,t),s),c=a[1]=Math.min(Math.max(o,e),l);return Math.sqrt((u-r)*(u-r)+(c-o)*(c-o))}var i$t=[];function r$t(t,e,n){var i=n$t(e.x,e.y,e.width,e.height,t.x,t.y,i$t);return n.set(i$t[0],i$t[1]),i}function o$t(t,e,n){for(var i,r,o=0,a=0,s=0,l=0,u=1/0,c=e.data,h=t.x,d=t.y,p=0;p<c.length;){var f=c[p++];1===p&&(s=o=c[p],l=a=c[p+1]);var g=u;switch(f){case ZLt.M:o=s=c[p++],a=l=c[p++];break;case ZLt.L:g=e$t(o,a,c[p],c[p+1],h,d,i$t,!0),o=c[p++],a=c[p++];break;case ZLt.C:g=KIt(o,a,c[p++],c[p++],c[p++],c[p++],c[p],c[p+1],h,d,i$t),o=c[p++],a=c[p++];break;case ZLt.Q:g=nMt(o,a,c[p++],c[p++],c[p],c[p+1],h,d,i$t),o=c[p++],a=c[p++];break;case ZLt.A:var m=c[p++],y=c[p++],v=c[p++],x=c[p++],b=c[p++],w=c[p++];p+=1;var _=!!(1-c[p++]);i=Math.cos(b)*v+m,r=Math.sin(b)*x+y,p<=1&&(s=i,l=r),g=t$t(m,y,x,b,b+w,_,(h-m)*x/v+m,d,i$t),o=Math.cos(b+w)*v+m,a=Math.sin(b+w)*x+y;break;case ZLt.R:g=n$t(s=o=c[p++],l=a=c[p++],c[p++],c[p++],h,d,i$t);break;case ZLt.Z:g=e$t(o,a,s,l,h,d,i$t,!0),o=s,a=l}g<u&&(u=g,n.set(i$t[0],i$t[1]))}return u}var a$t=new DCt,s$t=new DCt,l$t=new DCt,u$t=new DCt,c$t=new DCt;function h$t(t,e){if(t){var n=t.getTextGuideLine(),i=t.getTextContent();if(i&&n){var r=t.textGuideLineConfig||{},o=[[0,0],[0,0],[0,0]],a=r.candidates||JLt,s=i.getBoundingRect().clone();s.applyTransform(i.getComputedTransform());var l=1/0,u=r.anchor,c=t.getComputedTransform(),h=c&&xCt([],c),d=e.get("length2")||0;u&&l$t.copy(u);for(var p=0;p<a.length;p++){QLt(a[p],0,s,a$t,u$t),DCt.scaleAndAdd(s$t,a$t,u$t,d),s$t.transform(h);var f=t.getBoundingRect(),g=u?u.distance(s$t):t instanceof rDt?o$t(s$t,t.path,l$t):r$t(s$t,f,l$t);g<l&&(l=g,s$t.transform(c),l$t.transform(c),l$t.toArray(o[0]),s$t.toArray(o[1]),a$t.toArray(o[2]))}f$t(o,e.get("minTurnAngle")),n.setShape({points:o})}}}var d$t=[],p$t=new DCt;function f$t(t,e){if(e<=180&&e>0){e=e/180*Math.PI,a$t.fromArray(t[0]),s$t.fromArray(t[1]),l$t.fromArray(t[2]),DCt.sub(u$t,a$t,s$t),DCt.sub(c$t,l$t,s$t);var n=u$t.len(),i=c$t.len();if(!(n<.001||i<.001)){u$t.scale(1/n),c$t.scale(1/i);var r=u$t.dot(c$t);if(Math.cos(e)<r){var o=e$t(s$t.x,s$t.y,l$t.x,l$t.y,a$t.x,a$t.y,d$t,!1);p$t.fromArray(d$t),p$t.scaleAndAdd(c$t,o/Math.tan(Math.PI-e));var a=l$t.x!==s$t.x?(p$t.x-s$t.x)/(l$t.x-s$t.x):(p$t.y-s$t.y)/(l$t.y-s$t.y);if(isNaN(a))return;a<0?DCt.copy(p$t,s$t):a>1&&DCt.copy(p$t,l$t),p$t.toArray(t[1])}}}}function g$t(t,e,n){if(n<=180&&n>0){n=n/180*Math.PI,a$t.fromArray(t[0]),s$t.fromArray(t[1]),l$t.fromArray(t[2]),DCt.sub(u$t,s$t,a$t),DCt.sub(c$t,l$t,s$t);var i=u$t.len(),r=c$t.len();if(!(i<.001||r<.001))if(u$t.scale(1/i),c$t.scale(1/r),u$t.dot(e)<Math.cos(n)){var o=e$t(s$t.x,s$t.y,l$t.x,l$t.y,a$t.x,a$t.y,d$t,!1);p$t.fromArray(d$t);var a=Math.PI/2,s=a+Math.acos(c$t.dot(e))-n;if(s>=a)DCt.copy(p$t,l$t);else{p$t.scaleAndAdd(c$t,o/Math.tan(Math.PI/2-s));var l=l$t.x!==s$t.x?(p$t.x-s$t.x)/(l$t.x-s$t.x):(p$t.y-s$t.y)/(l$t.y-s$t.y);if(isNaN(l))return;l<0?DCt.copy(p$t,s$t):l>1&&DCt.copy(p$t,l$t)}p$t.toArray(t[1])}}}function m$t(t,e,n,i){var r="normal"===n,o=r?t:t.ensureState(n);o.ignore=e;var a=i.get("smooth");a&&!0===a&&(a=.3),o.shape=o.shape||{},a>0&&(o.shape.smooth=a);var s=i.getModel("lineStyle").getLineStyle();r?t.useStyle(s):o.style=s}function y$t(t,e){var n=e.smooth,i=e.points;if(i)if(t.moveTo(i[0][0],i[0][1]),n>0&&i.length>=3){var r=dkt(i[0],i[1]),o=dkt(i[1],i[2]);if(!r||!o)return t.lineTo(i[1][0],i[1][1]),void t.lineTo(i[2][0],i[2][1]);var a=Math.min(r,o)*n,s=fkt([],i[1],i[0],a/r),l=fkt([],i[1],i[2],a/o),u=fkt([],s,l,.5);t.bezierCurveTo(s[0],s[1],s[0],s[1],u[0],u[1]),t.bezierCurveTo(l[0],l[1],l[0],l[1],i[2][0],i[2][1])}else for(var c=1;c<i.length;c++)t.lineTo(i[c][0],i[c][1])}function v$t(t,e,n){var i=t.getTextGuideLine(),r=t.getTextContent();if(r){for(var o=e.normal,a=o.get("show"),s=r.ignore,l=0;l<NDt.length;l++){var u=NDt[l],c=e[u],h="normal"===u;if(c){var d=c.get("show");if((h?s:W_t(r.states[u]&&r.states[u].ignore,s))||!W_t(d,a)){var p=h?i:i&&i.states.normal;p&&(p.ignore=!0);continue}i||(i=new lEt,t.setTextGuideLine(i),h||!s&&a||m$t(i,!0,"normal",e.normal),t.stateProxy&&(i.stateProxy=t.stateProxy)),m$t(i,!1,u,c)}}if(i){x_t(i.style,n),i.style.fill=null;var f=o.get("showAbove");(t.textGuideLineConfig=t.textGuideLineConfig||{}).showAbove=f||!1,i.buildPath=y$t}}else i&&t.removeTextGuideLine()}function x$t(t,e){e=e||"labelLine";for(var n={normal:t.getModel(e)},i=0;i<EDt.length;i++){var r=EDt[i];n[r]=t.getModel([r,e])}return n}function b$t(t,e,n,i,r,o){var a=t.length;if(!(a<2)){t.sort((function(t,n){return t.rect[e]-n.rect[e]}));for(var s,l=0,u=!1,c=0,h=0;h<a;h++){var d=t[h],p=d.rect;(s=p[e]-l)<0&&(p[e]-=s,d.label[e]-=s,u=!0),c+=Math.max(-s,0),l=p[e]+p[n]}c>0&&o&&b(-c/a,0,a);var f,g,m=t[0],y=t[a-1];return v(),f<0&&w(-f,.8),g<0&&w(g,.8),v(),x(f,g,1),x(g,f,-1),v(),f<0&&_(-f),g<0&&_(g),u}function v(){f=m.rect[e]-i,g=r-y.rect[e]-y.rect[n]}function x(t,e,n){if(t<0){var i=Math.min(e,-t);if(i>0){b(i*n,0,a);var r=i+t;r<0&&w(-r*n,1)}else w(-t*n,1)}}function b(n,i,r){0!==n&&(u=!0);for(var o=i;o<r;o++){var a=t[o];a.rect[e]+=n,a.label[e]+=n}}function w(i,r){for(var o=[],s=0,l=1;l<a;l++){var u=t[l-1].rect,c=Math.max(t[l].rect[e]-u[e]-u[n],0);o.push(c),s+=c}if(s){var h=Math.min(Math.abs(i)/s,r);if(i>0)for(l=0;l<a-1;l++){b(o[l]*h,0,l+1)}else for(l=a-1;l>0;l--){b(-(o[l-1]*h),l,a)}}}function _(t){var e=t<0?-1:1;t=Math.abs(t);for(var n=Math.ceil(t/(a-1)),i=0;i<a-1;i++)if(e>0?b(n,0,i+1):b(-n,a-i-1,a),(t-=n)<=0)return}}function w$t(t,e,n,i){return b$t(t,"y","height",e,n,i)}function _$t(t){if(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].slice());return e}}function k$t(t,e){var n=t.label,i=e&&e.getTextGuideLine();return{dataIndex:t.dataIndex,dataType:t.dataType,seriesIndex:t.seriesModel.seriesIndex,text:t.label.style.text,rect:t.hostRect,labelRect:t.rect,align:n.style.align,verticalAlign:n.style.verticalAlign,labelLinePoints:_$t(i&&i.shape.points)}}var S$t=["align","verticalAlign","width","height","fontSize"],C$t=new MCt,A$t=jAt(),I$t=jAt();function M$t(t,e,n){for(var i=0;i<n.length;i++){var r=n[i];null!=e[r]&&(t[r]=e[r])}}var D$t=["x","y","rotation"],T$t=function(){function t(){this._labelList=[],this._chartViewList=[]}return t.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},t.prototype._addLabel=function(t,e,n,i,r){var o=i.style,a=i.__hostTarget.textConfig||{},s=i.getComputedTransform(),l=i.getBoundingRect().plain();PCt.applyTransform(l,l,s),s?C$t.setLocalTransform(s):(C$t.x=C$t.y=C$t.rotation=C$t.originX=C$t.originY=0,C$t.scaleX=C$t.scaleY=1);var u,c=i.__hostTarget;if(c){u=c.getBoundingRect().plain();var h=c.getComputedTransform();PCt.applyTransform(u,u,h)}var d=u&&c.getTextGuideLine();this._labelList.push({label:i,labelLine:d,seriesModel:n,dataIndex:t,dataType:e,layoutOption:r,computedLayoutOption:null,rect:l,hostRect:u,priority:u?u.width*u.height:0,defaultAttr:{ignore:i.ignore,labelGuideIgnore:d&&d.ignore,x:C$t.x,y:C$t.y,scaleX:C$t.scaleX,scaleY:C$t.scaleY,rotation:C$t.rotation,style:{x:o.x,y:o.y,align:o.align,verticalAlign:o.verticalAlign,width:o.width,height:o.height,fontSize:o.fontSize},cursor:i.cursor,attachedPos:a.position,attachedRot:a.rotation}})},t.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var n=t.__model,i=n.get("labelLayout");(N_t(i)||M_t(i).length)&&t.group.traverse((function(t){if(t.ignore)return!0;var r=t.getTextContent(),o=IDt(t);r&&!r.disableLabelLayout&&e._addLabel(o.dataIndex,o.dataType,n,r,i)}))},t.prototype.updateLayoutConfig=function(t){var e=t.getWidth(),n=t.getHeight();function i(t,e){return function(){h$t(t,e)}}for(var r=0;r<this._labelList.length;r++){var o=this._labelList[r],a=o.label,s=a.__hostTarget,l=o.defaultAttr,u=void 0;u=(u="function"==typeof o.layoutOption?o.layoutOption(k$t(o,s)):o.layoutOption)||{},o.computedLayoutOption=u;var c=Math.PI/180;s&&s.setTextConfig({local:!1,position:null!=u.x||null!=u.y?null:l.attachedPos,rotation:null!=u.rotate?u.rotate*c:l.attachedRot,offset:[u.dx||0,u.dy||0]});var h=!1;if(null!=u.x?(a.x=dAt(u.x,e),a.setStyle("x",0),h=!0):(a.x=l.x,a.setStyle("x",l.style.x)),null!=u.y?(a.y=dAt(u.y,n),a.setStyle("y",0),h=!0):(a.y=l.y,a.setStyle("y",l.style.y)),u.labelLinePoints){var d=s.getTextGuideLine();d&&(d.setShape({points:u.labelLinePoints}),h=!1)}A$t(a).needsUpdateLabelLine=h,a.rotation=null!=u.rotate?u.rotate*c:l.rotation,a.scaleX=l.scaleX,a.scaleY=l.scaleY;for(var p=0;p<S$t.length;p++){var f=S$t[p];a.setStyle(f,null!=u[f]?u[f]:l.style[f])}if(u.draggable){if(a.draggable=!0,a.cursor="move",s){var g=o.seriesModel;if(null!=o.dataIndex)g=o.seriesModel.getData(o.dataType).getItemModel(o.dataIndex);a.on("drag",i(s,g.getModel("labelLine")))}}else a.off("drag"),a.cursor=l.cursor}},t.prototype.layout=function(t){var e,n=t.getWidth(),i=t.getHeight(),r=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];if(!i.defaultAttr.ignore){var r=i.label,o=r.getComputedTransform(),a=r.getBoundingRect(),s=!o||o[1]<1e-5&&o[2]<1e-5,l=r.style.margin||0,u=a.clone();u.applyTransform(o),u.x-=l/2,u.y-=l/2,u.width+=l,u.height+=l;var c=s?new AEt(a,o):null;e.push({label:r,labelLine:i.labelLine,rect:u,localRect:a,obb:c,priority:i.priority,defaultAttr:i.defaultAttr,layoutOption:i.computedLayoutOption,axisAligned:s,transform:o})}}return e}(this._labelList),o=I_t(r,(function(t){return"shiftX"===t.layoutOption.moveOverlap})),a=I_t(r,(function(t){return"shiftY"===t.layoutOption.moveOverlap}));b$t(o,"x","width",0,n,e),w$t(a,0,i),function(t){var e=[];t.sort((function(t,e){return e.priority-t.priority}));var n=new PCt(0,0,0,0);function i(t){if(!t.ignore){var e=t.ensureState("emphasis");null==e.ignore&&(e.ignore=!1)}t.ignore=!0}for(var r=0;r<t.length;r++){var o=t[r],a=o.axisAligned,s=o.localRect,l=o.transform,u=o.label,c=o.labelLine;n.copy(o.rect),n.width-=.1,n.height-=.1,n.x+=.05,n.y+=.05;for(var h=o.obb,d=!1,p=0;p<e.length;p++){var f=e[p];if(n.intersect(f.rect)){if(a&&f.axisAligned){d=!0;break}if(f.obb||(f.obb=new AEt(f.localRect,f.transform)),h||(h=new AEt(s,l)),h.intersect(f.obb)){d=!0;break}}}d?(i(u),c&&i(c)):(u.attr("ignore",o.defaultAttr.ignore),c&&c.attr("ignore",o.defaultAttr.labelGuideIgnore),e.push(o))}}(I_t(r,(function(t){return t.layoutOption.hideOverlap})))},t.prototype.processLabelsOverall=function(){var t=this;S_t(this._chartViewList,(function(e){var n=e.__model,i=e.ignoreLabelLineUpdate,r=n.isAnimationEnabled();e.group.traverse((function(e){if(e.ignore)return!0;var o=!i,a=e.getTextContent();!o&&a&&(o=A$t(a).needsUpdateLabelLine),o&&t._updateLabelLine(e,n),r&&t._animateLabels(e,n)}))}))},t.prototype._updateLabelLine=function(t,e){var n=t.getTextContent(),i=IDt(t),r=i.dataIndex;if(n&&null!=r){var o=e.getData(i.dataType),a=o.getItemModel(r),s={},l=o.getItemVisual(r,"style"),u=o.getVisual("drawType");s.stroke=l[u];var c=a.getModel("labelLine");v$t(t,x$t(a),s),h$t(t,c)}},t.prototype._animateLabels=function(t,e){var n=t.getTextContent(),i=t.getTextGuideLine();if(n&&!n.ignore&&!n.invisible&&!t.disableLabelAnimation&&!qEt(t)){var r=(p=A$t(n)).oldLayout,o=IDt(t),a=o.dataIndex,s={x:n.x,y:n.y,rotation:n.rotation},l=e.getData(o.dataType);if(r){n.attr(r);var u=t.prevStates;u&&(w_t(u,"select")>=0&&n.attr(p.oldLayoutSelect),w_t(u,"emphasis")>=0&&n.attr(p.oldLayoutEmphasis)),WEt(n,s,e,a)}else if(n.attr(s),!vNt(n).valueAnimation){var c=W_t(n.style.opacity,1);n.style.opacity=0,jEt(n,{style:{opacity:c}},e,a)}if(p.oldLayout=s,n.states.select){var h=p.oldLayoutSelect={};M$t(h,s,D$t),M$t(h,n.states.select,D$t)}if(n.states.emphasis){var d=p.oldLayoutEmphasis={};M$t(d,s,D$t),M$t(d,n.states.emphasis,D$t)}bNt(n,a,l,e,e)}if(i&&!i.ignore&&!i.invisible){r=(p=I$t(i)).oldLayout;var p,f={points:i.shape.points};r?(i.attr({shape:r}),WEt(i,{shape:f},e)):(i.setShape(f),i.style.strokePercent=0,jEt(i,{style:{strokePercent:1}},e)),p.oldLayout=f}},t}();function E$t(t,e){function n(e,n){var i=[];return e.eachComponent({mainType:"series",subType:t,query:n},(function(t){i.push(t.seriesIndex)})),i}S_t([[t+"ToggleSelect","toggleSelect"],[t+"Select","select"],[t+"UnSelect","unselect"]],(function(t){e(t[0],(function(e,i,r){e=v_t({},e),r.dispatchAction(v_t(e,{type:t[1],seriesIndex:n(i,e)}))}))}))}function N$t(t,e,n,i,r){var o=t+e;n.isSilent(o)||i.eachComponent({mainType:"series",subType:"pie"},(function(t){for(var e=t.seriesIndex,i=r.selected,a=0;a<i.length;a++)if(i[a].seriesIndex===e){var s=t.getData(),l=WAt(s,r.fromActionPayload);n.trigger(o,{type:o,seriesId:t.id,name:E_t(l)?s.getName(l[0]):s.getName(l),selected:v_t({},t.option.selectedMap)})}}))}function O$t(t,e,n){for(var i;t&&(!e(t)||(i=t,!n));)t=t.__hostTarget||t.parent;return i}var F$t=Math.round(9*Math.random()),R$t=function(){function t(){this._id="__ec_inner_"+F$t++}return t.prototype.get=function(t){return this._guard(t)[this._id]},t.prototype.set=function(t,e){var n=this._guard(t);return"function"==typeof Object.defineProperty?Object.defineProperty(n,this._id,{value:e,enumerable:!1,configurable:!0}):n[this._id]=e,this},t.prototype.delete=function(t){return!!this.has(t)&&(delete this._guard(t)[this._id],!0)},t.prototype.has=function(t){return!!this._guard(t)[this._id]},t.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},t}(),L$t=rDt.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var n=e.cx,i=e.cy,r=e.width/2,o=e.height/2;t.moveTo(n,i-o),t.lineTo(n+r,i+o),t.lineTo(n-r,i+o),t.closePath()}}),$$t=rDt.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var n=e.cx,i=e.cy,r=e.width/2,o=e.height/2;t.moveTo(n,i-o),t.lineTo(n+r,i),t.lineTo(n,i+o),t.lineTo(n-r,i),t.closePath()}}),P$t=rDt.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var n=e.x,i=e.y,r=e.width/5*3,o=Math.max(r,e.height),a=r/2,s=a*a/(o-a),l=i-o+a+s,u=Math.asin(s/a),c=Math.cos(u)*a,h=Math.sin(u),d=Math.cos(u),p=.6*a,f=.7*a;t.moveTo(n-c,l+s),t.arc(n,l,a,Math.PI-u,2*Math.PI+u),t.bezierCurveTo(n+c-h*p,l+s+d*p,n,i-f,n,i),t.bezierCurveTo(n,i-f,n-c+h*p,l+s+d*p,n-c,l+s),t.closePath()}}),z$t=rDt.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var n=e.height,i=e.width,r=e.x,o=e.y,a=i/3*2;t.moveTo(r,o),t.lineTo(r+a,o+n),t.lineTo(r,o+n/4*3),t.lineTo(r-a,o+n),t.lineTo(r,o),t.closePath()}}),B$t={line:function(t,e,n,i,r){r.x1=t,r.y1=e+i/2,r.x2=t+n,r.y2=e+i/2},rect:function(t,e,n,i,r){r.x=t,r.y=e,r.width=n,r.height=i},roundRect:function(t,e,n,i,r){r.x=t,r.y=e,r.width=n,r.height=i,r.r=Math.min(n,i)/4},square:function(t,e,n,i,r){var o=Math.min(n,i);r.x=t,r.y=e,r.width=o,r.height=o},circle:function(t,e,n,i,r){r.cx=t+n/2,r.cy=e+i/2,r.r=Math.min(n,i)/2},diamond:function(t,e,n,i,r){r.cx=t+n/2,r.cy=e+i/2,r.width=n,r.height=i},pin:function(t,e,n,i,r){r.x=t+n/2,r.y=e+i/2,r.width=n,r.height=i},arrow:function(t,e,n,i,r){r.x=t+n/2,r.y=e+i/2,r.width=n,r.height=i},triangle:function(t,e,n,i,r){r.cx=t+n/2,r.cy=e+i/2,r.width=n,r.height=i}},V$t={};S_t({line:hEt,rect:mDt,roundRect:mDt,square:mDt,circle:$Tt,diamond:$$t,pin:P$t,arrow:z$t,triangle:L$t},(function(t,e){V$t[e]=new t}));var W$t=rDt.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(t,e,n){var i=YCt(t,e,n),r=this.shape;return r&&"pin"===r.symbolType&&"inside"===e.position&&(i.y=n.y+.4*n.height),i},buildPath:function(t,e,n){var i=e.symbolType;if("none"!==i){var r=V$t[i];r||(r=V$t[i="rect"]),B$t[i](e.x,e.y,e.width,e.height,r.shape),r.buildPath(t,r.shape,n)}}});function j$t(t,e){if("image"!==this.type){var n=this.style;this.__isEmptyBrush?(n.stroke=t,n.fill=e||"#fff",n.lineWidth=2):"line"===this.shape.symbolType?n.stroke=t:n.fill=t,this.markRedraw()}}function U$t(t,e,n,i,r,o,a){var s,l=0===t.indexOf("empty");return l&&(t=t.substr(5,1).toLowerCase()+t.substr(6)),(s=0===t.indexOf("image://")?LEt(t.slice(8),new PCt(e,n,i,r),a?"center":"cover"):0===t.indexOf("path://")?REt(t.slice(7),{},new PCt(e,n,i,r),a?"center":"cover"):new W$t({shape:{symbolType:t,x:e,y:n,width:i,height:r}})).__isEmptyBrush=l,s.setColor=j$t,o&&s.setColor(o),s}function G$t(t,e,n){for(var i="radial"===e.type?function(t,e,n){var i=n.width,r=n.height,o=Math.min(i,r),a=null==e.x?.5:e.x,s=null==e.y?.5:e.y,l=null==e.r?.5:e.r;return e.global||(a=a*i+n.x,s=s*r+n.y,l*=o),t.createRadialGradient(a,s,0,a,s,l)}(t,e,n):function(t,e,n){var i=null==e.x?0:e.x,r=null==e.x2?1:e.x2,o=null==e.y?0:e.y,a=null==e.y2?0:e.y2;return e.global||(i=i*n.width+n.x,r=r*n.width+n.x,o=o*n.height+n.y,a=a*n.height+n.y),i=isNaN(i)?0:i,r=isNaN(r)?1:r,o=isNaN(o)?0:o,a=isNaN(a)?0:a,t.createLinearGradient(i,o,r,a)}(t,e,n),r=e.colorStops,o=0;o<r.length;o++)i.addColorStop(r[o].offset,r[o].color);return i}function H$t(t,e){if(t===e||!t&&!e)return!1;if(!t||!e||t.length!==e.length)return!0;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}function q$t(t,e){return t&&"solid"!==t&&e>0?(e=e||1,"dashed"===t?[4*e,2*e]:"dotted"===t?[e]:R_t(t)?[t]:E_t(t)?t:null):null}var X$t=new PMt(!0);function Y$t(t){var e=t.stroke;return!(null==e||"none"===e||!(t.lineWidth>0))}function K$t(t){var e=t.fill;return null!=e&&"none"!==e}function Z$t(t,e){if(null!=e.fillOpacity&&1!==e.fillOpacity){var n=t.globalAlpha;t.globalAlpha=e.fillOpacity*e.opacity,t.fill(),t.globalAlpha=n}else t.fill()}function J$t(t,e){if(null!=e.strokeOpacity&&1!==e.strokeOpacity){var n=t.globalAlpha;t.globalAlpha=e.strokeOpacity*e.opacity,t.stroke(),t.globalAlpha=n}else t.stroke()}function Q$t(t,e,n){var i=pIt(e.image,e.__image,n);if(gIt(i)){var r=t.createPattern(i,e.repeat||"repeat");if("function"==typeof DOMMatrix&&r.setTransform){var o=new DOMMatrix;o.rotateSelf(0,0,(e.rotation||0)/Math.PI*180),o.scaleSelf(e.scaleX||1,e.scaleY||1),o.translateSelf(e.x||0,e.y||0),r.setTransform(o)}return r}}var tPt=["shadowBlur","shadowOffsetX","shadowOffsetY"],ePt=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function nPt(t,e,n,i,r){var o=!1;if(!i&&e===(n=n||{}))return!1;if(i||e.opacity!==n.opacity){o||(oPt(t,r),o=!0);var a=Math.max(Math.min(e.opacity,1),0);t.globalAlpha=isNaN(a)?DIt.opacity:a}(i||e.blend!==n.blend)&&(o||(oPt(t,r),o=!0),t.globalCompositeOperation=e.blend||DIt.blend);for(var s=0;s<tPt.length;s++){var l=tPt[s];(i||e[l]!==n[l])&&(o||(oPt(t,r),o=!0),t[l]=t.dpr*(e[l]||0))}return(i||e.shadowColor!==n.shadowColor)&&(o||(oPt(t,r),o=!0),t.shadowColor=e.shadowColor||DIt.shadowColor),o}function iPt(t,e,n,i,r){var o=aPt(e,r.inHover),a=i?null:n&&aPt(n,r.inHover)||{};if(o===a)return!1;var s=nPt(t,o,a,i,r);if((i||o.fill!==a.fill)&&(s||(oPt(t,r),s=!0),t.fillStyle=o.fill),(i||o.stroke!==a.stroke)&&(s||(oPt(t,r),s=!0),t.strokeStyle=o.stroke),(i||o.opacity!==a.opacity)&&(s||(oPt(t,r),s=!0),t.globalAlpha=null==o.opacity?1:o.opacity),e.hasStroke()){var l=o.lineWidth/(o.strokeNoScale&&e&&e.getLineScale?e.getLineScale():1);t.lineWidth!==l&&(s||(oPt(t,r),s=!0),t.lineWidth=l)}for(var u=0;u<ePt.length;u++){var c=ePt[u],h=c[0];(i||o[h]!==a[h])&&(s||(oPt(t,r),s=!0),t[h]=o[h]||c[1])}return s}function rPt(t,e){var n=e.transform,i=t.dpr||1;n?t.setTransform(i*n[0],i*n[1],i*n[2],i*n[3],i*n[4],i*n[5]):t.setTransform(i,0,0,i,0,0)}function oPt(t,e){e.batchFill&&t.fill(),e.batchStroke&&t.stroke(),e.batchFill="",e.batchStroke=""}function aPt(t,e){return e&&t.__hoverStyle||t.style}function sPt(t,e){lPt(t,e,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function lPt(t,e,n,i){var r=e.transform;if(!e.shouldBePainted(n.viewWidth,n.viewHeight,!1,!1))return e.__dirty&=-2,void(e.__isRendered=!1);var o=e.__clipPaths,a=n.prevElClipPaths,s=!1,l=!1;if(a&&!H$t(o,a)||(a&&a.length&&(oPt(t,n),t.restore(),l=s=!0,n.prevElClipPaths=null,n.allClipped=!1,n.prevEl=null),o&&o.length&&(oPt(t,n),t.save(),function(t,e,n){for(var i=!1,r=0;r<t.length;r++){var o=t[r];i=i||o.isZeroArea(),rPt(e,o),e.beginPath(),o.buildPath(e,o.shape),e.clip()}n.allClipped=i}(o,t,n),s=!0),n.prevElClipPaths=o),n.allClipped)e.__isRendered=!1;else{e.beforeBrush&&e.beforeBrush(),e.innerBeforeBrush();var u=n.prevEl;u||(l=s=!0);var c,h,d=e instanceof rDt&&e.autoBatch&&function(t){var e=K$t(t),n=Y$t(t);return!(t.lineDash||!(+e^+n)||e&&"string"!=typeof t.fill||n&&"string"!=typeof t.stroke||t.strokePercent<1||t.strokeOpacity<1||t.fillOpacity<1)}(e.style);s||(c=r,h=u.transform,c&&h?c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||c[4]!==h[4]||c[5]!==h[5]:c||h)?(oPt(t,n),rPt(t,e)):d||oPt(t,n);var p=aPt(e,n.inHover);e instanceof rDt?(1!==n.lastDrawType&&(l=!0,n.lastDrawType=1),iPt(t,e,u,l,n),d&&(n.batchFill||n.batchStroke)||t.beginPath(),function(t,e,n,i){var r=Y$t(n),o=K$t(n),a=n.strokePercent,s=a<1,l=!e.path;e.silent&&!s||!l||e.createPathProxy();var u=e.path||X$t;if(!i){var c=n.fill,h=n.stroke,d=o&&!!c.colorStops,p=r&&!!h.colorStops,f=o&&!!c.image,g=r&&!!h.image,m=void 0,y=void 0,v=void 0,x=void 0,b=void 0;(d||p)&&(b=e.getBoundingRect()),d&&(m=e.__dirty?G$t(t,c,b):e.__canvasFillGradient,e.__canvasFillGradient=m),p&&(y=e.__dirty?G$t(t,h,b):e.__canvasStrokeGradient,e.__canvasStrokeGradient=y),f&&(v=e.__dirty||!e.__canvasFillPattern?Q$t(t,c,e):e.__canvasFillPattern,e.__canvasFillPattern=v),g&&(x=e.__dirty||!e.__canvasStrokePattern?Q$t(t,h,e):e.__canvasStrokePattern,e.__canvasStrokePattern=v),d?t.fillStyle=m:f&&(v?t.fillStyle=v:o=!1),p?t.strokeStyle=y:g&&(x?t.strokeStyle=x:r=!1)}var w=n.lineDash&&n.lineWidth>0&&q$t(n.lineDash,n.lineWidth),_=n.lineDashOffset,k=!!t.setLineDash,S=e.getGlobalScale();if(u.setScale(S[0],S[1],e.segmentIgnoreThreshold),w){var C=n.strokeNoScale&&e.getLineScale?e.getLineScale():1;C&&1!==C&&(w=C_t(w,(function(t){return t/C})),_/=C)}var A=!0;(l||4&e.__dirty||w&&!k&&r)&&(u.setDPR(t.dpr),s?u.setContext(null):(u.setContext(t),A=!1),u.reset(),w&&!k&&(u.setLineDash(w),u.setLineDashOffset(_)),e.buildPath(u,e.shape,i),u.toStatic(),e.pathUpdated()),A&&u.rebuildPath(t,s?a:1),w&&k&&(t.setLineDash(w),t.lineDashOffset=_),i||(n.strokeFirst?(r&&J$t(t,n),o&&Z$t(t,n)):(o&&Z$t(t,n),r&&J$t(t,n))),w&&k&&t.setLineDash([])}(t,e,p,d),d&&(n.batchFill=p.fill||"",n.batchStroke=p.stroke||"")):e instanceof aDt?(3!==n.lastDrawType&&(l=!0,n.lastDrawType=3),iPt(t,e,u,l,n),function(t,e,n){var i=n.text;if(null!=i&&(i+=""),i){t.font=n.font||BCt,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline;var r=void 0;if(t.setLineDash){var o=n.lineDash&&n.lineWidth>0&&q$t(n.lineDash,n.lineWidth),a=n.lineDashOffset;if(o){var s=n.strokeNoScale&&e.getLineScale?e.getLineScale():1;s&&1!==s&&(o=C_t(o,(function(t){return t/s})),a/=s),t.setLineDash(o),t.lineDashOffset=a,r=!0}}n.strokeFirst?(Y$t(n)&&t.strokeText(i,n.x,n.y),K$t(n)&&t.fillText(i,n.x,n.y)):(K$t(n)&&t.fillText(i,n.x,n.y),Y$t(n)&&t.strokeText(i,n.x,n.y)),r&&t.setLineDash([])}}(t,e,p)):e instanceof uDt?(2!==n.lastDrawType&&(l=!0,n.lastDrawType=2),function(t,e,n,i,r){nPt(t,aPt(e,r.inHover),n&&aPt(n,r.inHover),i,r)}(t,e,u,l,n),function(t,e,n){var i=e.__image=pIt(n.image,e.__image,e,e.onload);if(i&&gIt(i)){var r=n.x||0,o=n.y||0,a=e.getWidth(),s=e.getHeight(),l=i.width/i.height;if(null==a&&null!=s?a=s*l:null==s&&null!=a?s=a/l:null==a&&null==s&&(a=i.width,s=i.height),n.sWidth&&n.sHeight){var u=n.sx||0,c=n.sy||0;t.drawImage(i,u,c,n.sWidth,n.sHeight,r,o,a,s)}else if(n.sx&&n.sy){var h=a-(u=n.sx),d=s-(c=n.sy);t.drawImage(i,u,c,h,d,r,o,a,s)}else t.drawImage(i,r,o,a,s)}}(t,e,p)):e instanceof MEt&&(4!==n.lastDrawType&&(l=!0,n.lastDrawType=4),function(t,e,n){var i=e.getDisplayables(),r=e.getTemporalDisplayables();t.save();var o,a,s={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:n.viewWidth,viewHeight:n.viewHeight,inHover:n.inHover};for(o=e.getCursor(),a=i.length;o<a;o++){(c=i[o]).beforeBrush&&c.beforeBrush(),c.innerBeforeBrush(),lPt(t,c,s,o===a-1),c.innerAfterBrush(),c.afterBrush&&c.afterBrush(),s.prevEl=c}for(var l=0,u=r.length;l<u;l++){var c;(c=r[l]).beforeBrush&&c.beforeBrush(),c.innerBeforeBrush(),lPt(t,c,s,l===u-1),c.innerAfterBrush(),c.afterBrush&&c.afterBrush(),s.prevEl=c}e.clearTemporalDisplayables(),e.notClear=!0,t.restore()}(t,e,n)),d&&i&&oPt(t,n),e.innerAfterBrush(),e.afterBrush&&e.afterBrush(),n.prevEl=e,e.__dirty=0,e.__isRendered=!0}}var uPt,cPt=new R$t,hPt=new uSt(100),dPt=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function pPt(t,e){if("none"===t)return null;var n=e.getDevicePixelRatio(),i=e.getZr(),r="svg"===i.painter.type;t.dirty&&cPt.delete(t);var o=cPt.get(t);if(o)return o;var a=x_t(t,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});"none"===a.backgroundColor&&(a.backgroundColor=null);var s={repeat:"repeat"};return function(t){for(var e,o=[n],s=!0,l=0;l<dPt.length;++l){var u=a[dPt[l]],c=typeof u;if(null!=u&&!E_t(u)&&"string"!==c&&"number"!==c&&"boolean"!==c){s=!1;break}o.push(u)}if(s){e=o.join(",")+(r?"-svg":"");var h=hPt.get(e);h&&(r?t.svgElement=h:t.image=h)}var d,p=gPt(a.dashArrayX),f=function(t){if(!t||"object"==typeof t&&0===t.length)return[0,0];if("number"==typeof t){var e=Math.ceil(t);return[e,e]}var n=C_t(t,(function(t){return Math.ceil(t)}));return t.length%2?n.concat(n):n}(a.dashArrayY),g=fPt(a.symbol),m=(w=p,C_t(w,(function(t){return mPt(t)}))),y=mPt(f),v=!r&&b_t(),x=r&&i.painter.createSVGElement("g"),b=function(){for(var t=1,e=0,n=m.length;e<n;++e)t=TAt(t,m[e]);var i=1;for(e=0,n=g.length;e<n;++e)i=TAt(i,g[e].length);t*=i;var r=y*m.length*g.length;return{width:Math.max(1,Math.min(t,a.maxTileWidth)),height:Math.max(1,Math.min(r,a.maxTileHeight))}}();var w;v&&(v.width=b.width*n,v.height=b.height*n,d=v.getContext("2d"));(function(){d&&(d.clearRect(0,0,v.width,v.height),a.backgroundColor&&(d.fillStyle=a.backgroundColor,d.fillRect(0,0,v.width,v.height)));for(var t=0,e=0;e<f.length;++e)t+=f[e];if(t<=0)return;var o=-y,s=0,l=0,u=0;for(;o<b.height;){if(s%2==0){for(var c=l/2%g.length,h=0,m=0,w=0;h<2*b.width;){var _=0;for(e=0;e<p[u].length;++e)_+=p[u][e];if(_<=0)break;if(m%2==0){var k=.5*(1-a.symbolSize),S=h+p[u][m]*k,C=o+f[s]*k,A=p[u][m]*a.symbolSize,I=f[s]*a.symbolSize,M=w/2%g[c].length;D(S,C,A,I,g[c][M])}h+=p[u][m],++w,++m===p[u].length&&(m=0)}++u===p.length&&(u=0)}o+=f[s],++l,++s===f.length&&(s=0)}function D(t,e,o,s,l){var u=r?1:n,c=U$t(l,t*u,e*u,o*u,s*u,a.color,a.symbolKeepAspect);r?x.appendChild(i.painter.paintOne(c)):sPt(d,c)}})(),s&&hPt.put(e,v||x);t.image=v,t.svgElement=x,t.svgWidth=b.width,t.svgHeight=b.height}(s),s.rotation=a.rotation,s.scaleX=s.scaleY=r?1:1/n,cPt.set(t,s),t.dirty=!1,s}function fPt(t){if(!t||0===t.length)return[["rect"]];if("string"==typeof t)return[[t]];for(var e=!0,n=0;n<t.length;++n)if("string"!=typeof t[n]){e=!1;break}if(e)return fPt([t]);var i=[];for(n=0;n<t.length;++n)"string"==typeof t[n]?i.push([t[n]]):i.push(t[n]);return i}function gPt(t){if(!t||0===t.length)return[[0,0]];if("number"==typeof t)return[[r=Math.ceil(t),r]];for(var e=!0,n=0;n<t.length;++n)if("number"!=typeof t[n]){e=!1;break}if(e)return gPt([t]);var i=[];for(n=0;n<t.length;++n)if("number"==typeof t[n]){var r=Math.ceil(t[n]);i.push([r,r])}else{(r=C_t(t[n],(function(t){return Math.ceil(t)}))).length%2==1?i.push(r.concat(r)):i.push(r)}return i}function mPt(t){for(var e=0,n=0;n<t.length;++n)e+=t[n];return t.length%2==1?2*e:e}function yPt(t){O_t(t)&&(t=(new DOMParser).parseFromString(t,"text/xml"));var e=t;for(9===e.nodeType&&(e=e.firstChild);"svg"!==e.nodeName.toLowerCase()||1!==e.nodeType;)e=e.nextSibling;return e}var vPt={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},xPt=M_t(vPt),bPt={"alignment-baseline":"textBaseline","stop-color":"stopColor"},wPt=M_t(bPt),_Pt=function(){function t(){this._defs={},this._root=null}return t.prototype.parse=function(t,e){e=e||{};var n=yPt(t);if(!n)throw new Error("Illegal svg");this._defsUsePending=[];var i=new oAt;this._root=i;var r=[],o=n.getAttribute("viewBox")||"",a=parseFloat(n.getAttribute("width")||e.width),s=parseFloat(n.getAttribute("height")||e.height);isNaN(a)&&(a=null),isNaN(s)&&(s=null),MPt(n,i,null,!0,!1);for(var l,u,c=n.firstChild;c;)this._parseNode(c,i,r,null,!1,!1),c=c.nextSibling;if(function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i[0].style[i[1]]=t[i[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],o){var h=NPt(o);h.length>=4&&(l={x:parseFloat(h[0]||0),y:parseFloat(h[1]||0),width:parseFloat(h[2]),height:parseFloat(h[3])})}if(l&&null!=a&&null!=s&&(u=$Pt(l,{x:0,y:0,width:a,height:s}),!e.ignoreViewBox)){var d=i;(i=new oAt).add(d),d.scaleX=d.scaleY=u.scale,d.x=u.x,d.y=u.y}return e.ignoreRootClip||null==a||null==s||i.setClipPath(new mDt({shape:{x:0,y:0,width:a,height:s}})),{root:i,width:a,height:s,viewBoxRect:l,viewBoxTransform:u,named:r}},t.prototype._parseNode=function(t,e,n,i,r,o){var a,s=t.nodeName.toLowerCase(),l=i;if("defs"===s&&(r=!0),"text"===s&&(o=!0),"defs"===s||"switch"===s)a=e;else{if(!r){var u=uPt[s];if(u&&tkt(uPt,s)){a=u.call(this,t,e);var c=t.getAttribute("name");if(c){var h={name:c,namedFrom:null,svgNodeTagLower:s,el:a};n.push(h),"g"===s&&(l=h)}else i&&n.push({name:i.name,namedFrom:i,svgNodeTagLower:s,el:a});e.add(a)}}var d=kPt[s];if(d&&tkt(kPt,s)){var p=d.call(this,t),f=t.getAttribute("id");f&&(this._defs[f]=p)}}if(a&&a.isGroup)for(var g=t.firstChild;g;)1===g.nodeType?this._parseNode(g,a,n,l,r,o):3===g.nodeType&&o&&this._parseText(g,a),g=g.nextSibling},t.prototype._parseText=function(t,e){var n=new aDt({style:{text:t.textContent},silent:!0,x:this._textX||0,y:this._textY||0});APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),function(t,e){var n=e.__selfStyle;if(n){var i=n.textBaseline,r=i;i&&"auto"!==i?"baseline"===i?r="alphabetic":"before-edge"===i||"text-before-edge"===i?r="top":"after-edge"===i||"text-after-edge"===i?r="bottom":"central"!==i&&"mathematical"!==i||(r="middle"):r="alphabetic",t.style.textBaseline=r}var o=e.__inheritedStyle;if(o){var a=o.textAlign,s=a;a&&("middle"===a&&(s="center"),t.style.textAlign=s)}}(n,e);var i=n.style,r=i.fontSize;r&&r<9&&(i.fontSize=9,n.scaleX*=r/9,n.scaleY*=r/9);var o=(i.fontSize||i.fontFamily)&&[i.fontStyle,i.fontWeight,(i.fontSize||12)+"px",i.fontFamily||"sans-serif"].join(" ");i.font=o;var a=n.getBoundingRect();return this._textX+=a.width,e.add(n),n},t.internalField=void(uPt={g:function(t,e){var n=new oAt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n},rect:function(t,e){var n=new mDt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),n.silent=!0,n},circle:function(t,e){var n=new $Tt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),n.silent=!0,n},line:function(t,e){var n=new hEt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),n.silent=!0,n},ellipse:function(t,e){var n=new zTt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),n.silent=!0,n},polygon:function(t,e){var n,i=t.getAttribute("points");i&&(n=IPt(i));var r=new aEt({shape:{points:n||[]},silent:!0});return APt(e,r),MPt(t,r,this._defsUsePending,!1,!1),r},polyline:function(t,e){var n,i=t.getAttribute("points");i&&(n=IPt(i));var r=new lEt({shape:{points:n||[]},silent:!0});return APt(e,r),MPt(t,r,this._defsUsePending,!1,!1),r},image:function(t,e){var n=new uDt;return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.setStyle({image:t.getAttribute("xlink:href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),n.silent=!0,n},text:function(t,e){var n=t.getAttribute("x")||"0",i=t.getAttribute("y")||"0",r=t.getAttribute("dx")||"0",o=t.getAttribute("dy")||"0";this._textX=parseFloat(n)+parseFloat(r),this._textY=parseFloat(i)+parseFloat(o);var a=new oAt;return APt(e,a),MPt(t,a,this._defsUsePending,!1,!0),a},tspan:function(t,e){var n=t.getAttribute("x"),i=t.getAttribute("y");null!=n&&(this._textX=parseFloat(n)),null!=i&&(this._textY=parseFloat(i));var r=t.getAttribute("dx")||"0",o=t.getAttribute("dy")||"0",a=new oAt;return APt(e,a),MPt(t,a,this._defsUsePending,!1,!0),this._textX+=parseFloat(r),this._textY+=parseFloat(o),a},path:function(t,e){var n=RTt(t.getAttribute("d")||"");return APt(e,n),MPt(t,n,this._defsUsePending,!1,!1),n.silent=!0,n}}),t}(),kPt={lineargradient:function(t){var e=parseInt(t.getAttribute("x1")||"0",10),n=parseInt(t.getAttribute("y1")||"0",10),i=parseInt(t.getAttribute("x2")||"10",10),r=parseInt(t.getAttribute("y2")||"0",10),o=new bEt(e,n,i,r);return SPt(t,o),CPt(t,o),o},radialgradient:function(t){var e=parseInt(t.getAttribute("cx")||"0",10),n=parseInt(t.getAttribute("cy")||"0",10),i=parseInt(t.getAttribute("r")||"0",10),r=new wEt(e,n,i);return SPt(t,r),CPt(t,r),r}};function SPt(t,e){"userSpaceOnUse"===t.getAttribute("gradientUnits")&&(e.global=!0)}function CPt(t,e){for(var n=t.firstChild;n;){if(1===n.nodeType&&"stop"===n.nodeName.toLocaleLowerCase()){var i=n.getAttribute("offset"),r=void 0;r=i&&i.indexOf("%")>0?parseInt(i,10)/100:i?parseFloat(i):0;var o={};LPt(n,o,o);var a=o.stopColor||n.getAttribute("stop-color")||"#000000";e.colorStops.push({offset:r,color:a})}n=n.nextSibling}}function APt(t,e){t&&t.__inheritedStyle&&(e.__inheritedStyle||(e.__inheritedStyle={}),x_t(e.__inheritedStyle,t.__inheritedStyle))}function IPt(t){for(var e=NPt(t),n=[],i=0;i<e.length;i+=2){var r=parseFloat(e[i]),o=parseFloat(e[i+1]);n.push([r,o])}return n}function MPt(t,e,n,i,r){var o=e,a=o.__inheritedStyle=o.__inheritedStyle||{},s={};1===t.nodeType&&(function(t,e){var n=t.getAttribute("transform");if(n){n=n.replace(/,/g," ");var i=[],r=null;n.replace(OPt,(function(t,e,n){return i.push(e,n),""}));for(var o=i.length-1;o>0;o-=2){var a=i[o],s=i[o-1],l=NPt(a);switch(r=r||[1,0,0,1,0,0],s){case"translate":mCt(r,r,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":vCt(r,r,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":yCt(r,r,-parseFloat(l[0])*FPt);break;case"skewX":gCt(r,[1,0,Math.tan(parseFloat(l[0])*FPt),1,0,0],r);break;case"skewY":gCt(r,[1,Math.tan(parseFloat(l[0])*FPt),0,1,0,0],r);break;case"matrix":r[0]=parseFloat(l[0]),r[1]=parseFloat(l[1]),r[2]=parseFloat(l[2]),r[3]=parseFloat(l[3]),r[4]=parseFloat(l[4]),r[5]=parseFloat(l[5])}}e.setLocalTransform(r)}}(t,e),LPt(t,a,s),i||function(t,e,n){for(var i=0;i<xPt.length;i++){var r=xPt[i];null!=(o=t.getAttribute(r))&&(e[vPt[r]]=o)}for(i=0;i<wPt.length;i++){var o;r=wPt[i];null!=(o=t.getAttribute(r))&&(n[bPt[r]]=o)}}(t,a,s)),o.style=o.style||{},null!=a.fill&&(o.style.fill=TPt(o,"fill",a.fill,n)),null!=a.stroke&&(o.style.stroke=TPt(o,"stroke",a.stroke,n)),S_t(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],(function(t){null!=a[t]&&(o.style[t]=parseFloat(a[t]))})),S_t(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],(function(t){null!=a[t]&&(o.style[t]=a[t])})),r&&(o.__selfStyle=s),a.lineDash&&(o.style.lineDash=C_t(NPt(a.lineDash),(function(t){return parseFloat(t)}))),"hidden"!==a.visibility&&"collapse"!==a.visibility||(o.invisible=!0),"none"===a.display&&(o.ignore=!0)}var DPt=/^url\(\s*#(.*?)\)/;function TPt(t,e,n,i){var r=n&&n.match(DPt);if(!r)return"none"===n&&(n=null),n;var o=q_t(r[1]);i.push([t,e,o])}var EPt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function NPt(t){return t.match(EPt)||[]}var OPt=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,FPt=Math.PI/180;var RPt=/([^\s:;]+)\s*:\s*([^:;]+)/g;function LPt(t,e,n){var i,r=t.getAttribute("style");if(r)for(RPt.lastIndex=0;null!=(i=RPt.exec(r));){var o=i[1],a=tkt(vPt,o)?vPt[o]:null;a&&(e[a]=i[2]);var s=tkt(bPt,o)?bPt[o]:null;s&&(n[s]=i[2])}}function $Pt(t,e){var n=e.width/t.width,i=e.height/t.height,r=Math.min(n,i);return{scale:r,x:-(t.x+t.width/2)*r+(e.x+e.width/2),y:-(t.y+t.height/2)*r+(e.y+e.height/2)}}function PPt(t,e){return Math.abs(t-e)<1e-8}function zPt(t,e,n){var i=0,r=t[0];if(!r)return!1;for(var o=1;o<t.length;o++){var a=t[o];i+=HMt(r[0],r[1],a[0],a[1],e,n),r=a}var s=t[0];return PPt(r[0],s[0])&&PPt(r[1],s[1])||(i+=HMt(r[0],r[1],s[0],s[1],e,n)),0!==i}var BPt=[],VPt=function(){function t(t){this.name=t}return t.prototype.getCenter=function(){},t}(),WPt=function(t){function e(e,n,i){var r=t.call(this,e)||this;if(r.type="geoJSON",r.geometries=n,i)i=[i[0],i[1]];else{var o=r.getBoundingRect();i=[o.x+o.width/2,o.y+o.height/2]}return r._center=i,r}return Dit(e,t),e.prototype.getBoundingRect=function(){var t=this._rect;if(t)return t;for(var e=Number.MAX_VALUE,n=[e,e],i=[-e,-e],r=[],o=[],a=this.geometries,s=0;s<a.length;s++){if("polygon"===a[s].type)dMt(a[s].exterior,r,o),mkt(n,n,r),ykt(i,i,o)}return 0===s&&(n[0]=n[1]=i[0]=i[1]=0),this._rect=new PCt(n[0],n[1],i[0]-n[0],i[1]-n[1])},e.prototype.contain=function(t){var e=this.getBoundingRect(),n=this.geometries;if(!e.contain(t[0],t[1]))return!1;t:for(var i=0,r=n.length;i<r;i++)if("polygon"===n[i].type){var o=n[i].exterior,a=n[i].interiors;if(zPt(o,t[0],t[1])){for(var s=0;s<(a?a.length:0);s++)if(zPt(a[s],t[0],t[1]))continue t;return!0}}return!1},e.prototype.transformTo=function(t,e,n,i){var r=this.getBoundingRect(),o=r.width/r.height;n?i||(i=n/o):n=o*i;for(var a=new PCt(t,e,n,i),s=r.calculateTransform(a),l=this.geometries,u=0;u<l.length;u++)if("polygon"===l[u].type){for(var c=l[u].exterior,h=l[u].interiors,d=0;d<c.length;d++)gkt(c[d],c[d],s);for(var p=0;p<(h?h.length:0);p++)for(d=0;d<h[p].length;d++)gkt(h[p][d],h[p][d],s)}(r=this._rect).copy(a),this._center=[r.x+r.width/2,r.y+r.height/2]},e.prototype.cloneShallow=function(t){null==t&&(t=this.name);var n=new e(t,this.geometries,this._center);return n._rect=this._rect,n.transformTo=null,n},e.prototype.getCenter=function(){return this._center},e.prototype.setCenter=function(t){this._center=t},e}(VPt),jPt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.type="geoSVG",i._elOnlyForCalculate=n,i}return Dit(e,t),e.prototype.getCenter=function(){var t=this._center;return t||(t=this._center=this._calculateCenter()),t},e.prototype._calculateCenter=function(){for(var t=this._elOnlyForCalculate,e=t.getBoundingRect(),n=[e.x+e.width/2,e.y+e.height/2],i=pCt(BPt),r=t;r&&!r.isGeoSVGGraphicRoot;)gCt(i,r.getLocalTransform(),i),r=r.parent;return xCt(i,i),gkt(n,n,i),n},e}(VPt),UPt=Z_t(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),GPt=function(){function t(t,e){this.type="geoSVG",this._usedGraphicMap=Z_t(),this._freedGraphics=[],this._mapName=t,this._parsedXML=yPt(e)}return t.prototype.load=function(){var t=this._firstGraphic;if(!t){t=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(t),this._boundingRect=this._firstGraphic.boundingRect.clone();var e=function(t){var e=[],n=Z_t();return S_t(t,(function(t){if(null==t.namedFrom){var i=new jPt(t.name,t.el);e.push(i),n.set(t.name,i)}})),{regions:e,regionsMap:n}}(t.named),n=e.regions,i=e.regionsMap;this._regions=n,this._regionsMap=i}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},t.prototype._buildGraphic=function(t){var e,n,i,r;try{H_t(null!=(n=(e=t&&(i=t,r={ignoreViewBox:!0,ignoreRootClip:!0},(new _Pt).parse(i,r))||{}).root))}catch(t){throw new Error("Invalid svg format\n"+t.message)}var o=new oAt;o.add(n),o.isGeoSVGGraphicRoot=!0;var a=e.width,s=e.height,l=e.viewBoxRect,u=this._boundingRect;if(!u){var c=void 0,h=void 0,d=void 0,p=void 0;if(null!=a?(c=0,d=a):l&&(c=l.x,d=l.width),null!=s?(h=0,p=s):l&&(h=l.y,p=l.height),null==c||null==h){var f=n.getBoundingRect();null==c&&(c=f.x,d=f.width),null==h&&(h=f.y,p=f.height)}u=this._boundingRect=new PCt(c,h,d,p)}if(l){var g=$Pt(l,u);n.scaleX=n.scaleY=g.scale,n.x=g.x,n.y=g.y}o.setClipPath(new mDt({shape:u.plain()}));var m=[];return S_t(e.named,(function(t){var e;null!=UPt.get(t.svgNodeTagLower)&&(m.push(t),(e=t.el).silent=!1,e.isGroup&&e.traverse((function(t){t.silent=!1})))})),{root:o,boundingRect:u,named:m}},t.prototype.useGraphic=function(t){var e=this._usedGraphicMap,n=e.get(t);return n||(n=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),e.set(t,n),n)},t.prototype.freeGraphic=function(t){var e=this._usedGraphicMap,n=e.get(t);n&&(e.removeKey(t),this._freedGraphics.push(n))},t}();function HPt(t,e,n){for(var i=[],r=e[0],o=e[1],a=0;a<t.length;a+=2){var s=t.charCodeAt(a)-64,l=t.charCodeAt(a+1)-64;s=s>>1^-(1&s),l=l>>1^-(1&l),r=s+=r,o=l+=o,i.push([s/n,l/n])}return i}function qPt(t,e){return C_t(I_t((t=function(t){if(!t.UTF8Encoding)return t;var e=t,n=e.UTF8Scale;null==n&&(n=1024);for(var i=e.features,r=0;r<i.length;r++){var o=i[r].geometry;if("Polygon"===o.type)for(var a=o.coordinates,s=0;s<a.length;s++)a[s]=HPt(a[s],o.encodeOffsets[s],n);else if("MultiPolygon"===o.type)for(a=o.coordinates,s=0;s<a.length;s++)for(var l=a[s],u=0;u<l.length;u++)l[u]=HPt(l[u],o.encodeOffsets[s][u],n)}return e.UTF8Encoding=!1,e}(t)).features,(function(t){return t.geometry&&t.properties&&t.geometry.coordinates.length>0})),(function(t){var n=t.properties,i=t.geometry,r=[];if("Polygon"===i.type){var o=i.coordinates;r.push({type:"polygon",exterior:o[0],interiors:o.slice(1)})}"MultiPolygon"===i.type&&S_t(o=i.coordinates,(function(t){t[0]&&r.push({type:"polygon",exterior:t[0],interiors:t.slice(1)})}));var a=new WPt(n[e||"name"],r,n.cp);return a.properties=n,a}))}for(var XPt=[126,25],YPt=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]],KPt=0;KPt<YPt.length;KPt++)for(var ZPt=0;ZPt<YPt[KPt].length;ZPt++)YPt[KPt][ZPt][0]/=10.5,YPt[KPt][ZPt][1]/=-14,YPt[KPt][ZPt][0]+=XPt[0],YPt[KPt][ZPt][1]+=XPt[1];var JPt={"南海诸岛":[32,80],"广东":[0,-10],"香港":[10,5],"澳门":[-10,10],"天津":[5,5]};var QPt={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};var tzt=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];var ezt=function(){function t(t,e,n){var i;this.type="geoJSON",this._parsedMap=Z_t(),this._mapName=t,this._specialAreas=n,this._geoJSON=O_t(i=e)?"undefined"!=typeof JSON&&JSON.parse?JSON.parse(i):new Function("return ("+i+");")():i}return t.prototype.load=function(t,e){e=e||"name";var n=this._parsedMap.get(e);if(!n){var i=this._parseToRegions(e);n=this._parsedMap.set(e,{regions:i,boundingRect:nzt(i)})}var r=Z_t(),o=[];return S_t(n.regions,(function(e){var n=e.name;t&&t.hasOwnProperty(n)&&(e=e.cloneShallow(n=t[n])),o.push(e),r.set(n,e)})),{regions:o,boundingRect:n.boundingRect||new PCt(0,0,0,0),regionsMap:r}},t.prototype._parseToRegions=function(t){var e,n=this._mapName,i=this._geoJSON;try{e=i?qPt(i,t):[]}catch(t){throw new Error("Invalid geoJson format\n"+t.message)}return function(t,e){if("china"===t){for(var n=0;n<e.length;n++)if("南海诸岛"===e[n].name)return;e.push(new WPt("南海诸岛",C_t(YPt,(function(t){return{type:"polygon",exterior:t}})),XPt))}}(n,e),S_t(e,(function(t){var e=t.name;!function(t,e){if("china"===t){var n=JPt[e.name];if(n){var i=e.getCenter();i[0]+=n[0]/10.5,i[1]+=-n[1]/14,e.setCenter(i)}}}(n,t),function(t,e){if("world"===t){var n=QPt[e.name];if(n){var i=[n[0],n[1]];e.setCenter(i)}}}(n,t),function(t,e){"china"===t&&"台湾"===e.name&&e.geometries.push({type:"polygon",exterior:tzt[0]})}(n,t);var i=this._specialAreas&&this._specialAreas[e];i&&t.transformTo(i.left,i.top,i.width,i.height)}),this),e},t.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},t}();function nzt(t){for(var e,n=0;n<t.length;n++){var i=t[n].getBoundingRect();(e=e||i.clone()).union(i)}return e}var izt=Z_t(),rzt=function(t,e,n){if(e.svg){var i=new GPt(t,e.svg);izt.set(t,i)}else{var r=e.geoJson||e.geoJSON;r&&!e.features?n=e.specialAreas:r=e;i=new ezt(t,r,n);izt.set(t,i)}},ozt=function(t){return izt.get(t)},azt=function(t,e,n){var i=izt.get(t);if(i)return i.load(e,n)},szt=H_t,lzt=S_t,uzt=N_t,czt=L_t,hzt=w_t,dzt="undefined"!=typeof window,pzt={PROCESSOR:{FILTER:1e3,SERIES_FILTER:800,STATISTIC:5e3},VISUAL:{LAYOUT:1e3,PROGRESSIVE_LAYOUT:1100,GLOBAL:2e3,CHART:3e3,POST_CHART_LAYOUT:4600,COMPONENT:4e3,BRUSH:5e3,CHART_ITEM:4500,ARIA:6e3,DECAL:7e3}},fzt=/^[a-zA-Z0-9_]+$/;function gzt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(!this.isDisposed())return yzt(this,t,e);this.id}}function mzt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return yzt(this,t,e)}}function yzt(t,e,n){return n[0]=n[0]&&n[0].toLowerCase(),bkt.prototype[e].apply(t,n)}var vzt,xzt,bzt,wzt,_zt,kzt,Szt,Czt,Azt,Izt,Mzt,Dzt,Tzt,Ezt,Nzt,Ozt,Fzt,Rzt,Lzt,$zt,Pzt,zzt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e}(bkt),Bzt=zzt.prototype;Bzt.on=mzt("on"),Bzt.off=mzt("off");var Vzt=function(t){function e(e,n,i){var r=t.call(this,new GLt)||this;r._chartsViews=[],r._chartsMap={},r._componentsViews=[],r._componentsMap={},r._pendingActions=[],i=i||{},"string"==typeof n&&(n=Zzt[n]),r._dom=e;var o=r._zr=cAt(e,{renderer:i.renderer||"canvas",devicePixelRatio:i.devicePixelRatio,width:i.width,height:i.height,useDirtyRect:null!=i.useDirtyRect&&i.useDirtyRect});r._throttledZrFlush=fLt(D_t(o.flush,o),17),(n=g_t(n))&&OFt(n,!0),r._theme=n,r._locale=function(t){if(O_t(t)){var e=LNt[t.toUpperCase()]||{};return"ZH"===t||"EN"===t?g_t(e):m_t(g_t(e),g_t(LNt.EN),!1)}return m_t(g_t(t),g_t(LNt.EN),!1)}(i.locale||PNt),r._coordSysMgr=new cFt;var a=r._api=Fzt(r);function s(t,e){return t.__prio-e.__prio}return Qkt(Kzt,s),Qkt(Hzt,s),r._scheduler=new ALt(r,a,Hzt,Kzt),r._messageCenter=new zzt,r._labelManager=new T$t,r._initEvents(),r.resize=D_t(r.resize,r),o.animation.on("frame",r._onframe,r),Izt(o,r),Mzt(o,r),X_t(r),r}return Dit(e,t),e.prototype._onframe=function(){if(!this._disposed){Pzt(this);var t=this._scheduler;if(this.__optionUpdated){var e=this.__optionUpdated.silent;this.__flagInMainProcess=!0,vzt(this),wzt.update.call(this),this._zr.flush(),this.__flagInMainProcess=!1,this.__optionUpdated=!1,Czt.call(this,e),Azt.call(this,e)}else if(t.unfinished){var n=1,i=this._model,r=this._api;t.unfinished=!1;do{var o=+new Date;t.performSeriesTasks(i),t.performDataProcessorTasks(i),kzt(this,i),t.performVisualTasks(i),Nzt(this,this._model,r,"remain"),n-=+new Date-o}while(n>0&&t.unfinished);t.unfinished||this._zr.flush()}}},e.prototype.getDom=function(){return this._dom},e.prototype.getId=function(){return this.id},e.prototype.getZr=function(){return this._zr},e.prototype.setOption=function(t,e,n){if(this._disposed)this.id;else{var i,r,o;if(czt(e)&&(n=e.lazyUpdate,i=e.silent,r=e.replaceMerge,o=e.transition,e=e.notMerge),this.__flagInMainProcess=!0,!this._model||e){var a=new dFt(this._api),s=this._theme,l=this._model=new iFt;l.scheduler=this._scheduler,l.init(null,null,null,s,this._locale,a)}this._model.setOption(t,{replaceMerge:r},qzt),Lzt(this,o),n?(this.__optionUpdated={silent:i},this.__flagInMainProcess=!1,this.getZr().wakeUp()):(vzt(this),wzt.update.call(this),this._zr.flush(),this.__optionUpdated=!1,this.__flagInMainProcess=!1,Czt.call(this,i),Azt.call(this,i))}},e.prototype.setTheme=function(){console.error("ECharts#setTheme() is DEPRECATED in ECharts 3.0")},e.prototype.getModel=function(){return this._model},e.prototype.getOption=function(){return this._model&&this._model.getOption()},e.prototype.getWidth=function(){return this._zr.getWidth()},e.prototype.getHeight=function(){return this._zr.getHeight()},e.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||dzt&&window.devicePixelRatio||1},e.prototype.getRenderedCanvas=function(t){if(t_t.canvasSupported)return t=t||{},this._zr.painter.getRenderedCanvas({backgroundColor:t.backgroundColor||this._model.get("backgroundColor"),pixelRatio:t.pixelRatio||this.getDevicePixelRatio()})},e.prototype.getSvgDataURL=function(){if(t_t.svgSupported){var t=this._zr;return S_t(t.storage.getDisplayList(),(function(t){t.stopAnimation(null,!0)})),t.painter.toDataURL()}},e.prototype.getDataURL=function(t){if(!this._disposed){var e=(t=t||{}).excludeComponents,n=this._model,i=[],r=this;lzt(e,(function(t){n.eachComponent({mainType:t},(function(t){var e=r._componentsMap[t.__viewId];e.group.ignore||(i.push(e),e.group.ignore=!0)}))}));var o="svg"===this._zr.painter.getType()?this.getSvgDataURL():this.getRenderedCanvas(t).toDataURL("image/"+(t&&t.type||"png"));return lzt(i,(function(t){t.group.ignore=!1})),o}this.id},e.prototype.getConnectedDataURL=function(t){if(this._disposed)this.id;else if(t_t.canvasSupported){var e="svg"===t.type,n=this.group,i=Math.min,r=Math.max,o=1/0;if(tBt[n]){var a=o,s=o,l=-1/0,u=-1/0,c=[],h=t&&t.pixelRatio||this.getDevicePixelRatio();S_t(Qzt,(function(o,h){if(o.group===n){var d=e?o.getZr().painter.getSvgDom().innerHTML:o.getRenderedCanvas(g_t(t)),p=o.getDom().getBoundingClientRect();a=i(p.left,a),s=i(p.top,s),l=r(p.right,l),u=r(p.bottom,u),c.push({dom:d,left:p.left,top:p.top})}}));var d=(l*=h)-(a*=h),p=(u*=h)-(s*=h),f=b_t(),g=cAt(f,{renderer:e?"svg":"canvas"});if(g.resize({width:d,height:p}),e){var m="";return lzt(c,(function(t){var e=t.left-a,n=t.top-s;m+='<g transform="translate('+e+","+n+')">'+t.dom+"</g>"})),g.painter.getSvgRoot().innerHTML=m,t.connectedBackgroundColor&&g.painter.setBackgroundColor(t.connectedBackgroundColor),g.refreshImmediately(),g.painter.toDataURL()}return t.connectedBackgroundColor&&g.add(new mDt({shape:{x:0,y:0,width:d,height:p},style:{fill:t.connectedBackgroundColor}})),lzt(c,(function(t){var e=new uDt({style:{x:t.left*h-a,y:t.top*h-s,image:t.dom}});g.add(e)})),g.refreshImmediately(),f.toDataURL("image/"+(t&&t.type||"png"))}return this.getDataURL(t)}},e.prototype.convertToPixel=function(t,e){return _zt(this,"convertToPixel",t,e)},e.prototype.convertFromPixel=function(t,e){return _zt(this,"convertFromPixel",t,e)},e.prototype.containPixel=function(t,e){var n;if(!this._disposed)return S_t(GAt(this._model,t),(function(t,i){i.indexOf("Models")>=0&&S_t(t,(function(t){var r=t.coordinateSystem;if(r&&r.containPoint)n=n||!!r.containPoint(e);else if("seriesModels"===i){var o=this._chartsMap[t.__viewId];o&&o.containPoint&&(n=n||o.containPoint(e,t))}}),this)}),this),!!n;this.id},e.prototype.getVisual=function(t,e){var n=GAt(this._model,t,{defaultMainType:"series"}),i=n.seriesModel.getData(),r=n.hasOwnProperty("dataIndexInside")?n.dataIndexInside:n.hasOwnProperty("dataIndex")?i.indexOfRawIndex(n.dataIndex):null;return null!=r?qLt(i,r,e):XLt(i,e)},e.prototype.getViewOfComponentModel=function(t){return this._componentsMap[t.__viewId]},e.prototype.getViewOfSeriesModel=function(t){return this._chartsMap[t.__viewId]},e.prototype._initEvents=function(){var t,e,n,i=this;lzt(jzt,(function(t){var e=function(e){var n,r=i.getModel(),o=e.target;if("globalout"===t?n={}:o&&O$t(o,(function(t){var e=IDt(t);if(e&&null!=e.dataIndex){var i=e.dataModel||r.getSeriesByIndex(e.seriesIndex);return n=i&&i.getDataParams(e.dataIndex,e.dataType)||{},!0}if(e.eventData)return n=v_t({},e.eventData),!0}),!0),n){var a=n.componentType,s=n.componentIndex;"markLine"!==a&&"markPoint"!==a&&"markArea"!==a||(a="series",s=n.seriesIndex);var l=a&&null!=s&&r.getComponent(a,s),u=l&&i["series"===l.mainType?"_chartsMap":"_componentsMap"][l.__viewId];n.event=e,n.type=t,i._$eventProcessor.eventInfo={targetEl:o,packedEvent:n,model:l,view:u},i.trigger(t,n)}};e.zrEventfulCallAtLast=!0,i._zr.on(t,e,i)})),lzt(Gzt,(function(t,e){i._messageCenter.on(e,(function(t){this.trigger(e,t)}),i)})),lzt(["selectchanged"],(function(t){i._messageCenter.on(t,(function(e){this.trigger(t,e)}),i)})),t=this._messageCenter,e=this,n=this._api,t.on("selectchanged",(function(t){var i=n.getModel();t.isFromClick?(N$t("map","selectchanged",e,i,t),N$t("pie","selectchanged",e,i,t)):"select"===t.fromAction?(N$t("map","selected",e,i,t),N$t("pie","selected",e,i,t)):"unselect"===t.fromAction&&(N$t("map","unselected",e,i,t),N$t("pie","unselected",e,i,t))}))},e.prototype.isDisposed=function(){return this._disposed},e.prototype.clear=function(){this._disposed?this.id:this.setOption({series:[]},!0)},e.prototype.dispose=function(){if(this._disposed)this.id;else{this._disposed=!0,KAt(this.getDom(),nBt,"");var t=this._api,e=this._model;lzt(this._componentsViews,(function(n){n.dispose(e,t)})),lzt(this._chartsViews,(function(n){n.dispose(e,t)})),this._zr.dispose(),delete Qzt[this.id]}},e.prototype.resize=function(t){if(this._disposed)this.id;else{this._zr.resize(t);var e=this._model;if(this._loadingFX&&this._loadingFX.resize(),e){var n=e.resetOption("media"),i=t&&t.silent;this.__optionUpdated&&(null==i&&(i=this.__optionUpdated.silent),n=!0,this.__optionUpdated=!1),this.__flagInMainProcess=!0,n&&vzt(this),wzt.update.call(this,{type:"resize",animation:v_t({duration:0},t&&t.animation)}),this.__flagInMainProcess=!1,Czt.call(this,i),Azt.call(this,i)}}},e.prototype.showLoading=function(t,e){if(this._disposed)this.id;else if(czt(t)&&(e=t,t=""),t=t||"default",this.hideLoading(),Jzt[t]){var n=Jzt[t](this._api,e),i=this._zr;this._loadingFX=n,i.add(n)}},e.prototype.hideLoading=function(){this._disposed?this.id:(this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null)},e.prototype.makeActionFromEvent=function(t){var e=v_t({},t);return e.type=Gzt[t.type],e},e.prototype.dispatchAction=function(t,e){if(this._disposed)this.id;else if(czt(e)||(e={silent:!!e}),Uzt[t.type]&&this._model)if(this.__flagInMainProcess)this._pendingActions.push(t);else{var n=e.silent;Szt.call(this,t,n);var i=e.flush;i?this._zr.flush():!1!==i&&t_t.browser.weChat&&this._throttledZrFlush(),Czt.call(this,n),Azt.call(this,n)}},e.prototype.updateLabelLayout=function(){var t=this._labelManager;t.updateLayoutConfig(this._api),t.layout(this._api),t.processLabelsOverall()},e.prototype.appendData=function(t){if(this._disposed)this.id;else{var e=t.seriesIndex;this.getModel().getSeriesByIndex(e).appendData(t),this._scheduler.unfinished=!0,this.getZr().wakeUp()}},e.internalField=function(){function t(t){for(var e=[],n=t.currentStates,i=0;i<n.length;i++){var r=n[i];"emphasis"!==r&&"blur"!==r&&"select"!==r&&e.push(r)}t.selected&&t.states.select&&e.push("select"),2===t.hoverState&&t.states.emphasis?e.push("emphasis"):1===t.hoverState&&t.states.blur&&e.push("blur"),t.useStates(e)}function e(t,e){t.preventAutoZ||n(e.group,t.get("z")||0,t.get("zlevel")||0,-1/0)}function n(t,e,i,r){var o=t.getTextContent(),a=t.getTextGuideLine();if(t.isGroup)for(var s=t.childrenRef(),l=0;l<s.length;l++)r=Math.max(n(s[l],e,i,r),r);else t.z=e,t.zlevel=i,r=Math.max(t.z2,r);if(o&&(o.z=e,o.zlevel=i,isFinite(r)&&(o.z2=r+2)),a){var u=t.textGuideLineConfig;a.z=e,a.zlevel=i,isFinite(r)&&(a.z2=r+(u&&u.showAbove?1:-1))}return r}function i(t,e){e.group.traverse((function(t){if(!qEt(t)){var e=t.getTextContent(),n=t.getTextGuideLine();t.stateTransition&&(t.stateTransition=null),e&&e.stateTransition&&(e.stateTransition=null),n&&n.stateTransition&&(n.stateTransition=null),t.hasState()?(t.prevStates=t.currentStates,t.clearStates()):t.prevStates&&(t.prevStates=null)}}))}function r(e,n){var i=e.getModel("stateAnimation"),r=e.isAnimationEnabled(),o=i.get("duration"),a=o>0?{duration:o,delay:i.get("delay"),easing:i.get("easing")}:null;n.group.traverse((function(e){if(e.states&&e.states.emphasis){if(qEt(e))return;if(e instanceof rDt&&function(t){var e=TDt(t);e.normalFill=t.style.fill,e.normalStroke=t.style.stroke;var n=t.states.select||{};e.selectFill=n.style&&n.style.fill||null,e.selectStroke=n.style&&n.style.stroke||null}(e),e.__dirty){var n=e.prevStates;n&&e.useStates(n)}if(r){e.stateTransition=a;var i=e.getTextContent(),o=e.getTextGuideLine();i&&(i.stateTransition=a),o&&(o.stateTransition=a)}e.__dirty&&t(e)}}))}vzt=function(t){var e=t._scheduler;e.restorePipelines(t._model),e.prepareStageTasks(),xzt(t,!0),xzt(t,!1),e.plan()},xzt=function(t,e){for(var n=t._model,i=t._scheduler,r=e?t._componentsViews:t._chartsViews,o=e?t._componentsMap:t._chartsMap,a=t._zr,s=t._api,l=0;l<r.length;l++)r[l].__alive=!1;function u(t){var l=t.__requireNewView;t.__requireNewView=!1;var u="_ec_"+t.id+"_"+t.type,c=!l&&o[u];if(!c){var h=tIt(t.type);(c=new(e?nLt.getClass(h.main,h.sub):aLt.getClass(h.sub))).init(n,s),o[u]=c,r.push(c),a.add(c.group)}t.__viewId=c.__id=u,c.__alive=!0,c.__model=t,c.group.__ecComponentInfo={mainType:t.mainType,index:t.componentIndex},!e&&i.prepareView(c,t,n,s)}e?n.eachComponent((function(t,e){"series"!==t&&u(e)})):n.eachSeries(u);for(l=0;l<r.length;){var c=r[l];c.__alive?l++:(!e&&c.renderTask.dispose(),a.remove(c.group),c.dispose(n,s),r.splice(l,1),o[c.__id]===c&&delete o[c.__id],c.__id=c.group.__ecComponentInfo=null)}},bzt=function(t,e,n,i,r){var o=t._model;if(o.setUpdatePayload(n),i){var a={};a[i+"Id"]=n[i+"Id"],a[i+"Index"]=n[i+"Index"],a[i+"Name"]=n[i+"Name"];var s={mainType:i,query:a};r&&(s.subType=r);var l,u=n.excludeSeriesId;null!=u&&(l=Z_t(),lzt(NAt(u),(function(t){var e=zAt(t,null);null!=e&&l.set(e,!0)}))),yTt(n)&&iTt(t._api),o&&o.eachComponent(s,(function(e){if(!l||null==l.get(e.id)){if(yTt(n))if(e instanceof XRt)"highlight"!==n.type||n.notBlur||function(t,e,n){var i=t.seriesIndex,r=t.getData(e.dataType),o=WAt(r,e);o=(E_t(o)?o[0]:o)||0;var a=r.getItemGraphicEl(o);if(!a)for(var s=r.count(),l=0;!a&&l<s;)a=r.getItemGraphicEl(l++);if(a){var u=IDt(a);rTt(i,u.focus,u.blurScope,n)}else{var c=t.get(["emphasis","focus"]),h=t.get(["emphasis","blurScope"]);null!=c&&rTt(i,c,h,n)}}(e,n,t._api);else{var r=aTt(e.mainType,e.componentIndex,n.name,t._api),o=r.focusSelf,a=r.dispatchers;"highlight"===n.type&&o&&!n.notBlur&&oTt(e.mainType,e.componentIndex,t._api),a&&lzt(a,(function(t){"highlight"===n.type?KDt(t):ZDt(t)}))}else mTt(n)&&e instanceof XRt&&(!function(t,e,n){if(mTt(e)){var i=e.dataType,r=WAt(t.getData(i),e);E_t(r)||(r=[r]),t["toggleSelect"===e.type?"toggleSelect":"select"===e.type?"select":"unselect"](r,i)}}(e,n,t._api),sTt(e),$zt(t));c(t["series"===i?"_chartsMap":"_componentsMap"][e.__viewId])}}),t)}else lzt([].concat(t._componentsViews).concat(t._chartsViews),c);function c(i){i&&i.__alive&&i[e]&&i[e](i.__model,o,t._api,n)}},wzt={prepareAndUpdate:function(t){vzt(this),wzt.update.call(this,t)},update:function(t){var e=this._model,n=this._api,i=this._zr,r=this._coordSysMgr,o=this._scheduler;if(e){e.setUpdatePayload(t),o.restoreData(e,t),o.performSeriesTasks(e),r.create(e,n),o.performDataProcessorTasks(e,t),kzt(this,e),r.update(e,n),Dzt(e),o.performVisualTasks(e,t),Tzt(this,e,n,t);var a=e.get("backgroundColor")||"transparent",s=e.get("darkMode");if(t_t.canvasSupported)i.setBackgroundColor(a),null!=s&&"auto"!==s&&i.setDarkMode(s);else{var l=_St(a);a=DSt(l,"rgb"),0===l[3]&&(a="transparent")}Ozt(e,n)}},updateTransform:function(t){var e=this,n=this._model,i=this._api;if(n){n.setUpdatePayload(t);var r=[];n.eachComponent((function(o,a){if("series"!==o){var s=e.getViewOfComponentModel(a);if(s&&s.__alive)if(s.updateTransform){var l=s.updateTransform(a,n,i,t);l&&l.update&&r.push(s)}else r.push(s)}}));var o=Z_t();n.eachSeries((function(r){var a=e._chartsMap[r.__viewId];if(a.updateTransform){var s=a.updateTransform(r,n,i,t);s&&s.update&&o.set(r.uid,1)}else o.set(r.uid,1)})),Dzt(n),this._scheduler.performVisualTasks(n,t,{setDirty:!0,dirtyMap:o}),Nzt(this,n,i,t,o),Ozt(n,this._api)}},updateView:function(t){var e=this._model;e&&(e.setUpdatePayload(t),aLt.markUpdateMethod(t,"updateView"),Dzt(e),this._scheduler.performVisualTasks(e,t,{setDirty:!0}),Tzt(this,this._model,this._api,t),Ozt(e,this._api))},updateVisual:function(t){var e=this,n=this._model;n&&(n.setUpdatePayload(t),n.eachSeries((function(t){t.getData().clearAllVisual()})),aLt.markUpdateMethod(t,"updateVisual"),Dzt(n),this._scheduler.performVisualTasks(n,t,{visualType:"visual",setDirty:!0}),n.eachComponent((function(i,r){if("series"!==i){var o=e.getViewOfComponentModel(r);o&&o.__alive&&o.updateVisual(r,n,e._api,t)}})),n.eachSeries((function(i){e._chartsMap[i.__viewId].updateVisual(i,n,e._api,t)})),Ozt(n,this._api))},updateLayout:function(t){wzt.update.call(this,t)}},_zt=function(t,e,n,i){if(t._disposed)t.id;else for(var r,o=t._model,a=t._coordSysMgr.getCoordinateSystems(),s=GAt(o,n),l=0;l<a.length;l++){var u=a[l];if(u[e]&&null!=(r=u[e](o,s,i)))return r}},kzt=function(t,e){var n=t._chartsMap,i=t._scheduler;e.eachSeries((function(t){i.updateStreamModes(t,n[t.__viewId])}))},Szt=function(t,e){var n=this,i=this.getModel(),r=t.type,o=t.escapeConnect,a=Uzt[r],s=a.actionInfo,l=(s.update||"update").split(":"),u=l.pop(),c=null!=l[0]&&tIt(l[0]);this.__flagInMainProcess=!0;var h=[t],d=!1;t.batch&&(d=!0,h=C_t(t.batch,(function(e){return(e=x_t(v_t({},e),t)).batch=null,e})));var p,f=[],g=mTt(t),m=yTt(t);if(lzt(h,(function(e){if((p=(p=a.action(e,n._model,n._api))||v_t({},e)).type=s.event||p.type,f.push(p),m){var i=HAt(t),r=i.queryOptionMap,o=i.mainTypeSpecified?r.keys()[0]:"series";bzt(n,u,e,o),$zt(n)}else g?(bzt(n,u,e,"series"),$zt(n)):c&&bzt(n,u,e,c.main,c.sub)})),"none"===u||m||g||c||(this.__optionUpdated?(vzt(this),wzt.update.call(this,t),this.__optionUpdated=!1):wzt[u].call(this,t)),p=d?{type:s.event||r,escapeConnect:o,batch:f}:f[0],this.__flagInMainProcess=!1,!e){var y=this._messageCenter;if(y.trigger(p.type,p),g){var v={type:"selectchanged",escapeConnect:o,selected:lTt(i),isFromClick:t.isFromClick||!1,fromAction:t.type,fromActionPayload:t};y.trigger(v.type,v)}}},Czt=function(t){for(var e=this._pendingActions;e.length;){var n=e.shift();Szt.call(this,n,t)}},Azt=function(t){!t&&this.trigger("updated")},Izt=function(t,e){t.on("rendered",(function(n){e.trigger("rendered",n),!t.animation.isFinished()||e.__optionUpdated||e._scheduler.unfinished||e._pendingActions.length||e.trigger("finished")}))},Mzt=function(t,e){t.on("mouseover",(function(t){var n=O$t(t.target,gTt);n&&(!function(t,e,n){var i=IDt(t),r=aTt(i.componentMainType,i.componentIndex,i.componentHighDownName,n),o=r.dispatchers,a=r.focusSelf;o?(a&&oTt(i.componentMainType,i.componentIndex,n),S_t(o,(function(t){return XDt(t,e)}))):(rTt(i.seriesIndex,i.focus,i.blurScope,n),"self"===i.focus&&oTt(i.componentMainType,i.componentIndex,n),XDt(t,e))}(n,t,e._api),$zt(e))})).on("mouseout",(function(t){var n=O$t(t.target,gTt);n&&(!function(t,e,n){iTt(n);var i=IDt(t),r=aTt(i.componentMainType,i.componentIndex,i.componentHighDownName,n).dispatchers;r?S_t(r,(function(t){return YDt(t,e)})):YDt(t,e)}(n,t,e._api),$zt(e))})).on("click",(function(t){var n=O$t(t.target,(function(t){return null!=IDt(t).dataIndex}),!0);if(n){var i=n.selected?"unselect":"select",r=IDt(n);e._api.dispatchAction({type:i,dataType:r.dataType,dataIndexInside:r.dataIndex,seriesIndex:r.seriesIndex,isFromClick:!0})}}))},Dzt=function(t){t.clearColorPalette(),t.eachSeries((function(t){t.clearColorPalette()}))},Tzt=function(t,e,n,i){Ezt(t,e,n,i),lzt(t._chartsViews,(function(t){t.__alive=!1})),Nzt(t,e,n,i),lzt(t._chartsViews,(function(t){t.__alive||t.remove(e,n)}))},Ezt=function(t,n,o,a,s){lzt(s||t._componentsViews,(function(t){var s=t.__model;i(s,t),t.render(s,n,o,a),e(s,t),r(s,t)}))},Nzt=function(t,n,o,a,s){var l=t._scheduler,u=t._labelManager;u.clearLabels();var c=!1;n.eachSeries((function(e){var n=t._chartsMap[e.__viewId];n.__alive=!0;var r=n.renderTask;l.updatePayload(r,a),i(e,n),s&&s.get(e.uid)&&r.dirty(),r.perform(l.getPerformArgs(r))&&(c=!0),e.__transientTransitionOpt=null,n.group.silent=!!e.get("silent"),function(t,e){var n=t.get("blendMode")||null;e.group.traverse((function(t){t.isGroup||(t.style.blend=n),t.eachPendingDisplayable&&t.eachPendingDisplayable((function(t){t.style.blend=n}))}))}(e,n),sTt(e),u.addLabelsOfSeries(n)})),l.unfinished=c||l.unfinished,u.updateLayoutConfig(o),u.layout(o),u.processLabelsOverall(),n.eachSeries((function(n){var i=t._chartsMap[n.__viewId];e(n,i),r(n,i)})),function(t,e){var n=t._zr.storage,i=0;n.traverse((function(t){t.isGroup||i++})),i>e.get("hoverLayerThreshold")&&!t_t.node&&!t_t.worker&&e.eachSeries((function(e){if(!e.preventUsingHoverLayer){var n=t._chartsMap[e.__viewId];n.__alive&&n.group.traverse((function(t){t.states.emphasis&&(t.states.emphasis.hoverLayer=!0)}))}}))}(t,n)},Ozt=function(t,e){lzt(Yzt,(function(n){n(t,e)}))},$zt=function(t){t.__needsUpdateStatus=!0,t.getZr().wakeUp()},Pzt=function(e){e.__needsUpdateStatus&&(e.getZr().storage.traverse((function(e){qEt(e)||t(e)})),e.__needsUpdateStatus=!1)},Fzt=function(t){return new(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return Dit(n,e),n.prototype.getCoordinateSystems=function(){return t._coordSysMgr.getCoordinateSystems()},n.prototype.getComponentByElement=function(e){for(;e;){var n=e.__ecComponentInfo;if(null!=n)return t._model.getComponent(n.mainType,n.index);e=e.parent}},n.prototype.enterEmphasis=function(e,n){KDt(e,n),$zt(t)},n.prototype.leaveEmphasis=function(e,n){ZDt(e,n),$zt(t)},n.prototype.enterBlur=function(e){JDt(e),$zt(t)},n.prototype.leaveBlur=function(e){QDt(e),$zt(t)},n.prototype.enterSelect=function(e){tTt(e),$zt(t)},n.prototype.leaveSelect=function(e){eTt(e),$zt(t)},n.prototype.getModel=function(){return t.getModel()},n.prototype.getViewOfComponentModel=function(e){return t.getViewOfComponentModel(e)},n.prototype.getViewOfSeriesModel=function(e){return t.getViewOfSeriesModel(e)},n}(lFt))(t)},Rzt=function(t){function e(t,e){for(var n=0;n<t.length;n++){t[n].__connectUpdateStatus=e}}lzt(Gzt,(function(n,i){t._messageCenter.on(i,(function(n){if(tBt[t.group]&&0!==t.__connectUpdateStatus){if(n&&n.escapeConnect)return;var i=t.makeActionFromEvent(n),r=[];lzt(Qzt,(function(e){e!==t&&e.group===t.group&&r.push(e)})),e(r,0),lzt(r,(function(t){1!==t.__connectUpdateStatus&&t.dispatchAction(i)})),e(r,2)}}))}))},Lzt=function(t,e){var n=t._model;S_t(NAt(e),(function(t){var e,i=t.from,r=t.to;null==r&&EAt(e);var o={includeMainTypes:["series"],enableAll:!1,enableNone:!1},a=i?GAt(n,i,o):null,s=GAt(n,r,o).seriesModel;null==s&&(e=""),a&&a.seriesModel!==s&&(e=""),null!=e&&EAt(e),s.__transientTransitionOpt={from:i?i.dimension:null,to:r.dimension,dividingMethod:t.dividingMethod}}))}}(),e}(bkt),Wzt=Vzt.prototype;Wzt.on=gzt("on"),Wzt.off=gzt("off"),Wzt.one=function(t,e,n){var i=this;this.on.call(this,t,(function n(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];e&&e.apply&&e.apply(this,r),i.off(t,n)}),n)};var jzt=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var Uzt={},Gzt={},Hzt=[],qzt=[],Xzt=[],Yzt=[],Kzt=[],Zzt={},Jzt={},Qzt={},tBt={},eBt=+new Date-0,nBt="_echarts_instance_";function iBt(t,e,n){var i=function(t){return Qzt[function(t,e){return t.getAttribute?t.getAttribute(e):t[e]}(t,nBt)]}(t);if(i)return i;var r=new Vzt(t,e,n);return r.id="ec_"+eBt++,Qzt[r.id]=r,KAt(t,nBt,r.id),Rzt(r),lzt(Xzt,(function(t){t(r)})),r}function rBt(t,e){Zzt[t]=e}function oBt(t){hzt(qzt,t)<0&&qzt.push(t)}function aBt(t,e){cBt(Hzt,t,e,2e3)}function sBt(t,e,n){"function"==typeof e&&(n=e,e="");var i=czt(t)?t.type:[t,t={event:e}][0];t.event=(t.event||i).toLowerCase(),e=t.event,Gzt[e]||(szt(fzt.test(i)&&fzt.test(e)),Uzt[i]||(Uzt[i]={action:n,actionInfo:t}),Gzt[e]=i)}function lBt(t,e){cBt(Kzt,t,e,3e3,"visual")}var uBt=[];function cBt(t,e,n,i,r){if((uzt(e)||czt(e))&&(n=e,e=i),!(hzt(uBt,n)>=0)){uBt.push(n);var o=ALt.wrapStageHandler(n,r);o.__prio=e,o.__raw=n,t.push(o)}}function hBt(t,e){Jzt[t]=e}var dBt=function(t){var e=(t=g_t(t)).type;e||EAt("");var n=e.split(":");2!==n.length&&EAt("");var i=!1;"echarts"===n[0]&&(e=n[1],i=!0),t.__isBuiltIn=i,CRt.set(e,t)};lBt(2e3,wLt),lBt(4500,kLt),lBt(4500,SLt),lBt(2e3,HLt),lBt(4500,{createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){if(t.hasSymbolVisual&&!e.isSeriesFiltered(t))return{dataEach:t.getData().hasItemOption?function(t,e){var n=t.getItemModel(e),i=n.getShallow("symbol",!0),r=n.getShallow("symbolSize",!0),o=n.getShallow("symbolRotate",!0),a=n.getShallow("symbolOffset",!0),s=n.getShallow("symbolKeepAspect",!0);null!=i&&t.setItemVisual(e,"symbol",i),null!=r&&t.setItemVisual(e,"symbolSize",r),null!=o&&t.setItemVisual(e,"symbolRotate",o),null!=a&&t.setItemVisual(e,"symbolOffset",a),null!=s&&t.setItemVisual(e,"symbolKeepAspect",s)}:null}}}),lBt(7e3,(function(t,e){t.eachRawSeries((function(n){if(!t.isSeriesFiltered(n)){var i=n.getData();i.hasItemVisual()&&i.each((function(t){var n=i.getItemVisual(t,"decal");n&&(i.ensureUniqueItemVisual(t,"style").decal=pPt(n,e))}));var r=i.getVisual("decal");if(r)i.getVisual("style").decal=pPt(r,e)}}))})),oBt(OFt),aBt(900,(function(t){var e=Z_t();t.eachSeries((function(t){var n=t.get("stack");if(n){var i=e.get(n)||e.set(n,[]),r=t.getData(),o={stackResultDimension:r.getCalculationInfo("stackResultDimension"),stackedOverDimension:r.getCalculationInfo("stackedOverDimension"),stackedDimension:r.getCalculationInfo("stackedDimension"),stackedByDimension:r.getCalculationInfo("stackedByDimension"),isStackedByIndex:r.getCalculationInfo("isStackedByIndex"),data:r,seriesModel:t};if(!o.stackedDimension||!o.isStackedByIndex&&!o.stackedByDimension)return;i.length&&r.setCalculationInfo("stackedOnSeries",i[i.length-1].seriesModel),i.push(o)}})),e.each(FFt)})),hBt("default",(function(t,e){x_t(e=e||{},{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:!0,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var n=new oAt,i=new mDt({style:{fill:e.maskColor},zlevel:e.zlevel,z:1e4});n.add(i);var r,o=new xDt({style:{text:e.text,fill:e.textColor,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:e.fontFamily},zlevel:e.zlevel,z:10001}),a=new mDt({style:{fill:"none"},textContent:o,textConfig:{position:"right",distance:10},zlevel:e.zlevel,z:10001});return n.add(a),e.showSpinner&&((r=new yEt({shape:{startAngle:-CLt/2,endAngle:-CLt/2+.1,r:e.spinnerRadius},style:{stroke:e.color,lineCap:"round",lineWidth:e.lineWidth},zlevel:e.zlevel,z:10001})).animateShape(!0).when(1e3,{endAngle:3*CLt/2}).start("circularInOut"),r.animateShape(!0).when(1e3,{startAngle:3*CLt/2}).delay(300).start("circularInOut"),n.add(r)),n.resize=function(){var n=o.getBoundingRect().width,s=e.showSpinner?e.spinnerRadius:0,l=(t.getWidth()-2*s-(e.showSpinner&&n?10:0)-n)/2-(e.showSpinner&&n?0:5+n/2)+(e.showSpinner?0:n/2)+(n?0:s),u=t.getHeight()/2;e.showSpinner&&r.setShape({cx:l,cy:u}),a.setShape({x:l-s,y:u-s,width:2*s,height:2*s}),i.setShape({x:0,y:0,width:t.getWidth(),height:t.getHeight()})},n.resize(),n})),sBt({type:"highlight",event:"highlight",update:"highlight"},ekt),sBt({type:"downplay",event:"downplay",update:"downplay"},ekt),sBt({type:"select",event:"select",update:"select"},ekt),sBt({type:"unselect",event:"unselect",update:"unselect"},ekt),sBt({type:"toggleSelect",event:"toggleSelect",update:"toggleSelect"},ekt),rBt("light",WLt),rBt("dark",ULt);var pBt=[],fBt={registerPreprocessor:oBt,registerProcessor:aBt,registerPostInit:function(t){hzt(Xzt,t)<0&&t&&Xzt.push(t)},registerPostUpdate:function(t){hzt(Yzt,t)<0&&t&&Yzt.push(t)},registerAction:sBt,registerCoordinateSystem:function(t,e){cFt.register(t,e)},registerLayout:function(t,e){cBt(Kzt,t,e,1e3,"layout")},registerVisual:lBt,registerTransform:dBt,registerLoading:hBt,registerMap:function(t,e,n){rzt(t,e,n)},PRIORITY:pzt,ComponentModel:FOt,ComponentView:nLt,SeriesModel:XRt,ChartView:aLt,registerComponentModel:function(t){FOt.registerClass(t)},registerComponentView:function(t){nLt.registerClass(t)},registerSeriesModel:function(t){XRt.registerClass(t)},registerChartView:function(t){aLt.registerClass(t)},registerSubTypeDefaulter:function(t,e){FOt.registerSubTypeDefaulter(t,e)},registerPainter:function(t,e){var n;n=e,sAt[t]=n}};function gBt(t){E_t(t)?S_t(t,(function(t){gBt(t)})):w_t(pBt,t)>=0||(pBt.push(t),N_t(t)&&(t={install:t}),t.install(fBt))}function mBt(t){return null==t?0:t.length||1}function yBt(t){return t}var vBt=function(){function t(t,e,n,i,r,o){this._old=t,this._new=e,this._oldKeyGetter=n||yBt,this._newKeyGetter=i||yBt,this.context=r,this._diffModeMultiple="multiple"===o}return t.prototype.add=function(t){return this._add=t,this},t.prototype.update=function(t){return this._update=t,this},t.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},t.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},t.prototype.remove=function(t){return this._remove=t,this},t.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},t.prototype._executeOneToOne=function(){var t=this._old,e=this._new,n={},i=new Array(t.length),r=new Array(e.length);this._initIndexMap(t,null,i,"_oldKeyGetter"),this._initIndexMap(e,n,r,"_newKeyGetter");for(var o=0;o<t.length;o++){var a=i[o],s=n[a],l=mBt(s);if(l>1){var u=s.shift();1===s.length&&(n[a]=s[0]),this._update&&this._update(u,o)}else 1===l?(n[a]=null,this._update&&this._update(s,o)):this._remove&&this._remove(o)}this._performRestAdd(r,n)},t.prototype._executeMultiple=function(){var t=this._old,e=this._new,n={},i={},r=[],o=[];this._initIndexMap(t,n,r,"_oldKeyGetter"),this._initIndexMap(e,i,o,"_newKeyGetter");for(var a=0;a<r.length;a++){var s=r[a],l=n[s],u=i[s],c=mBt(l),h=mBt(u);if(c>1&&1===h)this._updateManyToOne&&this._updateManyToOne(u,l),i[s]=null;else if(1===c&&h>1)this._updateOneToMany&&this._updateOneToMany(u,l),i[s]=null;else if(1===c&&1===h)this._update&&this._update(u,l),i[s]=null;else if(c>1)for(var d=0;d<c;d++)this._remove&&this._remove(l[d]);else this._remove&&this._remove(l)}this._performRestAdd(o,i)},t.prototype._performRestAdd=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[i],o=mBt(r);if(o>1)for(var a=0;a<o;a++)this._add&&this._add(r[a]);else 1===o&&this._add&&this._add(r);e[i]=null}},t.prototype._initIndexMap=function(t,e,n,i){for(var r=this._diffModeMultiple,o=0;o<t.length;o++){var a="_ec_"+this[i](t[o],o);if(r||(n[o]=a),e){var s=e[a],l=mBt(s);0===l?(e[a]=o,r&&n.push(a)):1===l?e[a]=[s,o]:s.push(o)}}},t}();function xBt(t,e){return t.hasOwnProperty(e)||(t[e]=[]),t[e]}function bBt(t){return"category"===t?"ordinal":"time"===t?"time":"float"}var wBt,_Bt,kBt,SBt,CBt,ABt,IBt,MBt,DBt,TBt,EBt,NBt,OBt,FBt,RBt=function(t){this.otherDims={},null!=t&&v_t(this,t)},LBt=Math.floor,$Bt=L_t,PBt=C_t,zBt={float:"undefined"==typeof Float64Array?Array:Float64Array,int:"undefined"==typeof Int32Array?Array:Int32Array,ordinal:Array,number:Array,time:Array},BBt="undefined"==typeof Uint32Array?Array:Uint32Array,VBt="undefined"==typeof Int32Array?Array:Int32Array,WBt="undefined"==typeof Uint16Array?Array:Uint16Array,jBt=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx","_nameRepeatCount"],UBt=["_extent","_approximateExtent","_rawExtent"],GBt=function(){function t(t,e){this.type="list",this._count=0,this._rawCount=0,this._storage={},this._storageArr=[],this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._rawExtent={},this._extent={},this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!0,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"],this.getRawIndex=CBt,t=t||["x","y"];for(var n={},i=[],r={},o=0;o<t.length;o++){var a=t[o],s=O_t(a)?new RBt({name:a}):a instanceof RBt?a:new RBt(a),l=s.name;s.type=s.type||"float",s.coordDim||(s.coordDim=l,s.coordDimIndex=0);var u=s.otherDims=s.otherDims||{};i.push(l),n[l]=s,s.index=o,s.createInvertedIndices&&(r[l]=[]),0===u.itemName&&(this._nameDimIdx=o,this._nameOrdinalMeta=s.ordinalMeta),0===u.itemId&&(this._idDimIdx=o,this._idOrdinalMeta=s.ordinalMeta)}this.dimensions=i,this._dimensionInfos=n,this.hostModel=e,this._dimensionsSummary=function(t){var e={},n=e.encode={},i=Z_t(),r=[],o=[],a=e.userOutput={dimensionNames:t.dimensions.slice(),encode:{}};S_t(t.dimensions,(function(e){var s,l=t.getDimensionInfo(e),u=l.coordDim;if(u){var c=l.coordDimIndex;xBt(n,u)[c]=e,l.isExtraCoord||(i.set(u,1),"ordinal"!==(s=l.type)&&"time"!==s&&(r[0]=e),xBt(a.encode,u)[c]=l.index),l.defaultTooltip&&o.push(e)}POt.each((function(t,e){var i=xBt(n,e),r=l.otherDims[e];null!=r&&!1!==r&&(i[r]=l.name)}))}));var s=[],l={};i.each((function(t,e){var i=n[e];l[e]=i[0],s=s.concat(i)})),e.dataDimsOnCoord=s,e.encodeFirstDimNotExtra=l;var u=n.label;u&&u.length&&(r=u.slice());var c=n.tooltip;return c&&c.length?o=c.slice():o.length||(o=r.slice()),n.defaultedLabel=r,n.defaultedTooltip=o,e}(this),this._invertedIndicesMap=r,this.userOutput=this._dimensionsSummary.userOutput}return t.prototype.getDimension=function(t){return"number"!=typeof t&&(isNaN(t)||this._dimensionInfos.hasOwnProperty(t))||(t=this.dimensions[t]),t},t.prototype.getDimensionInfo=function(t){return this._dimensionInfos[this.getDimension(t)]},t.prototype.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()},t.prototype.mapDimension=function(t,e){var n=this._dimensionsSummary;if(null==e)return n.encodeFirstDimNotExtra[t];var i=n.encode[t];return i?i[e]:null},t.prototype.mapDimensionsAll=function(t){return(this._dimensionsSummary.encode[t]||[]).slice()},t.prototype.initData=function(t,e,n){var i=VFt(t)||k_t(t)?new XFt(t,this.dimensions.length):t;this._rawData=i;var r=i.getSource().sourceFormat;this._storage={},this._indices=null,this._dontMakeIdFromName=null!=this._idDimIdx||"typedArray"===r||!!i.fillStorage,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},n||(this.hasItemOption=!1),this.defaultDimValueGetter=wBt[r],this._dimValueGetter=n=n||this.defaultDimValueGetter,this._dimValueGetterArrayRows=wBt.arrayRows,this._rawExtent={},this._initDataFromProvider(0,i.count()),i.pure&&(this.hasItemOption=!1)},t.prototype.getProvider=function(){return this._rawData},t.prototype.appendData=function(t){var e=this._rawData,n=this.count();e.appendData(t);var i=e.count();e.persistent||(i+=n),this._initDataFromProvider(n,i,!0)},t.prototype.appendValues=function(t,e){for(var n=this._storage,i=this.dimensions,r=i.length,o=this._rawExtent,a=this.count(),s=a+Math.max(t.length,e?e.length:0),l=0;l<r;l++){var u=i[l];o[u]||(o[u]=NBt()),SBt(n,this._dimensionInfos[u],s,!0)}for(var c=PBt(i,(function(t){return o[t]})),h=this._storageArr=PBt(i,(function(t){return n[t]})),d=[],p=a;p<s;p++){for(var f=p-a,g=0;g<r;g++){u=i[g];var m=this._dimValueGetterArrayRows(t[f]||d,u,f,g);h[g][p]=m;var y=c[g];m<y[0]&&(y[0]=m),m>y[1]&&(y[1]=m)}e&&(this._nameList[p]=e[f],this._dontMakeIdFromName||DBt(this,p))}this._rawCount=this._count=s,this._extent={},_Bt(this)},t.prototype._initDataFromProvider=function(t,e,n){if(!(t>=e)){for(var i=this._rawData,r=this._storage,o=this.dimensions,a=o.length,s=this._dimensionInfos,l=this._nameList,u=this._idList,c=this._rawExtent,h="original"===i.getSource().sourceFormat,d=0;d<a;d++){var p=o[d];c[p]||(c[p]=NBt()),SBt(r,s[p],e,n)}var f=this._storageArr=PBt(o,(function(t){return r[t]})),g=PBt(o,(function(t){return c[t]}));if(i.fillStorage)i.fillStorage(t,e,f,g);else for(var m=[],y=t;y<e;y++){m=i.getItem(y,m);for(var v=0;v<a;v++){p=o[v];var x=f[v],b=this._dimValueGetter(m,p,y,v);x[y]=b;var w=g[v];b<w[0]&&(w[0]=b),b>w[1]&&(w[1]=b)}if(h&&!i.pure&&m){var _=m.name;null==l[y]&&null!=_&&(l[y]=zAt(_,null));var k=m.id;null==u[y]&&null!=k&&(u[y]=zAt(k,null))}this._dontMakeIdFromName||DBt(this,y)}!i.persistent&&i.clean&&i.clean(),this._rawCount=this._count=e,this._extent={},_Bt(this)}},t.prototype.count=function(){return this._count},t.prototype.getIndices=function(){var t,e=this._indices;if(e){var n=e.constructor,i=this._count;if(n===Array){t=new n(i);for(var r=0;r<i;r++)t[r]=e[r]}else t=new n(e.buffer,0,i)}else{t=new(n=kBt(this))(this.count());for(r=0;r<t.length;r++)t[r]=r}return t},t.prototype.getByDimIdx=function(t,e){if(!(e>=0&&e<this._count))return NaN;var n=this._storageArr[t];return n?n[this.getRawIndex(e)]:NaN},t.prototype.get=function(t,e){if(!(e>=0&&e<this._count))return NaN;var n=this._storage[t];return n?n[this.getRawIndex(e)]:NaN},t.prototype.getByRawIndex=function(t,e){if(!(e>=0&&e<this._rawCount))return NaN;var n=this._storage[t];return n?n[e]:NaN},t.prototype.getValues=function(t,e){var n=[];E_t(t)||(e=t,t=this.dimensions);for(var i=0,r=t.length;i<r;i++)n.push(this.get(t[i],e));return n},t.prototype.hasValue=function(t){for(var e=this._dimensionsSummary.dataDimsOnCoord,n=0,i=e.length;n<i;n++)if(isNaN(this.get(e[n],t)))return!1;return!0},t.prototype.getDataExtent=function(t){t=this.getDimension(t);var e=this._storage[t],n=NBt();if(!e)return n;var i,r=this.count();if(!this._indices)return this._rawExtent[t].slice();if(i=this._extent[t])return i.slice();for(var o=(i=n)[0],a=i[1],s=0;s<r;s++){var l=e[this.getRawIndex(s)];l<o&&(o=l),l>a&&(a=l)}return i=[o,a],this._extent[t]=i,i},t.prototype.getApproximateExtent=function(t){return t=this.getDimension(t),this._approximateExtent[t]||this.getDataExtent(t)},t.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},t.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},t.prototype.setCalculationInfo=function(t,e){$Bt(t)?v_t(this._calculationInfo,t):this._calculationInfo[t]=e},t.prototype.getSum=function(t){var e=0;if(this._storage[t])for(var n=0,i=this.count();n<i;n++){var r=this.get(t,n);isNaN(r)||(e+=r)}return e},t.prototype.getMedian=function(t){var e=[];this.each(t,(function(t){isNaN(t)||e.push(t)}));var n=e.sort((function(t,e){return t-e})),i=this.count();return 0===i?0:i%2==1?n[(i-1)/2]:(n[i/2]+n[i/2-1])/2},t.prototype.rawIndexOf=function(t,e){var n=(t&&this._invertedIndicesMap[t])[e];return null==n||isNaN(n)?-1:n},t.prototype.indexOfName=function(t){for(var e=0,n=this.count();e<n;e++)if(this.getName(e)===t)return e;return-1},t.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var e=this._indices,n=e[t];if(null!=n&&n<this._count&&n===t)return t;for(var i=0,r=this._count-1;i<=r;){var o=(i+r)/2|0;if(e[o]<t)i=o+1;else{if(!(e[o]>t))return o;r=o-1}}return-1},t.prototype.indicesOfNearest=function(t,e,n){var i=this._storage[t],r=[];if(!i)return r;null==n&&(n=1/0);for(var o=1/0,a=-1,s=0,l=0,u=this.count();l<u;l++){var c=e-i[this.getRawIndex(l)],h=Math.abs(c);h<=n&&((h<o||h===o&&c>=0&&a<0)&&(o=h,a=c,s=0),c===a&&(r[s++]=l))}return r.length=s,r},t.prototype.getRawDataItem=function(t){if(this._rawData.persistent)return this._rawData.getItem(this.getRawIndex(t));for(var e=[],n=0;n<this.dimensions.length;n++){var i=this.dimensions[n];e.push(this.get(i,t))}return e},t.prototype.getName=function(t){var e=this.getRawIndex(t),n=this._nameList[e];return null==n&&null!=this._nameDimIdx&&(n=MBt(this,this._nameDimIdx,this._nameOrdinalMeta,e)),null==n&&(n=""),n},t.prototype.getId=function(t){return IBt(this,this.getRawIndex(t))},t.prototype.each=function(t,e,n,i){var r=this;if(this._count){"function"==typeof t&&(i=n,n=e,e=t,t=[]);for(var o=n||i||this,a=PBt(TBt(t),this.getDimension,this),s=a.length,l=PBt(a,(function(t){return r._dimensionInfos[t].index})),u=this._storageArr,c=0,h=this.count();c<h;c++){var d=this.getRawIndex(c);switch(s){case 0:e.call(o,c);break;case 1:e.call(o,u[l[0]][d],c);break;case 2:e.call(o,u[l[0]][d],u[l[1]][d],c);break;default:for(var p=0,f=[];p<s;p++)f[p]=u[l[p]][d];f[p]=c,e.apply(o,f)}}}},t.prototype.filterSelf=function(t,e,n,i){var r=this;if(this._count){"function"==typeof t&&(i=n,n=e,e=t,t=[]);for(var o=n||i||this,a=PBt(TBt(t),this.getDimension,this),s=this.count(),l=new(kBt(this))(s),u=[],c=a.length,h=0,d=PBt(a,(function(t){return r._dimensionInfos[t].index})),p=d[0],f=this._storageArr,g=0;g<s;g++){var m=void 0,y=this.getRawIndex(g);if(0===c)m=e.call(o,g);else if(1===c){var v=f[p][y];m=e.call(o,v,g)}else{for(var x=0;x<c;x++)u[x]=f[d[x]][y];u[x]=g,m=e.apply(o,u)}m&&(l[h++]=y)}return h<s&&(this._indices=l),this._count=h,this._extent={},this.getRawIndex=this._indices?ABt:CBt,this}},t.prototype.selectRange=function(t){var e=this,n=this._count;if(n){var i=[];for(var r in t)t.hasOwnProperty(r)&&i.push(r);var o=i.length;if(o){var a=this.count(),s=new(kBt(this))(a),l=0,u=i[0],c=PBt(i,(function(t){return e._dimensionInfos[t].index})),h=t[u][0],d=t[u][1],p=this._storageArr,f=!1;if(!this._indices){var g=0;if(1===o){for(var m=p[c[0]],y=0;y<n;y++){((w=m[y])>=h&&w<=d||isNaN(w))&&(s[l++]=g),g++}f=!0}else if(2===o){m=p[c[0]];var v=p[c[1]],x=t[i[1]][0],b=t[i[1]][1];for(y=0;y<n;y++){var w=m[y],_=v[y];(w>=h&&w<=d||isNaN(w))&&(_>=x&&_<=b||isNaN(_))&&(s[l++]=g),g++}f=!0}}if(!f)if(1===o)for(y=0;y<a;y++){var k=this.getRawIndex(y);((w=p[c[0]][k])>=h&&w<=d||isNaN(w))&&(s[l++]=k)}else for(y=0;y<a;y++){for(var S=!0,C=(k=this.getRawIndex(y),0);C<o;C++){var A=i[C];((w=p[c[C]][k])<t[A][0]||w>t[A][1])&&(S=!1)}S&&(s[l++]=this.getRawIndex(y))}return l<a&&(this._indices=s),this._count=l,this._extent={},this.getRawIndex=this._indices?ABt:CBt,this}}},t.prototype.mapArray=function(t,e,n,i){"function"==typeof t&&(i=n,n=e,e=t,t=[]),n=n||i||this;var r=[];return this.each(t,(function(){r.push(e&&e.apply(this,arguments))}),n),r},t.prototype.map=function(t,e,n,i){var r=n||i||this,o=PBt(TBt(t),this.getDimension,this),a=EBt(this,o),s=a._storage;a._indices=this._indices,a.getRawIndex=a._indices?ABt:CBt;for(var l=[],u=o.length,c=this.count(),h=[],d=a._rawExtent,p=0;p<c;p++){for(var f=0;f<u;f++)h[f]=this.get(o[f],p);h[u]=p;var g=e&&e.apply(r,h);if(null!=g){"object"!=typeof g&&(l[0]=g,g=l);for(var m=this.getRawIndex(p),y=0;y<g.length;y++){var v=o[y],x=g[y],b=d[v],w=s[v];w&&(w[m]=x),x<b[0]&&(b[0]=x),x>b[1]&&(b[1]=x)}}}return a},t.prototype.downSample=function(t,e,n,i){for(var r=EBt(this,[t]),o=r._storage,a=[],s=LBt(1/e),l=o[t],u=this.count(),c=r._rawExtent[t],h=new(kBt(this))(u),d=0,p=0;p<u;p+=s){s>u-p&&(s=u-p,a.length=s);for(var f=0;f<s;f++){var g=this.getRawIndex(p+f);a[f]=l[g]}var m=n(a),y=this.getRawIndex(Math.min(p+i(a,m)||0,u-1));l[y]=m,m<c[0]&&(c[0]=m),m>c[1]&&(c[1]=m),h[d++]=y}return r._count=d,r._indices=h,r.getRawIndex=ABt,r},t.prototype.lttbDownSample=function(t,e){var n,i,r,o=EBt(this,[]),a=o._storage[t],s=this.count(),l=new(kBt(this))(s),u=0,c=LBt(1/e),h=this.getRawIndex(0);l[u++]=h;for(var d=1;d<s-1;d+=c){for(var p=Math.min(d+c,s-1),f=Math.min(d+2*c,s),g=(f+p)/2,m=0,y=p;y<f;y++){var v=a[k=this.getRawIndex(y)];isNaN(v)||(m+=v)}m/=f-p;var x=d,b=Math.min(d+c,s),w=d-1,_=a[h];n=-1,r=x;for(y=x;y<b;y++){var k;v=a[k=this.getRawIndex(y)];isNaN(v)||(i=Math.abs((w-g)*(v-_)-(w-y)*(m-_)))>n&&(n=i,r=k)}l[u++]=r,h=r}return l[u++]=this.getRawIndex(s-1),o._count=u,o._indices=l,o.getRawIndex=ABt,o},t.prototype.getItemModel=function(t){var e=this.hostModel,n=this.getRawDataItem(t);return new NNt(n,e,e&&e.ecModel)},t.prototype.diff=function(t){var e=this;return new vBt(t?t.getIndices():[],this.getIndices(),(function(e){return IBt(t,e)}),(function(t){return IBt(e,t)}))},t.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},t.prototype.setVisual=function(t,e){this._visual=this._visual||{},$Bt(t)?v_t(this._visual,t):this._visual[t]=e},t.prototype.getItemVisual=function(t,e){var n=this._itemVisuals[t],i=n&&n[e];return null==i?this.getVisual(e):i},t.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},t.prototype.ensureUniqueItemVisual=function(t,e){var n=this._itemVisuals,i=n[t];i||(i=n[t]={});var r=i[e];return null==r&&(E_t(r=this.getVisual(e))?r=r.slice():$Bt(r)&&(r=v_t({},r)),i[e]=r),r},t.prototype.setItemVisual=function(t,e,n){var i=this._itemVisuals[t]||{};this._itemVisuals[t]=i,$Bt(e)?v_t(i,e):i[e]=n},t.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},t.prototype.setLayout=function(t,e){if($Bt(t))for(var n in t)t.hasOwnProperty(n)&&this.setLayout(n,t[n]);else this._layout[t]=e},t.prototype.getLayout=function(t){return this._layout[t]},t.prototype.getItemLayout=function(t){return this._itemLayouts[t]},t.prototype.setItemLayout=function(t,e,n){this._itemLayouts[t]=n?v_t(this._itemLayouts[t]||{},e):e},t.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},t.prototype.setItemGraphicEl=function(t,e){var n=this.hostModel;if(e){var i=IDt(e);i.dataIndex=t,i.dataType=this.dataType,i.seriesIndex=n&&n.seriesIndex,"group"===e.type&&e.traverse(OBt,e)}this._graphicEls[t]=e},t.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},t.prototype.eachItemGraphicEl=function(t,e){S_t(this._graphicEls,(function(n,i){n&&t&&t.call(e,n,i)}))},t.prototype.cloneShallow=function(e){e||(e=new t(PBt(this.dimensions,this.getDimensionInfo,this),this.hostModel));if(e._storage=this._storage,e._storageArr=this._storageArr,FBt(e,this),this._indices){var n=this._indices.constructor;if(n===Array){var i=this._indices.length;e._indices=new n(i);for(var r=0;r<i;r++)e._indices[r]=this._indices[r]}else e._indices=new n(this._indices)}else e._indices=null;return e.getRawIndex=e._indices?ABt:CBt,e},t.prototype.wrapMethod=function(t,e){var n=this[t];"function"==typeof n&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var t=n.apply(this,arguments);return e.apply(this,[t].concat(U_t(arguments)))})},t.internalField=function(){function e(t,e,n,i){return dRt(t[i],this._dimensionInfos[e])}wBt={arrayRows:e,objectRows:function(t,e,n,i){return dRt(t[e],this._dimensionInfos[e])},keyedColumns:e,original:function(t,e,n,i){var r=t&&(null==t.value?t:t.value);return!this._rawData.pure&&function(t){return L_t(t)&&!(t instanceof Array)}(t)&&(this.hasItemOption=!0),dRt(r instanceof Array?r[i]:r,this._dimensionInfos[e])},typedArray:function(t,e,n,i){return t[i]}},_Bt=function(t){var e=t._invertedIndicesMap;S_t(e,(function(n,i){var r=t._dimensionInfos[i].ordinalMeta;if(r){n=e[i]=new VBt(r.categories.length);for(var o=0;o<n.length;o++)n[o]=-1;for(o=0;o<t._count;o++)n[t.get(i,o)]=o}}))},MBt=function(t,e,n,i){var r,o=t._storageArr[e];return o&&(r=o[i],n&&n.categories.length&&(r=n.categories[r])),zAt(r,null)},kBt=function(t){return t._rawCount>65535?BBt:WBt},SBt=function(t,e,n,i){var r=zBt[e.type],o=e.name;if(i){var a=t[o],s=a&&a.length;if(s!==n){for(var l=new r(n),u=0;u<s;u++)l[u]=a[u];t[o]=l}}else t[o]=new r(n)},CBt=function(t){return t},ABt=function(t){return t<this._count&&t>=0?this._indices[t]:-1},IBt=function(t,e){var n=t._idList[e];return null==n&&null!=t._idDimIdx&&(n=MBt(t,t._idDimIdx,t._idOrdinalMeta,e)),null==n&&(n="e\0\0"+e),n},TBt=function(t){return E_t(t)||(t=null!=t?[t]:[]),t},EBt=function(e,n){var i=e.dimensions,r=new t(PBt(i,e.getDimensionInfo,e),e.hostModel);FBt(r,e);for(var o,a,s=r._storage={},l=e._storage,u=r._storageArr=[],c=0;c<i.length;c++){var h=i[c];l[h]&&(w_t(n,h)>=0?(s[h]=(o=l[h],a=void 0,(a=o.constructor)===Array?o.slice():new a(o)),r._rawExtent[h]=NBt(),r._extent[h]=null):s[h]=l[h],u.push(s[h]))}return r},NBt=function(){return[1/0,-1/0]},OBt=function(t){var e=IDt(t),n=IDt(this);e.seriesIndex=n.seriesIndex,e.dataIndex=n.dataIndex,e.dataType=n.dataType},FBt=function(t,e){S_t(jBt.concat(e.__wrappedMethods||[]),(function(n){e.hasOwnProperty(n)&&(t[n]=e[n])})),t.__wrappedMethods=e.__wrappedMethods,S_t(UBt,(function(n){t[n]=g_t(e[n])})),t._calculationInfo=v_t({},e._calculationInfo)},DBt=function(t,e){var n=t._nameList,i=t._idList,r=t._nameDimIdx,o=t._idDimIdx,a=n[e],s=i[e];if(null==a&&null!=r&&(n[e]=a=MBt(t,r,t._nameOrdinalMeta,e)),null==s&&null!=o&&(i[e]=s=MBt(t,o,t._idOrdinalMeta,e)),null==s&&null!=a){var l=t._nameRepeatCount,u=l[a]=(l[a]||0)+1;s=a,u>1&&(s+="__ec__"+u),i[e]=s}}}(),t}();function HBt(t,e,n){VFt(e)||(e=jFt(e)),n=n||{},t=(t||[]).slice();for(var i=(n.dimsDef||[]).slice(),r=Z_t(),o=Z_t(),a=[],s=function(t,e,n,i){var r=Math.max(t.dimensionsDetectedCount||1,e.length,n.length,i||0);return S_t(e,(function(t){var e;L_t(t)&&(e=t.dimsDef)&&(r=Math.max(r,e.length))})),r}(e,t,i,n.dimCount),l=0;l<s;l++){var u=i[l],c=i[l]=v_t({},L_t(u)?u:{name:u}),h=c.name,d=a[l]=new RBt;null!=h&&null==r.get(h)&&(d.name=d.displayName=h,r.set(h,l)),null!=c.type&&(d.type=c.type),null!=c.displayName&&(d.displayName=c.displayName)}var p=n.encodeDef;!p&&n.encodeDefaulter&&(p=n.encodeDefaulter(e,s));var f=Z_t(p);f.each((function(t,e){var n=NAt(t).slice();if(1===n.length&&!O_t(n[0])&&n[0]<0)f.set(e,!1);else{var i=f.set(e,[]);S_t(n,(function(t,n){var o=O_t(t)?r.get(t):t;null!=o&&o<s&&(i[n]=o,m(a[o],e,n))}))}}));var g=0;function m(t,e,n){null!=POt.get(e)?t.otherDims[e]=n:(t.coordDim=e,t.coordDimIndex=n,o.set(e,!0))}S_t(t,(function(t){var e,n,i,r;if(O_t(t))e=t,r={};else{e=(r=t).name;var o=r.ordinalMeta;r.ordinalMeta=null,(r=g_t(r)).ordinalMeta=o,n=r.dimsDef,i=r.otherDims,r.name=r.coordDim=r.coordDimIndex=r.dimsDef=r.otherDims=null}var s=f.get(e);if(!1!==s){if(!(s=NAt(s)).length)for(var l=0;l<(n&&n.length||1);l++){for(;g<a.length&&null!=a[g].coordDim;)g++;g<a.length&&s.push(g++)}S_t(s,(function(t,o){var s=a[t];if(m(x_t(s,r),e,o),null==s.name&&n){var l=n[o];!L_t(l)&&(l={name:l}),s.name=s.displayName=l.name,s.defaultTooltip=l.defaultTooltip}i&&x_t(s.otherDims,i)}))}}));var y=n.generateCoord,v=n.generateCoordCount,x=null!=v;v=y?v||1:0;for(var b=y||"value",w=0;w<s;w++){null==(d=a[w]=a[w]||new RBt).coordDim&&(d.coordDim=qBt(b,o,x),d.coordDimIndex=0,(!y||v<=0)&&(d.isExtraCoord=!0),v--),null==d.name&&(d.name=qBt(d.coordDim,r,!1)),null!=d.type||HOt(e,w)!==zOt&&(!d.isExtraCoord||null==d.otherDims.itemName&&null==d.otherDims.seriesName)||(d.type="ordinal")}return a}function qBt(t,e,n){if(n||null!=e.get(t)){for(var i=0;null!=e.get(t+i);)i++;t+=i}return e.set(t,!0),t}function XBt(t,e){return HBt((e=e||{}).coordDimensions||[],t,{dimsDef:e.dimensionsDefine||t.dimensionsDefine,encodeDef:e.encodeDefine||t.encodeDefine,dimCount:e.dimensionsCount,encodeDefaulter:e.encodeDefaulter,generateCoord:e.generateCoord,generateCoordCount:e.generateCoordCount})}var YBt=function(t){this.coordSysDims=[],this.axisMap=Z_t(),this.categoryAxisMap=Z_t(),this.coordSysName=t};var KBt={cartesian2d:function(t,e,n,i){var r=t.getReferringComponents("xAxis",qAt).models[0],o=t.getReferringComponents("yAxis",qAt).models[0];e.coordSysDims=["x","y"],n.set("x",r),n.set("y",o),ZBt(r)&&(i.set("x",r),e.firstCategoryDimIndex=0),ZBt(o)&&(i.set("y",o),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=1))},singleAxis:function(t,e,n,i){var r=t.getReferringComponents("singleAxis",qAt).models[0];e.coordSysDims=["single"],n.set("single",r),ZBt(r)&&(i.set("single",r),e.firstCategoryDimIndex=0)},polar:function(t,e,n,i){var r=t.getReferringComponents("polar",qAt).models[0],o=r.findAxisModel("radiusAxis"),a=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],n.set("radius",o),n.set("angle",a),ZBt(o)&&(i.set("radius",o),e.firstCategoryDimIndex=0),ZBt(a)&&(i.set("angle",a),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=1))},geo:function(t,e,n,i){e.coordSysDims=["lng","lat"]},parallel:function(t,e,n,i){var r=t.ecModel,o=r.getComponent("parallel",t.get("parallelIndex")),a=e.coordSysDims=o.dimensions.slice();S_t(o.parallelAxisIndex,(function(t,o){var s=r.getComponent("parallelAxis",t),l=a[o];n.set(l,s),ZBt(s)&&(i.set(l,s),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=o))}))}};function ZBt(t){return"category"===t.get("type")}function JBt(t,e){return!!e&&e===t.getCalculationInfo("stackedDimension")}function QBt(t,e){return JBt(t,e)?t.getCalculationInfo("stackResultDimension"):e}function tVt(t,e,n){n=n||{},VFt(t)||(t=jFt(t));var i,r=e.get("coordinateSystem"),o=cFt.get(r),a=function(t){var e=t.get("coordinateSystem"),n=new YBt(e),i=KBt[e];if(i)return i(t,n,n.axisMap,n.categoryAxisMap),n}(e);a&&a.coordSysDims&&(i=C_t(a.coordSysDims,(function(t){var e={name:t},n=a.axisMap.get(t);if(n){var i=n.get("type");e.type=bBt(i)}return e}))),i||(i=o&&(o.getDimensionsInfo?o.getDimensionsInfo():o.dimensions.slice())||["x","y"]);var s,l,u=n.useEncodeDefaulter,c=XBt(t,{coordDimensions:i,generateCoord:n.generateCoord,encodeDefaulter:N_t(u)?u:u?T_t(jOt,i,e):null});a&&S_t(c,(function(t,e){var i=t.coordDim,r=a.categoryAxisMap.get(i);r&&(null==s&&(s=e),t.ordinalMeta=r.getOrdinalMeta(),n.createInvertedIndices&&(t.createInvertedIndices=!0)),null!=t.otherDims.itemName&&(l=!0)})),l||null==s||(c[s].otherDims.itemName=0);var h=function(t,e,n){var i,r,o,a,s=(n=n||{}).byIndex,l=n.stackedCoordDimension,u=!(!t||!t.get("stack"));if(S_t(e,(function(t,n){O_t(t)&&(e[n]=t={name:t}),u&&!t.isExtraCoord&&(s||i||!t.ordinalMeta||(i=t),r||"ordinal"===t.type||"time"===t.type||l&&l!==t.coordDim||(r=t))})),!r||s||i||(s=!0),r){o="__\0ecstackresult",a="__\0ecstackedover",i&&(i.createInvertedIndices=!0);var c=r.coordDim,h=r.type,d=0;S_t(e,(function(t){t.coordDim===c&&d++})),e.push({name:o,coordDim:c,coordDimIndex:d,type:h,isExtraCoord:!0,isCalculationCoord:!0}),d++,e.push({name:a,coordDim:a,coordDimIndex:d,type:h,isExtraCoord:!0,isCalculationCoord:!0})}return{stackedDimension:r&&r.name,stackedByDimension:i&&i.name,isStackedByIndex:s,stackedOverDimension:a,stackResultDimension:o}}(e,c),d=new GBt(c,e);d.setCalculationInfo(h);var p=null!=s&&function(t){if("original"===t.sourceFormat){var e=function(t){var e=0;for(;e<t.length&&null==t[e];)e++;return t[e]}(t.data||[]);return null!=e&&!E_t(RAt(e))}}(t)?function(t,e,n,i){return i===s?n:this.defaultDimValueGetter(t,e,n,i)}:null;return d.hasItemOption=!1,d.initData(t,null,p),d}var eVt=function(){function t(t){this._setting=t||{},this._extent=[1/0,-1/0]}return t.prototype.getSetting=function(t){return this._setting[t]},t.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1])},t.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},t.prototype.getExtent=function(){return this._extent.slice()},t.prototype.setExtent=function(t,e){var n=this._extent;isNaN(t)||(n[0]=t),isNaN(e)||(n[1]=e)},t.prototype.isInExtentRange=function(t){return this._extent[0]<=t&&this._extent[1]>=t},t.prototype.isBlank=function(){return this._isBlank},t.prototype.setBlank=function(t){this._isBlank=t},t}();sIt(eVt);var nVt=function(){function t(t){this.categories=t.categories||[],this._needCollect=t.needCollect,this._deduplication=t.deduplication}return t.createByAxisModel=function(e){var n=e.option,i=n.data,r=i&&C_t(i,iVt);return new t({categories:r,needCollect:!r,deduplication:!1!==n.dedplication})},t.prototype.getOrdinal=function(t){return this._getOrCreateMap().get(t)},t.prototype.parseAndCollect=function(t){var e,n=this._needCollect;if("string"!=typeof t&&!n)return t;if(n&&!this._deduplication)return e=this.categories.length,this.categories[e]=t,e;var i=this._getOrCreateMap();return null==(e=i.get(t))&&(n?(e=this.categories.length,this.categories[e]=t,i.set(t,e)):e=NaN),e},t.prototype._getOrCreateMap=function(){return this._map||(this._map=Z_t(this.categories))},t}();function iVt(t){return L_t(t)&&null!=t.value?t.value:t+""}var rVt=pAt;function oVt(t,e,n,i){var r={},o=t[1]-t[0],a=r.interval=kAt(o/e,!0);null!=n&&a<n&&(a=r.interval=n),null!=i&&a>i&&(a=r.interval=i);var s=r.intervalPrecision=aVt(a);return function(t,e){!isFinite(t[0])&&(t[0]=e[0]),!isFinite(t[1])&&(t[1]=e[1]),sVt(t,0,e),sVt(t,1,e),t[0]>t[1]&&(t[0]=t[1])}(r.niceTickExtent=[rVt(Math.ceil(t[0]/a)*a,s),rVt(Math.floor(t[1]/a)*a,s)],t),r}function aVt(t){return gAt(t)+2}function sVt(t,e,n){t[e]=Math.max(Math.min(t[e],n[1]),n[0])}function lVt(t,e){return t>=e[0]&&t<=e[1]}function uVt(t,e){return e[1]===e[0]?.5:(t-e[0])/(e[1]-e[0])}function cVt(t,e){return t*(e[1]-e[0])+e[0]}var hVt=function(t){function e(e){var n=t.call(this,e)||this;n.type="ordinal";var i=n.getSetting("ordinalMeta");return i||(i=new nVt({})),E_t(i)&&(i=new nVt({categories:C_t(i,(function(t){return L_t(t)?t.value:t}))})),n._ordinalMeta=i,n._extent=n.getSetting("extent")||[0,i.categories.length-1],n}return Dit(e,t),e.prototype.parse=function(t){return"string"==typeof t?this._ordinalMeta.getOrdinal(t):Math.round(t)},e.prototype.contain=function(t){return lVt(t=this.parse(t),this._extent)&&null!=this._ordinalMeta.categories[t]},e.prototype.normalize=function(t){return uVt(t=this._getTickNumber(this.parse(t)),this._extent)},e.prototype.scale=function(t){return t=Math.round(cVt(t,this._extent)),this.getRawOrdinalNumber(t)},e.prototype.getTicks=function(){for(var t=[],e=this._extent,n=e[0];n<=e[1];)t.push({value:n}),n++;return t},e.prototype.getMinorTicks=function(t){},e.prototype.setSortInfo=function(t){if(null!=t){for(var e=t.ordinalNumbers,n=this._ordinalNumbersByTick=[],i=this._ticksByOrdinalNumber=[],r=0,o=this._ordinalMeta.categories.length,a=Math.min(o,e.length);r<a;++r){var s=e[r];n[r]=s,i[s]=r}for(var l=0;r<o;++r){for(;null!=i[l];)l++;n.push(l),i[l]=r}}else this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null},e.prototype._getTickNumber=function(t){var e=this._ticksByOrdinalNumber;return e&&t>=0&&t<e.length?e[t]:t},e.prototype.getRawOrdinalNumber=function(t){var e=this._ordinalNumbersByTick;return e&&t>=0&&t<e.length?e[t]:t},e.prototype.getLabel=function(t){if(!this.isBlank()){var e=this.getRawOrdinalNumber(t.value),n=this._ordinalMeta.categories[e];return null==n?"":n+""}},e.prototype.count=function(){return this._extent[1]-this._extent[0]+1},e.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},e.prototype.isInExtentRange=function(t){return t=this._getTickNumber(t),this._extent[0]<=t&&this._extent[1]>=t},e.prototype.getOrdinalMeta=function(){return this._ordinalMeta},e.prototype.niceTicks=function(){},e.prototype.niceExtent=function(){},e.type="ordinal",e}(eVt);eVt.registerClass(hVt);var dVt=pAt,pVt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="interval",e._interval=0,e._intervalPrecision=2,e}return Dit(e,t),e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return lVt(t,this._extent)},e.prototype.normalize=function(t){return uVt(t,this._extent)},e.prototype.scale=function(t){return cVt(t,this._extent)},e.prototype.setExtent=function(t,e){var n=this._extent;isNaN(t)||(n[0]=parseFloat(t)),isNaN(e)||(n[1]=parseFloat(e))},e.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),this.setExtent(e[0],e[1])},e.prototype.getInterval=function(){return this._interval},e.prototype.setInterval=function(t){this._interval=t,this._niceExtent=this._extent.slice(),this._intervalPrecision=aVt(t)},e.prototype.getTicks=function(t){var e=this._interval,n=this._extent,i=this._niceExtent,r=this._intervalPrecision,o=[];if(!e)return o;n[0]<i[0]&&(t?o.push({value:dVt(i[0]-e,r)}):o.push({value:n[0]}));for(var a=i[0];a<=i[1]&&(o.push({value:a}),(a=dVt(a+e,r))!==o[o.length-1].value);)if(o.length>1e4)return[];var s=o.length?o[o.length-1].value:i[1];return n[1]>s&&(t?o.push({value:dVt(s+e,r)}):o.push({value:n[1]})),o},e.prototype.getMinorTicks=function(t){for(var e=this.getTicks(!0),n=[],i=this.getExtent(),r=1;r<e.length;r++){for(var o=e[r],a=e[r-1],s=0,l=[],u=(o.value-a.value)/t;s<t-1;){var c=dVt(a.value+(s+1)*u);c>i[0]&&c<i[1]&&l.push(c),s++}n.push(l)}return n},e.prototype.getLabel=function(t,e){if(null==t)return"";var n=e&&e.precision;return null==n?n=gAt(t.value)||0:"auto"===n&&(n=this._intervalPrecision),cOt(dVt(t.value,n,!0))},e.prototype.niceTicks=function(t,e,n){t=t||5;var i=this._extent,r=i[1]-i[0];if(isFinite(r)){r<0&&(r=-r,i.reverse());var o=oVt(i,t,e,n);this._intervalPrecision=o.intervalPrecision,this._interval=o.interval,this._niceExtent=o.niceTickExtent}},e.prototype.niceExtent=function(t){var e=this._extent;if(e[0]===e[1])if(0!==e[0]){var n=e[0];t.fixMax||(e[1]+=n/2),e[0]-=n/2}else e[1]=1;var i=e[1]-e[0];isFinite(i)||(e[0]=0,e[1]=1),this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval);var r=this._interval;t.fixMin||(e[0]=dVt(Math.floor(e[0]/r)*r)),t.fixMax||(e[1]=dVt(Math.ceil(e[1]/r)*r))},e.type="interval",e}(eVt);eVt.registerClass(pVt);var fVt="undefined"!=typeof Float32Array?Float32Array:Array;function gVt(t){return t.get("stack")||"__ec_stack_"+t.seriesIndex}function mVt(t){return t.dim+t.index}function yVt(t,e){var n=[];return e.eachSeriesByType(t,(function(t){kVt(t)&&!SVt(t)&&n.push(t)})),n}function vVt(t){var e=function(t){var e={};S_t(t,(function(t){var n=t.coordinateSystem.getBaseAxis();if("time"===n.type||"value"===n.type)for(var i=t.getData(),r=n.dim+"_"+n.index,o=i.mapDimension(n.dim),a=0,s=i.count();a<s;++a){var l=i.get(o,a);e[r]?e[r].push(l):e[r]=[l]}}));var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(r){r.sort((function(t,e){return t-e}));for(var o=null,a=1;a<r.length;++a){var s=r[a]-r[a-1];s>0&&(o=null===o?s:Math.min(o,s))}n[i]=o}}return n}(t),n=[];return S_t(t,(function(t){var i,r=t.coordinateSystem.getBaseAxis(),o=r.getExtent();if("category"===r.type)i=r.getBandWidth();else if("value"===r.type||"time"===r.type){var a=r.dim+"_"+r.index,s=e[a],l=Math.abs(o[1]-o[0]),u=r.scale.getExtent(),c=Math.abs(u[1]-u[0]);i=s?l/c*s:l}else{var h=t.getData();i=Math.abs(o[1]-o[0])/h.count()}var d=dAt(t.get("barWidth"),i),p=dAt(t.get("barMaxWidth"),i),f=dAt(t.get("barMinWidth")||1,i),g=t.get("barGap"),m=t.get("barCategoryGap");n.push({bandWidth:i,barWidth:d,barMaxWidth:p,barMinWidth:f,barGap:g,barCategoryGap:m,axisKey:mVt(r),stackId:gVt(t)})})),xVt(n)}function xVt(t){var e={};S_t(t,(function(t,n){var i=t.axisKey,r=t.bandWidth,o=e[i]||{bandWidth:r,remainedWidth:r,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},a=o.stacks;e[i]=o;var s=t.stackId;a[s]||o.autoWidthCount++,a[s]=a[s]||{width:0,maxWidth:0};var l=t.barWidth;l&&!a[s].width&&(a[s].width=l,l=Math.min(o.remainedWidth,l),o.remainedWidth-=l);var u=t.barMaxWidth;u&&(a[s].maxWidth=u);var c=t.barMinWidth;c&&(a[s].minWidth=c);var h=t.barGap;null!=h&&(o.gap=h);var d=t.barCategoryGap;null!=d&&(o.categoryGap=d)}));var n={};return S_t(e,(function(t,e){n[e]={};var i=t.stacks,r=t.bandWidth,o=t.categoryGap;if(null==o){var a=M_t(i).length;o=Math.max(35-4*a,15)+"%"}var s=dAt(o,r),l=dAt(t.gap,1),u=t.remainedWidth,c=t.autoWidthCount,h=(u-s)/(c+(c-1)*l);h=Math.max(h,0),S_t(i,(function(t){var e=t.maxWidth,n=t.minWidth;if(t.width){i=t.width;e&&(i=Math.min(i,e)),n&&(i=Math.max(i,n)),t.width=i,u-=i+l*i,c--}else{var i=h;e&&e<i&&(i=Math.min(e,u)),n&&n>i&&(i=n),i!==h&&(t.width=i,u-=i+l*i,c--)}})),h=(u-s)/(c+(c-1)*l),h=Math.max(h,0);var d,p=0;S_t(i,(function(t,e){t.width||(t.width=h),d=t,p+=t.width*(1+l)})),d&&(p-=d.width*l);var f=-p/2;S_t(i,(function(t,i){n[e][i]=n[e][i]||{bandWidth:r,offset:f,width:t.width},f+=t.width*(1+l)}))})),n}function bVt(t,e,n){if(t&&e){var i=t[mVt(e)];return null!=i&&null!=n?i[gVt(n)]:i}}function wVt(t,e){var n=yVt(t,e),i=vVt(n),r={};S_t(n,(function(t){var e=t.getData(),n=t.coordinateSystem,o=n.getBaseAxis(),a=gVt(t),s=i[mVt(o)][a],l=s.offset,u=s.width,c=n.getOtherAxis(o),h=t.get("barMinHeight")||0;r[a]=r[a]||[],e.setLayout({bandWidth:s.bandWidth,offset:l,size:u});for(var d=e.mapDimension(c.dim),p=e.mapDimension(o.dim),f=JBt(e,d),g=c.isHorizontal(),m=CVt(o,c),y=0,v=e.count();y<v;y++){var x=e.get(d,y),b=e.get(p,y),w=x>=0?"p":"n",_=m;f&&(r[a][b]||(r[a][b]={p:m,n:m}),_=r[a][b][w]);var k,S=void 0,C=void 0,A=void 0,I=void 0;if(g)S=_,C=(k=n.dataToPoint([x,b]))[1]+l,A=k[0]-m,I=u,Math.abs(A)<h&&(A=(A<0?-1:1)*h),isNaN(A)||f&&(r[a][b][w]+=A);else S=(k=n.dataToPoint([b,x]))[0]+l,C=_,A=u,I=k[1]-m,Math.abs(I)<h&&(I=(I<=0?-1:1)*h),isNaN(I)||f&&(r[a][b][w]+=I);e.setItemLayout(y,{x:S,y:C,width:A,height:I})}}))}var _Vt={seriesType:"bar",plan:iLt(),reset:function(t){if(kVt(t)&&SVt(t)){var e=t.getData(),n=t.coordinateSystem,i=n.master.getRect(),r=n.getBaseAxis(),o=n.getOtherAxis(r),a=e.mapDimension(o.dim),s=e.mapDimension(r.dim),l=o.isHorizontal(),u=l?0:1,c=bVt(vVt([t]),r,t).width;return c>.5||(c=.5),{progress:function(t,e){for(var h,d=t.count,p=new fVt(2*d),f=new fVt(2*d),g=new fVt(d),m=[],y=[],v=0,x=0;null!=(h=t.next());)y[u]=e.get(a,h),y[1-u]=e.get(s,h),m=n.dataToPoint(y,null),f[v]=l?i.x+i.width:m[0],p[v++]=m[0],f[v]=l?m[1]:i.y+i.height,p[v++]=m[1],g[x++]=h;e.setLayout({largePoints:p,largeDataIndices:g,largeBackgroundPoints:f,barWidth:c,valueAxisStart:CVt(r,o),backgroundStart:l?i.x:i.y,valueAxisHorizontal:l})}}}}};function kVt(t){return t.coordinateSystem&&"cartesian2d"===t.coordinateSystem.type}function SVt(t){return t.pipelineContext&&t.pipelineContext.large}function CVt(t,e,n){return e.toGlobalCoord(e.dataToCoord("log"===e.type?1:0))}var AVt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="time",n}return Dit(e,t),e.prototype.getLabel=function(t){var e=this.getSetting("useUTC");return qNt(t.value,VNt[function(t){switch(t){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}(GNt(this._minLevelUnit))]||VNt.second,e,this.getSetting("locale"))},e.prototype.getFormattedLabel=function(t,e,n){var i=this.getSetting("useUTC");return function(t,e,n,i,r){var o=null;if("string"==typeof n)o=n;else if("function"==typeof n)o=n(t.value,e,{level:t.level});else{var a=v_t({},BNt);if(t.level>0)for(var s=0;s<WNt.length;++s)a[WNt[s]]="{primary|"+a[WNt[s]]+"}";var l=n?!1===n.inherit?n:x_t(n,a):a,u=XNt(t.value,r);if(l[u])o=l[u];else if(l.inherit){for(s=jNt.indexOf(u)-1;s>=0;--s)if(l[u]){o=l[u];break}o=o||a.none}if(E_t(o)){var c=null==t.level?0:t.level>=0?t.level:o.length+t.level;o=o[c=Math.min(c,o.length-1)]}}return qNt(new Date(t.value),o,r,i)}(t,e,n,this.getSetting("locale"),i)},e.prototype.getTicks=function(t){var e=this._interval,n=this._extent,i=[];if(!e)return i;i.push({value:n[0],level:0});var r=this.getSetting("useUTC"),o=function(t,e,n,i){var r=1e4,o=jNt,a=0;function s(t,e,n,r,o,a,s){for(var l=new Date(e),u=e,c=l[r]();u<n&&u<=i[1];)s.push({value:u}),c+=t,l[o](c),u=l.getTime();s.push({value:u,notAdd:!0})}function l(t,r,o){var a=[],l=!r.length;if(!function(t,e,n,i){var r=wAt(e),o=wAt(n),a=function(t){return YNt(r,t,i)===YNt(o,t,i)},s=function(){return a("year")},l=function(){return s()&&a("month")},u=function(){return l()&&a("day")},c=function(){return u()&&a("hour")},h=function(){return c()&&a("minute")},d=function(){return h()&&a("second")},p=function(){return d()&&a("millisecond")};switch(t){case"year":return s();case"month":return l();case"day":return u();case"hour":return c();case"minute":return h();case"second":return d();case"millisecond":return p()}}(GNt(t),i[0],i[1],n)){l&&(r=[{value:OVt(new Date(i[0]),t,n)},{value:i[1]}]);for(var u=0;u<r.length-1;u++){var c=r[u].value,h=r[u+1].value;if(c!==h){var d=void 0,p=void 0,f=void 0,g=!1;switch(t){case"year":d=Math.max(1,Math.round(e/864e5/365)),p=KNt(n),f=iOt(n);break;case"half-year":case"quarter":case"month":d=DVt(e),p=ZNt(n),f=rOt(n);break;case"week":case"half-week":case"day":d=MVt(e),p=JNt(n),f=oOt(n),g=!0;break;case"half-day":case"quarter-day":case"hour":d=TVt(e),p=QNt(n),f=aOt(n);break;case"minute":d=EVt(e,!0),p=tOt(n),f=sOt(n);break;case"second":d=EVt(e,!1),p=eOt(n),f=lOt(n);break;case"millisecond":d=NVt(e),p=nOt(n),f=uOt(n)}s(d,c,h,p,f,g,a),"year"===t&&o.length>1&&0===u&&o.unshift({value:o[0].value-d})}}for(u=0;u<a.length;u++)o.push(a[u]);return a}}for(var u=[],c=[],h=0,d=0,p=0;p<o.length&&a++<r;++p){var f=GNt(o[p]);if(HNt(o[p]))if(l(o[p],u[u.length-1]||[],c),f!==(o[p+1]?GNt(o[p+1]):null)){if(c.length){d=h,c.sort((function(t,e){return t.value-e.value}));for(var g=[],m=0;m<c.length;++m){var y=c[m].value;0!==m&&c[m-1].value===y||(g.push(c[m]),y>=i[0]&&y<=i[1]&&h++)}var v=(i[1]-i[0])/e;if(h>1.5*v&&d>v/1.5)break;if(u.push(g),h>v||t===o[p])break}c=[]}}var x=I_t(C_t(u,(function(t){return I_t(t,(function(t){return t.value>=i[0]&&t.value<=i[1]&&!t.notAdd}))})),(function(t){return t.length>0})),b=[],w=x.length-1;for(p=0;p<x.length;++p)for(var _=x[p],k=0;k<_.length;++k)b.push({value:_[k].value,level:w-p});b.sort((function(t,e){return t.value-e.value}));var S=[];for(p=0;p<b.length;++p)0!==p&&b[p].value===b[p-1].value||S.push(b[p]);return S}(this._minLevelUnit,this._approxInterval,r,n);return(i=i.concat(o)).push({value:n[1],level:0}),i},e.prototype.niceExtent=function(t){var e=this._extent;if(e[0]===e[1]&&(e[0]-=864e5,e[1]+=864e5),e[1]===-1/0&&e[0]===1/0){var n=new Date;e[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),e[0]=e[1]-864e5}this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval)},e.prototype.niceTicks=function(t,e,n){t=t||10;var i=this._extent,r=i[1]-i[0];this._approxInterval=r/t,null!=e&&this._approxInterval<e&&(this._approxInterval=e),null!=n&&this._approxInterval>n&&(this._approxInterval=n);var o=IVt.length,a=Math.min(function(t,e,n,i){for(;n<i;){var r=n+i>>>1;t[r][1]<e?n=r+1:i=r}return n}(IVt,this._approxInterval,0,o),o-1);this._interval=IVt[a][1],this._minLevelUnit=IVt[Math.max(a-1,0)][0]},e.prototype.parse=function(t){return"number"==typeof t?t:+wAt(t)},e.prototype.contain=function(t){return lVt(this.parse(t),this._extent)},e.prototype.normalize=function(t){return uVt(this.parse(t),this._extent)},e.prototype.scale=function(t){return cVt(t,this._extent)},e.type="time",e}(pVt),IVt=[["second",1e3],["minute",6e4],["hour",36e5],["quarter-day",216e5],["half-day",432e5],["day",10368e4],["half-week",3024e5],["week",6048e5],["month",26784e5],["quarter",8208e6],["half-year",15768e6],["year",31536e6]];function MVt(t,e){return(t/=864e5)>16?16:t>7.5?7:t>3.5?4:t>1.5?2:1}function DVt(t){return(t/=2592e6)>6?6:t>3?3:t>2?2:1}function TVt(t){return(t/=36e5)>12?12:t>6?6:t>3.5?4:t>2?2:1}function EVt(t,e){return(t/=e?6e4:1e3)>30?30:t>20?20:t>15?15:t>10?10:t>5?5:t>2?2:1}function NVt(t){return kAt(t,!0)}function OVt(t,e,n){var i=new Date(t);switch(GNt(e)){case"year":case"month":i[rOt(n)](0);case"day":i[oOt(n)](1);case"hour":i[aOt(n)](0);case"minute":i[sOt(n)](0);case"second":i[lOt(n)](0),i[uOt(n)](0)}return i.getTime()}eVt.registerClass(AVt);var FVt=eVt.prototype,RVt=pVt.prototype,LVt=pAt,$Vt=Math.floor,PVt=Math.ceil,zVt=Math.pow,BVt=Math.log,VVt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="log",e.base=10,e._originalScale=new pVt,e._interval=0,e}return Dit(e,t),e.prototype.getTicks=function(t){var e=this._originalScale,n=this._extent,i=e.getExtent();return C_t(RVt.getTicks.call(this,t),(function(t){var e=t.value,r=pAt(zVt(this.base,e));return r=e===n[0]&&this._fixMin?jVt(r,i[0]):r,{value:r=e===n[1]&&this._fixMax?jVt(r,i[1]):r}}),this)},e.prototype.setExtent=function(t,e){var n=this.base;t=BVt(t)/BVt(n),e=BVt(e)/BVt(n),RVt.setExtent.call(this,t,e)},e.prototype.getExtent=function(){var t=this.base,e=FVt.getExtent.call(this);e[0]=zVt(t,e[0]),e[1]=zVt(t,e[1]);var n=this._originalScale.getExtent();return this._fixMin&&(e[0]=jVt(e[0],n[0])),this._fixMax&&(e[1]=jVt(e[1],n[1])),e},e.prototype.unionExtent=function(t){this._originalScale.unionExtent(t);var e=this.base;t[0]=BVt(t[0])/BVt(e),t[1]=BVt(t[1])/BVt(e),FVt.unionExtent.call(this,t)},e.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},e.prototype.niceTicks=function(t){t=t||10;var e=this._extent,n=e[1]-e[0];if(!(n===1/0||n<=0)){var i,r=(i=n,Math.pow(10,_At(i)));for(t/n*r<=.5&&(r*=10);!isNaN(r)&&Math.abs(r)<1&&Math.abs(r)>0;)r*=10;var o=[pAt(PVt(e[0]/r)*r),pAt($Vt(e[1]/r)*r)];this._interval=r,this._niceExtent=o}},e.prototype.niceExtent=function(t){RVt.niceExtent.call(this,t),this._fixMin=t.fixMin,this._fixMax=t.fixMax},e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return lVt(t=BVt(t)/BVt(this.base),this._extent)},e.prototype.normalize=function(t){return uVt(t=BVt(t)/BVt(this.base),this._extent)},e.prototype.scale=function(t){return t=cVt(t,this._extent),zVt(this.base,t)},e.type="log",e}(eVt),WVt=VVt.prototype;function jVt(t,e){return LVt(t,gAt(e))}WVt.getMinorTicks=RVt.getMinorTicks,WVt.getLabel=RVt.getLabel,eVt.registerClass(VVt);var UVt=function(){function t(t,e,n){this._prepareParams(t,e,n)}return t.prototype._prepareParams=function(t,e,n){n[1]<n[0]&&(n=[NaN,NaN]),this._dataMin=n[0],this._dataMax=n[1];var i=this._isOrdinal="ordinal"===t.type;this._needCrossZero=e.getNeedCrossZero&&e.getNeedCrossZero();var r=this._modelMinRaw=e.get("min",!0);N_t(r)?this._modelMinNum=XVt(t,r({min:n[0],max:n[1]})):"dataMin"!==r&&(this._modelMinNum=XVt(t,r));var o=this._modelMaxRaw=e.get("max",!0);if(N_t(o)?this._modelMaxNum=XVt(t,o({min:n[0],max:n[1]})):"dataMax"!==o&&(this._modelMaxNum=XVt(t,o)),i)this._axisDataLen=e.getCategories().length;else{var a=e.get("boundaryGap"),s=E_t(a)?a:[a||0,a||0];"boolean"==typeof s[0]||"boolean"==typeof s[1]?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[XCt(s[0],1),XCt(s[1],1)]}},t.prototype.calculate=function(){var t=this._isOrdinal,e=this._dataMin,n=this._dataMax,i=this._axisDataLen,r=this._boundaryGapInner,o=t?null:n-e||Math.abs(e),a="dataMin"===this._modelMinRaw?e:this._modelMinNum,s="dataMax"===this._modelMaxRaw?n:this._modelMaxNum,l=null!=a,u=null!=s;null==a&&(a=t?i?0:NaN:e-r[0]*o),null==s&&(s=t?i?i-1:NaN:n+r[1]*o),(null==a||!isFinite(a))&&(a=NaN),(null==s||!isFinite(s))&&(s=NaN),a>s&&(a=NaN,s=NaN);var c=B_t(a)||B_t(s)||t&&!i;this._needCrossZero&&(a>0&&s>0&&!l&&(a=0),a<0&&s<0&&!u&&(s=0));var h=this._determinedMin,d=this._determinedMax;return null!=h&&(a=h,l=!0),null!=d&&(s=d,u=!0),{min:a,max:s,minFixed:l,maxFixed:u,isBlank:c}},t.prototype.modifyDataMinMax=function(t,e){this[HVt[t]]=e},t.prototype.setDeterminedMinMax=function(t,e){this[GVt[t]]=e},t.prototype.freeze=function(){this.frozen=!0},t}(),GVt={min:"_determinedMin",max:"_determinedMax"},HVt={min:"_dataMin",max:"_dataMax"};function qVt(t,e,n){var i=t.rawExtentInfo;return i||(i=new UVt(t,e,n),t.rawExtentInfo=i,i)}function XVt(t,e){return null==e?null:B_t(e)?NaN:t.parse(e)}function YVt(t,e){var n=t.type,i=qVt(t,e,t.getExtent()).calculate();t.setBlank(i.isBlank);var r=i.min,o=i.max,a=e.ecModel;if(a&&"time"===n){var s=yVt("bar",a),l=!1;if(S_t(s,(function(t){l=l||t.getBaseAxis()===e.axis})),l){var u=vVt(s),c=function(t,e,n,i){var r=n.axis.getExtent(),o=r[1]-r[0],a=bVt(i,n.axis);if(void 0===a)return{min:t,max:e};var s=1/0;S_t(a,(function(t){s=Math.min(t.offset,s)}));var l=-1/0;S_t(a,(function(t){l=Math.max(t.offset+t.width,l)})),s=Math.abs(s),l=Math.abs(l);var u=s+l,c=e-t,h=c/(1-(s+l)/o)-c;return{min:t-=h*(s/u),max:e+=h*(l/u)}}(r,o,e,u);r=c.min,o=c.max}}return{extent:[r,o],fixMin:i.minFixed,fixMax:i.maxFixed}}function KVt(t,e){var n=YVt(t,e),i=n.extent,r=e.get("splitNumber");t instanceof VVt&&(t.base=e.get("logBase"));var o=t.type;t.setExtent(i[0],i[1]),t.niceExtent({splitNumber:r,fixMin:n.fixMin,fixMax:n.fixMax,minInterval:"interval"===o||"time"===o?e.get("minInterval"):null,maxInterval:"interval"===o||"time"===o?e.get("maxInterval"):null});var a=e.get("interval");null!=a&&t.setInterval&&t.setInterval(a)}function ZVt(t,e){if(e=e||t.get("type"))switch(e){case"category":return new hVt({ordinalMeta:t.getOrdinalMeta?t.getOrdinalMeta():t.getCategories(),extent:[1/0,-1/0]});case"time":return new AVt({locale:t.ecModel.getLocaleModel(),useUTC:t.ecModel.get("useUTC")});default:return new(eVt.getClass(e)||pVt)}}function JVt(t){var e,n,i=t.getLabelModel().get("formatter"),r="category"===t.type?t.scale.getExtent()[0]:null;return"time"===t.scale.type?(n=i,function(e,i){return t.scale.getFormattedLabel(e,i,n)}):"string"==typeof i?function(e){return function(n){var i=t.scale.getLabel(n);return e.replace("{value}",null!=i?i:"")}}(i):"function"==typeof i?(e=i,function(n,i){return null!=r&&(i=n.value-r),e(QVt(t,n),i,null!=n.level?{level:n.level}:null)}):function(e){return t.scale.getLabel(e)}}function QVt(t,e){return"category"===t.type?t.scale.getLabel(e):e.value}function tWt(t){var e=t.get("interval");return null==e?"auto":e}function eWt(t){return"category"===t.type&&0===tWt(t.getLabelModel())}function nWt(t,e){var n={};return S_t(t.mapDimensionsAll(e),(function(e){n[QBt(t,e)]=!0})),M_t(n)}var iWt=function(){function t(){}return t.prototype.getNeedCrossZero=function(){return!this.option.scale},t.prototype.getCoordSysModel=function(){},t}(),rWt=jAt();function oWt(t){return"category"===t.type?function(t){var e=t.getLabelModel(),n=sWt(t,e);return!e.get("show")||t.scale.isBlank()?{labels:[],labelCategoryInterval:n.labelCategoryInterval}:n}(t):function(t){var e=t.scale.getTicks(),n=JVt(t);return{labels:C_t(e,(function(e,i){return{formattedLabel:n(e,i),rawLabel:t.scale.getLabel(e),tickValue:e.value}}))}}(t)}function aWt(t,e){return"category"===t.type?function(t,e){var n,i,r=lWt(t,"ticks"),o=tWt(e),a=uWt(r,o);if(a)return a;e.get("show")&&!t.scale.isBlank()||(n=[]);if(N_t(o))n=dWt(t,o,!0);else if("auto"===o){var s=sWt(t,t.getLabelModel());i=s.labelCategoryInterval,n=C_t(s.labels,(function(t){return t.tickValue}))}else n=hWt(t,i=o,!0);return cWt(r,o,{ticks:n,tickCategoryInterval:i})}(t,e):{ticks:C_t(t.scale.getTicks(),(function(t){return t.value}))}}function sWt(t,e){var n,i,r=lWt(t,"labels"),o=tWt(e),a=uWt(r,o);return a||(N_t(o)?n=dWt(t,o):(i="auto"===o?function(t){var e=rWt(t).autoInterval;return null!=e?e:rWt(t).autoInterval=t.calculateCategoryInterval()}(t):o,n=hWt(t,i)),cWt(r,o,{labels:n,labelCategoryInterval:i}))}function lWt(t,e){return rWt(t)[e]||(rWt(t)[e]=[])}function uWt(t,e){for(var n=0;n<t.length;n++)if(t[n].key===e)return t[n].value}function cWt(t,e,n){return t.push({key:e,value:n}),n}function hWt(t,e,n){var i=JVt(t),r=t.scale,o=r.getExtent(),a=t.getLabelModel(),s=[],l=Math.max((e||0)+1,1),u=o[0],c=r.count();0!==u&&l>1&&c/l>2&&(u=Math.round(Math.ceil(u/l)*l));var h=eWt(t),d=a.get("showMinLabel")||h,p=a.get("showMaxLabel")||h;d&&u!==o[0]&&g(o[0]);for(var f=u;f<=o[1];f+=l)g(f);function g(t){var e={value:t};s.push(n?t:{formattedLabel:i(e),rawLabel:r.getLabel(e),tickValue:t})}return p&&f-l!==o[1]&&g(o[1]),s}function dWt(t,e,n){var i=t.scale,r=JVt(t),o=[];return S_t(i.getTicks(),(function(t){var a=i.getLabel(t),s=t.value;e(t.value,a)&&o.push(n?s:{formattedLabel:r(t),rawLabel:a,tickValue:s})})),o}var pWt=[0,1],fWt=function(){function t(t,e,n){this.onBand=!1,this.inverse=!1,this.dim=t,this.scale=e,this._extent=n||[0,0]}return t.prototype.contain=function(t){var e=this._extent,n=Math.min(e[0],e[1]),i=Math.max(e[0],e[1]);return t>=n&&t<=i},t.prototype.containData=function(t){return this.scale.contain(t)},t.prototype.getExtent=function(){return this._extent.slice()},t.prototype.getPixelPrecision=function(t){return mAt(t||this.scale.getExtent(),this._extent)},t.prototype.setExtent=function(t,e){var n=this._extent;n[0]=t,n[1]=e},t.prototype.dataToCoord=function(t,e){var n=this._extent,i=this.scale;return t=i.normalize(t),this.onBand&&"ordinal"===i.type&&gWt(n=n.slice(),i.count()),hAt(t,pWt,n,e)},t.prototype.coordToData=function(t,e){var n=this._extent,i=this.scale;this.onBand&&"ordinal"===i.type&&gWt(n=n.slice(),i.count());var r=hAt(t,n,pWt,e);return this.scale.scale(r)},t.prototype.pointToData=function(t,e){},t.prototype.getTicksCoords=function(t){var e=(t=t||{}).tickModel||this.getTickModel(),n=C_t(aWt(this,e).ticks,(function(t){return{coord:this.dataToCoord("ordinal"===this.scale.type?this.scale.getRawOrdinalNumber(t):t),tickValue:t}}),this);return function(t,e,n,i){var r=e.length;if(!t.onBand||n||!r)return;var o,a,s=t.getExtent();if(1===r)e[0].coord=s[0],o=e[1]={coord:s[0]};else{var l=e[r-1].tickValue-e[0].tickValue,u=(e[r-1].coord-e[0].coord)/l;S_t(e,(function(t){t.coord-=u/2})),a=1+t.scale.getExtent()[1]-e[r-1].tickValue,o={coord:e[r-1].coord+u*a},e.push(o)}var c=s[0]>s[1];h(e[0].coord,s[0])&&(i?e[0].coord=s[0]:e.shift());i&&h(s[0],e[0].coord)&&e.unshift({coord:s[0]});h(s[1],o.coord)&&(i?o.coord=s[1]:e.pop());i&&h(o.coord,s[1])&&e.push({coord:s[1]});function h(t,e){return t=pAt(t),e=pAt(e),c?t>e:t<e}}(this,n,e.get("alignWithLabel"),t.clamp),n},t.prototype.getMinorTicksCoords=function(){if("ordinal"===this.scale.type)return[];var t=this.model.getModel("minorTick").get("splitNumber");return t>0&&t<100||(t=5),C_t(this.scale.getMinorTicks(t),(function(t){return C_t(t,(function(t){return{coord:this.dataToCoord(t),tickValue:t}}),this)}),this)},t.prototype.getViewLabels=function(){return oWt(this).labels},t.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},t.prototype.getTickModel=function(){return this.model.getModel("axisTick")},t.prototype.getBandWidth=function(){var t=this._extent,e=this.scale.getExtent(),n=e[1]-e[0]+(this.onBand?1:0);0===n&&(n=1);var i=Math.abs(t[1]-t[0]);return Math.abs(i)/n},t.prototype.calculateCategoryInterval=function(){return function(t){var e=function(t){var e=t.getLabelModel();return{axisRotate:t.getRotate?t.getRotate():t.isHorizontal&&!t.isHorizontal()?90:0,labelRotate:e.get("rotate")||0,font:e.getFont()}}(t),n=JVt(t),i=(e.axisRotate-e.labelRotate)/180*Math.PI,r=t.scale,o=r.getExtent(),a=r.count();if(o[1]-o[0]<1)return 0;var s=1;a>40&&(s=Math.max(1,Math.floor(a/40)));for(var l=o[0],u=t.dataToCoord(l+1)-t.dataToCoord(l),c=Math.abs(u*Math.cos(i)),h=Math.abs(u*Math.sin(i)),d=0,p=0;l<=o[1];l+=s){var f,g,m=UCt(n({value:l}),e.font,"center","top");f=1.3*m.width,g=1.3*m.height,d=Math.max(d,f,7),p=Math.max(p,g,7)}var y=d/c,v=p/h;isNaN(y)&&(y=1/0),isNaN(v)&&(v=1/0);var x=Math.max(0,Math.floor(Math.min(y,v))),b=rWt(t.model),w=t.getExtent(),_=b.lastAutoInterval,k=b.lastTickCount;return null!=_&&null!=k&&Math.abs(_-x)<=1&&Math.abs(k-a)<=1&&_>x&&b.axisExtent0===w[0]&&b.axisExtent1===w[1]?x=_:(b.lastTickCount=a,b.lastAutoInterval=x,b.axisExtent0=w[0],b.axisExtent1=w[1]),x}(this)},t}();function gWt(t,e){var n=(t[1]-t[0])/e/2;t[0]+=n,t[1]-=n}function mWt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function yWt(t,e,n,i,r){for(var o=e.length,a=n.length,s=t.newPos,l=s-i,u=0;s+1<o&&l+1<a&&r(e[s+1],n[l+1]);)s++,l++,u++;return u&&t.components.push({count:u,added:!1,removed:!1,indices:[]}),t.newPos=s,l}function vWt(t,e,n){var i=t[t.length-1];i&&i.added===e&&i.removed===n?t[t.length-1]={count:i.count+1,added:e,removed:n,indices:[]}:t.push({count:1,added:e,removed:n,indices:[]})}function xWt(t){for(var e=0,n=t.length,i=0,r=0;e<n;e++){var o=t[e];if(o.removed){for(s=r;s<r+o.count;s++)o.indices.push(s);r+=o.count}else{for(var a=[],s=i;s<i+o.count;s++)a.push(s);o.indices=a,i+=o.count,o.added||(r+=o.count)}}return t}function bWt(t,e,n){return function(t,e,n){n||(n=function(t,e){return t===e}),t=t.slice();var i=(e=e.slice()).length,r=t.length,o=1,a=i+r,s=[{newPos:-1,components:[]}],l=yWt(s[0],e,t,0,n);if(s[0].newPos+1>=i&&l+1>=r){for(var u=[],c=0;c<e.length;c++)u.push(c);return[{indices:u,count:e.length,added:!1,removed:!1}]}function h(){for(var a=-1*o;a<=o;a+=2){var l,u=s[a-1],c=s[a+1],h=(c?c.newPos:0)-a;u&&(s[a-1]=void 0);var d=u&&u.newPos+1<i,p=c&&0<=h&&h<r;if(d||p){if(!d||p&&u.newPos<c.newPos?vWt((l={newPos:(f=c).newPos,components:f.components.slice(0)}).components,!1,!0):((l=u).newPos++,vWt(l.components,!0,!1)),h=yWt(l,e,t,a,n),l.newPos+1>=i&&h+1>=r)return xWt(l.components);s[a]=l}else s[a]=void 0}var f;o++}for(;o<=a;){var d=h();if(d)return d}}(t,e,n)}var wWt=Math.round,_Wt=Math.sin,kWt=Math.cos,SWt=Math.PI,CWt=2*Math.PI,AWt=180/SWt;function IWt(t){return wWt(1e3*t)/1e3}function MWt(t){return wWt(1e4*t)/1e4}function DWt(t){return t<1e-4&&t>-1e-4}function TWt(t,e){e&&EWt(t,"transform","matrix("+IWt(e[0])+","+IWt(e[1])+","+IWt(e[2])+","+IWt(e[3])+","+MWt(e[4])+","+MWt(e[5])+")")}function EWt(t,e,n){(!n||"linear"!==n.type&&"radial"!==n.type)&&t.setAttribute(e,n)}function NWt(t,e,n){var i=null==e.opacity?1:e.opacity;if(n instanceof uDt)t.style.opacity=i+"";else{if(function(t){var e=t.fill;return null!=e&&"none"!==e}(e)){var r=e.fill;EWt(t,"fill",r="transparent"===r?"none":r),EWt(t,"fill-opacity",(null!=e.fillOpacity?e.fillOpacity*i:i)+"")}else EWt(t,"fill","none");if(function(t){var e=t.stroke;return null!=e&&"none"!==e}(e)){var o=e.stroke;EWt(t,"stroke",o="transparent"===o?"none":o);var a=e.lineWidth,s=e.strokeNoScale?n.getLineScale():1;EWt(t,"stroke-width",(s?a/s:0)+""),EWt(t,"paint-order",e.strokeFirst?"stroke":"fill"),EWt(t,"stroke-opacity",(null!=e.strokeOpacity?e.strokeOpacity*i:i)+"");var l=e.lineDash&&a>0&&q$t(e.lineDash,a);if(l){var u=e.lineDashOffset;s&&1!==s&&(l=C_t(l,(function(t){return t/s})),u&&(u=wWt(u/=s))),EWt(t,"stroke-dasharray",l.join(",")),EWt(t,"stroke-dashoffset",(u||0)+"")}else EWt(t,"stroke-dasharray","");e.lineCap&&EWt(t,"stroke-linecap",e.lineCap),e.lineJoin&&EWt(t,"stroke-linejoin",e.lineJoin),e.miterLimit&&EWt(t,"stroke-miterlimit",e.miterLimit+"")}else EWt(t,"stroke","none")}}var OWt=function(){function t(){}return t.prototype.reset=function(){this._d=[],this._str=""},t.prototype.moveTo=function(t,e){this._add("M",t,e)},t.prototype.lineTo=function(t,e){this._add("L",t,e)},t.prototype.bezierCurveTo=function(t,e,n,i,r,o){this._add("C",t,e,n,i,r,o)},t.prototype.quadraticCurveTo=function(t,e,n,i){this._add("Q",t,e,n,i)},t.prototype.arc=function(t,e,n,i,r,o){this.ellipse(t,e,n,n,0,i,r,o)},t.prototype.ellipse=function(t,e,n,i,r,o,a,s){var l=0===this._d.length,u=a-o,c=!s,h=Math.abs(u),d=DWt(h-CWt)||(c?u>=CWt:-u>=CWt),p=u>0?u%CWt:u%CWt+CWt,f=!1;f=!!d||!DWt(h)&&p>=SWt==!!c;var g=MWt(t+n*kWt(o)),m=MWt(e+i*_Wt(o));d&&(u=c?CWt-1e-4:1e-4-CWt,f=!0,l&&this._d.push("M",g,m));var y=MWt(t+n*kWt(o+u)),v=MWt(e+i*_Wt(o+u));if(isNaN(g)||isNaN(m)||isNaN(n)||isNaN(i)||isNaN(r)||isNaN(AWt)||isNaN(y)||isNaN(v))return"";this._d.push("A",MWt(n),MWt(i),wWt(r*AWt),+f,+c,y,v)},t.prototype.rect=function(t,e,n,i){this._add("M",t,e),this._add("L",t+n,e),this._add("L",t+n,e+i),this._add("L",t,e+i),this._add("L",t,e)},t.prototype.closePath=function(){this._d.length>0&&this._add("Z")},t.prototype._add=function(t,e,n,i,r,o,a,s,l){this._d.push(t);for(var u=1;u<arguments.length;u++){var c=arguments[u];if(isNaN(c))return void(this._invalid=!0);this._d.push(MWt(c))}},t.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(" "),this._d=[]},t.prototype.getStr=function(){return this._str},t}(),FWt={brush:function(t){var e=t.style,n=t.__svgEl;n||(n=mWt("path"),t.__svgEl=n),t.path||t.createPathProxy();var i=t.path;t.shapeChanged()&&(i.beginPath(),t.buildPath(i,t.shape),t.pathUpdated());var r=i.getVersion(),o=t,a=o.__svgPathBuilder;(o.__svgPathVersion!==r||!a||t.style.strokePercent<1)&&(a||(a=o.__svgPathBuilder=new OWt),a.reset(),i.rebuildPath(a,t.style.strokePercent),a.generateStr(),o.__svgPathVersion=r),EWt(n,"d",a.getStr()),NWt(n,e,t),TWt(n,t.transform)}},RWt={brush:function(t){var e=t.style,n=e.image;if(n instanceof HTMLImageElement?n=n.src:n instanceof HTMLCanvasElement&&(n=n.toDataURL()),n){var i=e.x||0,r=e.y||0,o=e.width,a=e.height,s=t.__svgEl;s||(s=mWt("image"),t.__svgEl=s),n!==t.__imageSrc&&(!function(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}(s,"href",n),t.__imageSrc=n),EWt(s,"width",o+""),EWt(s,"height",a+""),EWt(s,"x",i+""),EWt(s,"y",r+""),NWt(s,e,t),TWt(s,t.transform)}}},LWt={left:"start",right:"end",center:"middle",middle:"middle"};var $Wt={brush:function(t){var e=t.style,n=e.text;if(null!=n&&(n+=""),n&&!isNaN(e.x)&&!isNaN(e.y)){var i=t.__svgEl;i||(function(t,e,n){t.setAttributeNS("http://www.w3.org/XML/1998/namespace",e,n)}(i=mWt("text"),"xml:space","preserve"),t.__svgEl=i);var r=e.font||BCt;i.style.font=r,i.textContent=n,NWt(i,e,t),TWt(i,t.transform);var o=e.x||0,a=function(t,e,n){return"top"===n?t+=e/2:"bottom"===n&&(t-=e/2),t}(e.y||0,qCt(r),e.textBaseline),s=LWt[e.textAlign]||e.textAlign;EWt(i,"dominant-baseline","central"),EWt(i,"text-anchor",s),EWt(i,"x",o+""),EWt(i,"y",a+"")}}},PWt=function(){function t(t,e,n,i,r){this.nextId=0,this._domName="_dom",this.createElement=mWt,this._zrId=t,this._svgRoot=e,this._tagNames="string"==typeof n?[n]:n,this._markLabel=i,r&&(this._domName=r)}return t.prototype.getDefs=function(t){var e=this._svgRoot,n=this._svgRoot.getElementsByTagName("defs");if(0===n.length){if(t){var i=e.insertBefore(this.createElement("defs"),e.firstChild);return i.contains||(i.contains=function(t){var e=i.children;if(!e)return!1;for(var n=e.length-1;n>=0;--n)if(e[n]===t)return!0;return!1}),i}return null}return n[0]},t.prototype.doUpdate=function(t,e){if(t){var n=this.getDefs(!1);if(t[this._domName]&&n.contains(t[this._domName]))"function"==typeof e&&e(t);else{var i=this.add(t);i&&(t[this._domName]=i)}}},t.prototype.add=function(t){return null},t.prototype.addDom=function(t){var e=this.getDefs(!0);t.parentNode!==e&&e.appendChild(t)},t.prototype.removeDom=function(t){var e=this.getDefs(!1);e&&t[this._domName]&&(e.removeChild(t[this._domName]),t[this._domName]=null)},t.prototype.getDoms=function(){var t=this.getDefs(!1);if(!t)return[];var e=[];return S_t(this._tagNames,(function(n){for(var i=t.getElementsByTagName(n),r=0;r<i.length;r++)e.push(i[r])})),e},t.prototype.markAllUnused=function(){var t=this.getDoms(),e=this;S_t(t,(function(t){t[e._markLabel]="0"}))},t.prototype.markDomUsed=function(t){t&&(t[this._markLabel]="1")},t.prototype.markDomUnused=function(t){t&&(t[this._markLabel]="0")},t.prototype.isDomUnused=function(t){return t&&"1"!==t[this._markLabel]},t.prototype.removeUnused=function(){var t=this,e=this.getDefs(!1);e&&S_t(this.getDoms(),(function(n){t.isDomUnused(n)&&e.removeChild(n)}))},t.prototype.getSvgProxy=function(t){return t instanceof rDt?FWt:t instanceof uDt?RWt:t instanceof aDt?$Wt:FWt},t.prototype.getSvgElement=function(t){return t.__svgEl},t}();function zWt(t){return"linear"===t.type}function BWt(t){return"radial"===t.type}function VWt(t){return t&&("linear"===t.type||"radial"===t.type)}var WWt=function(t){function e(e,n){return t.call(this,e,n,["linearGradient","radialGradient"],"__gradient_in_use__")||this}return Dit(e,t),e.prototype.addWithoutUpdate=function(t,e){if(e&&e.style){var n=this;S_t(["fill","stroke"],(function(i){var r=e.style[i];if(VWt(r)){var o=r,a=n.getDefs(!0),s=void 0;o.__dom?(s=o.__dom,a.contains(o.__dom)||n.addDom(s)):s=n.add(o),n.markUsed(e);var l=s.getAttribute("id");t.setAttribute(i,"url(#"+l+")")}}))}},e.prototype.add=function(t){var e;if(zWt(t))e=this.createElement("linearGradient");else{if(!BWt(t))return f_t("Illegal gradient type."),null;e=this.createElement("radialGradient")}return t.id=t.id||this.nextId++,e.setAttribute("id","zr"+this._zrId+"-gradient-"+t.id),this.updateDom(t,e),this.addDom(e),e},e.prototype.update=function(t){if(VWt(t)){var e=this;this.doUpdate(t,(function(){var n=t.__dom;if(n){var i=n.tagName,r=t.type;"linear"===r&&"linearGradient"===i||"radial"===r&&"radialGradient"===i?e.updateDom(t,t.__dom):(e.removeDom(t),e.add(t))}}))}},e.prototype.updateDom=function(t,e){if(zWt(t))e.setAttribute("x1",t.x+""),e.setAttribute("y1",t.y+""),e.setAttribute("x2",t.x2+""),e.setAttribute("y2",t.y2+"");else{if(!BWt(t))return void f_t("Illegal gradient type.");e.setAttribute("cx",t.x+""),e.setAttribute("cy",t.y+""),e.setAttribute("r",t.r+"")}t.global?e.setAttribute("gradientUnits","userSpaceOnUse"):e.setAttribute("gradientUnits","objectBoundingBox"),e.innerHTML="";for(var n=t.colorStops,i=0,r=n.length;i<r;++i){var o=this.createElement("stop");o.setAttribute("offset",100*n[i].offset+"%");var a=n[i].color;if(a.indexOf("rgba")>-1){var s=_St(a)[3],l=CSt(a);o.setAttribute("stop-color","#"+l),o.setAttribute("stop-opacity",s+"")}else o.setAttribute("stop-color",n[i].color);e.appendChild(o)}t.__dom=e},e.prototype.markUsed=function(e){if(e.style){var n=e.style.fill;n&&n.__dom&&t.prototype.markDomUsed.call(this,n.__dom),(n=e.style.stroke)&&n.__dom&&t.prototype.markDomUsed.call(this,n.__dom)}},e}(PWt);function jWt(t){return t&&(!!t.image||!!t.svgElement)}var UWt=new R$t,GWt=function(t){function e(e,n){return t.call(this,e,n,["pattern"],"__pattern_in_use__")||this}return Dit(e,t),e.prototype.addWithoutUpdate=function(t,e){if(e&&e.style){var n=this;S_t(["fill","stroke"],(function(i){var r=e.style[i];if(jWt(r)){var o=n.getDefs(!0),a=UWt.get(r);a?o.contains(a)||n.addDom(a):a=n.add(r),n.markUsed(e);var s=a.getAttribute("id");t.setAttribute(i,"url(#"+s+")")}}))}},e.prototype.add=function(t){if(jWt(t)){var e=this.createElement("pattern");return t.id=null==t.id?this.nextId++:t.id,e.setAttribute("id","zr"+this._zrId+"-pattern-"+t.id),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("patternUnits","userSpaceOnUse"),this.updateDom(t,e),this.addDom(e),e}},e.prototype.update=function(t){if(jWt(t)){var e=this;this.doUpdate(t,(function(){var n=UWt.get(t);e.updateDom(t,n)}))}},e.prototype.updateDom=function(t,e){var n=t.svgElement;if(n instanceof SVGElement)n.parentNode!==e&&(e.innerHTML="",e.appendChild(n),e.setAttribute("width",t.svgWidth+""),e.setAttribute("height",t.svgHeight+""));else{var i=void 0,r=e.getElementsByTagName("image");if(r.length){if(!t.image)return void e.removeChild(r[0]);i=r[0]}else t.image&&(i=this.createElement("image"));if(i){var o=void 0,a=t.image;if("string"==typeof a?o=a:a instanceof HTMLImageElement?o=a.src:a instanceof HTMLCanvasElement&&(o=a.toDataURL()),o){i.setAttribute("href",o),i.setAttribute("x","0"),i.setAttribute("y","0");var s=pIt(o,i,{dirty:function(){}},(function(t){e.setAttribute("width",t.width+""),e.setAttribute("height",t.height+"")}));s&&s.width&&s.height&&(e.setAttribute("width",s.width+""),e.setAttribute("height",s.height+"")),e.appendChild(i)}}}var l="translate("+(t.x||0)+", "+(t.y||0)+") rotate("+(t.rotation||0)/Math.PI*180+") scale("+(t.scaleX||1)+", "+(t.scaleY||1)+")";e.setAttribute("patternTransform",l),UWt.set(t,e)},e.prototype.markUsed=function(e){e.style&&(jWt(e.style.fill)&&t.prototype.markDomUsed.call(this,UWt.get(e.style.fill)),jWt(e.style.stroke)&&t.prototype.markDomUsed.call(this,UWt.get(e.style.stroke)))},e}(PWt);function HWt(t){var e=t.__clipPaths;return e&&e.length>0}var qWt=function(t){function e(e,n){var i=t.call(this,e,n,"clipPath","__clippath_in_use__")||this;return i._refGroups={},i._keyDuplicateCount={},i}return Dit(e,t),e.prototype.markAllUnused=function(){for(var e in t.prototype.markAllUnused.call(this),this._refGroups)this.markDomUnused(this._refGroups[e]);this._keyDuplicateCount={}},e.prototype._getClipPathGroup=function(t,e){if(HWt(t)){var n=t.__clipPaths,i=this._keyDuplicateCount,r=function(t){var e=[];if(t)for(var n=0;n<t.length;n++){var i=t[n];e.push(i.id)}return e.join(",")}(n);return H$t(n,e&&e.__clipPaths)&&(i[r]=i[r]||0,i[r]&&(r+="-"+i[r]),i[r]++),this._refGroups[r]||(this._refGroups[r]=this.createElement("g"))}},e.prototype.update=function(t,e){var n=this._getClipPathGroup(t,e);return n&&(this.markDomUsed(n),this.updateDom(n,t.__clipPaths)),n},e.prototype.updateDom=function(t,e){if(e&&e.length>0){var n=this.getDefs(!0),i=e[0],r=void 0,o=void 0;i._dom?(o=i._dom.getAttribute("id"),r=i._dom,n.contains(r)||n.appendChild(r)):(o="zr"+this._zrId+"-clip-"+this.nextId,++this.nextId,(r=this.createElement("clipPath")).setAttribute("id",o),n.appendChild(r),i._dom=r),this.getSvgProxy(i).brush(i);var a=this.getSvgElement(i);r.innerHTML="",r.appendChild(a),t.setAttribute("clip-path","url(#"+o+")"),e.length>1&&this.updateDom(r,e.slice(1))}else t&&t.setAttribute("clip-path","none")},e.prototype.markUsed=function(e){var n=this;e.__clipPaths&&S_t(e.__clipPaths,(function(e){e._dom&&t.prototype.markDomUsed.call(n,e._dom)}))},e.prototype.removeUnused=function(){t.prototype.removeUnused.call(this);var e={};for(var n in this._refGroups){var i=this._refGroups[n];this.isDomUnused(i)?i.parentNode&&i.parentNode.removeChild(i):e[n]=i}this._refGroups=e},e}(PWt),XWt=function(t){function e(e,n){var i=t.call(this,e,n,["filter"],"__filter_in_use__","_shadowDom")||this;return i._shadowDomMap={},i._shadowDomPool=[],i}return Dit(e,t),e.prototype._getFromPool=function(){var t=this._shadowDomPool.pop();if(!t){(t=this.createElement("filter")).setAttribute("id","zr"+this._zrId+"-shadow-"+this.nextId++);var e=this.createElement("feDropShadow");t.appendChild(e),this.addDom(t)}return t},e.prototype.update=function(t,e){if(function(t){return t&&(t.shadowBlur||t.shadowOffsetX||t.shadowOffsetY)}(e.style)){var n=function(t){var e=t.style,n=t.getGlobalScale();return[e.shadowColor,(e.shadowBlur||0).toFixed(2),(e.shadowOffsetX||0).toFixed(2),(e.shadowOffsetY||0).toFixed(2),n[0],n[1]].join(",")}(e),i=e._shadowDom=this._shadowDomMap[n];i||(i=this._getFromPool(),this._shadowDomMap[n]=i),this.updateDom(t,e,i)}else this.remove(t,e)},e.prototype.remove=function(t,e){null!=e._shadowDom&&(e._shadowDom=null,t.style.filter="")},e.prototype.updateDom=function(t,e,n){var i=n.children[0],r=e.style,o=e.getGlobalScale(),a=o[0],s=o[1];if(a&&s){var l=r.shadowOffsetX||0,u=r.shadowOffsetY||0,c=r.shadowBlur,h=r.shadowColor;i.setAttribute("dx",l/a+""),i.setAttribute("dy",u/s+""),i.setAttribute("flood-color",h);var d=c/2/a+" "+c/2/s;i.setAttribute("stdDeviation",d),n.setAttribute("x","-100%"),n.setAttribute("y","-100%"),n.setAttribute("width","300%"),n.setAttribute("height","300%"),e._shadowDom=n;var p=n.getAttribute("id");t.style.filter="url(#"+p+")"}},e.prototype.removeUnused=function(){if(this.getDefs(!1)){var t=this._shadowDomPool;for(var e in this._shadowDomMap){var n=this._shadowDomMap[e];t.push(n)}this._shadowDomMap={}}},e}(PWt);function YWt(t){return parseInt(t,10)}function KWt(t){return t instanceof rDt?FWt:t instanceof uDt?RWt:t instanceof aDt?$Wt:FWt}function ZWt(t,e){return e&&t&&e.parentNode!==t}function JWt(t,e,n){if(ZWt(t,e)&&n){var i=n.nextSibling;i?t.insertBefore(e,i):t.appendChild(e)}}function QWt(t,e){if(ZWt(t,e)){var n=t.firstChild;n?t.insertBefore(e,n):t.appendChild(e)}}function tjt(t,e){e&&t&&e.parentNode===t&&t.removeChild(e)}function ejt(t){return t.__svgEl}var njt=function(){function t(t,e,n,i){this.type="svg",this.refreshHover=ijt("refreshHover"),this.pathToImage=ijt("pathToImage"),this.configLayer=ijt("configLayer"),this.root=t,this.storage=e,this._opts=n=v_t({},n||{});var r=mWt("svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttribute("version","1.1"),r.setAttribute("baseProfile","full"),r.style.cssText="user-select:none;position:absolute;left:0;top:0;";var o=mWt("g");r.appendChild(o);var a=mWt("g");r.appendChild(a),this._gradientManager=new WWt(i,a),this._patternManager=new GWt(i,a),this._clipPathManager=new qWt(i,a),this._shadowManager=new XWt(i,a);var s=document.createElement("div");s.style.cssText="overflow:hidden;position:relative",this._svgDom=r,this._svgRoot=a,this._backgroundRoot=o,this._viewport=s,t.appendChild(s),s.appendChild(r),this.resize(n.width,n.height),this._visibleList=[]}return t.prototype.getType=function(){return"svg"},t.prototype.getViewportRoot=function(){return this._viewport},t.prototype.getSvgDom=function(){return this._svgDom},t.prototype.getSvgRoot=function(){return this._svgRoot},t.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},t.prototype.refresh=function(){var t=this.storage.getDisplayList(!0);this._paintList(t)},t.prototype.setBackgroundColor=function(t){this._backgroundRoot&&this._backgroundNode&&this._backgroundRoot.removeChild(this._backgroundNode);var e=mWt("rect");e.setAttribute("width",this.getWidth()),e.setAttribute("height",this.getHeight()),e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("id",0),e.style.fill=t,this._backgroundRoot.appendChild(e),this._backgroundNode=e},t.prototype.createSVGElement=function(t){return mWt(t)},t.prototype.paintOne=function(t){var e=KWt(t);return e&&e.brush(t),ejt(t)},t.prototype._paintList=function(t){var e=this._gradientManager,n=this._patternManager,i=this._clipPathManager,r=this._shadowManager;e.markAllUnused(),n.markAllUnused(),i.markAllUnused(),r.markAllUnused();for(var o=this._svgRoot,a=this._visibleList,s=t.length,l=[],u=0;u<s;u++){var c=KWt(b=t[u]),h=ejt(b);b.invisible||(!b.__dirty&&h||(c&&c.brush(b),(h=ejt(b))&&b.style&&(e.update(b.style.fill),e.update(b.style.stroke),n.update(b.style.fill),n.update(b.style.stroke),r.update(h,b)),b.__dirty=0),h&&l.push(b))}var d,p,f,g,m,y=bWt(a,l);for(u=0;u<y.length;u++){if((x=y[u]).removed)for(var v=0;v<x.count;v++){h=ejt(b=a[x.indices[v]]);HWt(b)?(f=h)&&f.parentNode&&f.parentNode.removeChild(f):tjt(o,h)}}for(u=0;u<y.length;u++){var x;if(!(x=y[u]).removed)for(v=0;v<x.count;v++){var b=l[x.indices[v]],w=i.update(b,g);w!==m&&(d=p,w&&(d?JWt(o,w,d):QWt(o,w),p=w,d=null),m=w);h=ejt(b);d?JWt(m||o,h,d):QWt(m||o,h),d=h||d,m||(p=d),e.markUsed(b),e.addWithoutUpdate(h,b),n.markUsed(b),n.addWithoutUpdate(h,b),i.markUsed(b),g=b}}e.removeUnused(),n.removeUnused(),i.removeUnused(),r.removeUnused(),this._visibleList=l},t.prototype.resize=function(t,e){var n=this._viewport;n.style.display="none";var i=this._opts;if(null!=t&&(i.width=t),null!=e&&(i.height=e),t=this._getSize(0),e=this._getSize(1),n.style.display="",this._width!==t||this._height!==e){this._width=t,this._height=e;var r=n.style;r.width=t+"px",r.height=e+"px";var o=this._svgDom;o.setAttribute("width",t+""),o.setAttribute("height",e+"")}this._backgroundNode&&(this._backgroundNode.setAttribute("width",t),this._backgroundNode.setAttribute("height",e))},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype._getSize=function(t){var e=this._opts,n=["width","height"][t],i=["clientWidth","clientHeight"][t],r=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];if(null!=e[n]&&"auto"!==e[n])return parseFloat(e[n]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[i]||YWt(s[n])||YWt(a.style[n]))-(YWt(s[r])||0)-(YWt(s[o])||0)|0},t.prototype.dispose=function(){this.root.innerHTML="",this._svgRoot=this._backgroundRoot=this._svgDom=this._backgroundNode=this._viewport=this.storage=null},t.prototype.clear=function(){var t=this._viewport;t&&t.parentNode&&t.parentNode.removeChild(t)},t.prototype.toDataURL=function(){this.refresh();var t=this._svgDom,e=t.outerHTML||(t.parentNode&&t.parentNode).innerHTML;return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(e.replace(/></g,">\n\r<"))},t}();function ijt(t){return function(){f_t('In SVG mode painter not support method "'+t+'"')}}function rjt(){return!1}function ojt(t,e,n){var i=b_t(),r=e.getWidth(),o=e.getHeight(),a=i.style;return a&&(a.position="absolute",a.left="0",a.top="0",a.width=r+"px",a.height=o+"px",i.setAttribute("data-zr-dom-id",t)),i.width=r*n,i.height=o*n,i}var ajt=function(t){function e(e,n,i){var r,o=t.call(this)||this;o.motionBlur=!1,o.lastFrameAlpha=.7,o.dpr=1,o.virtual=!1,o.config={},o.incremental=!1,o.zlevel=0,o.maxRepaintRectCount=5,o.__dirty=!0,o.__firstTimePaint=!0,o.__used=!1,o.__drawIndex=0,o.__startIndex=0,o.__endIndex=0,o.__prevStartIndex=null,o.__prevEndIndex=null,i=i||dCt,"string"==typeof e?r=ojt(e,n,i):L_t(e)&&(e=(r=e).id),o.id=e,o.dom=r;var a=r.style;return a&&(r.onselectstart=rjt,a.webkitUserSelect="none",a.userSelect="none",a.webkitTapHighlightColor="rgba(0,0,0,0)",a["-webkit-touch-callout"]="none",a.padding="0",a.margin="0",a.borderWidth="0"),o.domBack=null,o.ctxBack=null,o.painter=n,o.config=null,o.dpr=i,o}return Dit(e,t),e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},e.prototype.setUnpainted=function(){this.__firstTimePaint=!0},e.prototype.createBackBuffer=function(){var t=this.dpr;this.domBack=ojt("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),1!==t&&this.ctxBack.scale(t,t)},e.prototype.createRepaintRects=function(t,e,n,i){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var r,o=[],a=this.maxRepaintRectCount,s=!1,l=new PCt(0,0,0,0);function u(t){if(t.isFinite()&&!t.isZero())if(0===o.length){(e=new PCt(0,0,0,0)).copy(t),o.push(e)}else{for(var e,n=!1,i=1/0,r=0,u=0;u<o.length;++u){var c=o[u];if(c.intersect(t)){var h=new PCt(0,0,0,0);h.copy(c),h.union(t),o[u]=h,n=!0;break}if(s){l.copy(t),l.union(c);var d=t.width*t.height,p=c.width*c.height,f=l.width*l.height-d-p;f<i&&(i=f,r=u)}}if(s&&(o[r].union(t),n=!0),!n)(e=new PCt(0,0,0,0)).copy(t),o.push(e);s||(s=o.length>=a)}}for(var c=this.__startIndex;c<this.__endIndex;++c){if(p=t[c]){var h=p.shouldBePainted(n,i,!0,!0);(f=p.__isRendered&&(1&p.__dirty||!h)?p.getPrevPaintRect():null)&&u(f);var d=h&&(1&p.__dirty||!p.__isRendered)?p.getPaintRect():null;d&&u(d)}}for(c=this.__prevStartIndex;c<this.__prevEndIndex;++c){var p,f;h=(p=e[c]).shouldBePainted(n,i,!0,!0);if(p&&(!h||!p.__zr)&&p.__isRendered)(f=p.getPrevPaintRect())&&u(f)}do{r=!1;for(c=0;c<o.length;)if(o[c].isZero())o.splice(c,1);else{for(var g=c+1;g<o.length;)o[c].intersect(o[g])?(r=!0,o[c].union(o[g]),o.splice(g,1)):g++;c++}}while(r);return this._paintRects=o,o},e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},e.prototype.resize=function(t,e){var n=this.dpr,i=this.dom,r=i.style,o=this.domBack;r&&(r.width=t+"px",r.height=e+"px"),i.width=t*n,i.height=e*n,o&&(o.width=t*n,o.height=e*n,1!==n&&this.ctxBack.scale(n,n))},e.prototype.clear=function(t,e,n){var i=this.dom,r=this.ctx,o=i.width,a=i.height;e=e||this.clearColor;var s=this.motionBlur&&!t,l=this.lastFrameAlpha,u=this.dpr,c=this;s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(i,0,0,o/u,a/u));var h=this.domBack;function d(t,n,i,o){if(r.clearRect(t,n,i,o),e&&"transparent"!==e){var a=void 0;null!=e.colorStops?(a=e.__canvasGradient||G$t(r,e,{x:0,y:0,width:i,height:o}),e.__canvasGradient=a):function(t){return null!=t.image}(e)&&(a=Q$t(r,e,{dirty:function(){c.setUnpainted(),c.__painter.refresh()}})),r.save(),r.fillStyle=a||e,r.fillRect(t,n,i,o),r.restore()}s&&(r.save(),r.globalAlpha=l,r.drawImage(h,t,n,i,o),r.restore())}!n||s?d(0,0,o,a):n.length&&S_t(n,(function(t){d(t.x*u,t.y*u,t.width*u,t.height*u)}))},e}(bkt);function sjt(t){return parseInt(t,10)}var ljt=function(){function t(t,e,n,i){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var r=!t.nodeName||"CANVAS"===t.nodeName.toUpperCase();this._opts=n=v_t({},n||{}),this.dpr=n.devicePixelRatio||dCt,this._singleCanvas=r,this.root=t;var o=t.style;o&&(o.webkitTapHighlightColor="transparent",o.webkitUserSelect="none",o.userSelect="none",o["-webkit-touch-callout"]="none",t.innerHTML=""),this.storage=e;var a=this._zlevelList;this._prevDisplayList=[];var s=this._layers;if(r){var l=t,u=l.width,c=l.height;null!=n.width&&(u=n.width),null!=n.height&&(c=n.height),this.dpr=n.devicePixelRatio||1,l.width=u*this.dpr,l.height=c*this.dpr,this._width=u,this._height=c;var h=new ajt(l,this,this.dpr);h.__builtin__=!0,h.initContext(),s[314159]=h,h.zlevel=314159,a.push(314159),this._domRoot=t}else{this._width=this._getSize(0),this._height=this._getSize(1);var d=this._domRoot=function(t,e){var n=document.createElement("div");return n.style.cssText=["position:relative","width:"+t+"px","height:"+e+"px","padding:0","margin:0","border-width:0"].join(";")+";",n}(this._width,this._height);t.appendChild(d)}}return t.prototype.getType=function(){return"canvas"},t.prototype.isSingleCanvas=function(){return this._singleCanvas},t.prototype.getViewportRoot=function(){return this._domRoot},t.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},t.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),n=this._prevDisplayList,i=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,n,t,this._redrawId);for(var r=0;r<i.length;r++){var o=i[r],a=this._layers[o];if(!a.__builtin__&&a.refresh){var s=0===r?this._backgroundColor:null;a.refresh(s)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},t.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},t.prototype._paintHoverList=function(t){var e=t.length,n=this._hoverlayer;if(n&&n.clear(),e){for(var i,r={inHover:!0,viewWidth:this._width,viewHeight:this._height},o=0;o<e;o++){var a=t[o];a.__inHover&&(n||(n=this._hoverlayer=this.getLayer(1e5)),i||(i=n.ctx).save(),lPt(i,a,r,o===e-1))}i&&i.restore()}},t.prototype.getHoverLayer=function(){return this.getLayer(1e5)},t.prototype.paintOne=function(t,e){sPt(t,e)},t.prototype._paintList=function(t,e,n,i){if(this._redrawId===i){n=n||!1,this._updateLayerStatus(t);var r=this._doPaintList(t,e,n),o=r.finished,a=r.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),a&&this._paintHoverList(t),o)this.eachLayer((function(t){t.afterBrush&&t.afterBrush()}));else{var s=this;rSt((function(){s._paintList(t,e,n,i)}))}}},t.prototype._compositeManually=function(){var t=this.getLayer(314159).ctx,e=this._domRoot.width,n=this._domRoot.height;t.clearRect(0,0,e,n),this.eachBuiltinLayer((function(i){i.virtual&&t.drawImage(i.dom,0,0,e,n)}))},t.prototype._doPaintList=function(t,e,n){for(var i=this,r=[],o=this._opts.useDirtyRect,a=0;a<this._zlevelList.length;a++){var s=this._zlevelList[a],l=this._layers[s];l.__builtin__&&l!==this._hoverlayer&&(l.__dirty||n)&&r.push(l)}for(var u=!0,c=!1,h=function(a){var s,l=r[a],h=l.ctx,p=o&&l.createRepaintRects(t,e,d._width,d._height),f=n?l.__startIndex:l.__drawIndex,g=!n&&l.incremental&&Date.now,m=g&&Date.now(),y=l.zlevel===d._zlevelList[0]?d._backgroundColor:null;if(l.__startIndex===l.__endIndex)l.clear(!1,y,p);else if(f===l.__startIndex){var v=t[f];v.incremental&&v.notClear&&!n||l.clear(!1,y,p)}-1===f&&(console.error("For some unknown reason. drawIndex is -1"),f=l.__startIndex);var x=function(e){var n={inHover:!1,allClipped:!1,prevEl:null,viewWidth:i._width,viewHeight:i._height};for(s=f;s<l.__endIndex;s++){var r=t[s];if(r.__inHover&&(c=!0),i._doPaintEl(r,l,o,e,n,s===l.__endIndex-1),g)if(Date.now()-m>15)break}n.prevElClipPaths&&h.restore()};if(p)if(0===p.length)s=l.__endIndex;else for(var b=d.dpr,w=0;w<p.length;++w){var _=p[w];h.save(),h.beginPath(),h.rect(_.x*b,_.y*b,_.width*b,_.height*b),h.clip(),x(_),h.restore()}else h.save(),x(),h.restore();l.__drawIndex=s,l.__drawIndex<l.__endIndex&&(u=!1)},d=this,p=0;p<r.length;p++)h(p);return t_t.wxa&&S_t(this._layers,(function(t){t&&t.ctx&&t.ctx.draw&&t.ctx.draw()})),{finished:u,needsRefreshHover:c}},t.prototype._doPaintEl=function(t,e,n,i,r,o){var a=e.ctx;if(n){var s=t.getPaintRect();(!i||s&&s.intersect(i))&&(lPt(a,t,r,o),t.setPrevPaintRect(s))}else lPt(a,t,r,o)},t.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=314159);var n=this._layers[t];return n||((n=new ajt("zr_"+t,this,this.dpr)).zlevel=t,n.__builtin__=!0,this._layerConfig[t]?m_t(n,this._layerConfig[t],!0):this._layerConfig[t-.01]&&m_t(n,this._layerConfig[t-.01],!0),e&&(n.virtual=e),this.insertLayer(t,n),n.initContext()),n},t.prototype.insertLayer=function(t,e){var n=this._layers,i=this._zlevelList,r=i.length,o=this._domRoot,a=null,s=-1;if(n[t])f_t("ZLevel "+t+" has been used already");else if(function(t){return!!t&&(!!t.__builtin__||"function"==typeof t.resize&&"function"==typeof t.refresh)}(e)){if(r>0&&t>i[0]){for(s=0;s<r-1&&!(i[s]<t&&i[s+1]>t);s++);a=n[i[s]]}if(i.splice(s+1,0,t),n[t]=e,!e.virtual)if(a){var l=a.dom;l.nextSibling?o.insertBefore(e.dom,l.nextSibling):o.appendChild(e.dom)}else o.firstChild?o.insertBefore(e.dom,o.firstChild):o.appendChild(e.dom);e.__painter=this}else f_t("Layer of zlevel "+t+" is not valid")},t.prototype.eachLayer=function(t,e){for(var n=this._zlevelList,i=0;i<n.length;i++){var r=n[i];t.call(e,this._layers[r],r)}},t.prototype.eachBuiltinLayer=function(t,e){for(var n=this._zlevelList,i=0;i<n.length;i++){var r=n[i],o=this._layers[r];o.__builtin__&&t.call(e,o,r)}},t.prototype.eachOtherLayer=function(t,e){for(var n=this._zlevelList,i=0;i<n.length;i++){var r=n[i],o=this._layers[r];o.__builtin__||t.call(e,o,r)}},t.prototype.getLayers=function(){return this._layers},t.prototype._updateLayerStatus=function(t){function e(t){o&&(o.__endIndex!==t&&(o.__dirty=!0),o.__endIndex=t)}if(this.eachBuiltinLayer((function(t,e){t.__dirty=t.__used=!1})),this._singleCanvas)for(var n=1;n<t.length;n++){if((s=t[n]).zlevel!==t[n-1].zlevel||s.incremental){this._needsManuallyCompositing=!0;break}}var i,r,o=null,a=0;for(r=0;r<t.length;r++){var s,l=(s=t[r]).zlevel,u=void 0;i!==l&&(i=l,a=0),s.incremental?((u=this.getLayer(l+.001,this._needsManuallyCompositing)).incremental=!0,a=1):u=this.getLayer(l+(a>0?.01:0),this._needsManuallyCompositing),u.__builtin__||f_t("ZLevel "+l+" has been used by unkown layer "+u.id),u!==o&&(u.__used=!0,u.__startIndex!==r&&(u.__dirty=!0),u.__startIndex=r,u.incremental?u.__drawIndex=-1:u.__drawIndex=r,e(r),o=u),1&s.__dirty&&!s.__inHover&&(u.__dirty=!0,u.incremental&&u.__drawIndex<0&&(u.__drawIndex=r))}e(r),this.eachBuiltinLayer((function(t,e){!t.__used&&t.getElementCount()>0&&(t.__dirty=!0,t.__startIndex=t.__endIndex=t.__drawIndex=0),t.__dirty&&t.__drawIndex<0&&(t.__drawIndex=t.__startIndex)}))},t.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},t.prototype._clearLayer=function(t){t.clear()},t.prototype.setBackgroundColor=function(t){this._backgroundColor=t,S_t(this._layers,(function(t){t.setUnpainted()}))},t.prototype.configLayer=function(t,e){if(e){var n=this._layerConfig;n[t]?m_t(n[t],e,!0):n[t]=e;for(var i=0;i<this._zlevelList.length;i++){var r=this._zlevelList[i];if(r===t||r===t+.01)m_t(this._layers[r],n[t],!0)}}},t.prototype.delLayer=function(t){var e=this._layers,n=this._zlevelList,i=e[t];i&&(i.dom.parentNode.removeChild(i.dom),delete e[t],n.splice(w_t(n,t),1))},t.prototype.resize=function(t,e){if(this._domRoot.style){var n=this._domRoot;n.style.display="none";var i=this._opts;if(null!=t&&(i.width=t),null!=e&&(i.height=e),t=this._getSize(0),e=this._getSize(1),n.style.display="",this._width!==t||e!==this._height){for(var r in n.style.width=t+"px",n.style.height=e+"px",this._layers)this._layers.hasOwnProperty(r)&&this._layers[r].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(null==t||null==e)return;this._width=t,this._height=e,this.getLayer(314159).resize(t,e)}return this},t.prototype.clearLayer=function(t){var e=this._layers[t];e&&e.clear()},t.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},t.prototype.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas&&!this._compositeManually)return this._layers[314159].dom;var e=new ajt("image",this,t.pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var n=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var i=e.dom.width,r=e.dom.height;this.eachLayer((function(t){t.__builtin__?n.drawImage(t.dom,0,0,i,r):t.renderToCanvas&&(n.save(),t.renderToCanvas(n),n.restore())}))}else for(var o={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),s=0,l=a.length;s<l;s++){var u=a[s];lPt(n,u,o,s===l-1)}return e.dom},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype._getSize=function(t){var e=this._opts,n=["width","height"][t],i=["clientWidth","clientHeight"][t],r=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];if(null!=e[n]&&"auto"!==e[n])return parseFloat(e[n]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[i]||sjt(s[n])||sjt(a.style[n]))-(sjt(s[r])||0)-(sjt(s[o])||0)|0},t.prototype.pathToImage=function(t,e){e=e||this.dpr;var n=document.createElement("canvas"),i=n.getContext("2d"),r=t.getBoundingRect(),o=t.style,a=o.shadowBlur*e,s=o.shadowOffsetX*e,l=o.shadowOffsetY*e,u=t.hasStroke()?o.lineWidth:0,c=Math.max(u/2,-s+a),h=Math.max(u/2,s+a),d=Math.max(u/2,-l+a),p=Math.max(u/2,l+a),f=r.width+c+h,g=r.height+d+p;n.width=f*e,n.height=g*e,i.scale(e,e),i.clearRect(0,0,f,g),i.dpr=e;var m={x:t.x,y:t.y,scaleX:t.scaleX,scaleY:t.scaleY,rotation:t.rotation,originX:t.originX,originY:t.originY};t.x=c-r.x,t.y=d-r.y,t.rotation=0,t.scaleX=1,t.scaleY=1,t.updateTransform(),t&&lPt(i,t,{inHover:!1,viewWidth:this._width,viewHeight:this._height},!0);var y=new uDt({style:{x:0,y:0,image:n}});return v_t(t,m),y},t}();var ujt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.hasSymbolVisual=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t){return tVt(this.getSource(),this,{useEncodeDefaulter:!0})},e.prototype.getLegendIcon=function(t){var e=new oAt,n=U$t("line",0,t.itemHeight/2,t.itemWidth,0,t.lineStyle.stroke,!1);e.add(n),n.setStyle(t.lineStyle);var i=this.getData().getVisual("symbol"),r=this.getData().getVisual("symbolRotate"),o="none"===i?"circle":i,a=.8*t.itemHeight,s=U$t(o,(t.itemWidth-a)/2,(t.itemHeight-a)/2,a,a,t.itemStyle.fill);e.add(s),s.setStyle(t.itemStyle);var l="inherit"===t.iconRotate?r:t.iconRotate||0;return s.rotation=l*Math.PI/180,s.setOrigin([t.itemWidth/2,t.itemHeight/2]),o.indexOf("empty")>-1&&(s.style.stroke=s.style.fill,s.style.fill="#fff",s.style.lineWidth=2),e},e.type="series.line",e.dependencies=["grid","polar"],e.defaultOption={zlevel:0,z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0,lineStyle:{width:"bolder"}},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0},e}(XRt);function cjt(t,e){var n=t.mapDimensionsAll("defaultedLabel"),i=n.length;if(1===i){var r=oRt(t,e,n[0]);return null!=r?r+"":null}if(i){for(var o=[],a=0;a<n.length;a++)o.push(oRt(t,e,n[a]));return o.join(" ")}}function hjt(t,e){var n=t.mapDimensionsAll("defaultedLabel");if(!E_t(e))return e+"";for(var i=[],r=0;r<n.length;r++){var o=t.getDimensionInfo(n[r]);o&&i.push(e[o.index])}return i.join(" ")}var djt=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.updateData(e,n,i,r),o}return Dit(e,t),e.prototype._createSymbol=function(t,e,n,i,r){this.removeAll();var o=U$t(t,-1,-1,2,2,null,r);o.attr({z2:100,culling:!0,scaleX:i[0]/2,scaleY:i[1]/2}),o.drift=pjt,this._symbolType=t,this.add(o)},e.prototype.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(null,t)},e.prototype.getSymbolPath=function(){return this.childAt(0)},e.prototype.highlight=function(){KDt(this.childAt(0))},e.prototype.downplay=function(){ZDt(this.childAt(0))},e.prototype.setZ=function(t,e){var n=this.childAt(0);n.zlevel=t,n.z=e},e.prototype.setDraggable=function(t){var e=this.childAt(0);e.draggable=t,e.cursor=t?"move":e.cursor},e.prototype.updateData=function(t,n,i,r){this.silent=!1;var o=t.getItemVisual(n,"symbol")||"circle",a=t.hostModel,s=e.getSymbolSize(t,n),l=o!==this._symbolType,u=r&&r.disableAnimation;if(l){var c=t.getItemVisual(n,"symbolKeepAspect");this._createSymbol(o,t,n,s,c)}else{(d=this.childAt(0)).silent=!1;var h={scaleX:s[0]/2,scaleY:s[1]/2};u?d.attr(h):WEt(d,h,a,n)}if(this._updateCommon(t,n,s,i,r),l){var d=this.childAt(0);if(!u){h={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:d.style.opacity}};d.scaleX=d.scaleY=0,d.style.opacity=0,jEt(d,h,a,n)}}u&&this.childAt(0).stopAnimation("remove"),this._seriesModel=a},e.prototype._updateCommon=function(t,e,n,i,r){var o,a,s,l,u,c,h,d,p=this.childAt(0),f=t.hostModel;if(i&&(o=i.emphasisItemStyle,a=i.blurItemStyle,s=i.selectItemStyle,l=i.focus,u=i.blurScope,c=i.labelStatesModels,h=i.hoverScale,d=i.cursorStyle),!i||t.hasItemOption){var g=i&&i.itemModel?i.itemModel:t.getItemModel(e),m=g.getModel("emphasis");o=m.getModel("itemStyle").getItemStyle(),s=g.getModel(["select","itemStyle"]).getItemStyle(),a=g.getModel(["blur","itemStyle"]).getItemStyle(),l=m.get("focus"),u=m.get("blurScope"),c=cNt(g),h=m.getShallow("scale"),d=g.getShallow("cursor")}var y=t.getItemVisual(e,"symbolRotate");p.attr("rotation",(y||0)*Math.PI/180||0);var v=t.getItemVisual(e,"symbolOffset")||0;v&&(E_t(v)||(v=[v,v]),p.x=dAt(v[0],n[0]),p.y=dAt(W_t(v[1],v[0])||0,n[1])),d&&p.attr("cursor",d);var x=t.getItemVisual(e,"style"),b=x.fill;if(p instanceof uDt){var w=p.style;p.useStyle(v_t({image:w.image,x:w.x,y:w.y,width:w.width,height:w.height},x))}else p.__isEmptyBrush?p.useStyle(v_t({},x)):p.useStyle(x),p.style.decal=null,p.setColor(b,r&&r.symbolInnerColor),p.style.strokeNoScale=!0;var _=t.getItemVisual(e,"liftZ"),k=this._z2;null!=_?null==k&&(this._z2=p.z2,p.z2+=_):null!=k&&(p.z2=k,this._z2=null);var S=r&&r.useNameLabel;uNt(p,c,{labelFetcher:f,labelDataIndex:e,defaultText:function(e){return S?t.getName(e):cjt(t,e)},inheritColor:b,defaultOpacity:x.opacity}),this._sizeX=n[0]/2,this._sizeY=n[1]/2;var C=p.ensureState("emphasis");if(C.style=o,p.ensureState("select").style=s,p.ensureState("blur").style=a,h){var A=Math.max(1.1,3/this._sizeY);C.scaleX=this._sizeX*A,C.scaleY=this._sizeY*A}this.setSymbolScale(1),uTt(this,l,u)},e.prototype.setSymbolScale=function(t){this.scaleX=this.scaleY=t},e.prototype.fadeOut=function(t,e){var n=this.childAt(0),i=this._seriesModel,r=IDt(this).dataIndex,o=e&&e.animation;if(this.silent=n.silent=!0,e&&e.fadeLabel){var a=n.getTextContent();a&&UEt(a,{style:{opacity:0}},i,{dataIndex:r,removeOpt:o,cb:function(){n.removeTextContent()}})}else n.removeTextContent();UEt(n,{style:{opacity:0},scaleX:0,scaleY:0},i,{dataIndex:r,cb:t,removeOpt:o})},e.getSymbolSize=function(t,e){var n=t.getItemVisual(e,"symbolSize");return E_t(n)?n.slice():[+n,+n]},e}(oAt);function pjt(t,e){this.parent.drift(t,e)}function fjt(t,e,n,i){return e&&!isNaN(e[0])&&!isNaN(e[1])&&!(i.isIgnore&&i.isIgnore(n))&&!(i.clipShape&&!i.clipShape.contain(e[0],e[1]))&&"none"!==t.getItemVisual(n,"symbol")}function gjt(t){return null==t||L_t(t)||(t={isIgnore:t}),t||{}}function mjt(t){var e=t.hostModel,n=e.getModel("emphasis");return{emphasisItemStyle:n.getModel("itemStyle").getItemStyle(),blurItemStyle:e.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:e.getModel(["select","itemStyle"]).getItemStyle(),focus:n.get("focus"),blurScope:n.get("blurScope"),hoverScale:n.get("scale"),labelStatesModels:cNt(e),cursorStyle:e.get("cursor")}}var yjt=function(){function t(t){this.group=new oAt,this._SymbolCtor=t||djt}return t.prototype.updateData=function(t,e){e=gjt(e);var n=this.group,i=t.hostModel,r=this._data,o=this._SymbolCtor,a=e.disableAnimation,s=mjt(t),l={disableAnimation:a},u=e.getSymbolPoint||function(e){return t.getItemLayout(e)};r||n.removeAll(),t.diff(r).add((function(i){var r=u(i);if(fjt(t,r,i,e)){var a=new o(t,i,s,l);a.setPosition(r),t.setItemGraphicEl(i,a),n.add(a)}})).update((function(c,h){var d=r.getItemGraphicEl(h),p=u(c);if(fjt(t,p,c,e)){if(d){d.updateData(t,c,s,l);var f={x:p[0],y:p[1]};a?d.attr(f):WEt(d,f,i)}else(d=new o(t,c)).setPosition(p);n.add(d),t.setItemGraphicEl(c,d)}else n.remove(d)})).remove((function(t){var e=r.getItemGraphicEl(t);e&&e.fadeOut((function(){n.remove(e)}))})).execute(),this._getSymbolPoint=u,this._data=t},t.prototype.isPersistent=function(){return!0},t.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl((function(e,n){var i=t._getSymbolPoint(n);e.setPosition(i),e.markRedraw()}))},t.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=mjt(t),this._data=null,this.group.removeAll()},t.prototype.incrementalUpdate=function(t,e,n){function i(t){t.isGroup||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}n=gjt(n);for(var r=t.start;r<t.end;r++){var o=e.getItemLayout(r);if(fjt(e,o,r,n)){var a=new this._SymbolCtor(e,r,this._seriesScope);a.traverse(i),a.setPosition(o),this.group.add(a),e.setItemGraphicEl(r,a)}}},t.prototype.remove=function(t){var e=this.group,n=this._data;n&&t?n.eachItemGraphicEl((function(t){t.fadeOut((function(){e.remove(t)}))})):e.removeAll()},t}();function vjt(t,e,n){var i=t.getBaseAxis(),r=t.getOtherAxis(i),o=function(t,e){var n=0,i=t.scale.getExtent();"start"===e?n=i[0]:"end"===e?n=i[1]:i[0]>0?n=i[0]:i[1]<0&&(n=i[1]);return n}(r,n),a=i.dim,s=r.dim,l=e.mapDimension(s),u=e.mapDimension(a),c="x"===s||"radius"===s?1:0,h=C_t(t.dimensions,(function(t){return e.mapDimension(t)})),d=!1,p=e.getCalculationInfo("stackResultDimension");return JBt(e,h[0])&&(d=!0,h[0]=p),JBt(e,h[1])&&(d=!0,h[1]=p),{dataDimsForPoint:h,valueStart:o,valueAxisDim:s,baseAxisDim:a,stacked:!!d,valueDim:l,baseDim:u,baseDataOffset:c,stackedOverDimension:e.getCalculationInfo("stackedOverDimension")}}function xjt(t,e,n,i){var r=NaN;t.stacked&&(r=n.get(n.getCalculationInfo("stackedOverDimension"),i)),isNaN(r)&&(r=t.valueStart);var o=t.baseDataOffset,a=[];return a[o]=n.get(t.baseDim,i),a[1-o]=r,e.dataToPoint(a)}var bjt="undefined"!=typeof Float32Array,wjt=bjt?Float32Array:Array;function _jt(t){return E_t(t)?bjt?new Float32Array(t):t:new wjt(t)}var kjt=Math.min,Sjt=Math.max;function Cjt(t,e){return isNaN(t)||isNaN(e)}function Ajt(t,e,n,i,r,o,a,s,l){for(var u,c,h,d,p,f,g=n,m=0;m<i;m++){var y=e[2*g],v=e[2*g+1];if(g>=r||g<0)break;if(Cjt(y,v)){if(l){g+=o;continue}break}if(g===n)t[o>0?"moveTo":"lineTo"](y,v),h=y,d=v;else{var x=y-u,b=v-c;if(x*x+b*b<.5){g+=o;continue}if(a>0){var w=g+o,_=e[2*w],k=e[2*w+1],S=m+1;if(l)for(;Cjt(_,k)&&S<i;)S++,_=e[2*(w+=o)],k=e[2*w+1];var C=.5,A=0,I=0,M=void 0,D=void 0;if(S>=i||Cjt(_,k))p=y,f=v;else{A=_-u,I=k-c;var T=y-u,E=_-y,N=v-c,O=k-v,F=void 0,R=void 0;"x"===s?(F=Math.abs(T),R=Math.abs(E),p=y-F*a,f=v,M=y+F*a,D=v):"y"===s?(F=Math.abs(N),R=Math.abs(O),p=y,f=v-F*a,M=y,D=v+F*a):(F=Math.sqrt(T*T+N*N),p=y-A*a*(1-(C=(R=Math.sqrt(E*E+O*O))/(R+F))),f=v-I*a*(1-C),D=v+I*a*C,M=kjt(M=y+A*a*C,Sjt(_,y)),D=kjt(D,Sjt(k,v)),M=Sjt(M,kjt(_,y)),f=v-(I=(D=Sjt(D,kjt(k,v)))-v)*F/R,p=kjt(p=y-(A=M-y)*F/R,Sjt(u,y)),f=kjt(f,Sjt(c,v)),M=y+(A=y-(p=Sjt(p,kjt(u,y))))*R/F,D=v+(I=v-(f=Sjt(f,kjt(c,v))))*R/F)}t.bezierCurveTo(h,d,p,f,y,v),h=M,d=D}else t.lineTo(y,v)}u=y,c=v,g+=o}return m}var Ijt=function(){this.smooth=0,this.smoothConstraint=!0},Mjt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="ec-polyline",n}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Ijt},e.prototype.buildPath=function(t,e){var n=e.points,i=0,r=n.length/2;if(e.connectNulls){for(;r>0&&Cjt(n[2*r-2],n[2*r-1]);r--);for(;i<r&&Cjt(n[2*i],n[2*i+1]);i++);}for(;i<r;)i+=Ajt(t,n,i,r,r,1,e.smooth,e.smoothMonotone,e.connectNulls)+1},e.prototype.getPointOn=function(t,e){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n,i,r=this.path.data,o=PMt.CMD,a="x"===e,s=[],l=0;l<r.length;){var u=void 0,c=void 0,h=void 0,d=void 0,p=void 0,f=void 0,g=void 0;switch(r[l++]){case o.M:n=r[l++],i=r[l++];break;case o.L:if(u=r[l++],c=r[l++],(g=a?(t-n)/(u-n):(t-i)/(c-i))<=1&&g>=0){var m=a?(c-i)*g+i:(u-n)*g+n;return a?[t,m]:[m,t]}n=u,i=c;break;case o.C:u=r[l++],c=r[l++],h=r[l++],d=r[l++],p=r[l++],f=r[l++];var y=a?qIt(n,u,h,p,t,s):qIt(i,c,d,f,t,s);if(y>0)for(var v=0;v<y;v++){var x=s[v];if(x<=1&&x>=0){m=a?GIt(i,c,d,f,x):GIt(n,u,h,p,x);return a?[t,m]:[m,t]}}n=p,i=f}}},e}(rDt),Djt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e}(Ijt),Tjt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="ec-polygon",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new Djt},e.prototype.buildPath=function(t,e){var n=e.points,i=e.stackedOnPoints,r=0,o=n.length/2,a=e.smoothMonotone;if(e.connectNulls){for(;o>0&&Cjt(n[2*o-2],n[2*o-1]);o--);for(;r<o&&Cjt(n[2*r],n[2*r+1]);r++);}for(;r<o;){var s=Ajt(t,n,r,o,o,1,e.smooth,a,e.connectNulls);Ajt(t,i,r+s-1,s,o,-1,e.stackedOnSmooth,a,e.connectNulls),r+=s+1,t.closePath()}},e}(rDt);function Ejt(t,e,n,i,r){var o=t.getArea(),a=o.x,s=o.y,l=o.width,u=o.height,c=n.get(["lineStyle","width"])||2;a-=c/2,s-=c/2,l+=c,u+=c,a=Math.floor(a),l=Math.round(l);var h=new mDt({shape:{x:a,y:s,width:l,height:u}});if(e){var d=t.getBaseAxis(),p=d.isHorizontal(),f=d.inverse;p?(f&&(h.shape.x+=l),h.shape.width=0):(f||(h.shape.y+=u),h.shape.height=0),jEt(h,{shape:{width:l,height:u,x:a,y:s}},n,null,i,"function"==typeof r?function(t){r(t,h)}:null)}return h}function Njt(t,e,n){var i=t.getArea(),r=pAt(i.r0,1),o=pAt(i.r,1),a=new tEt({shape:{cx:pAt(t.cx,1),cy:pAt(t.cy,1),r0:r,r:o,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}});e&&("angle"===t.getBaseAxis().dim?a.shape.endAngle=i.startAngle:a.shape.r=r,jEt(a,{shape:{endAngle:i.endAngle,r:o}},n));return a}function Ojt(t,e,n,i,r){return t?"polar"===t.type?Njt(t,e,n):"cartesian2d"===t.type?Ejt(t,e,n,i,r):null:null}function Fjt(t,e){return t.type===e}function Rjt(t,e){if(t.length===e.length){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return;return!0}}function Ljt(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,o=0;o<t.length;){var a=t[o++],s=t[o++];isNaN(a)||(e=Math.min(a,e),i=Math.max(a,i)),isNaN(s)||(n=Math.min(s,n),r=Math.max(s,r))}return[[e,n],[i,r]]}function $jt(t,e){var n=Ljt(t),i=n[0],r=n[1],o=Ljt(e),a=o[0],s=o[1];return Math.max(Math.abs(i[0]-a[0]),Math.abs(i[1]-a[1]),Math.abs(r[0]-s[0]),Math.abs(r[1]-s[1]))}function Pjt(t){return"number"==typeof t?t:t?.5:0}function zjt(t,e,n){for(var i=e.getBaseAxis(),r="x"===i.dim||"radius"===i.dim?0:1,o=[],a=0,s=[],l=[],u=[];a<t.length-2;a+=2)switch(u[0]=t[a+2],u[1]=t[a+3],l[0]=t[a],l[1]=t[a+1],o.push(l[0],l[1]),n){case"end":s[r]=u[r],s[1-r]=l[1-r],o.push(s[0],s[1]);break;case"middle":var c=(l[r]+u[r])/2,h=[];s[r]=h[r]=c,s[1-r]=l[1-r],h[1-r]=u[1-r],o.push(s[0],s[1]),o.push(h[0],h[1]);break;default:s[r]=l[r],s[1-r]=u[1-r],o.push(s[0],s[1])}return o.push(t[a++],t[a++]),o}function Bjt(t,e,n){var i=t.get("showAllSymbol"),r="auto"===i;if(!i||r){var o=n.getAxesByScale("ordinal")[0];if(o&&(!r||!function(t,e){var n=t.getExtent(),i=Math.abs(n[1]-n[0])/t.scale.count();isNaN(i)&&(i=0);for(var r=e.count(),o=Math.max(1,Math.round(r/5)),a=0;a<r;a+=o)if(1.5*djt.getSymbolSize(e,a)[t.isHorizontal()?1:0]>i)return!1;return!0}(o,e))){var a=e.mapDimension(o.dim),s={};return S_t(o.getViewLabels(),(function(t){var e=o.scale.getRawOrdinalNumber(t.tickValue);s[e]=1})),function(t){return!s.hasOwnProperty(e.get(a,t))}}}}function Vjt(t,e){return isNaN(t)||isNaN(e)}function Wjt(t,e){return[t[2*e],t[2*e+1]]}function jjt(t,e,n,i){if(Fjt(e,"cartesian2d")){var r=i.getModel("endLabel"),o=r.get("show"),a=r.get("valueAnimation"),s=i.getData(),l={lastFrameIndex:0},u=o?function(n,i){t._endLabelOnDuring(n,i,s,l,a,r,e)}:null,c=e.getBaseAxis().isHorizontal(),h=Ejt(e,n,i,(function(){var e=t._endLabel;e&&n&&null!=l.originalX&&e.attr({x:l.originalX,y:l.originalY})}),u);if(!i.get("clip",!0)){var d=h.shape,p=Math.max(d.width,d.height);c?(d.y-=p,d.height+=2*p):(d.x-=p,d.width+=2*p)}return u&&u(1,h),h}return Njt(e,n,i)}var Ujt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.init=function(){var t=new oAt,e=new yjt;this.group.add(e.group),this._symbolDraw=e,this._lineGroup=t},e.prototype.render=function(t,e,n){var i=this,r=t.coordinateSystem,o=this.group,a=t.getData(),s=t.getModel("lineStyle"),l=t.getModel("areaStyle"),u=a.getLayout("points")||[],c="polar"===r.type,h=this._coordSys,d=this._symbolDraw,p=this._polyline,f=this._polygon,g=this._lineGroup,m=t.get("animation"),y=!l.isEmpty(),v=l.get("origin"),x=vjt(r,a,v),b=y&&function(t,e,n){if(!n.valueDim)return[];for(var i=e.count(),r=_jt(2*i),o=0;o<i;o++){var a=xjt(n,t,e,o);r[2*o]=a[0],r[2*o+1]=a[1]}return r}(r,a,x),w=t.get("showSymbol"),_=w&&!c&&Bjt(t,a,r),k=this._data;k&&k.eachItemGraphicEl((function(t,e){t.__temp&&(o.remove(t),k.setItemGraphicEl(e,null))})),w||d.remove(),o.add(g);var S,C=!c&&t.get("step");r&&r.getArea&&t.get("clip",!0)&&(null!=(S=r.getArea()).width?(S.x-=.1,S.y-=.1,S.width+=.2,S.height+=.2):S.r0&&(S.r0-=.5,S.r+=.5)),this._clipShapeForSymbol=S;var A=function(t,e){var n=t.getVisual("visualMeta");if(n&&n.length&&t.count()&&"cartesian2d"===e.type){for(var i,r,o=n.length-1;o>=0;o--){var a=n[o].dimension,s=t.dimensions[a],l=t.getDimensionInfo(s);if("x"===(i=l&&l.coordDim)||"y"===i){r=n[o];break}}if(r){var u=e.getAxis(i),c=C_t(r.stops,(function(t){return{offset:0,coord:u.toGlobalCoord(u.dataToCoord(t.value,!0)),color:t.color}})),h=c.length,d=r.outerColors.slice();h&&c[0].coord>c[h-1].coord&&(c.reverse(),d.reverse());var p=c[0].coord-10,f=c[h-1].coord+10,g=f-p;if(g<.001)return"transparent";S_t(c,(function(t){t.offset=(t.coord-p)/g})),c.push({offset:h?c[h-1].offset:.5,color:d[1]||"transparent"}),c.unshift({offset:h?c[0].offset:.5,color:d[0]||"transparent"});var m=new bEt(0,0,0,0,c,!0);return m[i]=p,m[i+"2"]=f,m}}}(a,r)||a.getVisual("style")[a.getVisual("drawType")];p&&h.type===r.type&&C===this._step?(y&&!f?f=this._newPolygon(u,b):f&&!y&&(g.remove(f),f=this._polygon=null),c||this._initOrUpdateEndLabel(t,r,bOt(A)),g.setClipPath(jjt(this,r,!1,t)),w&&d.updateData(a,{isIgnore:_,clipShape:S,disableAnimation:!0,getSymbolPoint:function(t){return[u[2*t],u[2*t+1]]}}),Rjt(this._stackedOnPoints,b)&&Rjt(this._points,u)||(m?this._doUpdateAnimation(a,b,r,n,C,v):(C&&(u=zjt(u,r,C),b&&(b=zjt(b,r,C))),p.setShape({points:u}),f&&f.setShape({points:u,stackedOnPoints:b})))):(w&&d.updateData(a,{isIgnore:_,clipShape:S,disableAnimation:!0,getSymbolPoint:function(t){return[u[2*t],u[2*t+1]]}}),m&&this._initSymbolLabelAnimation(a,r,S),C&&(u=zjt(u,r,C),b&&(b=zjt(b,r,C))),p=this._newPolyline(u),y&&(f=this._newPolygon(u,b)),c||this._initOrUpdateEndLabel(t,r,bOt(A)),g.setClipPath(jjt(this,r,!0,t)));var I=t.get(["emphasis","focus"]),M=t.get(["emphasis","blurScope"]);(p.useStyle(x_t(s.getLineStyle(),{fill:"none",stroke:A,lineJoin:"bevel"})),pTt(p,t,"lineStyle"),p.style.lineWidth>0&&"bolder"===t.get(["emphasis","lineStyle","width"]))&&(p.getState("emphasis").style.lineWidth=+p.style.lineWidth+1);IDt(p).seriesIndex=t.seriesIndex,uTt(p,I,M);var D=Pjt(t.get("smooth")),T=t.get("smoothMonotone"),E=t.get("connectNulls");if(p.setShape({smooth:D,smoothMonotone:T,connectNulls:E}),f){var N=a.getCalculationInfo("stackedOnSeries"),O=0;f.useStyle(x_t(l.getAreaStyle(),{fill:A,opacity:.7,lineJoin:"bevel",decal:a.getVisual("style").decal})),N&&(O=Pjt(N.get("smooth"))),f.setShape({smooth:D,stackedOnSmooth:O,smoothMonotone:T,connectNulls:E}),pTt(f,t,"areaStyle"),IDt(f).seriesIndex=t.seriesIndex,uTt(f,I,M)}var F=function(t){i._changePolyState(t)};a.eachItemGraphicEl((function(t){t&&(t.onHoverStateChange=F)})),this._polyline.onHoverStateChange=F,this._data=a,this._coordSys=r,this._stackedOnPoints=b,this._points=u,this._step=C,this._valueOrigin=v},e.prototype.dispose=function(){},e.prototype.highlight=function(t,e,n,i){var r=t.getData(),o=WAt(r,i);if(this._changePolyState("emphasis"),!(o instanceof Array)&&null!=o&&o>=0){var a=r.getLayout("points"),s=r.getItemGraphicEl(o);if(!s){var l=a[2*o],u=a[2*o+1];if(isNaN(l)||isNaN(u))return;if(this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(l,u))return;var c=t.get("zlevel"),h=t.get("z");(s=new djt(r,o)).x=l,s.y=u,s.setZ(c,h);var d=s.getSymbolPath().getTextContent();d&&(d.zlevel=c,d.z=h,d.z2=this._polyline.z2+1),s.__temp=!0,r.setItemGraphicEl(o,s),s.stopSymbolAnimation(!0),this.group.add(s)}s.highlight()}else aLt.prototype.highlight.call(this,t,e,n,i)},e.prototype.downplay=function(t,e,n,i){var r=t.getData(),o=WAt(r,i);if(this._changePolyState("normal"),null!=o&&o>=0){var a=r.getItemGraphicEl(o);a&&(a.__temp?(r.setItemGraphicEl(o,null),this.group.remove(a)):a.downplay())}else aLt.prototype.downplay.call(this,t,e,n,i)},e.prototype._changePolyState=function(t){var e=this._polygon;GDt(this._polyline,t),e&&GDt(e,t)},e.prototype._newPolyline=function(t){var e=this._polyline;return e&&this._lineGroup.remove(e),e=new Mjt({shape:{points:t},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(e),this._polyline=e,e},e.prototype._newPolygon=function(t,e){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new Tjt({shape:{points:t,stackedOnPoints:e},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n,n},e.prototype._initSymbolLabelAnimation=function(t,e,n){var i,r,o=e.getBaseAxis(),a=o.inverse;"cartesian2d"===e.type?(i=o.isHorizontal(),r=!1):"polar"===e.type&&(i="angle"===o.dim,r=!0);var s=t.hostModel,l=s.get("animationDuration");"function"==typeof l&&(l=l(null));var u=s.get("animationDelay")||0,c="function"==typeof u?u(null):u;t.eachItemGraphicEl((function(t,o){var s=t;if(s){var h=[t.x,t.y],d=void 0,p=void 0,f=void 0;if(n)if(r){var g=n,m=e.pointToCoord(h);i?(d=g.startAngle,p=g.endAngle,f=-m[1]/180*Math.PI):(d=g.r0,p=g.r,f=m[0])}else{var y=n;i?(d=y.x,p=y.x+y.width,f=t.x):(d=y.y+y.height,p=y.y,f=t.y)}var v=p===d?0:(f-d)/(p-d);a&&(v=1-v);var x="function"==typeof u?u(o):l*v+c,b=s.getSymbolPath(),w=b.getTextContent();s.attr({scaleX:0,scaleY:0}),s.animateTo({scaleX:1,scaleY:1},{duration:200,delay:x}),w&&w.animateFrom({style:{opacity:0}},{duration:300,delay:x}),b.disableLabelAnimation=!0}}))},e.prototype._initOrUpdateEndLabel=function(t,e,n){var i=t.getModel("endLabel");if(i.get("show")){var r=t.getData(),o=this._polyline,a=this._endLabel;a||((a=this._endLabel=new xDt({z2:200})).ignoreClip=!0,o.setTextContent(this._endLabel),o.disableLabelAnimation=!0);var s=function(t){for(var e=t.length/2;e>0&&Vjt(t[2*e-2],t[2*e-1]);e--);return e-1}(r.getLayout("points"));s>=0&&(uNt(o,cNt(t,"endLabel"),{inheritColor:n,labelFetcher:t,labelDataIndex:s,defaultText:function(t,e,n){return null!=n?hjt(r,n):cjt(r,t)},enableTextSetter:!0},function(t,e){var n=e.getBaseAxis(),i=n.isHorizontal(),r=n.inverse,o=i?r?"right":"left":"center",a=i?"middle":r?"top":"bottom";return{normal:{align:t.get("align")||o,verticalAlign:t.get("verticalAlign")||a}}}(i,e)),o.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},e.prototype._endLabelOnDuring=function(t,e,n,i,r,o,a){var s=this._endLabel,l=this._polyline;if(s){t<1&&null==i.originalX&&(i.originalX=s.x,i.originalY=s.y);var u=n.getLayout("points"),c=n.hostModel,h=c.get("connectNulls"),d=o.get("precision"),p=o.get("distance")||0,f=a.getBaseAxis(),g=f.isHorizontal(),m=f.inverse,y=e.shape,v=m?g?y.x:y.y+y.height:g?y.x+y.width:y.y,x=(g?p:0)*(m?-1:1),b=(g?0:-p)*(m?-1:1),w=g?"x":"y",_=function(t,e,n){for(var i,r,o=t.length/2,a="x"===n?0:1,s=0,l=-1,u=0;u<o;u++)if(r=t[2*u+a],!isNaN(r)&&!isNaN(t[2*u+1-a]))if(0!==u){if(i<=e&&r>=e||i>=e&&r<=e){l=u;break}s=u,i=r}else i=r;return{range:[s,l],t:(e-i)/(r-i)}}(u,v,w),k=_.range,S=k[1]-k[0],C=void 0;if(S>=1){if(S>1&&!h){var A=Wjt(u,k[0]);s.attr({x:A[0]+x,y:A[1]+b}),r&&(C=c.getRawValue(k[0]))}else{(A=l.getPointOn(v,w))&&s.attr({x:A[0]+x,y:A[1]+b});var I=c.getRawValue(k[0]),M=c.getRawValue(k[1]);r&&(C=JAt(n,d,I,M,_.t))}i.lastFrameIndex=k[0]}else{var D=1===t||i.lastFrameIndex>0?k[0]:0;A=Wjt(u,D);r&&(C=c.getRawValue(D)),s.attr({x:A[0]+x,y:A[1]+b})}r&&vNt(s).setLabelText(C)}},e.prototype._doUpdateAnimation=function(t,e,n,i,r,o){var a=this._polyline,s=this._polygon,l=t.hostModel,u=function(t,e,n,i,r,o,a,s){for(var l=function(t,e){var n=[];return e.diff(t).add((function(t){n.push({cmd:"+",idx:t})})).update((function(t,e){n.push({cmd:"=",idx:e,idx1:t})})).remove((function(t){n.push({cmd:"-",idx:t})})).execute(),n}(t,e),u=[],c=[],h=[],d=[],p=[],f=[],g=[],m=vjt(r,e,a),y=t.getLayout("points")||[],v=e.getLayout("points")||[],x=0;x<l.length;x++){var b=l[x],w=!0,_=void 0,k=void 0;switch(b.cmd){case"=":_=2*b.idx,k=2*b.idx1;var S=y[_],C=y[_+1],A=v[k],I=v[k+1];(isNaN(S)||isNaN(C))&&(S=A,C=I),u.push(S,C),c.push(A,I),h.push(n[_],n[_+1]),d.push(i[k],i[k+1]),g.push(e.getRawIndex(b.idx1));break;case"+":var M=b.idx,D=m.dataDimsForPoint,T=r.dataToPoint([e.get(D[0],M),e.get(D[1],M)]);k=2*M,u.push(T[0],T[1]),c.push(v[k],v[k+1]);var E=xjt(m,r,e,M);h.push(E[0],E[1]),d.push(i[k],i[k+1]),g.push(e.getRawIndex(M));break;case"-":w=!1}w&&(p.push(b),f.push(f.length))}f.sort((function(t,e){return g[t]-g[e]}));var N=u.length,O=_jt(N),F=_jt(N),R=_jt(N),L=_jt(N),$=[];for(x=0;x<f.length;x++){var P=f[x],z=2*x,B=2*P;O[z]=u[B],O[z+1]=u[B+1],F[z]=c[B],F[z+1]=c[B+1],R[z]=h[B],R[z+1]=h[B+1],L[z]=d[B],L[z+1]=d[B+1],$[x]=p[P]}return{current:O,next:F,stackedOnCurrent:R,stackedOnNext:L,status:$}}(this._data,t,this._stackedOnPoints,e,this._coordSys,0,this._valueOrigin),c=u.current,h=u.stackedOnCurrent,d=u.next,p=u.stackedOnNext;if(r&&(c=zjt(u.current,n,r),h=zjt(u.stackedOnCurrent,n,r),d=zjt(u.next,n,r),p=zjt(u.stackedOnNext,n,r)),$jt(c,d)>3e3||s&&$jt(h,p)>3e3)return a.setShape({points:d}),void(s&&s.setShape({points:d,stackedOnPoints:p}));a.shape.__points=u.current,a.shape.points=c;var f={shape:{points:d}};u.current!==c&&(f.shape.__points=u.next),a.stopAnimation(),WEt(a,f,l),s&&(s.setShape({points:c,stackedOnPoints:h}),s.stopAnimation(),WEt(s,{shape:{stackedOnPoints:p}},l),a.shape.points!==s.shape.points&&(s.shape.points=a.shape.points));for(var g=[],m=u.status,y=0;y<m.length;y++){if("="===m[y].cmd){var v=t.getItemGraphicEl(m[y].idx1);v&&g.push({el:v,ptIdx:y})}}a.animators&&a.animators.length&&a.animators[0].during((function(){s&&s.dirtyShape();for(var t=a.shape.__points,e=0;e<g.length;e++){var n=g[e].el,i=2*g[e].ptIdx;n.x=t[i],n.y=t[i+1],n.markRedraw()}}))},e.prototype.remove=function(t){var e=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl((function(t,i){t.__temp&&(e.remove(t),n.setItemGraphicEl(i,null))})),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},e.type="line",e}(aLt);function Gjt(t,e){return{seriesType:t,plan:iLt(),reset:function(t){var n=t.getData(),i=t.coordinateSystem,r=t.pipelineContext,o=e||r.large;if(i){var a=C_t(i.dimensions,(function(t){return n.mapDimension(t)})).slice(0,2),s=a.length,l=n.getCalculationInfo("stackResultDimension");JBt(n,a[0])&&(a[0]=l),JBt(n,a[1])&&(a[1]=l);var u=n.getDimensionInfo(a[0]),c=n.getDimensionInfo(a[1]),h=u&&u.index,d=c&&c.index;return s&&{progress:function(t,e){for(var n=t.end-t.start,r=o&&_jt(n*s),a=[],l=[],u=t.start,c=0;u<t.end;u++){var p=void 0;if(1===s){var f=e.getByDimIdx(h,u);p=i.dataToPoint(f,null,l)}else a[0]=e.getByDimIdx(h,u),a[1]=e.getByDimIdx(d,u),p=i.dataToPoint(a,null,l);o?(r[c++]=p[0],r[c++]=p[1]):e.setItemLayout(u,p.slice())}o&&e.setLayout("points",r)}}}}}}var Hjt={average:function(t){for(var e=0,n=0,i=0;i<t.length;i++)isNaN(t[i])||(e+=t[i],n++);return 0===n?NaN:e/n},sum:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n]||0;return e},max:function(t){for(var e=-1/0,n=0;n<t.length;n++)t[n]>e&&(e=t[n]);return isFinite(e)?e:NaN},min:function(t){for(var e=1/0,n=0;n<t.length;n++)t[n]<e&&(e=t[n]);return isFinite(e)?e:NaN},nearest:function(t){return t[0]}},qjt=function(t){return Math.round(t.length/2)};function Xjt(t){return{seriesType:t,reset:function(t,e,n){var i=t.getData(),r=t.get("sampling"),o=t.coordinateSystem,a=i.count();if(a>10&&"cartesian2d"===o.type&&r){var s=o.getBaseAxis(),l=o.getOtherAxis(s),u=s.getExtent(),c=n.getDevicePixelRatio(),h=Math.abs(u[1]-u[0])*(c||1),d=Math.round(a/h);if(d>1){"lttb"===r&&t.setData(i.lttbDownSample(i.mapDimension(l.dim),1/d));var p=void 0;"string"==typeof r?p=Hjt[r]:"function"==typeof r&&(p=r),p&&t.setData(i.downSample(i.mapDimension(l.dim),1/d,p,qjt))}}}}}var Yjt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this,{useEncodeDefaulter:!0})},e.prototype.getMarkerPosition=function(t){var e=this.coordinateSystem;if(e){var n=e.dataToPoint(e.clampData(t)),i=this.getData(),r=i.getLayout("offset"),o=i.getLayout("size");return n[e.getBaseAxis().isHorizontal()?0:1]+=r+o/2,n}return[NaN,NaN]},e.type="series.__base_bar__",e.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},e}(XRt);XRt.registerClass(Yjt);var Kjt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.getInitialData=function(){return tVt(this.getSource(),this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},e.prototype.getProgressive=function(){return!!this.get("large")&&this.get("progressive")},e.prototype.getProgressiveThreshold=function(){var t=this.get("progressiveThreshold"),e=this.get("largeThreshold");return e>t&&(t=e),t},e.prototype.brushSelector=function(t,e,n){return n.rect(e.getItemLayout(t))},e.type="series.bar",e.dependencies=["grid","polar"],e.defaultOption=RNt(Yjt.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),e}(Yjt),Zjt=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0},Jjt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="sausage",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new Zjt},e.prototype.buildPath=function(t,e){var n=e.cx,i=e.cy,r=Math.max(e.r0||0,0),o=Math.max(e.r,0),a=.5*(o-r),s=r+a,l=e.startAngle,u=e.endAngle,c=e.clockwise,h=Math.cos(l),d=Math.sin(l),p=Math.cos(u),f=Math.sin(u);(c?u-l<2*Math.PI:l-u<2*Math.PI)&&(t.moveTo(h*r+n,d*r+i),t.arc(h*s+n,d*s+i,a,-Math.PI+l,l,!c)),t.arc(n,i,o,l,u,!c),t.moveTo(p*o+n,f*o+i),t.arc(p*s+n,f*s+i,a,u-2*Math.PI,u-Math.PI,!c),0!==r&&(t.arc(n,i,r,u,l,c),t.moveTo(h*r+n,f*r+i)),t.closePath()},e}(rDt),Qjt=[0,0],tUt=Math.max,eUt=Math.min;var nUt=function(t){function e(){var n=t.call(this)||this;return n.type=e.type,n._isFirstFrame=!0,n}return Dit(e,t),e.prototype.render=function(t,e,n,i){this._model=t,this._removeOnRenderedListener(n),this._updateDrawMode(t);var r=t.get("coordinateSystem");"cartesian2d"!==r&&"polar"!==r||(this._isLargeDraw?this._renderLarge(t,e,n):this._renderNormal(t,e,n,i))},e.prototype.incrementalPrepareRender=function(t){this._clear(),this._updateDrawMode(t),this._updateLargeClip(t)},e.prototype.incrementalRender=function(t,e){this._incrementalRenderLarge(t,e)},e.prototype._updateDrawMode=function(t){var e=t.pipelineContext.large;null!=this._isLargeDraw&&e===this._isLargeDraw||(this._isLargeDraw=e,this._clear())},e.prototype._renderNormal=function(t,e,n,i){var r,o=this.group,a=t.getData(),s=this._data,l=t.coordinateSystem,u=l.getBaseAxis();"cartesian2d"===l.type?r=u.isHorizontal():"polar"===l.type&&(r="angle"===u.dim);var c=t.isAnimationEnabled()?t:null,h=function(t,e){var n=t.get("realtimeSort",!0),i=e.getBaseAxis();if(n&&"category"===i.type&&"cartesian2d"===e.type)return{baseAxis:i,otherAxis:e.getOtherAxis(i)}}(t,l);h&&this._enableRealtimeSort(h,a,n);var d=t.get("clip",!0)||h,p=function(t,e){var n=t.getArea&&t.getArea();if(Fjt(t,"cartesian2d")){var i=t.getBaseAxis();if("category"!==i.type||!i.onBand){var r=e.getLayout("bandWidth");i.isHorizontal()?(n.x-=r,n.width+=2*r):(n.y-=r,n.height+=2*r)}}return n}(l,a);o.removeClipPath();var f=t.get("roundCap",!0),g=t.get("showBackground",!0),m=t.getModel("backgroundStyle"),y=m.get("borderRadius")||0,v=[],x=this._backgroundEls,b=i&&i.isInitSort,w=i&&"changeAxisOrder"===i.type;function _(t){var e=aUt[l.type](a,t),n=function(t,e,n){return new("polar"===t.type?tEt:mDt)({shape:dUt(e,n,t),silent:!0,z2:0})}(l,r,e);return n.useStyle(m.getItemStyle()),"cartesian2d"===l.type&&n.setShape("r",y),v[t]=n,n}a.diff(s).add((function(e){var n=a.getItemModel(e),i=aUt[l.type](a,e,n);if(g&&_(e),a.hasValue(e)){var s=!1;d&&(s=iUt[l.type](p,i));var m=rUt[l.type](t,a,e,i,r,c,u.model,!1,f);sUt(m,a,e,n,i,t,r,"polar"===l.type),b?m.attr({shape:i}):h?oUt(h,c,m,i,e,r,!1,!1):jEt(m,{shape:i},t,e),a.setItemGraphicEl(e,m),o.add(m),m.ignore=s}})).update((function(e,n){var i=a.getItemModel(e),k=aUt[l.type](a,e,i);if(g){var S=void 0;0===x.length?S=_(n):((S=x[n]).useStyle(m.getItemStyle()),"cartesian2d"===l.type&&S.setShape("r",y),v[e]=S);var C=aUt[l.type](a,e);WEt(S,{shape:dUt(r,C,l)},c,e)}var A=s.getItemGraphicEl(n);if(!a.hasValue(e))return o.remove(A),void(A=null);var I=!1;d&&(I=iUt[l.type](p,k))&&o.remove(A),A||(A=rUt[l.type](t,a,e,k,r,c,u.model,!!A,f)),w||sUt(A,a,e,i,k,t,r,"polar"===l.type),b?A.attr({shape:k}):h?oUt(h,c,A,k,e,r,!0,w):WEt(A,{shape:k},t,e,null),a.setItemGraphicEl(e,A),A.ignore=I,o.add(A)})).remove((function(e){var n=s.getItemGraphicEl(e);n&&HEt(n,t,e)})).execute();var k=this._backgroundGroup||(this._backgroundGroup=new oAt);k.removeAll();for(var S=0;S<v.length;++S)k.add(v[S]);o.add(k),this._backgroundEls=v,this._data=a},e.prototype._renderLarge=function(t,e,n){this._clear(),cUt(t,this.group),this._updateLargeClip(t)},e.prototype._incrementalRenderLarge=function(t,e){this._removeBackground(),cUt(e,this.group,!0)},e.prototype._updateLargeClip=function(t){var e=t.get("clip",!0)?Ojt(t.coordinateSystem,!1,t):null;e?this.group.setClipPath(e):this.group.removeClipPath()},e.prototype._enableRealtimeSort=function(t,e,n){var i=this;if(e.count()){var r=t.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(e,t,n),this._isFirstFrame=!1;else{var o=function(t){var n=e.getItemGraphicEl(t);if(n){var i=n.shape;return(r.isHorizontal()?Math.abs(i.height):Math.abs(i.width))||0}return 0};this._onRendered=function(){i._updateSortWithinSameData(e,o,r,n)},n.getZr().on("rendered",this._onRendered)}}},e.prototype._dataSort=function(t,e,n){var i=[];return t.each(t.mapDimension(e.dim),(function(t,e){var r=n(e);r=null==r?NaN:r,i.push({dataIndex:e,mappedValue:r,ordinalNumber:t})})),i.sort((function(t,e){return e.mappedValue-t.mappedValue})),{ordinalNumbers:C_t(i,(function(t){return t.ordinalNumber}))}},e.prototype._isOrderChangedWithinSameData=function(t,e,n){for(var i=n.scale,r=t.mapDimension(n.dim),o=Number.MAX_VALUE,a=0,s=i.getOrdinalMeta().categories.length;a<s;++a){var l=t.rawIndexOf(r,i.getRawOrdinalNumber(a)),u=l<0?Number.MIN_VALUE:e(t.indexOfRawIndex(l));if(u>o)return!0;o=u}return!1},e.prototype._isOrderDifferentInView=function(t,e){for(var n=e.scale,i=n.getExtent(),r=Math.max(0,i[0]),o=Math.min(i[1],n.getOrdinalMeta().categories.length-1);r<=o;++r)if(t.ordinalNumbers[r]!==n.getRawOrdinalNumber(r))return!0},e.prototype._updateSortWithinSameData=function(t,e,n,i){if(this._isOrderChangedWithinSameData(t,e,n)){var r=this._dataSort(t,n,e);this._isOrderDifferentInView(r,n)&&(this._removeOnRenderedListener(i),i.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:r}))}},e.prototype._dispatchInitSort=function(t,e,n){var i=e.baseAxis,r=this._dataSort(t,i,(function(n){return t.get(t.mapDimension(e.otherAxis.dim),n)}));n.dispatchAction({type:"changeAxisOrder",componentType:i.dim+"Axis",isInitSort:!0,axisId:i.index,sortInfo:r,animation:{duration:0}})},e.prototype.remove=function(t,e){this._clear(this._model),this._removeOnRenderedListener(e)},e.prototype.dispose=function(t,e){this._removeOnRenderedListener(e)},e.prototype._removeOnRenderedListener=function(t){this._onRendered&&(t.getZr().off("rendered",this._onRendered),this._onRendered=null)},e.prototype._clear=function(t){var e=this.group,n=this._data;t&&t.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl((function(e){HEt(e,t,IDt(e).dataIndex)}))):e.removeAll(),this._data=null,this._isFirstFrame=!0},e.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},e.type="bar",e}(aLt),iUt={cartesian2d:function(t,e){var n=e.width<0?-1:1,i=e.height<0?-1:1;n<0&&(e.x+=e.width,e.width=-e.width),i<0&&(e.y+=e.height,e.height=-e.height);var r=t.x+t.width,o=t.y+t.height,a=tUt(e.x,t.x),s=eUt(e.x+e.width,r),l=tUt(e.y,t.y),u=eUt(e.y+e.height,o),c=s<a,h=u<l;return e.x=c&&a>r?s:a,e.y=h&&l>o?u:l,e.width=c?0:s-a,e.height=h?0:u-l,n<0&&(e.x+=e.width,e.width=-e.width),i<0&&(e.y+=e.height,e.height=-e.height),c||h},polar:function(t,e){var n=e.r0<=e.r?1:-1;if(n<0){var i=e.r;e.r=e.r0,e.r0=i}var r=eUt(e.r,t.r),o=tUt(e.r0,t.r0);e.r=r,e.r0=o;var a=r-o<0;if(n<0){i=e.r;e.r=e.r0,e.r0=i}return a}},rUt={cartesian2d:function(t,e,n,i,r,o,a,s,l){var u=new mDt({shape:v_t({},i),z2:1});(u.__dataIndex=n,u.name="item",o)&&(u.shape[r?"height":"width"]=0);return u},polar:function(t,e,n,i,r,o,a,s,l){var u=i.startAngle<i.endAngle,c=new(!r&&l?Jjt:tEt)({shape:x_t({clockwise:u},i),z2:1});if(c.name="item",o){var h=r?"r":"endAngle",d={};c.shape[h]=r?0:i.startAngle,d[h]=i[h],(s?WEt:jEt)(c,{shape:d},o)}return c}};function oUt(t,e,n,i,r,o,a,s){var l,u;o?(u={x:i.x,width:i.width},l={y:i.y,height:i.height}):(u={y:i.y,height:i.height},l={x:i.x,width:i.width}),s||(a?WEt:jEt)(n,{shape:l},e,r,null),(a?WEt:jEt)(n,{shape:u},e?t.baseAxis.model:null,r)}var aUt={cartesian2d:function(t,e,n){var i=t.getItemLayout(e),r=n?function(t,e){var n=t.get(["itemStyle","borderColor"]);if(!n||"none"===n)return 0;var i=t.get(["itemStyle","borderWidth"])||0,r=isNaN(e.width)?Number.MAX_VALUE:Math.abs(e.width),o=isNaN(e.height)?Number.MAX_VALUE:Math.abs(e.height);return Math.min(i,r,o)}(n,i):0,o=i.width>0?1:-1,a=i.height>0?1:-1;return{x:i.x+o*r/2,y:i.y+a*r/2,width:i.width-o*r,height:i.height-a*r}},polar:function(t,e,n){var i=t.getItemLayout(e);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle}}};function sUt(t,e,n,i,r,o,a,s){var l=e.getItemVisual(n,"style");s||t.setShape("r",i.get(["itemStyle","borderRadius"])||0),t.useStyle(l);var u=i.getShallow("cursor");if(u&&t.attr("cursor",u),!s){var c=a?r.height>0?"bottom":"top":r.width>0?"left":"right",h=cNt(i);uNt(t,h,{labelFetcher:o,labelDataIndex:n,defaultText:cjt(o.getData(),n),inheritColor:l.fill,defaultOpacity:l.opacity,defaultOutsidePosition:c}),xNt(t.getTextContent(),h,o.getRawValue(n),(function(t){return hjt(e,t)}))}var d=i.getModel(["emphasis"]);uTt(t,d.get("focus"),d.get("blurScope")),pTt(t,i),function(t){return null!=t.startAngle&&null!=t.endAngle&&t.startAngle===t.endAngle}(r)&&(t.style.fill="none",t.style.stroke="none",S_t(t.states,(function(t){t.style&&(t.style.fill=t.style.stroke="none")})))}var lUt=function(){},uUt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="largeBar",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new lUt},e.prototype.buildPath=function(t,e){for(var n=e.points,i=this.__startPoint,r=this.__baseDimIdx,o=0;o<n.length;o+=2)i[r]=n[o+r],t.moveTo(i[0],i[1]),t.lineTo(n[o],n[o+1])},e}(rDt);function cUt(t,e,n){var i=t.getData(),r=[],o=i.getLayout("valueAxisHorizontal")?1:0;r[1-o]=i.getLayout("valueAxisStart");var a=i.getLayout("largeDataIndices"),s=i.getLayout("barWidth"),l=t.getModel("backgroundStyle");if(t.get("showBackground",!0)){var u=i.getLayout("largeBackgroundPoints"),c=[];c[1-o]=i.getLayout("backgroundStart");var h=new uUt({shape:{points:u},incremental:!!n,silent:!0,z2:0});h.__startPoint=c,h.__baseDimIdx=o,h.__largeDataIndices=a,h.__barWidth=s,function(t,e,n){var i=e.get("borderColor")||e.get("color"),r=e.getItemStyle();t.useStyle(r),t.style.fill=null,t.style.stroke=i,t.style.lineWidth=n.getLayout("barWidth")}(h,l,i),e.add(h)}var d=new uUt({shape:{points:i.getLayout("largePoints")},incremental:!!n});d.__startPoint=r,d.__baseDimIdx=o,d.__largeDataIndices=a,d.__barWidth=s,e.add(d),function(t,e,n){var i=n.getVisual("style");t.useStyle(v_t({},i)),t.style.fill=null,t.style.stroke=i.fill,t.style.lineWidth=n.getLayout("barWidth")}(d,0,i),IDt(d).seriesIndex=t.seriesIndex,t.get("silent")||(d.on("mousedown",hUt),d.on("mousemove",hUt))}var hUt=fLt((function(t){var e=function(t,e,n){var i=t.__baseDimIdx,r=1-i,o=t.shape.points,a=t.__largeDataIndices,s=Math.abs(t.__barWidth/2),l=t.__startPoint[r];Qjt[0]=e,Qjt[1]=n;for(var u=Qjt[i],c=Qjt[1-i],h=u-s,d=u+s,p=0,f=o.length/2;p<f;p++){var g=2*p,m=o[g+i],y=o[g+r];if(m>=h&&m<=d&&(l<=y?c>=l&&c<=y:c>=y&&c<=l))return a[p]}return-1}(this,t.offsetX,t.offsetY);IDt(this).dataIndex=e>=0?e:null}),30,!1);function dUt(t,e,n){if(Fjt(n,"cartesian2d")){var i=e,r=n.getArea();return{x:t?i.x:r.x,y:t?r.y:i.y,width:t?i.width:r.width,height:t?r.height:i.height}}var o=e;return{cx:(r=n.getArea()).cx,cy:r.cy,r0:t?r.r0:o.r0,r:t?r.r:o.r,startAngle:t?o.startAngle:0,endAngle:t?o.endAngle:2*Math.PI}}var pUt=2*Math.PI,fUt=Math.PI/180;function gUt(t,e,n){e.eachSeriesByType(t,(function(t){var e=t.getData(),i=e.mapDimension("value"),r=function(t,e){return IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,n),o=t.get("center"),a=t.get("radius");E_t(a)||(a=[0,a]),E_t(o)||(o=[o,o]);var s=dAt(r.width,n.getWidth()),l=dAt(r.height,n.getHeight()),u=Math.min(s,l),c=dAt(o[0],s)+r.x,h=dAt(o[1],l)+r.y,d=dAt(a[0],u/2),p=dAt(a[1],u/2),f=-t.get("startAngle")*fUt,g=t.get("minAngle")*fUt,m=0;e.each(i,(function(t){!isNaN(t)&&m++}));var y=e.getSum(i),v=Math.PI/(y||m)*2,x=t.get("clockwise"),b=t.get("roseType"),w=t.get("stillShowZeroSum"),_=e.getDataExtent(i);_[0]=0;var k=pUt,S=0,C=f,A=x?1:-1;if(e.setLayout({viewRect:r,r:p}),e.each(i,(function(t,n){var i;if(isNaN(t))e.setItemLayout(n,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:x,cx:c,cy:h,r0:d,r:b?NaN:p});else{(i="area"!==b?0===y&&w?v:t*v:pUt/m)<g?(i=g,k-=g):S+=t;var r=C+A*i;e.setItemLayout(n,{angle:i,startAngle:C,endAngle:r,clockwise:x,cx:c,cy:h,r0:d,r:b?hAt(t,_,[d,p]):p}),C=r}})),k<pUt&&m)if(k<=.001){var I=pUt/m;e.each(i,(function(t,n){if(!isNaN(t)){var i=e.getItemLayout(n);i.angle=I,i.startAngle=f+A*n*I,i.endAngle=f+A*(n+1)*I}}))}else v=k/S,C=f,e.each(i,(function(t,n){if(!isNaN(t)){var i=e.getItemLayout(n),r=i.angle===g?g:t*v;i.startAngle=C,i.endAngle=C+A*r,C+=A*r}}))}))}function mUt(t){return{seriesType:t,reset:function(t,e){var n=e.findComponents({mainType:"legend"});if(n&&n.length){var i=t.getData();i.filterSelf((function(t){for(var e=i.getName(t),r=0;r<n.length;r++)if(!n[r].isSelected(e))return!1;return!0}))}}}}var yUt=Math.PI/180;function vUt(t,e,n,i,r,o,a,s,l,u){if(!(t.length<2)){for(var c=t.length,h=0;h<c;h++)if("outer"===t[h].position&&"labelLine"===t[h].labelAlignTo){var d=t[h].label.x-u;t[h].linePoints[1][0]+=d,t[h].label.x=u}w$t(t,l,l+a)&&function(t){for(var o={list:[],maxY:0},a={list:[],maxY:0},s=0;s<t.length;s++)if("none"===t[s].labelAlignTo){var l=t[s],u=l.label.y>n?a:o,c=Math.abs(l.label.y-n);if(c>u.maxY){var h=l.label.x-e-l.len2*r,d=i+l.len,f=Math.abs(h)<d?Math.sqrt(c*c/(1-h*h/d/d)):d;u.rB=f,u.maxY=c}u.list.push(l)}p(o),p(a)}(t)}function p(t){for(var o=t.rB,a=o*o,s=0;s<t.list.length;s++){var l=t.list[s],u=Math.abs(l.label.y-n),c=i+l.len,h=c*c,d=Math.sqrt((1-Math.abs(u*u/a))*h);l.label.x=e+(d+l.len2)*r}}}function xUt(t){return"center"===t.position}function bUt(t){var e,n,i=t.getData(),r=[],o=!1,a=(t.get("minShowLabelAngle")||0)*yUt,s=i.getLayout("viewRect"),l=i.getLayout("r"),u=s.width,c=s.x,h=s.y,d=s.height;function p(t){t.ignore=!0}i.each((function(t){var s=i.getItemGraphicEl(t),h=s.shape,d=s.getTextContent(),f=s.getTextGuideLine(),g=i.getItemModel(t),m=g.getModel("label"),y=m.get("position")||g.get(["emphasis","label","position"]),v=m.get("distanceToLabelLine"),x=m.get("alignTo"),b=dAt(m.get("edgeDistance"),u),w=m.get("bleedMargin"),_=g.getModel("labelLine"),k=_.get("length");k=dAt(k,u);var S=_.get("length2");if(S=dAt(S,u),Math.abs(h.endAngle-h.startAngle)<a)return S_t(d.states,p),void(d.ignore=!0);if(function(t){if(!t.ignore)return!0;for(var e in t.states)if(!1===t.states[e].ignore)return!0;return!1}(d)){var C,A,I,M,D=(h.startAngle+h.endAngle)/2,T=Math.cos(D),E=Math.sin(D);e=h.cx,n=h.cy;var N,O="inside"===y||"inner"===y;if("center"===y)C=h.cx,A=h.cy,M="center";else{var F=(O?(h.r+h.r0)/2*T:h.r*T)+e,R=(O?(h.r+h.r0)/2*E:h.r*E)+n;if(C=F+3*T,A=R+3*E,!O){var L=F+T*(k+l-h.r),$=R+E*(k+l-h.r),P=L+(T<0?-1:1)*S;C="edge"===x?T<0?c+b:c+u-b:P+(T<0?-v:v),A=$,I=[[F,R],[L,$],[P,$]]}M=O?"center":"edge"===x?T>0?"right":"left":T>0?"left":"right"}var z=m.get("rotate");if(N="number"==typeof z?z*(Math.PI/180):z?T<0?-D+Math.PI:-D:0,o=!!N,d.x=C,d.y=A,d.rotation=N,d.setStyle({verticalAlign:"middle"}),O){d.setStyle({align:M});var B=d.states.select;B&&(B.x+=d.x,B.y+=d.y)}else{var V=d.getBoundingRect().clone();V.applyTransform(d.getComputedTransform());var W=(d.style.margin||0)+2.1;V.y-=W/2,V.height+=W,r.push({label:d,labelLine:f,position:y,len:k,len2:S,minTurnAngle:_.get("minTurnAngle"),maxSurfaceAngle:_.get("maxSurfaceAngle"),surfaceNormal:new DCt(T,E),linePoints:I,textAlign:M,labelDistance:v,labelAlignTo:x,edgeDistance:b,bleedMargin:w,rect:V})}s.setTextConfig({inside:O})}})),!o&&t.get("avoidLabelOverlap")&&function(t,e,n,i,r,o,a,s){for(var l=[],u=[],c=Number.MAX_VALUE,h=-Number.MAX_VALUE,d=0;d<t.length;d++){var p=t[d].label;xUt(t[d])||(p.x<e?(c=Math.min(c,p.x),l.push(t[d])):(h=Math.max(h,p.x),u.push(t[d])))}for(vUt(u,e,n,i,1,0,o,0,s,h),vUt(l,e,n,i,-1,0,o,0,s,c),d=0;d<t.length;d++){var f=t[d];if(p=f.label,!xUt(f)){var g=f.linePoints;if(g){var m="edge"===f.labelAlignTo,y=f.rect.width,v=void 0;(v=m?p.x<e?g[2][0]-f.labelDistance-a-f.edgeDistance:a+r-f.edgeDistance-g[2][0]-f.labelDistance:p.x<e?p.x-a-f.bleedMargin:a+r-p.x-f.bleedMargin)<f.rect.width&&(f.label.style.width=v,"edge"===f.labelAlignTo&&(y=v));var x=g[1][0]-g[2][0];m?p.x<e?g[2][0]=a+f.edgeDistance+y+f.labelDistance:g[2][0]=a+r-f.edgeDistance-y-f.labelDistance:(p.x<e?g[2][0]=p.x+f.labelDistance:g[2][0]=p.x-f.labelDistance,g[1][0]=g[2][0]+x),g[1][1]=g[2][1]=p.y}}}}(r,e,n,l,u,d,c,h);for(var f=0;f<r.length;f++){var g=r[f],m=g.label,y=g.labelLine,v=isNaN(m.x)||isNaN(m.y);if(m){m.setStyle({align:g.textAlign}),v&&(S_t(m.states,p),m.ignore=!0);var x=m.states.select;x&&(x.x+=m.x,x.y+=m.y)}if(y){var b=g.linePoints;v||!b?(S_t(y.states,p),y.ignore=!0):(f$t(b,g.minTurnAngle),g$t(b,g.surfaceNormal,g.maxSurfaceAngle),y.setShape({points:b}),m.__hostTarget.textGuideLineConfig={anchor:new DCt(b[0][0],b[0][1])})}}}function wUt(t,e){var n=t.get("borderRadius");return null==n?null:(E_t(n)||(n=[n,n]),{innerCornerRadius:XCt(n[0],e.r0),cornerRadius:XCt(n[1],e.r)})}var _Ut=function(t){function e(e,n,i){var r=t.call(this)||this;r.z2=2;var o=new xDt;return r.setTextContent(o),r.updateData(e,n,i,!0),r}return Dit(e,t),e.prototype.updateData=function(t,e,n,i){var r=this,o=t.hostModel,a=t.getItemModel(e),s=a.getModel("emphasis"),l=t.getItemLayout(e),u=v_t(wUt(a.getModel("itemStyle"),l)||{},l);if(isNaN(u.startAngle))r.setShape(u);else{if(i)r.setShape(u),"scale"===o.getShallow("animationType")?(r.shape.r=l.r0,jEt(r,{shape:{r:l.r}},o,e)):null!=n?(r.setShape({startAngle:n,endAngle:n}),jEt(r,{shape:{startAngle:l.startAngle,endAngle:l.endAngle}},o,e)):(r.shape.endAngle=l.startAngle,WEt(r,{shape:{endAngle:l.endAngle}},o,e));else WEt(r,{shape:u},o,e);r.useStyle(t.getItemVisual(e,"style")),pTt(r,a);var c=(l.startAngle+l.endAngle)/2,h=o.get("selectedOffset"),d=Math.cos(c)*h,p=Math.sin(c)*h,f=a.getShallow("cursor");f&&r.attr("cursor",f),this._updateLabel(o,t,e),r.ensureState("emphasis").shape=Tit({r:l.r+(s.get("scale")&&s.get("scaleSize")||0)},wUt(s.getModel("itemStyle"),l)),v_t(r.ensureState("select"),{x:d,y:p,shape:wUt(a.getModel(["select","itemStyle"]),l)}),v_t(r.ensureState("blur"),{shape:wUt(a.getModel(["blur","itemStyle"]),l)});var g=r.getTextGuideLine(),m=r.getTextContent();g&&v_t(g.ensureState("select"),{x:d,y:p}),v_t(m.ensureState("select"),{x:d,y:p}),uTt(this,s.get("focus"),s.get("blurScope"))}},e.prototype._updateLabel=function(t,e,n){var i=this,r=e.getItemModel(n),o=r.getModel("labelLine"),a=e.getItemVisual(n,"style"),s=a&&a.fill,l=a&&a.opacity;uNt(i,cNt(r),{labelFetcher:e.hostModel,labelDataIndex:n,inheritColor:s,defaultOpacity:l,defaultText:t.getFormattedLabel(n,"normal")||e.getName(n)});var u=i.getTextContent();i.setTextConfig({position:null,rotation:null}),u.attr({z2:10});var c=t.get(["label","position"]);if("outside"!==c&&"outer"!==c)i.removeTextGuideLine();else{var h=this.getTextGuideLine();h||(h=new lEt,this.setTextGuideLine(h)),v$t(this,x$t(r),{stroke:s,opacity:j_t(o.get(["lineStyle","opacity"]),l,1)})}},e}(tEt),kUt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ignoreLabelLineUpdate=!0,e}return Dit(e,t),e.prototype.init=function(){var t=new oAt;this._sectorGroup=t},e.prototype.render=function(t,e,n,i){var r,o=t.getData(),a=this._data,s=this.group;if(!a&&o.count()>0){for(var l=o.getItemLayout(0),u=1;isNaN(l&&l.startAngle)&&u<o.count();++u)l=o.getItemLayout(u);l&&(r=l.startAngle)}o.diff(a).add((function(t){var e=new _Ut(o,t,r);o.setItemGraphicEl(t,e),s.add(e)})).update((function(t,e){var n=a.getItemGraphicEl(e);n.updateData(o,t,r),n.off("click"),s.add(n),o.setItemGraphicEl(t,n)})).remove((function(e){HEt(a.getItemGraphicEl(e),t,e)})).execute(),bUt(t),"expansion"!==t.get("animationTypeUpdate")&&(this._data=o)},e.prototype.dispose=function(){},e.prototype.containPoint=function(t,e){var n=e.getData().getItemLayout(0);if(n){var i=t[0]-n.cx,r=t[1]-n.cy,o=Math.sqrt(i*i+r*r);return o<=n.r&&o>=n.r0}},e.type="pie",e}(aLt);function SUt(t,e,n){e=E_t(e)&&{coordDimensions:e}||v_t({},e);var i=t.getSource(),r=XBt(i,e),o=new GBt(r,t);return o.initData(i,n),o}var CUt=function(){function t(t,e){this._getDataWithEncodedVisual=t,this._getRawData=e}return t.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},t.prototype.containName=function(t){return this._getRawData().indexOfName(t)>=0},t.prototype.indexOfName=function(t){return this._getDataWithEncodedVisual().indexOfName(t)},t.prototype.getItemVisual=function(t,e){return this._getDataWithEncodedVisual().getItemVisual(t,e)},t}(),AUt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.useColorPaletteOnData=!0,e}return Dit(e,t),e.prototype.init=function(e){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new CUt(D_t(this.getData,this),D_t(this.getRawData,this)),this._defaultLabelLine(e)},e.prototype.mergeOption=function(){t.prototype.mergeOption.apply(this,arguments)},e.prototype.getInitialData=function(){return SUt(this,{coordDimensions:["value"],encodeDefaulter:T_t(UOt,this)})},e.prototype.getDataParams=function(e){var n=this.getData(),i=t.prototype.getDataParams.call(this,e),r=[];return n.each(n.mapDimension("value"),(function(t){r.push(t)})),i.percent=function(t,e,n){if(!t[e])return 0;var i=A_t(t,(function(t,e){return t+(isNaN(e)?0:e)}),0);if(0===i)return 0;for(var r=Math.pow(10,n),o=C_t(t,(function(t){return(isNaN(t)?0:t)/i*r*100})),a=100*r,s=C_t(o,(function(t){return Math.floor(t)})),l=A_t(s,(function(t,e){return t+e}),0),u=C_t(o,(function(t,e){return t-s[e]}));l<a;){for(var c=Number.NEGATIVE_INFINITY,h=null,d=0,p=u.length;d<p;++d)u[d]>c&&(c=u[d],h=d);++s[h],u[h]=0,++l}return s[e]/r}(r,e,n.hostModel.get("percentPrecision")),i.$vars.push("percent"),i},e.prototype._defaultLabelLine=function(t){OAt(t,"labelLine",["show"]);var e=t.labelLine,n=t.emphasis.labelLine;e.show=e.show&&t.label.show,n.show=n.show&&t.emphasis.label.show},e.type="series.pie",e.defaultOption={zlevel:0,z:2,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},e}(XRt);var IUt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.hasSymbolVisual=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this,{useEncodeDefaulter:!0})},e.prototype.getProgressive=function(){var t=this.option.progressive;return null==t?this.option.large?5e3:this.get("progressive"):t},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return null==t?this.option.large?1e4:this.get("progressiveThreshold"):t},e.prototype.brushSelector=function(t,e,n){return n.point(e.getItemLayout(t))},e.type="series.scatter",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:"#212121"}}},e}(XRt),MUt=function(){},DUt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new MUt},e.prototype.buildPath=function(t,e){var n=e.points,i=e.size,r=this.symbolProxy,o=r.shape,a=t.getContext?t.getContext():t;if(a&&i[0]<4)this._ctx=a;else{this._ctx=null;for(var s=0;s<n.length;){var l=n[s++],u=n[s++];isNaN(l)||isNaN(u)||(this.softClipShape&&!this.softClipShape.contain(l,u)||(o.x=l-i[0]/2,o.y=u-i[1]/2,o.width=i[0],o.height=i[1],r.buildPath(t,o,!0)))}}},e.prototype.afterBrush=function(){var t=this.shape,e=t.points,n=t.size,i=this._ctx;if(i)for(var r=0;r<e.length;){var o=e[r++],a=e[r++];isNaN(o)||isNaN(a)||(this.softClipShape&&!this.softClipShape.contain(o,a)||i.fillRect(o-n[0]/2,a-n[1]/2,n[0],n[1]))}},e.prototype.findDataIndex=function(t,e){for(var n=this.shape,i=n.points,r=n.size,o=Math.max(r[0],4),a=Math.max(r[1],4),s=i.length/2-1;s>=0;s--){var l=2*s,u=i[l]-o/2,c=i[l+1]-a/2;if(t>=u&&e>=c&&t<=u+o&&e<=c+a)return s}return-1},e}(rDt),TUt=function(){function t(){this.group=new oAt}return t.prototype.isPersistent=function(){return!this._incremental},t.prototype.updateData=function(t,e){this.group.removeAll();var n=new DUt({rectHover:!0,cursor:"default"});n.setShape({points:t.getLayout("points")}),this._setCommon(n,t,!1,e),this.group.add(n),this._incremental=null},t.prototype.updateLayout=function(t){if(!this._incremental){var e=t.getLayout("points");this.group.eachChild((function(t){if(null!=t.startIndex){var n=2*(t.endIndex-t.startIndex),i=4*t.startIndex*2;e=new Float32Array(e.buffer,i,n)}t.setShape("points",e)}))}},t.prototype.incrementalPrepareUpdate=function(t){this.group.removeAll(),this._clearIncremental(),t.count()>2e6?(this._incremental||(this._incremental=new MEt({silent:!0})),this.group.add(this._incremental)):this._incremental=null},t.prototype.incrementalUpdate=function(t,e,n){var i;this._incremental?(i=new DUt,this._incremental.addDisplayable(i,!0)):((i=new DUt({rectHover:!0,cursor:"default",startIndex:t.start,endIndex:t.end})).incremental=!0,this.group.add(i)),i.setShape({points:e.getLayout("points")}),this._setCommon(i,e,!!this._incremental,n)},t.prototype._setCommon=function(t,e,n,i){var r=e.hostModel;i=i||{};var o=e.getVisual("symbolSize");t.setShape("size",o instanceof Array?o:[o,o]),t.softClipShape=i.clipShape||null,t.symbolProxy=U$t(e.getVisual("symbol"),0,0,0,0),t.setColor=t.symbolProxy.setColor;var a=t.shape.size[0]<4;t.useStyle(r.getModel("itemStyle").getItemStyle(a?["color","shadowBlur","shadowColor"]:["color"]));var s=e.getVisual("style"),l=s&&s.fill;if(l&&t.setColor(l),!n){var u=IDt(t);u.seriesIndex=r.seriesIndex,t.on("mousemove",(function(e){u.dataIndex=null;var n=t.findDataIndex(e.offsetX,e.offsetY);n>=0&&(u.dataIndex=n+(t.startIndex||0))}))}},t.prototype.remove=function(){this._clearIncremental(),this._incremental=null,this.group.removeAll()},t.prototype._clearIncremental=function(){var t=this._incremental;t&&t.clearDisplaybles()},t}(),EUt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.getData();this._updateSymbolDraw(i,t).updateData(i,{clipShape:this._getClipShape(t)}),this._finished=!0},e.prototype.incrementalPrepareRender=function(t,e,n){var i=t.getData();this._updateSymbolDraw(i,t).incrementalPrepareUpdate(i),this._finished=!1},e.prototype.incrementalRender=function(t,e,n){this._symbolDraw.incrementalUpdate(t,e.getData(),{clipShape:this._getClipShape(e)}),this._finished=t.end===e.getData().count()},e.prototype.updateTransform=function(t,e,n){var i=t.getData();if(this.group.dirty(),!this._finished||i.count()>1e4||!this._symbolDraw.isPersistent())return{update:!0};var r=Gjt("").reset(t,e,n);r.progress&&r.progress({start:0,end:i.count(),count:i.count()},i),this._symbolDraw.updateLayout(i)},e.prototype._getClipShape=function(t){var e=t.coordinateSystem,n=e&&e.getArea&&e.getArea();return t.get("clip",!0)?n:null},e.prototype._updateSymbolDraw=function(t,e){var n=this._symbolDraw,i=e.pipelineContext.large;return n&&i===this._isLargeDraw||(n&&n.remove(),n=this._symbolDraw=i?new TUt:new yjt,this._isLargeDraw=i,this.group.removeAll()),this.group.add(n.group),n},e.prototype.remove=function(t,e){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},e.prototype.dispose=function(){},e.type="scatter",e}(aLt),NUt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.type="grid",e.dependencies=["xAxis","yAxis"],e.layoutMode="box",e.defaultOption={show:!1,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"},e}(FOt),OUt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",qAt).models[0]},e.type="cartesian2dAxis",e}(FOt);__t(OUt,iWt);var FUt={show:!0,zlevel:0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},RUt=m_t({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},FUt),LUt=m_t({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:"#F4F7FD",width:1}}},FUt),$Ut={category:RUt,value:LUt,time:m_t({scale:!0,splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},LUt),log:x_t({scale:!0,logBase:10},LUt)},PUt={value:1,category:1,time:1,log:1};function zUt(t,e,n,i){S_t(PUt,(function(r,o){var a=m_t(m_t({},$Ut[o],!0),i,!0),s=function(t){function n(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r=t.apply(this,n)||this;return r.type=e+"Axis."+o,r}return Dit(n,t),n.prototype.mergeDefaultAndTheme=function(t,e){var n=DOt(this),i=n?EOt(t):{};m_t(t,e.getTheme().get(o+"Axis")),m_t(t,this.getDefaultOption()),t.type=BUt(t),n&&TOt(t,i,n)},n.prototype.optionUpdated=function(){"category"===this.option.type&&(this.__ordinalMeta=nVt.createByAxisModel(this))},n.prototype.getCategories=function(t){var e=this.option;if("category"===e.type)return t?e.data:this.__ordinalMeta.categories},n.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},n.type=e+"Axis."+o,n.defaultOption=a,n}(n);t.registerComponentModel(s)})),t.registerSubTypeDefaulter(e+"Axis",BUt)}function BUt(t){return t.type||(t.data?"category":"value")}var VUt=function(){function t(t){this.type="cartesian",this._dimList=[],this._axes={},this.name=t||""}return t.prototype.getAxis=function(t){return this._axes[t]},t.prototype.getAxes=function(){return C_t(this._dimList,(function(t){return this._axes[t]}),this)},t.prototype.getAxesByScale=function(t){return t=t.toLowerCase(),I_t(this.getAxes(),(function(e){return e.scale.type===t}))},t.prototype.addAxis=function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},t}(),WUt=["x","y"];function jUt(t){return"interval"===t.type||"time"===t.type}var UUt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="cartesian2d",e.dimensions=WUt,e}return Dit(e,t),e.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var t=this.getAxis("x").scale,e=this.getAxis("y").scale;if(jUt(t)&&jUt(e)){var n=t.getExtent(),i=e.getExtent(),r=this.dataToPoint([n[0],i[0]]),o=this.dataToPoint([n[1],i[1]]),a=n[1]-n[0],s=i[1]-i[0];if(a&&s){var l=(o[0]-r[0])/a,u=(o[1]-r[1])/s,c=r[0]-n[0]*l,h=r[1]-i[0]*u,d=this._transform=[l,0,0,u,c,h];this._invTransform=xCt([],d)}}},e.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},e.prototype.containPoint=function(t){var e=this.getAxis("x"),n=this.getAxis("y");return e.contain(e.toLocalCoord(t[0]))&&n.contain(n.toLocalCoord(t[1]))},e.prototype.containData=function(t){return this.getAxis("x").containData(t[0])&&this.getAxis("y").containData(t[1])},e.prototype.dataToPoint=function(t,e,n){n=n||[];var i=t[0],r=t[1];if(this._transform&&null!=i&&isFinite(i)&&null!=r&&isFinite(r))return gkt(n,t,this._transform);var o=this.getAxis("x"),a=this.getAxis("y");return n[0]=o.toGlobalCoord(o.dataToCoord(i,e)),n[1]=a.toGlobalCoord(a.dataToCoord(r,e)),n},e.prototype.clampData=function(t,e){var n=this.getAxis("x").scale,i=this.getAxis("y").scale,r=n.getExtent(),o=i.getExtent(),a=n.parse(t[0]),s=i.parse(t[1]);return(e=e||[])[0]=Math.min(Math.max(Math.min(r[0],r[1]),a),Math.max(r[0],r[1])),e[1]=Math.min(Math.max(Math.min(o[0],o[1]),s),Math.max(o[0],o[1])),e},e.prototype.pointToData=function(t,e){var n=[];if(this._invTransform)return gkt(n,t,this._invTransform);var i=this.getAxis("x"),r=this.getAxis("y");return n[0]=i.coordToData(i.toLocalCoord(t[0]),e),n[1]=r.coordToData(r.toLocalCoord(t[1]),e),n},e.prototype.getOtherAxis=function(t){return this.getAxis("x"===t.dim?"y":"x")},e.prototype.getArea=function(){var t=this.getAxis("x").getGlobalExtent(),e=this.getAxis("y").getGlobalExtent(),n=Math.min(t[0],t[1]),i=Math.min(e[0],e[1]),r=Math.max(t[0],t[1])-n,o=Math.max(e[0],e[1])-i;return new PCt(n,i,r,o)},e}(VUt),GUt=function(t){function e(e,n,i,r,o){var a=t.call(this,e,n,i)||this;return a.index=0,a.type=r||"value",a.position=o||"bottom",a}return Dit(e,t),e.prototype.isHorizontal=function(){var t=this.position;return"top"===t||"bottom"===t},e.prototype.getGlobalExtent=function(t){var e=this.getExtent();return e[0]=this.toGlobalCoord(e[0]),e[1]=this.toGlobalCoord(e[1]),t&&e[0]>e[1]&&e.reverse(),e},e.prototype.pointToData=function(t,e){return this.coordToData(this.toLocalCoord(t["x"===this.dim?0:1]),e)},e.prototype.setCategorySortInfo=function(t){if("category"!==this.type)return!1;this.model.option.categorySortInfo=t,this.scale.setSortInfo(t)},e}(fWt);function HUt(t,e,n){n=n||{};var i=t.coordinateSystem,r=e.axis,o={},a=r.getAxesOnZeroOf()[0],s=r.position,l=a?"onZero":s,u=r.dim,c=i.getRect(),h=[c.x,c.x+c.width,c.y,c.y+c.height],d={left:0,right:1,top:0,bottom:1,onZero:2},p=e.get("offset")||0,f="x"===u?[h[2]-p,h[3]+p]:[h[0]-p,h[1]+p];if(a){var g=a.toGlobalCoord(a.dataToCoord(0));f[d.onZero]=Math.max(Math.min(g,f[1]),f[0])}o.position=["y"===u?f[d[l]]:h[0],"x"===u?f[d[l]]:h[3]],o.rotation=Math.PI/2*("x"===u?0:1);o.labelDirection=o.tickDirection=o.nameDirection={top:-1,bottom:1,left:-1,right:1}[s],o.labelOffset=a?f[d[s]]-f[d.onZero]:0,e.get(["axisTick","inside"])&&(o.tickDirection=-o.tickDirection),V_t(n.labelInside,e.get(["axisLabel","inside"]))&&(o.labelDirection=-o.labelDirection);var m=e.get(["axisLabel","rotate"]);return o.labelRotate="top"===l?-m:m,o.z2=1,o}function qUt(t){return"cartesian2d"===t.get("coordinateSystem")}function XUt(t){var e={xAxisModel:null,yAxisModel:null};return S_t(e,(function(n,i){var r=i.replace(/Model$/,""),o=t.getReferringComponents(r,qAt).models[0];e[i]=o})),e}var YUt=function(){function t(t,e,n){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=WUt,this._initCartesian(t,e,n),this.model=t}return t.prototype.getRect=function(){return this._rect},t.prototype.update=function(t,e){var n=this._axesMap;this._updateScale(t,this.model),S_t(n.x,(function(t){KVt(t.scale,t.model)})),S_t(n.y,(function(t){KVt(t.scale,t.model)}));var i={};S_t(n.x,(function(t){ZUt(n,"y",t,i)})),S_t(n.y,(function(t){ZUt(n,"x",t,i)})),this.resize(this.model,e)},t.prototype.resize=function(t,e,n){var i=t.getBoxLayoutParams(),r=!n&&t.get("containLabel"),o=IOt(i,{width:e.getWidth(),height:e.getHeight()});this._rect=o;var a=this._axesList;function s(){S_t(a,(function(t){var e=t.isHorizontal(),n=e?[0,o.width]:[0,o.height],i=t.inverse?1:0;t.setExtent(n[i],n[1-i]),function(t,e){var n=t.getExtent(),i=n[0]+n[1];t.toGlobalCoord="x"===t.dim?function(t){return t+e}:function(t){return i-t+e},t.toLocalCoord="x"===t.dim?function(t){return t-e}:function(t){return i-t+e}}(t,e?o.x:o.y)}))}s(),r&&(S_t(a,(function(t){if(!t.model.get(["axisLabel","inside"])){var e=function(t){var e=t.model,n=t.scale;if(e.get(["axisLabel","show"])&&!n.isBlank()){var i,r,o=n.getExtent();r=n instanceof hVt?n.count():(i=n.getTicks()).length;var a,s,l,u,c,h,d,p=t.getLabelModel(),f=JVt(t),g=1;r>40&&(g=Math.ceil(r/40));for(var m=0;m<r;m+=g){var y=f(i?i[m]:{value:o[0]+m},m),v=(s=p.getTextRect(y),l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,l=(p.get("rotate")||0)*Math.PI/180,u=s.width,c=s.height,h=u*Math.abs(Math.cos(l))+Math.abs(c*Math.sin(l)),d=u*Math.abs(Math.sin(l))+Math.abs(c*Math.cos(l)),new PCt(s.x,s.y,h,d));a?a.union(v):a=v}return a}}(t);if(e){var n=t.isHorizontal()?"height":"width",i=t.model.get(["axisLabel","margin"]);o[n]-=e[n]+i,"top"===t.position?o.y+=e.height+i:"left"===t.position&&(o.x+=e.width+i)}}})),s()),S_t(this._coordsList,(function(t){t.calcAffineTransform()}))},t.prototype.getAxis=function(t,e){var n=this._axesMap[t];if(null!=n)return n[e||0]},t.prototype.getAxes=function(){return this._axesList.slice()},t.prototype.getCartesian=function(t,e){if(null!=t&&null!=e){var n="x"+t+"y"+e;return this._coordsMap[n]}L_t(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var i=0,r=this._coordsList;i<r.length;i++)if(r[i].getAxis("x").index===t||r[i].getAxis("y").index===e)return r[i]},t.prototype.getCartesians=function(){return this._coordsList.slice()},t.prototype.convertToPixel=function(t,e,n){var i=this._findConvertTarget(e);return i.cartesian?i.cartesian.dataToPoint(n):i.axis?i.axis.toGlobalCoord(i.axis.dataToCoord(n)):null},t.prototype.convertFromPixel=function(t,e,n){var i=this._findConvertTarget(e);return i.cartesian?i.cartesian.pointToData(n):i.axis?i.axis.coordToData(i.axis.toLocalCoord(n)):null},t.prototype._findConvertTarget=function(t){var e,n,i=t.seriesModel,r=t.xAxisModel||i&&i.getReferringComponents("xAxis",qAt).models[0],o=t.yAxisModel||i&&i.getReferringComponents("yAxis",qAt).models[0],a=t.gridModel,s=this._coordsList;if(i)w_t(s,e=i.coordinateSystem)<0&&(e=null);else if(r&&o)e=this.getCartesian(r.componentIndex,o.componentIndex);else if(r)n=this.getAxis("x",r.componentIndex);else if(o)n=this.getAxis("y",o.componentIndex);else if(a){a.coordinateSystem===this&&(e=this._coordsList[0])}return{cartesian:e,axis:n}},t.prototype.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},t.prototype._initCartesian=function(t,e,n){var i=this,r=this,o={left:!1,right:!1,top:!1,bottom:!1},a={x:{},y:{}},s={x:0,y:0};if(e.eachComponent("xAxis",l("x"),this),e.eachComponent("yAxis",l("y"),this),!s.x||!s.y)return this._axesMap={},void(this._axesList=[]);function l(e){return function(n,i){if(KUt(n,t)){var l=n.get("position");"x"===e?"top"!==l&&"bottom"!==l&&(l=o.bottom?"top":"bottom"):"left"!==l&&"right"!==l&&(l=o.left?"right":"left"),o[l]=!0;var u=new GUt(e,ZVt(n),[0,0],n.get("type"),l),c="category"===u.type;u.onBand=c&&n.get("boundaryGap"),u.inverse=n.get("inverse"),n.axis=u,u.model=n,u.grid=r,u.index=i,r._axesList.push(u),a[e][i]=u,s[e]++}}}this._axesMap=a,S_t(a.x,(function(e,n){S_t(a.y,(function(r,o){var a="x"+n+"y"+o,s=new UUt(a);s.master=i,s.model=t,i._coordsMap[a]=s,i._coordsList.push(s),s.addAxis(e),s.addAxis(r)}))}))},t.prototype._updateScale=function(t,e){function n(t,e){S_t(nWt(t,e.dim),(function(n){e.scale.unionExtentFromData(t,n)}))}S_t(this._axesList,(function(t){if(t.scale.setExtent(1/0,-1/0),"category"===t.type){var e=t.model.get("categorySortInfo");t.scale.setSortInfo(e)}})),t.eachSeries((function(t){if(qUt(t)){var i=XUt(t),r=i.xAxisModel,o=i.yAxisModel;if(!KUt(r,e)||!KUt(o,e))return;var a=this.getCartesian(r.componentIndex,o.componentIndex),s=t.getData(),l=a.getAxis("x"),u=a.getAxis("y");"list"===s.type&&(n(s,l),n(s,u))}}),this)},t.prototype.getTooltipAxes=function(t){var e=[],n=[];return S_t(this.getCartesians(),(function(i){var r=null!=t&&"auto"!==t?i.getAxis(t):i.getBaseAxis(),o=i.getOtherAxis(r);w_t(e,r)<0&&e.push(r),w_t(n,o)<0&&n.push(o)})),{baseAxes:e,otherAxes:n}},t.create=function(e,n){var i=[];return e.eachComponent("grid",(function(r,o){var a=new t(r,e,n);a.name="grid_"+o,a.resize(r,n,!0),r.coordinateSystem=a,i.push(a)})),e.eachSeries((function(t){if(qUt(t)){var e=XUt(t),n=e.xAxisModel,i=e.yAxisModel,r=n.getCoordSysModel().coordinateSystem;t.coordinateSystem=r.getCartesian(n.componentIndex,i.componentIndex)}})),i},t.dimensions=WUt,t}();function KUt(t,e){return t.getCoordSysModel()===e}function ZUt(t,e,n,i){n.getAxesOnZeroOf=function(){return r?[r]:[]};var r,o=t[e],a=n.model,s=a.get(["axisLine","onZero"]),l=a.get(["axisLine","onZeroAxisIndex"]);if(s){if(null!=l)JUt(o[l])&&(r=o[l]);else for(var u in o)if(o.hasOwnProperty(u)&&JUt(o[u])&&!i[c(o[u])]){r=o[u];break}r&&(i[c(r)]=!0)}function c(t){return t.dim+"_"+t.index}}function JUt(t){return t&&"category"!==t.type&&"time"!==t.type&&function(t){var e=t.scale.getExtent(),n=e[0],i=e[1];return!(n>0&&i>0||n<0&&i<0)}(t)}var QUt=Math.PI,tGt=function(){function t(t,e){this.group=new oAt,this.opt=e,this.axisModel=t,x_t(e,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0,handleAutoShown:function(){return!0}});var n=new oAt({x:e.position[0],y:e.position[1],rotation:e.rotation});n.updateTransform(),this._transformGroup=n}return t.prototype.hasBuilder=function(t){return!!eGt[t]},t.prototype.add=function(t){eGt[t](this.opt,this.axisModel,this.group,this._transformGroup)},t.prototype.getGroup=function(){return this.group},t.innerTextLayout=function(t,e,n){var i,r,o=vAt(e-t);return xAt(o)?(r=n>0?"top":"bottom",i="center"):xAt(o-QUt)?(r=n>0?"bottom":"top",i="center"):(r="middle",i=o>0&&o<QUt?n>0?"right":"left":n>0?"left":"right"),{rotation:o,textAlign:i,textVerticalAlign:r}},t.makeAxisEventDataBase=function(t){var e={componentType:t.mainType,componentIndex:t.componentIndex};return e[t.mainType+"Index"]=t.componentIndex,e},t.isLabelSilent=function(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)},t}(),eGt={axisLine:function(t,e,n,i){var r=e.get(["axisLine","show"]);if("auto"===r&&t.handleAutoShown&&(r=t.handleAutoShown("axisLine")),r){var o=e.axis.getExtent(),a=i.transform,s=[o[0],0],l=[o[1],0];a&&(gkt(s,s,a),gkt(l,l,a));var u=v_t({lineCap:"round"},e.getModel(["axisLine","lineStyle"]).getLineStyle()),c=new hEt({subPixelOptimize:!0,shape:{x1:s[0],y1:s[1],x2:l[0],y2:l[1]},style:u,strokeContainThreshold:t.strokeContainThreshold||5,silent:!0,z2:1});c.anid="line",n.add(c);var h=e.get(["axisLine","symbol"]),d=e.get(["axisLine","symbolSize"]),p=e.get(["axisLine","symbolOffset"])||0;if("number"==typeof p&&(p=[p,p]),null!=h){"string"==typeof h&&(h=[h,h]),"string"!=typeof d&&"number"!=typeof d||(d=[d,d]);var f=d[0],g=d[1];S_t([{rotate:t.rotation+Math.PI/2,offset:p[0],r:0},{rotate:t.rotation-Math.PI/2,offset:p[1],r:Math.sqrt((s[0]-l[0])*(s[0]-l[0])+(s[1]-l[1])*(s[1]-l[1]))}],(function(e,i){if("none"!==h[i]&&null!=h[i]){var r=U$t(h[i],-f/2,-g/2,f,g,u.stroke,!0),o=e.r+e.offset;r.attr({rotation:e.rotate,x:s[0]+o*Math.cos(t.rotation),y:s[1]-o*Math.sin(t.rotation),silent:!0,z2:11}),n.add(r)}}))}}},axisTickLabel:function(t,e,n,i){var r=function(t,e,n,i){var r=n.axis,o=n.getModel("axisTick"),a=o.get("show");"auto"===a&&i.handleAutoShown&&(a=i.handleAutoShown("axisTick"));if(!a||r.scale.isBlank())return;for(var s=o.getModel("lineStyle"),l=i.tickDirection*o.get("length"),u=oGt(r.getTicksCoords(),e.transform,l,x_t(s.getLineStyle(),{stroke:n.get(["axisLine","lineStyle","color"])}),"ticks"),c=0;c<u.length;c++)t.add(u[c]);return u}(n,i,e,t),o=function(t,e,n,i){var r=n.axis;if(!V_t(i.axisLabelShow,n.get(["axisLabel","show"]))||r.scale.isBlank())return;var o=n.getModel("axisLabel"),a=o.get("margin"),s=r.getViewLabels(),l=(V_t(i.labelRotate,o.get("rotate"))||0)*QUt/180,u=tGt.innerTextLayout(i.rotation,l,i.labelDirection),c=n.getCategories&&n.getCategories(!0),h=[],d=tGt.isLabelSilent(n),p=n.get("triggerEvent");return S_t(s,(function(s,l){var f="ordinal"===r.scale.type?r.scale.getRawOrdinalNumber(s.tickValue):s.tickValue,g=s.formattedLabel,m=s.rawLabel,y=o;if(c&&c[f]){var v=c[f];L_t(v)&&v.textStyle&&(y=new NNt(v.textStyle,o,n.ecModel))}var x=y.getTextColor()||n.get(["axisLine","lineStyle","color"]),b=r.dataToCoord(f),w=new xDt({x:b,y:i.labelOffset+i.labelDirection*a,rotation:u.rotation,silent:d,z2:10,style:hNt(y,{text:g,align:y.getShallow("align",!0)||u.textAlign,verticalAlign:y.getShallow("verticalAlign",!0)||y.getShallow("baseline",!0)||u.textVerticalAlign,fill:"function"==typeof x?x("category"===r.type?m:"value"===r.type?f+"":f,l):x})});if(w.anid="label_"+f,p){var _=tGt.makeAxisEventDataBase(n);_.targetType="axisLabel",_.value=m,IDt(w).eventData=_}e.add(w),w.updateTransform(),h.push(w),t.add(w),w.decomposeTransform()})),h}(n,i,e,t);!function(t,e,n){if(eWt(t.axis))return;var i=t.get(["axisLabel","showMinLabel"]),r=t.get(["axisLabel","showMaxLabel"]);n=n||[];var o=(e=e||[])[0],a=e[1],s=e[e.length-1],l=e[e.length-2],u=n[0],c=n[1],h=n[n.length-1],d=n[n.length-2];!1===i?(nGt(o),nGt(u)):iGt(o,a)&&(i?(nGt(a),nGt(c)):(nGt(o),nGt(u)));!1===r?(nGt(s),nGt(h)):iGt(l,s)&&(r?(nGt(l),nGt(d)):(nGt(s),nGt(h)))}(e,o,r),function(t,e,n,i){var r=n.axis,o=n.getModel("minorTick");if(!o.get("show")||r.scale.isBlank())return;var a=r.getMinorTicksCoords();if(!a.length)return;for(var s=o.getModel("lineStyle"),l=i*o.get("length"),u=x_t(s.getLineStyle(),x_t(n.getModel("axisTick").getLineStyle(),{stroke:n.get(["axisLine","lineStyle","color"])})),c=0;c<a.length;c++)for(var h=oGt(a[c],e.transform,l,u,"minorticks_"+c),d=0;d<h.length;d++)t.add(h[d])}(n,i,e,t.tickDirection)},axisName:function(t,e,n,i){var r=V_t(t.axisName,e.get("name"));if(r){var o,a,s=e.get("nameLocation"),l=t.nameDirection,u=e.getModel("nameTextStyle"),c=e.get("nameGap")||0,h=e.axis.getExtent(),d=h[0]>h[1]?-1:1,p=["start"===s?h[0]-d*c:"end"===s?h[1]+d*c:(h[0]+h[1])/2,rGt(s)?t.labelOffset+l*c:0],f=e.get("nameRotate");null!=f&&(f=f*QUt/180),rGt(s)?o=tGt.innerTextLayout(t.rotation,null!=f?f:t.rotation,l):(o=function(t,e,n,i){var r,o,a=vAt(n-t),s=i[0]>i[1],l="start"===e&&!s||"start"!==e&&s;xAt(a-QUt/2)?(o=l?"bottom":"top",r="center"):xAt(a-1.5*QUt)?(o=l?"top":"bottom",r="center"):(o="middle",r=a<1.5*QUt&&a>QUt/2?l?"left":"right":l?"right":"left");return{rotation:a,textAlign:r,textVerticalAlign:o}}(t.rotation,s,f||0,h),null!=(a=t.axisNameAvailableWidth)&&(a=Math.abs(a/Math.sin(o.rotation)),!isFinite(a)&&(a=null)));var g=u.getFont(),m=e.get("nameTruncate",!0)||{},y=m.ellipsis,v=V_t(t.nameTruncateMaxWidth,m.maxWidth,a),x=new xDt({x:p[0],y:p[1],rotation:o.rotation,silent:tGt.isLabelSilent(e),style:hNt(u,{text:r,font:g,overflow:"truncate",width:v,ellipsis:y,fill:u.getTextColor()||e.get(["axisLine","lineStyle","color"]),align:u.get("align")||o.textAlign,verticalAlign:u.get("verticalAlign")||o.textVerticalAlign}),z2:1});if(rNt({el:x,componentModel:e,itemName:r}),x.__fullText=r,x.anid="name",e.get("triggerEvent")){var b=tGt.makeAxisEventDataBase(e);b.targetType="axisName",b.name=r,IDt(x).eventData=b}i.add(x),x.updateTransform(),n.add(x),x.decomposeTransform()}}};function nGt(t){t&&(t.ignore=!0)}function iGt(t,e){var n=t&&t.getBoundingRect().clone(),i=e&&e.getBoundingRect().clone();if(n&&i){var r=pCt([]);return yCt(r,r,-t.rotation),n.applyTransform(gCt([],r,t.getLocalTransform())),i.applyTransform(gCt([],r,e.getLocalTransform())),n.intersect(i)}}function rGt(t){return"middle"===t||"center"===t}function oGt(t,e,n,i,r){for(var o=[],a=[],s=[],l=0;l<t.length;l++){var u=t[l].coord;a[0]=u,a[1]=0,s[0]=u,s[1]=n,e&&(gkt(a,a,e),gkt(s,s,e));var c=new hEt({subPixelOptimize:!0,shape:{x1:a[0],y1:a[1],x2:s[0],y2:s[1]},style:i,z2:2,autoBatch:!0,silent:!0});c.anid=r+"_"+t[l].tickValue,o.push(c)}return o}function aGt(t,e){var n={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return function(t,e,n){var i=e.getComponent("tooltip"),r=e.getComponent("axisPointer"),o=r.get("link",!0)||[],a=[];S_t(n.getCoordinateSystems(),(function(n){if(n.axisPointerEnabled){var s=hGt(n.model),l=t.coordSysAxesInfo[s]={};t.coordSysMap[s]=n;var u=n.model.getModel("tooltip",i);if(S_t(n.getAxes(),T_t(p,!1,null)),n.getTooltipAxes&&i&&u.get("show")){var c="axis"===u.get("trigger"),h="cross"===u.get(["axisPointer","type"]),d=n.getTooltipAxes(u.get(["axisPointer","axis"]));(c||h)&&S_t(d.baseAxes,T_t(p,!h||"cross",c)),h&&S_t(d.otherAxes,T_t(p,"cross",!1))}}function p(i,s,c){var h=c.model.getModel("axisPointer",r),d=h.get("show");if(d&&("auto"!==d||i||cGt(h))){null==s&&(s=h.get("triggerTooltip"));var p=(h=i?function(t,e,n,i,r,o){var a=e.getModel("axisPointer"),s={};S_t(["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],(function(t){s[t]=g_t(a.get(t))})),s.snap="category"!==t.type&&!!o,"cross"===a.get("type")&&(s.type="line");var l=s.label||(s.label={});if(null==l.show&&(l.show=!1),"cross"===r){var u=a.get(["label","show"]);if(l.show=null==u||u,!o){var c=s.lineStyle=a.get("crossStyle");c&&x_t(l,c.textStyle)}}return t.model.getModel("axisPointer",new NNt(s,n,i))}(c,u,r,e,i,s):h).get("snap"),f=hGt(c.model),g=s||p||"category"===c.type,m=t.axesInfo[f]={key:f,axis:c,coordSys:n,axisPointerModel:h,triggerTooltip:s,involveSeries:g,snap:p,useHandle:cGt(h),seriesModels:[],linkGroup:null};l[f]=m,t.seriesInvolved=t.seriesInvolved||g;var y=function(t,e){for(var n=e.model,i=e.dim,r=0;r<t.length;r++){var o=t[r]||{};if(sGt(o[i+"AxisId"],n.id)||sGt(o[i+"AxisIndex"],n.componentIndex)||sGt(o[i+"AxisName"],n.name))return r}}(o,c);if(null!=y){var v=a[y]||(a[y]={axesInfo:{}});v.axesInfo[f]=m,v.mapper=o[y].mapper,m.linkGroup=v}}}}))}(n,t,e),n.seriesInvolved&&function(t,e){e.eachSeries((function(e){var n=e.coordinateSystem,i=e.get(["tooltip","trigger"],!0),r=e.get(["tooltip","show"],!0);n&&"none"!==i&&!1!==i&&"item"!==i&&!1!==r&&!1!==e.get(["axisPointer","show"],!0)&&S_t(t.coordSysAxesInfo[hGt(n.model)],(function(t){var i=t.axis;n.getAxis(i.dim)===i&&(t.seriesModels.push(e),null==t.seriesDataCount&&(t.seriesDataCount=0),t.seriesDataCount+=e.getData().count())}))}))}(n,t),n}function sGt(t,e){return"all"===t||E_t(t)&&w_t(t,e)>=0||t===e}function lGt(t){var e=uGt(t);if(e){var n=e.axisPointerModel,i=e.axis.scale,r=n.option,o=n.get("status"),a=n.get("value");null!=a&&(a=i.parse(a));var s=cGt(n);null==o&&(r.status=s?"show":"hide");var l=i.getExtent().slice();l[0]>l[1]&&l.reverse(),(null==a||a>l[1])&&(a=l[1]),a<l[0]&&(a=l[0]),r.value=a,s&&(r.status=e.axis.scale.isBlank()?"hide":"show")}}function uGt(t){var e=(t.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return e&&e.axesInfo[hGt(t)]}function cGt(t){return!!t.get(["handle","show"])}function hGt(t){return t.type+"||"+t.id}var dGt={},pGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(e,n,i,r){this.axisPointerClass&&lGt(e),t.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(e,i,!0)},e.prototype.updateAxisPointer=function(t,e,n,i){this._doUpdateAxisPointerClass(t,n,!1)},e.prototype.remove=function(t,e){var n=this._axisPointer;n&&n.remove(e)},e.prototype.dispose=function(e,n){this._disposeAxisPointer(n),t.prototype.dispose.apply(this,arguments)},e.prototype._doUpdateAxisPointerClass=function(t,n,i){var r=e.getAxisPointerClass(this.axisPointerClass);if(r){var o=function(t){var e=uGt(t);return e&&e.axisPointerModel}(t);o?(this._axisPointer||(this._axisPointer=new r)).render(t,o,n,i):this._disposeAxisPointer(n)}},e.prototype._disposeAxisPointer=function(t){this._axisPointer&&this._axisPointer.dispose(t),this._axisPointer=null},e.registerAxisPointerClass=function(t,e){dGt[t]=e},e.getAxisPointerClass=function(t){return t&&dGt[t]},e.type="axis",e}(nLt),fGt=jAt();function gGt(t,e,n,i){var r=n.axis;if(!r.scale.isBlank()){var o=n.getModel("splitArea"),a=o.getModel("areaStyle"),s=a.get("color"),l=i.coordinateSystem.getRect(),u=r.getTicksCoords({tickModel:o,clamp:!0});if(u.length){var c=s.length,h=fGt(t).splitAreaColors,d=Z_t(),p=0;if(h)for(var f=0;f<u.length;f++){var g=h.get(u[f].tickValue);if(null!=g){p=(g+(c-1)*f)%c;break}}var m=r.toGlobalCoord(u[0].coord),y=a.getAreaStyle();s=E_t(s)?s:[s];for(f=1;f<u.length;f++){var v=r.toGlobalCoord(u[f].coord),x=void 0,b=void 0,w=void 0,_=void 0;r.isHorizontal()?(x=m,b=l.y,w=v-x,_=l.height,m=x+w):(x=l.x,b=m,w=l.width,m=b+(_=v-b));var k=u[f-1].tickValue;null!=k&&d.set(k,p),e.add(new mDt({anid:null!=k?"area_"+k:null,shape:{x:x,y:b,width:w,height:_},style:x_t({fill:s[p]},y),autoBatch:!0,silent:!0})),p=(p+1)%c}fGt(t).splitAreaColors=d}}}function mGt(t){fGt(t).splitAreaColors=null}var yGt=["axisLine","axisTickLabel","axisName"],vGt=["splitArea","splitLine","minorSplitLine"],xGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.axisPointerClass="CartesianAxisPointer",n}return Dit(e,t),e.prototype.render=function(e,n,i,r){this.group.removeAll();var o=this._axisGroup;if(this._axisGroup=new oAt,this.group.add(this._axisGroup),e.get("show")){var a=e.getCoordSysModel(),s=HUt(a,e),l=new tGt(e,v_t({handleAutoShown:function(t){for(var n=a.coordinateSystem.getCartesians(),i=0;i<n.length;i++){var r=n[i].getOtherAxis(e.axis).type;if("value"===r||"log"===r)return!0}return!1}},s));S_t(yGt,l.add,l),this._axisGroup.add(l.getGroup()),S_t(vGt,(function(t){e.get([t,"show"])&&bGt[t](this,this._axisGroup,e,a)}),this),JEt(o,this._axisGroup,e),t.prototype.render.call(this,e,n,i,r)}},e.prototype.remove=function(){mGt(this)},e.type="cartesianAxis",e}(pGt),bGt={splitLine:function(t,e,n,i){var r=n.axis;if(!r.scale.isBlank()){var o=n.getModel("splitLine"),a=o.getModel("lineStyle"),s=a.get("color");s=E_t(s)?s:[s];for(var l=i.coordinateSystem.getRect(),u=r.isHorizontal(),c=0,h=r.getTicksCoords({tickModel:o}),d=[],p=[],f=a.getLineStyle(),g=0;g<h.length;g++){var m=r.toGlobalCoord(h[g].coord);u?(d[0]=m,d[1]=l.y,p[0]=m,p[1]=l.y+l.height):(d[0]=l.x,d[1]=m,p[0]=l.x+l.width,p[1]=m);var y=c++%s.length,v=h[g].tickValue;e.add(new hEt({anid:null!=v?"line_"+h[g].tickValue:null,subPixelOptimize:!0,autoBatch:!0,shape:{x1:d[0],y1:d[1],x2:p[0],y2:p[1]},style:x_t({stroke:s[y]},f),silent:!0}))}}},minorSplitLine:function(t,e,n,i){var r=n.axis,o=n.getModel("minorSplitLine").getModel("lineStyle"),a=i.coordinateSystem.getRect(),s=r.isHorizontal(),l=r.getMinorTicksCoords();if(l.length)for(var u=[],c=[],h=o.getLineStyle(),d=0;d<l.length;d++)for(var p=0;p<l[d].length;p++){var f=r.toGlobalCoord(l[d][p].coord);s?(u[0]=f,u[1]=a.y,c[0]=f,c[1]=a.y+a.height):(u[0]=a.x,u[1]=f,c[0]=a.x+a.width,c[1]=f),e.add(new hEt({anid:"minor_line_"+l[d][p].tickValue,subPixelOptimize:!0,autoBatch:!0,shape:{x1:u[0],y1:u[1],x2:c[0],y2:c[1]},style:h,silent:!0}))}},splitArea:function(t,e,n,i){gGt(t,e,n,i)}},wGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="xAxis",e}(xGt),_Gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=wGt.type,e}return Dit(e,t),e.type="yAxis",e}(xGt),kGt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="grid",e}return Dit(e,t),e.prototype.render=function(t,e){this.group.removeAll(),t.get("show")&&this.group.add(new mDt({shape:t.coordinateSystem.getRect(),style:x_t({fill:t.get("backgroundColor")},t.getItemStyle()),silent:!0,z2:-1}))},e.type="grid",e}(nLt),SGt={offset:0};function CGt(t){t.registerComponentView(kGt),t.registerComponentModel(NUt),t.registerCoordinateSystem("cartesian2d",YUt),zUt(t,"x",OUt,SGt),zUt(t,"y",OUt,SGt),t.registerComponentView(wGt),t.registerComponentView(_Gt),t.registerPreprocessor((function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})}))}function AGt(t){t.eachSeriesByType("radar",(function(t){var e=t.getData(),n=[],i=t.coordinateSystem;if(i){var r=i.getIndicatorAxes();S_t(r,(function(t,o){e.each(e.mapDimension(r[o].dim),(function(t,e){n[e]=n[e]||[];var r=i.dataToPoint(t,o);n[e][o]=IGt(r)?r:MGt(i)}))})),e.each((function(t){var r=function(t,e,n){if(t&&e)for(var i=0,r=t.length;i<r;i++)if(e.call(n,t[i],i,t))return t[i]}(n[t],(function(t){return IGt(t)}))||MGt(i);n[t].push(r.slice()),e.setItemLayout(t,n[t])}))}}))}function IGt(t){return!isNaN(t[0])&&!isNaN(t[1])}function MGt(t){return[t.cx,t.cy]}function DGt(t){var e=t.polar;if(e){E_t(e)||(e=[e]);var n=[];S_t(e,(function(e,i){e.indicator?(e.type&&!e.shape&&(e.shape=e.type),t.radar=t.radar||[],E_t(t.radar)||(t.radar=[t.radar]),t.radar.push(e)):n.push(e)})),t.polar=n}S_t(t.series,(function(t){t&&"radar"===t.type&&t.polarIndex&&(t.radarIndex=t.polarIndex)}))}var TGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.coordinateSystem,r=this.group,o=t.getData(),a=this._data;function s(t,e){var n=t.getItemVisual(e,"symbol")||"circle";if("none"!==n){var i=function(t){return E_t(t)||(t=[+t,+t]),t}(t.getItemVisual(e,"symbolSize")),r=U$t(n,-1,-1,2,2),o=t.getItemVisual(e,"symbolRotate")||0;return r.attr({style:{strokeNoScale:!0},z2:100,scaleX:i[0]/2,scaleY:i[1]/2,rotation:o*Math.PI/180||0}),r}}function l(e,n,i,r,o,a){i.removeAll();for(var l=0;l<n.length-1;l++){var u=s(r,o);u&&(u.__dimIdx=l,e[l]?(u.setPosition(e[l]),oNt[a?"initProps":"updateProps"](u,{x:n[l][0],y:n[l][1]},t,o)):u.setPosition(n[l]),i.add(u))}}function u(t){return C_t(t,(function(t){return[i.cx,i.cy]}))}o.diff(a).add((function(e){var n=o.getItemLayout(e);if(n){var i=new aEt,r=new lEt,a={shape:{points:n}};i.shape.points=u(n),r.shape.points=u(n),jEt(i,a,t,e),jEt(r,a,t,e);var s=new oAt,c=new oAt;s.add(r),s.add(i),s.add(c),l(r.shape.points,n,c,o,e,!0),o.setItemGraphicEl(e,s)}})).update((function(e,n){var i=a.getItemGraphicEl(n),r=i.childAt(0),s=i.childAt(1),u=i.childAt(2),c={shape:{points:o.getItemLayout(e)}};c.shape.points&&(l(r.shape.points,c.shape.points,u,o,e,!1),WEt(r,c,t),WEt(s,c,t),o.setItemGraphicEl(e,i))})).remove((function(t){r.remove(a.getItemGraphicEl(t))})).execute(),o.eachItemGraphicEl((function(t,e){var n=o.getItemModel(e),i=t.childAt(0),a=t.childAt(1),s=t.childAt(2),l=o.getItemVisual(e,"style"),u=l.fill;r.add(t),i.useStyle(x_t(n.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:u})),pTt(i,n,"lineStyle"),pTt(a,n,"areaStyle");var c=n.getModel("areaStyle"),h=c.isEmpty()&&c.parentModel.isEmpty();a.ignore=h,S_t(["emphasis","select","blur"],(function(t){var e=n.getModel([t,"areaStyle"]),i=e.isEmpty()&&e.parentModel.isEmpty();a.ensureState(t).ignore=i&&h})),a.useStyle(x_t(c.getAreaStyle(),{fill:u,opacity:.7,decal:l.decal}));var d=n.getModel("emphasis"),p=d.getModel("itemStyle").getItemStyle();s.eachChild((function(t){if(t instanceof uDt){var i=t.style;t.useStyle(v_t({image:i.image,x:i.x,y:i.y,width:i.width,height:i.height},l))}else t.useStyle(l),t.setColor(u);t.ensureState("emphasis").style=g_t(p);var r=o.get(o.dimensions[t.__dimIdx],e);(null==r||isNaN(r))&&(r=""),uNt(t,cNt(n),{labelFetcher:o.hostModel,labelDataIndex:e,labelDimIndex:t.__dimIdx,defaultText:r,inheritColor:u,defaultOpacity:l.opacity})})),uTt(t,d.get("focus"),d.get("blurScope"))})),this._data=o},e.prototype.remove=function(){this.group.removeAll(),this._data=null},e.type="radar",e}(aLt),EGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.useColorPaletteOnData=!0,n.hasSymbolVisual=!0,n}return Dit(e,t),e.prototype.init=function(e){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new CUt(D_t(this.getData,this),D_t(this.getRawData,this))},e.prototype.getInitialData=function(t,e){return SUt(this,{generateCoord:"indicator_",generateCoordCount:1/0})},e.prototype.formatTooltip=function(t,e,n){var i=this.getData(),r=this.coordinateSystem.getIndicatorAxes(),o=this.getData().getName(t),a=""===o?this.name:o,s=WRt(this,t);return RRt("section",{header:a,sortBlocks:!0,blocks:C_t(r,(function(e){var n=i.get(i.mapDimension(e.dim),t);return RRt("nameValue",{markerType:"subItem",markerColor:s,name:e.name,value:n,sortParam:n})}))})},e.prototype.getTooltipPosition=function(t){if(null!=t)for(var e=this.getData(),n=this.coordinateSystem,i=e.getValues(C_t(n.dimensions,(function(t){return e.mapDimension(t)})),t),r=0,o=i.length;r<o;r++)if(!isNaN(i[r])){var a=n.getIndicatorAxes();return n.coordToPoint(a[r].dataToCoord(i[r]),r)}},e.type="series.radar",e.dependencies=["radar"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{width:2,type:"solid"},label:{position:"top"},symbolSize:8},e}(XRt),NGt=$Ut.value;function OGt(t,e){return x_t({show:e},t)}var FGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.optionUpdated=function(){var t=this.get("boundaryGap"),e=this.get("splitNumber"),n=this.get("scale"),i=this.get("axisLine"),r=this.get("axisTick"),o=this.get("axisLabel"),a=this.get("axisName"),s=this.get(["axisName","show"]),l=this.get(["axisName","formatter"]),u=this.get("axisNameGap"),c=this.get("triggerEvent"),h=C_t(this.get("indicator")||[],(function(h){null!=h.max&&h.max>0&&!h.min?h.min=0:null!=h.min&&h.min<0&&!h.max&&(h.max=0);var d=a;null!=h.color&&(d=x_t({color:h.color},a));var p=m_t(g_t(h),{boundaryGap:t,splitNumber:e,scale:n,axisLine:i,axisTick:r,axisLabel:o,name:h.text,nameLocation:"end",nameGap:u,nameTextStyle:d,triggerEvent:c},!1);if(s||(p.name=""),"string"==typeof l){var f=p.name;p.name=l.replace("{value}",null!=f?f:"")}else"function"==typeof l&&(p.name=l(p.name,p));var g=new NNt(p,null,this.ecModel);return __t(g,iWt.prototype),g.mainType="radar",g.componentIndex=this.componentIndex,g}),this);this._indicatorModels=h},e.prototype.getIndicatorModels=function(){return this._indicatorModels},e.type="radar",e.defaultOption={zlevel:0,z:0,center:["50%","50%"],radius:"75%",startAngle:90,axisName:{show:!0},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:!1,shape:"polygon",axisLine:m_t({lineStyle:{color:"#bbb"}},NGt.axisLine),axisLabel:OGt(NGt.axisLabel,!1),axisTick:OGt(NGt.axisTick,!1),splitLine:OGt(NGt.splitLine,!0),splitArea:OGt(NGt.splitArea,!0),indicator:[]},e}(FOt),RGt=["axisLine","axisTickLabel","axisName"],LGt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){this.group.removeAll(),this._buildAxes(t),this._buildSplitLineAndArea(t)},e.prototype._buildAxes=function(t){var e=t.coordinateSystem;S_t(C_t(e.getIndicatorAxes(),(function(t){return new tGt(t.model,{position:[e.cx,e.cy],rotation:t.angle,labelDirection:-1,tickDirection:-1,nameDirection:1})})),(function(t){S_t(RGt,t.add,t),this.group.add(t.getGroup())}),this)},e.prototype._buildSplitLineAndArea=function(t){var e=t.coordinateSystem,n=e.getIndicatorAxes();if(n.length){var i=t.get("shape"),r=t.getModel("splitLine"),o=t.getModel("splitArea"),a=r.getModel("lineStyle"),s=o.getModel("areaStyle"),l=r.get("show"),u=o.get("show"),c=a.get("color"),h=s.get("color"),d=E_t(c)?c:[c],p=E_t(h)?h:[h],f=[],g=[];if("circle"===i)for(var m=n[0].getTicksCoords(),y=e.cx,v=e.cy,x=0;x<m.length;x++){if(l)f[I(f,d,x)].push(new $Tt({shape:{cx:y,cy:v,r:m[x].coord}}));if(u&&x<m.length-1)g[I(g,p,x)].push(new nEt({shape:{cx:y,cy:v,r0:m[x].coord,r:m[x+1].coord}}))}else{var b,w=C_t(n,(function(t,n){var i=t.getTicksCoords();return b=null==b?i.length-1:Math.min(i.length-1,b),C_t(i,(function(t){return e.coordToPoint(t.coord,n)}))})),_=[];for(x=0;x<=b;x++){for(var k=[],S=0;S<n.length;S++)k.push(w[S][x]);if(k[0]&&k.push(k[0].slice()),l)f[I(f,d,x)].push(new lEt({shape:{points:k}}));if(u&&_)g[I(g,p,x-1)].push(new aEt({shape:{points:k.concat(_)}}));_=k.slice().reverse()}}var C=a.getLineStyle(),A=s.getAreaStyle();S_t(g,(function(t,e){this.group.add(PEt(t,{style:x_t({stroke:"none",fill:p[e%p.length]},A),silent:!0}))}),this),S_t(f,(function(t,e){this.group.add(PEt(t,{style:x_t({fill:"none",stroke:d[e%d.length]},C),silent:!0}))}),this)}function I(t,e,n){var i=n%e.length;return t[i]=t[i]||[],i}},e.type="radar",e}(nLt),$Gt=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.type="value",r.angle=0,r.name="",r}return Dit(e,t),e}(fWt),PGt=function(){function t(t,e,n){this.dimensions=[],this._model=t,this._indicatorAxes=C_t(t.getIndicatorModels(),(function(t,e){var n="indicator_"+e,i=new $Gt(n,new pVt);return i.name=t.get("name"),i.model=t,t.axis=i,this.dimensions.push(n),i}),this),this.resize(t,n)}return t.prototype.getIndicatorAxes=function(){return this._indicatorAxes},t.prototype.dataToPoint=function(t,e){var n=this._indicatorAxes[e];return this.coordToPoint(n.dataToCoord(t),e)},t.prototype.coordToPoint=function(t,e){var n=this._indicatorAxes[e].angle;return[this.cx+t*Math.cos(n),this.cy-t*Math.sin(n)]},t.prototype.pointToData=function(t){var e=t[0]-this.cx,n=t[1]-this.cy,i=Math.sqrt(e*e+n*n);e/=i,n/=i;for(var r,o=Math.atan2(-n,e),a=1/0,s=-1,l=0;l<this._indicatorAxes.length;l++){var u=this._indicatorAxes[l],c=Math.abs(o-u.angle);c<a&&(r=u,s=l,a=c)}return[s,+(r&&r.coordToData(i))]},t.prototype.resize=function(t,e){var n=t.get("center"),i=e.getWidth(),r=e.getHeight(),o=Math.min(i,r)/2;this.cx=dAt(n[0],i),this.cy=dAt(n[1],r),this.startAngle=t.get("startAngle")*Math.PI/180;var a=t.get("radius");"string"!=typeof a&&"number"!=typeof a||(a=[0,a]),this.r0=dAt(a[0],o),this.r=dAt(a[1],o),S_t(this._indicatorAxes,(function(t,e){t.setExtent(this.r0,this.r);var n=this.startAngle+e*Math.PI*2/this._indicatorAxes.length;n=Math.atan2(Math.sin(n),Math.cos(n)),t.angle=n}),this)},t.prototype.update=function(t,e){var n=this._indicatorAxes,i=this._model;S_t(n,(function(t){t.scale.setExtent(1/0,-1/0)})),t.eachSeriesByType("radar",(function(e,r){if("radar"===e.get("coordinateSystem")&&t.getComponent("radar",e.get("radarIndex"))===i){var o=e.getData();S_t(n,(function(t){t.scale.unionExtentFromData(o,o.mapDimension(t.dim))}))}}),this);var r=i.get("splitNumber");function o(t){var e=Math.pow(10,Math.floor(Math.log(t)/Math.LN10)),n=t/e;return 2===n?n=5:n*=2,n*e}S_t(n,(function(t,e){var n=YVt(t.scale,t.model).extent;KVt(t.scale,t.model);var i=t.model,a=t.scale,s=XVt(a,i.get("min",!0)),l=XVt(a,i.get("max",!0)),u=a.getInterval();if(null!=s&&null!=l)a.setExtent(+s,+l),a.setInterval((l-s)/r);else if(null!=s){var c=void 0;do{c=s+u*r,a.setExtent(+s,c),a.setInterval(u),u=o(u)}while(c<n[1]&&isFinite(c)&&isFinite(n[1]))}else if(null!=l){var h=void 0;do{h=l-u*r,a.setExtent(h,+l),a.setInterval(u),u=o(u)}while(h>n[0]&&isFinite(h)&&isFinite(n[0]))}else{a.getTicks().length-1>r&&(u=o(u));h=pAt((c=Math.ceil(n[1]/u)*u)-u*r);a.setExtent(h,c),a.setInterval(u)}}))},t.prototype.convertToPixel=function(t,e,n){return console.warn("Not implemented."),null},t.prototype.convertFromPixel=function(t,e,n){return console.warn("Not implemented."),null},t.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},t.create=function(e,n){var i=[];return e.eachComponent("radar",(function(r){var o=new t(r,e,n);i.push(o),r.coordinateSystem=o})),e.eachSeriesByType("radar",(function(t){"radar"===t.get("coordinateSystem")&&(t.coordinateSystem=i[t.get("radarIndex")||0])})),i},t.dimensions=[],t}();function zGt(t){t.registerCoordinateSystem("radar",PGt),t.registerComponentModel(FGt),t.registerComponentView(LGt),t.registerVisual({seriesType:"radar",reset:function(t){var e=t.getData();e.each((function(t){e.setItemVisual(t,"legendIcon","roundRect")})),e.setVisual("legendIcon","roundRect")}})}var BGt="\0_ec_interaction_mutex";function VGt(t,e){return!!WGt(t)[e]}function WGt(t){return t[BGt]||(t[BGt]={})}sBt({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},(function(){}));var jGt=function(t){function e(e){var n=t.call(this)||this;n._zr=e;var i=D_t(n._mousedownHandler,n),r=D_t(n._mousemoveHandler,n),o=D_t(n._mouseupHandler,n),a=D_t(n._mousewheelHandler,n),s=D_t(n._pinchHandler,n);return n.enable=function(t,n){this.disable(),this._opt=x_t(g_t(n)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),null==t&&(t=!0),!0!==t&&"move"!==t&&"pan"!==t||(e.on("mousedown",i),e.on("mousemove",r),e.on("mouseup",o)),!0!==t&&"scale"!==t&&"zoom"!==t||(e.on("mousewheel",a),e.on("pinch",s))},n.disable=function(){e.off("mousedown",i),e.off("mousemove",r),e.off("mouseup",o),e.off("mousewheel",a),e.off("pinch",s)},n}return Dit(e,t),e.prototype.isDragging=function(){return this._dragging},e.prototype.isPinching=function(){return this._pinching},e.prototype.setPointerChecker=function(t){this.pointerChecker=t},e.prototype.dispose=function(){this.disable()},e.prototype._mousedownHandler=function(t){if(!($kt(t)||t.target&&t.target.draggable)){var e=t.offsetX,n=t.offsetY;this.pointerChecker&&this.pointerChecker(t,e,n)&&(this._x=e,this._y=n,this._dragging=!0)}},e.prototype._mousemoveHandler=function(t){if(this._dragging&&HGt("moveOnMouseMove",t,this._opt)&&"pinch"!==t.gestureEvent&&!VGt(this._zr,"globalPan")){var e=t.offsetX,n=t.offsetY,i=this._x,r=this._y,o=e-i,a=n-r;this._x=e,this._y=n,this._opt.preventDefaultMouseMove&&Lkt(t.event),GGt(this,"pan","moveOnMouseMove",t,{dx:o,dy:a,oldX:i,oldY:r,newX:e,newY:n,isAvailableBehavior:null})}},e.prototype._mouseupHandler=function(t){$kt(t)||(this._dragging=!1)},e.prototype._mousewheelHandler=function(t){var e=HGt("zoomOnMouseWheel",t,this._opt),n=HGt("moveOnMouseWheel",t,this._opt),i=t.wheelDelta,r=Math.abs(i),o=t.offsetX,a=t.offsetY;if(0!==i&&(e||n)){if(e){var s=r>3?1.4:r>1?1.2:1.1;UGt(this,"zoom","zoomOnMouseWheel",t,{scale:i>0?s:1/s,originX:o,originY:a,isAvailableBehavior:null})}if(n){var l=Math.abs(i);UGt(this,"scrollMove","moveOnMouseWheel",t,{scrollDelta:(i>0?1:-1)*(l>3?.4:l>1?.15:.05),originX:o,originY:a,isAvailableBehavior:null})}}},e.prototype._pinchHandler=function(t){VGt(this._zr,"globalPan")||UGt(this,"zoom",null,t,{scale:t.pinchScale>1?1.1:1/1.1,originX:t.pinchX,originY:t.pinchY,isAvailableBehavior:null})},e}(bkt);function UGt(t,e,n,i,r){t.pointerChecker&&t.pointerChecker(i,r.originX,r.originY)&&(Lkt(i.event),GGt(t,e,n,i,r))}function GGt(t,e,n,i,r){r.isAvailableBehavior=D_t(HGt,null,n,i),t.trigger(e,r)}function HGt(t,e,n){var i=n[t];return!t||i&&(!O_t(i)||e.event[i+"Key"])}function qGt(t,e,n){var i=t.target;i.x+=e,i.y+=n,i.dirty()}function XGt(t,e,n,i){var r=t.target,o=t.zoomLimit,a=t.zoom=t.zoom||1;if(a*=e,o){var s=o.min||0,l=o.max||1/0;a=Math.max(Math.min(l,a),s)}var u=a/t.zoom;t.zoom=a,r.x-=(n-r.x)*(u-1),r.y-=(i-r.y)*(u-1),r.scaleX*=u,r.scaleY*=u,r.dirty()}var YGt={axisPointer:1,tooltip:1,brush:1};function KGt(t,e,n){var i=e.getComponentByElement(t.topTarget),r=i&&i.coordinateSystem;return i&&i!==n&&!YGt.hasOwnProperty(i.mainType)&&r&&r.model!==n}var ZGt=["rect","circle","line","ellipse","polygon","polyline","path"],JGt=Z_t(ZGt),QGt=Z_t(ZGt.concat(["g"])),tHt=Z_t(ZGt.concat(["g"])),eHt=jAt();function nHt(t){var e=t.getItemStyle(),n=t.get("areaColor");return null!=n&&(e.fill=n),e}var iHt=function(){function t(t){var e=new oAt;this.uid=FNt("ec_map_draw"),this._controller=new jGt(t.getZr()),this._controllerHost={target:e},this.group=e,e.add(this._regionsGroup=new oAt),e.add(this._svgGroup=new oAt)}return t.prototype.draw=function(t,e,n,i,r){var o="geo"===t.mainType,a=t.getData&&t.getData();o&&e.eachComponent({mainType:"series",subType:"map"},(function(e){a||e.getHostGeoModel()!==t||(a=e.getData())}));var s=t.coordinateSystem,l=this._regionsGroup,u=this.group,c=s.getTransformInfo(),h=c.raw,d=c.roam;!l.childAt(0)||r?(u.x=d.x,u.y=d.y,u.scaleX=d.scaleX,u.scaleY=d.scaleY,u.dirty()):WEt(u,d,t);var p=a&&a.getVisual("visualMeta")&&a.getVisual("visualMeta").length>0,f={api:n,geo:s,mapOrGeoModel:t,data:a,isVisualEncodedByVisualMap:p,isGeo:o,transformInfoRaw:h};"geoJSON"===s.resourceType?this._buildGeoJSON(f):"geoSVG"===s.resourceType&&this._buildSVG(f),this._updateController(t,e,n),this._updateMapSelectHandler(t,l,n,i)},t.prototype._buildGeoJSON=function(t){var e=this._regionsGroupByName=Z_t(),n=Z_t(),i=this._regionsGroup,r=t.transformInfoRaw,o=t.mapOrGeoModel,a=t.data,s=function(t){return[t[0]*r.scaleX+r.x,t[1]*r.scaleY+r.y]};i.removeAll(),S_t(t.geo.regions,(function(r){var l=r.name,u=e.get(l),c=n.get(l)||{},h=c.dataIdx,d=c.regionModel;u||(u=e.set(l,new oAt),i.add(u),h=a?a.indexOfName(l):null,d=t.isGeo?o.getRegionModel(l):a?a.getItemModel(h):null,n.set(l,{dataIdx:h,regionModel:d}));var p=new vEt({segmentIgnoreThreshold:1,shape:{paths:[]}});u.add(p),S_t(r.geometries,(function(t){if("polygon"===t.type){for(var e=[],n=0;n<t.exterior.length;++n)e.push(s(t.exterior[n]));p.shape.paths.push(new aEt({segmentIgnoreThreshold:1,shape:{points:e}}));for(n=0;n<(t.interiors?t.interiors.length:0);++n){for(var i=t.interiors[n],r=[],o=0;o<i.length;++o)r.push(s(i[o]));p.shape.paths.push(new aEt({segmentIgnoreThreshold:1,shape:{points:r}}))}}})),rHt(t,p,h,d),p instanceof OIt&&(p.culling=!0);var f=s(r.getCenter());oHt(t,p,l,d,o,h,f)})),e.each((function(e,i){var r=n.get(i),a=r.dataIdx,s=r.regionModel;aHt(t,e,i,s,o,a),sHt(t,e,i,s,o),lHt(t,e,i,s,o)}),this)},t.prototype._buildSVG=function(t){var e=t.geo.map,n=t.transformInfoRaw;this._svgGroup.x=n.x,this._svgGroup.y=n.y,this._svgGroup.scaleX=n.scaleX,this._svgGroup.scaleY=n.scaleY,this._svgResourceChanged(e)&&(this._freeSVG(),this._useSVG(e));var i=this._svgDispatcherMap=Z_t(),r=!1;S_t(this._svgGraphicRecord.named,(function(e){var n=e.name,o=t.mapOrGeoModel,a=t.data,s=e.svgNodeTagLower,l=e.el,u=a?a.indexOfName(n):null,c=o.getRegionModel(n);(null!=JGt.get(s)&&l instanceof OIt&&rHt(t,l,u,c),l instanceof OIt&&(l.culling=!0),l.z2EmphasisLift=0,e.namedFrom)||(null!=tHt.get(s)&&oHt(t,l,n,c,o,u,null),aHt(t,l,n,c,o,u),sHt(t,l,n,c,o),null!=QGt.get(s)&&("self"===lHt(t,l,n,c,o)&&(r=!0),(i.get(n)||i.set(n,[])).push(l)))}),this),this._enableBlurEntireSVG(r,t)},t.prototype._enableBlurEntireSVG=function(t,e){if(t&&e.isGeo){var n=e.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle().opacity;this._svgGraphicRecord.root.traverse((function(t){if(!t.isGroup){qDt(t);var e=t.ensureState("blur").style||{};null==e.opacity&&null!=n&&(e.opacity=n),t.ensureState("emphasis")}}))}},t.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},t.prototype.findHighDownDispatchers=function(t,e){if(null==t)return[];var n=e.coordinateSystem;if("geoJSON"===n.resourceType){var i=this._regionsGroupByName;if(i){var r=i.get(t);return r?[r]:[]}}else if("geoSVG"===n.resourceType)return this._svgDispatcherMap&&this._svgDispatcherMap.get(t)||[]},t.prototype._svgResourceChanged=function(t){return this._svgMapName!==t},t.prototype._useSVG=function(t){var e=ozt(t);if(e&&"geoSVG"===e.type){var n=e.useGraphic(this.uid);this._svgGroup.add(n.root),this._svgGraphicRecord=n,this._svgMapName=t}},t.prototype._freeSVG=function(){var t=this._svgMapName;if(null!=t){var e=ozt(t);e&&"geoSVG"===e.type&&e.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},t.prototype._updateController=function(t,e,n){var i=t.coordinateSystem,r=this._controller,o=this._controllerHost;o.zoomLimit=t.get("scaleLimit"),o.zoom=i.getZoom(),r.enable(t.get("roam")||!1);var a=t.mainType;function s(){var e={type:"geoRoam",componentType:a};return e[a+"Id"]=t.id,e}r.off("pan").on("pan",(function(t){this._mouseDownFlag=!1,qGt(o,t.dx,t.dy),n.dispatchAction(v_t(s(),{dx:t.dx,dy:t.dy}))}),this),r.off("zoom").on("zoom",(function(t){this._mouseDownFlag=!1,XGt(o,t.scale,t.originX,t.originY),n.dispatchAction(v_t(s(),{zoom:t.scale,originX:t.originX,originY:t.originY}))}),this),r.setPointerChecker((function(e,r,o){return i.containPoint([r,o])&&!KGt(e,n,t)}))},t.prototype.resetForLabelLayout=function(){this.group.traverse((function(t){var e=t.getTextContent();e&&(e.ignore=eHt(e).ignore)}))},t.prototype._updateMapSelectHandler=function(t,e,n,i){var r=this;e.off("mousedown"),e.off("click"),t.get("selectedMode")&&(e.on("mousedown",(function(){r._mouseDownFlag=!0})),e.on("click",(function(t){r._mouseDownFlag&&(r._mouseDownFlag=!1)})))},t}();function rHt(t,e,n,i){var r=i.getModel("itemStyle"),o=i.getModel(["emphasis","itemStyle"]),a=i.getModel(["blur","itemStyle"]),s=i.getModel(["select","itemStyle"]),l=nHt(r),u=nHt(o),c=nHt(s),h=nHt(a),d=t.data;if(d){var p=d.getItemVisual(n,"style"),f=d.getItemVisual(n,"decal");t.isVisualEncodedByVisualMap&&p.fill&&(l.fill=p.fill),f&&(l.decal=pPt(f,t.api))}e.setStyle(l),e.style.strokeNoScale=!0,e.ensureState("emphasis").style=u,e.ensureState("select").style=c,e.ensureState("blur").style=h,qDt(e)}function oHt(t,e,n,i,r,o,a){var s=t.data,l=t.isGeo,u=s&&isNaN(s.get(s.mapDimension("value"),o)),c=s&&s.getItemLayout(o);if(l||u||c&&c.showLabel){var h=l?n:o,d=void 0;(!s||o>=0)&&(d=r);var p=a?{normal:{align:"center",verticalAlign:"middle"}}:null;uNt(e,cNt(i),{labelFetcher:d,labelDataIndex:h,defaultText:n},p);var f=e.getTextContent();if(f&&(eHt(f).ignore=f.ignore,e.textConfig&&a)){var g=e.getBoundingRect().clone();e.textConfig.layoutRect=g,e.textConfig.position=[(a[0]-g.x)/g.width*100+"%",(a[1]-g.y)/g.height*100+"%"]}e.disableLabelAnimation=!0}else e.removeTextContent(),e.removeTextConfig(),e.disableLabelAnimation=null}function aHt(t,e,n,i,r,o){t.data?t.data.setItemGraphicEl(o,e):IDt(e).eventData={componentType:"geo",componentIndex:r.componentIndex,geoIndex:r.componentIndex,name:n,region:i&&i.option||{}}}function sHt(t,e,n,i,r){t.data||rNt({el:e,componentModel:r,itemName:n,itemTooltipOption:i.get("tooltip")})}function lHt(t,e,n,i,r){e.highDownSilentOnTouch=!!r.get("selectedMode");var o=i.getModel("emphasis"),a=o.get("focus");return uTt(e,a,o.get("blurScope")),t.isGeo&&function(t,e,n){var i=IDt(t);i.componentMainType=e.mainType,i.componentIndex=e.componentIndex,i.componentHighDownName=n}(e,r,n),a}var uHt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n,i){if(!i||"mapToggleSelect"!==i.type||i.from!==this.uid){var r=this.group;if(r.removeAll(),!t.getHostGeoModel()){if(this._mapDraw&&i&&"geoRoam"===i.type&&this._mapDraw.resetForLabelLayout(),i&&"geoRoam"===i.type&&"series"===i.componentType&&i.seriesId===t.id)(o=this._mapDraw)&&r.add(o.group);else if(t.needsDrawMap){var o=this._mapDraw||new iHt(n);r.add(o.group),o.draw(t,e,n,this,i),this._mapDraw=o}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;t.get("showLegendSymbol")&&e.getComponent("legend")&&this._renderSymbols(t,e,n)}}},e.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},e.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},e.prototype._renderSymbols=function(t,e,n){var i=t.originalData,r=this.group;i.each(i.mapDimension("value"),(function(e,n){if(!isNaN(e)){var o=i.getItemLayout(n);if(o&&o.point){var a=o.point,s=o.offset,l=new $Tt({style:{fill:t.getData().getVisual("style").fill},shape:{cx:a[0]+9*s,cy:a[1],r:3},silent:!0,z2:8+(s?0:11)});if(!s){var u=t.mainSeries.getData(),c=i.getName(n),h=u.indexOfName(c),d=i.getItemModel(n),p=d.getModel("label"),f=u.getItemGraphicEl(h);uNt(l,cNt(d),{labelFetcher:{getFormattedLabel:function(e,n){return t.getFormattedLabel(h,n)}}}),l.disableLabelAnimation=!0,p.get("position")||l.setTextConfig({position:"bottom"}),f.onHoverStateChange=function(t){GDt(l,t)}}r.add(l)}}}))},e.type="map",e}(aLt),cHt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.needsDrawMap=!1,n.seriesGroup=[],n.getTooltipPosition=function(t){if(null!=t){var e=this.getData().getName(t),n=this.coordinateSystem,i=n.getRegion(e);return i&&n.dataToPoint(i.getCenter())}},n}return Dit(e,t),e.prototype.getInitialData=function(t){for(var e=SUt(this,{coordDimensions:["value"],encodeDefaulter:T_t(UOt,this)}),n=Z_t(),i=[],r=0,o=e.count();r<o;r++){var a=e.getName(r);n.set(a,!0)}return S_t(azt(this.getMapType(),this.option.nameMap,this.option.nameProperty).regions,(function(t){var e=t.name;n.get(e)||i.push(e)})),e.appendValues([],i),e},e.prototype.getHostGeoModel=function(){var t=this.option.geoIndex;return null!=t?this.ecModel.getComponent("geo",t):null},e.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},e.prototype.getRawValue=function(t){var e=this.getData();return e.get(e.mapDimension("value"),t)},e.prototype.getRegionModel=function(t){var e=this.getData();return e.getItemModel(e.indexOfName(t))},e.prototype.formatTooltip=function(t,e,n){for(var i=this.getData(),r=this.getRawValue(t),o=i.getName(t),a=this.seriesGroup,s=[],l=0;l<a.length;l++){var u=a[l].originalData.indexOfName(o),c=i.mapDimension("value");isNaN(a[l].originalData.get(c,u))||s.push(a[l].name)}return RRt("section",{header:s.join(", "),noHeader:!s.length,blocks:[RRt("nameValue",{name:o,value:r})]})},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.getLegendIcon=function(t){var e=t.icon||"roundRect",n=U$t(e,0,0,t.itemWidth,t.itemHeight,t.itemStyle.fill);return n.setStyle(t.itemStyle),n.style.stroke="none",e.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill="#fff",n.style.lineWidth=2),n},e.type="series.map",e.dependencies=["geo"],e.layoutMode="box",e.defaultOption={zlevel:0,z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},e}(XRt);function hHt(t){var e={};t.eachSeriesByType("map",(function(t){var n=t.getHostGeoModel(),i=n?"o"+n.id:"i"+t.getMapType();(e[i]=e[i]||[]).push(t)})),S_t(e,(function(t,e){for(var n,i,r,o=(n=C_t(t,(function(t){return t.getData()})),i=t[0].get("mapValueCalculation"),r={},S_t(n,(function(t){t.each(t.mapDimension("value"),(function(e,n){var i="ec-"+t.getName(n);r[i]=r[i]||[],isNaN(e)||r[i].push(e)}))})),n[0].map(n[0].mapDimension("value"),(function(t,e){for(var o="ec-"+n[0].getName(e),a=0,s=1/0,l=-1/0,u=r[o].length,c=0;c<u;c++)s=Math.min(s,r[o][c]),l=Math.max(l,r[o][c]),a+=r[o][c];return 0===u?NaN:"min"===i?s:"max"===i?l:"average"===i?a/u:a}))),a=0;a<t.length;a++)t[a].originalData=t[a].getData();for(a=0;a<t.length;a++)t[a].seriesGroup=t,t[a].needsDrawMap=0===a&&!t[a].getHostGeoModel(),t[a].setData(o.cloneShallow()),t[a].mainSeries=t[0]}))}function dHt(t){var e={};t.eachSeriesByType("map",(function(n){var i=n.getMapType();if(!n.getHostGeoModel()&&!e[i]){var r={};S_t(n.seriesGroup,(function(e){var n=e.coordinateSystem,i=e.originalData;e.get("showLegendSymbol")&&t.getComponent("legend")&&i.each(i.mapDimension("value"),(function(t,e){var o=i.getName(e),a=n.getRegion(o);if(a&&!isNaN(t)){var s=r[o]||0,l=n.dataToPoint(a.getCenter());r[o]=s+1,i.setItemLayout(e,{point:l,offset:s})}}))}));var o=n.getData();o.each((function(t){var e=o.getName(t),n=o.getItemLayout(t)||{};n.showLabel=!r[e],o.setItemLayout(t,n)})),e[i]=!0}}))}var pHt=gkt,fHt=function(t){function e(e){var n=t.call(this)||this;return n.type="view",n.dimensions=["x","y"],n._roamTransformable=new MCt,n._rawTransformable=new MCt,n.name=e,n}return Dit(e,t),e.prototype.setBoundingRect=function(t,e,n,i){return this._rect=new PCt(t,e,n,i),this._rect},e.prototype.getBoundingRect=function(){return this._rect},e.prototype.setViewRect=function(t,e,n,i){this._transformTo(t,e,n,i),this._viewRect=new PCt(t,e,n,i)},e.prototype._transformTo=function(t,e,n,i){var r=this.getBoundingRect(),o=this._rawTransformable;o.transform=r.calculateTransform(new PCt(t,e,n,i));var a=o.parent;o.parent=null,o.decomposeTransform(),o.parent=a,this._updateTransform()},e.prototype.setCenter=function(t){t&&(this._center=t,this._updateCenterAndZoom())},e.prototype.setZoom=function(t){t=t||1;var e=this.zoomLimit;e&&(null!=e.max&&(t=Math.min(e.max,t)),null!=e.min&&(t=Math.max(e.min,t))),this._zoom=t,this._updateCenterAndZoom()},e.prototype.getDefaultCenter=function(){var t=this.getBoundingRect();return[t.x+t.width/2,t.y+t.height/2]},e.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},e.prototype.getZoom=function(){return this._zoom||1},e.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},e.prototype._updateCenterAndZoom=function(){var t=this._rawTransformable.getLocalTransform(),e=this._roamTransformable,n=this.getDefaultCenter(),i=this.getCenter(),r=this.getZoom();i=gkt([],i,t),n=gkt([],n,t),e.originX=i[0],e.originY=i[1],e.x=n[0]-i[0],e.y=n[1]-i[1],e.scaleX=e.scaleY=r,this._updateTransform()},e.prototype._updateTransform=function(){var t=this._roamTransformable,e=this._rawTransformable;e.parent=t,t.updateTransform(),e.updateTransform(),fCt(this.transform||(this.transform=[]),e.transform||[1,0,0,1,0,0]),this._rawTransform=e.getLocalTransform(),this.invTransform=this.invTransform||[],xCt(this.invTransform,this.transform),this.decomposeTransform()},e.prototype.getTransformInfo=function(){var t=this._rawTransformable,e=this._roamTransformable,n=new MCt;return n.transform=e.transform,n.decomposeTransform(),{roam:{x:n.x,y:n.y,scaleX:n.scaleX,scaleY:n.scaleY},raw:{x:t.x,y:t.y,scaleX:t.scaleX,scaleY:t.scaleY}}},e.prototype.getViewRect=function(){return this._viewRect},e.prototype.getViewRectAfterRoam=function(){var t=this.getBoundingRect().clone();return t.applyTransform(this.transform),t},e.prototype.dataToPoint=function(t,e,n){var i=e?this._rawTransform:this.transform;return n=n||[],i?pHt(n,t,i):ikt(n,t)},e.prototype.pointToData=function(t){var e=this.invTransform;return e?pHt([],t,e):[t[0],t[1]]},e.prototype.convertToPixel=function(t,e,n){var i=gHt(e);return i===this?i.dataToPoint(n):null},e.prototype.convertFromPixel=function(t,e,n){var i=gHt(e);return i===this?i.pointToData(n):null},e.prototype.containPoint=function(t){return this.getViewRectAfterRoam().contain(t[0],t[1])},e.dimensions=["x","y"],e}(MCt);function gHt(t){var e=t.seriesModel;return e?e.coordinateSystem:null}var mHt={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},yHt=function(t){function e(e,n,i){var r=t.call(this,e)||this;r.dimensions=["lng","lat"],r.type="geo",r._nameCoordMap=Z_t(),r.map=n;var o=azt(n,i.nameMap,i.nameProperty),a=ozt(n);r.resourceType=a?a.type:null;var s=mHt[a.type];r._regionsMap=o.regionsMap,r._invertLongitute=s.invertLongitute,r.regions=o.regions,r.aspectScale=W_t(i.aspectScale,s.aspectScale);var l=o.boundingRect;return r.setBoundingRect(l.x,l.y,l.width,l.height),r}return Dit(e,t),e.prototype._transformTo=function(t,e,n,i){var r=this.getBoundingRect(),o=this._invertLongitute;r=r.clone(),o&&(r.y=-r.y-r.height);var a=this._rawTransformable;a.transform=r.calculateTransform(new PCt(t,e,n,i));var s=a.parent;a.parent=null,a.decomposeTransform(),a.parent=s,o&&(a.scaleY=-a.scaleY),this._updateTransform()},e.prototype.getRegion=function(t){return this._regionsMap.get(t)},e.prototype.getRegionByCoord=function(t){for(var e=this.regions,n=0;n<e.length;n++){var i=e[n];if("geoJSON"===i.type&&i.contain(t))return e[n]}},e.prototype.addGeoCoord=function(t,e){this._nameCoordMap.set(t,e)},e.prototype.getGeoCoord=function(t){var e=this._regionsMap.get(t);return this._nameCoordMap.get(t)||e&&e.getCenter()},e.prototype.dataToPoint=function(t,e,n){if("string"==typeof t&&(t=this.getGeoCoord(t)),t)return fHt.prototype.dataToPoint.call(this,t,e,n)},e.prototype.convertToPixel=function(t,e,n){var i=vHt(e);return i===this?i.dataToPoint(n):null},e.prototype.convertFromPixel=function(t,e,n){var i=vHt(e);return i===this?i.pointToData(n):null},e}(fHt);function vHt(t){var e=t.geoModel,n=t.seriesModel;return e?e.coordinateSystem:n?n.coordinateSystem||(n.getReferringComponents("geo",qAt).models[0]||{}).coordinateSystem:null}function xHt(t,e){var n=t.get("boundingCoords");if(null!=n){var i=n[0],r=n[1];isNaN(i[0])||isNaN(i[1])||isNaN(r[0])||isNaN(r[1])||this.setBoundingRect(i[0],i[1],r[0]-i[0],r[1]-i[1])}var o,a,s,l=this.getBoundingRect(),u=t.get("layoutCenter"),c=t.get("layoutSize"),h=e.getWidth(),d=e.getHeight(),p=l.width/l.height*this.aspectScale,f=!1;if(u&&c&&(o=[dAt(u[0],h),dAt(u[1],d)],a=dAt(c,Math.min(h,d)),isNaN(o[0])||isNaN(o[1])||isNaN(a)||(f=!0)),f)s={},p>1?(s.width=a,s.height=a/p):(s.height=a,s.width=a*p),s.y=o[1]-s.height/2,s.x=o[0]-s.width/2;else{var g=t.getBoxLayoutParams();g.aspect=p,s=IOt(g,{width:h,height:d})}this.setViewRect(s.x,s.y,s.width,s.height),this.setCenter(t.get("center")),this.setZoom(t.get("zoom"))}__t(yHt,fHt);var bHt=new(function(){function t(){this.dimensions=yHt.prototype.dimensions}return t.prototype.create=function(t,e){var n=[];t.eachComponent("geo",(function(t,i){var r=t.get("map"),o=new yHt(r+i,r,{nameMap:t.get("nameMap"),nameProperty:t.get("nameProperty"),aspectScale:t.get("aspectScale")});o.zoomLimit=t.get("scaleLimit"),n.push(o),t.coordinateSystem=o,o.model=t,o.resize=xHt,o.resize(t,e)})),t.eachSeries((function(t){if("geo"===t.get("coordinateSystem")){var e=t.get("geoIndex")||0;t.coordinateSystem=n[e]}}));var i={};return t.eachSeriesByType("map",(function(t){if(!t.getHostGeoModel()){var e=t.getMapType();i[e]=i[e]||[],i[e].push(t)}})),S_t(i,(function(t,i){var r=C_t(t,(function(t){return t.get("nameMap")})),o=new yHt(i,i,{nameMap:y_t(r),nameProperty:t[0].get("nameProperty"),aspectScale:t[0].get("aspectScale")});o.zoomLimit=V_t.apply(null,C_t(t,(function(t){return t.get("scaleLimit")}))),n.push(o),o.resize=xHt,o.resize(t[0],e),S_t(t,(function(t){t.coordinateSystem=o,function(t,e){S_t(e.get("geoCoord"),(function(e,n){t.addGeoCoord(n,e)}))}(o,t)}))})),n},t.prototype.getFilledRegions=function(t,e,n,i){for(var r=(t||[]).slice(),o=Z_t(),a=0;a<r.length;a++)o.set(r[a].name,r[a]);return S_t(azt(e,n,i).regions,(function(t){var e=t.name;!o.get(e)&&r.push({name:e})})),r},t}()),wHt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(t,e,n){var i=ozt(t.map);if(i&&"geoJSON"===i.type){var r=t.itemStyle=t.itemStyle||{};"color"in r||(r.color="#eee")}this.mergeDefaultAndTheme(t,n),OAt(t,"label",["show"])},e.prototype.optionUpdated=function(){var t=this,e=this.option;e.regions=bHt.getFilledRegions(e.regions,e.map,e.nameMap,e.nameProperty);var n={};this._optionModelMap=A_t(e.regions||[],(function(e,i){var r=i.name;return r&&(e.set(r,new NNt(i,t,t.ecModel)),i.selected&&(n[r]=!0)),e}),Z_t()),e.selectedMap||(e.selectedMap=n)},e.prototype.getRegionModel=function(t){return this._optionModelMap.get(t)||new NNt(null,this,this.ecModel)},e.prototype.getFormattedLabel=function(t,e){var n=this.getRegionModel(t),i="normal"===e?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]),r={name:t};return"function"==typeof i?(r.status=e,i(r)):"string"==typeof i?i.replace("{a}",null!=t?t:""):void 0},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.select=function(t){var e=this.option,n=e.selectedMode;n&&("multiple"!==n&&(e.selectedMap=null),(e.selectedMap||(e.selectedMap={}))[t]=!0)},e.prototype.unSelect=function(t){var e=this.option.selectedMap;e&&(e[t]=!1)},e.prototype.toggleSelected=function(t){this[this.isSelected(t)?"unSelect":"select"](t)},e.prototype.isSelected=function(t){var e=this.option.selectedMap;return!(!e||!e[t])},e.type="geo",e.layoutMode="box",e.defaultOption={zlevel:0,z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},e}(FOt);function _Ht(t,e,n){var i=t.getZoom(),r=t.getCenter(),o=e.zoom,a=t.dataToPoint(r);if(null!=e.dx&&null!=e.dy&&(a[0]-=e.dx,a[1]-=e.dy,t.setCenter(t.pointToData(a))),null!=o){if(n){var s=n.min||0,l=n.max||1/0;o=Math.max(Math.min(i*o,l),s)/i}t.scaleX*=o,t.scaleY*=o;var u=(e.originX-t.x)*(o-1),c=(e.originY-t.y)*(o-1);t.x-=u,t.y-=c,t.updateTransform(),t.setCenter(t.pointToData(a)),t.setZoom(o*i)}return{center:t.getCenter(),zoom:t.getZoom()}}var kHt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.focusBlurEnabled=!0,n}return Dit(e,t),e.prototype.init=function(t,e){var n=new iHt(e);this._mapDraw=n,this.group.add(n.group),this._api=e},e.prototype.render=function(t,e,n,i){var r=this._mapDraw;t.get("show")?r.draw(t,e,n,this,i):this._mapDraw.group.removeAll(),r.group.on("click",this._handleRegionClick,this),r.group.silent=t.get("silent"),this._model=t,this.updateSelectStatus(t,e,n)},e.prototype._handleRegionClick=function(t){var e;O$t(t.target,(function(t){return null!=(e=IDt(t).eventData)}),!0),e&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:e.name})},e.prototype.updateSelectStatus=function(t,e,n){var i=this;this._mapDraw.group.traverse((function(t){var e=IDt(t).eventData;if(e)return i._model.isSelected(e.name)?n.enterSelect(t):n.leaveSelect(t),!0}))},e.prototype.findHighDownDispatchers=function(t){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(t,this._model)},e.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},e.type="geo",e}(nLt);function SHt(t){function e(e,n){n.update="geo:updateSelectStatus",t.registerAction(n,(function(t,n){var i={},r=[];return n.eachComponent({mainType:"geo",query:t},(function(n){n[e](t.name),S_t(n.coordinateSystem.regions,(function(t){i[t.name]=n.isSelected(t.name)||!1}));var o=[];S_t(i,(function(t,e){i[e]&&o.push(e)})),r.push({geoIndex:n.componentIndex,name:o})})),{selected:i,allSelected:r,name:t.name}}))}t.registerCoordinateSystem("geo",bHt),t.registerComponentModel(wHt),t.registerComponentView(kHt),e("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),e("select",{type:"geoSelect",event:"geoselected"}),e("unSelect",{type:"geoUnSelect",event:"geounselected"}),t.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},(function(t,e){var n=t.componentType||"series";e.eachComponent({mainType:n,query:t},(function(e){var i=e.coordinateSystem;if("geo"===i.type){var r=_Ht(i,t,e.get("scaleLimit"));e.setCenter&&e.setCenter(r.center),e.setZoom&&e.setZoom(r.zoom),"series"===n&&S_t(e.seriesGroup,(function(t){t.setCenter(r.center),t.setZoom(r.zoom)}))}}))}))}function CHt(t,e){var n=t.isExpand?t.children:[],i=t.parentNode.children,r=t.hierNode.i?i[t.hierNode.i-1]:null;if(n.length){!function(t){var e=t.children,n=e.length,i=0,r=0;for(;--n>=0;){var o=e[n];o.hierNode.prelim+=i,o.hierNode.modifier+=i,r+=o.hierNode.change,i+=o.hierNode.shift+r}}(t);var o=(n[0].hierNode.prelim+n[n.length-1].hierNode.prelim)/2;r?(t.hierNode.prelim=r.hierNode.prelim+e(t,r),t.hierNode.modifier=t.hierNode.prelim-o):t.hierNode.prelim=o}else r&&(t.hierNode.prelim=r.hierNode.prelim+e(t,r));t.parentNode.hierNode.defaultAncestor=function(t,e,n,i){if(e){for(var r=t,o=t,a=o.parentNode.children[0],s=e,l=r.hierNode.modifier,u=o.hierNode.modifier,c=a.hierNode.modifier,h=s.hierNode.modifier;s=DHt(s),o=THt(o),s&&o;){r=DHt(r),a=THt(a),r.hierNode.ancestor=t;var d=s.hierNode.prelim+h-o.hierNode.prelim-u+i(s,o);d>0&&(NHt(EHt(s,t,n),t,d),u+=d,l+=d),h+=s.hierNode.modifier,u+=o.hierNode.modifier,l+=r.hierNode.modifier,c+=a.hierNode.modifier}s&&!DHt(r)&&(r.hierNode.thread=s,r.hierNode.modifier+=h-l),o&&!THt(a)&&(a.hierNode.thread=o,a.hierNode.modifier+=u-c,n=t)}return n}(t,r,t.parentNode.hierNode.defaultAncestor||i[0],e)}function AHt(t){var e=t.hierNode.prelim+t.parentNode.hierNode.modifier;t.setLayout({x:e},!0),t.hierNode.modifier+=t.parentNode.hierNode.modifier}function IHt(t){return arguments.length?t:OHt}function MHt(t,e){return t-=Math.PI/2,{x:e*Math.cos(t),y:e*Math.sin(t)}}function DHt(t){var e=t.children;return e.length&&t.isExpand?e[e.length-1]:t.hierNode.thread}function THt(t){var e=t.children;return e.length&&t.isExpand?e[0]:t.hierNode.thread}function EHt(t,e,n){return t.hierNode.ancestor.parentNode===e.parentNode?t.hierNode.ancestor:n}function NHt(t,e,n){var i=n/(e.hierNode.i-t.hierNode.i);e.hierNode.change-=i,e.hierNode.shift+=n,e.hierNode.modifier+=n,e.hierNode.prelim+=n,t.hierNode.change+=i}function OHt(t,e){return t.parentNode===e.parentNode?1:2}var FHt=function(){this.parentPoint=[],this.childPoints=[]},RHt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new FHt},e.prototype.buildPath=function(t,e){var n=e.childPoints,i=n.length,r=e.parentPoint,o=n[0],a=n[i-1];if(1===i)return t.moveTo(r[0],r[1]),void t.lineTo(o[0],o[1]);var s=e.orient,l="TB"===s||"BT"===s?0:1,u=1-l,c=dAt(e.forkPosition,1),h=[];h[l]=r[l],h[u]=r[u]+(a[u]-r[u])*c,t.moveTo(r[0],r[1]),t.lineTo(h[0],h[1]),t.moveTo(o[0],o[1]),h[l]=o[l],t.lineTo(h[0],h[1]),h[l]=a[l],t.lineTo(h[0],h[1]),t.lineTo(a[0],a[1]);for(var d=1;d<i-1;d++){var p=n[d];t.moveTo(p[0],p[1]),h[l]=p[l],t.lineTo(h[0],h[1])}},e}(rDt),LHt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._mainGroup=new oAt,n}return Dit(e,t),e.prototype.init=function(t,e){this._controller=new jGt(e.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},e.prototype.render=function(t,e,n){var i=t.getData(),r=t.layoutInfo,o=this._mainGroup;"radial"===t.get("layout")?(o.x=r.x+r.width/2,o.y=r.y+r.height/2):(o.x=r.x,o.y=r.y),this._updateViewCoordSys(t),this._updateController(t,e,n);var a=this._data;i.diff(a).add((function(e){$Ht(i,e)&&PHt(i,e,null,o,t)})).update((function(e,n){var r=a.getItemGraphicEl(n);$Ht(i,e)?PHt(i,e,r,o,t):r&&zHt(a,n,r,o,t)})).remove((function(e){var n=a.getItemGraphicEl(e);n&&zHt(a,e,n,o,t)})).execute(),this._nodeScaleRatio=t.get("nodeScaleRatio"),this._updateNodeAndLinkScale(t),!0===t.get("expandAndCollapse")&&i.eachItemGraphicEl((function(e,i){e.off("click").on("click",(function(){n.dispatchAction({type:"treeExpandAndCollapse",seriesId:t.id,dataIndex:i})}))})),this._data=i},e.prototype._updateViewCoordSys=function(t){var e=t.getData(),n=[];e.each((function(t){var i=e.getItemLayout(t);!i||isNaN(i.x)||isNaN(i.y)||n.push([+i.x,+i.y])}));var i=[],r=[];dMt(n,i,r);var o=this._min,a=this._max;r[0]-i[0]==0&&(i[0]=o?o[0]:i[0]-1,r[0]=a?a[0]:r[0]+1),r[1]-i[1]==0&&(i[1]=o?o[1]:i[1]-1,r[1]=a?a[1]:r[1]+1);var s=t.coordinateSystem=new fHt;s.zoomLimit=t.get("scaleLimit"),s.setBoundingRect(i[0],i[1],r[0]-i[0],r[1]-i[1]),s.setCenter(t.get("center")),s.setZoom(t.get("zoom")),this.group.attr({x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY}),this._min=i,this._max=r},e.prototype._updateController=function(t,e,n){var i=this,r=this._controller,o=this._controllerHost,a=this.group;r.setPointerChecker((function(e,i,r){var o=a.getBoundingRect();return o.applyTransform(a.transform),o.contain(i,r)&&!KGt(e,n,t)})),r.enable(t.get("roam")),o.zoomLimit=t.get("scaleLimit"),o.zoom=t.coordinateSystem.getZoom(),r.off("pan").off("zoom").on("pan",(function(e){qGt(o,e.dx,e.dy),n.dispatchAction({seriesId:t.id,type:"treeRoam",dx:e.dx,dy:e.dy})})).on("zoom",(function(e){XGt(o,e.scale,e.originX,e.originY),n.dispatchAction({seriesId:t.id,type:"treeRoam",zoom:e.scale,originX:e.originX,originY:e.originY}),i._updateNodeAndLinkScale(t),n.updateLabelLayout()}))},e.prototype._updateNodeAndLinkScale=function(t){var e=t.getData(),n=this._getNodeGlobalScale(t);e.eachItemGraphicEl((function(t,e){t.setSymbolScale(n)}))},e.prototype._getNodeGlobalScale=function(t){var e=t.coordinateSystem;if("view"!==e.type)return 1;var n=this._nodeScaleRatio,i=e.scaleX||1;return((e.getZoom()-1)*n+1)/i},e.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},e.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},e.type="tree",e}(aLt);function $Ht(t,e){var n=t.getItemLayout(e);return n&&!isNaN(n.x)&&!isNaN(n.y)}function PHt(t,e,n,i,r){var o=!n,a=t.tree.getNodeByDataIndex(e),s=a.getModel(),l=a.getVisual("style").fill,u=!1===a.isExpand&&0!==a.children.length?l:"#fff",c=t.tree.root,h=a.parentNode===c?a:a.parentNode||a,d=t.getItemGraphicEl(h.dataIndex),p=h.getLayout(),f=d?{x:d.__oldX,y:d.__oldY,rawX:d.__radialOldRawX,rawY:d.__radialOldRawY}:p,g=a.getLayout();o?((n=new djt(t,e,null,{symbolInnerColor:u,useNameLabel:!0})).x=f.x,n.y=f.y):n.updateData(t,e,null,{symbolInnerColor:u,useNameLabel:!0}),n.__radialOldRawX=n.__radialRawX,n.__radialOldRawY=n.__radialRawY,n.__radialRawX=g.rawX,n.__radialRawY=g.rawY,i.add(n),t.setItemGraphicEl(e,n),n.__oldX=n.x,n.__oldY=n.y,WEt(n,{x:g.x,y:g.y},r);var m=n.getSymbolPath();if("radial"===r.get("layout")){var y=c.children[0],v=y.getLayout(),x=y.children.length,b=void 0,w=void 0;if(g.x===v.x&&!0===a.isExpand){var _={x:(y.children[0].getLayout().x+y.children[x-1].getLayout().x)/2,y:(y.children[0].getLayout().y+y.children[x-1].getLayout().y)/2};(b=Math.atan2(_.y-v.y,_.x-v.x))<0&&(b=2*Math.PI+b),(w=_.x<v.x)&&(b-=Math.PI)}else(b=Math.atan2(g.y-v.y,g.x-v.x))<0&&(b=2*Math.PI+b),0===a.children.length||0!==a.children.length&&!1===a.isExpand?(w=g.x<v.x)&&(b-=Math.PI):(w=g.x>v.x)||(b-=Math.PI);var k=w?"left":"right",S=s.getModel("label"),C=S.get("rotate"),A=C*(Math.PI/180),I=m.getTextContent();I&&(m.setTextConfig({position:S.get("position")||k,rotation:null==C?-b:A,origin:"center"}),I.setStyle("verticalAlign","middle"))}var M=s.get(["emphasis","focus"]),D="ancestor"===M?a.getAncestorsIndices():"descendant"===M?a.getDescendantIndices():null;D&&(IDt(n).focus=D),function(t,e,n,i,r,o,a,s){var l=e.getModel(),u=t.get("edgeShape"),c=t.get("layout"),h=t.getOrient(),d=t.get(["lineStyle","curveness"]),p=t.get("edgeForkPosition"),f=l.getModel("lineStyle").getLineStyle(),g=i.__edge;if("curve"===u)e.parentNode&&e.parentNode!==n&&(g||(g=i.__edge=new gEt({shape:BHt(c,h,d,r,r)})),WEt(g,{shape:BHt(c,h,d,o,a)},t));else if("polyline"===u&&"orthogonal"===c&&e!==n&&e.children&&0!==e.children.length&&!0===e.isExpand){for(var m=e.children,y=[],v=0;v<m.length;v++){var x=m[v].getLayout();y.push([x.x,x.y])}g||(g=i.__edge=new RHt({shape:{parentPoint:[a.x,a.y],childPoints:[[a.x,a.y]],orient:h,forkPosition:p}})),WEt(g,{shape:{parentPoint:[a.x,a.y],childPoints:y}},t)}g&&(g.useStyle(x_t({strokeNoScale:!0,fill:null},f)),pTt(g,l,"lineStyle"),qDt(g),s.add(g))}(r,a,c,n,f,p,g,i),n.__edge&&(n.onHoverStateChange=function(e){if("blur"!==e){var i=a.parentNode&&t.getItemGraphicEl(a.parentNode.dataIndex);i&&1===i.hoverState||GDt(n.__edge,e)}})}function zHt(t,e,n,i,r){for(var o,a=t.tree.getNodeByDataIndex(e),s=t.tree.root,l=a.parentNode===s?a:a.parentNode||a;null==(o=l.getLayout());)l=l.parentNode===s?l:l.parentNode||l;var u={duration:r.get("animationDurationUpdate"),easing:r.get("animationEasingUpdate")};UEt(n,{x:o.x+1,y:o.y+1},r,{cb:function(){i.remove(n),t.setItemGraphicEl(e,null)},removeOpt:u}),n.fadeOut(null,{fadeLabel:!0,animation:u});var c=t.getItemGraphicEl(l.dataIndex).__edge,h=n.__edge||(!1===l.isExpand||1===l.children.length?c:void 0),d=r.get("edgeShape"),p=r.get("layout"),f=r.get("orient"),g=r.get(["lineStyle","curveness"]);h&&("curve"===d?UEt(h,{shape:BHt(p,f,g,o,o),style:{opacity:0}},r,{cb:function(){i.remove(h)},removeOpt:u}):"polyline"===d&&"orthogonal"===r.get("layout")&&UEt(h,{shape:{parentPoint:[o.x,o.y],childPoints:[[o.x,o.y]]},style:{opacity:0}},r,{cb:function(){i.remove(h)},removeOpt:u}))}function BHt(t,e,n,i,r){var o,a,s,l,u,c,h,d;if("radial"===t){u=i.rawX,h=i.rawY,c=r.rawX,d=r.rawY;var p=MHt(u,h),f=MHt(u,h+(d-h)*n),g=MHt(c,d+(h-d)*n),m=MHt(c,d);return{x1:p.x||0,y1:p.y||0,x2:m.x||0,y2:m.y||0,cpx1:f.x||0,cpy1:f.y||0,cpx2:g.x||0,cpy2:g.y||0}}return u=i.x,h=i.y,c=r.x,d=r.y,"LR"!==e&&"RL"!==e||(o=u+(c-u)*n,a=h,s=c+(u-c)*n,l=d),"TB"!==e&&"BT"!==e||(o=u,a=h+(d-h)*n,s=c,l=d+(h-d)*n),{x1:u,y1:h,x2:c,y2:d,cpx1:o,cpy1:a,cpx2:s,cpy2:l}}var VHt=jAt();function WHt(t){var e=t.mainData,n=t.datas;n||(n={main:e},t.datasAttr={main:"data"}),t.datas=t.mainData=null,XHt(e,n,t),S_t(n,(function(n){S_t(e.TRANSFERABLE_METHODS,(function(e){n.wrapMethod(e,T_t(jHt,t))}))})),e.wrapMethod("cloneShallow",T_t(GHt,t)),S_t(e.CHANGABLE_METHODS,(function(n){e.wrapMethod(n,T_t(UHt,t))})),H_t(n[e.dataType]===e)}function jHt(t,e){if(VHt(i=this).mainData===i){var n=v_t({},VHt(this).datas);n[this.dataType]=e,XHt(e,n,t)}else YHt(e,this.dataType,VHt(this).mainData,t);var i;return e}function UHt(t,e){return t.struct&&t.struct.update(),e}function GHt(t,e){return S_t(VHt(e).datas,(function(n,i){n!==e&&YHt(n.cloneShallow(),i,e,t)})),e}function HHt(t){var e=VHt(this).mainData;return null==t||null==e?e:VHt(e).datas[t]}function qHt(){var t=VHt(this).mainData;return null==t?[{data:t}]:C_t(M_t(VHt(t).datas),(function(e){return{type:e,data:VHt(t).datas[e]}}))}function XHt(t,e,n){VHt(t).datas={},S_t(e,(function(e,i){YHt(e,i,t,n)}))}function YHt(t,e,n,i){VHt(n).datas[e]=t,VHt(t).mainData=n,t.dataType=e,i.struct&&(t[i.structAttr]=i.struct,i.struct[i.datasAttr[e]]=t),t.getLinkedData=HHt,t.getLinkedDataAll=qHt}var KHt=function(){function t(t,e){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=t||"",this.hostTree=e}return t.prototype.isRemoved=function(){return this.dataIndex<0},t.prototype.eachNode=function(t,e,n){"function"==typeof t&&(n=e,e=t,t=null),O_t(t=t||{})&&(t={order:t});var i,r=t.order||"preorder",o=this[t.attr||"children"];"preorder"===r&&(i=e.call(n,this));for(var a=0;!i&&a<o.length;a++)o[a].eachNode(t,e,n);"postorder"===r&&e.call(n,this)},t.prototype.updateDepthAndHeight=function(t){var e=0;this.depth=t;for(var n=0;n<this.children.length;n++){var i=this.children[n];i.updateDepthAndHeight(t+1),i.height>e&&(e=i.height)}this.height=e+1},t.prototype.getNodeById=function(t){if(this.getId()===t)return this;for(var e=0,n=this.children,i=n.length;e<i;e++){var r=n[e].getNodeById(t);if(r)return r}},t.prototype.contains=function(t){if(t===this)return!0;for(var e=0,n=this.children,i=n.length;e<i;e++){var r=n[e].contains(t);if(r)return r}},t.prototype.getAncestors=function(t){for(var e=[],n=t?this:this.parentNode;n;)e.push(n),n=n.parentNode;return e.reverse(),e},t.prototype.getAncestorsIndices=function(){for(var t=[],e=this;e;)t.push(e.dataIndex),e=e.parentNode;return t.reverse(),t},t.prototype.getDescendantIndices=function(){var t=[];return this.eachNode((function(e){t.push(e.dataIndex)})),t},t.prototype.getValue=function(t){var e=this.hostTree.data;return e.get(e.getDimension(t||"value"),this.dataIndex)},t.prototype.setLayout=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,t,e)},t.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},t.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostTree.data.getItemModel(this.dataIndex).getModel(t)},t.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},t.prototype.setVisual=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,t,e)},t.prototype.getVisual=function(t){return this.hostTree.data.getItemVisual(this.dataIndex,t)},t.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},t.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},t.prototype.isAncestorOf=function(t){for(var e=t.parentNode;e;){if(e===this)return!0;e=e.parentNode}return!1},t.prototype.isDescendantOf=function(t){return t!==this&&t.isAncestorOf(this)},t}(),ZHt=function(){function t(t){this.type="tree",this._nodes=[],this.hostModel=t}return t.prototype.eachNode=function(t,e,n){this.root.eachNode(t,e,n)},t.prototype.getNodeByDataIndex=function(t){var e=this.data.getRawIndex(t);return this._nodes[e]},t.prototype.getNodeById=function(t){return this.root.getNodeById(t)},t.prototype.update=function(){for(var t=this.data,e=this._nodes,n=0,i=e.length;n<i;n++)e[n].dataIndex=-1;for(n=0,i=t.count();n<i;n++)e[t.getRawIndex(n)].dataIndex=n},t.prototype.clearLayouts=function(){this.data.clearItemLayouts()},t.createTree=function(e,n,i){var r=new t(n),o=[],a=1;!function t(e,n){var i=e.value;a=Math.max(a,E_t(i)?i.length:1),o.push(e);var s=new KHt(zAt(e.name,""),r);n?function(t,e){var n=e.children;if(t.parentNode===e)return;n.push(t),t.parentNode=e}(s,n):r.root=s,r._nodes.push(s);var l=e.children;if(l)for(var u=0;u<l.length;u++)t(l[u],s)}(e),r.root.updateDepthAndHeight(0);var s=XBt(o,{coordDimensions:["value"],dimensionsCount:a}),l=new GBt(s,n);return l.initData(o),i&&i(l),WHt({mainData:l,struct:r,structAttr:"tree"}),r.update(),r},t}();function JHt(t,e,n){if(t&&w_t(e,t.type)>=0){var i=n.getData().tree.root,r=t.targetNode;if("string"==typeof r&&(r=i.getNodeById(r)),r&&i.contains(r))return{node:r};var o=t.targetNodeId;if(null!=o&&(r=i.getNodeById(o)))return{node:r}}}function QHt(t){for(var e=[];t;)(t=t.parentNode)&&e.push(t);return e.reverse()}function tqt(t,e){return w_t(QHt(t),e)>=0}function eqt(t,e){for(var n=[];t;){var i=t.dataIndex;n.push({name:t.name,dataIndex:i,value:e.getRawValue(i)}),t=t.parentNode}return n.reverse(),n}var nqt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasSymbolVisual=!0,e.ignoreStyleOnData=!0,e}return Dit(e,t),e.prototype.getInitialData=function(t){var e={name:t.name,children:t.data},n=t.leaves||{},i=new NNt(n,this,this.ecModel),r=ZHt.createTree(e,this,(function(t){t.wrapMethod("getItemModel",(function(t,e){var n=r.getNodeByDataIndex(e);return n&&n.children.length&&n.isExpand||(t.parentModel=i),t}))}));var o=0;r.eachNode("preorder",(function(t){t.depth>o&&(o=t.depth)}));var a=t.expandAndCollapse&&t.initialTreeDepth>=0?t.initialTreeDepth:o;return r.root.eachNode("preorder",(function(t){var e=t.hostTree.data.getRawDataItem(t.dataIndex);t.isExpand=e&&null!=e.collapsed?!e.collapsed:t.depth<=a})),r.data},e.prototype.getOrient=function(){var t=this.get("orient");return"horizontal"===t?t="LR":"vertical"===t&&(t="TB"),t},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.formatTooltip=function(t,e,n){for(var i=this.getData().tree,r=i.root.children[0],o=i.getNodeByDataIndex(t),a=o.getValue(),s=o.name;o&&o!==r;)s=o.parentNode.name+"."+s,o=o.parentNode;return RRt("nameValue",{name:s,value:a,noValue:isNaN(a)||null==a})},e.prototype.getDataParams=function(e){var n=t.prototype.getDataParams.apply(this,arguments),i=this.getData().tree.getNodeByDataIndex(e);return n.treeAncestors=eqt(i,this),n},e.type="series.tree",e.layoutMode="box",e.defaultOption={zlevel:0,z:2,coordinateSystem:"view",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:"#ccc",width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},e}(XRt);function iqt(t,e){for(var n,i=[t];n=i.pop();)if(e(n),n.isExpand){var r=n.children;if(r.length)for(var o=r.length-1;o>=0;o--)i.push(r[o])}}function rqt(t,e){t.eachSeriesByType("tree",(function(t){!function(t,e){var n=function(t,e){return IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,e);t.layoutInfo=n;var i=t.get("layout"),r=0,o=0,a=null;"radial"===i?(r=2*Math.PI,o=Math.min(n.height,n.width)/2,a=IHt((function(t,e){return(t.parentNode===e.parentNode?1:2)/t.depth}))):(r=n.width,o=n.height,a=IHt());var s=t.getData().tree.root,l=s.children[0];if(l){!function(t){var e=t;e.hierNode={defaultAncestor:null,ancestor:e,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var n,i,r=[e];n=r.pop();)if(i=n.children,n.isExpand&&i.length)for(var o=i.length-1;o>=0;o--){var a=i[o];a.hierNode={defaultAncestor:null,ancestor:a,prelim:0,modifier:0,change:0,shift:0,i:o,thread:null},r.push(a)}}(s),function(t,e,n){for(var i,r=[t],o=[];i=r.pop();)if(o.push(i),i.isExpand){var a=i.children;if(a.length)for(var s=0;s<a.length;s++)r.push(a[s])}for(;i=o.pop();)e(i,n)}(l,CHt,a),s.hierNode.modifier=-l.hierNode.prelim,iqt(l,AHt);var u=l,c=l,h=l;iqt(l,(function(t){var e=t.getLayout().x;e<u.getLayout().x&&(u=t),e>c.getLayout().x&&(c=t),t.depth>h.depth&&(h=t)}));var d=u===c?1:a(u,c)/2,p=d-u.getLayout().x,f=0,g=0,m=0,y=0;if("radial"===i)f=r/(c.getLayout().x+d+p),g=o/(h.depth-1||1),iqt(l,(function(t){m=(t.getLayout().x+p)*f,y=(t.depth-1)*g;var e=MHt(m,y);t.setLayout({x:e.x,y:e.y,rawX:m,rawY:y},!0)}));else{var v=t.getOrient();"RL"===v||"LR"===v?(g=o/(c.getLayout().x+d+p),f=r/(h.depth-1||1),iqt(l,(function(t){y=(t.getLayout().x+p)*g,m="LR"===v?(t.depth-1)*f:r-(t.depth-1)*f,t.setLayout({x:m,y:y},!0)}))):"TB"!==v&&"BT"!==v||(f=r/(c.getLayout().x+d+p),g=o/(h.depth-1||1),iqt(l,(function(t){m=(t.getLayout().x+p)*f,y="TB"===v?(t.depth-1)*g:o-(t.depth-1)*g,t.setLayout({x:m,y:y},!0)})))}}}(t,e)}))}function oqt(t){t.eachSeriesByType("tree",(function(t){var e=t.getData();e.tree.eachNode((function(t){var n=t.getModel().getModel("itemStyle").getItemStyle();v_t(e.ensureUniqueItemVisual(t.dataIndex,"style"),n)}))}))}var aqt=function(){},sqt=["treemapZoomToNode","treemapRender","treemapMove"];function lqt(t){var e=t.getData().tree,n={};e.eachNode((function(e){for(var i=e;i&&i.depth>1;)i=i.parentNode;var r=eFt(t.ecModel,i.name||i.dataIndex+"",n);e.setVisual("decal",r)}))}var uqt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.preventUsingHoverLayer=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){var n={name:t.name,children:t.data};cqt(n);var i=t.levels||[],r=this.designatedVisualItemStyle={},o=new NNt({itemStyle:r},this,e),a=C_t((i=t.levels=function(t,e){var n,i,r=NAt(e.get("color")),o=NAt(e.get(["aria","decal","decals"]));if(!r)return;S_t(t=t||[],(function(t){var e=new NNt(t),r=e.get("color"),o=e.get("decal");(e.get(["itemStyle","color"])||r&&"none"!==r)&&(n=!0),(e.get(["itemStyle","decal"])||o&&"none"!==o)&&(i=!0)}));var a=t[0]||(t[0]={});n||(a.color=r.slice());!i&&o&&(a.decal=o.slice());return t}(i,e))||[],(function(t){return new NNt(t,o,e)}),this),s=ZHt.createTree(n,this,(function(t){t.wrapMethod("getItemModel",(function(t,e){var n=s.getNodeByDataIndex(e),i=n?a[n.depth]:null;return t.parentModel=i||o,t}))}));return s.data},e.prototype.optionUpdated=function(){this.resetViewRoot()},e.prototype.formatTooltip=function(t,e,n){var i=this.getData(),r=this.getRawValue(t);return RRt("nameValue",{name:i.getName(t),value:r})},e.prototype.getDataParams=function(e){var n=t.prototype.getDataParams.apply(this,arguments),i=this.getData().tree.getNodeByDataIndex(e);return n.treePathInfo=eqt(i,this),n},e.prototype.setLayoutInfo=function(t){this.layoutInfo=this.layoutInfo||{},v_t(this.layoutInfo,t)},e.prototype.mapIdToIndex=function(t){var e=this._idIndexMap;e||(e=this._idIndexMap=Z_t(),this._idIndexMapCount=0);var n=e.get(t);return null==n&&e.set(t,n=this._idIndexMapCount++),n},e.prototype.getViewRoot=function(){return this._viewRoot},e.prototype.resetViewRoot=function(t){t?this._viewRoot=t:t=this._viewRoot;var e=this.getRawData().tree.root;t&&(t===e||e.contains(t))||(this._viewRoot=e)},e.prototype.enableAriaDecal=function(){lqt(this)},e.type="series.treemap",e.layoutMode="box",e.defaultOption={progressive:0,left:"center",top:"middle",width:"80%",height:"80%",sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"▶",zoomToNodeRatio:.1024,roam:!0,nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{color:"rgba(0,0,0,0.7)",textStyle:{color:"#fff"}}},label:{show:!0,distance:0,padding:5,position:"inside",color:"#fff",overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],ellipsis:!0,verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},e}(XRt);function cqt(t){var e=0;S_t(t.children,(function(t){cqt(t);var n=t.value;E_t(n)&&(n=n[0]),e+=n}));var n=t.value;E_t(n)&&(n=n[0]),(null==n||isNaN(n))&&(n=e),n<0&&(n=0),E_t(t.value)?t.value[0]=n:t.value=n}var hqt=function(){function t(t){this.group=new oAt,t.add(this.group)}return t.prototype.render=function(t,e,n,i){var r=t.getModel("breadcrumb"),o=this.group;if(o.removeAll(),r.get("show")&&n){var a=r.getModel("itemStyle"),s=a.getModel("textStyle"),l={pos:{left:r.get("left"),right:r.get("right"),top:r.get("top"),bottom:r.get("bottom")},box:{width:e.getWidth(),height:e.getHeight()},emptyItemWidth:r.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(n,l,s),this._renderContent(t,l,a,s,i),MOt(o,l.pos,l.box)}},t.prototype._prepare=function(t,e,n){for(var i=t;i;i=i.parentNode){var r=zAt(i.getModel().get("name"),""),o=n.getTextRect(r),a=Math.max(o.width+16,e.emptyItemWidth);e.totalWidth+=a+8,e.renderList.push({node:i,text:r,width:a})}},t.prototype._renderContent=function(t,e,n,i,r){for(var o=0,a=e.emptyItemWidth,s=t.get(["breadcrumb","height"]),l=function(t,e,n){var i=e.width,r=e.height,o=dAt(t.left,i),a=dAt(t.top,r),s=dAt(t.right,i),l=dAt(t.bottom,r);return(isNaN(o)||isNaN(parseFloat(t.left)))&&(o=0),(isNaN(s)||isNaN(parseFloat(t.right)))&&(s=i),(isNaN(a)||isNaN(parseFloat(t.top)))&&(a=0),(isNaN(l)||isNaN(parseFloat(t.bottom)))&&(l=r),n=dOt(n||0),{width:Math.max(s-o-n[1]-n[3],0),height:Math.max(l-a-n[0]-n[2],0)}}(e.pos,e.box),u=e.totalWidth,c=e.renderList,h=c.length-1;h>=0;h--){var d=c[h],p=d.node,f=d.width,g=d.text;u>l.width&&(u-=f-a,f=a,g=null);var m=new aEt({shape:{points:dqt(o,0,f,s,h===c.length-1,0===h)},style:x_t(n.getItemStyle(),{lineJoin:"bevel"}),textContent:new xDt({style:{text:g,fill:i.getTextColor(),font:i.getFont()}}),textConfig:{position:"inside"},z2:1e5,onclick:T_t(r,p)});m.disableLabelAnimation=!0,this.group.add(m),pqt(m,t,p),o+=f+8}},t.prototype.remove=function(){this.group.removeAll()},t}();function dqt(t,e,n,i,r,o){var a=[[r?t:t-5,e],[t+n,e],[t+n,e+i],[r?t:t-5,e+i]];return!o&&a.splice(2,0,[t+n+5,e+i/2]),!r&&a.push([t,e+i/2]),a}function pqt(t,e,n){IDt(t).eventData={componentType:"series",componentSubType:"treemap",componentIndex:e.componentIndex,seriesIndex:e.componentIndex,seriesName:e.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:n&&n.dataIndex,name:n&&n.name},treePathInfo:n&&eqt(n,e)}}var fqt=function(){function t(){this._storage=[],this._elExistsMap={}}return t.prototype.add=function(t,e,n,i,r){return!this._elExistsMap[t.id]&&(this._elExistsMap[t.id]=!0,this._storage.push({el:t,target:e,duration:n,delay:i,easing:r}),!0)},t.prototype.finished=function(t){return this._finishedCallback=t,this},t.prototype.start=function(){for(var t=this,e=this._storage.length,n=function(){--e<=0&&(t._storage.length=0,t._elExistsMap={},t._finishedCallback&&t._finishedCallback())},i=0,r=this._storage.length;i<r;i++){var o=this._storage[i];o.el.animateTo(o.target,{duration:o.duration,delay:o.delay,easing:o.easing,setToFinal:!0,done:n,aborted:n})}return this},t}();var gqt=oAt,mqt=mDt,yqt=lIt([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),vqt=function(t){var e=yqt(t);return e.stroke=e.fill=e.lineWidth=null,e},xqt=jAt(),bqt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._state="ready",n._storage={nodeGroup:[],background:[],content:[]},n}return Dit(e,t),e.prototype.render=function(t,e,n,i){if(!(w_t(e.findComponents({mainType:"series",subType:"treemap",query:i}),t)<0)){this.seriesModel=t,this.api=n,this.ecModel=e;var r=JHt(i,["treemapZoomToNode","treemapRootToNode"],t),o=i&&i.type,a=t.layoutInfo,s=!this._oldTree,l=this._storage,u="treemapRootToNode"===o&&r&&l?{rootNodeGroup:l.nodeGroup[r.node.getRawIndex()],direction:i.direction}:null,c=this._giveContainerGroup(a),h=this._doRender(c,t,u);s||o&&"treemapZoomToNode"!==o&&"treemapRootToNode"!==o?h.renderFinally():this._doAnimation(c,h,t,u),this._resetController(n),this._renderBreadcrumb(t,n,r)}},e.prototype._giveContainerGroup=function(t){var e=this._containerGroup;return e||(e=this._containerGroup=new gqt,this._initEvents(e),this.group.add(e)),e.x=t.x,e.y=t.y,e},e.prototype._doRender=function(t,e,n){var i=e.getData().tree,r=this._oldTree,o={nodeGroup:[],background:[],content:[]},a={nodeGroup:[],background:[],content:[]},s=this._storage,l=[];function u(t,i,r,u){return function(t,e,n,i,r,o,a,s,l,u){if(!a)return;var c=a.getLayout(),h=t.getData(),d=a.getModel();if(h.setItemGraphicEl(a.dataIndex,null),!c||!c.isInView)return;var p=c.width,f=c.height,g=c.borderWidth,m=c.invisible,y=a.getRawIndex(),v=s&&s.getRawIndex(),x=a.viewChildren,b=c.upperHeight,w=x&&x.length,_=d.getModel("itemStyle"),k=d.getModel(["emphasis","itemStyle"]),S=d.getModel(["blur","itemStyle"]),C=d.getModel(["select","itemStyle"]),A=_.get("borderRadius")||0,I=P("nodeGroup",gqt);if(!I)return;if(l.add(I),I.x=c.x||0,I.y=c.y||0,I.markRedraw(),xqt(I).nodeWidth=p,xqt(I).nodeHeight=f,c.isAboveViewRoot)return I;var M=P("background",mqt,u,20);M&&O(I,M,w&&c.upperLabelHeight);var D=d.get(["emphasis","focus"]),T=d.get(["emphasis","blurScope"]),E="ancestor"===D?a.getAncestorsIndices():"descendant"===D?a.getDescendantIndices():D;if(w)gTt(I)&&fTt(I,!1),M&&(fTt(M,!0),h.setItemGraphicEl(a.dataIndex,M),cTt(M,E,T));else{var N=P("content",mqt,u,30);N&&F(I,N),M&&gTt(M)&&fTt(M,!1),fTt(I,!0),h.setItemGraphicEl(a.dataIndex,I),cTt(I,E,T)}return I;function O(e,n,i){var r=IDt(n);if(r.dataIndex=a.dataIndex,r.seriesIndex=t.seriesIndex,n.setShape({x:0,y:0,width:p,height:f,r:A}),m)R(n);else{n.invisible=!1;var o=a.getVisual("style"),s=o.stroke,l=vqt(_);l.fill=s;var u=yqt(k);u.fill=k.get("borderColor");var c=yqt(S);c.fill=S.get("borderColor");var h=yqt(C);if(h.fill=C.get("borderColor"),i){var d=p-2*g;L(n,s,o.opacity,{x:g,y:0,width:d,height:b})}else n.removeTextContent();n.setStyle(l),n.ensureState("emphasis").style=u,n.ensureState("blur").style=c,n.ensureState("select").style=h,qDt(n)}e.add(n)}function F(e,n){var i=IDt(n);i.dataIndex=a.dataIndex,i.seriesIndex=t.seriesIndex;var r=Math.max(p-2*g,0),o=Math.max(f-2*g,0);if(n.culling=!0,n.setShape({x:g,y:g,width:r,height:o,r:A}),m)R(n);else{n.invisible=!1;var s=a.getVisual("style"),l=s.fill,u=vqt(_);u.fill=l,u.decal=s.decal;var c=yqt(k),h=yqt(S),d=yqt(C);L(n,l,s.opacity,null),n.setStyle(u),n.ensureState("emphasis").style=c,n.ensureState("blur").style=h,n.ensureState("select").style=d,qDt(n)}e.add(n)}function R(t){!t.invisible&&o.push(t)}function L(e,n,i,r){var o=d.getModel(r?"upperLabel":"label"),s=zAt(d.get("name"),null),l=o.getShallow("show");uNt(e,cNt(d,r?"upperLabel":"label"),{defaultText:l?s:null,inheritColor:n,defaultOpacity:i,labelFetcher:t,labelDataIndex:a.dataIndex});var u=e.getTextContent(),h=u.style,p=G_t(h.padding||0);r&&(e.setTextConfig({layoutRect:r}),u.disableLabelLayout=!0),u.beforeUpdate=function(){var t=Math.max((r?r.width:e.shape.width)-p[1]-p[3],0),n=Math.max((r?r.height:e.shape.height)-p[0]-p[2],0);h.width===t&&h.height===n||u.setStyle({width:t,height:n})},h.truncateMinChar=2,h.lineOverflow="truncate",$(h,r,c);var f=u.getState("emphasis");$(f?f.style:null,r,c)}function $(e,n,i){var r=e?e.text:null;if(!n&&i.isLeafRoot&&null!=r){var o=t.get("drillDownIcon",!0);e.text=o?o+" "+r:r}}function P(t,i,o,a){var s=null!=v&&n[t][v],l=r[t];return s?(n[t][v]=null,z(l,s)):m||((s=new i)instanceof OIt&&(s.z2=function(t,e){return 100*t+e}(o,a)),B(l,s)),e[t][y]=s}function z(t,e){var n=t[y]={};e instanceof gqt?(n.oldX=e.x,n.oldY=e.y):n.oldShape=v_t({},e.shape)}function B(t,e){var n=t[y]={},o=a.parentNode,s=e instanceof oAt;if(o&&(!i||"drillDown"===i.direction)){var l=0,u=0,c=r.background[o.getRawIndex()];!i&&c&&c.oldShape&&(l=c.oldShape.width,u=c.oldShape.height),s?(n.oldX=0,n.oldY=u):n.oldShape={x:l,y:u,width:0,height:0}}n.fadein=!s}}(e,a,s,n,o,l,t,i,r,u)}!function t(e,n,i,r,o){r?(n=e,S_t(e,(function(t,e){!t.isRemoved()&&s(e,e)}))):new vBt(n,e,a,a).add(s).update(s).remove(T_t(s,null)).execute();function a(t){return t.getId()}function s(a,s){var l=null!=a?e[a]:null,c=null!=s?n[s]:null,h=u(l,c,i,o);h&&t(l&&l.viewChildren||[],c&&c.viewChildren||[],h,r,o+1)}}(i.root?[i.root]:[],r&&r.root?[r.root]:[],t,i===r||!r,0);var c,h,d=(h={nodeGroup:[],background:[],content:[]},(c=s)&&S_t(c,(function(t,e){var n=h[e];S_t(t,(function(t){t&&(n.push(t),xqt(t).willDelete=!0)}))})),h);return this._oldTree=i,this._storage=a,{lastsForAnimation:o,willDeleteEls:d,renderFinally:function(){S_t(d,(function(t){S_t(t,(function(t){t.parent&&t.parent.remove(t)}))})),S_t(l,(function(t){t.invisible=!0,t.dirty()}))}}},e.prototype._doAnimation=function(t,e,n,i){if(n.get("animation")){var r=n.get("animationDurationUpdate"),o=n.get("animationEasing"),a=(N_t(r)?0:r)||0,s=(N_t(o)?null:o)||"cubicOut",l=new fqt;S_t(e.willDeleteEls,(function(t,e){S_t(t,(function(t,n){if(!t.invisible){var r,o=t.parent,u=xqt(o);if(i&&"drillDown"===i.direction)r=o===i.rootNodeGroup?{shape:{x:0,y:0,width:u.nodeWidth,height:u.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var c=0,h=0;u.willDelete||(c=u.nodeWidth/2,h=u.nodeHeight/2),r="nodeGroup"===e?{x:c,y:h,style:{opacity:0}}:{shape:{x:c,y:h,width:0,height:0},style:{opacity:0}}}r&&l.add(t,r,a,0,s)}}))})),S_t(this._storage,(function(t,n){S_t(t,(function(t,i){var r=e.lastsForAnimation[n][i],o={};r&&(t instanceof oAt?null!=r.oldX&&(o.x=t.x,o.y=t.y,t.x=r.oldX,t.y=r.oldY):(r.oldShape&&(o.shape=v_t({},t.shape),t.setShape(r.oldShape)),r.fadein?(t.setStyle("opacity",0),o.style={opacity:1}):1!==t.style.opacity&&(o.style={opacity:1})),l.add(t,o,a,0,s))}))}),this),this._state="animating",l.finished(D_t((function(){this._state="ready",e.renderFinally()}),this)).start()}},e.prototype._resetController=function(t){var e=this._controller;e||((e=this._controller=new jGt(t.getZr())).enable(this.seriesModel.get("roam")),e.on("pan",D_t(this._onPan,this)),e.on("zoom",D_t(this._onZoom,this)));var n=new PCt(0,0,t.getWidth(),t.getHeight());e.setPointerChecker((function(t,e,i){return n.contain(e,i)}))},e.prototype._clearController=function(){var t=this._controller;t&&(t.dispose(),t=null)},e.prototype._onPan=function(t){if("animating"!==this._state&&(Math.abs(t.dx)>3||Math.abs(t.dy)>3)){var e=this.seriesModel.getData().tree.root;if(!e)return;var n=e.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+t.dx,y:n.y+t.dy,width:n.width,height:n.height}})}},e.prototype._onZoom=function(t){var e=t.originX,n=t.originY;if("animating"!==this._state){var i=this.seriesModel.getData().tree.root;if(!i)return;var r=i.getLayout();if(!r)return;var o=new PCt(r.x,r.y,r.width,r.height),a=this.seriesModel.layoutInfo,s=[1,0,0,1,0,0];mCt(s,s,[-(e-=a.x),-(n-=a.y)]),vCt(s,s,[t.scale,t.scale]),mCt(s,s,[e,n]),o.applyTransform(s),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:o.x,y:o.y,width:o.width,height:o.height}})}},e.prototype._initEvents=function(t){var e=this;t.on("click",(function(t){if("ready"===e._state){var n=e.seriesModel.get("nodeClick",!0);if(n){var i=e.findTarget(t.offsetX,t.offsetY);if(i){var r=i.node;if(r.getLayout().isLeafRoot)e._rootToNode(i);else if("zoomToNode"===n)e._zoomToNode(i);else if("link"===n){var o=r.hostTree.data.getItemModel(r.dataIndex),a=o.get("link",!0),s=o.get("target",!0)||"blank";a&&wOt(a,s)}}}}}),this)},e.prototype._renderBreadcrumb=function(t,e,n){var i=this;n||(n=null!=t.get("leafDepth",!0)?{node:t.getViewRoot()}:this.findTarget(e.getWidth()/2,e.getHeight()/2))||(n={node:t.getData().tree.root}),(this._breadcrumb||(this._breadcrumb=new hqt(this.group))).render(t,e,n.node,(function(e){"animating"!==i._state&&(tqt(t.getViewRoot(),e)?i._rootToNode({node:e}):i._zoomToNode({node:e}))}))},e.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage={nodeGroup:[],background:[],content:[]},this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},e.prototype.dispose=function(){this._clearController()},e.prototype._zoomToNode=function(t){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},e.prototype._rootToNode=function(t){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},e.prototype.findTarget=function(t,e){var n;return this.seriesModel.getViewRoot().eachNode({attr:"viewChildren",order:"preorder"},(function(i){var r=this._storage.background[i.getRawIndex()];if(r){var o=r.transformCoordToLocal(t,e),a=r.shape;if(!(a.x<=o[0]&&o[0]<=a.x+a.width&&a.y<=o[1]&&o[1]<=a.y+a.height))return!1;n={node:i,offsetX:o[0],offsetY:o[1]}}}),this),n},e.type="treemap",e}(aLt);var wqt=S_t,_qt=L_t,kqt=function(){function t(e){var n=e.mappingMethod,i=e.type,r=this.option=g_t(e);this.type=i,this.mappingMethod=n,this._normalizeData=Oqt[n];var o=t.visualHandlers[i];this.applyVisual=o.applyVisual,this.getColorMapper=o.getColorMapper,this._normalizedToVisual=o._normalizedToVisual[n],"piecewise"===n?(Sqt(r),function(t){var e=t.pieceList;t.hasSpecialVisual=!1,S_t(e,(function(e,n){e.originIndex=n,null!=e.visual&&(t.hasSpecialVisual=!0)}))}(r)):"category"===n?r.categories?function(t){var e=t.categories,n=t.categoryMap={},i=t.visual;if(wqt(e,(function(t,e){n[t]=e})),!E_t(i)){var r=[];L_t(i)?wqt(i,(function(t,e){var i=n[e];r[null!=i?i:-1]=t})):r[-1]=i,i=Nqt(t,r)}for(var o=e.length-1;o>=0;o--)null==i[o]&&(delete n[e[o]],e.pop())}(r):Sqt(r,!0):(H_t("linear"!==n||r.dataExtent),Sqt(r))}return t.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},t.prototype.getNormalizer=function(){return D_t(this._normalizeData,this)},t.listVisualTypes=function(){return M_t(t.visualHandlers)},t.isValidType=function(e){return t.visualHandlers.hasOwnProperty(e)},t.eachVisual=function(t,e,n){L_t(t)?S_t(t,e,n):e.call(n,t)},t.mapVisual=function(e,n,i){var r,o=E_t(e)?[]:L_t(e)?{}:(r=!0,null);return t.eachVisual(e,(function(t,e){var a=n.call(i,t,e);r?o=a:o[e]=a})),o},t.retrieveVisuals=function(e){var n,i={};return e&&wqt(t.visualHandlers,(function(t,r){e.hasOwnProperty(r)&&(i[r]=e[r],n=!0)})),n?i:null},t.prepareVisualTypes=function(t){if(E_t(t))t=t.slice();else{if(!_qt(t))return[];var e=[];wqt(t,(function(t,n){e.push(n)})),t=e}return t.sort((function(t,e){return"color"===e&&"color"!==t&&0===t.indexOf("color")?1:-1})),t},t.dependsOn=function(t,e){return"color"===e?!(!t||0!==t.indexOf(e)):t===e},t.findPieceIndex=function(t,e,n){for(var i,r=1/0,o=0,a=e.length;o<a;o++){var s=e[o].value;if(null!=s){if(s===t||"string"==typeof s&&s===t+"")return o;n&&h(s,o)}}for(o=0,a=e.length;o<a;o++){var l=e[o],u=l.interval,c=l.close;if(u){if(u[0]===-1/0){if(Fqt(c[1],t,u[1]))return o}else if(u[1]===1/0){if(Fqt(c[0],u[0],t))return o}else if(Fqt(c[0],u[0],t)&&Fqt(c[1],t,u[1]))return o;n&&h(u[0],o),n&&h(u[1],o)}}if(n)return t===1/0?e.length-1:t===-1/0?0:i;function h(e,n){var o=Math.abs(e-t);o<r&&(r=o,i=n)}},t.visualHandlers={color:{applyVisual:Iqt("color"),getColorMapper:function(){var t=this.option;return D_t("category"===t.mappingMethod?function(t,e){return!e&&(t=this._normalizeData(t)),Mqt.call(this,t)}:function(e,n,i){var r=!!i;return!n&&(e=this._normalizeData(e)),i=ASt(e,t.parsedVisual,i),r?i:DSt(i,"rgba")},this)},_normalizedToVisual:{linear:function(t){return DSt(ASt(t,this.option.parsedVisual),"rgba")},category:Mqt,piecewise:function(t,e){var n=Eqt.call(this,e);return null==n&&(n=DSt(ASt(t,this.option.parsedVisual),"rgba")),n},fixed:Dqt}},colorHue:Cqt((function(t,e){return ISt(t,e)})),colorSaturation:Cqt((function(t,e){return ISt(t,null,e)})),colorLightness:Cqt((function(t,e){return ISt(t,null,null,e)})),colorAlpha:Cqt((function(t,e){return MSt(t,e)})),decal:{applyVisual:Iqt("decal"),_normalizedToVisual:{linear:null,category:Mqt,piecewise:null,fixed:null}},opacity:{applyVisual:Iqt("opacity"),_normalizedToVisual:Tqt([0,1])},liftZ:{applyVisual:Iqt("liftZ"),_normalizedToVisual:{linear:Dqt,category:Dqt,piecewise:Dqt,fixed:Dqt}},symbol:{applyVisual:function(t,e,n){n("symbol",this.mapValueToVisual(t))},_normalizedToVisual:{linear:Aqt,category:Mqt,piecewise:function(t,e){var n=Eqt.call(this,e);return null==n&&(n=Aqt.call(this,t)),n},fixed:Dqt}},symbolSize:{applyVisual:Iqt("symbolSize"),_normalizedToVisual:Tqt([0,1])}},t}();function Sqt(t,e){var n=t.visual,i=[];L_t(n)?wqt(n,(function(t){i.push(t)})):null!=n&&i.push(n);e||1!==i.length||{color:1,symbol:1}.hasOwnProperty(t.type)||(i[1]=i[0]),Nqt(t,i)}function Cqt(t){return{applyVisual:function(e,n,i){var r=this.mapValueToVisual(e);i("color",t(n("color"),r))},_normalizedToVisual:Tqt([0,1])}}function Aqt(t){var e=this.option.visual;return e[Math.round(hAt(t,[0,1],[0,e.length-1],!0))]||{}}function Iqt(t){return function(e,n,i){i(t,this.mapValueToVisual(e))}}function Mqt(t){var e=this.option.visual;return e[this.option.loop&&-1!==t?t%e.length:t]}function Dqt(){return this.option.visual[0]}function Tqt(t){return{linear:function(e){return hAt(e,t,this.option.visual,!0)},category:Mqt,piecewise:function(e,n){var i=Eqt.call(this,n);return null==i&&(i=hAt(e,t,this.option.visual,!0)),i},fixed:Dqt}}function Eqt(t){var e=this.option,n=e.pieceList;if(e.hasSpecialVisual){var i=n[kqt.findPieceIndex(t,n)];if(i&&i.visual)return i.visual[this.type]}}function Nqt(t,e){return t.visual=e,"color"===t.type&&(t.parsedVisual=C_t(e,(function(t){return _St(t)}))),e}var Oqt={linear:function(t){return hAt(t,this.option.dataExtent,[0,1],!0)},piecewise:function(t){var e=this.option.pieceList,n=kqt.findPieceIndex(t,e,!0);if(null!=n)return hAt(n,[0,e.length-1],[0,1],!0)},category:function(t){var e=this.option.categories?this.option.categoryMap[t]:t;return null==e?-1:e},fixed:ekt};function Fqt(t,e,n){return t?e<=n:e<n}var Rqt=jAt(),Lqt={seriesType:"treemap",reset:function(t){var e=t.getData().tree.root;e.isRemoved()||$qt(e,{},t.getViewRoot().getAncestors(),t)}};function $qt(t,e,n,i){var r=t.getModel(),o=t.getLayout(),a=t.hostTree.data;if(o&&!o.invisible&&o.isInView){var s,l=r.getModel("itemStyle"),u=function(t,e,n){var i=v_t({},e),r=n.designatedVisualItemStyle;return S_t(["color","colorAlpha","colorSaturation"],(function(n){r[n]=e[n];var o=t.get(n);r[n]=null,null!=o&&(i[n]=o)})),i}(l,e,i),c=a.ensureUniqueItemVisual(t.dataIndex,"style"),h=l.get("borderColor"),d=l.get("borderColorSaturation");null!=d&&(h=function(t,e){return null!=e?ISt(e,null,null,t):null}(d,s=Pqt(u))),c.stroke=h;var p=t.viewChildren;if(p&&p.length){var f=function(t,e,n,i,r,o){if(!o||!o.length)return;var a=Bqt(e,"color")||null!=r.color&&"none"!==r.color&&(Bqt(e,"colorAlpha")||Bqt(e,"colorSaturation"));if(!a)return;var s=e.get("visualMin"),l=e.get("visualMax"),u=n.dataExtent.slice();null!=s&&s<u[0]&&(u[0]=s),null!=l&&l>u[1]&&(u[1]=l);var c=e.get("colorMappingBy"),h={type:a.name,dataExtent:u,visual:a.range};"color"!==h.type||"index"!==c&&"id"!==c?h.mappingMethod="linear":(h.mappingMethod="category",h.loop=!0);var d=new kqt(h);return Rqt(d).drColorMappingBy=c,d}(0,r,o,0,u,p);S_t(p,(function(t,e){if(t.depth>=n.length||t===n[t.depth]){var o=function(t,e,n,i,r,o){var a=v_t({},e);if(r){var s=r.type,l="color"===s&&Rqt(r).drColorMappingBy,u="index"===l?i:"id"===l?o.mapIdToIndex(n.getId()):n.getValue(t.get("visualDimension"));a[s]=r.mapValueToVisual(u)}return a}(r,u,t,e,f,i);$qt(t,o,n,i)}}))}else s=Pqt(u),c.fill=s}}function Pqt(t){var e=zqt(t,"color");if(e){var n=zqt(t,"colorAlpha"),i=zqt(t,"colorSaturation");return i&&(e=ISt(e,null,null,i)),n&&(e=MSt(e,n)),e}}function zqt(t,e){var n=t[e];if(null!=n&&"none"!==n)return n}function Bqt(t,e){var n=t.get(e);return E_t(n)&&n.length?{name:e,range:n}:null}var Vqt=Math.max,Wqt=Math.min,jqt=V_t,Uqt=S_t,Gqt=["itemStyle","borderWidth"],Hqt=["itemStyle","gapWidth"],qqt=["upperLabel","show"],Xqt=["upperLabel","height"],Yqt={seriesType:"treemap",reset:function(t,e,n,i){var r=n.getWidth(),o=n.getHeight(),a=t.option,s=IOt(t.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()}),l=a.size||[],u=dAt(jqt(s.width,l[0]),r),c=dAt(jqt(s.height,l[1]),o),h=i&&i.type,d=JHt(i,["treemapZoomToNode","treemapRootToNode"],t),p="treemapRender"===h||"treemapMove"===h?i.rootRect:null,f=t.getViewRoot(),g=QHt(f);if("treemapMove"!==h){var m="treemapZoomToNode"===h?function(t,e,n,i,r){var o,a=(e||{}).node,s=[i,r];if(!a||a===n)return s;var l=i*r,u=l*t.option.zoomToNodeRatio;for(;o=a.parentNode;){for(var c=0,h=o.children,d=0,p=h.length;d<p;d++)c+=h[d].getValue();var f=a.getValue();if(0===f)return s;u*=c/f;var g=o.getModel(),m=g.get(Gqt);(u+=4*m*m+(3*m+Math.max(m,tXt(g)))*Math.pow(u,.5))>9007199254740991&&(u=9007199254740991),a=o}u<l&&(u=l);var y=Math.pow(u/l,.5);return[i*y,r*y]}(t,d,f,u,c):p?[p.width,p.height]:[u,c],y=a.sort;y&&"asc"!==y&&"desc"!==y&&(y="desc");var v={squareRatio:a.squareRatio,sort:y,leafDepth:a.leafDepth};f.hostTree.clearLayouts();var x={x:0,y:0,width:m[0],height:m[1],area:m[0]*m[1]};f.setLayout(x),Kqt(f,v,!1,0),x=f.getLayout(),Uqt(g,(function(t,e){var n=(g[e+1]||f).getValue();t.setLayout(v_t({dataExtent:[n,n],borderWidth:0,upperHeight:0},x))}))}var b=t.getData().tree.root;b.setLayout(function(t,e,n){if(e)return{x:e.x,y:e.y};var i={x:0,y:0};if(!n)return i;var r=n.node,o=r.getLayout();if(!o)return i;var a=[o.width/2,o.height/2],s=r;for(;s;){var l=s.getLayout();a[0]+=l.x,a[1]+=l.y,s=s.parentNode}return{x:t.width/2-a[0],y:t.height/2-a[1]}}(s,p,d),!0),t.setLayoutInfo(s),Qqt(b,new PCt(-s.x,-s.y,r,o),g,f,0)}};function Kqt(t,e,n,i){var r,o;if(!t.isRemoved()){var a=t.getLayout();r=a.width,o=a.height;var s=t.getModel(),l=s.get(Gqt),u=s.get(Hqt)/2,c=tXt(s),h=Math.max(l,c),d=l-u,p=h-u;t.setLayout({borderWidth:l,upperHeight:h,upperLabelHeight:c},!0);var f=(r=Vqt(r-2*d,0))*(o=Vqt(o-d-p,0)),g=function(t,e,n,i,r,o){var a=t.children||[],s=i.sort;"asc"!==s&&"desc"!==s&&(s=null);var l=null!=i.leafDepth&&i.leafDepth<=o;if(r&&!l)return t.viewChildren=[];!function(t,e){e&&t.sort((function(t,n){var i="asc"===e?t.getValue()-n.getValue():n.getValue()-t.getValue();return 0===i?"asc"===e?t.dataIndex-n.dataIndex:n.dataIndex-t.dataIndex:i}))}(a=I_t(a,(function(t){return!t.isRemoved()})),s);var u=function(t,e,n){for(var i=0,r=0,o=e.length;r<o;r++)i+=e[r].getValue();var a,s=t.get("visualDimension");e&&e.length?"value"===s&&n?(a=[e[e.length-1].getValue(),e[0].getValue()],"asc"===n&&a.reverse()):(a=[1/0,-1/0],Uqt(e,(function(t){var e=t.getValue(s);e<a[0]&&(a[0]=e),e>a[1]&&(a[1]=e)}))):a=[NaN,NaN];return{sum:i,dataExtent:a}}(e,a,s);if(0===u.sum)return t.viewChildren=[];if(u.sum=function(t,e,n,i,r){if(!i)return n;for(var o=t.get("visibleMin"),a=r.length,s=a,l=a-1;l>=0;l--){var u=r["asc"===i?a-l-1:l].getValue();u/n*e<o&&(s=l,n-=u)}return"asc"===i?r.splice(0,a-s):r.splice(s,a-s),n}(e,n,u.sum,s,a),0===u.sum)return t.viewChildren=[];for(var c=0,h=a.length;c<h;c++){var d=a[c].getValue()/u.sum*n;a[c].setLayout({area:d})}l&&(a.length&&t.setLayout({isLeafRoot:!0},!0),a.length=0);return t.viewChildren=a,t.setLayout({dataExtent:u.dataExtent},!0),a}(t,s,f,e,n,i);if(g.length){var m={x:d,y:p,width:r,height:o},y=Wqt(r,o),v=1/0,x=[];x.area=0;for(var b=0,w=g.length;b<w;){var _=g[b];x.push(_),x.area+=_.getLayout().area;var k=Zqt(x,y,e.squareRatio);k<=v?(b++,v=k):(x.area-=x.pop().getLayout().area,Jqt(x,y,m,u,!1),y=Wqt(m.width,m.height),x.length=x.area=0,v=1/0)}if(x.length&&Jqt(x,y,m,u,!0),!n){var S=s.get("childrenVisibleMin");null!=S&&f<S&&(n=!0)}for(b=0,w=g.length;b<w;b++)Kqt(g[b],e,n,i+1)}}}function Zqt(t,e,n){for(var i=0,r=1/0,o=0,a=void 0,s=t.length;o<s;o++)(a=t[o].getLayout().area)&&(a<r&&(r=a),a>i&&(i=a));var l=t.area*t.area,u=e*e*n;return l?Vqt(u*i/l,l/(u*r)):1/0}function Jqt(t,e,n,i,r){var o=e===n.width?0:1,a=1-o,s=["x","y"],l=["width","height"],u=n[s[o]],c=e?t.area/e:0;(r||c>n[l[a]])&&(c=n[l[a]]);for(var h=0,d=t.length;h<d;h++){var p=t[h],f={},g=c?p.getLayout().area/c:0,m=f[l[a]]=Vqt(c-2*i,0),y=n[s[o]]+n[l[o]]-u,v=h===d-1||y<g?y:g,x=f[l[o]]=Vqt(v-2*i,0);f[s[a]]=n[s[a]]+Wqt(i,m/2),f[s[o]]=u+Wqt(i,x/2),u+=v,p.setLayout(f,!0)}n[s[a]]+=c,n[l[a]]-=c}function Qqt(t,e,n,i,r){var o=t.getLayout(),a=n[r],s=a&&a===t;if(!(a&&!s||r===n.length&&t!==i)){t.setLayout({isInView:!0,invisible:!s&&!e.intersect(o),isAboveViewRoot:s},!0);var l=new PCt(e.x-o.x,e.y-o.y,e.width,e.height);Uqt(t.viewChildren||[],(function(t){Qqt(t,l,n,i,r+1)}))}}function tXt(t){return t.get(qqt)?t.get(Xqt):0}function eXt(t){var e=t.findComponents({mainType:"legend"});e&&e.length&&t.eachSeriesByType("graph",(function(t){var n=t.getCategoriesData(),i=t.getGraph().data,r=n.mapArray(n.getName);i.filterSelf((function(t){var n=i.getItemModel(t).getShallow("category");if(null!=n){"number"==typeof n&&(n=r[n]);for(var o=0;o<e.length;o++)if(!e[o].isSelected(n))return!1}return!0}))}))}function nXt(t){var e={};t.eachSeriesByType("graph",(function(t){var n=t.getCategoriesData(),i=t.getData(),r={};n.each((function(i){var o=n.getName(i);r["ec-"+o]=i;var a=n.getItemModel(i),s=a.getModel("itemStyle").getItemStyle();s.fill||(s.fill=t.getColorFromPalette(o,e)),n.setItemVisual(i,"style",s);for(var l=["symbol","symbolSize","symbolKeepAspect"],u=0;u<l.length;u++){var c=a.getShallow(l[u],!0);null!=c&&n.setItemVisual(i,l[u],c)}})),n.count()&&i.each((function(t){var e=i.getItemModel(t).getShallow("category");if(null!=e){"string"==typeof e&&(e=r["ec-"+e]);var o=n.getItemVisual(e,"style");v_t(i.ensureUniqueItemVisual(t,"style"),o);for(var a=["symbol","symbolSize","symbolKeepAspect"],s=0;s<a.length;s++)i.setItemVisual(t,a[s],n.getItemVisual(e,a[s]))}}))}))}function iXt(t){return t instanceof Array||(t=[t,t]),t}function rXt(t){t.eachSeriesByType("graph",(function(t){var e=t.getGraph(),n=t.getEdgeData(),i=iXt(t.get("edgeSymbol")),r=iXt(t.get("edgeSymbolSize"));n.setVisual("fromSymbol",i&&i[0]),n.setVisual("toSymbol",i&&i[1]),n.setVisual("fromSymbolSize",r&&r[0]),n.setVisual("toSymbolSize",r&&r[1]),n.setVisual("style",t.getModel("lineStyle").getLineStyle()),n.each((function(t){var i=n.getItemModel(t),r=e.getEdgeByIndex(t),o=iXt(i.getShallow("symbol",!0)),a=iXt(i.getShallow("symbolSize",!0)),s=i.getModel("lineStyle").getLineStyle(),l=n.ensureUniqueItemVisual(t,"style");switch(v_t(l,s),l.stroke){case"source":var u=r.node1.getVisual("style");l.stroke=u&&u.fill;break;case"target":u=r.node2.getVisual("style");l.stroke=u&&u.fill}o[0]&&r.setVisual("fromSymbol",o[0]),o[1]&&r.setVisual("toSymbol",o[1]),a[0]&&r.setVisual("fromSymbolSize",a[0]),a[1]&&r.setVisual("toSymbolSize",a[1])}))}))}var oXt=function(t){return t.get("autoCurveness")||null},aXt=function(t,e){var n=oXt(t),i=20,r=[];if("number"==typeof n)i=n;else if(E_t(n))return void(t.__curvenessList=n);e>i&&(i=e);var o=i%2?i+2:i+3;r=[];for(var a=0;a<o;a++)r.push((a%2?a+1:a)/10*(a%2?-1:1));t.__curvenessList=r},sXt=function(t,e,n){var i=[t.id,t.dataIndex].join("."),r=[e.id,e.dataIndex].join(".");return[n.uid,i,r].join("--\x3e")},lXt=function(t){var e=t.split("--\x3e");return[e[0],e[2],e[1]].join("--\x3e")},uXt=function(t,e){var n=e.__edgeMap;return n[t]?n[t].length:0};function cXt(t,e,n,i){var r=oXt(e),o=E_t(r);if(!r)return null;var a=function(t,e){var n=sXt(t.node1,t.node2,e);return e.__edgeMap[n]}(t,e);if(!a)return null;for(var s=-1,l=0;l<a.length;l++)if(a[l]===n){s=l;break}var u=function(t,e){return uXt(sXt(t.node1,t.node2,e),e)+uXt(sXt(t.node2,t.node1,e),e)}(t,e);aXt(e,u),t.lineStyle=t.lineStyle||{};var c=sXt(t.node1,t.node2,e),h=e.__curvenessList,d=o||u%2?0:1;if(a.isForward)return h[d+s];var p=lXt(c),f=uXt(p,e),g=h[s+f+d];return i?o?r&&0===r[0]?(f+d)%2?g:-g:((f%2?0:1)+d)%2?g:-g:(f+d)%2?g:-g:h[s+f+d]}function hXt(t){var e=t.coordinateSystem;if(!e||"view"===e.type){var n=t.getGraph();n.eachNode((function(t){var e=t.getModel();t.setLayout([+e.get("x"),+e.get("y")])})),dXt(n,t)}}function dXt(t,e){t.eachEdge((function(t,n){var i=j_t(t.getModel().get(["lineStyle","curveness"]),-cXt(t,e,n,!0),0),r=rkt(t.node1.getLayout()),o=rkt(t.node2.getLayout()),a=[r,o];+i&&a.push([(r[0]+o[0])/2-(r[1]-o[1])*i,(r[1]+o[1])/2-(o[0]-r[0])*i]),t.setLayout(a)}))}function pXt(t,e){t.eachSeriesByType("graph",(function(t){var e=t.get("layout"),n=t.coordinateSystem;if(n&&"view"!==n.type){var i=t.getData(),r=[];S_t(n.dimensions,(function(t){r=r.concat(i.mapDimensionsAll(t))}));for(var o=0;o<i.count();o++){for(var a=[],s=!1,l=0;l<r.length;l++){var u=i.get(r[l],o);isNaN(u)||(s=!0),a.push(u)}s?i.setItemLayout(o,n.dataToPoint(a)):i.setItemLayout(o,[NaN,NaN])}dXt(i.graph,t)}else e&&"none"!==e||hXt(t)}))}function fXt(t){var e=t.coordinateSystem;if("view"!==e.type)return 1;var n=t.option.nodeScaleRatio,i=e.scaleX;return((e.getZoom()-1)*n+1)/i}function gXt(t){var e=t.getVisual("symbolSize");return e instanceof Array&&(e=(e[0]+e[1])/2),+e}var mXt=Math.PI,yXt=[];function vXt(t,e){var n=t.coordinateSystem;if(!n||"view"===n.type){var i=n.getBoundingRect(),r=t.getData(),o=r.graph,a=i.width/2+i.x,s=i.height/2+i.y,l=Math.min(i.width,i.height)/2,u=r.count();r.setLayout({cx:a,cy:s}),u&&(xXt[e](t,o,r,l,a,s,u),o.eachEdge((function(e,n){var i,r=j_t(e.getModel().get(["lineStyle","curveness"]),cXt(e,t,n),0),o=rkt(e.node1.getLayout()),l=rkt(e.node2.getLayout()),u=(o[0]+l[0])/2,c=(o[1]+l[1])/2;+r&&(i=[a*(r*=3)+u*(1-r),s*r+c*(1-r)]),e.setLayout([o,l,i])})))}}var xXt={value:function(t,e,n,i,r,o,a){var s=0,l=n.getSum("value"),u=2*Math.PI/(l||a);e.eachNode((function(t){var e=t.getValue("value"),n=u*(l?e:1)/2;s+=n,t.setLayout([i*Math.cos(s)+r,i*Math.sin(s)+o]),s+=n}))},symbolSize:function(t,e,n,i,r,o,a){var s=0;yXt.length=a;var l=fXt(t);e.eachNode((function(t){var e=gXt(t);isNaN(e)&&(e=2),e<0&&(e=0),e*=l;var n=Math.asin(e/2/i);isNaN(n)&&(n=mXt/2),yXt[t.dataIndex]=n,s+=2*n}));var u=(2*mXt-s)/a/2,c=0;e.eachNode((function(t){var e=u+yXt[t.dataIndex];c+=e,t.setLayout([i*Math.cos(c)+r,i*Math.sin(c)+o]),c+=e}))}};function bXt(t){t.eachSeriesByType("graph",(function(t){"circular"===t.get("layout")&&vXt(t,"symbolSize")}))}var wXt=akt;function _Xt(t){t.eachSeriesByType("graph",(function(t){var e=t.coordinateSystem;if(!e||"view"===e.type)if("force"===t.get("layout")){var n=t.preservedPoints||{},i=t.getGraph(),r=i.data,o=i.edgeData,a=t.getModel("force"),s=a.get("initLayout");t.preservedPoints?r.each((function(t){var e=r.getId(t);r.setItemLayout(t,n[e]||[NaN,NaN])})):s&&"none"!==s?"circular"===s&&vXt(t,"value"):hXt(t);var l=r.getDataExtent("value"),u=o.getDataExtent("value"),c=a.get("repulsion"),h=a.get("edgeLength"),d=E_t(c)?c:[c,c],p=E_t(h)?h:[h,h];p=[p[1],p[0]];var f=r.mapArray("value",(function(t,e){var n=r.getItemLayout(e),i=hAt(t,l,d);return isNaN(i)&&(i=(d[0]+d[1])/2),{w:i,rep:i,fixed:r.getItemModel(e).get("fixed"),p:!n||isNaN(n[0])||isNaN(n[1])?null:n}})),g=o.mapArray("value",(function(e,n){var r=i.getEdgeByIndex(n),o=hAt(e,u,p);isNaN(o)&&(o=(p[0]+p[1])/2);var a=r.getModel(),s=j_t(r.getModel().get(["lineStyle","curveness"]),-cXt(r,t,n,!0),0);return{n1:f[r.node1.dataIndex],n2:f[r.node2.dataIndex],d:o,curveness:s,ignoreForceLayout:a.get("ignoreForceLayout")}})),m=e.getBoundingRect(),y=function(t,e,n){for(var i=t,r=e,o=n.rect,a=o.width,s=o.height,l=[o.x+a/2,o.y+s/2],u=null==n.gravity?.1:n.gravity,c=0;c<i.length;c++){var h=i[c];h.p||(h.p=nkt(a*(Math.random()-.5)+l[0],s*(Math.random()-.5)+l[1])),h.pp=rkt(h.p),h.edges=null}var d,p,f=null==n.friction?.6:n.friction,g=f;return{warmUp:function(){g=.8*f},setFixed:function(t){i[t].fixed=!0},setUnfixed:function(t){i[t].fixed=!1},beforeStep:function(t){d=t},afterStep:function(t){p=t},step:function(t){d&&d(i,r);for(var e,n,o,a=[],s=i.length,c=0;c<r.length;c++){var h=r[c];if(!h.ignoreForceLayout){var f=h.n1;skt(a,(x=h.n2).p,f.p);var m=lkt(a)-h.d,y=x.w/(f.w+x.w);isNaN(y)&&(y=0),ckt(a,a),!f.fixed&&wXt(f.p,f.p,a,y*m*g),!x.fixed&&wXt(x.p,x.p,a,-(1-y)*m*g)}}for(c=0;c<s;c++)(_=i[c]).fixed||(skt(a,l,_.p),wXt(_.p,_.p,a,u*g));for(c=0;c<s;c++){f=i[c];for(var v=c+1;v<s;v++){var x;skt(a,(x=i[v]).p,f.p),0===(m=lkt(a))&&(e=a,n=Math.random()-.5,o=Math.random()-.5,e[0]=n,e[1]=o,m=1);var b=(f.rep+x.rep)/m/m;!f.fixed&&wXt(f.pp,f.pp,a,b),!x.fixed&&wXt(x.pp,x.pp,a,-b)}}var w=[];for(c=0;c<s;c++){var _;(_=i[c]).fixed||(skt(w,_.p,_.pp),wXt(_.p,_.p,w,g),ikt(_.pp,_.p))}var k=(g*=.992)<.01;p&&p(i,r,k),t&&t(k)}}}(f,g,{rect:m,gravity:a.get("gravity"),friction:a.get("friction")});y.beforeStep((function(t,e){for(var n=0,r=t.length;n<r;n++)t[n].fixed&&ikt(t[n].p,i.getNodeByIndex(n).getLayout())})),y.afterStep((function(t,e,o){for(var a=0,s=t.length;a<s;a++)t[a].fixed||i.getNodeByIndex(a).setLayout(t[a].p),n[r.getId(a)]=t[a].p;for(a=0,s=e.length;a<s;a++){var l=e[a],u=i.getEdgeByIndex(a),c=l.n1.p,h=l.n2.p,d=u.getLayout();(d=d?d.slice():[])[0]=d[0]||[],d[1]=d[1]||[],ikt(d[0],c),ikt(d[1],h),+l.curveness&&(d[2]=[(c[0]+h[0])/2-(c[1]-h[1])*l.curveness,(c[1]+h[1])/2-(h[0]-c[0])*l.curveness]),u.setLayout(d)}})),t.forceLayout=y,t.preservedPoints=n,y.step()}else t.forceLayout=null}))}function kXt(t,e){var n=[];return t.eachSeriesByType("graph",(function(t){var i=t.get("coordinateSystem");if(!i||"view"===i){var r=t.getData(),o=[],a=[];dMt(r.mapArray((function(t){var e=r.getItemModel(t);return[+e.get("x"),+e.get("y")]})),o,a),a[0]-o[0]==0&&(a[0]+=1,o[0]-=1),a[1]-o[1]==0&&(a[1]+=1,o[1]-=1);var s=(a[0]-o[0])/(a[1]-o[1]),l=function(t,e,n){return IOt(v_t(t.getBoxLayoutParams(),{aspect:n}),{width:e.getWidth(),height:e.getHeight()})}(t,e,s);isNaN(s)&&(o=[l.x,l.y],a=[l.x+l.width,l.y+l.height]);var u=a[0]-o[0],c=a[1]-o[1],h=l.width,d=l.height,p=t.coordinateSystem=new fHt;p.zoomLimit=t.get("scaleLimit"),p.setBoundingRect(o[0],o[1],u,c),p.setViewRect(l.x,l.y,h,d),p.setCenter(t.get("center")),p.setZoom(t.get("zoom")),n.push(p)}})),n}var SXt=hEt.prototype,CXt=gEt.prototype,AXt=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1};function IXt(t){return isNaN(+t.cpx1)||isNaN(+t.cpy1)}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Dit(e,t)}(AXt);var MXt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="ec-line",n}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new AXt},e.prototype.buildPath=function(t,e){IXt(e)?SXt.buildPath.call(this,t,e):CXt.buildPath.call(this,t,e)},e.prototype.pointAt=function(t){return IXt(this.shape)?SXt.pointAt.call(this,t):CXt.pointAt.call(this,t)},e.prototype.tangentAt=function(t){var e=this.shape,n=IXt(e)?[e.x2-e.x1,e.y2-e.y1]:CXt.tangentAt.call(this,t);return ckt(n,n)},e}(rDt),DXt=["fromSymbol","toSymbol"];function TXt(t){return"_"+t+"Type"}function EXt(t,e,n){var i=e.getItemVisual(n,t);if(i&&"none"!==i){var r=e.getItemVisual(n,t+"Size"),o=e.getItemVisual(n,t+"Rotate"),a=e.getItemVisual(n,t+"Offset")||0,s=e.getItemVisual(n,t+"KeepAspect"),l=E_t(r)?r:[r,r],u=E_t(a)?a:[a,a];u[0]=dAt(u[0],l[0]),u[1]=dAt(W_t(u[1],u[0]),l[1]);var c=U$t(i,-l[0]/2+u[0],-l[1]/2+u[1],l[0],l[1],null,s);return c.__specifiedRotation=null==o||isNaN(o)?void 0:+o*Math.PI/180||0,c.name=t,c}}function NXt(t,e){t.x1=e[0][0],t.y1=e[0][1],t.x2=e[1][0],t.y2=e[1][1],t.percent=1;var n=e[2];n?(t.cpx1=n[0],t.cpy1=n[1]):(t.cpx1=NaN,t.cpy1=NaN)}var OXt=function(t){function e(e,n,i){var r=t.call(this)||this;return r._createLine(e,n,i),r}return Dit(e,t),e.prototype._createLine=function(t,e,n){var i=t.hostModel,r=function(t){var e=new MXt({name:"line",subPixelOptimize:!0});return NXt(e.shape,t),e}(t.getItemLayout(e));r.shape.percent=0,jEt(r,{shape:{percent:1}},i,e),this.add(r),S_t(DXt,(function(n){var i=EXt(n,t,e);this.add(i),this[TXt(n)]=t.getItemVisual(e,n)}),this),this._updateCommonStl(t,e,n)},e.prototype.updateData=function(t,e,n){var i=t.hostModel,r=this.childOfName("line"),o=t.getItemLayout(e),a={shape:{}};NXt(a.shape,o),WEt(r,a,i,e),S_t(DXt,(function(n){var i=t.getItemVisual(e,n),r=TXt(n);if(this[r]!==i){this.remove(this.childOfName(n));var o=EXt(n,t,e);this.add(o)}this[r]=i}),this),this._updateCommonStl(t,e,n)},e.prototype.getLinePath=function(){return this.childAt(0)},e.prototype._updateCommonStl=function(t,e,n){var i=t.hostModel,r=this.childOfName("line"),o=n&&n.emphasisLineStyle,a=n&&n.blurLineStyle,s=n&&n.selectLineStyle,l=n&&n.labelStatesModels;if(!n||t.hasItemOption){var u=t.getItemModel(e);o=u.getModel(["emphasis","lineStyle"]).getLineStyle(),a=u.getModel(["blur","lineStyle"]).getLineStyle(),s=u.getModel(["select","lineStyle"]).getLineStyle(),l=cNt(u)}var c=t.getItemVisual(e,"style"),h=c.stroke;r.useStyle(c),r.style.fill=null,r.style.strokeNoScale=!0,r.ensureState("emphasis").style=o,r.ensureState("blur").style=a,r.ensureState("select").style=s,S_t(DXt,(function(t){var e=this.childOfName(t);if(e){e.setColor(h),e.style.opacity=c.opacity;for(var n=0;n<EDt.length;n++){var i=EDt[n],o=r.getState(i);if(o){var a=o.style||{},s=e.ensureState(i),l=s.style||(s.style={});null!=a.stroke&&(l[e.__isEmptyBrush?"stroke":"fill"]=a.stroke),null!=a.opacity&&(l.opacity=a.opacity)}}e.markRedraw()}}),this);var d=i.getRawValue(e);uNt(this,l,{labelDataIndex:e,labelFetcher:{getFormattedLabel:function(e,n){return i.getFormattedLabel(e,n,t.dataType)}},inheritColor:h||"#000",defaultOpacity:c.opacity,defaultText:(null==d?t.getName(e):isFinite(d)?pAt(d):d)+""});var p=this.getTextContent();if(p){var f=l.normal;p.__align=p.style.align,p.__verticalAlign=p.style.verticalAlign,p.__position=f.get("position")||"middle";var g=f.get("distance");E_t(g)||(g=[g,g]),p.__labelDistance=g}this.setTextConfig({position:null,local:!0,inside:!1}),uTt(this)},e.prototype.highlight=function(){KDt(this)},e.prototype.downplay=function(){ZDt(this)},e.prototype.updateLayout=function(t,e){this.setLinePoints(t.getItemLayout(e))},e.prototype.setLinePoints=function(t){var e=this.childOfName("line");NXt(e.shape,t),e.dirty()},e.prototype.beforeUpdate=function(){var t=this,e=t.childOfName("fromSymbol"),n=t.childOfName("toSymbol"),i=t.getTextContent();if(e||n||i&&!i.ignore){for(var r=1,o=this.parent;o;)o.scaleX&&(r/=o.scaleX),o=o.parent;var a=t.childOfName("line");if(this.__dirty||a.__dirty){var s=a.shape.percent,l=a.pointAt(0),u=a.pointAt(s),c=skt([],u,l);if(ckt(c,c),e&&(e.setPosition(l),k(e,0),e.scaleX=e.scaleY=r*s,e.markRedraw()),n&&(n.setPosition(u),k(n,1),n.scaleX=n.scaleY=r*s,n.markRedraw()),i&&!i.ignore){i.x=i.y=0,i.originX=i.originY=0;var h=void 0,d=void 0,p=i.__labelDistance,f=p[0]*r,g=p[1]*r,m=s/2,y=a.tangentAt(m),v=[y[1],-y[0]],x=a.pointAt(m);v[1]>0&&(v[0]=-v[0],v[1]=-v[1]);var b=y[0]<0?-1:1;if("start"!==i.__position&&"end"!==i.__position){var w=-Math.atan2(y[1],y[0]);u[0]<l[0]&&(w=Math.PI+w),i.rotation=w}var _=void 0;switch(i.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":_=-g,d="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":_=g,d="top";break;default:_=0,d="middle"}switch(i.__position){case"end":i.x=c[0]*f+u[0],i.y=c[1]*g+u[1],h=c[0]>.8?"left":c[0]<-.8?"right":"center",d=c[1]>.8?"top":c[1]<-.8?"bottom":"middle";break;case"start":i.x=-c[0]*f+l[0],i.y=-c[1]*g+l[1],h=c[0]>.8?"right":c[0]<-.8?"left":"center",d=c[1]>.8?"bottom":c[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":i.x=f*b+l[0],i.y=l[1]+_,h=y[0]<0?"right":"left",i.originX=-f*b,i.originY=-_;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":i.x=x[0],i.y=x[1]+_,h="center",i.originY=-_;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":i.x=-f*b+u[0],i.y=u[1]+_,h=y[0]>=0?"right":"left",i.originX=f*b,i.originY=-_}i.scaleX=i.scaleY=r,i.setStyle({verticalAlign:i.__verticalAlign||d,align:i.__align||h})}}}function k(t,e){var n=t.__specifiedRotation;if(null==n){var i=a.tangentAt(e);t.attr("rotation",(1===e?-1:1)*Math.PI/2-Math.atan2(i[1],i[0]))}else t.attr("rotation",n)}},e}(oAt),FXt=function(){function t(t){this.group=new oAt,this._LineCtor=t||OXt}return t.prototype.isPersistent=function(){return!0},t.prototype.updateData=function(t){var e=this,n=this,i=n.group,r=n._lineData;n._lineData=t,r||i.removeAll();var o=RXt(t);t.diff(r).add((function(n){e._doAdd(t,n,o)})).update((function(n,i){e._doUpdate(r,t,i,n,o)})).remove((function(t){i.remove(r.getItemGraphicEl(t))})).execute()},t.prototype.updateLayout=function(){var t=this._lineData;t&&t.eachItemGraphicEl((function(e,n){e.updateLayout(t,n)}),this)},t.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=RXt(t),this._lineData=null,this.group.removeAll()},t.prototype.incrementalUpdate=function(t,e){function n(t){t.isGroup||function(t){return t.animators&&t.animators.length>0}(t)||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}for(var i=t.start;i<t.end;i++){if($Xt(e.getItemLayout(i))){var r=new this._LineCtor(e,i,this._seriesScope);r.traverse(n),this.group.add(r),e.setItemGraphicEl(i,r)}}},t.prototype.remove=function(){this.group.removeAll()},t.prototype._doAdd=function(t,e,n){if($Xt(t.getItemLayout(e))){var i=new this._LineCtor(t,e,n);t.setItemGraphicEl(e,i),this.group.add(i)}},t.prototype._doUpdate=function(t,e,n,i,r){var o=t.getItemGraphicEl(n);$Xt(e.getItemLayout(i))?(o?o.updateData(e,i,r):o=new this._LineCtor(e,i,r),e.setItemGraphicEl(i,o),this.group.add(o)):this.group.remove(o)},t}();function RXt(t){var e=t.hostModel;return{lineStyle:e.getModel("lineStyle").getLineStyle(),emphasisLineStyle:e.getModel(["emphasis","lineStyle"]).getLineStyle(),blurLineStyle:e.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:e.getModel(["select","lineStyle"]).getLineStyle(),labelStatesModels:cNt(e)}}function LXt(t){return isNaN(t[0])||isNaN(t[1])}function $Xt(t){return!LXt(t[0])&&!LXt(t[1])}var PXt=[],zXt=[],BXt=[],VXt=JIt,WXt=pkt,jXt=Math.abs;function UXt(t,e,n){for(var i,r=t[0],o=t[1],a=t[2],s=1/0,l=n*n,u=.1,c=.1;c<=.9;c+=.1){PXt[0]=VXt(r[0],o[0],a[0],c),PXt[1]=VXt(r[1],o[1],a[1],c),(p=jXt(WXt(PXt,e)-l))<s&&(s=p,i=c)}for(var h=0;h<32;h++){var d=i+u;zXt[0]=VXt(r[0],o[0],a[0],i),zXt[1]=VXt(r[1],o[1],a[1],i),BXt[0]=VXt(r[0],o[0],a[0],d),BXt[1]=VXt(r[1],o[1],a[1],d);var p=WXt(zXt,e)-l;if(jXt(p)<.01)break;var f=WXt(BXt,e)-l;u/=2,p<0?f>=0?i+=u:i-=u:f>=0?i-=u:i+=u}return i}function GXt(t,e){var n=[],i=eMt,r=[[],[],[]],o=[[],[]],a=[];e/=2,t.eachEdge((function(t,s){var l=t.getLayout(),u=t.getVisual("fromSymbol"),c=t.getVisual("toSymbol");l.__original||(l.__original=[rkt(l[0]),rkt(l[1])],l[2]&&l.__original.push(rkt(l[2])));var h=l.__original;if(null!=l[2]){if(ikt(r[0],h[0]),ikt(r[1],h[2]),ikt(r[2],h[1]),u&&"none"!==u){var d=gXt(t.node1),p=UXt(r,h[0],d*e);i(r[0][0],r[1][0],r[2][0],p,n),r[0][0]=n[3],r[1][0]=n[4],i(r[0][1],r[1][1],r[2][1],p,n),r[0][1]=n[3],r[1][1]=n[4]}if(c&&"none"!==c){d=gXt(t.node2),p=UXt(r,h[1],d*e);i(r[0][0],r[1][0],r[2][0],p,n),r[1][0]=n[1],r[2][0]=n[2],i(r[0][1],r[1][1],r[2][1],p,n),r[1][1]=n[1],r[2][1]=n[2]}ikt(l[0],r[0]),ikt(l[1],r[2]),ikt(l[2],r[1])}else{if(ikt(o[0],h[0]),ikt(o[1],h[1]),skt(a,o[1],o[0]),ckt(a,a),u&&"none"!==u){d=gXt(t.node1);akt(o[0],o[0],a,d*e)}if(c&&"none"!==c){d=gXt(t.node2);akt(o[1],o[1],a,-d*e)}ikt(l[0],o[0]),ikt(l[1],o[1])}}))}function HXt(t){return"view"===t.type}var qXt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(t,e){var n=new yjt,i=new FXt,r=this.group;this._controller=new jGt(e.getZr()),this._controllerHost={target:r},r.add(n.group),r.add(i.group),this._symbolDraw=n,this._lineDraw=i,this._firstRender=!0},e.prototype.render=function(t,e,n){var i=this,r=t.coordinateSystem;this._model=t;var o=this._symbolDraw,a=this._lineDraw,s=this.group;if(HXt(r)){var l={x:r.x,y:r.y,scaleX:r.scaleX,scaleY:r.scaleY};this._firstRender?s.attr(l):WEt(s,l,t)}GXt(t.getGraph(),fXt(t));var u=t.getData();o.updateData(u);var c=t.getEdgeData();a.updateData(c),this._updateNodeAndLinkScale(),this._updateController(t,e,n),clearTimeout(this._layoutTimeout);var h=t.forceLayout,d=t.get(["force","layoutAnimation"]);h&&this._startForceLayoutIteration(h,d),u.graph.eachNode((function(t){var e=t.dataIndex,n=t.getGraphicEl(),r=t.getModel();n.off("drag").off("dragend");var o=r.get("draggable");o&&n.on("drag",(function(){h&&(h.warmUp(),!i._layouting&&i._startForceLayoutIteration(h,d),h.setFixed(e),u.setItemLayout(e,[n.x,n.y]))})).on("dragend",(function(){h&&h.setUnfixed(e)})),n.setDraggable(o&&!!h),"adjacency"===r.get(["emphasis","focus"])&&(IDt(n).focus=t.getAdjacentDataIndices())})),u.graph.eachEdge((function(t){var e=t.getGraphicEl();"adjacency"===t.getModel().get(["emphasis","focus"])&&(IDt(e).focus={edge:[t.dataIndex],node:[t.node1.dataIndex,t.node2.dataIndex]})}));var p="circular"===t.get("layout")&&t.get(["circular","rotateLabel"]),f=u.getLayout("cx"),g=u.getLayout("cy");u.eachItemGraphicEl((function(t,e){var n=u.getItemModel(e).get(["label","rotate"])||0,i=t.getSymbolPath();if(p){var r=u.getItemLayout(e),o=Math.atan2(r[1]-g,r[0]-f);o<0&&(o=2*Math.PI+o);var a=r[0]<f;a&&(o-=Math.PI);var s=a?"left":"right";i.setTextConfig({rotation:-o,position:s,origin:"center"});var l=i.ensureState("emphasis");v_t(l.textConfig||(l.textConfig={}),{position:s})}else i.setTextConfig({rotation:n*=Math.PI/180})})),this._firstRender=!1},e.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},e.prototype._startForceLayoutIteration=function(t,e){var n=this;!function i(){t.step((function(t){n.updateLayout(n._model),(n._layouting=!t)&&(e?n._layoutTimeout=setTimeout(i,16):i())}))}()},e.prototype._updateController=function(t,e,n){var i=this,r=this._controller,o=this._controllerHost,a=this.group;r.setPointerChecker((function(e,i,r){var o=a.getBoundingRect();return o.applyTransform(a.transform),o.contain(i,r)&&!KGt(e,n,t)})),HXt(t.coordinateSystem)?(r.enable(t.get("roam")),o.zoomLimit=t.get("scaleLimit"),o.zoom=t.coordinateSystem.getZoom(),r.off("pan").off("zoom").on("pan",(function(e){qGt(o,e.dx,e.dy),n.dispatchAction({seriesId:t.id,type:"graphRoam",dx:e.dx,dy:e.dy})})).on("zoom",(function(e){XGt(o,e.scale,e.originX,e.originY),n.dispatchAction({seriesId:t.id,type:"graphRoam",zoom:e.scale,originX:e.originX,originY:e.originY}),i._updateNodeAndLinkScale(),GXt(t.getGraph(),fXt(t)),i._lineDraw.updateLayout(),n.updateLabelLayout()}))):r.disable()},e.prototype._updateNodeAndLinkScale=function(){var t=this._model,e=t.getData(),n=fXt(t);e.eachItemGraphicEl((function(t,e){t.setSymbolScale(n)}))},e.prototype.updateLayout=function(t){GXt(t.getGraph(),fXt(t)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},e.prototype.remove=function(t,e){this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()},e.type="graph",e}(aLt);function XXt(t){return"_EC_"+t}var YXt=function(){function t(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return t.prototype.isDirected=function(){return this._directed},t.prototype.addNode=function(t,e){t=null==t?""+e:""+t;var n=this._nodesMap;if(!n[XXt(t)]){var i=new KXt(t,e);return i.hostGraph=this,this.nodes.push(i),n[XXt(t)]=i,i}},t.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},t.prototype.getNodeById=function(t){return this._nodesMap[XXt(t)]},t.prototype.addEdge=function(t,e,n){var i=this._nodesMap,r=this._edgesMap;if("number"==typeof t&&(t=this.nodes[t]),"number"==typeof e&&(e=this.nodes[e]),t instanceof KXt||(t=i[XXt(t)]),e instanceof KXt||(e=i[XXt(e)]),t&&e){var o=t.id+"-"+e.id,a=new ZXt(t,e,n);return a.hostGraph=this,this._directed&&(t.outEdges.push(a),e.inEdges.push(a)),t.edges.push(a),t!==e&&e.edges.push(a),this.edges.push(a),r[o]=a,a}},t.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},t.prototype.getEdge=function(t,e){t instanceof KXt&&(t=t.id),e instanceof KXt&&(e=e.id);var n=this._edgesMap;return this._directed?n[t+"-"+e]:n[t+"-"+e]||n[e+"-"+t]},t.prototype.eachNode=function(t,e){for(var n=this.nodes,i=n.length,r=0;r<i;r++)n[r].dataIndex>=0&&t.call(e,n[r],r)},t.prototype.eachEdge=function(t,e){for(var n=this.edges,i=n.length,r=0;r<i;r++)n[r].dataIndex>=0&&n[r].node1.dataIndex>=0&&n[r].node2.dataIndex>=0&&t.call(e,n[r],r)},t.prototype.breadthFirstTraverse=function(t,e,n,i){if(e instanceof KXt||(e=this._nodesMap[XXt(e)]),e){for(var r="out"===n?"outEdges":"in"===n?"inEdges":"edges",o=0;o<this.nodes.length;o++)this.nodes[o].__visited=!1;if(!t.call(i,e,null))for(var a=[e];a.length;){var s=a.shift(),l=s[r];for(o=0;o<l.length;o++){var u=l[o],c=u.node1===s?u.node2:u.node1;if(!c.__visited){if(t.call(i,c,s))return;a.push(c),c.__visited=!0}}}}},t.prototype.update=function(){for(var t=this.data,e=this.edgeData,n=this.nodes,i=this.edges,r=0,o=n.length;r<o;r++)n[r].dataIndex=-1;for(r=0,o=t.count();r<o;r++)n[t.getRawIndex(r)].dataIndex=r;e.filterSelf((function(t){var n=i[e.getRawIndex(t)];return n.node1.dataIndex>=0&&n.node2.dataIndex>=0}));for(r=0,o=i.length;r<o;r++)i[r].dataIndex=-1;for(r=0,o=e.count();r<o;r++)i[e.getRawIndex(r)].dataIndex=r},t.prototype.clone=function(){for(var e=new t(this._directed),n=this.nodes,i=this.edges,r=0;r<n.length;r++)e.addNode(n[r].id,n[r].dataIndex);for(r=0;r<i.length;r++){var o=i[r];e.addEdge(o.node1.id,o.node2.id,o.dataIndex)}return e},t}(),KXt=function(){function t(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=null==t?"":t,this.dataIndex=null==e?-1:e}return t.prototype.degree=function(){return this.edges.length},t.prototype.inDegree=function(){return this.inEdges.length},t.prototype.outDegree=function(){return this.outEdges.length},t.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostGraph.data.getItemModel(this.dataIndex).getModel(t)},t.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var n=this.edges[e];n.dataIndex<0||(t.edge.push(n.dataIndex),t.node.push(n.node1.dataIndex,n.node2.dataIndex))}return t},t}(),ZXt=function(){function t(t,e,n){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=null==n?-1:n}return t.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostGraph.edgeData.getItemModel(this.dataIndex).getModel(t)},t.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},t}();function JXt(t,e){return{getValue:function(n){var i=this[t][e];return i.get(i.getDimension(n||"value"),this.dataIndex)},setVisual:function(n,i){this.dataIndex>=0&&this[t][e].setItemVisual(this.dataIndex,n,i)},getVisual:function(n){return this[t][e].getItemVisual(this.dataIndex,n)},setLayout:function(n,i){this.dataIndex>=0&&this[t][e].setItemLayout(this.dataIndex,n,i)},getLayout:function(){return this[t][e].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[t][e].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[t][e].getRawIndex(this.dataIndex)}}}function QXt(t,e,n,i,r){for(var o=new YXt(i),a=0;a<t.length;a++)o.addNode(V_t(t[a].id,t[a].name,a),a);var s=[],l=[],u=0;for(a=0;a<e.length;a++){var c=e[a],h=c.source,d=c.target;o.addEdge(h,d,u)&&(l.push(c),s.push(V_t(zAt(c.id,null),h+" > "+d)),u++)}var p,f=n.get("coordinateSystem");if("cartesian2d"===f||"polar"===f)p=tVt(t,n);else{var g=cFt.get(f),m=g&&g.dimensions||[];w_t(m,"value")<0&&m.concat(["value"]);var y=XBt(t,{coordDimensions:m});(p=new GBt(y,n)).initData(t)}var v=new GBt(["value"],n);return v.initData(l,s),r&&r(p,v),WHt({mainData:p,struct:o,structAttr:"graph",datas:{node:p,edge:v},datasAttr:{node:"data",edge:"edgeData"}}),o.update(),o}__t(KXt,JXt("hostGraph","data")),__t(ZXt,JXt("hostGraph","edgeData"));var tYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.hasSymbolVisual=!0,n}return Dit(e,t),e.prototype.init=function(e){t.prototype.init.apply(this,arguments);var n=this;function i(){return n._categoriesData}this.legendVisualProvider=new CUt(i,i),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},e.prototype.mergeOption=function(e){t.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},e.prototype.mergeDefaultAndTheme=function(e){t.prototype.mergeDefaultAndTheme.apply(this,arguments),OAt(e,"edgeLabel",["show"])},e.prototype.getInitialData=function(t,e){var n,i=t.edges||t.links||[],r=t.data||t.nodes||[],o=this;if(r&&i){oXt(n=this)&&(n.__curvenessList=[],n.__edgeMap={},aXt(n));var a=QXt(r,i,this,!0,(function(t,e){t.wrapMethod("getItemModel",(function(t){var e=o._categoriesModels[t.getShallow("category")];return e&&(e.parentModel=t.parentModel,t.parentModel=e),t}));var n=NNt.prototype.getModel;function i(t,e){var i=n.call(this,t,e);return i.resolveParentPath=r,i}function r(t){if(t&&("label"===t[0]||"label"===t[1])){var e=t.slice();return"label"===t[0]?e[0]="edgeLabel":"label"===t[1]&&(e[1]="edgeLabel"),e}return t}e.wrapMethod("getItemModel",(function(t){return t.resolveParentPath=r,t.getModel=i,t}))}));return S_t(a.edges,(function(t){!function(t,e,n,i){if(oXt(n)){var r=sXt(t,e,n),o=n.__edgeMap,a=o[lXt(r)];o[r]&&!a?o[r].isForward=!0:a&&o[r]&&(a.isForward=!0,o[r].isForward=!1),o[r]=o[r]||[],o[r].push(i)}}(t.node1,t.node2,this,t.dataIndex)}),this),a.data}},e.prototype.getGraph=function(){return this.getData().graph},e.prototype.getEdgeData=function(){return this.getGraph().edgeData},e.prototype.getCategoriesData=function(){return this._categoriesData},e.prototype.formatTooltip=function(t,e,n){if("edge"===n){var i=this.getData(),r=this.getDataParams(t,n),o=i.graph.getEdgeByIndex(t),a=i.getName(o.node1.dataIndex),s=i.getName(o.node2.dataIndex),l=[];return null!=a&&l.push(a),null!=s&&l.push(s),RRt("nameValue",{name:l.join(" > "),value:r.value,noValue:null==r.value})}return GRt({series:this,dataIndex:t,multipleSeries:e})},e.prototype._updateCategoriesData=function(){var t=C_t(this.option.categories||[],(function(t){return null!=t.value?t:v_t({value:0},t)})),e=new GBt(["value"],this);e.initData(t),this._categoriesData=e,this._categoriesModels=e.mapArray((function(t){return e.getItemModel(t)}))},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.isAnimationEnabled=function(){return t.prototype.isAnimationEnabled.call(this)&&!("force"===this.get("layout")&&this.get(["force","layoutAnimation"]))},e.type="series.graph",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"view",legendHoverLink:!0,layout:null,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{show:!1,formatter:"{b}"},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{scale:!0,label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},e}(XRt),eYt={type:"graphRoam",event:"graphRoam",update:"none"};var nYt=function(){this.angle=0,this.width=10,this.r=10,this.x=0,this.y=0},iYt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="pointer",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new nYt},e.prototype.buildPath=function(t,e){var n=Math.cos,i=Math.sin,r=e.r,o=e.width,a=e.angle,s=e.x-n(a)*o*(o>=r/3?1:2),l=e.y-i(a)*o*(o>=r/3?1:2);a=e.angle-Math.PI/2,t.moveTo(s,l),t.lineTo(e.x+n(a)*o,e.y+i(a)*o),t.lineTo(e.x+n(e.angle)*r,e.y+i(e.angle)*r),t.lineTo(e.x-n(a)*o,e.y-i(a)*o),t.lineTo(s,l)},e}(rDt);function rYt(t,e){var n=null==t?"":t+"";return e&&("string"==typeof e?n=e.replace("{value}",n):"function"==typeof e&&(n=e(t))),n}var oYt=2*Math.PI,aYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){this.group.removeAll();var i=t.get(["axisLine","lineStyle","color"]),r=function(t,e){var n=t.get("center"),i=e.getWidth(),r=e.getHeight(),o=Math.min(i,r);return{cx:dAt(n[0],e.getWidth()),cy:dAt(n[1],e.getHeight()),r:dAt(t.get("radius"),o/2)}}(t,n);this._renderMain(t,e,n,i,r),this._data=t.getData()},e.prototype.dispose=function(){},e.prototype._renderMain=function(t,e,n,i,r){for(var o=this.group,a=t.get("clockwise"),s=-t.get("startAngle")/180*Math.PI,l=-t.get("endAngle")/180*Math.PI,u=t.getModel("axisLine"),c=u.get("roundCap")?Jjt:tEt,h=u.get("show"),d=u.getModel("lineStyle"),p=d.get("width"),f=(l-s)%oYt||l===s?(l-s)%oYt:oYt,g=s,m=0;h&&m<i.length;m++){var y=new c({shape:{startAngle:g,endAngle:l=s+f*Math.min(Math.max(i[m][0],0),1),cx:r.cx,cy:r.cy,clockwise:a,r0:r.r-p,r:r.r},silent:!0});y.setStyle({fill:i[m][1]}),y.setStyle(d.getLineStyle(["color","width"])),o.add(y),g=l}var v=function(t){if(t<=0)return i[0][1];var e;for(e=0;e<i.length;e++)if(i[e][0]>=t&&(0===e?0:i[e-1][0])<t)return i[e][1];return i[e-1][1]};if(!a){var x=s;s=l,l=x}this._renderTicks(t,e,n,v,r,s,l,a,p),this._renderTitleAndDetail(t,e,n,v,r),this._renderAnchor(t,r),this._renderPointer(t,e,n,v,r,s,l,a,p)},e.prototype._renderTicks=function(t,e,n,i,r,o,a,s,l){for(var u,c,h=this.group,d=r.cx,p=r.cy,f=r.r,g=+t.get("min"),m=+t.get("max"),y=t.getModel("splitLine"),v=t.getModel("axisTick"),x=t.getModel("axisLabel"),b=t.get("splitNumber"),w=v.get("splitNumber"),_=dAt(y.get("length"),f),k=dAt(v.get("length"),f),S=o,C=(a-o)/b,A=C/w,I=y.getModel("lineStyle").getLineStyle(),M=v.getModel("lineStyle").getLineStyle(),D=y.get("distance"),T=0;T<=b;T++){if(u=Math.cos(S),c=Math.sin(S),y.get("show")){var E=new hEt({shape:{x1:u*(f-(N=D?D+l:l))+d,y1:c*(f-N)+p,x2:u*(f-_-N)+d,y2:c*(f-_-N)+p},style:I,silent:!0});"auto"===I.stroke&&E.setStyle({stroke:i(T/b)}),h.add(E)}if(x.get("show")){var N=x.get("distance")+D,O=rYt(pAt(T/b*(m-g)+g),x.get("formatter")),F=i(T/b);h.add(new xDt({style:hNt(x,{text:O,x:u*(f-_-N)+d,y:c*(f-_-N)+p,verticalAlign:c<-.8?"top":c>.8?"bottom":"middle",align:u<-.4?"left":u>.4?"right":"center"},{inheritColor:F}),silent:!0}))}if(v.get("show")&&T!==b){N=(N=v.get("distance"))?N+l:l;for(var R=0;R<=w;R++){u=Math.cos(S),c=Math.sin(S);var L=new hEt({shape:{x1:u*(f-N)+d,y1:c*(f-N)+p,x2:u*(f-k-N)+d,y2:c*(f-k-N)+p},silent:!0,style:M});"auto"===M.stroke&&L.setStyle({stroke:i((T+R/w)/b)}),h.add(L),S+=A}S-=A}else S+=C}},e.prototype._renderPointer=function(t,e,n,i,r,o,a,s,l){var u=this.group,c=this._data,h=this._progressEls,d=[],p=t.get(["pointer","show"]),f=t.getModel("progress"),g=f.get("show"),m=t.getData(),y=m.mapDimension("value"),v=+t.get("min"),x=+t.get("max"),b=[v,x],w=[o,a];function _(e,n){var i,o=m.getItemModel(e).getModel("pointer"),a=dAt(o.get("width"),r.r),s=dAt(o.get("length"),r.r),l=t.get(["pointer","icon"]),u=o.get("offsetCenter"),c=dAt(u[0],r.r),h=dAt(u[1],r.r),d=o.get("keepAspect");return(i=l?U$t(l,c-a/2,h-s,a,s,null,d):new iYt({shape:{angle:-Math.PI/2,width:a,r:s,x:c,y:h}})).rotation=-(n+Math.PI/2),i.x=r.cx,i.y=r.cy,i}function k(t,e){var n=f.get("roundCap")?Jjt:tEt,i=f.get("overlap"),a=i?f.get("width"):l/m.count(),u=i?r.r-a:r.r-(t+1)*a,c=i?r.r:r.r-t*a,h=new n({shape:{startAngle:o,endAngle:e,cx:r.cx,cy:r.cy,clockwise:s,r0:u,r:c}});return i&&(h.z2=x-m.get(y,t)%x),h}(g||p)&&(m.diff(c).add((function(e){if(p){var n=_(e,o);jEt(n,{rotation:-(hAt(m.get(y,e),b,w,!0)+Math.PI/2)},t),u.add(n),m.setItemGraphicEl(e,n)}if(g){var i=k(e,o),r=f.get("clip");jEt(i,{shape:{endAngle:hAt(m.get(y,e),b,w,r)}},t),u.add(i),d[e]=i}})).update((function(e,n){if(p){var i=c.getItemGraphicEl(n),r=i?i.rotation:o,a=_(e,r);a.rotation=r,WEt(a,{rotation:-(hAt(m.get(y,e),b,w,!0)+Math.PI/2)},t),u.add(a),m.setItemGraphicEl(e,a)}if(g){var s=h[n],l=k(e,s?s.shape.endAngle:o),v=f.get("clip");WEt(l,{shape:{endAngle:hAt(m.get(y,e),b,w,v)}},t),u.add(l),d[e]=l}})).execute(),m.each((function(t){var e=m.getItemModel(t),n=e.getModel("emphasis");if(p){var r=m.getItemGraphicEl(t),o=m.getItemVisual(t,"style"),a=o.fill;if(r instanceof uDt){var s=r.style;r.useStyle(v_t({image:s.image,x:s.x,y:s.y,width:s.width,height:s.height},o))}else r.useStyle(o),"pointer"!==r.type&&r.setColor(a);r.setStyle(e.getModel(["pointer","itemStyle"]).getItemStyle()),"auto"===r.style.fill&&r.setStyle("fill",i(hAt(m.get(y,t),b,[0,1],!0))),r.z2EmphasisLift=0,pTt(r,e),uTt(r,n.get("focus"),n.get("blurScope"))}if(g){var l=d[t];l.useStyle(m.getItemVisual(t,"style")),l.setStyle(e.getModel(["progress","itemStyle"]).getItemStyle()),l.z2EmphasisLift=0,pTt(l,e),uTt(l,n.get("focus"),n.get("blurScope"))}})),this._progressEls=d)},e.prototype._renderAnchor=function(t,e){var n=t.getModel("anchor");if(n.get("show")){var i=n.get("size"),r=n.get("icon"),o=n.get("offsetCenter"),a=n.get("keepAspect"),s=U$t(r,e.cx-i/2+dAt(o[0],e.r),e.cy-i/2+dAt(o[1],e.r),i,i,null,a);s.z2=n.get("showAbove")?1:0,s.setStyle(n.getModel("itemStyle").getItemStyle()),this.group.add(s)}},e.prototype._renderTitleAndDetail=function(t,e,n,i,r){var o=this,a=t.getData(),s=a.mapDimension("value"),l=+t.get("min"),u=+t.get("max"),c=new oAt,h=[],d=[],p=t.isAnimationEnabled();a.diff(this._data).add((function(t){h[t]=new xDt({silent:!0}),d[t]=new xDt({silent:!0})})).update((function(t,e){h[t]=o._titleEls[e],d[t]=o._detailEls[e]})).execute(),a.each((function(e){var n=a.getItemModel(e),o=a.get(s,e),f=new oAt,g=i(hAt(o,[l,u],[0,1],!0)),m=n.getModel("title");if(m.get("show")){var y=m.get("offsetCenter"),v=r.cx+dAt(y[0],r.r),x=r.cy+dAt(y[1],r.r);(I=h[e]).attr({style:hNt(m,{x:v,y:x,text:a.getName(e),align:"center",verticalAlign:"middle"},{inheritColor:g})}),f.add(I)}var b=n.getModel("detail");if(b.get("show")){var w=b.get("offsetCenter"),_=r.cx+dAt(w[0],r.r),k=r.cy+dAt(w[1],r.r),S=dAt(b.get("width"),r.r),C=dAt(b.get("height"),r.r),A=t.get(["progress","show"])?a.getItemVisual(e,"style").fill:g,I=d[e],M=b.get("formatter");I.attr({style:hNt(b,{x:_,y:k,text:rYt(o,M),width:isNaN(S)?null:S,height:isNaN(C)?null:C,align:"center",verticalAlign:"middle"},{inheritColor:A})}),xNt(I,{normal:b},o,(function(t){return rYt(t,M)})),p&&bNt(I,e,a,t,{getFormattedLabel:function(t,e,n,i,r,a){return rYt(a?a.interpolatedValue:o,M)}}),f.add(I)}c.add(f)})),this.group.add(c),this._titleEls=h,this._detailEls=d},e.type="gauge",e}(aLt),sYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.visualStyleAccessPath="itemStyle",n.useColorPaletteOnData=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return SUt(this,["value"])},e.type="series.gauge",e.defaultOption={zlevel:0,z:2,center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,roundCap:!1,lineStyle:{color:[[1,"#E6EBF8"]],width:10}},progress:{show:!1,overlap:!0,width:10,roundCap:!1,clip:!0},splitLine:{show:!0,length:10,distance:10,lineStyle:{color:"#63677A",width:3,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:6,distance:10,lineStyle:{color:"#63677A",width:1,type:"solid"}},axisLabel:{show:!0,distance:15,color:"#464646",fontSize:12},pointer:{icon:null,offsetCenter:[0,0],show:!0,length:"60%",width:6,keepAspect:!1},anchor:{show:!1,showAbove:!1,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:!1,itemStyle:{color:"#fff",borderWidth:0,borderColor:"#5470c6"}},title:{show:!0,offsetCenter:[0,"20%"],color:"#464646",fontSize:16,valueAnimation:!1},detail:{show:!0,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:"#464646",fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:!1}},e}(XRt);var lYt=["itemStyle","opacity"],uYt=function(t){function e(e,n){var i=t.call(this)||this,r=i,o=new lEt,a=new xDt;return r.setTextContent(a),i.setTextGuideLine(o),i.updateData(e,n,!0),i}return Dit(e,t),e.prototype.updateData=function(t,e,n){var i=this,r=t.hostModel,o=t.getItemModel(e),a=t.getItemLayout(e),s=o.getModel("emphasis"),l=o.get(lYt);l=null==l?1:l,i.useStyle(t.getItemVisual(e,"style")),i.style.lineJoin="round",n?(i.setShape({points:a.points}),i.style.opacity=0,jEt(i,{style:{opacity:l}},r,e)):WEt(i,{style:{opacity:l},shape:{points:a.points}},r,e),pTt(i,o),this._updateLabel(t,e),uTt(this,s.get("focus"),s.get("blurScope"))},e.prototype._updateLabel=function(t,e){var n=this,i=this.getTextGuideLine(),r=n.getTextContent(),o=t.hostModel,a=t.getItemModel(e),s=t.getItemLayout(e).label,l=t.getItemVisual(e,"style"),u=l.fill;uNt(r,cNt(a),{labelFetcher:t.hostModel,labelDataIndex:e,defaultOpacity:l.opacity,defaultText:t.getName(e)},{normal:{align:s.textAlign,verticalAlign:s.verticalAlign}}),n.setTextConfig({local:!0,inside:!!s.inside,insideStroke:u,outsideFill:u});var c=s.linePoints;i.setShape({points:c}),n.textGuideLineConfig={anchor:c?new DCt(c[0][0],c[0][1]):null},WEt(r,{style:{x:s.x,y:s.y}},o,e),r.attr({rotation:s.rotation,originX:s.x,originY:s.y,z2:10}),v$t(n,x$t(a),{stroke:u})},e}(aEt),cYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.ignoreLabelLineUpdate=!0,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.getData(),r=this._data,o=this.group;i.diff(r).add((function(t){var e=new uYt(i,t);i.setItemGraphicEl(t,e),o.add(e)})).update((function(t,e){var n=r.getItemGraphicEl(e);n.updateData(i,t),o.add(n),i.setItemGraphicEl(t,n)})).remove((function(e){HEt(r.getItemGraphicEl(e),t,e)})).execute(),this._data=i},e.prototype.remove=function(){this.group.removeAll(),this._data=null},e.prototype.dispose=function(){},e.type="funnel",e}(aLt),hYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.useColorPaletteOnData=!0,n}return Dit(e,t),e.prototype.init=function(e){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new CUt(D_t(this.getData,this),D_t(this.getRawData,this)),this._defaultLabelLine(e)},e.prototype.getInitialData=function(t,e){return SUt(this,{coordDimensions:["value"],encodeDefaulter:T_t(UOt,this)})},e.prototype._defaultLabelLine=function(t){OAt(t,"labelLine",["show"]);var e=t.labelLine,n=t.emphasis.labelLine;e.show=e.show&&t.label.show,n.show=n.show&&t.emphasis.label.show},e.prototype.getDataParams=function(e){var n=this.getData(),i=t.prototype.getDataParams.call(this,e),r=n.mapDimension("value"),o=n.getSum(r);return i.percent=o?+(n.get(r,e)/o*100).toFixed(2):0,i.$vars.push("percent"),i},e.type="series.funnel",e.defaultOption={zlevel:0,z:2,legendHoverLink:!0,left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},e}(XRt);function dYt(t,e){t.eachSeriesByType("funnel",(function(t){var n=t.getData(),i=n.mapDimension("value"),r=t.get("sort"),o=function(t,e){return IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,e),a=t.get("orient"),s=o.width,l=o.height,u=function(t,e){for(var n=t.mapDimension("value"),i=t.mapArray(n,(function(t){return t})),r=[],o="ascending"===e,a=0,s=t.count();a<s;a++)r[a]=a;return"function"==typeof e?r.sort(e):"none"!==e&&r.sort((function(t,e){return o?i[t]-i[e]:i[e]-i[t]})),r}(n,r),c=o.x,h=o.y,d="horizontal"===a?[dAt(t.get("minSize"),l),dAt(t.get("maxSize"),l)]:[dAt(t.get("minSize"),s),dAt(t.get("maxSize"),s)],p=n.getDataExtent(i),f=t.get("min"),g=t.get("max");null==f&&(f=Math.min(p[0],0)),null==g&&(g=p[1]);var m=t.get("funnelAlign"),y=t.get("gap"),v=(("horizontal"===a?s:l)-y*(n.count()-1))/n.count(),x=function(t,e){if("horizontal"===a){var r=hAt(n.get(i,t)||0,[f,g],d,!0),o=void 0;switch(m){case"top":o=h;break;case"center":o=h+(l-r)/2;break;case"bottom":o=h+(l-r)}return[[e,o],[e,o+r]]}var u,p=hAt(n.get(i,t)||0,[f,g],d,!0);switch(m){case"left":u=c;break;case"center":u=c+(s-p)/2;break;case"right":u=c+s-p}return[[u,e],[u+p,e]]};"ascending"===r&&(v=-v,y=-y,"horizontal"===a?c+=s:h+=l,u=u.reverse());for(var b=0;b<u.length;b++){var w=u[b],_=u[b+1],k=n.getItemModel(w);if("horizontal"===a){var S=k.get(["itemStyle","width"]);null==S?S=v:(S=dAt(S,s),"ascending"===r&&(S=-S));var C=x(w,c),A=x(_,c+S);c+=S+y,n.setItemLayout(w,{points:C.concat(A.slice().reverse())})}else{var I=k.get(["itemStyle","height"]);null==I?I=v:(I=dAt(I,l),"ascending"===r&&(I=-I));C=x(w,h),A=x(_,h+I);h+=I+y,n.setItemLayout(w,{points:C.concat(A.slice().reverse())})}}!function(t){var e=t.hostModel.get("orient");t.each((function(n){var i,r,o,a,s=t.getItemModel(n),l=s.getModel("label").get("position"),u=s.getModel("labelLine"),c=t.getItemLayout(n),h=c.points,d="inner"===l||"inside"===l||"center"===l||"insideLeft"===l||"insideRight"===l;if(d)"insideLeft"===l?(r=(h[0][0]+h[3][0])/2+5,o=(h[0][1]+h[3][1])/2,i="left"):"insideRight"===l?(r=(h[1][0]+h[2][0])/2-5,o=(h[1][1]+h[2][1])/2,i="right"):(r=(h[0][0]+h[1][0]+h[2][0]+h[3][0])/4,o=(h[0][1]+h[1][1]+h[2][1]+h[3][1])/4,i="center"),a=[[r,o],[r,o]];else{var p=void 0,f=void 0,g=void 0,m=void 0,y=u.get("length");"left"===l?(p=(h[3][0]+h[0][0])/2,f=(h[3][1]+h[0][1])/2,r=(g=p-y)-5,i="right"):"right"===l?(p=(h[1][0]+h[2][0])/2,f=(h[1][1]+h[2][1])/2,r=(g=p+y)+5,i="left"):"top"===l?(p=(h[3][0]+h[0][0])/2,o=(m=(f=(h[3][1]+h[0][1])/2)-y)-5,i="center"):"bottom"===l?(p=(h[1][0]+h[2][0])/2,o=(m=(f=(h[1][1]+h[2][1])/2)+y)+5,i="center"):"rightTop"===l?(p="horizontal"===e?h[3][0]:h[1][0],f="horizontal"===e?h[3][1]:h[1][1],"horizontal"===e?(o=(m=f-y)-5,i="center"):(r=(g=p+y)+5,i="top")):"rightBottom"===l?(p=h[2][0],f=h[2][1],"horizontal"===e?(o=(m=f+y)+5,i="center"):(r=(g=p+y)+5,i="bottom")):"leftTop"===l?(p=h[0][0],f="horizontal"===e?h[0][1]:h[1][1],"horizontal"===e?(o=(m=f-y)-5,i="center"):(r=(g=p-y)-5,i="right")):"leftBottom"===l?(p="horizontal"===e?h[1][0]:h[3][0],f="horizontal"===e?h[1][1]:h[2][1],"horizontal"===e?(o=(m=f+y)+5,i="center"):(r=(g=p-y)-5,i="right")):(p=(h[1][0]+h[2][0])/2,f=(h[1][1]+h[2][1])/2,"horizontal"===e?(o=(m=f+y)+5,i="center"):(r=(g=p+y)+5,i="left")),"horizontal"===e?r=g=p:o=m=f,a=[[p,f],[g,m]]}c.label={linePoints:a,x:r,y:o,verticalAlign:"middle",textAlign:i,inside:d}}))}(n)}))}var pYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._dataGroup=new oAt,n._initialized=!1,n}return Dit(e,t),e.prototype.init=function(){this.group.add(this._dataGroup)},e.prototype.render=function(t,e,n,i){var r=this._dataGroup,o=t.getData(),a=this._data,s=t.coordinateSystem,l=s.dimensions,u=mYt(t);if(o.diff(a).add((function(t){yYt(gYt(o,r,t,l,s),o,t,u)})).update((function(e,n){var i=a.getItemGraphicEl(n),r=fYt(o,e,l,s);o.setItemGraphicEl(e,i),WEt(i,{shape:{points:r}},t,e),yYt(i,o,e,u)})).remove((function(t){var e=a.getItemGraphicEl(t);r.remove(e)})).execute(),!this._initialized){this._initialized=!0;var c=function(t,e,n){var i=t.model,r=t.getRect(),o=new mDt({shape:{x:r.x,y:r.y,width:r.width,height:r.height}}),a="horizontal"===i.get("layout")?"width":"height";return o.setShape(a,0),jEt(o,{shape:{width:r.width,height:r.height}},e,n),o}(s,t,(function(){setTimeout((function(){r.removeClipPath()}))}));r.setClipPath(c)}this._data=o},e.prototype.incrementalPrepareRender=function(t,e,n){this._initialized=!0,this._data=null,this._dataGroup.removeAll()},e.prototype.incrementalRender=function(t,e,n){for(var i=e.getData(),r=e.coordinateSystem,o=r.dimensions,a=mYt(e),s=t.start;s<t.end;s++){var l=gYt(i,this._dataGroup,s,o,r);l.incremental=!0,yYt(l,i,s,a)}},e.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null},e.type="parallel",e}(aLt);function fYt(t,e,n,i){for(var r,o=[],a=0;a<n.length;a++){var s=n[a],l=t.get(t.mapDimension(s),e);r=l,("category"===i.getAxis(s).type?null==r:null==r||isNaN(r))||o.push(i.dataToPoint(l,s))}return o}function gYt(t,e,n,i,r){var o=fYt(t,n,i,r),a=new lEt({shape:{points:o},z2:10});return e.add(a),t.setItemGraphicEl(n,a),a}function mYt(t){var e=t.get("smooth",!0);return!0===e&&(e=.3),B_t(e=AAt(e))&&(e=0),{smooth:e}}function yYt(t,e,n,i){t.useStyle(e.getItemVisual(n,"style")),t.style.fill=null,t.setShape("smooth",i.smooth);var r=e.getItemModel(n),o=r.getModel("emphasis");pTt(t,r,"lineStyle"),uTt(t,o.get("focus"),o.get("blurScope"))}var vYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.visualStyleAccessPath="lineStyle",n.visualDrawType="stroke",n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this,{useEncodeDefaulter:D_t(xYt,null,this)})},e.prototype.getRawIndicesByActiveState=function(t){var e=this.coordinateSystem,n=this.getData(),i=[];return e.eachActiveState(n,(function(e,r){t===e&&i.push(n.getRawIndex(r))})),i},e.type="series.parallel",e.dependencies=["parallel"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:!1},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:!1}},progressive:500,smooth:!1,animationEasing:"linear"},e}(XRt);function xYt(t){var e=t.ecModel.getComponent("parallel",t.get("parallelIndex"));if(e){var n={};return S_t(e.dimensions,(function(t){var e=+t.replace("dim","");n[t]=e})),n}}var bYt=["lineStyle","opacity"],wYt={seriesType:"parallel",reset:function(t,e){var n=t.coordinateSystem,i={normal:t.get(["lineStyle","opacity"]),active:t.get("activeOpacity"),inactive:t.get("inactiveOpacity")};return{progress:function(t,e){n.eachActiveState(e,(function(t,n){var r=i[t];if("normal"===t&&e.hasItemOption){var o=e.getItemModel(n).get(bYt,!0);null!=o&&(r=o)}e.ensureUniqueItemVisual(n,"style").opacity=r}),t.start,t.end)}}}};function _Yt(t){!function(t){if(t.parallel)return;var e=!1;S_t(t.series,(function(t){t&&"parallel"===t.type&&(e=!0)})),e&&(t.parallel=[{}])}(t),function(t){S_t(NAt(t.parallelAxis),(function(e){if(L_t(e)){var n=e.parallelIndex||0,i=NAt(t.parallel)[n];i&&i.parallelAxisDefault&&m_t(e,i.parallelAxisDefault,!1)}}))}(t)}var kYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){this._model=t,this._api=n,this._handlers||(this._handlers={},S_t(SYt,(function(t,e){n.getZr().on(e,this._handlers[e]=D_t(t,this))}),this)),gLt(this,"_throttledDispatchExpand",t.get("axisExpandRate"),"fixRate")},e.prototype.dispose=function(t,e){S_t(this._handlers,(function(t,n){e.getZr().off(n,t)})),this._handlers=null},e.prototype._throttledDispatchExpand=function(t){this._dispatchExpand(t)},e.prototype._dispatchExpand=function(t){t&&this._api.dispatchAction(v_t({type:"parallelAxisExpand"},t))},e.type="parallel",e}(nLt),SYt={mousedown:function(t){CYt(this,"click")&&(this._mouseDownPoint=[t.offsetX,t.offsetY])},mouseup:function(t){var e=this._mouseDownPoint;if(CYt(this,"click")&&e){var n=[t.offsetX,t.offsetY];if(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>5)return;var i=this._model.coordinateSystem.getSlidedAxisExpandWindow([t.offsetX,t.offsetY]);"none"!==i.behavior&&this._dispatchExpand({axisExpandWindow:i.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(t){if(!this._mouseDownPoint&&CYt(this,"mousemove")){var e=this._model,n=e.coordinateSystem.getSlidedAxisExpandWindow([t.offsetX,t.offsetY]),i=n.behavior;"jump"===i&&this._throttledDispatchExpand.debounceNextCall(e.get("axisExpandDebounce")),this._throttledDispatchExpand("none"===i?null:{axisExpandWindow:n.axisExpandWindow,animation:"jump"===i?null:{duration:0}})}}};function CYt(t,e){var n=t._model;return n.get("axisExpandable")&&n.get("axisExpandTriggerOn")===e}var AYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(){t.prototype.init.apply(this,arguments),this.mergeOption({})},e.prototype.mergeOption=function(t){var e=this.option;t&&m_t(e,t,!0),this._initDimensions()},e.prototype.contains=function(t,e){var n=t.get("parallelIndex");return null!=n&&e.getComponent("parallel",n)===this},e.prototype.setAxisExpand=function(t){S_t(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],(function(e){t.hasOwnProperty(e)&&(this.option[e]=t[e])}),this)},e.prototype._initDimensions=function(){var t=this.dimensions=[],e=this.parallelAxisIndex=[];S_t(I_t(this.ecModel.queryComponents({mainType:"parallelAxis"}),(function(t){return(t.get("parallelIndex")||0)===this.componentIndex}),this),(function(n){t.push("dim"+n.get("dim")),e.push(n.componentIndex)}))},e.type="parallel",e.dependencies=["parallelAxis"],e.layoutMode="box",e.defaultOption={zlevel:0,z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},e}(FOt),IYt=function(t){function e(e,n,i,r,o){var a=t.call(this,e,n,i)||this;return a.type=r||"value",a.axisIndex=o,a}return Dit(e,t),e.prototype.isHorizontal=function(){return"horizontal"!==this.coordinateSystem.getModel().get("layout")},e}(fWt);function MYt(t,e,n,i,r,o){t=t||0;var a=n[1]-n[0];if(null!=r&&(r=TYt(r,[0,a])),null!=o&&(o=Math.max(o,null!=r?r:0)),"all"===i){var s=Math.abs(e[1]-e[0]);s=TYt(s,[0,a]),r=o=TYt(s,[r,o]),i=0}e[0]=TYt(e[0],n),e[1]=TYt(e[1],n);var l=DYt(e,i);e[i]+=t;var u,c=r||0,h=n.slice();return l.sign<0?h[0]+=c:h[1]-=c,e[i]=TYt(e[i],h),u=DYt(e,i),null!=r&&(u.sign!==l.sign||u.span<r)&&(e[1-i]=e[i]+l.sign*r),u=DYt(e,i),null!=o&&u.span>o&&(e[1-i]=e[i]+u.sign*o),e}function DYt(t,e){var n=t[e]-t[1-e];return{span:Math.abs(n),sign:n>0?-1:n<0?1:e?-1:1}}function TYt(t,e){return Math.min(null!=e[1]?e[1]:1/0,Math.max(null!=e[0]?e[0]:-1/0,t))}var EYt=S_t,NYt=Math.min,OYt=Math.max,FYt=Math.floor,RYt=Math.ceil,LYt=pAt,$Yt=Math.PI,PYt=function(){function t(t,e,n){this.type="parallel",this._axesMap=Z_t(),this._axesLayout={},this.dimensions=t.dimensions,this._model=t,this._init(t,e,n)}return t.prototype._init=function(t,e,n){var i=t.dimensions,r=t.parallelAxisIndex;EYt(i,(function(t,n){var i=r[n],o=e.getComponent("parallelAxis",i),a=this._axesMap.set(t,new IYt(t,ZVt(o),[0,0],o.get("type"),i)),s="category"===a.type;a.onBand=s&&o.get("boundaryGap"),a.inverse=o.get("inverse"),o.axis=a,a.model=o,a.coordinateSystem=o.coordinateSystem=this}),this)},t.prototype.update=function(t,e){this._updateAxesFromSeries(this._model,t)},t.prototype.containPoint=function(t){var e=this._makeLayoutInfo(),n=e.axisBase,i=e.layoutBase,r=e.pixelDimIndex,o=t[1-r],a=t[r];return o>=n&&o<=n+e.axisLength&&a>=i&&a<=i+e.layoutLength},t.prototype.getModel=function(){return this._model},t.prototype._updateAxesFromSeries=function(t,e){e.eachSeries((function(n){if(t.contains(n,e)){var i=n.getData();EYt(this.dimensions,(function(t){var e=this._axesMap.get(t);e.scale.unionExtentFromData(i,i.mapDimension(t)),KVt(e.scale,e.model)}),this)}}),this)},t.prototype.resize=function(t,e){this._rect=IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()}),this._layoutAxes()},t.prototype.getRect=function(){return this._rect},t.prototype._makeLayoutInfo=function(){var t,e=this._model,n=this._rect,i=["x","y"],r=["width","height"],o=e.get("layout"),a="horizontal"===o?0:1,s=n[r[a]],l=[0,s],u=this.dimensions.length,c=zYt(e.get("axisExpandWidth"),l),h=zYt(e.get("axisExpandCount")||0,[0,u]),d=e.get("axisExpandable")&&u>3&&u>h&&h>1&&c>0&&s>0,p=e.get("axisExpandWindow");p?(t=zYt(p[1]-p[0],l),p[1]=p[0]+t):(t=zYt(c*(h-1),l),(p=[c*(e.get("axisExpandCenter")||FYt(u/2))-t/2])[1]=p[0]+t);var f=(s-t)/(u-h);f<3&&(f=0);var g=[FYt(LYt(p[0]/c,1))+1,RYt(LYt(p[1]/c,1))-1],m=f/c*p[0];return{layout:o,pixelDimIndex:a,layoutBase:n[i[a]],layoutLength:s,axisBase:n[i[1-a]],axisLength:n[r[1-a]],axisExpandable:d,axisExpandWidth:c,axisCollapseWidth:f,axisExpandWindow:p,axisCount:u,winInnerIndices:g,axisExpandWindow0Pos:m}},t.prototype._layoutAxes=function(){var t=this._rect,e=this._axesMap,n=this.dimensions,i=this._makeLayoutInfo(),r=i.layout;e.each((function(t){var e=[0,i.axisLength],n=t.inverse?1:0;t.setExtent(e[n],e[1-n])})),EYt(n,(function(e,n){var o=(i.axisExpandable?VYt:BYt)(n,i),a={horizontal:{x:o.position,y:i.axisLength},vertical:{x:0,y:o.position}},s={horizontal:$Yt/2,vertical:0},l=[a[r].x+t.x,a[r].y+t.y],u=s[r],c=[1,0,0,1,0,0];yCt(c,c,u),mCt(c,c,l),this._axesLayout[e]={position:l,rotation:u,transform:c,axisNameAvailableWidth:o.axisNameAvailableWidth,axisLabelShow:o.axisLabelShow,nameTruncateMaxWidth:o.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}}),this)},t.prototype.getAxis=function(t){return this._axesMap.get(t)},t.prototype.dataToPoint=function(t,e){return this.axisCoordToPoint(this._axesMap.get(e).dataToCoord(t),e)},t.prototype.eachActiveState=function(t,e,n,i){null==n&&(n=0),null==i&&(i=t.count());var r=this._axesMap,o=this.dimensions,a=[],s=[];S_t(o,(function(e){a.push(t.mapDimension(e)),s.push(r.get(e).model)}));for(var l=this.hasAxisBrushed(),u=n;u<i;u++){var c=void 0;if(l){c="active";for(var h=t.getValues(a,u),d=0,p=o.length;d<p;d++){if("inactive"===s[d].getActiveState(h[d])){c="inactive";break}}}else c="normal";e(c,u)}},t.prototype.hasAxisBrushed=function(){for(var t=this.dimensions,e=this._axesMap,n=!1,i=0,r=t.length;i<r;i++)"normal"!==e.get(t[i]).model.getActiveState()&&(n=!0);return n},t.prototype.axisCoordToPoint=function(t,e){return YEt([t,0],this._axesLayout[e].transform)},t.prototype.getAxisLayout=function(t){return g_t(this._axesLayout[t])},t.prototype.getSlidedAxisExpandWindow=function(t){var e=this._makeLayoutInfo(),n=e.pixelDimIndex,i=e.axisExpandWindow.slice(),r=i[1]-i[0],o=[0,e.axisExpandWidth*(e.axisCount-1)];if(!this.containPoint(t))return{behavior:"none",axisExpandWindow:i};var a,s=t[n]-e.layoutBase-e.axisExpandWindow0Pos,l="slide",u=e.axisCollapseWidth,c=this._model.get("axisExpandSlideTriggerArea"),h=null!=c[0];if(u)h&&u&&s<r*c[0]?(l="jump",a=s-r*c[2]):h&&u&&s>r*(1-c[0])?(l="jump",a=s-r*(1-c[2])):(a=s-r*c[1])>=0&&(a=s-r*(1-c[1]))<=0&&(a=0),(a*=e.axisExpandWidth/u)?MYt(a,i,o,"all"):l="none";else{var d=i[1]-i[0];(i=[OYt(0,o[1]*s/d-d/2)])[1]=NYt(o[1],i[0]+d),i[0]=i[1]-d}return{axisExpandWindow:i,behavior:l}},t}();function zYt(t,e){return NYt(OYt(t,e[0]),e[1])}function BYt(t,e){var n=e.layoutLength/(e.axisCount-1);return{position:n*t,axisNameAvailableWidth:n,axisLabelShow:!0}}function VYt(t,e){var n,i,r=e.layoutLength,o=e.axisExpandWidth,a=e.axisCount,s=e.axisCollapseWidth,l=e.winInnerIndices,u=s,c=!1;return t<l[0]?(n=t*s,i=s):t<=l[1]?(n=e.axisExpandWindow0Pos+t*o-e.axisExpandWindow[0],u=o,c=!0):(n=r-(a-1-t)*s,i=s),{position:n,axisNameAvailableWidth:u,axisLabelShow:c,nameTruncateMaxWidth:i}}var WYt={create:function(t,e){var n=[];return t.eachComponent("parallel",(function(i,r){var o=new PYt(i,t,e);o.name="parallel_"+r,o.resize(i,e),i.coordinateSystem=o,o.model=i,n.push(o)})),t.eachSeries((function(t){if("parallel"===t.get("coordinateSystem")){var e=t.getReferringComponents("parallel",qAt).models[0];t.coordinateSystem=e.coordinateSystem}})),n}},jYt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.activeIntervals=[],n}return Dit(e,t),e.prototype.getAreaSelectStyle=function(){return lIt([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},e.prototype.setActiveIntervals=function(t){var e=this.activeIntervals=g_t(t);if(e)for(var n=e.length-1;n>=0;n--)fAt(e[n])},e.prototype.getActiveState=function(t){var e=this.activeIntervals;if(!e.length)return"normal";if(null==t||isNaN(+t))return"inactive";if(1===e.length){var n=e[0];if(n[0]<=t&&t<=n[1])return"active"}else for(var i=0,r=e.length;i<r;i++)if(e[i][0]<=t&&t<=e[i][1])return"active";return"inactive"},e}(FOt);__t(jYt,iWt);var UYt=Math.min,GYt=Math.max,HYt=Math.pow,qYt={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},XYt={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},YYt={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},KYt=0,ZYt=function(t){function e(e){var n=t.call(this)||this;return n._track=[],n._covers=[],n._handlers={},n._zr=e,n.group=new oAt,n._uid="brushController_"+KYt++,S_t(SKt,(function(t,e){this._handlers[e]=D_t(t,this)}),n),n}return Dit(e,t),e.prototype.enableBrush=function(t){return this._brushType&&this._doDisableBrush(),t.brushType&&this._doEnableBrush(t),this},e.prototype._doEnableBrush=function(t){var e=this._zr;this._enableGlobalPan||function(t,e,n){WGt(t)[e]=n}(e,"globalPan",this._uid),S_t(this._handlers,(function(t,n){e.on(n,t)})),this._brushType=t.brushType,this._brushOption=m_t(g_t(YYt),t,!0)},e.prototype._doDisableBrush=function(){var t=this._zr;!function(t,e,n){var i=WGt(t);i[e]===n&&(i[e]=null)}(t,"globalPan",this._uid),S_t(this._handlers,(function(e,n){t.off(n,e)})),this._brushType=this._brushOption=null},e.prototype.setPanels=function(t){if(t&&t.length){var e=this._panels={};S_t(t,(function(t){e[t.panelId]=g_t(t)}))}else this._panels=null;return this},e.prototype.mount=function(t){t=t||{},this._enableGlobalPan=t.enableGlobalPan;var e=this.group;return this._zr.add(e),e.attr({x:t.x||0,y:t.y||0,rotation:t.rotation||0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}),this._transform=e.getLocalTransform(),this},e.prototype.updateCovers=function(t){t=C_t(t,(function(t){return m_t(g_t(YYt),t,!0)}));var e=this._covers,n=this._covers=[],i=this,r=this._creatingCover;return new vBt(e,t,(function(t,e){return o(t.__brushOption,e)}),o).add(a).update(a).remove((function(t){e[t]!==r&&i.group.remove(e[t])})).execute(),this;function o(t,e){return(null!=t.id?t.id:"\0-brush-index-"+e)+"-"+t.brushType}function a(o,a){var s=t[o];if(null!=a&&e[a]===r)n[o]=e[a];else{var l=n[o]=null!=a?(e[a].__brushOption=s,e[a]):QYt(i,JYt(i,s));nKt(i,l)}}},e.prototype.unmount=function(){return this.enableBrush(!1),aKt(this),this._zr.remove(this.group),this},e.prototype.dispose=function(){this.unmount(),this.off()},e}(bkt);function JYt(t,e){var n=AKt[e.brushType].createCover(t,e);return n.__brushOption=e,eKt(n,e),t.group.add(n),n}function QYt(t,e){var n=iKt(e);return n.endCreating&&(n.endCreating(t,e),eKt(e,e.__brushOption)),e}function tKt(t,e){var n=e.__brushOption;iKt(e).updateCoverShape(t,e,n.range,n)}function eKt(t,e){var n=e.z;null==n&&(n=1e4),t.traverse((function(t){t.z=n,t.z2=n}))}function nKt(t,e){iKt(e).updateCommon(t,e),tKt(t,e)}function iKt(t){return AKt[t.__brushOption.brushType]}function rKt(t,e,n){var i,r=t._panels;if(!r)return true;var o=t._transform;return S_t(r,(function(t){t.isTargetByCursor(e,n,o)&&(i=t)})),i}function oKt(t,e){var n=t._panels;if(!n)return true;var i=e.__brushOption.panelId;return null==i||n[i]}function aKt(t){var e=t._covers,n=e.length;return S_t(e,(function(e){t.group.remove(e)}),t),e.length=0,!!n}function sKt(t,e){var n=C_t(t._covers,(function(t){var e=t.__brushOption,n=g_t(e.range);return{brushType:e.brushType,panelId:e.panelId,range:n}}));t.trigger("brush",{areas:n,isEnd:!!e.isEnd,removeOnClick:!!e.removeOnClick})}function lKt(t){var e=t.length-1;return e<0&&(e=0),[t[0],t[e]]}function uKt(t,e,n,i){var r=new oAt;return r.add(new mDt({name:"main",style:pKt(n),silent:!0,draggable:!0,cursor:"move",drift:T_t(mKt,t,e,r,["n","s","w","e"]),ondragend:T_t(sKt,e,{isEnd:!0})})),S_t(i,(function(n){r.add(new mDt({name:n.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:T_t(mKt,t,e,r,n),ondragend:T_t(sKt,e,{isEnd:!0})}))})),r}function cKt(t,e,n,i){var r=i.brushStyle.lineWidth||0,o=GYt(r,6),a=n[0][0],s=n[1][0],l=a-r/2,u=s-r/2,c=n[0][1],h=n[1][1],d=c-o+r/2,p=h-o+r/2,f=c-a,g=h-s,m=f+r,y=g+r;dKt(t,e,"main",a,s,f,g),i.transformable&&(dKt(t,e,"w",l,u,o,y),dKt(t,e,"e",d,u,o,y),dKt(t,e,"n",l,u,m,o),dKt(t,e,"s",l,p,m,o),dKt(t,e,"nw",l,u,o,o),dKt(t,e,"ne",d,u,o,o),dKt(t,e,"sw",l,p,o,o),dKt(t,e,"se",d,p,o,o))}function hKt(t,e){var n=e.__brushOption,i=n.transformable,r=e.childAt(0);r.useStyle(pKt(n)),r.attr({silent:!i,cursor:i?"move":"default"}),S_t([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],(function(n){var r=e.childOfName(n.join("")),o=1===n.length?gKt(t,n[0]):function(t,e){var n=[gKt(t,e[0]),gKt(t,e[1])];return("e"===n[0]||"w"===n[0])&&n.reverse(),n.join("")}(t,n);r&&r.attr({silent:!i,invisible:!i,cursor:i?XYt[o]+"-resize":null})}))}function dKt(t,e,n,i,r,o,a){var s,l,u,c,h,d=e.childOfName(n);d&&d.setShape((s=xKt(t,e,[[i,r],[i+o,r+a]]),l=UYt(s[0][0],s[1][0]),u=UYt(s[0][1],s[1][1]),c=GYt(s[0][0],s[1][0]),h=GYt(s[0][1],s[1][1]),{x:l,y:u,width:c-l,height:h-u}))}function pKt(t){return x_t({strokeNoScale:!0},t.brushStyle)}function fKt(t,e,n,i){var r=[UYt(t,n),UYt(e,i)],o=[GYt(t,n),GYt(e,i)];return[[r[0],o[0]],[r[1],o[1]]]}function gKt(t,e){return{left:"w",right:"e",top:"n",bottom:"s"}[KEt({w:"left",e:"right",n:"top",s:"bottom"}[e],function(t){return XEt(t.group)}(t))]}function mKt(t,e,n,i,r,o){var a=n.__brushOption,s=t.toRectRange(a.range),l=vKt(e,r,o);S_t(i,(function(t){var e=qYt[t];s[e[0]][e[1]]+=l[e[0]]})),a.range=t.fromRectRange(fKt(s[0][0],s[1][0],s[0][1],s[1][1])),nKt(e,n),sKt(e,{isEnd:!1})}function yKt(t,e,n,i){var r=e.__brushOption.range,o=vKt(t,n,i);S_t(r,(function(t){t[0]+=o[0],t[1]+=o[1]})),nKt(t,e),sKt(t,{isEnd:!1})}function vKt(t,e,n){var i=t.group,r=i.transformCoordToLocal(e,n),o=i.transformCoordToLocal(0,0);return[r[0]-o[0],r[1]-o[1]]}function xKt(t,e,n){var i=oKt(t,e);return i&&true!==i?i.clipPath(n,t._transform):g_t(n)}function bKt(t){var e=t.event;e.preventDefault&&e.preventDefault()}function wKt(t,e,n){return t.childOfName("main").contain(e,n)}function _Kt(t,e,n,i){var r,o=t._creatingCover,a=t._creatingPanel,s=t._brushOption;if(t._track.push(n.slice()),function(t){var e=t._track;if(!e.length)return!1;var n=e[e.length-1],i=e[0],r=n[0]-i[0],o=n[1]-i[1];return HYt(r*r+o*o,.5)>6}(t)||o){if(a&&!o){"single"===s.brushMode&&aKt(t);var l=g_t(s);l.brushType=kKt(l.brushType,a),l.panelId=true===a?null:a.panelId,o=t._creatingCover=JYt(t,l),t._covers.push(o)}if(o){var u=AKt[kKt(t._brushType,a)];o.__brushOption.range=u.getCreatingRange(xKt(t,o,t._track)),i&&(QYt(t,o),u.updateCommon(t,o)),tKt(t,o),r={isEnd:i}}}else i&&"single"===s.brushMode&&s.removeOnClick&&rKt(t,e,n)&&aKt(t)&&(r={isEnd:i,removeOnClick:!0});return r}function kKt(t,e){return"auto"===t?e.defaultBrushType:t}var SKt={mousedown:function(t){if(this._dragging)CKt(this,t);else if(!t.target||!t.target.draggable){bKt(t);var e=this.group.transformCoordToLocal(t.offsetX,t.offsetY);this._creatingCover=null,(this._creatingPanel=rKt(this,t,e))&&(this._dragging=!0,this._track=[e.slice()])}},mousemove:function(t){var e=t.offsetX,n=t.offsetY,i=this.group.transformCoordToLocal(e,n);if(function(t,e,n){if(t._brushType&&!function(t,e,n){var i=t._zr;return e<0||e>i.getWidth()||n<0||n>i.getHeight()}(t,e.offsetX,e.offsetY)){var i=t._zr,r=t._covers,o=rKt(t,e,n);if(!t._dragging)for(var a=0;a<r.length;a++){var s=r[a].__brushOption;if(o&&(!0===o||s.panelId===o.panelId)&&AKt[s.brushType].contain(r[a],n[0],n[1]))return}o&&i.setCursorStyle("crosshair")}}(this,t,i),this._dragging){bKt(t);var r=_Kt(this,t,i,!1);r&&sKt(this,r)}},mouseup:function(t){CKt(this,t)}};function CKt(t,e){if(t._dragging){bKt(e);var n=e.offsetX,i=e.offsetY,r=t.group.transformCoordToLocal(n,i),o=_Kt(t,e,r,!0);t._dragging=!1,t._track=[],t._creatingCover=null,o&&sKt(t,o)}}var AKt={lineX:IKt(0),lineY:IKt(1),rect:{createCover:function(t,e){function n(t){return t}return uKt({toRectRange:n,fromRectRange:n},t,e,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(t){var e=lKt(t);return fKt(e[1][0],e[1][1],e[0][0],e[0][1])},updateCoverShape:function(t,e,n,i){cKt(t,e,n,i)},updateCommon:hKt,contain:wKt},polygon:{createCover:function(t,e){var n=new oAt;return n.add(new lEt({name:"main",style:pKt(e),silent:!0})),n},getCreatingRange:function(t){return t},endCreating:function(t,e){e.remove(e.childAt(0)),e.add(new aEt({name:"main",draggable:!0,drift:T_t(yKt,t,e),ondragend:T_t(sKt,t,{isEnd:!0})}))},updateCoverShape:function(t,e,n,i){e.childAt(0).setShape({points:xKt(t,e,n)})},updateCommon:hKt,contain:wKt}};function IKt(t){return{createCover:function(e,n){return uKt({toRectRange:function(e){var n=[e,[0,100]];return t&&n.reverse(),n},fromRectRange:function(e){return e[t]}},e,n,[[["w"],["e"]],[["n"],["s"]]][t])},getCreatingRange:function(e){var n=lKt(e);return[UYt(n[0][t],n[1][t]),GYt(n[0][t],n[1][t])]},updateCoverShape:function(e,n,i,r){var o,a=oKt(e,n);if(true!==a&&a.getLinearBrushOtherExtent)o=a.getLinearBrushOtherExtent(t);else{var s=e._zr;o=[0,[s.getWidth(),s.getHeight()][1-t]]}var l=[i,o];t&&l.reverse(),cKt(e,n,l,r)},updateCommon:hKt,contain:wKt}}function MKt(t){return t=EKt(t),function(e){return QEt(e,t)}}function DKt(t,e){return t=EKt(t),function(n){var i=null!=e?e:n,r=i?t.width:t.height,o=i?t.x:t.y;return[o,o+(r||0)]}}function TKt(t,e,n){var i=EKt(t);return function(t,r){return i.contain(r[0],r[1])&&!KGt(t,e,n)}}function EKt(t){return PCt.create(t)}var NKt=["axisLine","axisTickLabel","axisName"],OKt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(e,n){t.prototype.init.apply(this,arguments),(this._brushController=new ZYt(n.getZr())).on("brush",D_t(this._onBrush,this))},e.prototype.render=function(t,e,n,i){if(!function(t,e,n){return n&&"axisAreaSelect"===n.type&&e.findComponents({mainType:"parallelAxis",query:n})[0]===t}(t,e,i)){this.axisModel=t,this.api=n,this.group.removeAll();var r=this._axisGroup;if(this._axisGroup=new oAt,this.group.add(this._axisGroup),t.get("show")){var o=function(t,e){return e.getComponent("parallel",t.get("parallelIndex"))}(t,e),a=o.coordinateSystem,s=t.getAreaSelectStyle(),l=s.width,u=t.axis.dim,c=v_t({strokeContainThreshold:l},a.getAxisLayout(u)),h=new tGt(t,c);S_t(NKt,h.add,h),this._axisGroup.add(h.getGroup()),this._refreshBrushController(c,s,t,o,l,n),JEt(r,this._axisGroup,t)}}},e.prototype._refreshBrushController=function(t,e,n,i,r,o){var a=n.axis.getExtent(),s=a[1]-a[0],l=Math.min(30,.1*Math.abs(s)),u=PCt.create({x:a[0],y:-r/2,width:s,height:r});u.x-=l,u.width+=2*l,this._brushController.mount({enableGlobalPan:!0,rotation:t.rotation,x:t.position[0],y:t.position[1]}).setPanels([{panelId:"pl",clipPath:MKt(u),isTargetByCursor:TKt(u,o,i),getLinearBrushOtherExtent:DKt(u,0)}]).enableBrush({brushType:"lineX",brushStyle:e,removeOnClick:!0}).updateCovers(function(t){var e=t.axis;return C_t(t.activeIntervals,(function(t){return{brushType:"lineX",panelId:"pl",range:[e.dataToCoord(t[0],!0),e.dataToCoord(t[1],!0)]}}))}(n))},e.prototype._onBrush=function(t){var e=t.areas,n=this.axisModel,i=n.axis,r=C_t(e,(function(t){return[i.coordToData(t.range[0],!0),i.coordToData(t.range[1],!0)]}));(!n.option.realtime===t.isEnd||t.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:r})},e.prototype.dispose=function(){this._brushController.dispose()},e.type="parallelAxis",e}(nLt);var FKt={type:"axisAreaSelect",event:"axisAreaSelected"};var RKt={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function LKt(t){t.registerComponentView(kYt),t.registerComponentModel(AYt),t.registerCoordinateSystem("parallel",WYt),t.registerPreprocessor(_Yt),t.registerComponentModel(jYt),t.registerComponentView(OKt),zUt(t,"parallel",jYt,RKt),function(t){t.registerAction(FKt,(function(t,e){e.eachComponent({mainType:"parallelAxis",query:t},(function(e){e.axis.model.setActiveIntervals(t.intervals)}))})),t.registerAction("parallelAxisExpand",(function(t,e){e.eachComponent({mainType:"parallel",query:t},(function(e){e.setAxisExpand(t)}))}))}(t)}var $Kt=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0},PKt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultShape=function(){return new $Kt},e.prototype.buildPath=function(t,e){var n=e.extent;t.moveTo(e.x1,e.y1),t.bezierCurveTo(e.cpx1,e.cpy1,e.cpx2,e.cpy2,e.x2,e.y2),"vertical"===e.orient?(t.lineTo(e.x2+n,e.y2),t.bezierCurveTo(e.cpx2+n,e.cpy2,e.cpx1+n,e.cpy1,e.x1+n,e.y1)):(t.lineTo(e.x2,e.y2+n),t.bezierCurveTo(e.cpx2,e.cpy2+n,e.cpx1,e.cpy1+n,e.x1,e.y1+n)),t.closePath()},e.prototype.highlight=function(){KDt(this)},e.prototype.downplay=function(){ZDt(this)},e}(rDt),zKt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._focusAdjacencyDisabled=!1,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=this,r=t.getGraph(),o=this.group,a=t.layoutInfo,s=a.width,l=a.height,u=t.getData(),c=t.getData("edge"),h=t.get("orient");this._model=t,o.removeAll(),o.x=a.x,o.y=a.y,r.eachEdge((function(e){var n=new PKt,i=IDt(n);i.dataIndex=e.dataIndex,i.seriesIndex=t.seriesIndex,i.dataType="edge";var r,a,u,d,p,f,g,m,y=e.getModel(),v=y.getModel("lineStyle"),x=v.get("curveness"),b=e.node1.getLayout(),w=e.node1.getModel(),_=w.get("localX"),k=w.get("localY"),S=e.node2.getLayout(),C=e.node2.getModel(),A=C.get("localX"),I=C.get("localY"),M=e.getLayout();switch(n.shape.extent=Math.max(1,M.dy),n.shape.orient=h,"vertical"===h?(r=(null!=_?_*s:b.x)+M.sy,a=(null!=k?k*l:b.y)+b.dy,u=(null!=A?A*s:S.x)+M.ty,p=r,f=a*(1-x)+(d=null!=I?I*l:S.y)*x,g=u,m=a*x+d*(1-x)):(r=(null!=_?_*s:b.x)+b.dx,a=(null!=k?k*l:b.y)+M.sy,p=r*(1-x)+(u=null!=A?A*s:S.x)*x,f=a,g=r*x+u*(1-x),m=d=(null!=I?I*l:S.y)+M.ty),n.setShape({x1:r,y1:a,x2:u,y2:d,cpx1:p,cpy1:f,cpx2:g,cpy2:m}),n.useStyle(v.getItemStyle()),n.style.fill){case"source":n.style.fill=e.node1.getVisual("color"),n.style.decal=e.node1.getVisual("style").decal;break;case"target":n.style.fill=e.node2.getVisual("color"),n.style.decal=e.node2.getVisual("style").decal;break;case"gradient":var D=e.node1.getVisual("color"),T=e.node2.getVisual("color");"string"==typeof D&&"string"==typeof T&&(n.style.fill=new bEt(0,0,1,0,[{color:D,offset:0},{color:T,offset:1}]))}var E=y.getModel("emphasis");pTt(n,y,"lineStyle",(function(t){return t.getItemStyle()})),o.add(n),c.setItemGraphicEl(e.dataIndex,n);var N=E.get("focus");uTt(n,"adjacency"===N?e.getAdjacentDataIndices():N,E.get("blurScope")),IDt(n).dataType="edge"})),r.eachNode((function(e){var n=e.getLayout(),i=e.getModel(),r=i.get("localX"),a=i.get("localY"),c=i.getModel("emphasis"),h=new mDt({shape:{x:null!=r?r*s:n.x,y:null!=a?a*l:n.y,width:n.dx,height:n.dy},style:i.getModel("itemStyle").getItemStyle(),z2:10});uNt(h,cNt(i),{labelFetcher:t,labelDataIndex:e.dataIndex,defaultText:e.id}),h.disableLabelAnimation=!0,h.setStyle("fill",e.getVisual("color")),h.setStyle("decal",e.getVisual("style").decal),pTt(h,i),o.add(h),u.setItemGraphicEl(e.dataIndex,h),IDt(h).dataType="node";var d=c.get("focus");uTt(h,"adjacency"===d?e.getAdjacentDataIndices():d,c.get("blurScope"))})),u.eachItemGraphicEl((function(e,r){u.getItemModel(r).get("draggable")&&(e.drift=function(e,o){i._focusAdjacencyDisabled=!0,this.shape.x+=e,this.shape.y+=o,this.dirty(),n.dispatchAction({type:"dragNode",seriesId:t.id,dataIndex:u.getRawIndex(r),localX:this.shape.x/s,localY:this.shape.y/l})},e.ondragend=function(){i._focusAdjacencyDisabled=!1},e.draggable=!0,e.cursor="move")})),!this._data&&t.isAnimationEnabled()&&o.setClipPath(function(t,e,n){var i=new mDt({shape:{x:t.x-10,y:t.y-10,width:0,height:t.height+20}});return jEt(i,{shape:{width:t.width+20}},e,n),i}(o.getBoundingRect(),t,(function(){o.removeClipPath()}))),this._data=t.getData()},e.prototype.dispose=function(){},e.type="sankey",e}(aLt);var BKt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){var n=t.edges||t.links,i=t.data||t.nodes,r=t.levels;this.levelModels=[];for(var o=this.levelModels,a=0;a<r.length;a++)null!=r[a].depth&&r[a].depth>=0&&(o[r[a].depth]=new NNt(r[a],this,e));if(i&&n)return QXt(i,n,this,!0,(function(t,e){t.wrapMethod("getItemModel",(function(t,e){var n=t.parentModel,i=n.getData().getItemLayout(e);if(i){var r=i.depth,o=n.levelModels[r];o&&(t.parentModel=o)}return t})),e.wrapMethod("getItemModel",(function(t,e){var n=t.parentModel,i=n.getGraph().getEdgeByIndex(e).node1.getLayout();if(i){var r=i.depth,o=n.levelModels[r];o&&(t.parentModel=o)}return t}))})).data},e.prototype.setNodePosition=function(t,e){var n=this.option.data[t];n.localX=e[0],n.localY=e[1]},e.prototype.getGraph=function(){return this.getData().graph},e.prototype.getEdgeData=function(){return this.getGraph().edgeData},e.prototype.formatTooltip=function(t,e,n){function i(t){return isNaN(t)||null==t}if("edge"===n){var r=this.getDataParams(t,n),o=r.data,a=r.value;return RRt("nameValue",{name:o.source+" -- "+o.target,value:a,noValue:i(a)})}var s=this.getGraph().getNodeByIndex(t).getLayout().value,l=this.getDataParams(t,n).data.name;return RRt("nameValue",{name:null!=l?l+"":null,value:s,noValue:i(s)})},e.prototype.optionUpdated=function(){},e.prototype.getDataParams=function(e,n){var i=t.prototype.getDataParams.call(this,e,n);if(null==i.value&&"node"===n){var r=this.getGraph().getNodeByIndex(e).getLayout().value;i.value=r}return i},e.type="series.sankey",e.defaultOption={zlevel:0,z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,label:{show:!0,position:"right",fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3},e}(XRt);function VKt(t,e){t.eachSeriesByType("sankey",(function(t){var n=t.get("nodeWidth"),i=t.get("nodeGap"),r=function(t,e){return IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,e);t.layoutInfo=r;var o=r.width,a=r.height,s=t.getGraph(),l=s.nodes,u=s.edges;!function(t){S_t(t,(function(t){var e=ZKt(t.outEdges,KKt),n=ZKt(t.inEdges,KKt),i=t.getValue()||0,r=Math.max(e,n,i);t.setLayout({value:r},!0)}))}(l),function(t,e,n,i,r,o,a,s,l){(function(t,e,n,i,r,o,a){for(var s=[],l=[],u=[],c=[],h=0,d=0;d<e.length;d++)s[d]=1;for(d=0;d<t.length;d++)l[d]=t[d].inEdges.length,0===l[d]&&u.push(t[d]);var p=-1;for(;u.length;){for(var f=0;f<u.length;f++){var g=u[f],m=g.hostGraph.data.getRawDataItem(g.dataIndex),y=null!=m.depth&&m.depth>=0;y&&m.depth>p&&(p=m.depth),g.setLayout({depth:y?m.depth:h},!0),"vertical"===o?g.setLayout({dy:n},!0):g.setLayout({dx:n},!0);for(var v=0;v<g.outEdges.length;v++){var x=g.outEdges[v];s[e.indexOf(x)]=0;var b=x.node2;0==--l[t.indexOf(b)]&&c.indexOf(b)<0&&c.push(b)}}++h,u=c,c=[]}for(d=0;d<s.length;d++)if(1===s[d])throw new Error("Sankey is a DAG, the original data has cycle!");var w=p>h-1?p:h-1;a&&"left"!==a&&function(t,e,n,i){if("right"===e){for(var r=[],o=t,a=0;o.length;){for(var s=0;s<o.length;s++){var l=o[s];l.setLayout({skNodeHeight:a},!0);for(var u=0;u<l.inEdges.length;u++){var c=l.inEdges[u];r.indexOf(c.node1)<0&&r.push(c.node1)}}o=r,r=[],++a}S_t(t,(function(t){WKt(t)||t.setLayout({depth:Math.max(0,i-t.getLayout().skNodeHeight)},!0)}))}else"justify"===e&&function(t,e){S_t(t,(function(t){WKt(t)||t.outEdges.length||t.setLayout({depth:e},!0)}))}(t,i)}(t,a,0,w);!function(t,e,n){S_t(t,(function(t){var i=t.getLayout().depth*e;"vertical"===n?t.setLayout({y:i},!0):t.setLayout({x:i},!0)}))}(t,"vertical"===o?(r-n)/w:(i-n)/w,o)})(t,e,n,r,o,s,l),function(t,e,n,i,r,o,a){var s=function(t,e){var n=[],i="vertical"===e?"y":"x",r=ZAt(t,(function(t){return t.getLayout()[i]}));return r.keys.sort((function(t,e){return t-e})),S_t(r.keys,(function(t){n.push(r.buckets.get(t))})),n}(t,a);(function(t,e,n,i,r,o){var a=1/0;S_t(t,(function(t){var e=t.length,s=0;S_t(t,(function(t){s+=t.getLayout().value}));var l="vertical"===o?(i-(e-1)*r)/s:(n-(e-1)*r)/s;l<a&&(a=l)})),S_t(t,(function(t){S_t(t,(function(t,e){var n=t.getLayout().value*a;"vertical"===o?(t.setLayout({x:e},!0),t.setLayout({dx:n},!0)):(t.setLayout({y:e},!0),t.setLayout({dy:n},!0))}))})),S_t(e,(function(t){var e=+t.getValue()*a;t.setLayout({dy:e},!0)}))})(s,e,n,i,r,a),jKt(s,r,n,i,a);for(var l=1;o>0;o--)UKt(s,l*=.99,a),jKt(s,r,n,i,a),JKt(s,l,a),jKt(s,r,n,i,a)}(t,e,o,r,i,a,s),function(t,e){var n="vertical"===e?"x":"y";S_t(t,(function(t){t.outEdges.sort((function(t,e){return t.node2.getLayout()[n]-e.node2.getLayout()[n]})),t.inEdges.sort((function(t,e){return t.node1.getLayout()[n]-e.node1.getLayout()[n]}))})),S_t(t,(function(t){var e=0,n=0;S_t(t.outEdges,(function(t){t.setLayout({sy:e},!0),e+=t.getLayout().dy})),S_t(t.inEdges,(function(t){t.setLayout({ty:n},!0),n+=t.getLayout().dy}))}))}(t,s)}(l,u,n,i,o,a,0!==I_t(l,(function(t){return 0===t.getLayout().value})).length?0:t.get("layoutIterations"),t.get("orient"),t.get("nodeAlign"))}))}function WKt(t){var e=t.hostGraph.data.getRawDataItem(t.dataIndex);return null!=e.depth&&e.depth>=0}function jKt(t,e,n,i,r){var o="vertical"===r?"x":"y";S_t(t,(function(t){var a,s,l;t.sort((function(t,e){return t.getLayout()[o]-e.getLayout()[o]}));for(var u=0,c=t.length,h="vertical"===r?"dx":"dy",d=0;d<c;d++)(l=u-(s=t[d]).getLayout()[o])>0&&(a=s.getLayout()[o]+l,"vertical"===r?s.setLayout({x:a},!0):s.setLayout({y:a},!0)),u=s.getLayout()[o]+s.getLayout()[h]+e;if((l=u-e-("vertical"===r?i:n))>0){a=s.getLayout()[o]-l,"vertical"===r?s.setLayout({x:a},!0):s.setLayout({y:a},!0),u=a;for(d=c-2;d>=0;--d)(l=(s=t[d]).getLayout()[o]+s.getLayout()[h]+e-u)>0&&(a=s.getLayout()[o]-l,"vertical"===r?s.setLayout({x:a},!0):s.setLayout({y:a},!0)),u=s.getLayout()[o]}}))}function UKt(t,e,n){S_t(t.slice().reverse(),(function(t){S_t(t,(function(t){if(t.outEdges.length){var i=ZKt(t.outEdges,GKt,n)/ZKt(t.outEdges,KKt);if(isNaN(i)){var r=t.outEdges.length;i=r?ZKt(t.outEdges,HKt,n)/r:0}if("vertical"===n){var o=t.getLayout().x+(i-YKt(t,n))*e;t.setLayout({x:o},!0)}else{var a=t.getLayout().y+(i-YKt(t,n))*e;t.setLayout({y:a},!0)}}}))}))}function GKt(t,e){return YKt(t.node2,e)*t.getValue()}function HKt(t,e){return YKt(t.node2,e)}function qKt(t,e){return YKt(t.node1,e)*t.getValue()}function XKt(t,e){return YKt(t.node1,e)}function YKt(t,e){return"vertical"===e?t.getLayout().x+t.getLayout().dx/2:t.getLayout().y+t.getLayout().dy/2}function KKt(t){return t.getValue()}function ZKt(t,e,n){for(var i=0,r=t.length,o=-1;++o<r;){var a=+e(t[o],n);isNaN(a)||(i+=a)}return i}function JKt(t,e,n){S_t(t,(function(t){S_t(t,(function(t){if(t.inEdges.length){var i=ZKt(t.inEdges,qKt,n)/ZKt(t.inEdges,KKt);if(isNaN(i)){var r=t.inEdges.length;i=r?ZKt(t.inEdges,XKt,n)/r:0}if("vertical"===n){var o=t.getLayout().x+(i-YKt(t,n))*e;t.setLayout({x:o},!0)}else{var a=t.getLayout().y+(i-YKt(t,n))*e;t.setLayout({y:a},!0)}}}))}))}function QKt(t){t.eachSeriesByType("sankey",(function(t){var e=t.getGraph().nodes;if(e.length){var n=1/0,i=-1/0;S_t(e,(function(t){var e=t.getLayout().value;e<n&&(n=e),e>i&&(i=e)})),S_t(e,(function(e){var r=new kqt({type:"color",mappingMethod:"linear",dataExtent:[n,i],visual:t.get("color")}).mapValueToVisual(e.getLayout().value),o=e.getModel().get(["itemStyle","color"]);null!=o?(e.setVisual("color",o),e.setVisual("style",{fill:o})):(e.setVisual("color",r),e.setVisual("style",{fill:r}))}))}}))}var tZt=function(){function t(){}return t.prototype.getInitialData=function(t,e){var n,i,r=e.getComponent("xAxis",this.get("xAxisIndex")),o=e.getComponent("yAxis",this.get("yAxisIndex")),a=r.get("type"),s=o.get("type");"category"===a?(t.layout="horizontal",n=r.getOrdinalMeta(),i=!0):"category"===s?(t.layout="vertical",n=o.getOrdinalMeta(),i=!0):t.layout=t.layout||"horizontal";var l=["x","y"],u="horizontal"===t.layout?0:1,c=this._baseAxisDim=l[u],h=l[1-u],d=[r,o],p=d[u].get("type"),f=d[1-u].get("type"),g=t.data;if(g&&i){var m=[];S_t(g,(function(t,e){var n;E_t(t)?(n=t.slice(),t.unshift(e)):E_t(t.value)?(n=t.value.slice(),t.value.unshift(e)):n=t,m.push(n)})),t.data=m}var y=this.defaultValueDimensions,v=[{name:c,type:bBt(p),ordinalMeta:n,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:h,type:bBt(f),dimsDef:y.slice()}];return SUt(this,{coordDimensions:v,dimensionsCount:y.length+1,encodeDefaulter:T_t(jOt,v,this)})},t.prototype.getBaseAxis=function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis},t}(),eZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.defaultValueDimensions=[{name:"min",defaultTooltip:!0},{name:"Q1",defaultTooltip:!0},{name:"median",defaultTooltip:!0},{name:"Q3",defaultTooltip:!0},{name:"max",defaultTooltip:!0}],n.visualDrawType="stroke",n}return Dit(e,t),e.type="series.boxplot",e.dependencies=["xAxis","yAxis","grid"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,boxWidth:[7,50],itemStyle:{color:"#fff",borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}},animationDuration:800},e}(XRt);__t(eZt,tZt,!0);var nZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.getData(),r=this.group,o=this._data;this._data||r.removeAll();var a="horizontal"===t.get("layout")?1:0;i.diff(o).add((function(t){if(i.hasValue(t)){var e=oZt(i.getItemLayout(t),i,t,a,!0);i.setItemGraphicEl(t,e),r.add(e)}})).update((function(t,e){var n=o.getItemGraphicEl(e);if(i.hasValue(t)){var s=i.getItemLayout(t);n?aZt(s,n,i,t):n=oZt(s,i,t,a),r.add(n),i.setItemGraphicEl(t,n)}else r.remove(n)})).remove((function(t){var e=o.getItemGraphicEl(t);e&&r.remove(e)})).execute(),this._data=i},e.prototype.remove=function(t){var e=this.group,n=this._data;this._data=null,n&&n.eachItemGraphicEl((function(t){t&&e.remove(t)}))},e.type="boxplot",e}(aLt),iZt=function(){},rZt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="boxplotBoxPath",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new iZt},e.prototype.buildPath=function(t,e){var n=e.points,i=0;for(t.moveTo(n[i][0],n[i][1]),i++;i<4;i++)t.lineTo(n[i][0],n[i][1]);for(t.closePath();i<n.length;i++)t.moveTo(n[i][0],n[i][1]),i++,t.lineTo(n[i][0],n[i][1])},e}(rDt);function oZt(t,e,n,i,r){var o=t.ends,a=new rZt({shape:{points:r?sZt(o,i,t):o}});return aZt(t,a,e,n,r),a}function aZt(t,e,n,i,r){var o=n.hostModel;(0,oNt[r?"initProps":"updateProps"])(e,{shape:{points:t.ends}},o,i),e.useStyle(n.getItemVisual(i,"style")),e.style.strokeNoScale=!0,e.z2=100;var a=n.getItemModel(i);pTt(e,a),uTt(e,a.get(["emphasis","focus"]),a.get(["emphasis","blurScope"]))}function sZt(t,e,n){return C_t(t,(function(t){return(t=t.slice())[e]=n.initBaseline,t}))}function lZt(t,e){}var uZt=S_t;function cZt(t){var e=function(t){var e=[],n=[];return t.eachSeriesByType("boxplot",(function(t){var i=t.getBaseAxis(),r=w_t(n,i);r<0&&(r=n.length,n[r]=i,e[r]={axis:i,seriesModels:[]}),e[r].seriesModels.push(t)})),e}(t);uZt(e,(function(t){var e=t.seriesModels;e.length&&(!function(t){var e,n,i=t.axis,r=t.seriesModels,o=r.length,a=t.boxWidthList=[],s=t.boxOffsetList=[],l=[];if("category"===i.type)n=i.getBandWidth();else{var u=0;uZt(r,(function(t){u=Math.max(u,t.getData().count())})),e=i.getExtent(),Math.abs(e[1]-e[0])}uZt(r,(function(t){var e=t.get("boxWidth");E_t(e)||(e=[e,e]),l.push([dAt(e[0],n)||0,dAt(e[1],n)||0])}));var c=.8*n-2,h=c/o*.3,d=(c-h*(o-1))/o,p=d/2-c/2;uZt(r,(function(t,e){s.push(p),p+=h+d,a.push(Math.min(Math.max(d,l[e][0]),l[e][1]))}))}(t),uZt(e,(function(e,n){!function(t,e,n){var i=t.coordinateSystem,r=t.getData(),o=n/2,a="horizontal"===t.get("layout")?0:1,s=1-a,l=["x","y"],u=r.mapDimension(l[a]),c=r.mapDimensionsAll(l[s]);if(null==u||c.length<5)return;for(var h=0;h<r.count();h++){var d=r.get(u,h),p=x(d,c[2],h),f=x(d,c[0],h),g=x(d,c[1],h),m=x(d,c[3],h),y=x(d,c[4],h),v=[];b(v,g,!1),b(v,m,!0),v.push(f,g,y,m),w(v,f),w(v,y),w(v,p),r.setItemLayout(h,{initBaseline:p[s],ends:v})}function x(t,n,o){var l,u=r.get(n,o),c=[];return c[a]=t,c[s]=u,isNaN(t)||isNaN(u)?l=[NaN,NaN]:(l=i.dataToPoint(c))[a]+=e,l}function b(t,e,n){var i=e.slice(),r=e.slice();i[a]+=o,r[a]-=o,n?t.push(i,r):t.push(r,i)}function w(t,e){var n=e.slice(),i=e.slice();n[a]-=o,i[a]+=o,t.push(n,i)}}(e,t.boxOffsetList[n],t.boxWidthList[n])})))}))}var hZt={type:"echarts:boxplot",transform:function(t){var e=t.upstream;if("arrayRows"!==e.sourceFormat){EAt("")}var n=function(t,e){for(var n=[],i=[],r=(e=e||{}).boundIQR,o="none"===r||0===r,a=0;a<t.length;a++){var s=fAt(t[a].slice()),l=SAt(s,.25),u=SAt(s,.5),c=SAt(s,.75),h=s[0],d=s[s.length-1],p=(null==r?1.5:r)*(c-l),f=o?h:Math.max(h,l-p),g=o?d:Math.min(d,c+p),m=e.itemNameFormatter,y=N_t(m)?m({value:a}):O_t(m)?m.replace("{value}",a+""):a+"";n.push([y,f,l,u,c,g]);for(var v=0;v<s.length;v++){var x=s[v];if(x<f||x>g){var b=[y,x];i.push(b)}}}return{boxData:n,outliers:i}}(e.getRawData(),t.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};var dZt=["color","borderColor"],pZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){this.group.removeClipPath(),this._updateDrawMode(t),this._isLargeDraw?this._renderLarge(t):this._renderNormal(t)},e.prototype.incrementalPrepareRender=function(t,e,n){this._clear(),this._updateDrawMode(t)},e.prototype.incrementalRender=function(t,e,n,i){this._isLargeDraw?this._incrementalRenderLarge(t,e):this._incrementalRenderNormal(t,e)},e.prototype._updateDrawMode=function(t){var e=t.pipelineContext.large;null!=this._isLargeDraw&&e===this._isLargeDraw||(this._isLargeDraw=e,this._clear())},e.prototype._renderNormal=function(t){var e=t.getData(),n=this._data,i=this.group,r=e.getLayout("isSimpleBox"),o=t.get("clip",!0),a=t.coordinateSystem,s=a.getArea&&a.getArea();this._data||i.removeAll(),e.diff(n).add((function(n){if(e.hasValue(n)){var a=e.getItemLayout(n);if(o&&yZt(s,a))return;var l=mZt(a,n,!0);jEt(l,{shape:{points:a.ends}},t,n),vZt(l,e,n,r),i.add(l),e.setItemGraphicEl(n,l)}})).update((function(a,l){var u=n.getItemGraphicEl(l);if(e.hasValue(a)){var c=e.getItemLayout(a);o&&yZt(s,c)?i.remove(u):(u?WEt(u,{shape:{points:c.ends}},t,a):u=mZt(c),vZt(u,e,a,r),i.add(u),e.setItemGraphicEl(a,u))}else i.remove(u)})).remove((function(t){var e=n.getItemGraphicEl(t);e&&i.remove(e)})).execute(),this._data=e},e.prototype._renderLarge=function(t){this._clear(),_Zt(t,this.group);var e=t.get("clip",!0)?Ojt(t.coordinateSystem,!1,t):null;e?this.group.setClipPath(e):this.group.removeClipPath()},e.prototype._incrementalRenderNormal=function(t,e){for(var n,i=e.getData(),r=i.getLayout("isSimpleBox");null!=(n=t.next());){var o=mZt(i.getItemLayout(n));vZt(o,i,n,r),o.incremental=!0,this.group.add(o)}},e.prototype._incrementalRenderLarge=function(t,e){_Zt(e,this.group,!0)},e.prototype.remove=function(t){this._clear()},e.prototype._clear=function(){this.group.removeAll(),this._data=null},e.type="candlestick",e}(aLt),fZt=function(){},gZt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="normalCandlestickBox",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new fZt},e.prototype.buildPath=function(t,e){var n=e.points;this.__simpleBox?(t.moveTo(n[4][0],n[4][1]),t.lineTo(n[6][0],n[6][1])):(t.moveTo(n[0][0],n[0][1]),t.lineTo(n[1][0],n[1][1]),t.lineTo(n[2][0],n[2][1]),t.lineTo(n[3][0],n[3][1]),t.closePath(),t.moveTo(n[4][0],n[4][1]),t.lineTo(n[5][0],n[5][1]),t.moveTo(n[6][0],n[6][1]),t.lineTo(n[7][0],n[7][1]))},e}(rDt);function mZt(t,e,n){var i=t.ends;return new gZt({shape:{points:n?xZt(i,t):i},z2:100})}function yZt(t,e){for(var n=!0,i=0;i<e.ends.length;i++)if(t.contain(e.ends[i][0],e.ends[i][1])){n=!1;break}return n}function vZt(t,e,n,i){var r=e.getItemModel(n);t.useStyle(e.getItemVisual(n,"style")),t.style.strokeNoScale=!0,t.__simpleBox=i,pTt(t,r)}function xZt(t,e){return C_t(t,(function(t){return(t=t.slice())[1]=e.initBaseline,t}))}var bZt=function(){},wZt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="largeCandlestickBox",n}return Dit(e,t),e.prototype.getDefaultShape=function(){return new bZt},e.prototype.buildPath=function(t,e){for(var n=e.points,i=0;i<n.length;)if(this.__sign===n[i++]){var r=n[i++];t.moveTo(r,n[i++]),t.lineTo(r,n[i++])}else i+=3},e}(rDt);function _Zt(t,e,n){var i=t.getData().getLayout("largePoints"),r=new wZt({shape:{points:i},__sign:1});e.add(r);var o=new wZt({shape:{points:i},__sign:-1});e.add(o),kZt(1,r,t),kZt(-1,o,t),n&&(r.incremental=!0,o.incremental=!0)}function kZt(t,e,n,i){var r=n.get(["itemStyle",t>0?"borderColor":"borderColor0"])||n.get(["itemStyle",t>0?"color":"color0"]),o=n.getModel("itemStyle").getItemStyle(dZt);e.useStyle(o),e.style.fill=null,e.style.stroke=r}var SZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],n}return Dit(e,t),e.prototype.getShadowDim=function(){return"open"},e.prototype.brushSelector=function(t,e,n){var i=e.getItemLayout(t);return i&&n.rect(i.brushRect)},e.type="series.candlestick",e.dependencies=["xAxis","yAxis","grid"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},e}(XRt);function CZt(t){t&&E_t(t.series)&&S_t(t.series,(function(t){L_t(t)&&"k"===t.type&&(t.type="candlestick")}))}__t(SZt,tZt,!0);var AZt=["itemStyle","borderColor"],IZt=["itemStyle","borderColor0"],MZt=["itemStyle","color"],DZt=["itemStyle","color0"],TZt={seriesType:"candlestick",plan:iLt(),performRawSeries:!0,reset:function(t,e){function n(t,e){return e.get(t>0?MZt:DZt)}function i(t,e){return e.get(t>0?AZt:IZt)}if(!e.isSeriesFiltered(t))return!t.pipelineContext.large&&{progress:function(t,e){for(var r;null!=(r=t.next());){var o=e.getItemModel(r),a=e.getItemLayout(r).sign,s=o.getItemStyle();s.fill=n(a,o),s.stroke=i(a,o)||s.fill,v_t(e.ensureUniqueItemVisual(r,"style"),s)}}}}},EZt="undefined"!=typeof Float32Array?Float32Array:Array,NZt={seriesType:"candlestick",plan:iLt(),reset:function(t){var e=t.coordinateSystem,n=t.getData(),i=function(t,e){var n,i=t.getBaseAxis(),r="category"===i.type?i.getBandWidth():(n=i.getExtent(),Math.abs(n[1]-n[0])/e.count()),o=dAt(W_t(t.get("barMaxWidth"),r),r),a=dAt(W_t(t.get("barMinWidth"),1),r),s=t.get("barWidth");return null!=s?dAt(s,r):Math.max(Math.min(r/2,o),a)}(t,n),r=["x","y"],o=n.mapDimension(r[0]),a=n.mapDimensionsAll(r[1]),s=a[0],l=a[1],u=a[2],c=a[3];if(n.setLayout({candleWidth:i,isSimpleBox:i<=1.3}),!(null==o||a.length<4))return{progress:t.pipelineContext.large?function(t,n){var i,r,a=new EZt(4*t.count),h=0,d=[],p=[];for(;null!=(r=t.next());){var f=n.get(o,r),g=n.get(s,r),m=n.get(l,r),y=n.get(u,r),v=n.get(c,r);isNaN(f)||isNaN(y)||isNaN(v)?(a[h++]=NaN,h+=3):(a[h++]=OZt(n,r,g,m,l),d[0]=f,d[1]=y,i=e.dataToPoint(d,null,p),a[h++]=i?i[0]:NaN,a[h++]=i?i[1]:NaN,d[1]=v,i=e.dataToPoint(d,null,p),a[h++]=i?i[1]:NaN)}n.setLayout("largePoints",a)}:function(t,n){var r;for(;null!=(r=t.next());){var a=n.get(o,r),h=n.get(s,r),d=n.get(l,r),p=n.get(u,r),f=n.get(c,r),g=Math.min(h,d),m=Math.max(h,d),y=_(g,a),v=_(m,a),x=_(p,a),b=_(f,a),w=[];k(w,v,0),k(w,y,1),w.push(C(b),C(v),C(x),C(y)),n.setItemLayout(r,{sign:OZt(n,r,h,d,l),initBaseline:h>d?v[1]:y[1],ends:w,brushRect:S(p,f,a)})}function _(t,n){var i=[];return i[0]=n,i[1]=t,isNaN(n)||isNaN(t)?[NaN,NaN]:e.dataToPoint(i)}function k(t,e,n){var r=e.slice(),o=e.slice();r[0]=BEt(r[0]+i/2,1,!1),o[0]=BEt(o[0]-i/2,1,!0),n?t.push(r,o):t.push(o,r)}function S(t,e,n){var r=_(t,n),o=_(e,n);return r[0]-=i/2,o[0]-=i/2,{x:r[0],y:r[1],width:i,height:o[1]-r[1]}}function C(t){return t[0]=BEt(t[0],1),t}}}}};function OZt(t,e,n,i,r){return n>i?-1:n<i?1:e>0?t.get(r,e-1)<=i?1:-1:1}function FZt(t,e){var n=e.rippleEffectColor||e.color;t.eachChild((function(t){t.attr({z:e.z,zlevel:e.zlevel,style:{stroke:"stroke"===e.brushType?n:null,fill:"fill"===e.brushType?n:null}})}))}var RZt=function(t){function e(e,n){var i=t.call(this)||this,r=new djt(e,n),o=new oAt;return i.add(r),i.add(o),i.updateData(e,n),i}return Dit(e,t),e.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},e.prototype.startEffectAnimation=function(t){for(var e=t.symbolType,n=t.color,i=this.childAt(1),r=0;r<3;r++){var o=U$t(e,-1,-1,2,2,n);o.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var a=-r/3*t.period+t.effectOffset;o.animate("",!0).when(t.period,{scaleX:t.rippleScale/2,scaleY:t.rippleScale/2}).delay(a).start(),o.animateStyle(!0).when(t.period,{opacity:0}).delay(a).start(),i.add(o)}FZt(i,t)},e.prototype.updateEffectAnimation=function(t){for(var e=this._effectCfg,n=this.childAt(1),i=["symbolType","period","rippleScale"],r=0;r<i.length;r++){var o=i[r];if(e[o]!==t[o])return this.stopEffectAnimation(),void this.startEffectAnimation(t)}FZt(n,t)},e.prototype.highlight=function(){KDt(this)},e.prototype.downplay=function(){ZDt(this)},e.prototype.updateData=function(t,e){var n=this,i=t.hostModel;this.childAt(0).updateData(t,e);var r=this.childAt(1),o=t.getItemModel(e),a=t.getItemVisual(e,"symbol"),s=function(t){return E_t(t)||(t=[+t,+t]),t}(t.getItemVisual(e,"symbolSize")),l=t.getItemVisual(e,"style"),u=l&&l.fill;r.setScale(s),r.traverse((function(t){t.setStyle("fill",u)}));var c=t.getItemVisual(e,"symbolOffset");c&&(E_t(c)||(c=[c,c]),r.x=dAt(c[0],s[0]),r.y=dAt(W_t(c[1],c[0])||0,s[1]));var h=t.getItemVisual(e,"symbolRotate");r.rotation=(h||0)*Math.PI/180||0;var d={};d.showEffectOn=i.get("showEffectOn"),d.rippleScale=o.get(["rippleEffect","scale"]),d.brushType=o.get(["rippleEffect","brushType"]),d.period=1e3*o.get(["rippleEffect","period"]),d.effectOffset=e/t.count(),d.z=i.getShallow("z")||0,d.zlevel=i.getShallow("zlevel")||0,d.symbolType=a,d.color=u,d.rippleEffectColor=o.get(["rippleEffect","color"]),this.off("mouseover").off("mouseout").off("emphasis").off("normal"),"render"===d.showEffectOn?(this._effectCfg?this.updateEffectAnimation(d):this.startEffectAnimation(d),this._effectCfg=d):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(t){"emphasis"===t?"render"!==d.showEffectOn&&n.startEffectAnimation(d):"normal"===t&&"render"!==d.showEffectOn&&n.stopEffectAnimation()}),this._effectCfg=d,uTt(this)},e.prototype.fadeOut=function(t){this.off("mouseover").off("mouseout"),t&&t()},e}(oAt),LZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(){this._symbolDraw=new yjt(RZt)},e.prototype.render=function(t,e,n){var i=t.getData(),r=this._symbolDraw;r.updateData(i,{clipShape:this._getClipShape(t)}),this.group.add(r.group)},e.prototype._getClipShape=function(t){var e=t.coordinateSystem,n=e&&e.getArea&&e.getArea();return t.get("clip",!0)?n:null},e.prototype.updateTransform=function(t,e,n){var i=t.getData();this.group.dirty();var r=Gjt("").reset(t,e,n);r.progress&&r.progress({start:0,end:i.count(),count:i.count()},i),this._symbolDraw.updateLayout()},e.prototype._updateGroupTransform=function(t){var e,n,i=t.coordinateSystem;i&&i.getRoamTransform&&(this.group.transform=(e=i.getRoamTransform(),fCt(n=[1,0,0,1,0,0],e),n),this.group.decomposeTransform())},e.prototype.remove=function(t,e){this._symbolDraw&&this._symbolDraw.remove(!0)},e.type="effectScatter",e}(aLt),$Zt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.hasSymbolVisual=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this,{useEncodeDefaulter:!0})},e.prototype.brushSelector=function(t,e,n){return n.point(e.getItemLayout(t))},e.type="series.effectScatter",e.dependencies=["grid","polar"],e.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill"},symbolSize:10},e}(XRt);var PZt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.add(r.createLine(e,n,i)),r._updateEffectSymbol(e,n),r}return Dit(e,t),e.prototype.createLine=function(t,e,n){return new OXt(t,e,n)},e.prototype._updateEffectSymbol=function(t,e){var n=t.getItemModel(e).getModel("effect"),i=n.get("symbolSize"),r=n.get("symbol");E_t(i)||(i=[i,i]);var o=t.getItemVisual(e,"style"),a=n.get("color")||o&&o.stroke,s=this.childAt(1);this._symbolType!==r&&(this.remove(s),(s=U$t(r,-.5,-.5,1,1,a)).z2=100,s.culling=!0,this.add(s)),s&&(s.setStyle("shadowColor",a),s.setStyle(n.getItemStyle(["color"])),s.scaleX=i[0],s.scaleY=i[1],s.setColor(a),this._symbolType=r,this._symbolScale=i,this._updateEffectAnimation(t,n,e))},e.prototype._updateEffectAnimation=function(t,e,n){var i=this.childAt(1);if(i){var r=this,o=t.getItemLayout(n),a=1e3*e.get("period"),s=e.get("loop"),l=e.get("constantSpeed"),u=V_t(e.get("delay"),(function(e){return e/t.count()*a/3}));if(i.ignore=!0,this._updateAnimationPoints(i,o),l>0&&(a=this._getLineLength(i)/l*1e3),(a!==this._period||s!==this._loop)&&(i.stopAnimation(),a>0)){var c=void 0;c="function"==typeof u?u(n):u,i.__t>0&&(c=-a*i.__t),i.__t=0;var h=i.animate("",s).when(a,{__t:1}).delay(c).during((function(){r._updateSymbolPosition(i)}));s||h.done((function(){r.remove(i)})),h.start()}this._period=a,this._loop=s}},e.prototype._getLineLength=function(t){return dkt(t.__p1,t.__cp1)+dkt(t.__cp1,t.__p2)},e.prototype._updateAnimationPoints=function(t,e){t.__p1=e[0],t.__p2=e[1],t.__cp1=e[2]||[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]},e.prototype.updateData=function(t,e,n){this.childAt(0).updateData(t,e,n),this._updateEffectSymbol(t,e)},e.prototype._updateSymbolPosition=function(t){var e=t.__p1,n=t.__p2,i=t.__cp1,r=t.__t,o=[t.x,t.y],a=o.slice(),s=JIt,l=QIt;o[0]=s(e[0],i[0],n[0],r),o[1]=s(e[1],i[1],n[1],r);var u=l(e[0],i[0],n[0],r),c=l(e[1],i[1],n[1],r);t.rotation=-Math.atan2(c,u)-Math.PI/2,"line"!==this._symbolType&&"rect"!==this._symbolType&&"roundRect"!==this._symbolType||(void 0!==t.__lastT&&t.__lastT<t.__t?(t.scaleY=1.05*dkt(a,o),1===r&&(o[0]=a[0]+(o[0]-a[0])/2,o[1]=a[1]+(o[1]-a[1])/2)):1===t.__lastT?t.scaleY=2*dkt(e,o):t.scaleY=this._symbolScale[1]),t.__lastT=t.__t,t.ignore=!1,t.x=o[0],t.y=o[1]},e.prototype.updateLayout=function(t,e){this.childAt(0).updateLayout(t,e);var n=t.getItemModel(e).getModel("effect");this._updateEffectAnimation(t,n,e)},e}(oAt),zZt=function(t){function e(e,n,i){var r=t.call(this)||this;return r._createPolyline(e,n,i),r}return Dit(e,t),e.prototype._createPolyline=function(t,e,n){var i=t.getItemLayout(e),r=new lEt({shape:{points:i}});this.add(r),this._updateCommonStl(t,e,n)},e.prototype.updateData=function(t,e,n){var i=t.hostModel;WEt(this.childAt(0),{shape:{points:t.getItemLayout(e)}},i,e),this._updateCommonStl(t,e,n)},e.prototype._updateCommonStl=function(t,e,n){var i=this.childAt(0),r=t.getItemModel(e),o=n&&n.emphasisLineStyle;n&&!t.hasItemOption||(o=r.getModel(["emphasis","lineStyle"]).getLineStyle()),i.useStyle(t.getItemVisual(e,"style")),i.style.fill=null,i.style.strokeNoScale=!0,i.ensureState("emphasis").style=o,uTt(this)},e.prototype.updateLayout=function(t,e){this.childAt(0).setShape("points",t.getItemLayout(e))},e}(oAt),BZt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._lastFrame=0,e._lastFramePercent=0,e}return Dit(e,t),e.prototype.createLine=function(t,e,n){return new zZt(t,e,n)},e.prototype._updateAnimationPoints=function(t,e){this._points=e;for(var n=[0],i=0,r=1;r<e.length;r++){var o=e[r-1],a=e[r];i+=dkt(o,a),n.push(i)}if(0!==i){for(r=0;r<n.length;r++)n[r]/=i;this._offsets=n,this._length=i}else this._length=0},e.prototype._getLineLength=function(){return this._length},e.prototype._updateSymbolPosition=function(t){var e=t.__t,n=this._points,i=this._offsets,r=n.length;if(i){var o,a=this._lastFrame;if(e<this._lastFramePercent){for(o=Math.min(a+1,r-1);o>=0&&!(i[o]<=e);o--);o=Math.min(o,r-2)}else{for(o=a;o<r&&!(i[o]>e);o++);o=Math.min(o-1,r-2)}var s=(e-i[o])/(i[o+1]-i[o]),l=n[o],u=n[o+1];t.x=l[0]*(1-s)+s*u[0],t.y=l[1]*(1-s)+s*u[1];var c=u[0]-l[0],h=u[1]-l[1];t.rotation=-Math.atan2(h,c)-Math.PI/2,this._lastFrame=o,this._lastFramePercent=e,t.ignore=!1}},e}(PZt),VZt=function(){this.polyline=!1,this.curveness=0,this.segs=[]},WZt=function(t){function e(e){return t.call(this,e)||this}return Dit(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new VZt},e.prototype.buildPath=function(t,e){var n=e.segs,i=e.curveness;if(e.polyline)for(var r=0;r<n.length;){var o=n[r++];if(o>0){t.moveTo(n[r++],n[r++]);for(var a=1;a<o;a++)t.lineTo(n[r++],n[r++])}}else for(r=0;r<n.length;){var s=n[r++],l=n[r++],u=n[r++],c=n[r++];if(t.moveTo(s,l),i>0){var h=(s+u)/2-(l-c)*i,d=(l+c)/2-(u-s)*i;t.quadraticCurveTo(h,d,u,c)}else t.lineTo(u,c)}},e.prototype.findDataIndex=function(t,e){var n=this.shape,i=n.segs,r=n.curveness,o=this.style.lineWidth;if(n.polyline)for(var a=0,s=0;s<i.length;){var l=i[s++];if(l>0)for(var u=i[s++],c=i[s++],h=1;h<l;h++){if(zMt(u,c,d=i[s++],p=i[s++],o,t,e))return a}a++}else for(a=0,s=0;s<i.length;){u=i[s++],c=i[s++];var d=i[s++],p=i[s++];if(r>0){if(VMt(u,c,(u+d)/2-(c-p)*r,(c+p)/2-(d-u)*r,d,p,o,t,e))return a}else if(zMt(u,c,d,p,o,t,e))return a;a++}return-1},e}(rDt),jZt=function(){function t(){this.group=new oAt}return t.prototype.isPersistent=function(){return!this._incremental},t.prototype.updateData=function(t){this.group.removeAll();var e=new WZt({rectHover:!0,cursor:"default"});e.setShape({segs:t.getLayout("linesPoints")}),this._setCommon(e,t),this.group.add(e),this._incremental=null},t.prototype.incrementalPrepareUpdate=function(t){this.group.removeAll(),this._clearIncremental(),t.count()>5e5?(this._incremental||(this._incremental=new MEt({silent:!0})),this.group.add(this._incremental)):this._incremental=null},t.prototype.incrementalUpdate=function(t,e){var n=new WZt;n.setShape({segs:e.getLayout("linesPoints")}),this._setCommon(n,e,!!this._incremental),this._incremental?this._incremental.addDisplayable(n,!0):(n.rectHover=!0,n.cursor="default",n.__startIndex=t.start,this.group.add(n))},t.prototype.remove=function(){this._clearIncremental(),this._incremental=null,this.group.removeAll()},t.prototype._setCommon=function(t,e,n){var i=e.hostModel;t.setShape({polyline:i.get("polyline"),curveness:i.get(["lineStyle","curveness"])}),t.useStyle(i.getModel("lineStyle").getLineStyle()),t.style.strokeNoScale=!0;var r=e.getVisual("style");if(r&&r.stroke&&t.setStyle("stroke",r.stroke),t.setStyle("fill",null),!n){var o=IDt(t);o.seriesIndex=i.seriesIndex,t.on("mousemove",(function(e){o.dataIndex=null;var n=t.findDataIndex(e.offsetX,e.offsetY);n>0&&(o.dataIndex=n+t.__startIndex)}))}},t.prototype._clearIncremental=function(){var t=this._incremental;t&&t.clearDisplaybles()},t}(),UZt={seriesType:"lines",plan:iLt(),reset:function(t){var e=t.coordinateSystem,n=t.get("polyline"),i=t.pipelineContext.large;return{progress:function(r,o){var a=[];if(i){var s=void 0,l=r.end-r.start;if(n){for(var u=0,c=r.start;c<r.end;c++)u+=t.getLineCoordsCount(c);s=new Float32Array(l+2*u)}else s=new Float32Array(4*l);var h=0,d=[];for(c=r.start;c<r.end;c++){var p=t.getLineCoords(c,a);n&&(s[h++]=p);for(var f=0;f<p;f++)d=e.dataToPoint(a[f],!1,d),s[h++]=d[0],s[h++]=d[1]}o.setLayout("linesPoints",s)}else for(c=r.start;c<r.end;c++){var g=o.getItemModel(c),m=(p=t.getLineCoords(c,a),[]);if(n)for(var y=0;y<p;y++)m.push(e.dataToPoint(a[y]));else{m[0]=e.dataToPoint(a[0]),m[1]=e.dataToPoint(a[1]);var v=g.get(["lineStyle","curveness"]);+v&&(m[2]=[(m[0][0]+m[1][0])/2-(m[0][1]-m[1][1])*v,(m[0][1]+m[1][1])/2-(m[1][0]-m[0][0])*v])}o.setItemLayout(c,m)}}}}},GZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.getData(),r=this._updateLineDraw(i,t),o=t.get("zlevel"),a=t.get(["effect","trailLength"]),s=n.getZr(),l="svg"===s.painter.getType();l||s.painter.getLayer(o).clear(!0),null==this._lastZlevel||l||s.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(t)&&a&&(l||s.configLayer(o,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(a/10+.9,1),0)})),r.updateData(i);var u=t.get("clip",!0)&&Ojt(t.coordinateSystem,!1,t);u?this.group.setClipPath(u):this.group.removeClipPath(),this._lastZlevel=o,this._finished=!0},e.prototype.incrementalPrepareRender=function(t,e,n){var i=t.getData();this._updateLineDraw(i,t).incrementalPrepareUpdate(i),this._clearLayer(n),this._finished=!1},e.prototype.incrementalRender=function(t,e,n){this._lineDraw.incrementalUpdate(t,e.getData()),this._finished=t.end===e.getData().count()},e.prototype.updateTransform=function(t,e,n){var i=t.getData(),r=t.pipelineContext;if(!this._finished||r.large||r.progressiveRender)return{update:!0};var o=UZt.reset(t,e,n);o.progress&&o.progress({start:0,end:i.count(),count:i.count()},i),this._lineDraw.updateLayout(),this._clearLayer(n)},e.prototype._updateLineDraw=function(t,e){var n=this._lineDraw,i=this._showEffect(e),r=!!e.get("polyline"),o=e.pipelineContext.large;return n&&i===this._hasEffet&&r===this._isPolyline&&o===this._isLargeDraw||(n&&n.remove(),n=this._lineDraw=o?new jZt:new FXt(r?i?BZt:zZt:i?PZt:OXt),this._hasEffet=i,this._isPolyline=r,this._isLargeDraw=o,this.group.removeAll()),this.group.add(n.group),n},e.prototype._showEffect=function(t){return!!t.get(["effect","show"])},e.prototype._clearLayer=function(t){var e=t.getZr();"svg"===e.painter.getType()||null==this._lastZlevel||e.painter.getLayer(this._lastZlevel).clear(!0)},e.prototype.remove=function(t,e){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(e)},e.type="lines",e}(aLt),HZt="undefined"==typeof Uint32Array?Array:Uint32Array,qZt="undefined"==typeof Float64Array?Array:Float64Array;function XZt(t){var e=t.data;e&&e[0]&&e[0][0]&&e[0][0].coord&&(t.data=C_t(e,(function(t){var e={coords:[t[0].coord,t[1].coord]};return t[0].name&&(e.fromName=t[0].name),t[1].name&&(e.toName=t[1].name),y_t([e,t[0],t[1]])})))}var YZt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.visualStyleAccessPath="lineStyle",n.visualDrawType="stroke",n}return Dit(e,t),e.prototype.init=function(e){e.data=e.data||[],XZt(e);var n=this._processFlatCoordsArray(e.data);this._flatCoords=n.flatCoords,this._flatCoordsOffset=n.flatCoordsOffset,n.flatCoords&&(e.data=new Float32Array(n.count)),t.prototype.init.apply(this,arguments)},e.prototype.mergeOption=function(e){if(XZt(e),e.data){var n=this._processFlatCoordsArray(e.data);this._flatCoords=n.flatCoords,this._flatCoordsOffset=n.flatCoordsOffset,n.flatCoords&&(e.data=new Float32Array(n.count))}t.prototype.mergeOption.apply(this,arguments)},e.prototype.appendData=function(t){var e=this._processFlatCoordsArray(t.data);e.flatCoords&&(this._flatCoords?(this._flatCoords=J_t(this._flatCoords,e.flatCoords),this._flatCoordsOffset=J_t(this._flatCoordsOffset,e.flatCoordsOffset)):(this._flatCoords=e.flatCoords,this._flatCoordsOffset=e.flatCoordsOffset),t.data=new Float32Array(e.count)),this.getRawData().appendData(t.data)},e.prototype._getCoordsFromItemModel=function(t){var e=this.getData().getItemModel(t);return e.option instanceof Array?e.option:e.getShallow("coords")},e.prototype.getLineCoordsCount=function(t){return this._flatCoordsOffset?this._flatCoordsOffset[2*t+1]:this._getCoordsFromItemModel(t).length},e.prototype.getLineCoords=function(t,e){if(this._flatCoordsOffset){for(var n=this._flatCoordsOffset[2*t],i=this._flatCoordsOffset[2*t+1],r=0;r<i;r++)e[r]=e[r]||[],e[r][0]=this._flatCoords[n+2*r],e[r][1]=this._flatCoords[n+2*r+1];return i}var o=this._getCoordsFromItemModel(t);for(r=0;r<o.length;r++)e[r]=e[r]||[],e[r][0]=o[r][0],e[r][1]=o[r][1];return o.length},e.prototype._processFlatCoordsArray=function(t){var e=0;if(this._flatCoords&&(e=this._flatCoords.length),"number"==typeof t[0]){for(var n=t.length,i=new HZt(n),r=new qZt(n),o=0,a=0,s=0,l=0;l<n;){s++;var u=t[l++];i[a++]=o+e,i[a++]=u;for(var c=0;c<u;c++){var h=t[l++],d=t[l++];r[o++]=h,r[o++]=d}}return{flatCoordsOffset:new Uint32Array(i.buffer,0,a),flatCoords:r,count:s}}return{flatCoordsOffset:null,flatCoords:null,count:t.length}},e.prototype.getInitialData=function(t,e){var n=new GBt(["value"],this);return n.hasItemOption=!1,n.initData(t.data,[],(function(t,e,i,r){if(t instanceof Array)return NaN;n.hasItemOption=!0;var o=t.value;return null!=o?o instanceof Array?o[r]:o:void 0})),n},e.prototype.formatTooltip=function(t,e,n){var i=this.getData().getItemModel(t),r=i.get("name");if(r)return r;var o=i.get("fromName"),a=i.get("toName"),s=[];return null!=o&&s.push(o),null!=a&&s.push(a),RRt("nameValue",{name:s.join(" > ")})},e.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},e.prototype.getProgressive=function(){var t=this.option.progressive;return null==t?this.option.large?1e4:this.get("progressive"):t},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return null==t?this.option.large?2e4:this.get("progressiveThreshold"):t},e.type="series.lines",e.dependencies=["grid","polar","geo","calendar"],e.defaultOption={coordinateSystem:"geo",zlevel:0,z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},e}(XRt);function KZt(t){return t instanceof Array||(t=[t,t]),t}var ZZt={seriesType:"lines",reset:function(t){var e=KZt(t.get("symbol")),n=KZt(t.get("symbolSize")),i=t.getData();return i.setVisual("fromSymbol",e&&e[0]),i.setVisual("toSymbol",e&&e[1]),i.setVisual("fromSymbolSize",n&&n[0]),i.setVisual("toSymbolSize",n&&n[1]),{dataEach:i.hasItemOption?function(t,e){var n=t.getItemModel(e),i=KZt(n.getShallow("symbol",!0)),r=KZt(n.getShallow("symbolSize",!0));i[0]&&t.setItemVisual(e,"fromSymbol",i[0]),i[1]&&t.setItemVisual(e,"toSymbol",i[1]),r[0]&&t.setItemVisual(e,"fromSymbolSize",r[0]),r[1]&&t.setItemVisual(e,"toSymbolSize",r[1])}:null}}};var JZt=function(){function t(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=b_t();this.canvas=t}return t.prototype.update=function(t,e,n,i,r,o){var a=this._getBrush(),s=this._getGradient(r,"inRange"),l=this._getGradient(r,"outOfRange"),u=this.pointSize+this.blurSize,c=this.canvas,h=c.getContext("2d"),d=t.length;c.width=e,c.height=n;for(var p=0;p<d;++p){var f=t[p],g=f[0],m=f[1],y=i(f[2]);h.globalAlpha=y,h.drawImage(a,g-u,m-u)}if(!c.width||!c.height)return c;for(var v=h.getImageData(0,0,c.width,c.height),x=v.data,b=0,w=x.length,_=this.minOpacity,k=this.maxOpacity-_;b<w;){y=x[b+3]/256;var S=4*Math.floor(255*y);if(y>0){var C=o(y)?s:l;y>0&&(y=y*k+_),x[b++]=C[S],x[b++]=C[S+1],x[b++]=C[S+2],x[b++]=C[S+3]*y*256}else b+=4}return h.putImageData(v,0,0),c},t.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=b_t()),e=this.pointSize+this.blurSize,n=2*e;t.width=n,t.height=n;var i=t.getContext("2d");return i.clearRect(0,0,n,n),i.shadowOffsetX=n,i.shadowBlur=this.blurSize,i.shadowColor="#000",i.beginPath(),i.arc(-e,e,this.pointSize,0,2*Math.PI,!0),i.closePath(),i.fill(),t},t.prototype._getGradient=function(t,e){for(var n=this._gradientPixels,i=n[e]||(n[e]=new Uint8ClampedArray(1024)),r=[0,0,0,0],o=0,a=0;a<256;a++)t[e](a/255,!0,r),i[o++]=r[0],i[o++]=r[1],i[o++]=r[2],i[o++]=r[3];return i},t}();function QZt(t){var e=t.dimensions;return"lng"===e[0]&&"lat"===e[1]}var tJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i;e.eachComponent("visualMap",(function(e){e.eachTargetSeries((function(n){n===t&&(i=e)}))})),this.group.removeAll(),this._incrementalDisplayable=null;var r=t.coordinateSystem;"cartesian2d"===r.type||"calendar"===r.type?this._renderOnCartesianAndCalendar(t,n,0,t.getData().count()):QZt(r)&&this._renderOnGeo(r,t,i,n)},e.prototype.incrementalPrepareRender=function(t,e,n){this.group.removeAll()},e.prototype.incrementalRender=function(t,e,n,i){var r=e.coordinateSystem;r&&(QZt(r)?this.render(e,n,i):this._renderOnCartesianAndCalendar(e,i,t.start,t.end,!0))},e.prototype._renderOnCartesianAndCalendar=function(t,e,n,i,r){var o,a,s,l,u=t.coordinateSystem;if(Fjt(u,"cartesian2d")){var c=u.getAxis("x"),h=u.getAxis("y");o=c.getBandWidth(),a=h.getBandWidth(),s=c.scale.getExtent(),l=h.scale.getExtent()}for(var d=this.group,p=t.getData(),f=t.getModel(["emphasis","itemStyle"]).getItemStyle(),g=t.getModel(["blur","itemStyle"]).getItemStyle(),m=t.getModel(["select","itemStyle"]).getItemStyle(),y=cNt(t),v=t.get(["emphasis","focus"]),x=t.get(["emphasis","blurScope"]),b=Fjt(u,"cartesian2d")?[p.mapDimension("x"),p.mapDimension("y"),p.mapDimension("value")]:[p.mapDimension("time"),p.mapDimension("value")],w=n;w<i;w++){var _=void 0,k=p.getItemVisual(w,"style");if(Fjt(u,"cartesian2d")){var S=p.get(b[0],w),C=p.get(b[1],w);if(isNaN(p.get(b[2],w))||S<s[0]||S>s[1]||C<l[0]||C>l[1])continue;var A=u.dataToPoint([S,C]);_=new mDt({shape:{x:Math.floor(Math.round(A[0])-o/2),y:Math.floor(Math.round(A[1])-a/2),width:Math.ceil(o),height:Math.ceil(a)},style:k})}else{if(isNaN(p.get(b[1],w)))continue;_=new mDt({z2:1,shape:u.dataToRect([p.get(b[0],w)]).contentShape,style:k})}var I=p.getItemModel(w);if(p.hasItemOption){var M=I.getModel("emphasis");f=M.getModel("itemStyle").getItemStyle(),g=I.getModel(["blur","itemStyle"]).getItemStyle(),m=I.getModel(["select","itemStyle"]).getItemStyle(),v=M.get("focus"),x=M.get("blurScope"),y=cNt(I)}var D=t.getRawValue(w),T="-";D&&null!=D[2]&&(T=D[2]+""),uNt(_,y,{labelFetcher:t,labelDataIndex:w,defaultOpacity:k.opacity,defaultText:T}),_.ensureState("emphasis").style=f,_.ensureState("blur").style=g,_.ensureState("select").style=m,uTt(_,v,x),_.incremental=r,r&&(_.states.emphasis.hoverLayer=!0),d.add(_),p.setItemGraphicEl(w,_)}},e.prototype._renderOnGeo=function(t,e,n,i){var r=n.targetVisuals.inRange,o=n.targetVisuals.outOfRange,a=e.getData(),s=this._hmLayer||this._hmLayer||new JZt;s.blurSize=e.get("blurSize"),s.pointSize=e.get("pointSize"),s.minOpacity=e.get("minOpacity"),s.maxOpacity=e.get("maxOpacity");var l=t.getViewRect().clone(),u=t.getRoamTransform();l.applyTransform(u);var c=Math.max(l.x,0),h=Math.max(l.y,0),d=Math.min(l.width+l.x,i.getWidth()),p=Math.min(l.height+l.y,i.getHeight()),f=d-c,g=p-h,m=[a.mapDimension("lng"),a.mapDimension("lat"),a.mapDimension("value")],y=a.mapArray(m,(function(e,n,i){var r=t.dataToPoint([e,n]);return r[0]-=c,r[1]-=h,r.push(i),r})),v=n.getExtent(),x="visualMap.continuous"===n.type?function(t,e){var n=t[1]-t[0];return e=[(e[0]-t[0])/n,(e[1]-t[0])/n],function(t){return t>=e[0]&&t<=e[1]}}(v,n.option.range):function(t,e,n){var i=t[1]-t[0],r=(e=C_t(e,(function(e){return{interval:[(e.interval[0]-t[0])/i,(e.interval[1]-t[0])/i]}}))).length,o=0;return function(t){var i;for(i=o;i<r;i++)if((a=e[i].interval)[0]<=t&&t<=a[1]){o=i;break}if(i===r)for(i=o-1;i>=0;i--){var a;if((a=e[i].interval)[0]<=t&&t<=a[1]){o=i;break}}return i>=0&&i<r&&n[i]}}(v,n.getPieceList(),n.option.selected);s.update(y,f,g,r.color.getNormalizer(),{inRange:r.color.getColorMapper(),outOfRange:o.color.getColorMapper()},x);var b=new uDt({style:{width:f,height:g,x:c,y:h,image:s.canvas},silent:!0});this.group.add(b)},e.type="heatmap",e}(aLt),eJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this,{generateCoord:"value"})},e.prototype.preventIncremental=function(){var t=cFt.get(this.get("coordinateSystem"));if(t&&t.dimensions)return"lng"===t.dimensions[0]&&"lat"===t.dimensions[1]},e.type="series.heatmap",e.dependencies=["grid","geo","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},e}(XRt);var nJt=["itemStyle","borderWidth"],iJt=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],rJt=new $Tt,oJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=this.group,r=t.getData(),o=this._data,a=t.coordinateSystem,s=a.getBaseAxis().isHorizontal(),l=a.master.getRect(),u={ecSize:{width:n.getWidth(),height:n.getHeight()},seriesModel:t,coordSys:a,coordSysExtent:[[l.x,l.x+l.width],[l.y,l.y+l.height]],isHorizontal:s,valueDim:iJt[+s],categoryDim:iJt[1-+s]};return r.diff(o).add((function(t){if(r.hasValue(t)){var e=pJt(r,t),n=aJt(r,t,e,u),o=mJt(r,u,n);r.setItemGraphicEl(t,o),i.add(o),wJt(o,u,n)}})).update((function(t,e){var n=o.getItemGraphicEl(e);if(r.hasValue(t)){var a=pJt(r,t),s=aJt(r,t,a,u),l=vJt(r,s);n&&l!==n.__pictorialShapeStr&&(i.remove(n),r.setItemGraphicEl(t,null),n=null),n?function(t,e,n){var i=n.animationModel,r=n.dataIndex;WEt(t.__pictorialBundle,{x:n.bundlePosition[0],y:n.bundlePosition[1]},i,r),n.symbolRepeat?uJt(t,e,n,!0):cJt(t,e,n,!0);hJt(t,n,!0),dJt(t,e,n,!0)}(n,u,s):n=mJt(r,u,s,!0),r.setItemGraphicEl(t,n),n.__pictorialSymbolMeta=s,i.add(n),wJt(n,u,s)}else i.remove(n)})).remove((function(t){var e=o.getItemGraphicEl(t);e&&yJt(o,t,e.__pictorialSymbolMeta.animationModel,e)})).execute(),this._data=r,this.group},e.prototype.remove=function(t,e){var n=this.group,i=this._data;t.get("animation")?i&&i.eachItemGraphicEl((function(e){yJt(i,IDt(e).dataIndex,t,e)})):n.removeAll()},e.type="pictorialBar",e}(aLt);function aJt(t,e,n,i){var r=t.getItemLayout(e),o=n.get("symbolRepeat"),a=n.get("symbolClip"),s=n.get("symbolPosition")||"start",l=(n.get("symbolRotate")||0)*Math.PI/180||0,u=n.get("symbolPatternSize")||2,c=n.isAnimationEnabled(),h={dataIndex:e,layout:r,itemModel:n,symbolType:t.getItemVisual(e,"symbol")||"circle",style:t.getItemVisual(e,"style"),symbolClip:a,symbolRepeat:o,symbolRepeatDirection:n.get("symbolRepeatDirection"),symbolPatternSize:u,rotation:l,animationModel:c?n:null,hoverScale:c&&n.get(["emphasis","scale"]),z2:n.getShallow("z",!0)||0};!function(t,e,n,i,r){var o,a=i.valueDim,s=t.get("symbolBoundingData"),l=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis()),u=l.toGlobalCoord(l.dataToCoord(0)),c=1-+(n[a.wh]<=0);if(E_t(s)){var h=[sJt(l,s[0])-u,sJt(l,s[1])-u];h[1]<h[0]&&h.reverse(),o=h[c]}else o=null!=s?sJt(l,s)-u:e?i.coordSysExtent[a.index][c]-u:n[a.wh];r.boundingLength=o,e&&(r.repeatCutLength=n[a.wh]);r.pxSign=o>0?1:o<0?-1:0}(n,o,r,i,h),function(t,e,n,i,r,o,a,s,l,u){var c,h=l.valueDim,d=l.categoryDim,p=Math.abs(n[d.wh]),f=t.getItemVisual(e,"symbolSize");c=E_t(f)?f.slice():null==f?["100%","100%"]:[f,f];c[d.index]=dAt(c[d.index],p),c[h.index]=dAt(c[h.index],i?p:Math.abs(o)),u.symbolSize=c,(u.symbolScale=[c[0]/s,c[1]/s])[h.index]*=(l.isHorizontal?-1:1)*a}(t,e,r,o,0,h.boundingLength,h.pxSign,u,i,h),function(t,e,n,i,r){var o=t.get(nJt)||0;o&&(rJt.attr({scaleX:e[0],scaleY:e[1],rotation:n}),rJt.updateTransform(),o/=rJt.getLineScale(),o*=e[i.valueDim.index]);r.valueLineWidth=o}(n,h.symbolScale,l,i,h);var d=h.symbolSize,p=n.get("symbolOffset");return E_t(p)&&(p=[dAt(p[0],d[0]),dAt(p[1],d[1])]),function(t,e,n,i,r,o,a,s,l,u,c,h){var d=c.categoryDim,p=c.valueDim,f=h.pxSign,g=Math.max(e[p.index]+s,0),m=g;if(i){var y=Math.abs(l),v=V_t(t.get("symbolMargin"),"15%")+"",x=!1;v.lastIndexOf("!")===v.length-1&&(x=!0,v=v.slice(0,v.length-1));var b=dAt(v,e[p.index]),w=Math.max(g+2*b,0),_=x?0:2*b,k=IAt(i),S=k?i:_Jt((y+_)/w);w=g+2*(b=(y-S*g)/2/(x?S:S-1)),_=x?0:2*b,k||"fixed"===i||(S=u?_Jt((Math.abs(u)+_)/w):0),m=S*w-_,h.repeatTimes=S,h.symbolMargin=b}var C=f*(m/2),A=h.pathPosition=[];A[d.index]=n[d.wh]/2,A[p.index]="start"===a?C:"end"===a?l-C:l/2,o&&(A[0]+=o[0],A[1]+=o[1]);var I=h.bundlePosition=[];I[d.index]=n[d.xy],I[p.index]=n[p.xy];var M=h.barRectShape=v_t({},n);M[p.wh]=f*Math.max(Math.abs(n[p.wh]),Math.abs(A[p.index]+C)),M[d.wh]=n[d.wh];var D=h.clipShape={};D[d.xy]=-n[d.xy],D[d.wh]=c.ecSize[d.wh],D[p.xy]=0,D[p.wh]=n[p.wh]}(n,d,r,o,0,p,s,h.valueLineWidth,h.boundingLength,h.repeatCutLength,i,h),h}function sJt(t,e){return t.toGlobalCoord(t.dataToCoord(t.scale.parse(e)))}function lJt(t){var e=t.symbolPatternSize,n=U$t(t.symbolType,-e/2,-e/2,e,e);return n.attr({culling:!0}),"image"!==n.type&&n.setStyle({strokeNoScale:!0}),n}function uJt(t,e,n,i){var r=t.__pictorialBundle,o=n.symbolSize,a=n.valueLineWidth,s=n.pathPosition,l=e.valueDim,u=n.repeatTimes||0,c=0,h=o[e.valueDim.index]+a+2*n.symbolMargin;for(xJt(t,(function(t){t.__pictorialAnimationIndex=c,t.__pictorialRepeatTimes=u,c<u?bJt(t,null,f(c),n,i):bJt(t,null,{scaleX:0,scaleY:0},n,i,(function(){r.remove(t)})),c++}));c<u;c++){var d=lJt(n);d.__pictorialAnimationIndex=c,d.__pictorialRepeatTimes=u,r.add(d);var p=f(c);bJt(d,{x:p.x,y:p.y,scaleX:0,scaleY:0},{scaleX:p.scaleX,scaleY:p.scaleY,rotation:p.rotation},n,i)}function f(t){var e=s.slice(),i=n.pxSign,r=t;return("start"===n.symbolRepeatDirection?i>0:i<0)&&(r=u-1-t),e[l.index]=h*(r-u/2+.5)+s[l.index],{x:e[0],y:e[1],scaleX:n.symbolScale[0],scaleY:n.symbolScale[1],rotation:n.rotation}}}function cJt(t,e,n,i){var r=t.__pictorialBundle,o=t.__pictorialMainPath;o?bJt(o,null,{x:n.pathPosition[0],y:n.pathPosition[1],scaleX:n.symbolScale[0],scaleY:n.symbolScale[1],rotation:n.rotation},n,i):(o=t.__pictorialMainPath=lJt(n),r.add(o),bJt(o,{x:n.pathPosition[0],y:n.pathPosition[1],scaleX:0,scaleY:0,rotation:n.rotation},{scaleX:n.symbolScale[0],scaleY:n.symbolScale[1]},n,i))}function hJt(t,e,n){var i=v_t({},e.barRectShape),r=t.__pictorialBarRect;r?bJt(r,null,{shape:i},e,n):(r=t.__pictorialBarRect=new mDt({z2:2,shape:i,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),t.add(r))}function dJt(t,e,n,i){if(n.symbolClip){var r=t.__pictorialClipPath,o=v_t({},n.clipShape),a=e.valueDim,s=n.animationModel,l=n.dataIndex;if(r)WEt(r,{shape:o},s,l);else{o[a.wh]=0,r=new mDt({shape:o}),t.__pictorialBundle.setClipPath(r),t.__pictorialClipPath=r;var u={};u[a.wh]=n.clipShape[a.wh],oNt[i?"updateProps":"initProps"](r,{shape:u},s,l)}}}function pJt(t,e){var n=t.getItemModel(e);return n.getAnimationDelayParams=fJt,n.isAnimationEnabled=gJt,n}function fJt(t){return{index:t.__pictorialAnimationIndex,count:t.__pictorialRepeatTimes}}function gJt(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function mJt(t,e,n,i){var r=new oAt,o=new oAt;return r.add(o),r.__pictorialBundle=o,o.x=n.bundlePosition[0],o.y=n.bundlePosition[1],n.symbolRepeat?uJt(r,e,n):cJt(r,0,n),hJt(r,n,i),dJt(r,e,n,i),r.__pictorialShapeStr=vJt(t,n),r.__pictorialSymbolMeta=n,r}function yJt(t,e,n,i){var r=i.__pictorialBarRect;r&&r.removeTextContent();var o=[];xJt(i,(function(t){o.push(t)})),i.__pictorialMainPath&&o.push(i.__pictorialMainPath),i.__pictorialClipPath&&(n=null),S_t(o,(function(t){UEt(t,{scaleX:0,scaleY:0},n,e,(function(){i.parent&&i.parent.remove(i)}))})),t.setItemGraphicEl(e,null)}function vJt(t,e){return[t.getItemVisual(e.dataIndex,"symbol")||"none",!!e.symbolRepeat,!!e.symbolClip].join(":")}function xJt(t,e,n){S_t(t.__pictorialBundle.children(),(function(i){i!==t.__pictorialBarRect&&e.call(n,i)}))}function bJt(t,e,n,i,r,o){e&&t.attr(e),i.symbolClip&&!r?n&&t.attr(n):n&&oNt[r?"updateProps":"initProps"](t,n,i.animationModel,i.dataIndex,o)}function wJt(t,e,n){var i=n.dataIndex,r=n.itemModel,o=r.getModel("emphasis"),a=o.getModel("itemStyle").getItemStyle(),s=r.getModel(["blur","itemStyle"]).getItemStyle(),l=r.getModel(["select","itemStyle"]).getItemStyle(),u=r.getShallow("cursor"),c=o.get("focus"),h=o.get("blurScope"),d=o.get("scale");xJt(t,(function(t){if(t instanceof uDt){var e=t.style;t.useStyle(v_t({image:e.image,x:e.x,y:e.y,width:e.width,height:e.height},n.style))}else t.useStyle(n.style);var i=t.ensureState("emphasis");i.style=a,d&&(i.scaleX=1.1*t.scaleX,i.scaleY=1.1*t.scaleY),t.ensureState("blur").style=s,t.ensureState("select").style=l,u&&(t.cursor=u),t.z2=n.z2}));var p=e.valueDim.posDesc[+(n.boundingLength>0)];uNt(t.__pictorialBarRect,cNt(r),{labelFetcher:e.seriesModel,labelDataIndex:i,defaultText:cjt(e.seriesModel.getData(),i),inheritColor:n.style.fill,defaultOpacity:n.style.opacity,defaultOutsidePosition:p}),uTt(t,c,h)}function _Jt(t){var e=Math.round(t);return Math.abs(t-e)<1e-4?e:Math.ceil(t)}var kJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.hasSymbolVisual=!0,n.defaultSymbol="roundRect",n}return Dit(e,t),e.prototype.getInitialData=function(e){return e.stack=null,t.prototype.getInitialData.apply(this,arguments)},e.type="series.pictorialBar",e.dependencies=["grid"],e.defaultOption=RNt(Yjt.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",progressive:0,emphasis:{scale:!1},select:{itemStyle:{borderColor:"#212121"}}}),e}(Yjt);var SJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._layers=[],n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=t.getData(),r=this,o=this.group,a=t.getLayerSeries(),s=i.getLayout("layoutInfo"),l=s.rect,u=s.boundaryGap;function c(t){return t.name}o.x=0,o.y=l.y+u[0];var h=new vBt(this._layersSeries||[],a,c,c),d=[];function p(e,n,s){var l=r._layers;if("remove"!==e){for(var u,c,h=[],p=[],f=a[n].indices,g=0;g<f.length;g++){var m=i.getItemLayout(f[g]),y=m.x,v=m.y0,x=m.y;h.push(y,v),p.push(y,v+x),u=i.getItemVisual(f[g],"style")}var b=i.getItemLayout(f[0]),w=t.getModel("label").get("margin"),_=t.getModel("emphasis");if("add"===e){var k=d[n]=new oAt;c=new Tjt({shape:{points:h,stackedOnPoints:p,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),k.add(c),o.add(k),t.isAnimationEnabled()&&c.setClipPath(function(t,e,n){var i=new mDt({shape:{x:t.x-10,y:t.y-10,width:0,height:t.height+20}});return jEt(i,{shape:{x:t.x-50,width:t.width+100,height:t.height+20}},e,n),i}(c.getBoundingRect(),t,(function(){c.removeClipPath()})))}else{k=l[s];c=k.childAt(0),o.add(k),d[n]=k,WEt(c,{shape:{points:h,stackedOnPoints:p}},t)}uNt(c,cNt(t),{labelDataIndex:f[g-1],defaultText:i.getName(f[g-1]),inheritColor:u.fill},{normal:{verticalAlign:"middle"}}),c.setTextConfig({position:null,local:!0});var S=c.getTextContent();S&&(S.x=b.x-w,S.y=b.y0+b.y/2),c.useStyle(u),i.setItemGraphicEl(n,c),pTt(c,t),uTt(c,_.get("focus"),_.get("blurScope"))}else o.remove(l[n])}h.add(D_t(p,this,"add")).update(D_t(p,this,"update")).remove(D_t(p,this,"remove")).execute(),this._layersSeries=a,this._layers=d},e.type="themeRiver",e}(aLt);var CJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.useColorPaletteOnData=!0,n}return Dit(e,t),e.prototype.init=function(e){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new CUt(D_t(this.getData,this),D_t(this.getRawData,this))},e.prototype.fixData=function(t){var e=t.length,n={},i=ZAt(t,(function(t){return n.hasOwnProperty(t[0]+"")||(n[t[0]+""]=-1),t[2]})),r=[];i.buckets.each((function(t,e){r.push({name:e,dataList:t})}));for(var o=r.length,a=0;a<o;++a){for(var s=r[a].name,l=0;l<r[a].dataList.length;++l){var u=r[a].dataList[l][0]+"";n[u]=a}for(var u in n)n.hasOwnProperty(u)&&n[u]!==a&&(n[u]=a,t[e]=[u,0,s],e++)}return t},e.prototype.getInitialData=function(t,e){for(var n=this.getReferringComponents("singleAxis",qAt).models[0].get("type"),i=I_t(t.data,(function(t){return void 0!==t[2]})),r=this.fixData(i||[]),o=[],a=this.nameMap=Z_t(),s=0,l=0;l<r.length;++l)o.push(r[l][2]),a.get(r[l][2])||(a.set(r[l][2],s),s++);var u=XBt(r,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:bBt(n)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}),c=new GBt(u,this);return c.initData(r),c},e.prototype.getLayerSeries=function(){for(var t=this.getData(),e=t.count(),n=[],i=0;i<e;++i)n[i]=i;var r=t.mapDimension("single"),o=ZAt(n,(function(e){return t.get("name",e)})),a=[];return o.buckets.each((function(e,n){e.sort((function(e,n){return t.get(r,e)-t.get(r,n)})),a.push({name:n,indices:e})})),a},e.prototype.getAxisTooltipData=function(t,e,n){E_t(t)||(t=t?[t]:[]);for(var i,r=this.getData(),o=this.getLayerSeries(),a=[],s=o.length,l=0;l<s;++l){for(var u=Number.MAX_VALUE,c=-1,h=o[l].indices.length,d=0;d<h;++d){var p=r.get(t[0],o[l].indices[d]),f=Math.abs(p-e);f<=u&&(i=p,u=f,c=o[l].indices[d])}a.push(c)}return{dataIndices:a,nestestValue:i}},e.prototype.formatTooltip=function(t,e,n){var i=this.getData();return RRt("nameValue",{name:i.getName(t),value:i.get(i.mapDimension("value"),t)})},e.type="series.themeRiver",e.dependencies=["singleAxis"],e.defaultOption={zlevel:0,z:2,coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},e}(XRt);function AJt(t,e){t.eachSeriesByType("themeRiver",(function(t){var e=t.getData(),n=t.coordinateSystem,i={},r=n.getRect();i.rect=r;var o=t.get("boundaryGap"),a=n.getAxis();(i.boundaryGap=o,"horizontal"===a.orient)?(o[0]=dAt(o[0],r.height),o[1]=dAt(o[1],r.height),IJt(e,t,r.height-o[0]-o[1])):(o[0]=dAt(o[0],r.width),o[1]=dAt(o[1],r.width),IJt(e,t,r.width-o[0]-o[1]));e.setLayout("layoutInfo",i)}))}function IJt(t,e,n){if(t.count())for(var i,r=e.coordinateSystem,o=e.getLayerSeries(),a=t.mapDimension("single"),s=t.mapDimension("value"),l=C_t(o,(function(e){return C_t(e.indices,(function(e){var n=r.dataToPoint(t.get(a,e));return n[1]=t.get(s,e),n}))})),u=function(t){for(var e=t.length,n=t[0].length,i=[],r=[],o=0,a=0;a<n;++a){for(var s=0,l=0;l<e;++l)s+=t[l][a][1];s>o&&(o=s),i.push(s)}for(var u=0;u<n;++u)r[u]=(o-i[u])/2;o=0;for(var c=0;c<n;++c){var h=i[c]+r[c];h>o&&(o=h)}return{y0:r,max:o}}(l),c=u.y0,h=n/u.max,d=o.length,p=o[0].indices.length,f=0;f<p;++f){i=c[f]*h,t.setItemLayout(o[0].indices[f],{layerIndex:0,x:l[0][f][0],y0:i,y:l[0][f][1]*h});for(var g=1;g<d;++g)i+=l[g-1][f][1]*h,t.setItemLayout(o[g].indices[f],{layerIndex:g,x:l[g][f][0],y0:i,y:l[g][f][1]*h})}}var MJt=function(t){function e(e,n,i,r){var o=t.call(this)||this;o.z2=2,o.textConfig={inside:!0},IDt(o).seriesIndex=n.seriesIndex;var a=new xDt({z2:4,silent:e.getModel().get(["label","silent"])});return o.setTextContent(a),o.updateData(!0,e,n,i,r),o}return Dit(e,t),e.prototype.updateData=function(t,e,n,i,r){this.node=e,e.piece=this,n=n||this._seriesModel,i=i||this._ecModel;var o=this;IDt(o).dataIndex=e.dataIndex;var a=e.getModel(),s=a.getModel("emphasis"),l=e.getLayout(),u=v_t({},l);u.label=null;var c=e.getVisual("style");c.lineJoin="bevel";var h=e.getVisual("decal");h&&(c.decal=pPt(h,r));var d=wUt(a.getModel("itemStyle"),u);v_t(u,d),S_t(EDt,(function(t){var e=o.ensureState(t),n=a.getModel([t,"itemStyle"]);e.style=n.getItemStyle();var i=wUt(n,u);i&&(e.shape=i)})),t?(o.setShape(u),o.shape.r=l.r0,WEt(o,{shape:{r:l.r}},n,e.dataIndex)):WEt(o,{shape:u},n),o.useStyle(c),this._updateLabel(n);var p=a.getShallow("cursor");p&&o.attr("cursor",p),this._seriesModel=n||this._seriesModel,this._ecModel=i||this._ecModel;var f=s.get("focus");uTt(this,"ancestor"===f?e.getAncestorsIndices():"descendant"===f?e.getDescendantIndices():f,s.get("blurScope"))},e.prototype._updateLabel=function(t){var e=this,n=this.node.getModel(),i=n.getModel("label"),r=this.node.getLayout(),o=r.endAngle-r.startAngle,a=(r.startAngle+r.endAngle)/2,s=Math.cos(a),l=Math.sin(a),u=this,c=u.getTextContent(),h=this.node.dataIndex,d=i.get("minAngle")/180*Math.PI,p=i.get("show")&&!(null!=d&&Math.abs(o)<d);function f(t,e){var n=t.get(e);return null==n?i.get(e):n}c.ignore=!p,S_t(NDt,(function(i){var o="normal"===i?n.getModel("label"):n.getModel([i,"label"]),d="normal"===i,p=d?c:c.ensureState(i),g=t.getFormattedLabel(h,i);d&&(g=g||e.node.name),p.style=hNt(o,{},null,"normal"!==i,!0),g&&(p.style.text=g);var m=o.get("show");null==m||d||(p.ignore=!m);var y,v=f(o,"position"),x=d?u:u.states[i],b=x.style.fill;x.textConfig={outsideFill:"inherit"===o.get("color")?b:null,inside:"outside"!==v};var w=f(o,"distance")||0,_=f(o,"align");"outside"===v?(y=r.r+w,_=a>Math.PI/2?"right":"left"):_&&"center"!==_?"left"===_?(y=r.r0+w,a>Math.PI/2&&(_="right")):"right"===_&&(y=r.r-w,a>Math.PI/2&&(_="left")):(y=(r.r+r.r0)/2,_="center"),p.style.align=_,p.style.verticalAlign=f(o,"verticalAlign")||"middle",p.x=y*s+r.cx,p.y=y*l+r.cy;var k=f(o,"rotate"),S=0;"radial"===k?(S=-a)<-Math.PI/2&&(S+=Math.PI):"tangential"===k?(S=Math.PI/2-a)>Math.PI/2?S-=Math.PI:S<-Math.PI/2&&(S+=Math.PI):"number"==typeof k&&(S=k*Math.PI/180),p.rotation=S})),c.dirtyStyle()},e}(tEt);var DJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n,i){var r=this;this.seriesModel=t,this.api=n,this.ecModel=e;var o=t.getData(),a=o.tree.root,s=t.getViewRoot(),l=this.group,u=t.get("renderLabelForZeroData"),c=[];s.eachNode((function(t){c.push(t)}));var h,d,p=this._oldChildren||[];!function(i,r){if(0===i.length&&0===r.length)return;function s(t){return t.getId()}function c(s,c){!function(i,r){u||!i||i.getValue()||(i=null);if(i!==a&&r!==a)if(r&&r.piece)i?(r.piece.updateData(!1,i,t,e,n),o.setItemGraphicEl(i.dataIndex,r.piece)):function(t){if(!t)return;t.piece&&(l.remove(t.piece),t.piece=null)}(r);else if(i){var s=new MJt(i,t,e,n);l.add(s),o.setItemGraphicEl(i.dataIndex,s)}}(null==s?null:i[s],null==c?null:r[c])}new vBt(r,i,s,s).add(c).update(c).remove(T_t(c,null)).execute()}(c,p),h=a,(d=s).depth>0?(r.virtualPiece?r.virtualPiece.updateData(!1,h,t,e,n):(r.virtualPiece=new MJt(h,t,e,n),l.add(r.virtualPiece)),d.piece.off("click"),r.virtualPiece.on("click",(function(t){r._rootToNode(d.parentNode)}))):r.virtualPiece&&(l.remove(r.virtualPiece),r.virtualPiece=null),this._initEvents(),this._oldChildren=c},e.prototype._initEvents=function(){var t=this;this.group.off("click"),this.group.on("click",(function(e){var n=!1;t.seriesModel.getViewRoot().eachNode((function(i){if(!n&&i.piece&&i.piece===e.target){var r=i.getModel().get("nodeClick");if("rootToNode"===r)t._rootToNode(i);else if("link"===r){var o=i.getModel(),a=o.get("link");if(a)wOt(a,o.get("target",!0)||"_blank")}n=!0}}))}))},e.prototype._rootToNode=function(t){t!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:"sunburstRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t})},e.prototype.containPoint=function(t,e){var n=e.getData().getItemLayout(0);if(n){var i=t[0]-n.cx,r=t[1]-n.cy,o=Math.sqrt(i*i+r*r);return o<=n.r&&o>=n.r0}},e.type="sunburst",e}(aLt),TJt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.ignoreStyleOnData=!0,n}return Dit(e,t),e.prototype.getInitialData=function(t,e){var n={name:t.name,children:t.data};EJt(n);var i=C_t(t.levels||[],(function(t){return new NNt(t,this,e)}),this),r=ZHt.createTree(n,this,(function(t){t.wrapMethod("getItemModel",(function(t,e){var n=r.getNodeByDataIndex(e),o=i[n.depth];return o&&(t.parentModel=o),t}))}));return r.data},e.prototype.optionUpdated=function(){this.resetViewRoot()},e.prototype.getDataParams=function(e){var n=t.prototype.getDataParams.apply(this,arguments),i=this.getData().tree.getNodeByDataIndex(e);return n.treePathInfo=eqt(i,this),n},e.prototype.getViewRoot=function(){return this._viewRoot},e.prototype.resetViewRoot=function(t){t?this._viewRoot=t:t=this._viewRoot;var e=this.getRawData().tree.root;t&&(t===e||e.contains(t))||(this._viewRoot=e)},e.prototype.enableAriaDecal=function(){lqt(this)},e.type="series.sunburst",e.defaultOption={zlevel:0,z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],levels:[],sort:"desc"},e}(XRt);function EJt(t){var e=0;S_t(t.children,(function(t){EJt(t);var n=t.value;E_t(n)&&(n=n[0]),e+=n}));var n=t.value;E_t(n)&&(n=n[0]),(null==n||isNaN(n))&&(n=e),n<0&&(n=0),E_t(t.value)?t.value[0]=n:t.value=n}var NJt=Math.PI/180;function OJt(t,e,n){e.eachSeriesByType(t,(function(t){var e=t.get("center"),i=t.get("radius");E_t(i)||(i=[0,i]),E_t(e)||(e=[e,e]);var r=n.getWidth(),o=n.getHeight(),a=Math.min(r,o),s=dAt(e[0],r),l=dAt(e[1],o),u=dAt(i[0],a/2),c=dAt(i[1],a/2),h=-t.get("startAngle")*NJt,d=t.get("minAngle")*NJt,p=t.getData().tree.root,f=t.getViewRoot(),g=f.depth,m=t.get("sort");null!=m&&FJt(f,m);var y=0;S_t(f.children,(function(t){!isNaN(t.getValue())&&y++}));var v=f.getValue(),x=Math.PI/(v||y)*2,b=f.depth>0,w=f.height-(b?-1:1),_=(c-u)/(w||1),k=t.get("clockwise"),S=t.get("stillShowZeroSum"),C=k?1:-1,A=function(t,e){if(t){var n=e;if(t!==p){var i=t.getValue(),r=0===v&&S?x:i*x;r<d&&(r=d),n=e+C*r;var o=t.depth-g-(b?-1:1),c=u+_*o,h=u+_*(o+1),f=t.getModel();null!=f.get("r0")&&(c=dAt(f.get("r0"),a/2)),null!=f.get("r")&&(h=dAt(f.get("r"),a/2)),t.setLayout({angle:r,startAngle:e,endAngle:n,clockwise:k,cx:s,cy:l,r0:c,r:h})}if(t.children&&t.children.length){var m=0;S_t(t.children,(function(t){m+=A(t,e+m)}))}return n-e}};if(b){var I=u,M=u+_,D=2*Math.PI;p.setLayout({angle:D,startAngle:h,endAngle:h+D,clockwise:k,cx:s,cy:l,r0:I,r:M})}A(f,h)}))}function FJt(t,e){var n=t.children||[];t.children=function(t,e){if("function"==typeof e){var n=C_t(t,(function(t,e){var n=t.getValue();return{params:{depth:t.depth,height:t.height,dataIndex:t.dataIndex,getValue:function(){return n}},index:e}}));return n.sort((function(t,n){return e(t.params,n.params)})),C_t(n,(function(e){return t[e.index]}))}var i="asc"===e;return t.sort((function(t,e){var n=(t.getValue()-e.getValue())*(i?1:-1);return 0===n?(t.dataIndex-e.dataIndex)*(i?-1:1):n}))}(n,e),n.length&&S_t(t.children,(function(t){FJt(t,e)}))}function RJt(t){var e={};t.eachSeriesByType("sunburst",(function(t){var n=t.getData(),i=n.tree;i.eachNode((function(r){var o=r.getModel().getModel("itemStyle").getItemStyle();o.fill||(o.fill=function(t,n,i){for(var r=t;r&&r.depth>1;)r=r.parentNode;var o=n.getColorFromPalette(r.name||r.dataIndex+"",e);return t.depth>1&&"string"==typeof o&&(o=SSt(o,(t.depth-1)/(i-1)*.5)),o}(r,t,i.root.height)),v_t(n.ensureUniqueItemVisual(r.dataIndex,"style"),o)}))}))}function LJt(t,e){return e=e||[0,0],C_t(["x","y"],(function(n,i){var r=this.getAxis(n),o=e[i],a=t[i]/2;return"category"===r.type?r.getBandWidth():Math.abs(r.dataToCoord(o-a)-r.dataToCoord(o+a))}),this)}function $Jt(t,e){return e=e||[0,0],C_t([0,1],(function(n){var i=e[n],r=t[n]/2,o=[],a=[];return o[n]=i-r,a[n]=i+r,o[1-n]=a[1-n]=e[1-n],Math.abs(this.dataToPoint(o)[n]-this.dataToPoint(a)[n])}),this)}function PJt(t,e){var n=this.getAxis(),i=e instanceof Array?e[0]:e,r=(t instanceof Array?t[0]:t)/2;return"category"===n.type?n.getBandWidth():Math.abs(n.dataToCoord(i-r)-n.dataToCoord(i+r))}function zJt(t,e){return e=e||[0,0],C_t(["Radius","Angle"],(function(n,i){var r=this["get"+n+"Axis"](),o=e[i],a=t[i]/2,s="category"===r.type?r.getBandWidth():Math.abs(r.dataToCoord(o-a)-r.dataToCoord(o+a));return"Angle"===n&&(s=s*Math.PI/180),s}),this)}function BJt(t,e,n,i){return t&&(t.legacy||!1!==t.legacy&&!n&&!i&&"tspan"!==e&&("text"===e||tkt(t,"text")))}function VJt(t,e,n){var i,r,o,a=t;if("text"===e)o=a;else{o={},tkt(a,"text")&&(o.text=a.text),tkt(a,"rich")&&(o.rich=a.rich),tkt(a,"textFill")&&(o.fill=a.textFill),tkt(a,"textStroke")&&(o.stroke=a.textStroke),r={type:"text",style:o,silent:!0},i={};var s=tkt(a,"textPosition");n?i.position=s?a.textPosition:"inside":s&&(i.position=a.textPosition),tkt(a,"textPosition")&&(i.position=a.textPosition),tkt(a,"textOffset")&&(i.offset=a.textOffset),tkt(a,"textRotation")&&(i.rotation=a.textRotation),tkt(a,"textDistance")&&(i.distance=a.textDistance)}return WJt(o,t),S_t(o.rich,(function(t){WJt(t,t)})),{textConfig:i,textContent:r}}function WJt(t,e){e&&(e.font=e.textFont||e.font,tkt(e,"textStrokeWidth")&&(t.lineWidth=e.textStrokeWidth),tkt(e,"textAlign")&&(t.align=e.textAlign),tkt(e,"textVerticalAlign")&&(t.verticalAlign=e.textVerticalAlign),tkt(e,"textLineHeight")&&(t.lineHeight=e.textLineHeight),tkt(e,"textWidth")&&(t.width=e.textWidth),tkt(e,"textHeight")&&(t.height=e.textHeight),tkt(e,"textBackgroundColor")&&(t.backgroundColor=e.textBackgroundColor),tkt(e,"textPadding")&&(t.padding=e.textPadding),tkt(e,"textBorderColor")&&(t.borderColor=e.textBorderColor),tkt(e,"textBorderWidth")&&(t.borderWidth=e.textBorderWidth),tkt(e,"textBorderRadius")&&(t.borderRadius=e.textBorderRadius),tkt(e,"textBoxShadowColor")&&(t.shadowColor=e.textBoxShadowColor),tkt(e,"textBoxShadowBlur")&&(t.shadowBlur=e.textBoxShadowBlur),tkt(e,"textBoxShadowOffsetX")&&(t.shadowOffsetX=e.textBoxShadowOffsetX),tkt(e,"textBoxShadowOffsetY")&&(t.shadowOffsetY=e.textBoxShadowOffsetY))}function jJt(t,e,n){var i=t;i.textPosition=i.textPosition||n.position||"inside",null!=n.offset&&(i.textOffset=n.offset),null!=n.rotation&&(i.textRotation=n.rotation),null!=n.distance&&(i.textDistance=n.distance);var r=i.textPosition.indexOf("inside")>=0,o=t.fill||"#000";UJt(i,e);var a=null==i.textFill;return r?a&&(i.textFill=n.insideFill||"#fff",!i.textStroke&&n.insideStroke&&(i.textStroke=n.insideStroke),!i.textStroke&&(i.textStroke=o),null==i.textStrokeWidth&&(i.textStrokeWidth=2)):(a&&(i.textFill=t.fill||n.outsideFill||"#000"),!i.textStroke&&n.outsideStroke&&(i.textStroke=n.outsideStroke)),i.text=e.text,i.rich=e.rich,S_t(e.rich,(function(t){UJt(t,t)})),i}function UJt(t,e){e&&(tkt(e,"fill")&&(t.textFill=e.fill),tkt(e,"stroke")&&(t.textStroke=e.fill),tkt(e,"lineWidth")&&(t.textStrokeWidth=e.lineWidth),tkt(e,"font")&&(t.font=e.font),tkt(e,"fontStyle")&&(t.fontStyle=e.fontStyle),tkt(e,"fontWeight")&&(t.fontWeight=e.fontWeight),tkt(e,"fontSize")&&(t.fontSize=e.fontSize),tkt(e,"fontFamily")&&(t.fontFamily=e.fontFamily),tkt(e,"align")&&(t.textAlign=e.align),tkt(e,"verticalAlign")&&(t.textVerticalAlign=e.verticalAlign),tkt(e,"lineHeight")&&(t.textLineHeight=e.lineHeight),tkt(e,"width")&&(t.textWidth=e.width),tkt(e,"height")&&(t.textHeight=e.height),tkt(e,"backgroundColor")&&(t.textBackgroundColor=e.backgroundColor),tkt(e,"padding")&&(t.textPadding=e.padding),tkt(e,"borderColor")&&(t.textBorderColor=e.borderColor),tkt(e,"borderWidth")&&(t.textBorderWidth=e.borderWidth),tkt(e,"borderRadius")&&(t.textBorderRadius=e.borderRadius),tkt(e,"shadowColor")&&(t.textBoxShadowColor=e.shadowColor),tkt(e,"shadowBlur")&&(t.textBoxShadowBlur=e.shadowBlur),tkt(e,"shadowOffsetX")&&(t.textBoxShadowOffsetX=e.shadowOffsetX),tkt(e,"shadowOffsetY")&&(t.textBoxShadowOffsetY=e.shadowOffsetY),tkt(e,"textShadowColor")&&(t.textShadowColor=e.textShadowColor),tkt(e,"textShadowBlur")&&(t.textShadowBlur=e.textShadowBlur),tkt(e,"textShadowOffsetX")&&(t.textShadowOffsetX=e.textShadowOffsetX),tkt(e,"textShadowOffsetY")&&(t.textShadowOffsetY=e.textShadowOffsetY))}var GJt=PMt.CMD,HJt=2*Math.PI,qJt=["x","y"],XJt=["width","height"],YJt=[];function KJt(t,e){return Math.abs(t-e)<1e-5}function ZJt(t){var e,n,i,r,o,a,s,l,u,c,h,d,p,f,g,m,y,v,x,b,w,_,k,S,C=t.data,A=t.len(),I=[],M=0,D=0,T=0,E=0;function N(t,n){e&&e.length>2&&I.push(e),e=[t,n]}function O(t,n,i,r){KJt(t,i)&&KJt(n,r)||e.push(t,n,i,r,i,r)}for(var F=0;F<A;){var R=C[F++],L=1===F;switch(L&&(T=M=C[F],E=D=C[F+1],R!==GJt.L&&R!==GJt.C&&R!==GJt.Q||(e=[T,E])),R){case GJt.M:M=T=C[F++],D=E=C[F++],N(T,E);break;case GJt.L:O(M,D,n=C[F++],i=C[F++]),M=n,D=i;break;case GJt.C:e.push(C[F++],C[F++],C[F++],C[F++],M=C[F++],D=C[F++]);break;case GJt.Q:n=C[F++],i=C[F++],r=C[F++],o=C[F++],e.push(M+2/3*(n-M),D+2/3*(i-D),r+2/3*(n-r),o+2/3*(i-o),r,o),M=r,D=o;break;case GJt.A:var $=C[F++],P=C[F++],z=C[F++],B=C[F++],V=C[F++],W=C[F++]+V;F+=1;var j=!C[F++];n=Math.cos(V)*z+$,i=Math.sin(V)*B+P,L?N(T=n,E=i):O(M,D,n,i),M=Math.cos(W)*z+$,D=Math.sin(W)*B+P;for(var U=(j?-1:1)*Math.PI/2,G=V;j?G>W:G<W;G+=U){var H=j?Math.max(G+U,W):Math.min(G+U,W);a=G,s=H,l=$,u=P,c=z,h=B,d=void 0,p=void 0,f=void 0,g=void 0,m=void 0,y=void 0,v=void 0,x=void 0,b=void 0,w=void 0,_=void 0,k=void 0,S=void 0,d=Math.abs(s-a),p=4*Math.tan(d/4)/3,f=s<a?-1:1,g=Math.cos(a),m=Math.sin(a),y=Math.cos(s),v=Math.sin(s),x=g*c+l,b=m*h+u,w=y*c+l,_=v*h+u,k=c*p*f,S=h*p*f,e.push(x-k*m,b+S*g,w+k*v,_-S*y,w,_)}break;case GJt.R:T=M=C[F++],E=D=C[F++],n=T+C[F++],i=E+C[F++],N(n,E),O(n,E,n,i),O(n,i,T,i),O(T,i,T,E),O(T,E,n,E);break;case GJt.Z:e&&O(M,D,T,E),M=T,D=E}}return e&&e.length>2&&I.push(e),I}function JJt(t,e){var n=t.length,i=e.length;if(n===i)return[t,e];for(var r=n<i?t:e,o=Math.min(n,i),a=Math.abs(i-n)/6,s=(o-2)/6,l=Math.ceil(a/s)+1,u=[r[0],r[1]],c=a,h=[],d=[],p=2;p<o;){var f=r[p-2],g=r[p-1],m=r[p++],y=r[p++],v=r[p++],x=r[p++],b=r[p++],w=r[p++];if(c<=0)u.push(m,y,v,x,b,w);else{for(var _=Math.min(c,l-1)+1,k=1;k<=_;k++){var S=k/_;YIt(f,m,v,b,S,h),YIt(g,y,x,w,S,d),f=h[3],g=d[3],u.push(h[1],d[1],h[2],d[2],f,g),m=h[5],y=d[5],v=h[6],x=d[6]}c-=_-1}}return r===t?[u,e]:[t,u]}function QJt(t,e){for(var n=t.length,i=t[n-2],r=t[n-1],o=[],a=0;a<e.length;)o[a++]=i,o[a++]=r;return o}function tQt(t){for(var e=0,n=0,i=0,r=t.length,o=0,a=r-2;o<r;a=o,o+=2){var s=t[a],l=t[a+1],u=t[o],c=t[o+1],h=s*c-u*l;e+=h,n+=(s+u)*h,i+=(l+c)*h}return 0===e?[t[0]||0,t[1]||0]:[n/e/3,i/e/3,e]}function eQt(t,e,n,i){for(var r=(t.length-2)/6,o=1/0,a=0,s=t.length,l=s-2,u=0;u<r;u++){for(var c=6*u,h=0,d=0;d<s;d+=2){var p=0===d?c:(c+d-2)%l+2,f=t[p]-n[0],g=t[p+1]-n[1],m=e[d]-i[0]-f,y=e[d+1]-i[1]-g;h+=m*m+y*y}h<o&&(o=h,a=u)}return a}function nQt(t){for(var e=[],n=t.length,i=0;i<n;i+=2)e[i]=t[n-i-2],e[i+1]=t[n-i-1];return e}function iQt(t,e,n){var i,r;if(!t||!e)return e;!t.path&&t.createPathProxy(),(i=t.path).beginPath(),t.buildPath(i,t.shape),!e.path&&e.createPathProxy(),(r=e.path)===i&&(r=new PMt(!1)),r.beginPath(),aQt(e)?e.__oldBuildPath(r,e.shape):e.buildPath(r,e.shape);var o=function(t,e){for(var n,i,r,o=[],a=[],s=0;s<Math.max(t.length,e.length);s++){var l=t[s],u=e[s],c=void 0,h=void 0;l?u?(i=c=(n=JJt(l,u))[0],r=h=n[1]):(h=QJt(r||l,l),c=l):(c=QJt(i||u,u),h=u),o.push(c),a.push(h)}return[o,a]}(ZJt(i),ZJt(r)),a=function(t,e,n,i){for(var r,o=[],a=0;a<t.length;a++){var s=t[a],l=e[a],u=tQt(s),c=tQt(l);null==r&&(r=u[2]<0!=c[2]<0);var h=[],d=[],p=0,f=1/0,g=[],m=s.length;r&&(s=nQt(s));for(var y=6*eQt(s,l,u,c),v=m-2,x=0;x<v;x+=2){var b=(y+x)%v+2;h[x+2]=s[b]-u[0],h[x+3]=s[b+1]-u[1]}if(h[0]=s[y]-u[0],h[1]=s[y+1]-u[1],n>0)for(var w=i/n,_=-i/2;_<=i/2;_+=w){var k=Math.sin(_),S=Math.cos(_),C=0;for(x=0;x<s.length;x+=2){var A=h[x],I=h[x+1],M=l[x]-c[0],D=l[x+1]-c[1],T=M*S-D*k,E=M*k+D*S;g[x]=T,g[x+1]=E;var N=T-A,O=E-I;C+=N*N+O*O}if(C<f){f=C,p=_;for(var F=0;F<g.length;F++)d[F]=g[F]}}else for(var R=0;R<m;R+=2)d[R]=l[R]-c[0],d[R+1]=l[R+1]-c[1];o.push({from:h,to:d,fromCp:u,toCp:c,rotation:-p})}return o}(o[0],o[1],10,Math.PI);!function(t,e,n){if(aQt(t))return void oQt(t,e,n);var i=t;i.__oldBuildPath=i.buildPath,i.buildPath=rQt,oQt(i,e,n)}(e,a,0);var s=n&&n.done,l=n&&n.aborted,u=n&&n.during;return e.animateTo({__morphT:1},x_t({during:function(t){e.dirtyShape(),u&&u(t)},done:function(){var t;aQt(t=e)&&(t.buildPath=t.__oldBuildPath,t.__oldBuildPath=t.__morphingData=null),e.createPathProxy(),e.dirtyShape(),s&&s()},aborted:function(){l&&l()}},n)),e}function rQt(t){for(var e=this.__morphingData,n=this.__morphT,i=1-n,r=[],o=0;o<e.length;o++){var a=e[o],s=a.from,l=a.to,u=a.rotation*n,c=a.fromCp,h=a.toCp,d=Math.sin(u),p=Math.cos(u);fkt(r,c,h,n);for(var f=0;f<s.length;f+=2){var g=s[f],m=s[f+1],y=g*i+l[f]*n,v=m*i+l[f+1]*n;YJt[f]=y*p-v*d+r[0],YJt[f+1]=y*d+v*p+r[1]}for(f=0;f<s.length;)0===f&&t.moveTo(YJt[f++],YJt[f++]),t.bezierCurveTo(YJt[f++],YJt[f++],YJt[f++],YJt[f++],YJt[f++],YJt[f++])}}function oQt(t,e,n){t.__morphingData=e,t.__morphT=n}function aQt(t){return null!=t.__oldBuildPath}function sQt(t){return!!t.__combiningSubList}function lQt(t,e,n,i){for(var r=[],o=0,a=0;a<t.length;a++){var s=t[a];if(sQt(s)){for(var l=s.__combiningSubList,u=0;u<l.length;u++)r.push(l[u]);o+=l.length}else r.push(s),o++}if(o){var c=n?n.dividingMethod:null,h=fQt(e,o,c);H_t(h.length===o);var d=n&&n.done,p=n&&n.aborted,f=n&&n.during,g=0,m=!1,y=x_t({during:function(t){f&&f(t)},done:function(){++g===h.length&&(!function(t){if(!sQt(t))return;var e=t;uQt(e,null),e.addSelfToZr=e.__oldAddSelfToZr,e.removeSelfFromZr=e.__oldRemoveSelfFromZr,e.buildPath=e.__oldBuildPath,e.childrenRef=e.__combiningSubList=e.__oldAddSelfToZr=e.__oldRemoveSelfFromZr=e.__oldBuildPath=null}(e),d&&d())},aborted:function(){m||(m=!0,p&&p())}},n);for(a=0;a<o;a++){var v=r[a],x=h[a];i&&i(e,x,!0),iQt(v,x,y)}return function(t,e){if(sQt(t))return void uQt(t,e);var n=t;uQt(n,e),n.__oldAddSelfToZr=t.addSelfToZr,n.__oldRemoveSelfFromZr=t.removeSelfFromZr,n.addSelfToZr=cQt,n.removeSelfFromZr=dQt,n.__oldBuildPath=n.buildPath,n.buildPath=ekt,n.childrenRef=pQt}(e,h),{fromIndividuals:r,toIndividuals:h,count:o}}}function uQt(t,e){if(t.__combiningSubList!==e){if(hQt(t,"removeSelfFromZr"),t.__combiningSubList=e,e)for(var n=0;n<e.length;n++)e[n].parent=t;hQt(t,"addSelfToZr")}}function cQt(t){this.__oldAddSelfToZr(t),hQt(this,"addSelfToZr")}function hQt(t,e){var n=t.__combiningSubList,i=t.__zr;if(n&&i)for(var r=0;r<n.length;r++){n[r][e](i)}}function dQt(t){this.__oldRemoveSelfFromZr(t);for(var e=this.__combiningSubList,n=0;n<e.length;n++){e[n].removeSelfFromZr(t)}}function pQt(){return this.__combiningSubList}function fQt(t,e,n){return"duplicate"===n?gQt(t,e):function(t,e){var n=[];if(e<=0)return n;if(1===e)return gQt(t,e);if(t instanceof mDt)for(var i=(h=t.shape).height>h.width?1:0,r=XJt[i],o=qJt[i],a=h[r]/e,s=h[o],l=0;l<e;l++,s+=a){var u={x:h.x,y:h.y,width:h.width,height:h.height};u[o]=s,u[r]=l<e-1?a:h[o]+h[r]-s;var c=new mDt({shape:u});n.push(c)}else{if(!(t instanceof tEt))return gQt(t,e);var h,d=(h=t.shape).clockwise,p=h.startAngle,f=h.endAngle,g=(function(t,e,n){return e+HJt*Math[n?"ceil":"floor"]((t-e)/HJt)}(p,h.endAngle,d)-p)/e,m=p;for(l=0;l<e;l++,m+=g){c=new tEt({shape:{cx:h.cx,cy:h.cy,r:h.r,r0:h.r0,clockwise:d,startAngle:m,endAngle:l===e-1?f:m+g}});n.push(c)}}return n}(t,e)}function gQt(t,e){var n=[];if(e<=0)return n;for(var i=t.constructor,r=0;r<e;r++){var o=new i({shape:g_t(t.shape)});n.push(o)}return n}var mQt=jAt();M_t({x:1,y:1,scaleX:1,scaleY:1,originX:1,originY:1,rotation:1}).join(", ");var yQt={color:"fill",borderColor:"stroke"},vQt={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1},xQt="normal",bQt=["normal","emphasis","blur","select"],wQt={normal:["itemStyle"],emphasis:["emphasis","itemStyle"],blur:["blur","itemStyle"],select:["select","itemStyle"]},_Qt={normal:["label"],emphasis:["emphasis","label"],blur:["blur","label"],select:["select","label"]},kQt={normal:{},emphasis:{},blur:{},select:{}},SQt={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]},CQt=new MCt,AQt={cartesian2d:function(t){var e=t.master.getRect();return{coordSys:{type:"cartesian2d",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(e){return t.dataToPoint(e)},size:D_t(LJt,t)}}},geo:function(t){var e=t.getBoundingRect();return{coordSys:{type:"geo",x:e.x,y:e.y,width:e.width,height:e.height,zoom:t.getZoom()},api:{coord:function(e){return t.dataToPoint(e)},size:D_t($Jt,t)}}},singleAxis:function(t){var e=t.getRect();return{coordSys:{type:"singleAxis",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(e){return t.dataToPoint(e)},size:D_t(PJt,t)}}},polar:function(t){var e=t.getRadiusAxis(),n=t.getAngleAxis(),i=e.getExtent();return i[0]>i[1]&&i.reverse(),{coordSys:{type:"polar",cx:t.cx,cy:t.cy,r:i[1],r0:i[0]},api:{coord:function(i){var r=e.dataToRadius(i[0]),o=n.dataToAngle(i[1]),a=t.coordToPoint([r,o]);return a.push(r,o*Math.PI/180),a},size:D_t(zJt,t)}}},calendar:function(t){var e=t.getRect(),n=t.getRangeInfo();return{coordSys:{type:"calendar",x:e.x,y:e.y,width:e.width,height:e.height,cellWidth:t.getCellWidth(),cellHeight:t.getCellHeight(),rangeInfo:{start:n.start,end:n.end,weeks:n.weeks,dayCount:n.allDay}},api:{coord:function(e,n){return t.dataToPoint(e,n)}}}}},IQt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",!0),this.currentZ=this.get("z",!0)},e.prototype.getInitialData=function(t,e){return tVt(this.getSource(),this)},e.prototype.getDataParams=function(e,n,i){var r=t.prototype.getDataParams.call(this,e,n);return i&&(r.info=mQt(i).info),r},e.type="series.custom",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,clip:!1},e}(XRt),MQt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n,i){var r=this._data,o=t.getData(),a=this.group,s=XQt(t,o,e,n);r||a.removeAll();var l=t.__transientTransitionOpt;if(!l||null!=l.from&&null!=l.to){var u=new u0t(t,l),c=l?"multiple":"oneToOne";new vBt(r?r.getIndices():[],o.getIndices(),DQt(r,c,l&&l.from),DQt(o,c,l&&l.to),null,c).add((function(e){KQt(n,null,e,s(e,i),t,a,o,null)})).remove((function(e){o0t(r.getItemGraphicEl(e),t,a)})).update((function(e,l){u.reset("oneToOne");var c=r.getItemGraphicEl(l);u.findAndAddFrom(c),u.hasFrom()&&(l0t(c,a),c=null),KQt(n,c,e,s(e,i),t,a,o,u),u.applyMorphing()})).updateManyToOne((function(e,l){u.reset("manyToOne");for(var c=0;c<l.length;c++){var h=r.getItemGraphicEl(l[c]);u.findAndAddFrom(h),l0t(h,a)}KQt(n,null,e,s(e,i),t,a,o,u),u.applyMorphing()})).updateOneToMany((function(e,l){u.reset("oneToMany");var c=e.length,h=r.getItemGraphicEl(l);u.findAndAddFrom(h),l0t(h,a);for(var d=0;d<c;d++)KQt(n,null,e[d],s(e[d],i),t,a,o,u);u.applyMorphing()})).execute()}else r&&r.each((function(e){o0t(r.getItemGraphicEl(e),t,a)})),o.each((function(e){KQt(n,null,e,s(e,i),t,a,o,null)}));var h=t.get("clip",!0)?Ojt(t.coordinateSystem,!1,t):null;h?a.setClipPath(h):a.removeClipPath(),this._data=o},e.prototype.incrementalPrepareRender=function(t,e,n){this.group.removeAll(),this._data=null},e.prototype.incrementalRender=function(t,e,n,i,r){var o=e.getData(),a=XQt(e,o,n,i);function s(t){t.isGroup||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}for(var l=t.start;l<t.end;l++){var u=KQt(null,null,l,a(l,r),e,this.group,o,null);u&&u.traverse(s)}},e.prototype.filterForExposedEvent=function(t,e,n,i){var r=e.element;if(null==r||n.name===r)return!0;for(;(n=n.__hostTarget||n.parent)&&n!==this.group;)if(n.name===r)return!0;return!1},e.type="custom",e}(aLt);function DQt(t,e,n){if(t){if("oneToOne"===e)return function(e,n){return t.getId(n)};var i=t.getDimension(n),r=t.getDimensionInfo(i);if(!r){EAt("")}var o=r.ordinalMeta;return function(e,n){var r=t.get(i,n);return o&&(r=o.categories[r]),null==r||B_t(r)?e+"":"_ec_"+r}}}function TQt(t){var e,n=t.type;if("path"===n){var i=t.shape,r=null!=i.width&&null!=i.height?{x:i.x||0,y:i.y||0,width:i.width,height:i.height}:null,o=a0t(i);e=REt(o,null,r,i.layout||"center"),mQt(e).customPathData=o}else if("image"===n)e=new uDt({}),mQt(e).customImagePath=t.style.image;else if("text"===n)e=new xDt({});else if("group"===n)e=new oAt;else{if("compoundPath"===n)throw new Error('"compoundPath" is not supported yet.');var a=FEt(n);if(!a){EAt("")}e=new a}return mQt(e).customGraphicType=n,e.name=t.name,e.z2EmphasisLift=1,e.z2SelectLift=1,e}function EQt(t,e,n,i,r,o,a,s,l,u){var c={},h={},d=e.isGroup?null:e;!n&&FQt("shape",e,null,r,c,l),RQt("shape",r,h),!n&&FQt("extra",e,null,r,c,l),RQt("extra",r,h),!n&&LQt(e,null,r,c,l),function(t,e){GQt(t,e,"position"),GQt(t,e,"scale"),GQt(t,e,"origin"),HQt(t,e,"x"),HQt(t,e,"y"),HQt(t,e,"scaleX"),HQt(t,e,"scaleY"),HQt(t,e,"originX"),HQt(t,e,"originY"),HQt(t,e,"rotation")}(r,h);var p=a&&a.normal.cfg;if(p&&e.setTextConfig(p),"text"===e.type&&o){var f=o;tkt(f,"textFill")&&(f.fill=f.textFill),tkt(f,"textStroke")&&(f.stroke=f.textStroke)}if(o){var g=void 0,m=s0t(e)?o.decal:null;t&&m&&(m.dirty=!0,g=pPt(m,t)),o.__decalPattern=g}return!n&&$Qt(e,null,r,o,c,l),d&&tkt(r,"invisible")&&(d.invisible=r.invisible),n||(NQt(e,h,o),OQt(e,i,r,s,c,l)),tkt(r,"silent")&&(e.silent=r.silent),tkt(r,"ignore")&&(e.ignore=r.ignore),u||tkt(r,"info")&&(mQt(e).info=r.info),o?e.dirty():e.markRedraw(),n?h:null}function NQt(t,e,n){var i=t.isGroup?null:t;if(i&&n){var r=n.__decalPattern,o=void 0;r&&(o=n.decal,n.decal=r),i.useStyle(n),r&&(n.decal=o);for(var a=i.animators,s=0;s<a.length;s++){var l=a[s];"style"===l.targetName&&l.changeTarget(i.style)}}e&&t.attr(e)}function OQt(t,e,n,i,r,o){if(r){var a=n.during;mQt(t).userDuring=a;var s={dataIndex:e,isFrom:!0,during:a?D_t(WQt,{el:t,userDuring:a}):null};o?jEt(t,r,i,s):WEt(t,r,i,s)}}function FQt(t,e,n,i,r,o){var a=i[t];if(a){var s,l=e[t],u=a.enterFrom;if(o&&u){!s&&(s=r[t]={});for(var c=M_t(u),h=0;h<c.length;h++){s[x=c[h]]=u[x]}}if(!o&&l&&(null==n||"shape"!==t))if(a.transition){!s&&(s=r[t]={});var d=NAt(a.transition);for(h=0;h<d.length;h++){var p=l[x=d[h]];s[x]=p}}else if(w_t(i.transition,t)>=0){!s&&(s=r[t]={});var f=M_t(l);for(h=0;h<f.length;h++){p=l[x=f[h]];PQt(a[x],p)&&(s[x]=p)}}var g=a.leaveTo;if(g){var m=zQt(e),y=m[t]||(m[t]={}),v=M_t(g);for(h=0;h<v.length;h++){var x;y[x=v[h]]=g[x]}}}}function RQt(t,e,n){var i=e[t];if(i)for(var r=n[t]={},o=M_t(i),a=0;a<o.length;a++){var s=o[a];r[s]=BSt(i[s])}}function LQt(t,e,n,i,r){var o=n.enterFrom;if(r&&o)for(var a=M_t(o),s=0;s<a.length;s++){i[f=a[s]]=o[f]}if(!r)if(e){var l=function(t,e){if(!t||t===e||t.parent===e.parent)return t;var n=CQt.transform||(CQt.transform=pCt([])),i=t.getComputedTransform();i?fCt(n,i):pCt(n);var r=e.parent;r&&r.getComputedTransform();return CQt.originX=t.originX,CQt.originY=t.originY,CQt.parent=r,CQt.decomposeTransform(),CQt}(e,t);qQt(i,"x",l),qQt(i,"y",l),qQt(i,"scaleX",l),qQt(i,"scaleY",l),qQt(i,"originX",l),qQt(i,"originY",l),qQt(i,"rotation",l)}else if(n.transition){var u=NAt(n.transition);for(s=0;s<u.length;s++){if("style"!==(f=u[s])&&"shape"!==f&&"extra"!==f){var c=t[f];i[f]=c}}}else qQt(i,"x",t),qQt(i,"y",t);var h=n.leaveTo;if(h){var d=zQt(t),p=M_t(h);for(s=0;s<p.length;s++){var f;d[f=p[s]]=h[f]}}}function $Qt(t,e,n,i,r,o){if(i){var a,s=(e||t).style,l=i.enterFrom;if(o&&l){var u=M_t(l);!a&&(a=r.style={});for(var c=0;c<u.length;c++){a[b=u[c]]=l[b]}}if(!o&&s)if(i.transition){var h=NAt(i.transition);!a&&(a=r.style={});for(c=0;c<h.length;c++){var d=s[b=h[c]];a[b]=d}}else if(t.getAnimationStyleProps&&w_t(n.transition,"style")>=0){var p=t.getAnimationStyleProps(),f=p?p.style:null;if(f){!a&&(a=r.style={});var g=M_t(i);for(c=0;c<g.length;c++){if(f[b=g[c]]){d=s[b];a[b]=d}}}}var m=i.leaveTo;if(m){var y=M_t(m),v=zQt(t),x=v.style||(v.style={});for(c=0;c<y.length;c++){var b;x[b=y[c]]=m[b]}}}}function PQt(t,e){return k_t(t)?t!==e:null!=t&&isFinite(t)}function zQt(t){var e=mQt(t);return e.leaveToProps||(e.leaveToProps={})}var BQt={},VQt={setTransform:function(t,e){return BQt.el[t]=e,this},getTransform:function(t){return BQt.el[t]},setShape:function(t,e){return(BQt.el.shape||(BQt.el.shape={}))[t]=e,BQt.isShapeDirty=!0,this},getShape:function(t){var e=BQt.el.shape;if(e)return e[t]},setStyle:function(t,e){var n=BQt.el.style;return n&&(n[t]=e,BQt.isStyleDirty=!0),this},getStyle:function(t){var e=BQt.el.style;if(e)return e[t]},setExtra:function(t,e){return(BQt.el.extra||(BQt.el.extra={}))[t]=e,this},getExtra:function(t){var e=BQt.el.extra;if(e)return e[t]}};function WQt(){var t=this,e=t.el;if(e){var n=mQt(e).userDuring,i=t.userDuring;n===i?(BQt.el=e,BQt.isShapeDirty=!1,BQt.isStyleDirty=!1,i(VQt),BQt.isShapeDirty&&e.dirtyShape&&e.dirtyShape(),BQt.isStyleDirty&&e.dirtyStyle&&e.dirtyStyle()):t.el=t.userDuring=null}}function jQt(t,e,n,i,r,o,a){var s=e.isGroup?null:e,l=r&&r[t].cfg;if(s){var u=s.ensureState(t);if(!1===i){var c=s.getState(t);c&&(c.style=null)}else u.style=i||null;l&&(u.textConfig=l),qDt(s)}}function UQt(t,e,n){var i="normal"===n,r=i?e:t0t(e,n),o=r?r.z2:null;null!=o&&((i?t:t.ensureState(n)).z2=o||0)}function GQt(t,e,n,i){var r=t[n],o=SQt[n];r&&(i?(e[o[0]]=i[o[0]],e[o[1]]=i[o[1]]):(e[o[0]]=r[0],e[o[1]]=r[1]))}function HQt(t,e,n,i){null!=t[n]&&(e[n]=i?i[n]:t[n])}function qQt(t,e,n){n&&(t[e]=n[e])}function XQt(t,e,n,i){var r=t.get("renderItem"),o=t.coordinateSystem,a={};o&&(a=o.prepareCustoms?o.prepareCustoms(o):AQt[o.type](o));for(var s,l,u=x_t({getWidth:i.getWidth,getHeight:i.getHeight,getZr:i.getZr,getDevicePixelRatio:i.getDevicePixelRatio,value:function(t,n){return null==n&&(n=s),e.get(e.getDimension(t||0),n)},style:function(n,i){null==i&&(i=s);var r=e.getItemVisual(i,"style"),o=r&&r.fill,a=r&&r.opacity,l=v(i,"normal").getItemStyle();null!=o&&(l.fill=o),null!=a&&(l.opacity=a);var u={inheritColor:O_t(o)?o:"#000"},c=x(i,"normal"),h=hNt(c,null,u,!1,!0);h.text=c.getShallow("show")?W_t(t.getFormattedLabel(i,"normal"),cjt(e,i)):null;var d=dNt(c,u,!1);return w(n,l),l=jJt(l,h,d),n&&b(l,n),l.legacy=!0,l},ordinalRawValue:function(t,n){null==n&&(n=s);var i=e.getDimensionInfo(t||0);if(!i)return;var r=e.get(i.name,n),o=i&&i.ordinalMeta;return o?o.categories[r]:r},styleEmphasis:function(n,i){null==i&&(i=s);var r=v(i,"emphasis").getItemStyle(),o=x(i,"emphasis"),a=hNt(o,null,null,!0,!0);a.text=o.getShallow("show")?j_t(t.getFormattedLabel(i,"emphasis"),t.getFormattedLabel(i,"normal"),cjt(e,i)):null;var l=dNt(o,null,!0);return w(n,r),r=jJt(r,a,l),n&&b(r,n),r.legacy=!0,r},visual:function(t,n){if(null==n&&(n=s),tkt(yQt,t)){var i=e.getItemVisual(n,"style");return i?i[yQt[t]]:null}if(tkt(vQt,t))return e.getItemVisual(n,t)},barLayout:function(t){if("cartesian2d"===o.type){return function(t){var e=[],n=t.axis,i="axis0";if("category"===n.type){for(var r=n.getBandWidth(),o=0;o<t.count;o++)e.push(x_t({bandWidth:r,axisKey:i,stackId:"__ec_stack_"+o},t));var a=xVt(e),s=[];for(o=0;o<t.count;o++){var l=a.axis0["__ec_stack_"+o];l.offsetCenter=l.offset+l.width/2,s.push(l)}return s}}(x_t({axis:o.getBaseAxis()},t))}},currentSeriesIndices:function(){return n.getCurrentSeriesIndices()},font:function(t){return yNt(t,n)}},a.api||{}),c={context:{},seriesId:t.id,seriesName:t.name,seriesIndex:t.seriesIndex,coordSys:a.coordSys,dataInsideLength:e.count(),encode:YQt(t.getData())},h={},d={},p={},f={},g=0;g<bQt.length;g++){var m=bQt[g];p[m]=t.getModel(wQt[m]),f[m]=t.getModel(_Qt[m])}function y(t){return t===s?l||(l=e.getItemModel(t)):e.getItemModel(t)}function v(t,n){return e.hasItemOption?t===s?h[n]||(h[n]=y(t).getModel(wQt[n])):y(t).getModel(wQt[n]):p[n]}function x(t,n){return e.hasItemOption?t===s?d[n]||(d[n]=y(t).getModel(_Qt[n])):y(t).getModel(_Qt[n]):f[n]}return function(t,n){return s=t,l=null,h={},d={},r&&r(x_t({dataIndexInside:t,dataIndex:e.getRawIndex(t),actionType:n?n.type:null},c),u)};function b(t,e){for(var n in e)tkt(e,n)&&(t[n]=e[n])}function w(t,e){t&&(t.textFill&&(e.textFill=t.textFill),t.textPosition&&(e.textPosition=t.textPosition))}}function YQt(t){var e={};return S_t(t.dimensions,(function(n,i){var r=t.getDimensionInfo(n);if(!r.isExtraCoord){var o=r.coordDim;(e[o]=e[o]||[])[r.coordDimIndex]=i}})),e}function KQt(t,e,n,i,r,o,a,s){if(i)return(e=ZQt(t,e,n,i,r,o,!0,s))&&a.setItemGraphicEl(n,e),e&&uTt(e,i.focus,i.blurScope),e;l0t(e,o)}function ZQt(t,e,n,i,r,o,a,s){var l=-1;e&&JQt(e,i)&&(l=o.childrenRef().indexOf(e),e=null);var u=!e;e?e.clearStates():e=TQt(i);var c=(mQt(e).canMorph=i.morph&&s0t(e))&&s&&s.hasFrom(),h=u&&!c;kQt.normal.cfg=kQt.normal.conOpt=kQt.emphasis.cfg=kQt.emphasis.conOpt=kQt.blur.cfg=kQt.blur.conOpt=kQt.select.cfg=kQt.select.conOpt=null,kQt.isLegacy=!1,function(t,e,n,i,r,o){if(t.isGroup)return;QQt(n,null,o),QQt(n,"emphasis",o);var a=o.normal.conOpt,s=o.emphasis.conOpt,l=o.blur.conOpt,u=o.select.conOpt;if(null!=a||null!=s||null!=u||null!=l){var c=t.getTextContent();if(!1===a)c&&t.removeTextContent();else{a=o.normal.conOpt=a||{type:"text"},c?c.clearStates():(c=TQt(a),t.setTextContent(c));var h=a&&a.style;EQt(null,c,null,e,a,h,null,i,r,!0);for(var d=0;d<bQt.length;d++){var p=bQt[d];if(p!==xQt){var f=o[p].conOpt;jQt(p,c,0,e0t(a,f,p),null)}}h?c.dirty():c.markRedraw()}}}(e,n,i,r,h,kQt),function(t,e,n,i,r){var o=n.clipPath;if(!1===o)t&&t.getClipPath()&&t.removeClipPath();else if(o){var a=t.getClipPath();a&&JQt(a,o)&&(a=null),a||(a=TQt(o),t.setClipPath(a)),EQt(null,a,null,e,o,null,null,i,r,!1)}}(e,n,i,r,h);var d=EQt(t,e,c,n,i,i.style,kQt,r,h,!1);c&&s.addTo(e,i,n,d);for(var p=0;p<bQt.length;p++){var f=bQt[p];if(f!==xQt){var g=t0t(i,f);jQt(f,e,0,e0t(i,g,f),kQt)}}return function(t,e,n,i){if(!t.isGroup){var r=t,o=n.currentZ,a=n.currentZLevel;r.z=o,r.zlevel=a;var s=e.z2;null!=s&&(r.z2=s||0);for(var l=0;l<bQt.length;l++)UQt(r,e,bQt[l])}}(e,i,r),"group"===i.type&&function(t,e,n,i,r,o){var a=i.children,s=a?a.length:0,l=i.$mergeChildren,u="byName"===l||i.diffChildrenByName,c=!1===l;if(!s&&!u&&!c)return;if(u)return h={api:t,oldChildren:e.children()||[],newChildren:a||[],dataIndex:n,seriesModel:r,group:e,morphPreparation:o},void new vBt(h.oldChildren,h.newChildren,n0t,n0t,h).add(i0t).update(i0t).remove(r0t).execute();var h;c&&e.removeAll();for(var d=0;d<s;d++)a[d]&&ZQt(t,e.childAt(d),n,a[d],r,e,!1,o);for(var p=e.childCount()-1;p>=d;p--)o0t(e.childAt(p),r,e)}(t,e,n,i,r,s),l>=0?o.replaceAt(e,l):o.add(e),e}function JQt(t,e){var n,i=mQt(t),r=e.type,o=e.shape,a=e.style;return null!=r&&r!==i.customGraphicType||"path"===r&&((n=o)&&(tkt(n,"pathData")||tkt(n,"d")))&&a0t(o)!==i.customPathData||"image"===r&&tkt(a,"image")&&a.image!==i.customImagePath}function QQt(t,e,n){var i=e?t0t(t,e):t,r=e?e0t(t,i,"emphasis"):t.style,o=t.type,a=i?i.textConfig:null,s=t.textContent,l=s?e?t0t(s,e):s:null;if(r&&(n.isLegacy||BJt(r,o,!!a,!!l))){n.isLegacy=!0;var u=VJt(r,o,!e);!a&&u.textConfig&&(a=u.textConfig),!l&&u.textContent&&(l=u.textContent)}if(!e&&l){var c=l;!c.type&&(c.type="text")}var h=e?n[e]:n.normal;h.cfg=a,h.conOpt=l}function t0t(t,e){return e?t?t[e]:null:t}function e0t(t,e,n){var i=e&&e.style;return null==i&&"emphasis"===n&&t&&(i=t.styleEmphasis),i}function n0t(t,e){var n=t&&t.name;return null!=n?n:"e\0\0"+e}function i0t(t,e){var n=this.context,i=null!=t?n.newChildren[t]:null,r=null!=e?n.oldChildren[e]:null;ZQt(n.api,r,n.dataIndex,i,n.seriesModel,n.group,0,n.morphPreparation)}function r0t(t){var e=this.context;o0t(e.oldChildren[t],e.seriesModel,e.group)}function o0t(t,e,n){if(t){var i=mQt(t).leaveToProps;i?WEt(t,i,e,{cb:function(){n.remove(t)}}):n.remove(t)}}function a0t(t){return t&&(t.pathData||t.d)}function s0t(t){return t&&t instanceof rDt}function l0t(t,e){t&&e.remove(t)}var u0t=function(){function t(t,e){this._fromList=[],this._toList=[],this._toElOptionList=[],this._allPropsFinalList=[],this._toDataIndices=[],this._morphConfigList=[],this._seriesModel=t,this._transOpt=e}return t.prototype.hasFrom=function(){return!!this._fromList.length},t.prototype.findAndAddFrom=function(t){if(t&&(mQt(t).canMorph&&this._fromList.push(t),t.isGroup))for(var e=t.childrenRef(),n=0;n<e.length;n++)this.findAndAddFrom(e[n])},t.prototype.addTo=function(t,e,n,i){t&&(this._toList.push(t),this._toElOptionList.push(e),this._toDataIndices.push(n),this._allPropsFinalList.push(i))},t.prototype.applyMorphing=function(){var t=this._type,e=this._fromList,n=this._toList.length,i=e.length;if(i&&n)if("oneToOne"===t)for(var r=0;r<n;r++)this._oneToOneForSingleTo(r,r);else if("manyToOne"===t)for(var o=Math.max(1,Math.floor(i/n)),a=(r=0,0);r<n;r++,a+=o){var s=r+1>=n?i-a:o;this._manyToOneForSingleTo(r,a>=i?null:a,s)}else if("oneToMany"===t)for(var l=Math.max(1,Math.floor(n/i)),u=0,c=0;u<n;u+=l,c++){var h=u+l>=n?n-u:l;this._oneToManyForSingleFrom(u,h,c>=i?null:c)}},t.prototype._oneToOneForSingleTo=function(t,e){var n,i=this._toList[t],r=this._toElOptionList[t],o=this._toDataIndices[t],a=this._allPropsFinalList[t],s=this._fromList[e],l=this._getOrCreateMorphConfig(o),u=l.duration;if(s&&sQt(s)){if(NQt(i,a,r.style),u){var c=lQt([s],i,l,c0t);this._processResultIndividuals(c,t,null)}}else{var h=u&&s&&(s!==i||(aQt(n=s)||sQt(n)))?s:null,d={};FQt("shape",i,h,r,d,!1),FQt("extra",i,h,r,d,!1),LQt(i,h,r,d,!1),$Qt(i,h,r,r.style,d,!1),NQt(i,a,r.style),h&&iQt(h,i,l),OQt(i,o,r,this._seriesModel,d,!1)}},t.prototype._manyToOneForSingleTo=function(t,e,n){var i=this._toList[t],r=this._toElOptionList[t];NQt(i,this._allPropsFinalList[t],r.style);var o=this._getOrCreateMorphConfig(this._toDataIndices[t]);if(o.duration&&null!=e){for(var a=[],s=e;s<n;s++)a.push(this._fromList[s]);var l=lQt(a,i,o,c0t);this._processResultIndividuals(l,t,null)}},t.prototype._oneToManyForSingleFrom=function(t,e,n){for(var i=null==n?null:this._fromList[n],r=this._toList,o=[],a=t;a<e;a++){var s=r[a];NQt(s,this._allPropsFinalList[a],this._toElOptionList[a].style),o.push(s)}var l=this._getOrCreateMorphConfig(this._toDataIndices[t]);if(l.duration&&i){var u=function(t,e,n,i){var r,o=e.length,a=n?n.dividingMethod:null,s=!1;if(sQt(t)){var l=t.__combiningSubList;l.length===o?r=l:(r=fQt(t,o,a),s=!0)}else r=fQt(t,o,a),s=!0;H_t(r.length===o);for(var u=0;u<o;u++)s&&i&&i(t,r[u],!1),iQt(r[u],e[u],n);return{fromIndividuals:r,toIndividuals:e,count:o}}(i,o,l,c0t);this._processResultIndividuals(u,t,e)}},t.prototype._processResultIndividuals=function(t,e,n){for(var i=null!=n,r=0;r<t.count;r++){var o=t.fromIndividuals[r],a=t.toIndividuals[r],s=e+(i?r:0),l=this._toElOptionList[s],u=this._toDataIndices[s],c={};LQt(a,o,l,c,!1),$Qt(a,o,l,l.style,c,!1),OQt(a,u,l,this._seriesModel,c,!1)}},t.prototype._getOrCreateMorphConfig=function(t){var e,n,i,r=this._morphConfigList,o=r[t];if(o)return o;var a=this._seriesModel,s=this._transOpt;if(a.isAnimationEnabled()){var l=void 0;if(a&&a.ecModel){var u=a.ecModel.getUpdatePayload();l=u&&u.animation}if(l)e=l.duration||0,n=l.easing||"cubicOut",i=l.delay||0;else{n=a.get("animationEasingUpdate");var c=a.get("animationDelayUpdate");i=N_t(c)?c(t):c;var h=a.get("animationDurationUpdate");e=N_t(h)?h(t):h}}return o={duration:e||0,delay:i,easing:n,dividingMethod:s?s.dividingMethod:null},r[t]=o,o},t.prototype.reset=function(t){this._type=t,this._fromList.length=this._toList.length=this._toElOptionList.length=this._allPropsFinalList.length=this._toDataIndices.length=0},t}();function c0t(t,e,n){e.style=n?g_t(t.style):t.style,e.zlevel=t.zlevel,e.z=t.z,e.z2=t.z2}var h0t=jAt(),d0t=g_t,p0t=D_t,f0t=function(){function t(){this._dragging=!1,this.animationThreshold=15}return t.prototype.render=function(t,e,n,i){var r=e.get("value"),o=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=n,i||this._lastValue!==r||this._lastStatus!==o){this._lastValue=r,this._lastStatus=o;var a=this._group,s=this._handle;if(!o||"hide"===o)return a&&a.hide(),void(s&&s.hide());a&&a.show(),s&&s.show();var l={};this.makeElOption(l,r,t,e,n);var u=l.graphicKey;u!==this._lastGraphicKey&&this.clear(n),this._lastGraphicKey=u;var c=this._moveAnimation=this.determineAnimation(t,e);if(a){var h=T_t(g0t,e,c);this.updatePointerEl(a,l,h),this.updateLabelEl(a,l,h,e)}else a=this._group=new oAt,this.createPointerEl(a,l,t,e),this.createLabelEl(a,l,t,e),n.getZr().add(a);x0t(a,e,!0),this._renderHandle(r)}},t.prototype.remove=function(t){this.clear(t)},t.prototype.dispose=function(t){this.clear(t)},t.prototype.determineAnimation=function(t,e){var n=e.get("animation"),i=t.axis,r="category"===i.type,o=e.get("snap");if(!o&&!r)return!1;if("auto"===n||null==n){var a=this.animationThreshold;if(r&&i.getBandWidth()>a)return!0;if(o){var s=uGt(t).seriesDataCount,l=i.getExtent();return Math.abs(l[0]-l[1])/s>a}return!1}return!0===n},t.prototype.makeElOption=function(t,e,n,i,r){},t.prototype.createPointerEl=function(t,e,n,i){var r=e.pointer;if(r){var o=h0t(t).pointerEl=new oNt[r.type](d0t(e.pointer));t.add(o)}},t.prototype.createLabelEl=function(t,e,n,i){if(e.label){var r=h0t(t).labelEl=new xDt(d0t(e.label));t.add(r),y0t(r,i)}},t.prototype.updatePointerEl=function(t,e,n){var i=h0t(t).pointerEl;i&&e.pointer&&(i.setStyle(e.pointer.style),n(i,{shape:e.pointer.shape}))},t.prototype.updateLabelEl=function(t,e,n,i){var r=h0t(t).labelEl;r&&(r.setStyle(e.label.style),n(r,{x:e.label.x,y:e.label.y}),y0t(r,i))},t.prototype._renderHandle=function(t){if(!this._dragging&&this.updateHandleTransform){var e,n=this._axisPointerModel,i=this._api.getZr(),r=this._handle,o=n.getModel("handle"),a=n.get("status");if(!o.get("show")||!a||"hide"===a)return r&&i.remove(r),void(this._handle=null);this._handle||(e=!0,r=this._handle=tNt(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(t){Lkt(t.event)},onmousedown:p0t(this._onHandleDragMove,this,0,0),drift:p0t(this._onHandleDragMove,this),ondragend:p0t(this._onHandleDragEnd,this)}),i.add(r)),x0t(r,n,!1),r.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var s=o.get("size");E_t(s)||(s=[s,s]),r.scaleX=s[0]/2,r.scaleY=s[1]/2,gLt(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,e)}},t.prototype._moveHandleToValue=function(t,e){g0t(this._axisPointerModel,!e&&this._moveAnimation,this._handle,v0t(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},t.prototype._onHandleDragMove=function(t,e){var n=this._handle;if(n){this._dragging=!0;var i=this.updateHandleTransform(v0t(n),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=i,n.stopAnimation(),n.attr(v0t(i)),h0t(n).lastProp=null,this._doDispatchAxisPointer()}},t.prototype._doDispatchAxisPointer=function(){if(this._handle){var t=this._payloadInfo,e=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:e.axis.dim,axisIndex:e.componentIndex}]})}},t.prototype._onHandleDragEnd=function(){if(this._dragging=!1,this._handle){var t=this._axisPointerModel.get("value");this._moveHandleToValue(t),this._api.dispatchAction({type:"hideTip"})}},t.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),n=this._group,i=this._handle;e&&n&&(this._lastGraphicKey=null,n&&e.remove(n),i&&e.remove(i),this._group=null,this._handle=null,this._payloadInfo=null)},t.prototype.doClear=function(){},t.prototype.buildLabel=function(t,e,n){return{x:t[n=n||0],y:t[1-n],width:e[n],height:e[1-n]}},t}();function g0t(t,e,n,i){m0t(h0t(n).lastProp,i)||(h0t(n).lastProp=i,e?WEt(n,i,t):(n.stopAnimation(),n.attr(i)))}function m0t(t,e){if(L_t(t)&&L_t(e)){var n=!0;return S_t(e,(function(e,i){n=n&&m0t(t[i],e)})),!!n}return t===e}function y0t(t,e){t[e.get(["label","show"])?"show":"hide"]()}function v0t(t){return{x:t.x||0,y:t.y||0,rotation:t.rotation||0}}function x0t(t,e,n){var i=e.get("z"),r=e.get("zlevel");t&&t.traverse((function(t){"group"!==t.type&&(null!=i&&(t.z=i),null!=r&&(t.zlevel=r),t.silent=n)}))}function b0t(t){var e,n=t.get("type"),i=t.getModel(n+"Style");return"line"===n?(e=i.getLineStyle()).fill=null:"shadow"===n&&((e=i.getAreaStyle()).stroke=null),e}function w0t(t,e,n,i,r){var o=_0t(n.get("value"),e.axis,e.ecModel,n.get("seriesDataIndices"),{precision:n.get(["label","precision"]),formatter:n.get(["label","formatter"])}),a=n.getModel("label"),s=dOt(a.get("padding")||0),l=a.getFont(),u=UCt(o,l),c=r.position,h=u.width+s[1]+s[3],d=u.height+s[0]+s[2],p=r.align;"right"===p&&(c[0]-=h),"center"===p&&(c[0]-=h/2);var f=r.verticalAlign;"bottom"===f&&(c[1]-=d),"middle"===f&&(c[1]-=d/2),function(t,e,n,i){var r=i.getWidth(),o=i.getHeight();t[0]=Math.min(t[0]+e,r)-e,t[1]=Math.min(t[1]+n,o)-n,t[0]=Math.max(t[0],0),t[1]=Math.max(t[1],0)}(c,h,d,i);var g=a.get("backgroundColor");g&&"auto"!==g||(g=e.get(["axisLine","lineStyle","color"])),t.label={x:c[0],y:c[1],style:hNt(a,{text:o,font:l,fill:a.getTextColor(),padding:s,backgroundColor:g}),z2:10}}function _0t(t,e,n,i,r){t=e.scale.parse(t);var o=e.scale.getLabel({value:t},{precision:r.precision}),a=r.formatter;if(a){var s={value:QVt(e,{value:t}),axisDimension:e.dim,axisIndex:e.index,seriesData:[]};S_t(i,(function(t){var e=n.getSeriesByIndex(t.seriesIndex),i=t.dataIndexInside,r=e&&e.getDataParams(i);r&&s.seriesData.push(r)})),O_t(a)?o=a.replace("{value}",o):N_t(a)&&(o=a(s))}return o}function k0t(t,e,n){var i=[1,0,0,1,0,0];return yCt(i,i,n.rotation),mCt(i,i,n.position),YEt([t.dataToCoord(e),(n.labelOffset||0)+(n.labelDirection||1)*(n.labelMargin||0)],i)}function S0t(t,e,n,i,r,o){var a=tGt.innerTextLayout(n.rotation,0,n.labelDirection);n.labelMargin=r.get(["label","margin"]),w0t(e,i,r,o,{position:k0t(i.axis,t,n),align:a.textAlign,verticalAlign:a.textVerticalAlign})}function C0t(t,e,n){return{x1:t[n=n||0],y1:t[1-n],x2:e[n],y2:e[1-n]}}function A0t(t,e,n){return{x:t[n=n||0],y:t[1-n],width:e[n],height:e[1-n]}}function I0t(t,e,n,i,r,o){return{cx:t,cy:e,r0:n,r:i,startAngle:r,endAngle:o,clockwise:!0}}var M0t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.makeElOption=function(t,e,n,i,r){var o=n.axis,a=o.grid,s=i.get("type"),l=D0t(a,o).getOtherAxis(o).getGlobalExtent(),u=o.toGlobalCoord(o.dataToCoord(e,!0));if(s&&"none"!==s){var c=b0t(i),h=T0t[s](o,u,l);h.style=c,t.graphicKey=h.type,t.pointer=h}S0t(e,t,HUt(a.model,n),n,i,r)},e.prototype.getHandleTransform=function(t,e,n){var i=HUt(e.axis.grid.model,e,{labelInside:!1});i.labelMargin=n.get(["handle","margin"]);var r=k0t(e.axis,t,i);return{x:r[0],y:r[1],rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}},e.prototype.updateHandleTransform=function(t,e,n,i){var r=n.axis,o=r.grid,a=r.getGlobalExtent(!0),s=D0t(o,r).getOtherAxis(r).getGlobalExtent(),l="x"===r.dim?0:1,u=[t.x,t.y];u[l]+=e[l],u[l]=Math.min(a[1],u[l]),u[l]=Math.max(a[0],u[l]);var c=(s[1]+s[0])/2,h=[c,c];h[l]=u[l];return{x:u[0],y:u[1],rotation:t.rotation,cursorPoint:h,tooltipOption:[{verticalAlign:"middle"},{align:"center"}][l]}},e}(f0t);function D0t(t,e){var n={};return n[e.dim+"AxisIndex"]=e.index,t.getCartesian(n)}var T0t={line:function(t,e,n){return{type:"Line",subPixelOptimize:!0,shape:C0t([e,n[0]],[e,n[1]],E0t(t))}},shadow:function(t,e,n){var i=Math.max(1,t.getBandWidth()),r=n[1]-n[0];return{type:"Rect",shape:A0t([e-i/2,n[0]],[i,r],E0t(t))}}};function E0t(t){return"x"===t.dim?0:1}var N0t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="axisPointer",e.defaultOption={show:"auto",zlevel:0,z:50,type:"line",snap:!1,triggerTooltip:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},e}(FOt),O0t=jAt(),F0t=S_t;function R0t(t,e,n){if(!t_t.node){var i=e.getZr();O0t(i).records||(O0t(i).records={}),function(t,e){if(O0t(t).initialized)return;function n(n,i){t.on(n,(function(n){var r=function(t){var e={showTip:[],hideTip:[]},n=function(i){var r=e[i.type];r?r.push(i):(i.dispatchAction=n,t.dispatchAction(i))};return{dispatchAction:n,pendings:e}}(e);F0t(O0t(t).records,(function(t){t&&i(t,n,r.dispatchAction)})),function(t,e){var n,i=t.showTip.length,r=t.hideTip.length;i?n=t.showTip[i-1]:r&&(n=t.hideTip[r-1]);n&&(n.dispatchAction=null,e.dispatchAction(n))}(r.pendings,e)}))}O0t(t).initialized=!0,n("click",T_t($0t,"click")),n("mousemove",T_t($0t,"mousemove")),n("globalout",L0t)}(i,e),(O0t(i).records[t]||(O0t(i).records[t]={})).handler=n}}function L0t(t,e,n){t.handler("leave",null,n)}function $0t(t,e,n,i){e.handler(t,n,i)}function P0t(t,e){if(!t_t.node){var n=e.getZr();(O0t(n).records||{})[t]&&(O0t(n).records[t]=null)}}var z0t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=e.getComponent("tooltip"),r=t.get("triggerOn")||i&&i.get("triggerOn")||"mousemove|click";R0t("axisPointer",n,(function(t,e,n){"none"!==r&&("leave"===t||r.indexOf(t)>=0)&&n({type:"updateAxisPointer",currTrigger:t,x:e&&e.offsetX,y:e&&e.offsetY})}))},e.prototype.remove=function(t,e){P0t("axisPointer",e)},e.prototype.dispose=function(t,e){P0t("axisPointer",e)},e.type="axisPointer",e}(nLt);function B0t(t,e){var n,i=[],r=t.seriesIndex;if(null==r||!(n=e.getSeriesByIndex(r)))return{point:[]};var o=n.getData(),a=WAt(o,t);if(null==a||a<0||E_t(a))return{point:[]};var s=o.getItemGraphicEl(a),l=n.coordinateSystem;if(n.getTooltipPosition)i=n.getTooltipPosition(a)||[];else if(l&&l.dataToPoint)if(t.isStacked){var u=l.getBaseAxis(),c=l.getOtherAxis(u).dim,h=u.dim,d="x"===c||"radius"===c?1:0,p=o.mapDimension(h),f=[];f[d]=o.get(p,a),f[1-d]=o.get(o.getCalculationInfo("stackResultDimension"),a),i=l.dataToPoint(f)||[]}else i=l.dataToPoint(o.getValues(C_t(l.dimensions,(function(t){return o.mapDimension(t)})),a))||[];else if(s){var g=s.getBoundingRect().clone();g.applyTransform(s.transform),i=[g.x+g.width/2,g.y+g.height/2]}return{point:i,el:s}}var V0t=jAt();function W0t(t,e,n){var i=t.currTrigger,r=[t.x,t.y],o=t,a=t.dispatchAction||D_t(n.dispatchAction,n),s=e.getComponent("axisPointer").coordSysAxesInfo;if(s){q0t(r)&&(r=B0t({seriesIndex:o.seriesIndex,dataIndex:o.dataIndex},e).point);var l=q0t(r),u=o.axesInfo,c=s.axesInfo,h="leave"===i||q0t(r),d={},p={},f={list:[],map:{}},g={showPointer:T_t(U0t,p),showTooltip:T_t(G0t,f)};S_t(s.coordSysMap,(function(t,e){var n=l||t.containPoint(r);S_t(s.coordSysAxesInfo[e],(function(t,e){var i=t.axis,o=function(t,e){for(var n=0;n<(t||[]).length;n++){var i=t[n];if(e.axis.dim===i.axisDim&&e.axis.model.componentIndex===i.axisIndex)return i}}(u,t);if(!h&&n&&(!u||o)){var a=o&&o.value;null!=a||l||(a=i.pointToData(r)),null!=a&&j0t(t,a,g,!1,d)}}))}));var m={};return S_t(c,(function(t,e){var n=t.linkGroup;n&&!p[e]&&S_t(n.axesInfo,(function(e,i){var r=p[i];if(e!==t&&r){var o=r.value;n.mapper&&(o=t.axis.scale.parse(n.mapper(o,H0t(e),H0t(t)))),m[t.key]=o}}))})),S_t(m,(function(t,e){j0t(c[e],t,g,!0,d)})),function(t,e,n){var i=n.axesInfo=[];S_t(e,(function(e,n){var r=e.axisPointerModel.option,o=t[n];o?(!e.useHandle&&(r.status="show"),r.value=o.value,r.seriesDataIndices=(o.payloadBatch||[]).slice()):!e.useHandle&&(r.status="hide"),"show"===r.status&&i.push({axisDim:e.axis.dim,axisIndex:e.axis.model.componentIndex,value:r.value})}))}(p,c,d),function(t,e,n,i){if(q0t(e)||!t.list.length)return void i({type:"hideTip"});var r=((t.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:!0,x:e[0],y:e[1],tooltipOption:n.tooltipOption,position:n.position,dataIndexInside:r.dataIndexInside,dataIndex:r.dataIndex,seriesIndex:r.seriesIndex,dataByCoordSys:t.list})}(f,r,t,a),function(t,e,n){var i=n.getZr(),r="axisPointerLastHighlights",o=V0t(i)[r]||{},a=V0t(i)[r]={};S_t(t,(function(t,e){var n=t.axisPointerModel.option;"show"===n.status&&S_t(n.seriesDataIndices,(function(t){var e=t.seriesIndex+" | "+t.dataIndex;a[e]=t}))}));var s=[],l=[];S_t(o,(function(t,e){!a[e]&&l.push(t)})),S_t(a,(function(t,e){!o[e]&&s.push(t)})),l.length&&n.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:l}),s.length&&n.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:s})}(c,0,n),d}}function j0t(t,e,n,i,r){var o=t.axis;if(!o.scale.isBlank()&&o.containData(e))if(t.involveSeries){var a=function(t,e){var n=e.axis,i=n.dim,r=t,o=[],a=Number.MAX_VALUE,s=-1;return S_t(e.seriesModels,(function(e,l){var u,c,h=e.getData().mapDimensionsAll(i);if(e.getAxisTooltipData){var d=e.getAxisTooltipData(h,t,n);c=d.dataIndices,u=d.nestestValue}else{if(!(c=e.getData().indicesOfNearest(h[0],t,"category"===n.type?.5:null)).length)return;u=e.getData().get(h[0],c[0])}if(null!=u&&isFinite(u)){var p=t-u,f=Math.abs(p);f<=a&&((f<a||p>=0&&s<0)&&(a=f,s=p,r=u,o.length=0),S_t(c,(function(t){o.push({seriesIndex:e.seriesIndex,dataIndexInside:t,dataIndex:e.getData().getRawIndex(t)})})))}})),{payloadBatch:o,snapToValue:r}}(e,t),s=a.payloadBatch,l=a.snapToValue;s[0]&&null==r.seriesIndex&&v_t(r,s[0]),!i&&t.snap&&o.containData(l)&&null!=l&&(e=l),n.showPointer(t,e,s),n.showTooltip(t,a,l)}else n.showPointer(t,e)}function U0t(t,e,n,i){t[e.key]={value:n,payloadBatch:i}}function G0t(t,e,n,i){var r=n.payloadBatch,o=e.axis,a=o.model,s=e.axisPointerModel;if(e.triggerTooltip&&r.length){var l=e.coordSys.model,u=hGt(l),c=t.map[u];c||(c=t.map[u]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},t.list.push(c)),c.dataByAxis.push({axisDim:o.dim,axisIndex:a.componentIndex,axisType:a.type,axisId:a.id,value:i,valueLabelOpt:{precision:s.get(["label","precision"]),formatter:s.get(["label","formatter"])},seriesDataIndices:r.slice()})}}function H0t(t){var e=t.axis.model,n={},i=n.axisDim=t.axis.dim;return n.axisIndex=n[i+"AxisIndex"]=e.componentIndex,n.axisName=n[i+"AxisName"]=e.name,n.axisId=n[i+"AxisId"]=e.id,n}function q0t(t){return!t||null==t[0]||isNaN(t[0])||null==t[1]||isNaN(t[1])}function X0t(t){pGt.registerAxisPointerClass("CartesianAxisPointer",M0t),t.registerComponentModel(N0t),t.registerComponentView(z0t),t.registerPreprocessor((function(t){if(t){(!t.axisPointer||0===t.axisPointer.length)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!E_t(e)&&(t.axisPointer.link=[e])}})),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,(function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=aGt(t,e)})),t.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},W0t)}var Y0t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.makeElOption=function(t,e,n,i,r){var o=n.axis;"angle"===o.dim&&(this.animationThreshold=Math.PI/18);var a=o.polar,s=a.getOtherAxis(o).getExtent(),l=o.dataToCoord(e),u=i.get("type");if(u&&"none"!==u){var c=b0t(i),h=K0t[u](o,a,l,s);h.style=c,t.graphicKey=h.type,t.pointer=h}var d=function(t,e,n,i,r){var o=e.axis,a=o.dataToCoord(t),s=i.getAngleAxis().getExtent()[0];s=s/180*Math.PI;var l,u,c,h=i.getRadiusAxis().getExtent();if("radius"===o.dim){var d=[1,0,0,1,0,0];yCt(d,d,s),mCt(d,d,[i.cx,i.cy]),l=YEt([a,-r],d);var p=e.getModel("axisLabel").get("rotate")||0,f=tGt.innerTextLayout(s,p*Math.PI/180,-1);u=f.textAlign,c=f.textVerticalAlign}else{var g=h[1];l=i.coordToPoint([g+r,a]);var m=i.cx,y=i.cy;u=Math.abs(l[0]-m)/g<.3?"center":l[0]>m?"left":"right",c=Math.abs(l[1]-y)/g<.3?"middle":l[1]>y?"top":"bottom"}return{position:l,align:u,verticalAlign:c}}(e,n,0,a,i.get(["label","margin"]));w0t(t,n,i,r,d)},e}(f0t);var K0t={line:function(t,e,n,i){return"angle"===t.dim?{type:"Line",shape:C0t(e.coordToPoint([i[0],n]),e.coordToPoint([i[1],n]))}:{type:"Circle",shape:{cx:e.cx,cy:e.cy,r:n}}},shadow:function(t,e,n,i){var r=Math.max(1,t.getBandWidth()),o=Math.PI/180;return"angle"===t.dim?{type:"Sector",shape:I0t(e.cx,e.cy,i[0],i[1],(-n-r/2)*o,(r/2-n)*o)}:{type:"Sector",shape:I0t(e.cx,e.cy,n-r/2,n+r/2,0,2*Math.PI)}}},Z0t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.findAxisModel=function(t){var e;return this.ecModel.eachComponent(t,(function(t){t.getCoordSysModel()===this&&(e=t)}),this),e},e.type="polar",e.dependencies=["radiusAxis","angleAxis"],e.defaultOption={zlevel:0,z:0,center:["50%","50%"],radius:"80%"},e}(FOt),J0t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",qAt).models[0]},e.type="polarAxis",e}(FOt);__t(J0t,iWt);var Q0t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="angleAxis",e}(J0t),t1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="radiusAxis",e}(J0t),e1t=function(t){function e(e,n){return t.call(this,"radius",e,n)||this}return Dit(e,t),e.prototype.pointToData=function(t,e){return this.polar.pointToData(t,e)["radius"===this.dim?0:1]},e}(fWt);e1t.prototype.dataToRadius=fWt.prototype.dataToCoord,e1t.prototype.radiusToData=fWt.prototype.coordToData;var n1t=jAt(),i1t=function(t){function e(e,n){return t.call(this,"angle",e,n||[0,360])||this}return Dit(e,t),e.prototype.pointToData=function(t,e){return this.polar.pointToData(t,e)["radius"===this.dim?0:1]},e.prototype.calculateCategoryInterval=function(){var t=this,e=t.getLabelModel(),n=t.scale,i=n.getExtent(),r=n.count();if(i[1]-i[0]<1)return 0;var o=i[0],a=t.dataToCoord(o+1)-t.dataToCoord(o),s=Math.abs(a),l=UCt(null==o?"":o+"",e.getFont(),"center","top"),u=Math.max(l.height,7)/s;isNaN(u)&&(u=1/0);var c=Math.max(0,Math.floor(u)),h=n1t(t.model),d=h.lastAutoInterval,p=h.lastTickCount;return null!=d&&null!=p&&Math.abs(d-c)<=1&&Math.abs(p-r)<=1&&d>c?c=d:(h.lastTickCount=r,h.lastAutoInterval=c),c},e}(fWt);i1t.prototype.dataToAngle=fWt.prototype.dataToCoord,i1t.prototype.angleToData=fWt.prototype.coordToData;var r1t=function(){function t(t){this.dimensions=["radius","angle"],this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new e1t,this._angleAxis=new i1t,this.axisPointerEnabled=!0,this.name=t||"",this._radiusAxis.polar=this._angleAxis.polar=this}return t.prototype.containPoint=function(t){var e=this.pointToCoord(t);return this._radiusAxis.contain(e[0])&&this._angleAxis.contain(e[1])},t.prototype.containData=function(t){return this._radiusAxis.containData(t[0])&&this._angleAxis.containData(t[1])},t.prototype.getAxis=function(t){return this["_"+t+"Axis"]},t.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},t.prototype.getAxesByScale=function(t){var e=[],n=this._angleAxis,i=this._radiusAxis;return n.scale.type===t&&e.push(n),i.scale.type===t&&e.push(i),e},t.prototype.getAngleAxis=function(){return this._angleAxis},t.prototype.getRadiusAxis=function(){return this._radiusAxis},t.prototype.getOtherAxis=function(t){var e=this._angleAxis;return t===e?this._radiusAxis:e},t.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},t.prototype.getTooltipAxes=function(t){var e=null!=t&&"auto"!==t?this.getAxis(t):this.getBaseAxis();return{baseAxes:[e],otherAxes:[this.getOtherAxis(e)]}},t.prototype.dataToPoint=function(t,e){return this.coordToPoint([this._radiusAxis.dataToRadius(t[0],e),this._angleAxis.dataToAngle(t[1],e)])},t.prototype.pointToData=function(t,e){var n=this.pointToCoord(t);return[this._radiusAxis.radiusToData(n[0],e),this._angleAxis.angleToData(n[1],e)]},t.prototype.pointToCoord=function(t){var e=t[0]-this.cx,n=t[1]-this.cy,i=this.getAngleAxis(),r=i.getExtent(),o=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]);i.inverse?o=a-360:a=o+360;var s=Math.sqrt(e*e+n*n);e/=s,n/=s;for(var l=Math.atan2(-n,e)/Math.PI*180,u=l<o?1:-1;l<o||l>a;)l+=360*u;return[s,l]},t.prototype.coordToPoint=function(t){var e=t[0],n=t[1]/180*Math.PI;return[Math.cos(n)*e+this.cx,-Math.sin(n)*e+this.cy]},t.prototype.getArea=function(){var t=this.getAngleAxis(),e=this.getRadiusAxis().getExtent().slice();e[0]>e[1]&&e.reverse();var n=t.getExtent(),i=Math.PI/180;return{cx:this.cx,cy:this.cy,r0:e[0],r:e[1],startAngle:-n[0]*i,endAngle:-n[1]*i,clockwise:t.inverse,contain:function(t,e){var n=t-this.cx,i=e-this.cy,r=n*n+i*i,o=this.r,a=this.r0;return r<=o*o&&r>=a*a}}},t.prototype.convertToPixel=function(t,e,n){return o1t(e)===this?this.dataToPoint(n):null},t.prototype.convertFromPixel=function(t,e,n){return o1t(e)===this?this.pointToData(n):null},t}();function o1t(t){var e=t.seriesModel,n=t.polarModel;return n&&n.coordinateSystem||e&&e.coordinateSystem}function a1t(t,e){var n=this,i=n.getAngleAxis(),r=n.getRadiusAxis();if(i.scale.setExtent(1/0,-1/0),r.scale.setExtent(1/0,-1/0),t.eachSeries((function(t){if(t.coordinateSystem===n){var e=t.getData();S_t(nWt(e,"radius"),(function(t){r.scale.unionExtentFromData(e,t)})),S_t(nWt(e,"angle"),(function(t){i.scale.unionExtentFromData(e,t)}))}})),KVt(i.scale,i.model),KVt(r.scale,r.model),"category"===i.type&&!i.onBand){var o=i.getExtent(),a=360/i.scale.count();i.inverse?o[1]+=a:o[1]-=a,i.setExtent(o[0],o[1])}}function s1t(t,e){if(t.type=e.get("type"),t.scale=ZVt(e),t.onBand=e.get("boundaryGap")&&"category"===t.type,t.inverse=e.get("inverse"),function(t){return"angleAxis"===t.mainType}(e)){t.inverse=t.inverse!==e.get("clockwise");var n=e.get("startAngle");t.setExtent(n,n+(t.inverse?-360:360))}e.axis=t,t.model=e}var l1t={dimensions:r1t.prototype.dimensions,create:function(t,e){var n=[];return t.eachComponent("polar",(function(t,i){var r=new r1t(i+"");r.update=a1t;var o=r.getRadiusAxis(),a=r.getAngleAxis(),s=t.findAxisModel("radiusAxis"),l=t.findAxisModel("angleAxis");s1t(o,s),s1t(a,l),function(t,e,n){var i=e.get("center"),r=n.getWidth(),o=n.getHeight();t.cx=dAt(i[0],r),t.cy=dAt(i[1],o);var a=t.getRadiusAxis(),s=Math.min(r,o)/2,l=e.get("radius");null==l?l=[0,"100%"]:E_t(l)||(l=[0,l]);var u=[dAt(l[0],s),dAt(l[1],s)];a.inverse?a.setExtent(u[1],u[0]):a.setExtent(u[0],u[1])}(r,t,e),n.push(r),t.coordinateSystem=r,r.model=t})),t.eachSeries((function(t){if("polar"===t.get("coordinateSystem")){var e=t.getReferringComponents("polar",qAt).models[0];t.coordinateSystem=e.coordinateSystem}})),n}},u1t=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function c1t(t,e,n){e[1]>e[0]&&(e=e.slice().reverse());var i=t.coordToPoint([e[0],n]),r=t.coordToPoint([e[1],n]);return{x1:i[0],y1:i[1],x2:r[0],y2:r[1]}}function h1t(t){return t.getRadiusAxis().inverse?0:1}function d1t(t){var e=t[0],n=t[t.length-1];e&&n&&Math.abs(Math.abs(e.coord-n.coord)-360)<1e-4&&t.pop()}var p1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.axisPointerClass="PolarAxisPointer",n}return Dit(e,t),e.prototype.render=function(t,e){if(this.group.removeAll(),t.get("show")){var n=t.axis,i=n.polar,r=i.getRadiusAxis().getExtent(),o=n.getTicksCoords(),a=n.getMinorTicksCoords(),s=C_t(n.getViewLabels(),(function(t){t=g_t(t);var e=n.scale,i="ordinal"===e.type?e.getRawOrdinalNumber(t.tickValue):t.tickValue;return t.coord=n.dataToCoord(i),t}));d1t(s),d1t(o),S_t(u1t,(function(e){!t.get([e,"show"])||n.scale.isBlank()&&"axisLine"!==e||f1t[e](this.group,t,i,o,a,r,s)}),this)}},e.type="angleAxis",e}(pGt),f1t={axisLine:function(t,e,n,i,r,o){var a,s=e.getModel(["axisLine","lineStyle"]),l=h1t(n),u=l?0:1;(a=0===o[u]?new $Tt({shape:{cx:n.cx,cy:n.cy,r:o[l]},style:s.getLineStyle(),z2:1,silent:!0}):new nEt({shape:{cx:n.cx,cy:n.cy,r:o[l],r0:o[u]},style:s.getLineStyle(),z2:1,silent:!0})).style.fill=null,t.add(a)},axisTick:function(t,e,n,i,r,o){var a=e.getModel("axisTick"),s=(a.get("inside")?-1:1)*a.get("length"),l=o[h1t(n)],u=C_t(i,(function(t){return new hEt({shape:c1t(n,[l,l+s],t.coord)})}));t.add(PEt(u,{style:x_t(a.getModel("lineStyle").getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])})}))},minorTick:function(t,e,n,i,r,o){if(r.length){for(var a=e.getModel("axisTick"),s=e.getModel("minorTick"),l=(a.get("inside")?-1:1)*s.get("length"),u=o[h1t(n)],c=[],h=0;h<r.length;h++)for(var d=0;d<r[h].length;d++)c.push(new hEt({shape:c1t(n,[u,u+l],r[h][d].coord)}));t.add(PEt(c,{style:x_t(s.getModel("lineStyle").getLineStyle(),x_t(a.getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(t,e,n,i,r,o,a){var s=e.getCategories(!0),l=e.getModel("axisLabel"),u=l.get("margin"),c=e.get("triggerEvent");S_t(a,(function(i,r){var a=l,h=i.tickValue,d=o[h1t(n)],p=n.coordToPoint([d+u,i.coord]),f=n.cx,g=n.cy,m=Math.abs(p[0]-f)/d<.3?"center":p[0]>f?"left":"right",y=Math.abs(p[1]-g)/d<.3?"middle":p[1]>g?"top":"bottom";if(s&&s[h]){var v=s[h];L_t(v)&&v.textStyle&&(a=new NNt(v.textStyle,l,l.ecModel))}var x=new xDt({silent:tGt.isLabelSilent(e),style:hNt(a,{x:p[0],y:p[1],fill:a.getTextColor()||e.get(["axisLine","lineStyle","color"]),text:i.formattedLabel,align:m,verticalAlign:y})});if(t.add(x),c){var b=tGt.makeAxisEventDataBase(e);b.targetType="axisLabel",b.value=i.rawLabel,IDt(x).eventData=b}}),this)},splitLine:function(t,e,n,i,r,o){var a=e.getModel("splitLine").getModel("lineStyle"),s=a.get("color"),l=0;s=s instanceof Array?s:[s];for(var u=[],c=0;c<i.length;c++){var h=l++%s.length;u[h]=u[h]||[],u[h].push(new hEt({shape:c1t(n,o,i[c].coord)}))}for(c=0;c<u.length;c++)t.add(PEt(u[c],{style:x_t({stroke:s[c%s.length]},a.getLineStyle()),silent:!0,z:e.get("z")}))},minorSplitLine:function(t,e,n,i,r,o){if(r.length){for(var a=e.getModel("minorSplitLine").getModel("lineStyle"),s=[],l=0;l<r.length;l++)for(var u=0;u<r[l].length;u++)s.push(new hEt({shape:c1t(n,o,r[l][u].coord)}));t.add(PEt(s,{style:a.getLineStyle(),silent:!0,z:e.get("z")}))}},splitArea:function(t,e,n,i,r,o){if(i.length){var a=e.getModel("splitArea").getModel("areaStyle"),s=a.get("color"),l=0;s=s instanceof Array?s:[s];for(var u=[],c=Math.PI/180,h=-i[0].coord*c,d=Math.min(o[0],o[1]),p=Math.max(o[0],o[1]),f=e.get("clockwise"),g=1,m=i.length;g<=m;g++){var y=g===m?i[0].coord:i[g].coord,v=l++%s.length;u[v]=u[v]||[],u[v].push(new tEt({shape:{cx:n.cx,cy:n.cy,r0:d,r:p,startAngle:h,endAngle:-y*c,clockwise:f},silent:!0})),h=-y*c}for(g=0;g<u.length;g++)t.add(PEt(u[g],{style:x_t({fill:s[g%s.length]},a.getAreaStyle()),silent:!0}))}}},g1t=["axisLine","axisTickLabel","axisName"],m1t=["splitLine","splitArea","minorSplitLine"],y1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.axisPointerClass="PolarAxisPointer",n}return Dit(e,t),e.prototype.render=function(t,e){if(this.group.removeAll(),t.get("show")){var n=this._axisGroup,i=this._axisGroup=new oAt;this.group.add(i);var r=t.axis,o=r.polar,a=o.getAngleAxis(),s=r.getTicksCoords(),l=r.getMinorTicksCoords(),u=a.getExtent()[0],c=r.getExtent(),h=function(t,e,n){return{position:[t.cx,t.cy],rotation:n/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:e.getModel("axisLabel").get("rotate"),z2:1}}(o,t,u),d=new tGt(t,h);S_t(g1t,d.add,d),i.add(d.getGroup()),JEt(n,i,t),S_t(m1t,(function(e){t.get([e,"show"])&&!r.scale.isBlank()&&v1t[e](this.group,t,o,u,c,s,l)}),this)}},e.type="radiusAxis",e}(pGt),v1t={splitLine:function(t,e,n,i,r,o){var a=e.getModel("splitLine").getModel("lineStyle"),s=a.get("color"),l=0;s=s instanceof Array?s:[s];for(var u=[],c=0;c<o.length;c++){var h=l++%s.length;u[h]=u[h]||[],u[h].push(new $Tt({shape:{cx:n.cx,cy:n.cy,r:o[c].coord}}))}for(c=0;c<u.length;c++)t.add(PEt(u[c],{style:x_t({stroke:s[c%s.length],fill:null},a.getLineStyle()),silent:!0}))},minorSplitLine:function(t,e,n,i,r,o,a){if(a.length){for(var s=e.getModel("minorSplitLine").getModel("lineStyle"),l=[],u=0;u<a.length;u++)for(var c=0;c<a[u].length;c++)l.push(new $Tt({shape:{cx:n.cx,cy:n.cy,r:a[u][c].coord}}));t.add(PEt(l,{style:x_t({fill:null},s.getLineStyle()),silent:!0}))}},splitArea:function(t,e,n,i,r,o){if(o.length){var a=e.getModel("splitArea").getModel("areaStyle"),s=a.get("color"),l=0;s=s instanceof Array?s:[s];for(var u=[],c=o[0].coord,h=1;h<o.length;h++){var d=l++%s.length;u[d]=u[d]||[],u[d].push(new tEt({shape:{cx:n.cx,cy:n.cy,r0:c,r:o[h].coord,startAngle:0,endAngle:2*Math.PI},silent:!0})),c=o[h].coord}for(h=0;h<u.length;h++)t.add(PEt(u[h],{style:x_t({fill:s[h%s.length]},a.getAreaStyle()),silent:!0}))}}};function x1t(t){return t.get("stack")||"__ec_stack_"+t.seriesIndex}function b1t(t,e){return e.dim+t.model.componentIndex}function w1t(t,e,n){var i={},r=function(t){var e={};S_t(t,(function(t,n){var i=t.getData(),r=t.coordinateSystem,o=r.getBaseAxis(),a=b1t(r,o),s=o.getExtent(),l="category"===o.type?o.getBandWidth():Math.abs(s[1]-s[0])/i.count(),u=e[a]||{bandWidth:l,remainedWidth:l,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},c=u.stacks;e[a]=u;var h=x1t(t);c[h]||u.autoWidthCount++,c[h]=c[h]||{width:0,maxWidth:0};var d=dAt(t.get("barWidth"),l),p=dAt(t.get("barMaxWidth"),l),f=t.get("barGap"),g=t.get("barCategoryGap");d&&!c[h].width&&(d=Math.min(u.remainedWidth,d),c[h].width=d,u.remainedWidth-=d),p&&(c[h].maxWidth=p),null!=f&&(u.gap=f),null!=g&&(u.categoryGap=g)}));var n={};return S_t(e,(function(t,e){n[e]={};var i=t.stacks,r=t.bandWidth,o=dAt(t.categoryGap,r),a=dAt(t.gap,1),s=t.remainedWidth,l=t.autoWidthCount,u=(s-o)/(l+(l-1)*a);u=Math.max(u,0),S_t(i,(function(t,e){var n=t.maxWidth;n&&n<u&&(n=Math.min(n,s),t.width&&(n=Math.min(n,t.width)),s-=n,t.width=n,l--)})),u=(s-o)/(l+(l-1)*a),u=Math.max(u,0);var c,h=0;S_t(i,(function(t,e){t.width||(t.width=u),c=t,h+=t.width*(1+a)})),c&&(h-=c.width*a);var d=-h/2;S_t(i,(function(t,i){n[e][i]=n[e][i]||{offset:d,width:t.width},d+=t.width*(1+a)}))})),n}(I_t(e.getSeriesByType(t),(function(t){return!e.isSeriesFiltered(t)&&t.coordinateSystem&&"polar"===t.coordinateSystem.type})));e.eachSeriesByType(t,(function(t){if("polar"===t.coordinateSystem.type){var e=t.getData(),n=t.coordinateSystem,o=n.getBaseAxis(),a=b1t(n,o),s=x1t(t),l=r[a][s],u=l.offset,c=l.width,h=n.getOtherAxis(o),d=t.coordinateSystem.cx,p=t.coordinateSystem.cy,f=t.get("barMinHeight")||0,g=t.get("barMinAngle")||0;i[s]=i[s]||[];for(var m=e.mapDimension(h.dim),y=e.mapDimension(o.dim),v=JBt(e,m),x="radius"!==o.dim||!t.get("roundCap",!0),b=h.dataToCoord(0),w=0,_=e.count();w<_;w++){var k=e.get(m,w),S=e.get(y,w),C=k>=0?"p":"n",A=b;v&&(i[s][S]||(i[s][S]={p:b,n:b}),A=i[s][S][C]);var I=void 0,M=void 0,D=void 0,T=void 0;if("radius"===h.dim){var E=h.dataToCoord(k)-b,N=o.dataToCoord(S);Math.abs(E)<f&&(E=(E<0?-1:1)*f),I=A,M=A+E,T=(D=N-u)-c,v&&(i[s][S][C]=M)}else{var O=h.dataToCoord(k,x)-b,F=o.dataToCoord(S);Math.abs(O)<g&&(O=(O<0?-1:1)*g),M=(I=F+u)+c,D=A,T=A+O,v&&(i[s][S][C]=T)}e.setItemLayout(w,{cx:d,cy:p,r0:I,r:M,startAngle:-D*Math.PI/180,endAngle:-T*Math.PI/180})}}}))}var _1t={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},k1t={splitNumber:5},S1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="polar",e}(nLt);function C1t(t,e){e=e||{};var n=t.coordinateSystem,i=t.axis,r={},o=i.position,a=i.orient,s=n.getRect(),l=[s.x,s.x+s.width,s.y,s.y+s.height],u={horizontal:{top:l[2],bottom:l[3]},vertical:{left:l[0],right:l[1]}};r.position=["vertical"===a?u.vertical[o]:l[0],"horizontal"===a?u.horizontal[o]:l[3]];r.rotation=Math.PI/2*{horizontal:0,vertical:1}[a];r.labelDirection=r.tickDirection=r.nameDirection={top:-1,bottom:1,right:1,left:-1}[o],t.get(["axisTick","inside"])&&(r.tickDirection=-r.tickDirection),V_t(e.labelInside,t.get(["axisLabel","inside"]))&&(r.labelDirection=-r.labelDirection);var c=e.rotate;return null==c&&(c=t.get(["axisLabel","rotate"])),r.labelRotation="top"===o?-c:c,r.z2=1,r}var A1t=["axisLine","axisTickLabel","axisName"],I1t=["splitArea","splitLine"],M1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.axisPointerClass="SingleAxisPointer",n}return Dit(e,t),e.prototype.render=function(e,n,i,r){var o=this.group;o.removeAll();var a=this._axisGroup;this._axisGroup=new oAt;var s=C1t(e),l=new tGt(e,s);S_t(A1t,l.add,l),o.add(this._axisGroup),o.add(l.getGroup()),S_t(I1t,(function(t){e.get([t,"show"])&&D1t[t](this,this.group,this._axisGroup,e)}),this),JEt(a,this._axisGroup,e),t.prototype.render.call(this,e,n,i,r)},e.prototype.remove=function(){mGt(this)},e.type="singleAxis",e}(pGt),D1t={splitLine:function(t,e,n,i){var r=i.axis;if(!r.scale.isBlank()){var o=i.getModel("splitLine"),a=o.getModel("lineStyle"),s=a.get("color");s=s instanceof Array?s:[s];for(var l=i.coordinateSystem.getRect(),u=r.isHorizontal(),c=[],h=0,d=r.getTicksCoords({tickModel:o}),p=[],f=[],g=0;g<d.length;++g){var m=r.toGlobalCoord(d[g].coord);u?(p[0]=m,p[1]=l.y,f[0]=m,f[1]=l.y+l.height):(p[0]=l.x,p[1]=m,f[0]=l.x+l.width,f[1]=m);var y=h++%s.length;c[y]=c[y]||[],c[y].push(new hEt({subPixelOptimize:!0,shape:{x1:p[0],y1:p[1],x2:f[0],y2:f[1]},silent:!0}))}var v=a.getLineStyle(["color"]);for(g=0;g<c.length;++g)e.add(PEt(c[g],{style:x_t({stroke:s[g%s.length]},v),silent:!0}))}},splitArea:function(t,e,n,i){gGt(t,n,i,i)}},T1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.getCoordSysModel=function(){return this},e.type="singleAxis",e.layoutMode="box",e.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:1,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:1}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}}},e}(FOt);__t(T1t,iWt.prototype);var E1t=function(t){function e(e,n,i,r,o){var a=t.call(this,e,n,i)||this;return a.type=r||"value",a.position=o||"bottom",a}return Dit(e,t),e.prototype.isHorizontal=function(){var t=this.position;return"top"===t||"bottom"===t},e.prototype.pointToData=function(t,e){return this.coordinateSystem.pointToData(t)[0]},e}(fWt),N1t=function(){function t(t,e,n){this.type="single",this.dimension="single",this.dimensions=["single"],this.axisPointerEnabled=!0,this.model=t,this._init(t,e,n)}return t.prototype._init=function(t,e,n){var i=this.dimension,r=new E1t(i,ZVt(t),[0,0],t.get("type"),t.get("position")),o="category"===r.type;r.onBand=o&&t.get("boundaryGap"),r.inverse=t.get("inverse"),r.orient=t.get("orient"),t.axis=r,r.model=t,r.coordinateSystem=this,this._axis=r},t.prototype.update=function(t,e){t.eachSeries((function(t){if(t.coordinateSystem===this){var e=t.getData();S_t(e.mapDimensionsAll(this.dimension),(function(t){this._axis.scale.unionExtentFromData(e,t)}),this),KVt(this._axis.scale,this._axis.model)}}),this)},t.prototype.resize=function(t,e){this._rect=IOt({left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")},{width:e.getWidth(),height:e.getHeight()}),this._adjustAxis()},t.prototype.getRect=function(){return this._rect},t.prototype._adjustAxis=function(){var t=this._rect,e=this._axis,n=e.isHorizontal(),i=n?[0,t.width]:[0,t.height],r=e.reverse?1:0;e.setExtent(i[r],i[1-r]),this._updateAxisTransform(e,n?t.x:t.y)},t.prototype._updateAxisTransform=function(t,e){var n=t.getExtent(),i=n[0]+n[1],r=t.isHorizontal();t.toGlobalCoord=r?function(t){return t+e}:function(t){return i-t+e},t.toLocalCoord=r?function(t){return t-e}:function(t){return i-t+e}},t.prototype.getAxis=function(){return this._axis},t.prototype.getBaseAxis=function(){return this._axis},t.prototype.getAxes=function(){return[this._axis]},t.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}},t.prototype.containPoint=function(t){var e=this.getRect(),n=this.getAxis();return"horizontal"===n.orient?n.contain(n.toLocalCoord(t[0]))&&t[1]>=e.y&&t[1]<=e.y+e.height:n.contain(n.toLocalCoord(t[1]))&&t[0]>=e.y&&t[0]<=e.y+e.height},t.prototype.pointToData=function(t){var e=this.getAxis();return[e.coordToData(e.toLocalCoord(t["horizontal"===e.orient?0:1]))]},t.prototype.dataToPoint=function(t){var e=this.getAxis(),n=this.getRect(),i=[],r="horizontal"===e.orient?0:1;return t instanceof Array&&(t=t[0]),i[r]=e.toGlobalCoord(e.dataToCoord(+t)),i[1-r]=0===r?n.y+n.height/2:n.x+n.width/2,i},t.prototype.convertToPixel=function(t,e,n){return O1t(e)===this?this.dataToPoint(n):null},t.prototype.convertFromPixel=function(t,e,n){return O1t(e)===this?this.pointToData(n):null},t}();function O1t(t){var e=t.seriesModel,n=t.singleAxisModel;return n&&n.coordinateSystem||e&&e.coordinateSystem}var F1t={create:function(t,e){var n=[];return t.eachComponent("singleAxis",(function(i,r){var o=new N1t(i,t,e);o.name="single_"+r,o.resize(i,e),i.coordinateSystem=o,n.push(o)})),t.eachSeries((function(t){if("singleAxis"===t.get("coordinateSystem")){var e=t.getReferringComponents("singleAxis",qAt).models[0];t.coordinateSystem=e&&e.coordinateSystem}})),n},dimensions:N1t.prototype.dimensions},R1t=["x","y"],L1t=["width","height"],$1t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.makeElOption=function(t,e,n,i,r){var o=n.axis,a=o.coordinateSystem,s=B1t(a,1-z1t(o)),l=a.dataToPoint(e)[0],u=i.get("type");if(u&&"none"!==u){var c=b0t(i),h=P1t[u](o,l,s);h.style=c,t.graphicKey=h.type,t.pointer=h}S0t(e,t,C1t(n),n,i,r)},e.prototype.getHandleTransform=function(t,e,n){var i=C1t(e,{labelInside:!1});i.labelMargin=n.get(["handle","margin"]);var r=k0t(e.axis,t,i);return{x:r[0],y:r[1],rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}},e.prototype.updateHandleTransform=function(t,e,n,i){var r=n.axis,o=r.coordinateSystem,a=z1t(r),s=B1t(o,a),l=[t.x,t.y];l[a]+=e[a],l[a]=Math.min(s[1],l[a]),l[a]=Math.max(s[0],l[a]);var u=B1t(o,1-a),c=(u[1]+u[0])/2,h=[c,c];return h[a]=l[a],{x:l[0],y:l[1],rotation:t.rotation,cursorPoint:h,tooltipOption:{verticalAlign:"middle"}}},e}(f0t),P1t={line:function(t,e,n){return{type:"Line",subPixelOptimize:!0,shape:C0t([e,n[0]],[e,n[1]],z1t(t))}},shadow:function(t,e,n){var i=t.getBandWidth(),r=n[1]-n[0];return{type:"Rect",shape:A0t([e-i/2,n[0]],[i,r],z1t(t))}}};function z1t(t){return t.isHorizontal()?0:1}function B1t(t,e){var n=t.getRect();return[n[R1t[e]],n[R1t[e]]+n[L1t[e]]]}var V1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="single",e}(nLt);var W1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(e,n,i){var r=EOt(e);t.prototype.init.apply(this,arguments),j1t(e,r)},e.prototype.mergeOption=function(e){t.prototype.mergeOption.apply(this,arguments),j1t(this.option,e)},e.prototype.getCellSize=function(){return this.option.cellSize},e.type="calendar",e.defaultOption={zlevel:0,z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{color:"#fff",borderWidth:1,borderColor:"#ccc"},dayLabel:{show:!0,firstDay:0,position:"start",margin:"50%",nameMap:"en",color:"#000"},monthLabel:{show:!0,position:"start",margin:5,align:"center",nameMap:"en",formatter:null,color:"#000"},yearLabel:{show:!0,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},e}(FOt);function j1t(t,e){var n,i=t.cellSize;1===(n=E_t(i)?i:t.cellSize=[i,i]).length&&(n[1]=n[0]);var r=C_t([0,1],(function(t){return function(t,e){return null!=t[SOt[e][0]]||null!=t[SOt[e][1]]&&null!=t[SOt[e][2]]}(e,t)&&(n[t]="auto"),null!=n[t]&&"auto"!==n[t]}));TOt(t,e,{type:"box",ignoreSize:r})}var U1t={EN:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CN:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},G1t={EN:["S","M","T","W","T","F","S"],CN:["日","一","二","三","四","五","六"]},H1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){var i=this.group;i.removeAll();var r=t.coordinateSystem,o=r.getRangeInfo(),a=r.getOrient();this._renderDayRect(t,o,i),this._renderLines(t,o,a,i),this._renderYearText(t,o,a,i),this._renderMonthText(t,a,i),this._renderWeekText(t,o,a,i)},e.prototype._renderDayRect=function(t,e,n){for(var i=t.coordinateSystem,r=t.getModel("itemStyle").getItemStyle(),o=i.getCellWidth(),a=i.getCellHeight(),s=e.start.time;s<=e.end.time;s=i.getNextNDay(s,1).time){var l=i.dataToRect([s],!1).tl,u=new mDt({shape:{x:l[0],y:l[1],width:o,height:a},cursor:"default",style:r});n.add(u)}},e.prototype._renderLines=function(t,e,n,i){var r=this,o=t.coordinateSystem,a=t.getModel(["splitLine","lineStyle"]).getLineStyle(),s=t.get(["splitLine","show"]),l=a.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var u=e.start,c=0;u.time<=e.end.time;c++){d(u.formatedDate),0===c&&(u=o.getDateInfo(e.start.y+"-"+e.start.m));var h=u.date;h.setMonth(h.getMonth()+1),u=o.getDateInfo(h)}function d(e){r._firstDayOfMonth.push(o.getDateInfo(e)),r._firstDayPoints.push(o.dataToRect([e],!1).tl);var l=r._getLinePointsOfOneWeek(t,e,n);r._tlpoints.push(l[0]),r._blpoints.push(l[l.length-1]),s&&r._drawSplitline(l,a,i)}d(o.getNextNDay(e.end.time,1).formatedDate),s&&this._drawSplitline(r._getEdgesPoints(r._tlpoints,l,n),a,i),s&&this._drawSplitline(r._getEdgesPoints(r._blpoints,l,n),a,i)},e.prototype._getEdgesPoints=function(t,e,n){var i=[t[0].slice(),t[t.length-1].slice()],r="horizontal"===n?0:1;return i[0][r]=i[0][r]-e/2,i[1][r]=i[1][r]+e/2,i},e.prototype._drawSplitline=function(t,e,n){var i=new lEt({z2:20,shape:{points:t},style:e});n.add(i)},e.prototype._getLinePointsOfOneWeek=function(t,e,n){for(var i=t.coordinateSystem,r=i.getDateInfo(e),o=[],a=0;a<7;a++){var s=i.getNextNDay(r.time,a),l=i.dataToRect([s.time],!1);o[2*s.day]=l.tl,o[2*s.day+1]=l["horizontal"===n?"bl":"tr"]}return o},e.prototype._formatterLabel=function(t,e){return"string"==typeof t&&t?(n=t,S_t(e,(function(t,e){n=n.replace("{"+e+"}",i?gOt(t):t)})),n):"function"==typeof t?t(e):e.nameMap;var n,i},e.prototype._yearTextPositionControl=function(t,e,n,i,r){var o=e[0],a=e[1],s=["center","bottom"];"bottom"===i?(a+=r,s=["center","top"]):"left"===i?o-=r:"right"===i?(o+=r,s=["center","top"]):a-=r;var l=0;return"left"!==i&&"right"!==i||(l=Math.PI/2),{rotation:l,x:o,y:a,style:{align:s[0],verticalAlign:s[1]}}},e.prototype._renderYearText=function(t,e,n,i){var r=t.getModel("yearLabel");if(r.get("show")){var o=r.get("margin"),a=r.get("position");a||(a="horizontal"!==n?"top":"left");var s=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],l=(s[0][0]+s[1][0])/2,u=(s[0][1]+s[1][1])/2,c="horizontal"===n?0:1,h={top:[l,s[c][1]],bottom:[l,s[1-c][1]],left:[s[1-c][0],u],right:[s[c][0],u]},d=e.start.y;+e.end.y>+e.start.y&&(d=d+"-"+e.end.y);var p=r.get("formatter"),f={start:e.start.y,end:e.end.y,nameMap:d},g=this._formatterLabel(p,f),m=new xDt({z2:30,style:hNt(r,{text:g})});m.attr(this._yearTextPositionControl(m,h[a],n,a,o)),i.add(m)}},e.prototype._monthTextPositionControl=function(t,e,n,i,r){var o="left",a="top",s=t[0],l=t[1];return"horizontal"===n?(l+=r,e&&(o="center"),"start"===i&&(a="bottom")):(s+=r,e&&(a="middle"),"start"===i&&(o="right")),{x:s,y:l,align:o,verticalAlign:a}},e.prototype._renderMonthText=function(t,e,n){var i=t.getModel("monthLabel");if(i.get("show")){var r=i.get("nameMap"),o=i.get("margin"),a=i.get("position"),s=i.get("align"),l=[this._tlpoints,this._blpoints];O_t(r)&&(r=U1t[r.toUpperCase()]||[]);var u="start"===a?0:1,c="horizontal"===e?0:1;o="start"===a?-o:o;for(var h="center"===s,d=0;d<l[u].length-1;d++){var p=l[u][d].slice(),f=this._firstDayOfMonth[d];if(h){var g=this._firstDayPoints[d];p[c]=(g[c]+l[0][d+1][c])/2}var m=i.get("formatter"),y=r[+f.m-1],v={yyyy:f.y,yy:(f.y+"").slice(2),MM:f.m,M:+f.m,nameMap:y},x=this._formatterLabel(m,v),b=new xDt({z2:30,style:v_t(hNt(i,{text:x}),this._monthTextPositionControl(p,h,e,a,o))});n.add(b)}}},e.prototype._weekTextPositionControl=function(t,e,n,i,r){var o="center",a="middle",s=t[0],l=t[1],u="start"===n;return"horizontal"===e?(s=s+i+(u?1:-1)*r[0]/2,o=u?"right":"left"):(l=l+i+(u?1:-1)*r[1]/2,a=u?"bottom":"top"),{x:s,y:l,align:o,verticalAlign:a}},e.prototype._renderWeekText=function(t,e,n,i){var r=t.getModel("dayLabel");if(r.get("show")){var o=t.coordinateSystem,a=r.get("position"),s=r.get("nameMap"),l=r.get("margin"),u=o.getFirstDayOfWeek();O_t(s)&&(s=G1t[s.toUpperCase()]||[]);var c=o.getNextNDay(e.end.time,7-e.lweek).time,h=[o.getCellWidth(),o.getCellHeight()];l=dAt(l,Math.min(h[1],h[0])),"start"===a&&(c=o.getNextNDay(e.start.time,-(7+e.fweek)).time,l=-l);for(var d=0;d<7;d++){var p,f=o.getNextNDay(c,d),g=o.dataToRect([f.time],!1).center;p=Math.abs((d+u)%7);var m=new xDt({z2:30,style:v_t(hNt(r,{text:s[p]}),this._weekTextPositionControl(g,n,a,l,h))});i.add(m)}}},e.type="calendar",e}(nLt),q1t=function(){function t(e,n,i){this.type="calendar",this.dimensions=t.dimensions,this.getDimensionsInfo=t.getDimensionsInfo,this._model=e}return t.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},t.prototype.getRangeInfo=function(){return this._rangeInfo},t.prototype.getModel=function(){return this._model},t.prototype.getRect=function(){return this._rect},t.prototype.getCellWidth=function(){return this._sw},t.prototype.getCellHeight=function(){return this._sh},t.prototype.getOrient=function(){return this._orient},t.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},t.prototype.getDateInfo=function(t){var e=(t=wAt(t)).getFullYear(),n=t.getMonth()+1,i=n<10?"0"+n:""+n,r=t.getDate(),o=r<10?"0"+r:""+r,a=t.getDay();return{y:e+"",m:i,d:o,day:a=Math.abs((a+7-this.getFirstDayOfWeek())%7),time:t.getTime(),formatedDate:e+"-"+i+"-"+o,date:t}},t.prototype.getNextNDay=function(t,e){return 0===(e=e||0)||(t=new Date(this.getDateInfo(t).time)).setDate(t.getDate()+e),this.getDateInfo(t)},t.prototype.update=function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var n=this._rangeInfo.weeks||1,i=["width","height"],r=this._model.getCellSize().slice(),o=this._model.getBoxLayoutParams(),a="horizontal"===this._orient?[n,7]:[7,n];S_t([0,1],(function(t){u(r,t)&&(o[i[t]]=r[t]*a[t])}));var s={width:e.getWidth(),height:e.getHeight()},l=this._rect=IOt(o,s);function u(t,e){return null!=t[e]&&"auto"!==t[e]}S_t([0,1],(function(t){u(r,t)||(r[t]=l[i[t]]/a[t])})),this._sw=r[0],this._sh=r[1]},t.prototype.dataToPoint=function(t,e){E_t(t)&&(t=t[0]),null==e&&(e=!0);var n=this.getDateInfo(t),i=this._rangeInfo,r=n.formatedDate;if(e&&!(n.time>=i.start.time&&n.time<i.end.time+864e5))return[NaN,NaN];var o=n.day,a=this._getRangeInfo([i.start.time,r]).nthWeek;return"vertical"===this._orient?[this._rect.x+o*this._sw+this._sw/2,this._rect.y+a*this._sh+this._sh/2]:[this._rect.x+a*this._sw+this._sw/2,this._rect.y+o*this._sh+this._sh/2]},t.prototype.pointToData=function(t){var e=this.pointToDate(t);return e&&e.time},t.prototype.dataToRect=function(t,e){var n=this.dataToPoint(t,e);return{contentShape:{x:n[0]-(this._sw-this._lineWidth)/2,y:n[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:n,tl:[n[0]-this._sw/2,n[1]-this._sh/2],tr:[n[0]+this._sw/2,n[1]-this._sh/2],br:[n[0]+this._sw/2,n[1]+this._sh/2],bl:[n[0]-this._sw/2,n[1]+this._sh/2]}},t.prototype.pointToDate=function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,n=Math.floor((t[1]-this._rect.y)/this._sh)+1,i=this._rangeInfo.range;return"vertical"===this._orient?this._getDateByWeeksAndDay(n,e-1,i):this._getDateByWeeksAndDay(e,n-1,i)},t.prototype.convertToPixel=function(t,e,n){var i=X1t(e);return i===this?i.dataToPoint(n):null},t.prototype.convertFromPixel=function(t,e,n){var i=X1t(e);return i===this?i.pointToData(n):null},t.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},t.prototype._initRangeOption=function(){var t,e=this._model.get("range");if(E_t(e)&&1===e.length&&(e=e[0]),E_t(e))t=e;else{var n=e.toString();if(/^\d{4}$/.test(n)&&(t=[n+"-01-01",n+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(n)){var i=this.getDateInfo(n),r=i.date;r.setMonth(r.getMonth()+1);var o=this.getNextNDay(r,-1);t=[i.formatedDate,o.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(n)&&(t=[n,n])}if(!t)return e;var a=this._getRangeInfo(t);return a.start.time>a.end.time&&t.reverse(),t},t.prototype._getRangeInfo=function(t){var e,n=[this.getDateInfo(t[0]),this.getDateInfo(t[1])];n[0].time>n[1].time&&(e=!0,n.reverse());var i=Math.floor(n[1].time/864e5)-Math.floor(n[0].time/864e5)+1,r=new Date(n[0].time),o=r.getDate(),a=n[1].date.getDate();r.setDate(o+i-1);var s=r.getDate();if(s!==a)for(var l=r.getTime()-n[1].time>0?1:-1;(s=r.getDate())!==a&&(r.getTime()-n[1].time)*l>0;)i-=l,r.setDate(s-l);var u=Math.floor((i+n[0].day+6)/7),c=e?1-u:u-1;return e&&n.reverse(),{range:[n[0].formatedDate,n[1].formatedDate],start:n[0],end:n[1],allDay:i,weeks:u,nthWeek:c,fweek:n[0].day,lweek:n[1].day}},t.prototype._getDateByWeeksAndDay=function(t,e,n){var i=this._getRangeInfo(n);if(t>i.weeks||0===t&&e<i.fweek||t===i.weeks&&e>i.lweek)return null;var r=7*(t-1)-i.fweek+e,o=new Date(i.start.time);return o.setDate(+i.start.d+r),this.getDateInfo(o)},t.create=function(e,n){var i=[];return e.eachComponent("calendar",(function(r){var o=new t(r,e,n);i.push(o),r.coordinateSystem=o})),e.eachSeries((function(t){"calendar"===t.get("coordinateSystem")&&(t.coordinateSystem=i[t.get("calendarIndex")||0])})),i},t.dimensions=["time","value"],t}();function X1t(t){var e=t.calendarModel,n=t.seriesModel;return e?e.coordinateSystem:n?n.coordinateSystem:null}var Y1t=jAt(),K1t={path:null,compoundPath:null,group:oAt,image:uDt,text:xDt},Z1t=function(t){var e=t.graphic;E_t(e)?e[0]&&e[0].elements?t.graphic=[t.graphic[0]]:t.graphic=[{elements:e}]:e&&!e.elements&&(t.graphic=[{elements:[e]}])},J1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.preventAutoZ=!0,n}return Dit(e,t),e.prototype.mergeOption=function(e,n){var i=this.option.elements;this.option.elements=null,t.prototype.mergeOption.call(this,e,n),this.option.elements=i},e.prototype.optionUpdated=function(t,e){var n=this.option,i=(e?n:t).elements,r=n.elements=e?[]:n.elements,o=[];this._flatten(i,o,null);var a=LAt(r,o,"normalMerge"),s=this._elOptionsToUpdate=[];S_t(a,(function(t,e){var n=t.newOption;n&&(s.push(n),function(t,e){var n=t.existing;if(e.id=t.keyInfo.id,!e.type&&n&&(e.type=n.type),null==e.parentId){var i=e.parentOption;i?e.parentId=i.id:n&&(e.parentId=n.parentId)}e.parentOption=null}(t,n),function(t,e,n){var i=v_t({},n),r=t[e],o=n.$action||"merge";"merge"===o?r?(m_t(r,i,!0),TOt(r,i,{ignoreSize:!0}),NOt(n,r)):t[e]=i:"replace"===o?t[e]=i:"remove"===o&&r&&(t[e]=null)}(r,e,n),function(t,e){if(!t)return;if(t.hv=e.hv=[n2t(e,["left","right"]),n2t(e,["top","bottom"])],"group"===t.type){var n=t,i=e;null==n.width&&(n.width=i.width=0),null==n.height&&(n.height=i.height=0)}}(r[e],n))}),this);for(var l=r.length-1;l>=0;l--)null==r[l]?r.splice(l,1):delete r[l].$action},e.prototype._flatten=function(t,e,n){S_t(t,(function(t){if(t){n&&(t.parentOption=n),e.push(t);var i=t.children;"group"===t.type&&i&&this._flatten(i,e,t),delete t.children}}),this)},e.prototype.useElOptionsToUpdate=function(){var t=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,t},e.type="graphic",e.defaultOption={elements:[]},e}(FOt),Q1t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(){this._elMap=Z_t()},e.prototype.render=function(t,e,n){t!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=t,this._updateElements(t),this._relocate(t,n)},e.prototype._updateElements=function(t){var e=t.useElOptionsToUpdate();if(e){var n=this._elMap,i=this.group;S_t(e,(function(e){var r=zAt(e.id,null),o=null!=r?n.get(r):null,a=zAt(e.parentId,null),s=null!=a?n.get(a):i,l=e.type,u=e.style;"text"===l&&u&&e.hv&&e.hv[1]&&(u.textVerticalAlign=u.textBaseline=u.verticalAlign=u.align=null);var c=e.textContent,h=e.textConfig;if(u&&BJt(u,l,!!h,!!c)){var d=VJt(u,l,!0);!h&&d.textConfig&&(h=e.textConfig=d.textConfig),!c&&d.textContent&&(c=d.textContent)}var p=function(t){return t=v_t({},t),S_t(["id","parentId","$action","hv","bounding","textContent"].concat(kOt),(function(e){delete t[e]})),t}(e),f=e.$action||"merge";"merge"===f?o?o.attr(p):t2t(r,s,p,n):"replace"===f?(e2t(o,n),t2t(r,s,p,n)):"remove"===f&&e2t(o,n);var g=n.get(r);if(g&&c)if("merge"===f){var m=g.getTextContent();m?m.attr(c):g.setTextContent(new xDt(c))}else"replace"===f&&g.setTextContent(new xDt(c));if(g){var y=Y1t(g);y.__ecGraphicWidthOption=e.width,y.__ecGraphicHeightOption=e.height,function(t,e,n){var i=IDt(t).eventData;t.silent||t.ignore||i||(i=IDt(t).eventData={componentType:"graphic",componentIndex:e.componentIndex,name:t.name});i&&(i.info=n.info)}(g,t,e),rNt({el:g,componentModel:t,itemName:g.name,itemTooltipOption:e.tooltip})}}))}},e.prototype._relocate=function(t,e){for(var n=t.option.elements,i=this.group,r=this._elMap,o=e.getWidth(),a=e.getHeight(),s=0;s<n.length;s++){if((p=null!=(d=zAt((h=n[s]).id,null))?r.get(d):null)&&p.isGroup){var l=(f=p.parent)===i,u=Y1t(p),c=Y1t(f);u.__ecGraphicWidth=dAt(u.__ecGraphicWidthOption,l?o:c.__ecGraphicWidth)||0,u.__ecGraphicHeight=dAt(u.__ecGraphicHeightOption,l?a:c.__ecGraphicHeight)||0}}for(s=n.length-1;s>=0;s--){var h,d,p;if(p=null!=(d=zAt((h=n[s]).id,null))?r.get(d):null){var f=p.parent;c=Y1t(f);MOt(p,h,f===i?{width:o,height:a}:{width:c.__ecGraphicWidth,height:c.__ecGraphicHeight},null,{hv:h.hv,boundingMode:h.bounding})}}},e.prototype._clear=function(){var t=this._elMap;t.each((function(e){e2t(e,t)})),this._elMap=Z_t()},e.prototype.dispose=function(){this._clear()},e.type="graphic",e}(nLt);function t2t(t,e,n,i){var r=n.type,o=new(tkt(K1t,r)?K1t[r]:FEt(r))(n);e.add(o),i.set(t,o),Y1t(o).__ecGraphicId=t}function e2t(t,e){var n=t&&t.parent;n&&("group"===t.type&&t.traverse((function(t){e2t(t,e)})),e.removeKey(Y1t(t).__ecGraphicId),n.remove(t))}function n2t(t,e){var n;return S_t(e,(function(e){null!=t[e]&&"auto"!==t[e]&&(n=!0)})),n}var i2t=["x","y","radius","angle","single"],r2t=["cartesian2d","polar","singleAxis"];function o2t(t){return t+"Axis"}function a2t(t,e){var n,i=Z_t(),r=[],o=Z_t();t.eachComponent({mainType:"dataZoom",query:e},(function(t){o.get(t.uid)||s(t)}));do{n=!1,t.eachComponent("dataZoom",a)}while(n);function a(t){!o.get(t.uid)&&function(t){var e=!1;return t.eachTargetAxis((function(t,n){var r=i.get(t);r&&r[n]&&(e=!0)})),e}(t)&&(s(t),n=!0)}function s(t){o.set(t.uid,!0),r.push(t),t.eachTargetAxis((function(t,e){(i.get(t)||i.set(t,[]))[e]=!0}))}return r}function s2t(t){var e=t.ecModel,n={infoList:[],infoMap:Z_t()};return t.eachTargetAxis((function(t,i){var r=e.getComponent(o2t(t),i);if(r){var o=r.getCoordSysModel();if(o){var a=o.uid,s=n.infoMap.get(a);s||(s={model:o,axisModels:[]},n.infoList.push(s),n.infoMap.set(a,s)),s.axisModels.push(r)}}})),n}var l2t=function(){function t(){this.indexList=[],this.indexMap=[]}return t.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},t}(),u2t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._autoThrottle=!0,n._noTarget=!0,n._rangePropMode=["percent","percent"],n}return Dit(e,t),e.prototype.init=function(t,e,n){var i=c2t(t);this.settledOption=i,this.mergeDefaultAndTheme(t,n),this._doInit(i)},e.prototype.mergeOption=function(t){var e=c2t(t);m_t(this.option,t,!0),m_t(this.settledOption,e,!0),this._doInit(e)},e.prototype._doInit=function(t){var e=this.option;this._setDefaultThrottle(t),this._updateRangeUse(t);var n=this.settledOption;S_t([["start","startValue"],["end","endValue"]],(function(t,i){"value"===this._rangePropMode[i]&&(e[t[0]]=n[t[0]]=null)}),this),this._resetTarget()},e.prototype._resetTarget=function(){var t=this.get("orient",!0),e=this._targetAxisInfoMap=Z_t();this._fillSpecifiedTargetAxis(e)?this._orient=t||this._makeAutoOrientByTargetAxis():(this._orient=t||"horizontal",this._fillAutoTargetAxisByOrient(e,this._orient)),this._noTarget=!0,e.each((function(t){t.indexList.length&&(this._noTarget=!1)}),this)},e.prototype._fillSpecifiedTargetAxis=function(t){var e=!1;return S_t(i2t,(function(n){var i=this.getReferringComponents(o2t(n),XAt);if(i.specified){e=!0;var r=new l2t;S_t(i.models,(function(t){r.add(t.componentIndex)})),t.set(n,r)}}),this),e},e.prototype._fillAutoTargetAxisByOrient=function(t,e){var n=this.ecModel,i=!0;if(i){var r="vertical"===e?"y":"x";o(n.findComponents({mainType:r+"Axis"}),r)}i&&o(n.findComponents({mainType:"singleAxis",filter:function(t){return t.get("orient",!0)===e}}),"single");function o(e,n){var r=e[0];if(r){var o=new l2t;if(o.add(r.componentIndex),t.set(n,o),i=!1,"x"===n||"y"===n){var a=r.getReferringComponents("grid",qAt).models[0];a&&S_t(e,(function(t){r.componentIndex!==t.componentIndex&&a===t.getReferringComponents("grid",qAt).models[0]&&o.add(t.componentIndex)}))}}}i&&S_t(i2t,(function(e){if(i){var r=n.findComponents({mainType:o2t(e),filter:function(t){return"category"===t.get("type",!0)}});if(r[0]){var o=new l2t;o.add(r[0].componentIndex),t.set(e,o),i=!1}}}),this)},e.prototype._makeAutoOrientByTargetAxis=function(){var t;return this.eachTargetAxis((function(e){!t&&(t=e)}),this),"y"===t?"vertical":"horizontal"},e.prototype._setDefaultThrottle=function(t){if(t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var e=this.ecModel.option;this.option.throttle=e.animation&&e.animationDurationUpdate>0?100:20}},e.prototype._updateRangeUse=function(t){var e=this._rangePropMode,n=this.get("rangeMode");S_t([["start","startValue"],["end","endValue"]],(function(i,r){var o=null!=t[i[0]],a=null!=t[i[1]];o&&!a?e[r]="percent":!o&&a?e[r]="value":n?e[r]=n[r]:o&&(e[r]="percent")}))},e.prototype.noTarget=function(){return this._noTarget},e.prototype.getFirstTargetAxisModel=function(){var t;return this.eachTargetAxis((function(e,n){null==t&&(t=this.ecModel.getComponent(o2t(e),n))}),this),t},e.prototype.eachTargetAxis=function(t,e){this._targetAxisInfoMap.each((function(n,i){S_t(n.indexList,(function(n){t.call(e,i,n)}))}))},e.prototype.getAxisProxy=function(t,e){var n=this.getAxisModel(t,e);if(n)return n.__dzAxisProxy},e.prototype.getAxisModel=function(t,e){var n=this._targetAxisInfoMap.get(t);if(n&&n.indexMap[e])return this.ecModel.getComponent(o2t(t),e)},e.prototype.setRawRange=function(t){var e=this.option,n=this.settledOption;S_t([["start","startValue"],["end","endValue"]],(function(i){null==t[i[0]]&&null==t[i[1]]||(e[i[0]]=n[i[0]]=t[i[0]],e[i[1]]=n[i[1]]=t[i[1]])}),this),this._updateRangeUse(t)},e.prototype.setCalculatedRange=function(t){var e=this.option;S_t(["start","startValue","end","endValue"],(function(n){e[n]=t[n]}))},e.prototype.getPercentRange=function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},e.prototype.getValueRange=function(t,e){if(null!=t||null!=e)return this.getAxisProxy(t,e).getDataValueWindow();var n=this.findRepresentativeAxisProxy();return n?n.getDataValueWindow():void 0},e.prototype.findRepresentativeAxisProxy=function(t){if(t)return t.__dzAxisProxy;for(var e,n=this._targetAxisInfoMap.keys(),i=0;i<n.length;i++)for(var r=n[i],o=this._targetAxisInfoMap.get(r),a=0;a<o.indexList.length;a++){var s=this.getAxisProxy(r,o.indexList[a]);if(s.hostedBy(this))return s;e||(e=s)}return e},e.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},e.prototype.getOrient=function(){return this._orient},e.type="dataZoom",e.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],e.defaultOption={zlevel:0,z:4,filterMode:"filter",start:0,end:100},e}(FOt);function c2t(t){var e={};return S_t(["start","end","startValue","endValue","throttle"],(function(n){t.hasOwnProperty(n)&&(e[n]=t[n])})),e}var h2t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="dataZoom.select",e}(u2t),d2t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n,i){this.dataZoomModel=t,this.ecModel=e,this.api=n},e.type="dataZoom",e}(nLt),p2t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="dataZoom.select",e}(d2t),f2t=S_t,g2t=fAt,m2t=function(){function t(t,e,n,i){this._dimName=t,this._axisIndex=e,this.ecModel=i,this._dataZoomModel=n}return t.prototype.hostedBy=function(t){return this._dataZoomModel===t},t.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},t.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},t.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries((function(e){if(function(t){var e=t.get("coordinateSystem");return w_t(r2t,e)>=0}(e)){var n=o2t(this._dimName),i=e.getReferringComponents(n,qAt).models[0];i&&this._axisIndex===i.componentIndex&&t.push(e)}}),this),t},t.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},t.prototype.getMinMaxSpan=function(){return g_t(this._minMaxSpan)},t.prototype.calculateDataWindow=function(t){var e,n=this._dataExtent,i=this.getAxisModel().axis.scale,r=this._dataZoomModel.getRangePropMode(),o=[0,100],a=[],s=[];f2t(["start","end"],(function(l,u){var c=t[l],h=t[l+"Value"];"percent"===r[u]?(null==c&&(c=o[u]),h=i.parse(hAt(c,o,n))):(e=!0,c=hAt(h=null==h?n[u]:i.parse(h),n,o)),s[u]=h,a[u]=c})),g2t(s),g2t(a);var l=this._minMaxSpan;function u(t,e,n,r,o){var a=o?"Span":"ValueSpan";MYt(0,t,n,"all",l["min"+a],l["max"+a]);for(var s=0;s<2;s++)e[s]=hAt(t[s],n,r,!0),o&&(e[s]=i.parse(e[s]))}return e?u(s,a,n,o,!1):u(a,s,o,n,!0),{valueWindow:s,percentWindow:a}},t.prototype.reset=function(t){if(t===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=function(t,e,n){var i=[1/0,-1/0];f2t(n,(function(t){!function(t,e,n){e&&S_t(nWt(e,n),(function(n){var i=e.getApproximateExtent(n);i[0]<t[0]&&(t[0]=i[0]),i[1]>t[1]&&(t[1]=i[1])}))}(i,t.getData(),e)}));var r=t.getAxisModel(),o=qVt(r.axis.scale,r,i).calculate();return[o.min,o.max]}(this,this._dimName,e),this._updateMinMaxSpan();var n=this.calculateDataWindow(t.settledOption);this._valueWindow=n.valueWindow,this._percentWindow=n.percentWindow,this._setAxisModel()}},t.prototype.filterData=function(t,e){if(t===this._dataZoomModel){var n=this._dimName,i=this.getTargetSeriesModels(),r=t.get("filterMode"),o=this._valueWindow;"none"!==r&&f2t(i,(function(t){var e=t.getData(),i=e.mapDimensionsAll(n);i.length&&("weakFilter"===r?e.filterSelf((function(t){for(var n,r,a,s=0;s<i.length;s++){var l=e.get(i[s],t),u=!isNaN(l),c=l<o[0],h=l>o[1];if(u&&!c&&!h)return!0;u&&(a=!0),c&&(n=!0),h&&(r=!0)}return a&&n&&r})):f2t(i,(function(n){if("empty"===r)t.setData(e=e.map(n,(function(t){return function(t){return t>=o[0]&&t<=o[1]}(t)?t:NaN})));else{var i={};i[n]=o,e.selectRange(i)}})),f2t(i,(function(t){e.setApproximateExtent(o,t)})))}))}},t.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,n=this._dataExtent;f2t(["min","max"],(function(i){var r=e.get(i+"Span"),o=e.get(i+"ValueSpan");null!=o&&(o=this.getAxisModel().axis.scale.parse(o)),null!=o?r=hAt(n[0]+o,n,[0,100],!0):null!=r&&(o=hAt(r,[0,100],n,!0)-n[0]),t[i+"Span"]=r,t[i+"ValueSpan"]=o}),this)},t.prototype._setAxisModel=function(){var t=this.getAxisModel(),e=this._percentWindow,n=this._valueWindow;if(e){var i=mAt(n,[0,500]);i=Math.min(i,20);var r=t.axis.scale.rawExtentInfo;0!==e[0]&&r.setDeterminedMinMax("min",+n[0].toFixed(i)),100!==e[1]&&r.setDeterminedMinMax("max",+n[1].toFixed(i)),r.freeze()}},t}();var y2t={getTargetSeries:function(t){function e(e){t.eachComponent("dataZoom",(function(n){n.eachTargetAxis((function(i,r){var o=t.getComponent(o2t(i),r);e(i,r,o,n)}))}))}e((function(t,e,n,i){n.__dzAxisProxy=null}));var n=[];e((function(e,i,r,o){r.__dzAxisProxy||(r.__dzAxisProxy=new m2t(e,i,o,t),n.push(r.__dzAxisProxy))}));var i=Z_t();return S_t(n,(function(t){S_t(t.getTargetSeriesModels(),(function(t){i.set(t.uid,t)}))})),i},overallReset:function(t,e){t.eachComponent("dataZoom",(function(t){t.eachTargetAxis((function(e,n){t.getAxisProxy(e,n).reset(t)})),t.eachTargetAxis((function(n,i){t.getAxisProxy(n,i).filterData(t,e)}))})),t.eachComponent("dataZoom",(function(t){var e=t.findRepresentativeAxisProxy();if(e){var n=e.getDataPercentWindow(),i=e.getDataValueWindow();t.setCalculatedRange({start:n[0],end:n[1],startValue:i[0],endValue:i[1]})}}))}};var v2t=!1;function x2t(t){v2t||(v2t=!0,t.registerProcessor(t.PRIORITY.PROCESSOR.FILTER,y2t),function(t){t.registerAction("dataZoom",(function(t,e){S_t(a2t(e,t),(function(e){e.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})}))}))}(t),t.registerSubTypeDefaulter("dataZoom",(function(){return"slider"})))}function b2t(t){t.registerComponentModel(h2t),t.registerComponentView(p2t),x2t(t)}var w2t=function(){},_2t={};function k2t(t,e){_2t[t]=e}function S2t(t){return _2t[t]}var C2t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.optionUpdated=function(){t.prototype.optionUpdated.apply(this,arguments);var e=this.ecModel;S_t(this.option.feature,(function(t,n){var i=S2t(n);i&&(i.getDefaultOption&&(i.defaultOption=i.getDefaultOption(e)),m_t(t,i.defaultOption))}))},e.type="toolbox",e.layoutMode={type:"box",ignoreSize:!0},e.defaultOption={show:!0,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:!1,position:"bottom"}},e}(FOt);function A2t(t,e){var n=dOt(e.get("padding")),i=e.getItemStyle(["color","opacity"]);return i.fill=e.get("backgroundColor"),t=new mDt({shape:{x:t.x-n[3],y:t.y-n[0],width:t.width+n[1]+n[3],height:t.height+n[0]+n[2],r:e.get("borderRadius")},style:i,silent:!0,z2:-1})}var I2t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.render=function(t,e,n,i){var r=this.group;if(r.removeAll(),t.get("show")){var o=+t.get("itemSize"),a=t.get("feature")||{},s=this._features||(this._features={}),l=[];S_t(a,(function(t,e){l.push(e)})),new vBt(this._featureNames||[],l).add(u).update(u).remove(T_t(u,null)).execute(),this._featureNames=l,function(t,e,n){var i=e.getBoxLayoutParams(),r=e.get("padding"),o={width:n.getWidth(),height:n.getHeight()},a=IOt(i,o,r);AOt(e.get("orient"),t,e.get("itemGap"),a.width,a.height),MOt(t,i,o,r)}(r,t,n),r.add(A2t(r.getBoundingRect(),t)),r.eachChild((function(t){var e=t.__title,i=t.ensureState("emphasis"),a=i.textConfig||(i.textConfig={}),s=t.getTextContent(),l=s&&s.states.emphasis;if(l&&!N_t(l)&&e){var u=l.style||(l.style={}),c=UCt(e,xDt.makeFont(u)),h=t.x+r.x,d=!1;t.y+r.y+o+c.height>n.getHeight()&&(a.position="top",d=!0);var p=d?-5-c.height:o+8;h+c.width/2>n.getWidth()?(a.position=["100%",p],u.align="right"):h-c.width/2<0&&(a.position=[0,p],u.align="left")}}))}function u(u,c){var h,d=l[u],p=l[c],f=a[d],g=new NNt(f,t,t.ecModel);if(i&&null!=i.newTitle&&i.featureName===d&&(f.title=i.newTitle),d&&!p){if(function(t){return 0===t.indexOf("my")}(d))h={onclick:g.option.onclick,featureName:d};else{var m=S2t(d);if(!m)return;h=new m}s[d]=h}else if(!(h=s[p]))return;h.uid=FNt("toolbox-feature"),h.model=g,h.ecModel=e,h.api=n;var y=h instanceof w2t;d||!p?!g.get("show")||y&&h.unusable?y&&h.remove&&h.remove(e,n):(!function(i,a,s){var l,u,c=i.getModel("iconStyle"),h=i.getModel(["emphasis","iconStyle"]),d=a instanceof w2t&&a.getIcons?a.getIcons():i.get("icon"),p=i.get("title")||{};"string"==typeof d?(l={})[s]=d:l=d;"string"==typeof p?(u={})[s]=p:u=p;var f=i.iconPaths={};S_t(l,(function(s,l){var d=tNt(s,{},{x:-o/2,y:-o/2,width:o,height:o});d.setStyle(c.getItemStyle()),d.ensureState("emphasis").style=h.getItemStyle();var p=new xDt({style:{text:u[l],align:h.get("textAlign"),borderRadius:h.get("textBorderRadius"),padding:h.get("textPadding"),fill:null},ignore:!0});d.setTextContent(p),rNt({el:d,componentModel:t,itemName:l,formatterParamsExtra:{title:u[l]}}),d.__title=u[l],d.on("mouseover",(function(){var e=h.getItemStyle(),n="vertical"===t.get("orient")?null==t.get("right")?"right":"left":null==t.get("bottom")?"bottom":"top";p.setStyle({fill:h.get("textFill")||e.fill||e.stroke||"#000",backgroundColor:h.get("textBackgroundColor")}),d.setTextConfig({position:h.get("textPosition")||n}),p.ignore=!t.get("showTitle"),KDt(this)})).on("mouseout",(function(){"emphasis"!==i.get(["iconStatus",l])&&ZDt(this),p.hide()})),("emphasis"===i.get(["iconStatus",l])?KDt:ZDt)(d),r.add(d),d.on("click",D_t(a.onclick,a,e,n,l)),f[l]=d}))}(g,h,d),g.setIconStatus=function(t,e){var n=this.option,i=this.iconPaths;n.iconStatus=n.iconStatus||{},n.iconStatus[t]=e,i[t]&&("emphasis"===e?KDt:ZDt)(i[t])},h instanceof w2t&&h.render&&h.render(g,e,n,i)):y&&h.dispose&&h.dispose(e,n)}},e.prototype.updateView=function(t,e,n,i){S_t(this._features,(function(t){t instanceof w2t&&t.updateView&&t.updateView(t.model,e,n,i)}))},e.prototype.remove=function(t,e){S_t(this._features,(function(n){n instanceof w2t&&n.remove&&n.remove(t,e)})),this.group.removeAll()},e.prototype.dispose=function(t,e){S_t(this._features,(function(n){n instanceof w2t&&n.dispose&&n.dispose(t,e)}))},e.type="toolbox",e}(nLt);var M2t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.onclick=function(t,e){var n=this.model,i=n.get("name")||t.get("title.0.text")||"echarts",r="svg"===e.getZr().painter.getType(),o=r?"svg":n.get("type",!0)||"png",a=e.getConnectedDataURL({type:o,backgroundColor:n.get("backgroundColor",!0)||t.get("backgroundColor")||"#fff",connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")});if("function"!=typeof MouseEvent||!t_t.browser.newEdge&&(t_t.browser.ie||t_t.browser.edge))if(window.navigator.msSaveOrOpenBlob||r){var s=a.split(","),l=s[0].indexOf("base64")>-1,u=r?decodeURIComponent(s[1]):s[1];l&&(u=window.atob(u));var c=i+"."+o;if(window.navigator.msSaveOrOpenBlob){for(var h=u.length,d=new Uint8Array(h);h--;)d[h]=u.charCodeAt(h);var p=new Blob([d]);window.navigator.msSaveOrOpenBlob(p,c)}else{var f=document.createElement("iframe");document.body.appendChild(f);var g=f.contentWindow,m=g.document;m.open("image/svg+xml","replace"),m.write(u),m.close(),g.focus(),m.execCommand("SaveAs",!0,c),document.body.removeChild(f)}}else{var y=n.get("lang"),v='<body style="margin:0;"><img src="'+a+'" style="max-width:100%;" title="'+(y&&y[0]||"")+'" /></body>',x=window.open();x.document.write(v),x.document.title=i}else{var b=document.createElement("a");b.download=i+"."+o,b.target="_blank",b.href=a;var w=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});b.dispatchEvent(w)}},e.getDefaultOption=function(t){return{show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:t.getLocale(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:t.getLocale(["toolbox","saveAsImage","lang"])}},e}(w2t);M2t.prototype.unusable=!t_t.canvasSupported;var D2t=[["line","bar"],["stack"]],T2t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.getIcons=function(){var t=this.model,e=t.get("icon"),n={};return S_t(t.get("type"),(function(t){e[t]&&(n[t]=e[t])})),n},e.getDefaultOption=function(t){return{show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:t.getLocale(["toolbox","magicType","title"]),option:{},seriesIndex:{}}},e.prototype.onclick=function(t,e,n){var i=this.model,r=i.get(["seriesIndex",n]);if(E2t[n]){var o,a={series:[]};S_t(D2t,(function(t){w_t(t,n)>=0&&S_t(t,(function(t){i.setIconStatus(t,"normal")}))})),i.setIconStatus(n,"emphasis"),t.eachComponent({mainType:"series",query:null==r?null:{seriesIndex:r}},(function(t){var e=t.subType,r=t.id,o=E2t[n](e,r,t,i);o&&(x_t(o,t.option),a.series.push(o));var s=t.coordinateSystem;if(s&&"cartesian2d"===s.type&&("line"===n||"bar"===n)){var l=s.getAxesByScale("ordinal")[0];if(l){var u=l.dim+"Axis",c=t.getReferringComponents(u,qAt).models[0].componentIndex;a[u]=a[u]||[];for(var h=0;h<=c;h++)a[u][c]=a[u][c]||{};a[u][c].boundaryGap="bar"===n}}}));var s=n;"stack"===n&&(o=m_t({stack:i.option.title.tiled,tiled:i.option.title.stack},i.option.title),"emphasis"!==i.get(["iconStatus",n])&&(s="tiled")),e.dispatchAction({type:"changeMagicType",currentType:s,newOption:a,newTitle:o,featureName:"magicType"})}},e}(w2t),E2t={line:function(t,e,n,i){if("bar"===t)return m_t({id:e,type:"line",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get(["option","line"])||{},!0)},bar:function(t,e,n,i){if("line"===t)return m_t({id:e,type:"bar",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get(["option","bar"])||{},!0)},stack:function(t,e,n,i){var r="__ec_magicType_stack__"===n.get("stack");if("line"===t||"bar"===t)return i.setIconStatus("stack",r?"normal":"emphasis"),m_t({id:e,stack:r?"":"__ec_magicType_stack__"},i.get(["option","stack"])||{},!0)}};sBt({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},(function(t,e){e.mergeOption(t.newOption)}));var N2t=new Array(60).join("-");function O2t(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var F2t=new RegExp("[\t]+","g");function R2t(t,e){var n=t.split(new RegExp("\n*"+N2t+"\n*","g")),i={series:[]};return S_t(n,(function(t,n){if(function(t){if(t.slice(0,t.indexOf("\n")).indexOf("\t")>=0)return!0}(t)){var r=function(t){for(var e=t.split(/\n+/g),n=[],i=C_t(O2t(e.shift()).split(F2t),(function(t){return{name:t,data:[]}})),r=0;r<e.length;r++){var o=O2t(e[r]).split(F2t);n.push(o.shift());for(var a=0;a<o.length;a++)i[a]&&(i[a].data[r]=o[a])}return{series:i,categories:n}}(t),o=e[n],a=o.axisDim+"Axis";o&&(i[a]=i[a]||[],i[a][o.axisIndex]={data:r.categories},i.series=i.series.concat(r.series))}else{r=function(t){for(var e=t.split(/\n+/g),n=O2t(e.shift()),i=[],r=0;r<e.length;r++){var o=O2t(e[r]);if(o){var a=o.split(F2t),s="",l=void 0,u=!1;isNaN(a[0])?(u=!0,s=a[0],a=a.slice(1),i[r]={name:s,value:[]},l=i[r].value):l=i[r]=[];for(var c=0;c<a.length;c++)l.push(+a[c]);1===l.length&&(u?i[r].value=l[0]:i[r]=l[0])}}return{name:n,data:i}}(t);i.series.push(r)}})),i}var L2t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.onclick=function(t,e){var n=e.getDom(),i=this.model;this._dom&&n.removeChild(this._dom);var r=document.createElement("div");r.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;",r.style.backgroundColor=i.get("backgroundColor")||"#fff";var o=document.createElement("h4"),a=i.get("lang")||[];o.innerHTML=a[0]||i.get("title"),o.style.cssText="margin: 10px 20px;",o.style.color=i.get("textColor");var s=document.createElement("div"),l=document.createElement("textarea");s.style.cssText="display:block;width:100%;overflow:auto;";var u=i.get("optionToContent"),c=i.get("contentToOption"),h=function(t){var e,n,i,r=function(t){var e={},n=[],i=[];return t.eachRawSeries((function(t){var r=t.coordinateSystem;if(!r||"cartesian2d"!==r.type&&"polar"!==r.type)n.push(t);else{var o=r.getBaseAxis();if("category"===o.type){var a=o.dim+"_"+o.index;e[a]||(e[a]={categoryAxis:o,valueAxis:r.getOtherAxis(o),series:[]},i.push({axisDim:o.dim,axisIndex:o.index})),e[a].series.push(t)}else n.push(t)}})),{seriesGroupByCategoryAxis:e,other:n,meta:i}}(t);return{value:I_t([(n=r.seriesGroupByCategoryAxis,i=[],S_t(n,(function(t,e){var n=t.categoryAxis,r=t.valueAxis.dim,o=[" "].concat(C_t(t.series,(function(t){return t.name}))),a=[n.model.getCategories()];S_t(t.series,(function(t){var e=t.getRawData();a.push(t.getRawData().mapArray(e.mapDimension(r),(function(t){return t})))}));for(var s=[o.join("\t")],l=0;l<a[0].length;l++){for(var u=[],c=0;c<a.length;c++)u.push(a[c][l]);s.push(u.join("\t"))}i.push(s.join("\n"))})),i.join("\n\n"+N2t+"\n\n")),(e=r.other,C_t(e,(function(t){var e=t.getRawData(),n=[t.name],i=[];return e.each(e.dimensions,(function(){for(var t=arguments.length,r=arguments[t-1],o=e.getName(r),a=0;a<t-1;a++)i[a]=arguments[a];n.push((o?o+"\t":"")+i.join("\t"))})),n.join("\n")})).join("\n\n"+N2t+"\n\n"))],(function(t){return!!t.replace(/[\n\t\s]/g,"")})).join("\n\n"+N2t+"\n\n"),meta:r.meta}}(t);if("function"==typeof u){var d=u(e.getOption());"string"==typeof d?s.innerHTML=d:z_t(d)&&s.appendChild(d)}else s.appendChild(l),l.readOnly=i.get("readOnly"),l.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;",l.style.color=i.get("textColor"),l.style.borderColor=i.get("textareaBorderColor"),l.style.backgroundColor=i.get("textareaColor"),l.value=h.value;var p=h.meta,f=document.createElement("div");f.style.cssText="position:absolute;bottom:0;left:0;right:0;";var g="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",m=document.createElement("div"),y=document.createElement("div");g+=";background-color:"+i.get("buttonColor"),g+=";color:"+i.get("buttonTextColor");var v=this;function x(){n.removeChild(r),v._dom=null}Fkt(m,"click",x),Fkt(y,"click",(function(){if(null==c&&null!=u||null!=c&&null==u)x();else{var t;try{t="function"==typeof c?c(s,e.getOption()):R2t(l.value,p)}catch(t){throw x(),new Error("Data view format error "+t)}t&&e.dispatchAction({type:"changeDataView",newOption:t}),x()}})),m.innerHTML=a[1],y.innerHTML=a[2],y.style.cssText=g,m.style.cssText=g,!i.get("readOnly")&&f.appendChild(y),f.appendChild(m),r.appendChild(o),r.appendChild(s),r.appendChild(f),s.style.height=n.clientHeight-80+"px",n.appendChild(r),this._dom=r},e.prototype.remove=function(t,e){this._dom&&e.getDom().removeChild(this._dom)},e.prototype.dispose=function(t,e){this.remove(t,e)},e.getDefaultOption=function(t){return{show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:t.getLocale(["toolbox","dataView","title"]),lang:t.getLocale(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"}},e}(w2t);function $2t(t,e){return C_t(t,(function(t,n){var i=e&&e[n];if(L_t(i)&&!E_t(i)){L_t(t)&&!E_t(t)||(t={value:t});var r=null!=i.name&&null==t.name;return t=x_t(t,i),r&&delete t.name,t}return t}))}sBt({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},(function(t,e){var n=[];S_t(t.newOption.series,(function(t){var i=e.getSeriesByName(t.name)[0];if(i){var r=i.get("data");n.push({name:t.name,data:$2t(t.data,r)})}else n.push(v_t({type:"scatter"},t))})),e.mergeOption(x_t({series:n},t.newOption))}));var P2t=S_t,z2t=jAt();function B2t(t){var e=z2t(t);return e.snapshots||(e.snapshots=[{}]),e.snapshots}var V2t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.onclick=function(t,e){!function(t){z2t(t).snapshots=null}(t),e.dispatchAction({type:"restore",from:this.uid})},e.getDefaultOption=function(t){return{show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:t.getLocale(["toolbox","restore","title"])}},e}(w2t);sBt({type:"restore",event:"restore",update:"prepareAndUpdate"},(function(t,e){e.resetOption("recreate")}));var W2t=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],j2t=function(){function t(t,e,n){var i=this;this._targetInfoList=[];var r=G2t(e,t);S_t(H2t,(function(t,e){(!n||!n.include||w_t(n.include,e)>=0)&&t(r,i._targetInfoList)}))}return t.prototype.setOutputRanges=function(t,e){return this.matchOutputRanges(t,e,(function(t,e,n){if((t.coordRanges||(t.coordRanges=[])).push(e),!t.coordRange){t.coordRange=e;var i=Y2t[t.brushType](0,n,e);t.__rangeOffset={offset:Z2t[t.brushType](i.values,t.range,[1,1]),xyMinMax:i.xyMinMax}}})),t},t.prototype.matchOutputRanges=function(t,e,n){S_t(t,(function(t){var i=this.findTargetInfo(t,e);i&&!0!==i&&S_t(i.coordSyses,(function(i){var r=Y2t[t.brushType](1,i,t.range,!0);n(t,r.values,i,e)}))}),this)},t.prototype.setInputRanges=function(t,e){S_t(t,(function(t){var n,i,r,o,a,s=this.findTargetInfo(t,e);if(t.range=t.range||[],s&&!0!==s){t.panelId=s.panelId;var l=Y2t[t.brushType](0,s.coordSys,t.coordRange),u=t.__rangeOffset;t.range=u?Z2t[t.brushType](l.values,u.offset,(n=l.xyMinMax,i=u.xyMinMax,r=Q2t(n),o=Q2t(i),a=[r[0]/o[0],r[1]/o[1]],isNaN(a[0])&&(a[0]=1),isNaN(a[1])&&(a[1]=1),a)):l.values}}),this)},t.prototype.makePanelOpts=function(t,e){return C_t(this._targetInfoList,(function(n){var i=n.getPanelRect();return{panelId:n.panelId,defaultBrushType:e?e(n):null,clipPath:MKt(i),isTargetByCursor:TKt(i,t,n.coordSysModel),getLinearBrushOtherExtent:DKt(i)}}))},t.prototype.controlSeries=function(t,e,n){var i=this.findTargetInfo(t,n);return!0===i||i&&w_t(i.coordSyses,e.coordinateSystem)>=0},t.prototype.findTargetInfo=function(t,e){for(var n=this._targetInfoList,i=G2t(e,t),r=0;r<n.length;r++){var o=n[r],a=t.panelId;if(a){if(o.panelId===a)return o}else for(var s=0;s<q2t.length;s++)if(q2t[s](i,o))return o}return!0},t}();function U2t(t){return t[0]>t[1]&&t.reverse(),t}function G2t(t,e){return GAt(t,e,{includeMainTypes:W2t})}var H2t={grid:function(t,e){var n=t.xAxisModels,i=t.yAxisModels,r=t.gridModels,o=Z_t(),a={},s={};(n||i||r)&&(S_t(n,(function(t){var e=t.axis.grid.model;o.set(e.id,e),a[e.id]=!0})),S_t(i,(function(t){var e=t.axis.grid.model;o.set(e.id,e),s[e.id]=!0})),S_t(r,(function(t){o.set(t.id,t),a[t.id]=!0,s[t.id]=!0})),o.each((function(t){var r=t.coordinateSystem,o=[];S_t(r.getCartesians(),(function(t,e){(w_t(n,t.getAxis("x").model)>=0||w_t(i,t.getAxis("y").model)>=0)&&o.push(t)})),e.push({panelId:"grid--"+t.id,gridModel:t,coordSysModel:t,coordSys:o[0],coordSyses:o,getPanelRect:X2t.grid,xAxisDeclared:a[t.id],yAxisDeclared:s[t.id]})})))},geo:function(t,e){S_t(t.geoModels,(function(t){var n=t.coordinateSystem;e.push({panelId:"geo--"+t.id,geoModel:t,coordSysModel:t,coordSys:n,coordSyses:[n],getPanelRect:X2t.geo})}))}},q2t=[function(t,e){var n=t.xAxisModel,i=t.yAxisModel,r=t.gridModel;return!r&&n&&(r=n.axis.grid.model),!r&&i&&(r=i.axis.grid.model),r&&r===e.gridModel},function(t,e){var n=t.geoModel;return n&&n===e.geoModel}],X2t={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var t=this.coordSys,e=t.getBoundingRect().clone();return e.applyTransform(XEt(t)),e}},Y2t={lineX:T_t(K2t,0),lineY:T_t(K2t,1),rect:function(t,e,n,i){var r=t?e.pointToData([n[0][0],n[1][0]],i):e.dataToPoint([n[0][0],n[1][0]],i),o=t?e.pointToData([n[0][1],n[1][1]],i):e.dataToPoint([n[0][1],n[1][1]],i),a=[U2t([r[0],o[0]]),U2t([r[1],o[1]])];return{values:a,xyMinMax:a}},polygon:function(t,e,n,i){var r=[[1/0,-1/0],[1/0,-1/0]];return{values:C_t(n,(function(n){var o=t?e.pointToData(n,i):e.dataToPoint(n,i);return r[0][0]=Math.min(r[0][0],o[0]),r[1][0]=Math.min(r[1][0],o[1]),r[0][1]=Math.max(r[0][1],o[0]),r[1][1]=Math.max(r[1][1],o[1]),o})),xyMinMax:r}}};function K2t(t,e,n,i){var r=n.getAxis(["x","y"][t]),o=U2t(C_t([0,1],(function(t){return e?r.coordToData(r.toLocalCoord(i[t]),!0):r.toGlobalCoord(r.dataToCoord(i[t]))}))),a=[];return a[t]=o,a[1-t]=[NaN,NaN],{values:o,xyMinMax:a}}var Z2t={lineX:T_t(J2t,0),lineY:T_t(J2t,1),rect:function(t,e,n){return[[t[0][0]-n[0]*e[0][0],t[0][1]-n[0]*e[0][1]],[t[1][0]-n[1]*e[1][0],t[1][1]-n[1]*e[1][1]]]},polygon:function(t,e,n){return C_t(t,(function(t,i){return[t[0]-n[0]*e[i][0],t[1]-n[1]*e[i][1]]}))}};function J2t(t,e,n,i){return[e[0]-i[t]*n[0],e[1]-i[t]*n[1]]}function Q2t(t){return t?[t[0][1]-t[0][0],t[1][1]-t[1][0]]:[NaN,NaN]}var t3t,e3t,n3t=S_t,i3t="\0_ec_\0"+"toolbox-dataZoom_",r3t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.render=function(t,e,n,i){this._brushController||(this._brushController=new ZYt(n.getZr()),this._brushController.on("brush",D_t(this._onBrush,this)).mount()),function(t,e,n,i,r){var o=n._isZoomActive;i&&"takeGlobalCursor"===i.type&&(o="dataZoomSelect"===i.key&&i.dataZoomSelectActive);n._isZoomActive=o,t.setIconStatus("zoom",o?"emphasis":"normal");var a=new j2t(a3t(t),e,{include:["grid"]}).makePanelOpts(r,(function(t){return t.xAxisDeclared&&!t.yAxisDeclared?"lineX":!t.xAxisDeclared&&t.yAxisDeclared?"lineY":"rect"}));n._brushController.setPanels(a).enableBrush(!(!o||!a.length)&&{brushType:"auto",brushStyle:t.getModel("brushStyle").getItemStyle()})}(t,e,this,i,n),function(t,e){t.setIconStatus("back",function(t){return B2t(t).length}(e)>1?"emphasis":"normal")}(t,e)},e.prototype.onclick=function(t,e,n){o3t[n].call(this)},e.prototype.remove=function(t,e){this._brushController&&this._brushController.unmount()},e.prototype.dispose=function(t,e){this._brushController&&this._brushController.dispose()},e.prototype._onBrush=function(t){var e=t.areas;if(t.isEnd&&e.length){var n={},i=this.ecModel;this._brushController.updateCovers([]),new j2t(a3t(this.model),i,{include:["grid"]}).matchOutputRanges(e,i,(function(t,e,n){if("cartesian2d"===n.type){var i=t.brushType;"rect"===i?(r("x",n,e[0]),r("y",n,e[1])):r({lineX:"x",lineY:"y"}[i],n,e)}})),function(t,e){var n=B2t(t);P2t(e,(function(e,i){for(var r=n.length-1;r>=0&&!n[r][i];r--);if(r<0){var o=t.queryComponents({mainType:"dataZoom",subType:"select",id:i})[0];if(o){var a=o.getPercentRange();n[0][i]={dataZoomId:i,start:a[0],end:a[1]}}}})),n.push(e)}(i,n),this._dispatchZoomAction(n)}function r(t,e,r){var o=e.getAxis(t),a=o.model,s=function(t,e,n){var i;return n.eachComponent({mainType:"dataZoom",subType:"select"},(function(n){n.getAxisModel(t,e.componentIndex)&&(i=n)})),i}(t,a,i),l=s.findRepresentativeAxisProxy(a).getMinMaxSpan();null==l.minValueSpan&&null==l.maxValueSpan||(r=MYt(0,r.slice(),o.scale.getExtent(),0,l.minValueSpan,l.maxValueSpan)),s&&(n[s.id]={dataZoomId:s.id,startValue:r[0],endValue:r[1]})}},e.prototype._dispatchZoomAction=function(t){var e=[];n3t(t,(function(t,n){e.push(g_t(t))})),e.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:e})},e.getDefaultOption=function(t){return{show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:t.getLocale(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}}},e}(w2t),o3t={zoom:function(){var t=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:t})},back:function(){this._dispatchZoomAction(function(t){var e=B2t(t),n=e[e.length-1];e.length>1&&e.pop();var i={};return P2t(n,(function(t,n){for(var r=e.length-1;r>=0;r--)if(t=e[r][n]){i[n]=t;break}})),i}(this.ecModel))}};function a3t(t){var e={xAxisIndex:t.get("xAxisIndex",!0),yAxisIndex:t.get("yAxisIndex",!0),xAxisId:t.get("xAxisId",!0),yAxisId:t.get("yAxisId",!0)};return null==e.xAxisIndex&&null==e.xAxisId&&(e.xAxisIndex="all"),null==e.yAxisIndex&&null==e.yAxisId&&(e.yAxisIndex="all"),e}t3t="dataZoom",e3t=function(t){var e=t.getComponent("toolbox",0),n=["feature","dataZoom"];if(e&&null!=e.get(n)){var i=e.getModel(n),r=[],o=GAt(t,a3t(i));return n3t(o.xAxisModels,(function(t){return a(t,"xAxis","xAxisIndex")})),n3t(o.yAxisModels,(function(t){return a(t,"yAxis","yAxisIndex")})),r}function a(t,e,n){var o=t.componentIndex,a={type:"select",$fromToolbox:!0,filterMode:i.get("filterMode",!0)||"filter",id:i3t+e+o};a[n]=o,r.push(a)}},H_t(null==XOt.get(t3t)&&e3t),XOt.set(t3t,e3t);var s3t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="tooltip",e.dependencies=["axisPointer"],e.defaultOption={zlevel:0,z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}},e}(FOt);function l3t(t){var e=t.get("confine");return null!=e?!!e:"richText"===t.get("renderMode")}function u3t(t){if(t_t.domSupported)for(var e=document.documentElement.style,n=0,i=t.length;n<i;n++)if(t[n]in e)return t[n]}var c3t=u3t(["transform","webkitTransform","OTransform","MozTransform","msTransform"]);function h3t(t,e){if(!t)return e;e=hOt(e,!0);var n=t.indexOf(e);return(t=-1===n?e:"-"+t.slice(0,n)+"-"+e).toLowerCase()}function d3t(t,e){var n=t.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(t);return n?e?n[e]:n:null}var p3t=h3t(u3t(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),"transition"),f3t=h3t(c3t,"transform"),g3t="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(t_t.transform3dSupported?"will-change:transform;":"");function m3t(t,e,n){var i=t.toFixed(0)+"px",r=e.toFixed(0)+"px";if(!t_t.transformSupported)return n?"top:"+r+";left:"+i+";":[["top",r],["left",i]];var o=t_t.transform3dSupported,a="translate"+(o?"3d":"")+"("+i+","+r+(o?",0":"")+")";return n?"top:0;left:0;"+f3t+":"+a+";":[["top",0],["left",0],[c3t,a]]}function y3t(t,e,n){var i=[],r=t.get("transitionDuration"),o=t.get("backgroundColor"),a=t.get("shadowBlur"),s=t.get("shadowColor"),l=t.get("shadowOffsetX"),u=t.get("shadowOffsetY"),c=t.getModel("textStyle"),h=jRt(t,"html"),d=l+"px "+u+"px "+a+"px "+s;return i.push("box-shadow:"+d),e&&r&&i.push(function(t,e){var n="cubic-bezier(0.23,1,0.32,1)",i=" "+t/2+"s "+n,r="opacity"+i+",visibility"+i;return e||(i=" "+t+"s "+n,r+=t_t.transformSupported?","+f3t+i:",left"+i+",top"+i),p3t+":"+r}(r,n)),o&&(t_t.canvasSupported?i.push("background-color:"+o):(i.push("background-color:#"+CSt(o)),i.push("filter:alpha(opacity=70)"))),S_t(["width","color","radius"],(function(e){var n="border-"+e,r=hOt(n),o=t.get(r);null!=o&&i.push(n+":"+o+("color"===e?"":"px"))})),i.push(function(t){var e=[],n=t.get("fontSize"),i=t.getTextColor();i&&e.push("color:"+i),e.push("font:"+t.getFont()),n&&e.push("line-height:"+Math.round(3*n/2)+"px");var r=t.get("textShadowColor"),o=t.get("textShadowBlur")||0,a=t.get("textShadowOffsetX")||0,s=t.get("textShadowOffsetY")||0;return r&&o&&e.push("text-shadow:"+a+"px "+s+"px "+o+"px "+r),S_t(["decoration","align"],(function(n){var i=t.get(n);i&&e.push("text-"+n+":"+i)})),e.join(";")}(c)),null!=h&&i.push("padding:"+dOt(h).join("px ")+"px"),i.join(";")+";"}function v3t(t,e,n,i,r){var o=e&&e.painter;if(n){var a=o&&o.getViewportRoot();a&&function(t,e,n,i,r){Ckt(Skt,e,i,r,!0)&&Ckt(t,n,Skt[0],Skt[1])}(t,a,document.body,i,r)}else{t[0]=i,t[1]=r;var s=o&&o.getViewportRootOffset();s&&(t[0]+=s.offsetLeft,t[1]+=s.offsetTop)}t[2]=t[0]/e.getWidth(),t[3]=t[1]/e.getHeight()}var x3t=function(){function t(t,e,n){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._firstShow=!0,this._longHide=!0,t_t.wxa)return null;var i=document.createElement("div");i.domBelongToZr=!0,this.el=i;var r=this._zr=e.getZr(),o=this._appendToBody=n&&n.appendToBody;v3t(this._styleCoord,r,o,e.getWidth()/2,e.getHeight()/2),o?document.body.appendChild(i):t.appendChild(i),this._container=t;var a=this;i.onmouseenter=function(){a._enterable&&(clearTimeout(a._hideTimeout),a._show=!0),a._inContent=!0},i.onmousemove=function(t){if(t=t||window.event,!a._enterable){var e=r.handler;Okt(r.painter.getViewportRoot(),t,!0),e.dispatch("mousemove",t)}},i.onmouseleave=function(){a._inContent=!1,a._enterable&&a._show&&a.hideLater(a._hideDelay)}}return t.prototype.update=function(t){var e=this._container,n=d3t(e,"position"),i=e.style;"absolute"!==i.position&&"absolute"!==n&&(i.position="relative"),t.get("alwaysShowContent")&&this._moveIfResized(),this.el.className=t.get("className")||""},t.prototype.show=function(t,e){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var n=this.el,i=n.style,r=this._styleCoord;n.innerHTML?i.cssText=g3t+y3t(t,!this._firstShow,this._longHide)+m3t(r[0],r[1],!0)+"border-color:"+bOt(e)+";"+(t.get("extraCssText")||"")+";pointer-event:"+(this._enterable?"auto":"none"):i.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},t.prototype.setContent=function(t,e,n,i,r){if(null!=t){var o=this.el;if(O_t(r)&&"item"===n.get("trigger")&&!l3t(n)&&(t+=function(t,e,n){if(!O_t(n)||"inside"===n)return"";e=bOt(e);var i,r="left"===(i=n)?"right":"right"===i?"left":"top"===i?"bottom":"top",o=r+":-6px;",a=f3t+":";w_t(["left","right"],r)>-1?(o+="top:50%",a+="translateY(-50%) rotate("+("left"===r?-225:-45)+"deg)"):(o+="left:50%",a+="translateX(-50%) rotate("+("top"===r?225:45)+"deg)");var s=e+" solid 1px;";return'<div style="'+["position:absolute;width:10px;height:10px;",o+";"+a+";","border-bottom:"+s,"border-right:"+s,"background-color:"+t+";","box-shadow:8px 8px 16px -3px #000;"].join("")+'"></div>'}(n.get("backgroundColor"),i,r)),O_t(t))o.innerHTML=t;else if(t){o.innerHTML="",E_t(t)||(t=[t]);for(var a=0;a<t.length;a++)z_t(t[a])&&t[a].parentNode!==o&&o.appendChild(t[a])}}},t.prototype.setEnterable=function(t){this._enterable=t},t.prototype.getSize=function(){var t=this.el;return[t.clientWidth,t.clientHeight]},t.prototype.moveTo=function(t,e){var n=this._styleCoord;if(v3t(n,this._zr,this._appendToBody,t,e),null!=n[0]&&null!=n[1]){var i=this.el.style;S_t(m3t(n[0],n[1]),(function(t){i[t[0]]=t[1]}))}},t.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},t.prototype.hide=function(){var t=this,e=this.el.style;e.visibility="hidden",e.opacity="0",t_t.transform3dSupported&&(e.willChange=""),this._show=!1,this._longHideTimeout=setTimeout((function(){return t._longHide=!0}),500)},t.prototype.hideLater=function(t){!this._show||this._inContent&&this._enterable||(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(D_t(this.hide,this),t)):this.hide())},t.prototype.isShow=function(){return this._show},t.prototype.dispose=function(){this.el.parentNode.removeChild(this.el)},t.prototype.getOuterSize=function(){var t=this.el.clientWidth,e=this.el.clientHeight,n=d3t(this.el);return n&&(t+=parseInt(n.borderLeftWidth,10)+parseInt(n.borderRightWidth,10),e+=parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)),{width:t,height:e}},t}(),b3t=function(){function t(t){this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._zr=t.getZr(),k3t(this._styleCoord,this._zr,t.getWidth()/2,t.getHeight()/2)}return t.prototype.update=function(t){t.get("alwaysShowContent")&&this._moveIfResized()},t.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},t.prototype.setContent=function(t,e,n,i,r){L_t(t)&&EAt(""),this.el&&this._zr.remove(this.el);var o=n.getModel("textStyle");this.el=new xDt({style:{rich:e.richTextStyles,text:t,lineHeight:22,backgroundColor:n.get("backgroundColor"),borderRadius:n.get("borderRadius"),borderWidth:1,borderColor:i,shadowColor:n.get("shadowColor"),shadowBlur:n.get("shadowBlur"),shadowOffsetX:n.get("shadowOffsetX"),shadowOffsetY:n.get("shadowOffsetY"),textShadowColor:o.get("textShadowColor"),textShadowBlur:o.get("textShadowBlur")||0,textShadowOffsetX:o.get("textShadowOffsetX")||0,textShadowOffsetY:o.get("textShadowOffsetY")||0,fill:n.get(["textStyle","color"]),padding:jRt(n,"richText"),verticalAlign:"top",align:"left"},z:n.get("z")}),this._zr.add(this.el);var a=this;this.el.on("mouseover",(function(){a._enterable&&(clearTimeout(a._hideTimeout),a._show=!0),a._inContent=!0})),this.el.on("mouseout",(function(){a._enterable&&a._show&&a.hideLater(a._hideDelay),a._inContent=!1}))},t.prototype.setEnterable=function(t){this._enterable=t},t.prototype.getSize=function(){var t=this.el,e=this.el.getBoundingRect(),n=_3t(t.style);return[e.width+n.left+n.right,e.height+n.top+n.bottom]},t.prototype.moveTo=function(t,e){var n=this.el;if(n){var i=this._styleCoord;k3t(i,this._zr,t,e),t=i[0],e=i[1];var r=n.style,o=w3t(r.borderWidth||0),a=_3t(r);n.x=t+o+a.left,n.y=e+o+a.top,n.markRedraw()}},t.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},t.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},t.prototype.hideLater=function(t){!this._show||this._inContent&&this._enterable||(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(D_t(this.hide,this),t)):this.hide())},t.prototype.isShow=function(){return this._show},t.prototype.getOuterSize=function(){var t=this.getSize();return{width:t[0],height:t[1]}},t.prototype.dispose=function(){this._zr.remove(this.el)},t}();function w3t(t){return Math.max(0,t)}function _3t(t){var e=w3t(t.shadowBlur||0),n=w3t(t.shadowOffsetX||0),i=w3t(t.shadowOffsetY||0);return{left:w3t(e-n),right:w3t(e+n),top:w3t(e-i),bottom:w3t(e+i)}}function k3t(t,e,n,i){t[0]=n,t[1]=i,t[2]=t[0]/e.getWidth(),t[3]=t[1]/e.getHeight()}var S3t=D_t,C3t=S_t,A3t=dAt,I3t=new mDt({shape:{x:-1,y:-1,width:2,height:2}}),M3t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(t,e){if(!t_t.node){var n,i=t.getComponent("tooltip"),r=i.get("renderMode");this._renderMode="auto"===(n=r)?t_t.domSupported?"html":"richText":n||"html",this._tooltipContent="richText"===this._renderMode?new b3t(e):new x3t(e.getDom(),e,{appendToBody:i.get("appendToBody",!0)})}},e.prototype.render=function(t,e,n){if(!t_t.node){this.group.removeAll(),this._tooltipModel=t,this._ecModel=e,this._api=n,this._alwaysShowContent=t.get("alwaysShowContent");var i=this._tooltipContent;i.update(t),i.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow()}},e.prototype._initGlobalListener=function(){var t=this._tooltipModel.get("triggerOn");R0t("itemTooltip",this._api,S3t((function(e,n,i){"none"!==t&&(t.indexOf(e)>=0?this._tryShow(n,i):"leave"===e&&this._hide(i))}),this))},e.prototype._keepShow=function(){var t=this._tooltipModel,e=this._ecModel,n=this._api;if(null!=this._lastX&&null!=this._lastY&&"none"!==t.get("triggerOn")){var i=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout((function(){!n.isDisposed()&&i.manuallyShowTip(t,e,n,{x:i._lastX,y:i._lastY,dataByCoordSys:i._lastDataByCoordSys})}))}},e.prototype.manuallyShowTip=function(t,e,n,i){if(i.from!==this.uid&&!t_t.node){var r=T3t(i,n);this._ticket="";var o=i.dataByCoordSys,a=function(t,e,n){var i=HAt(t).queryOptionMap,r=i.keys()[0];if(!r||"series"===r)return;var o,a=YAt(e,r,i.get(r),{useDefault:!1,enableAll:!1,enableNone:!1}).models[0];if(!a)return;if(n.getViewOfComponentModel(a).group.traverse((function(e){var n=IDt(e).tooltipConfig;if(n&&n.name===t.name)return o=e,!0})),o)return{componentMainType:r,componentIndex:a.componentIndex,el:o}}(i,e,n);if(a){var s=a.el.getBoundingRect().clone();s.applyTransform(a.el.transform),this._tryShow({offsetX:s.x+s.width/2,offsetY:s.y+s.height/2,target:a.el,position:i.position,positionDefault:"bottom"},r)}else if(i.tooltip&&null!=i.x&&null!=i.y){var l=I3t;l.x=i.x,l.y=i.y,l.update(),IDt(l).tooltipConfig={name:null,option:i.tooltip},this._tryShow({offsetX:i.x,offsetY:i.y,target:l},r)}else if(o)this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,dataByCoordSys:o,tooltipOption:i.tooltipOption},r);else if(null!=i.seriesIndex){if(this._manuallyAxisShowTip(t,e,n,i))return;var u=B0t(i,e),c=u.point[0],h=u.point[1];null!=c&&null!=h&&this._tryShow({offsetX:c,offsetY:h,target:u.el,position:i.position,positionDefault:"bottom"},r)}else null!=i.x&&null!=i.y&&(n.dispatchAction({type:"updateAxisPointer",x:i.x,y:i.y}),this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,target:n.getZr().findHover(i.x,i.y).target},r))}},e.prototype.manuallyHideTip=function(t,e,n,i){var r=this._tooltipContent;!this._alwaysShowContent&&this._tooltipModel&&r.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,i.from!==this.uid&&this._hide(T3t(i,n))},e.prototype._manuallyAxisShowTip=function(t,e,n,i){var r=i.seriesIndex,o=i.dataIndex,a=e.getComponent("axisPointer").coordSysAxesInfo;if(null!=r&&null!=o&&null!=a){var s=e.getSeriesByIndex(r);if(s)if("axis"===D3t([s.getData().getItemModel(o),s,(s.coordinateSystem||{}).model],this._tooltipModel).get("trigger"))return n.dispatchAction({type:"updateAxisPointer",seriesIndex:r,dataIndex:o,position:i.position}),!0}},e.prototype._tryShow=function(t,e){var n=t.target;if(this._tooltipModel){this._lastX=t.offsetX,this._lastY=t.offsetY;var i=t.dataByCoordSys;if(i&&i.length)this._showAxisTooltip(i,t);else if(n){var r,o;this._lastDataByCoordSys=null,O$t(n,(function(t){return null!=IDt(t).dataIndex?(r=t,!0):null!=IDt(t).tooltipConfig?(o=t,!0):void 0}),!0),r?this._showSeriesItemTooltip(t,r,e):o?this._showComponentItemTooltip(t,o,e):this._hide(e)}else this._lastDataByCoordSys=null,this._hide(e)}},e.prototype._showOrMove=function(t,e){var n=t.get("showDelay");e=D_t(e,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(e,n):e()},e.prototype._showAxisTooltip=function(t,e){var n=this._ecModel,i=this._tooltipModel,r=[e.offsetX,e.offsetY],o=D3t([e.tooltipOption],i),a=this._renderMode,s=[],l=RRt("section",{blocks:[],noHeader:!0}),u=[],c=new URt;C3t(t,(function(t){C3t(t.dataByAxis,(function(t){var e=n.getComponent(t.axisDim+"Axis",t.axisIndex),i=t.value;if(e&&null!=i){var r=_0t(i,e.axis,n,t.seriesDataIndices,t.valueLabelOpt),o=RRt("section",{header:r,noHeader:!q_t(r),sortBlocks:!0,blocks:[]});l.blocks.push(o),S_t(t.seriesDataIndices,(function(l){var h=n.getSeriesByIndex(l.seriesIndex),d=l.dataIndexInside,p=h.getDataParams(d);p.axisDim=t.axisDim,p.axisIndex=t.axisIndex,p.axisType=t.axisType,p.axisId=t.axisId,p.axisValue=QVt(e.axis,{value:i}),p.axisValueLabel=r,p.marker=c.makeTooltipMarker("item",bOt(p.color),a);var f=lRt(h.formatTooltip(d,!0,null));f.markupFragment&&o.blocks.push(f.markupFragment),f.markupText&&u.push(f.markupText),s.push(p)}))}}))})),l.blocks.reverse(),u.reverse();var h=e.position,d=o.get("order"),p=PRt(l,c,a,d,n.get("useUTC"),o.get("textStyle"));p&&u.unshift(p);var f="richText"===a?"\n\n":"<br/>",g=u.join(f);this._showOrMove(o,(function(){this._updateContentNotChangedOnAxis(t)?this._updatePosition(o,h,r[0],r[1],this._tooltipContent,s):this._showTooltipContent(o,g,s,Math.random()+"",r[0],r[1],h,null,c)}))},e.prototype._showSeriesItemTooltip=function(t,e,n){var i=this._ecModel,r=IDt(e),o=r.seriesIndex,a=i.getSeriesByIndex(o),s=r.dataModel||a,l=r.dataIndex,u=r.dataType,c=s.getData(u),h=this._renderMode,d=t.positionDefault,p=D3t([c.getItemModel(l),s,a&&(a.coordinateSystem||{}).model],this._tooltipModel,d?{position:d}:null),f=p.get("trigger");if(null==f||"item"===f){var g=s.getDataParams(l,u),m=new URt;g.marker=m.makeTooltipMarker("item",bOt(g.color),h);var y=lRt(s.formatTooltip(l,!1,u)),v=p.get("order"),x=y.markupFragment?PRt(y.markupFragment,m,h,v,i.get("useUTC"),p.get("textStyle")):y.markupText,b="item_"+s.name+"_"+l;this._showOrMove(p,(function(){this._showTooltipContent(p,x,g,b,t.offsetX,t.offsetY,t.position,t.target,m)})),n({type:"showTip",dataIndexInside:l,dataIndex:c.getRawIndex(l),seriesIndex:o,from:this.uid})}},e.prototype._showComponentItemTooltip=function(t,e,n){var i=IDt(e),r=i.tooltipConfig.option||{};if(O_t(r)){r={content:r,formatter:r}}var o=[r],a=this._ecModel.getComponent(i.componentMainType,i.componentIndex);a&&o.push(a),o.push({formatter:r.content});var s=t.positionDefault,l=D3t(o,this._tooltipModel,s?{position:s}:null),u=l.get("content"),c=Math.random()+"",h=new URt;this._showOrMove(l,(function(){var n=g_t(l.get("formatterParams")||{});this._showTooltipContent(l,u,n,c,t.offsetX,t.offsetY,t.position,e,h)})),n({type:"showTip",from:this.uid})},e.prototype._showTooltipContent=function(t,e,n,i,r,o,a,s,l){if(this._ticket="",t.get("showContent")&&t.get("show")){var u=this._tooltipContent,c=t.get("formatter");a=a||t.get("position");var h=e,d=this._getNearestPoint([r,o],n,t.get("trigger"),t.get("borderColor")).color;if(c&&O_t(c)){var p=t.ecModel.get("useUTC"),f=E_t(n)?n[0]:n;h=c,f&&f.axisType&&f.axisType.indexOf("time")>=0&&(h=qNt(f.axisValue,h,p)),h=xOt(h,n,!0)}else if(N_t(c)){var g=S3t((function(e,i){e===this._ticket&&(u.setContent(i,l,t,d,a),this._updatePosition(t,a,r,o,u,n,s))}),this);this._ticket=i,h=c(n,i,g)}u.setContent(h,l,t,d,a),u.show(t,d),this._updatePosition(t,a,r,o,u,n,s)}},e.prototype._getNearestPoint=function(t,e,n,i){return"axis"===n||E_t(e)?{color:i||("html"===this._renderMode?"#fff":"none")}:E_t(e)?void 0:{color:i||e.color||e.borderColor}},e.prototype._updatePosition=function(t,e,n,i,r,o,a){var s=this._api.getWidth(),l=this._api.getHeight();e=e||t.get("position");var u=r.getSize(),c=t.get("align"),h=t.get("verticalAlign"),d=a&&a.getBoundingRect().clone();if(a&&d.applyTransform(a.transform),N_t(e)&&(e=e([n,i],o,r.el,d,{viewSize:[s,l],contentSize:u.slice()})),E_t(e))n=A3t(e[0],s),i=A3t(e[1],l);else if(L_t(e)){var p=e;p.width=u[0],p.height=u[1];var f=IOt(p,{width:s,height:l});n=f.x,i=f.y,c=null,h=null}else if(O_t(e)&&a){var g=function(t,e,n){var i=n[0],r=n[1],o=10,a=5,s=0,l=0,u=e.width,c=e.height;switch(t){case"inside":s=e.x+u/2-i/2,l=e.y+c/2-r/2;break;case"top":s=e.x+u/2-i/2,l=e.y-r-o;break;case"bottom":s=e.x+u/2-i/2,l=e.y+c+o;break;case"left":s=e.x-i-o-a,l=e.y+c/2-r/2;break;case"right":s=e.x+u+o+a,l=e.y+c/2-r/2}return[s,l]}(e,d,u);n=g[0],i=g[1]}else{g=function(t,e,n,i,r,o,a){var s=n.getOuterSize(),l=s.width,u=s.height;null!=o&&(t+l+o+2>i?t-=l+o:t+=o);null!=a&&(e+u+a>r?e-=u+a:e+=a);return[t,e]}(n,i,r,s,l,c?null:20,h?null:20);n=g[0],i=g[1]}if(c&&(n-=E3t(c)?u[0]/2:"right"===c?u[0]:0),h&&(i-=E3t(h)?u[1]/2:"bottom"===h?u[1]:0),l3t(t)){g=function(t,e,n,i,r){var o=n.getOuterSize(),a=o.width,s=o.height;return t=Math.min(t+a,i)-a,e=Math.min(e+s,r)-s,t=Math.max(t,0),e=Math.max(e,0),[t,e]}(n,i,r,s,l);n=g[0],i=g[1]}r.moveTo(n,i)},e.prototype._updateContentNotChangedOnAxis=function(t){var e=this._lastDataByCoordSys,n=!!e&&e.length===t.length;return n&&C3t(e,(function(e,i){var r=e.dataByAxis||[],o=(t[i]||{}).dataByAxis||[];(n=n&&r.length===o.length)&&C3t(r,(function(t,e){var i=o[e]||{},r=t.seriesDataIndices||[],a=i.seriesDataIndices||[];(n=n&&t.value===i.value&&t.axisType===i.axisType&&t.axisId===i.axisId&&r.length===a.length)&&C3t(r,(function(t,e){var i=a[e];n=n&&t.seriesIndex===i.seriesIndex&&t.dataIndex===i.dataIndex}))}))})),this._lastDataByCoordSys=t,!!n},e.prototype._hide=function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},e.prototype.dispose=function(t,e){t_t.node||(this._tooltipContent.dispose(),P0t("itemTooltip",e))},e.type="tooltip",e}(nLt);function D3t(t,e,n){var i,r=e.ecModel;n?(i=new NNt(n,r,r),i=new NNt(e.option,i,r)):i=e;for(var o=t.length-1;o>=0;o--){var a=t[o];a&&(a instanceof NNt&&(a=a.get("tooltip",!0)),O_t(a)&&(a={formatter:a}),a&&(i=new NNt(a,i,r)))}return i}function T3t(t,e){return t.dispatchAction||D_t(e.dispatchAction,e)}function E3t(t){return"center"===t||"middle"===t}var N3t=["rect","polygon","keep","clear"];function O3t(t,e){var n=NAt(t?t.brush:[]);if(n.length){var i=[];S_t(n,(function(t){var e=t.hasOwnProperty("toolbox")?t.toolbox:[];e instanceof Array&&(i=i.concat(e))}));var r=t&&t.toolbox;E_t(r)&&(r=r[0]),r||(r={feature:{}},t.toolbox=[r]);var o,a,s=r.feature||(r.feature={}),l=s.brush||(s.brush={}),u=l.type||(l.type=[]);u.push.apply(u,i),a={},S_t(o=u,(function(t){a[t]=1})),o.length=0,S_t(a,(function(t,e){o.push(e)})),e&&!u.length&&u.push.apply(u,N3t)}}var F3t=S_t;function R3t(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!0}function L3t(t,e,n){var i={};return F3t(e,(function(e){var r,o=i[e]=((r=function(){}).prototype.__hidden=r.prototype,new r);F3t(t[e],(function(t,i){if(kqt.isValidType(i)){var r={type:i,visual:t};n&&n(r,e),o[i]=new kqt(r),"opacity"===i&&((r=g_t(r)).type="colorAlpha",o.__hidden.__alphaForOpacity=new kqt(r))}}))})),i}function $3t(t,e,n){var i;S_t(n,(function(t){e.hasOwnProperty(t)&&R3t(e[t])&&(i=!0)})),i&&S_t(n,(function(n){e.hasOwnProperty(n)&&R3t(e[n])?t[n]=g_t(e[n]):delete t[n]}))}var P3t={lineX:z3t(0),lineY:z3t(1),rect:{point:function(t,e,n){return t&&n.boundingRect.contain(t[0],t[1])},rect:function(t,e,n){return t&&n.boundingRect.intersect(t)}},polygon:{point:function(t,e,n){return t&&n.boundingRect.contain(t[0],t[1])&&zPt(n.range,t[0],t[1])},rect:function(t,e,n){var i=n.range;if(!t||i.length<=1)return!1;var r=t.x,o=t.y,a=t.width,s=t.height,l=i[0];return!!(zPt(i,r,o)||zPt(i,r+a,o)||zPt(i,r,o+s)||zPt(i,r+a,o+s)||PCt.create(t).contain(l[0],l[1])||eNt(r,o,r+a,o,i)||eNt(r,o,r,o+s,i)||eNt(r+a,o,r+a,o+s,i)||eNt(r,o+s,r+a,o+s,i))||void 0}}};function z3t(t){var e=["x","y"],n=["width","height"];return{point:function(e,n,i){if(e){var r=i.range;return B3t(e[t],r)}},rect:function(i,r,o){if(i){var a=o.range,s=[i[e[t]],i[e[t]]+i[n[t]]];return s[1]<s[0]&&s.reverse(),B3t(s[0],a)||B3t(s[1],a)||B3t(a[0],s)||B3t(a[1],s)}}}}function B3t(t,e){return e[0]<=t&&t<=e[1]}var V3t=["inBrush","outOfBrush"],W3t="__ecInBrushSelectEvent";function j3t(t){t.eachComponent({mainType:"brush"},(function(e){(e.brushTargetManager=new j2t(e.option,t)).setInputRanges(e.areas,t)}))}function U3t(t,e,n){var i,r,o=[];t.eachComponent({mainType:"brush"},(function(t){n&&"takeGlobalCursor"===n.type&&t.setBrushOption("brush"===n.key?n.brushOption:{brushType:!1})})),j3t(t),t.eachComponent({mainType:"brush"},(function(e,n){var a={brushId:e.id,brushIndex:n,brushName:e.name,areas:g_t(e.areas),selected:[]};o.push(a);var s=e.option,l=s.brushLink,u=[],c=[],h=[],d=!1;n||(i=s.throttleType,r=s.throttleDelay);var p=C_t(e.areas,(function(t){var e=q3t[t.brushType],n=x_t({boundingRect:e?e(t):void 0},t);return n.selectors=function(t){var e=t.brushType,n={point:function(i){return P3t[e].point(i,n,t)},rect:function(i){return P3t[e].rect(i,n,t)}};return n}(n),n})),f=L3t(e.option,V3t,(function(t){t.mappingMethod="fixed"}));function g(t){return"all"===l||!!u[t]}function m(t){return!!t.length}E_t(l)&&S_t(l,(function(t){u[t]=1})),t.eachSeries((function(n,i){var r=h[i]=[];"parallel"===n.subType?function(t,e){var n=t.coordinateSystem;d=d||n.hasAxisBrushed(),g(e)&&n.eachActiveState(t.getData(),(function(t,e){"active"===t&&(c[e]=1)}))}(n,i):function(n,i,r){if(!n.brushSelector||function(t,e){var n=t.option.seriesIndex;return null!=n&&"all"!==n&&(E_t(n)?w_t(n,e)<0:e!==n)}(e,i))return;if(S_t(p,(function(i){e.brushTargetManager.controlSeries(i,n,t)&&r.push(i),d=d||m(r)})),g(i)&&m(r)){var o=n.getData();o.each((function(t){H3t(n,r,o,t)&&(c[t]=1)}))}}(n,i,r)})),t.eachSeries((function(t,e){var n={seriesId:t.id,seriesIndex:e,seriesName:t.name,dataIndex:[]};a.selected.push(n);var i=h[e],r=t.getData(),o=g(e)?function(t){return c[t]?(n.dataIndex.push(r.getRawIndex(t)),"inBrush"):"outOfBrush"}:function(e){return H3t(t,i,r,e)?(n.dataIndex.push(r.getRawIndex(e)),"inBrush"):"outOfBrush"};(g(e)?d:m(i))&&function(t,e,n,i,r,o){var a,s={};function l(t){return qLt(n,a,t)}function u(t,e){YLt(n,a,t,e)}function c(t,c){a=null==o?t:c;var h=n.getRawDataItem(a);if(!h||!1!==h.visualMap)for(var d=i.call(r,t),p=e[d],f=s[d],g=0,m=f.length;g<m;g++){var y=f[g];p[y]&&p[y].applyVisual(t,l,u)}}S_t(t,(function(t){var n=kqt.prepareVisualTypes(e[t]);s[t]=n})),null==o?n.each(c):n.each([o],c)}(V3t,f,r,o)}))})),function(t,e,n,i,r){if(!r)return;var o=t.getZr();if(o[W3t])return;o.__ecBrushSelect||(o.__ecBrushSelect=G3t);gLt(o,"__ecBrushSelect",n,e)(t,i)}(e,i,r,o,n)}function G3t(t,e){if(!t.isDisposed()){var n=t.getZr();n[W3t]=!0,t.dispatchAction({type:"brushSelect",batch:e}),n[W3t]=!1}}function H3t(t,e,n,i){for(var r=0,o=e.length;r<o;r++){var a=e[r];if(t.brushSelector(i,n,a.selectors,a))return!0}}var q3t={rect:function(t){return X3t(t.range)},polygon:function(t){for(var e,n=t.range,i=0,r=n.length;i<r;i++){e=e||[[1/0,-1/0],[1/0,-1/0]];var o=n[i];o[0]<e[0][0]&&(e[0][0]=o[0]),o[0]>e[0][1]&&(e[0][1]=o[0]),o[1]<e[1][0]&&(e[1][0]=o[1]),o[1]>e[1][1]&&(e[1][1]=o[1])}return e&&X3t(e)}};function X3t(t){return new PCt(t[0][0],t[1][0],t[0][1]-t[0][0],t[1][1]-t[1][0])}var Y3t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(t,e){this.ecModel=t,this.api=e,this.model,(this._brushController=new ZYt(e.getZr())).on("brush",D_t(this._onBrush,this)).mount()},e.prototype.render=function(t,e,n,i){this.model=t,this._updateController(t,e,n,i)},e.prototype.updateTransform=function(t,e,n,i){j3t(e),this._updateController(t,e,n,i)},e.prototype.updateVisual=function(t,e,n,i){this.updateTransform(t,e,n,i)},e.prototype.updateView=function(t,e,n,i){this._updateController(t,e,n,i)},e.prototype._updateController=function(t,e,n,i){(!i||i.$from!==t.id)&&this._brushController.setPanels(t.brushTargetManager.makePanelOpts(n)).enableBrush(t.brushOption).updateCovers(t.areas.slice())},e.prototype.dispose=function(){this._brushController.dispose()},e.prototype._onBrush=function(t){var e=this.model.id,n=this.model.brushTargetManager.setOutputRanges(t.areas,this.ecModel);(!t.isEnd||t.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:e,areas:g_t(n),$from:e}),t.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:e,areas:g_t(n),$from:e})},e.type="brush",e}(nLt),K3t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.areas=[],n.brushOption={},n}return Dit(e,t),e.prototype.optionUpdated=function(t,e){var n=this.option;!e&&$3t(n,t,["inBrush","outOfBrush"]);var i=n.inBrush=n.inBrush||{};n.outOfBrush=n.outOfBrush||{color:"#ddd"},i.hasOwnProperty("liftZ")||(i.liftZ=5)},e.prototype.setAreas=function(t){t&&(this.areas=C_t(t,(function(t){return Z3t(this.option,t)}),this))},e.prototype.setBrushOption=function(t){this.brushOption=Z3t(this.option,t),this.brushType=this.brushOption.brushType},e.type="brush",e.dependencies=["geo","grid","xAxis","yAxis","parallel","series"],e.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:"rgba(210,219,238,0.3)",borderColor:"#D2DBEE"},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4},e}(FOt);function Z3t(t,e){return m_t({brushType:t.brushType,brushMode:t.brushMode,transformable:t.transformable,brushStyle:new NNt(t.brushStyle).getItemStyle(),removeOnClick:t.removeOnClick,z:t.z},e,!0)}var J3t=["rect","polygon","lineX","lineY","keep","clear"],Q3t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dit(e,t),e.prototype.render=function(t,e,n){var i,r,o;e.eachComponent({mainType:"brush"},(function(t){i=t.brushType,r=t.brushOption.brushMode||"single",o=o||!!t.areas.length})),this._brushType=i,this._brushMode=r,S_t(t.get("type",!0),(function(e){t.setIconStatus(e,("keep"===e?"multiple"===r:"clear"===e?o:e===i)?"emphasis":"normal")}))},e.prototype.updateView=function(t,e,n){this.render(t,e,n)},e.prototype.getIcons=function(){var t=this.model,e=t.get("icon",!0),n={};return S_t(t.get("type",!0),(function(t){e[t]&&(n[t]=e[t])})),n},e.prototype.onclick=function(t,e,n){var i=this._brushType,r=this._brushMode;"clear"===n?(e.dispatchAction({type:"axisAreaSelect",intervals:[]}),e.dispatchAction({type:"brush",command:"clear",areas:[]})):e.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:"keep"===n?i:i!==n&&n,brushMode:"keep"===n?"multiple"===r?"single":"multiple":r}})},e.getDefaultOption=function(t){return{show:!0,type:J3t.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:t.getLocale(["toolbox","brush","title"])}},e}(w2t);var t5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.layoutMode={type:"box",ignoreSize:!0},n}return Dit(e,t),e.type="title",e.defaultOption={zlevel:0,z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}},e}(FOt),e5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.render=function(t,e,n){if(this.group.removeAll(),t.get("show")){var i=this.group,r=t.getModel("textStyle"),o=t.getModel("subtextStyle"),a=t.get("textAlign"),s=W_t(t.get("textBaseline"),t.get("textVerticalAlign")),l=new xDt({style:hNt(r,{text:t.get("text"),fill:r.getTextColor()},{disableBox:!0}),z2:10}),u=l.getBoundingRect(),c=t.get("subtext"),h=new xDt({style:hNt(o,{text:c,fill:o.getTextColor(),y:u.height+t.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),d=t.get("link"),p=t.get("sublink"),f=t.get("triggerEvent",!0);l.silent=!d&&!f,h.silent=!p&&!f,d&&l.on("click",(function(){wOt(d,"_"+t.get("target"))})),p&&h.on("click",(function(){wOt(p,"_"+t.get("subtarget"))})),IDt(l).eventData=IDt(h).eventData=f?{componentType:"title",componentIndex:t.componentIndex}:null,i.add(l),c&&i.add(h);var g=i.getBoundingRect(),m=t.getBoxLayoutParams();m.width=g.width,m.height=g.height;var y=IOt(m,{width:n.getWidth(),height:n.getHeight()},t.get("padding"));a||("middle"===(a=t.get("left")||t.get("right"))&&(a="center"),"right"===a?y.x+=y.width:"center"===a&&(y.x+=y.width/2)),s||("center"===(s=t.get("top")||t.get("bottom"))&&(s="middle"),"bottom"===s?y.y+=y.height:"middle"===s&&(y.y+=y.height/2),s=s||"top"),i.x=y.x,i.y=y.y,i.markRedraw();var v={align:a,verticalAlign:s};l.setStyle(v),h.setStyle(v),g=i.getBoundingRect();var x=y.margin,b=t.getItemStyle(["color","opacity"]);b.fill=t.get("backgroundColor");var w=new mDt({shape:{x:g.x-x[3],y:g.y-x[0],width:g.width+x[1]+x[3],height:g.height+x[0]+x[2],r:t.get("borderRadius")},style:b,subPixelOptimize:!0,silent:!0});i.add(w)}},e.type="title",e}(nLt);var n5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.layoutMode="box",n}return Dit(e,t),e.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n),this._initData()},e.prototype.mergeOption=function(e){t.prototype.mergeOption.apply(this,arguments),this._initData()},e.prototype.setCurrentIndex=function(t){null==t&&(t=this.option.currentIndex);var e=this._data.count();this.option.loop?t=(t%e+e)%e:(t>=e&&(t=e-1),t<0&&(t=0)),this.option.currentIndex=t},e.prototype.getCurrentIndex=function(){return this.option.currentIndex},e.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1},e.prototype.setPlayState=function(t){this.option.autoPlay=!!t},e.prototype.getPlayState=function(){return!!this.option.autoPlay},e.prototype._initData=function(){var t,e=this.option,n=e.data||[],i=e.axisType,r=this._names=[];"category"===i?(t=[],S_t(n,(function(e,n){var i,o=zAt(RAt(e),"");L_t(e)?(i=g_t(e)).value=n:i=n,t.push(i),r.push(o)}))):t=n;var o={category:"ordinal",time:"time",value:"number"}[i]||"number";(this._data=new GBt([{name:"value",type:o}],this)).initData(t,r)},e.prototype.getData=function(){return this._data},e.prototype.getCategories=function(){if("category"===this.get("axisType"))return this._names.slice()},e.type="timeline",e.defaultOption={zlevel:0,z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:5,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:"#000"},data:[]},e}(FOt),i5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="timeline.slider",e.defaultOption=RNt(n5t.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:!0,width:2,color:"#DAE1F5"},label:{position:"auto",show:!0,interval:"auto",rotate:0,color:"#A4B1D7"},itemStyle:{color:"#A4B1D7",borderWidth:1},checkpointStyle:{symbol:"circle",symbolSize:15,color:"#316bf3",borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0, 0, 0, 0.3)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:24,itemGap:12,position:"left",playIcon:"path://M31.6,53C17.5,53,6,41.5,6,27.4S17.5,1.8,31.6,1.8C45.7,1.8,57.2,13.3,57.2,27.4S45.7,53,31.6,53z M31.6,3.3 C18.4,3.3,7.5,14.1,7.5,27.4c0,13.3,10.8,24.1,24.1,24.1C44.9,51.5,55.7,40.7,55.7,27.4C55.7,14.1,44.9,3.3,31.6,3.3z M24.9,21.3 c0-2.2,1.6-3.1,3.5-2l10.5,6.1c1.899,1.1,1.899,2.9,0,4l-10.5,6.1c-1.9,1.1-3.5,0.2-3.5-2V21.3z",stopIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z",nextIcon:"M2,18.5A1.52,1.52,0,0,1,.92,18a1.49,1.49,0,0,1,0-2.12L7.81,9.36,1,3.11A1.5,1.5,0,1,1,3,.89l8,7.34a1.48,1.48,0,0,1,.49,1.09,1.51,1.51,0,0,1-.46,1.1L3,18.08A1.5,1.5,0,0,1,2,18.5Z",prevIcon:"M10,.5A1.52,1.52,0,0,1,11.08,1a1.49,1.49,0,0,1,0,2.12L4.19,9.64,11,15.89a1.5,1.5,0,1,1-2,2.22L1,10.77A1.48,1.48,0,0,1,.5,9.68,1.51,1.51,0,0,1,1,8.58L9,.92A1.5,1.5,0,0,1,10,.5Z",prevBtnSize:18,nextBtnSize:18,color:"#A4B1D7",borderColor:"#A4B1D7",borderWidth:1},emphasis:{label:{show:!0,color:"#6f778d"},itemStyle:{color:"#316BF3"},controlStyle:{color:"#316BF3",borderColor:"#316BF3",borderWidth:2}},progress:{lineStyle:{color:"#316BF3"},itemStyle:{color:"#316BF3"},label:{color:"#6f778d"}},data:[]}),e}(n5t);__t(i5t,sRt.prototype);var r5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="timeline",e}(nLt),o5t=function(t){function e(e,n,i,r){var o=t.call(this,e,n,i)||this;return o.type=r||"value",o}return Dit(e,t),e.prototype.getLabelModel=function(){return this.model.getModel("label")},e.prototype.isHorizontal=function(){return"horizontal"===this.model.get("orient")},e}(fWt),a5t=Math.PI,s5t=jAt(),l5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(t,e){this.api=e},e.prototype.render=function(t,e,n){if(this.model=t,this.api=n,this.ecModel=e,this.group.removeAll(),t.get("show",!0)){var i=this._layout(t,n),r=this._createGroup("_mainGroup"),o=this._createGroup("_labelGroup"),a=this._axis=this._createAxis(i,t);t.formatTooltip=function(t){return RRt("nameValue",{noName:!0,value:a.scale.getLabel({value:t})})},S_t(["AxisLine","AxisTick","Control","CurrentPointer"],(function(e){this["_render"+e](i,r,a,t)}),this),this._renderAxisLabel(i,o,a,t),this._position(i,t)}this._doPlayStop(),this._updateTicksStatus()},e.prototype.remove=function(){this._clearTimer(),this.group.removeAll()},e.prototype.dispose=function(){this._clearTimer()},e.prototype._layout=function(t,e){var n,i,r,o,a=t.get(["label","position"]),s=t.get("orient"),l=function(t,e){return IOt(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()},t.get("padding"))}(t,e),u={horizontal:"center",vertical:(n=null==a||"auto"===a?"horizontal"===s?l.y+l.height/2<e.getHeight()/2?"-":"+":l.x+l.width/2<e.getWidth()/2?"+":"-":O_t(a)?{horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[s][a]:a)>=0||"+"===n?"left":"right"},c={horizontal:n>=0||"+"===n?"top":"bottom",vertical:"middle"},h={horizontal:0,vertical:a5t/2},d="vertical"===s?l.height:l.width,p=t.getModel("controlStyle"),f=p.get("show",!0),g=f?p.get("itemSize"):0,m=f?p.get("itemGap"):0,y=g+m,v=t.get(["label","rotate"])||0;v=v*a5t/180;var x=p.get("position",!0),b=f&&p.get("showPlayBtn",!0),w=f&&p.get("showPrevBtn",!0),_=f&&p.get("showNextBtn",!0),k=0,S=d;"left"===x||"bottom"===x?(b&&(i=[0,0],k+=y),w&&(r=[k,0],k+=y),_&&(o=[S-g,0],S-=y)):(b&&(i=[S-g,0],S-=y),w&&(r=[0,0],k+=y),_&&(o=[S-g,0],S-=y));var C=[k,S];return t.get("inverse")&&C.reverse(),{viewRect:l,mainLength:d,orient:s,rotation:h[s],labelRotation:v,labelPosOpt:n,labelAlign:t.get(["label","align"])||u[s],labelBaseline:t.get(["label","verticalAlign"])||t.get(["label","baseline"])||c[s],playPosition:i,prevBtnPosition:r,nextBtnPosition:o,axisExtent:C,controlSize:g,controlGap:m}},e.prototype._position=function(t,e){var n=this._mainGroup,i=this._labelGroup,r=t.viewRect;if("vertical"===t.orient){var o=[1,0,0,1,0,0],a=r.x,s=r.y+r.height;mCt(o,o,[-a,-s]),yCt(o,o,-a5t/2),mCt(o,o,[a,s]),(r=r.clone()).applyTransform(o)}var l=m(r),u=m(n.getBoundingRect()),c=m(i.getBoundingRect()),h=[n.x,n.y],d=[i.x,i.y];d[0]=h[0]=l[0][0];var p,f=t.labelPosOpt;null==f||O_t(f)?(y(h,u,l,1,p="+"===f?0:1),y(d,c,l,1,1-p)):(y(h,u,l,1,p=f>=0?0:1),d[1]=h[1]+f);function g(t){t.originX=l[0][0]-t.x,t.originY=l[1][0]-t.y}function m(t){return[[t.x,t.x+t.width],[t.y,t.y+t.height]]}function y(t,e,n,i,r){t[i]+=n[i][r]-e[i][r]}n.setPosition(h),i.setPosition(d),n.rotation=i.rotation=t.rotation,g(n),g(i)},e.prototype._createAxis=function(t,e){var n=e.getData(),i=e.get("axisType"),r=function(t,e){if(e=e||t.get("type"))switch(e){case"category":return new hVt({ordinalMeta:t.getCategories(),extent:[1/0,-1/0]});case"time":return new AVt({locale:t.ecModel.getLocaleModel(),useUTC:t.ecModel.get("useUTC")});default:return new pVt}}(e,i);r.getTicks=function(){return n.mapArray(["value"],(function(t){return{value:t}}))};var o=n.getDataExtent("value");r.setExtent(o[0],o[1]),r.niceTicks();var a=new o5t("value",r,t.axisExtent,i);return a.model=e,a},e.prototype._createGroup=function(t){var e=this[t]=new oAt;return this.group.add(e),e},e.prototype._renderAxisLine=function(t,e,n,i){var r=n.getExtent();if(i.get(["lineStyle","show"])){var o=new hEt({shape:{x1:r[0],y1:0,x2:r[1],y2:0},style:v_t({lineCap:"round"},i.getModel("lineStyle").getLineStyle()),silent:!0,z2:1});e.add(o);var a=this._progressLine=new hEt({shape:{x1:r[0],x2:this._currentPointer?this._currentPointer.x:r[0],y1:0,y2:0},style:x_t({lineCap:"round",lineWidth:o.style.lineWidth},i.getModel(["progress","lineStyle"]).getLineStyle()),silent:!0,z2:1});e.add(a)}},e.prototype._renderAxisTick=function(t,e,n,i){var r=this,o=i.getData(),a=n.scale.getTicks();this._tickSymbols=[],S_t(a,(function(t){var a=n.dataToCoord(t.value),s=o.getItemModel(t.value),l=s.getModel("itemStyle"),u=s.getModel(["emphasis","itemStyle"]),c=s.getModel(["progress","itemStyle"]),h={x:a,y:0,onclick:D_t(r._changeTimeline,r,t.value)},d=u5t(s,l,e,h);d.ensureState("emphasis").style=u.getItemStyle(),d.ensureState("progress").style=c.getItemStyle(),uTt(d);var p=IDt(d);s.get("tooltip")?(p.dataIndex=t.value,p.dataModel=i):p.dataIndex=p.dataModel=null,r._tickSymbols.push(d)}))},e.prototype._renderAxisLabel=function(t,e,n,i){var r=this;if(n.getLabelModel().get("show")){var o=i.getData(),a=n.getViewLabels();this._tickLabels=[],S_t(a,(function(i){var a=i.tickValue,s=o.getItemModel(a),l=s.getModel("label"),u=s.getModel(["emphasis","label"]),c=s.getModel(["progress","label"]),h=n.dataToCoord(i.tickValue),d=new xDt({x:h,y:0,rotation:t.labelRotation-t.rotation,onclick:D_t(r._changeTimeline,r,a),silent:!1,style:hNt(l,{text:i.formattedLabel,align:t.labelAlign,verticalAlign:t.labelBaseline})});d.ensureState("emphasis").style=hNt(u),d.ensureState("progress").style=hNt(c),e.add(d),uTt(d),s5t(d).dataIndex=a,r._tickLabels.push(d)}))}},e.prototype._renderControl=function(t,e,n,i){var r=t.controlSize,o=t.rotation,a=i.getModel("controlStyle").getItemStyle(),s=i.getModel(["emphasis","controlStyle"]).getItemStyle(),l=i.getPlayState(),u=i.get("inverse",!0);function c(t,n,l,u){if(t){var c=XCt(W_t(i.get(["controlStyle",n+"BtnSize"]),r),r),h=function(t,e,n,i){var r=i.style,o=tNt(t.get(["controlStyle",e]),i||{},new PCt(n[0],n[1],n[2],n[3]));r&&o.setStyle(r);return o}(i,n+"Icon",[0,-c/2,c,c],{x:t[0],y:t[1],originX:r/2,originY:0,rotation:u?-o:0,rectHover:!0,style:a,onclick:l});h.ensureState("emphasis").style=s,e.add(h),uTt(h)}}c(t.nextBtnPosition,"next",D_t(this._changeTimeline,this,u?"-":"+")),c(t.prevBtnPosition,"prev",D_t(this._changeTimeline,this,u?"+":"-")),c(t.playPosition,l?"stop":"play",D_t(this._handlePlayClick,this,!l),!0)},e.prototype._renderCurrentPointer=function(t,e,n,i){var r=i.getData(),o=i.getCurrentIndex(),a=r.getItemModel(o).getModel("checkpointStyle"),s=this,l={onCreate:function(t){t.draggable=!0,t.drift=D_t(s._handlePointerDrag,s),t.ondragend=D_t(s._handlePointerDragend,s),c5t(t,s._progressLine,o,n,i,!0)},onUpdate:function(t){c5t(t,s._progressLine,o,n,i)}};this._currentPointer=u5t(a,a,this._mainGroup,{},this._currentPointer,l)},e.prototype._handlePlayClick=function(t){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:t,from:this.uid})},e.prototype._handlePointerDrag=function(t,e,n){this._clearTimer(),this._pointerChangeTimeline([n.offsetX,n.offsetY])},e.prototype._handlePointerDragend=function(t){this._pointerChangeTimeline([t.offsetX,t.offsetY],!0)},e.prototype._pointerChangeTimeline=function(t,e){var n=this._toAxisCoord(t)[0],i=fAt(this._axis.getExtent().slice());n>i[1]&&(n=i[1]),n<i[0]&&(n=i[0]),this._currentPointer.x=n,this._currentPointer.markRedraw(),this._progressLine.shape.x2=n,this._progressLine.dirty();var r=this._findNearestTick(n),o=this.model;(e||r!==o.getCurrentIndex()&&o.get("realtime"))&&this._changeTimeline(r)},e.prototype._doPlayStop=function(){var t=this;this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout((function(){var e=t.model;t._changeTimeline(e.getCurrentIndex()+(e.get("rewind",!0)?-1:1))}),this.model.get("playInterval")))},e.prototype._toAxisCoord=function(t){return YEt(t,this._mainGroup.getLocalTransform(),!0)},e.prototype._findNearestTick=function(t){var e,n=this.model.getData(),i=1/0,r=this._axis;return n.each(["value"],(function(n,o){var a=r.dataToCoord(n),s=Math.abs(a-t);s<i&&(i=s,e=o)})),e},e.prototype._clearTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},e.prototype._changeTimeline=function(t){var e=this.model.getCurrentIndex();"+"===t?t=e+1:"-"===t&&(t=e-1),this.api.dispatchAction({type:"timelineChange",currentIndex:t,from:this.uid})},e.prototype._updateTicksStatus=function(){var t=this.model.getCurrentIndex(),e=this._tickSymbols,n=this._tickLabels;if(e)for(var i=0;i<e.length;i++)e&&e[i]&&e[i].toggleState("progress",i<t);if(n)for(i=0;i<n.length;i++)n&&n[i]&&n[i].toggleState("progress",s5t(n[i]).dataIndex<=t)},e.type="timeline.slider",e}(r5t);function u5t(t,e,n,i,r,o){var a=e.get("color");r?(r.setColor(a),n.add(r),o&&o.onUpdate(r)):((r=U$t(t.get("symbol"),-1,-1,2,2,a)).setStyle("strokeNoScale",!0),n.add(r),o&&o.onCreate(r));var s=e.getItemStyle(["color"]);r.setStyle(s),i=m_t({rectHover:!0,z2:100},i,!0);var l=t.get("symbolSize");l=l instanceof Array?l.slice():[+l,+l],i.scaleX=l[0]/2,i.scaleY=l[1]/2;var u=t.get("symbolOffset");u&&(i.x=i.x||0,i.y=i.y||0,i.x+=dAt(u[0],l[0]),i.y+=dAt(u[1],l[1]));var c=t.get("symbolRotate");return i.rotation=(c||0)*Math.PI/180||0,r.attr(i),r.updateTransform(),r}function c5t(t,e,n,i,r,o){if(!t.dragging){var a=r.getModel("checkpointStyle"),s=i.dataToCoord(r.getData().get("value",n));if(o||!a.get("animation",!0))t.attr({x:s,y:0}),e&&e.attr({shape:{x2:s}});else{var l={duration:a.get("animationDuration",!0),easing:a.get("animationEasing",!0)};t.stopAnimation(null,!0),t.animateTo({x:s,y:0},l),e&&e.animateTo({shape:{x2:s}},l)}}}function h5t(t){var e=t&&t.timeline;E_t(e)||(e=e?[e]:[]),S_t(e,(function(t){t&&function(t){var e=t.type,n={number:"value",time:"time"};n[e]&&(t.axisType=n[e],delete t.type);if(d5t(t),p5t(t,"controlPosition")){var i=t.controlStyle||(t.controlStyle={});p5t(i,"position")||(i.position=t.controlPosition),"none"!==i.position||p5t(i,"show")||(i.show=!1,delete i.position),delete t.controlPosition}S_t(t.data||[],(function(t){L_t(t)&&!E_t(t)&&(!p5t(t,"value")&&p5t(t,"name")&&(t.value=t.name),d5t(t))}))}(t)}))}function d5t(t){var e=t.itemStyle||(t.itemStyle={}),n=e.emphasis||(e.emphasis={}),i=t.label||t.label||{},r=i.normal||(i.normal={}),o={normal:1,emphasis:1};S_t(i,(function(t,e){o[e]||p5t(r,e)||(r[e]=t)})),n.label&&!p5t(i,"emphasis")&&(i.emphasis=n.label,delete n.label)}function p5t(t,e){return t.hasOwnProperty(e)}function f5t(t,e){if(!t)return!1;for(var n=E_t(t)?t:[t],i=0;i<n.length;i++)if(n[i]&&n[i][e])return!0;return!1}function g5t(t){OAt(t,"label",["show"])}var m5t=jAt(),y5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.createdBySelf=!1,n}return Dit(e,t),e.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n),this._mergeOption(t,n,!1,!0)},e.prototype.isAnimationEnabled=function(){if(t_t.node)return!1;var t=this.__hostSeries;return this.getShallow("animation")&&t&&t.isAnimationEnabled()},e.prototype.mergeOption=function(t,e){this._mergeOption(t,e,!1,!1)},e.prototype._mergeOption=function(t,e,n,i){var r=this.mainType;n||e.eachSeries((function(t){var n=t.get(this.mainType,!0),o=m5t(t)[r];n&&n.data?(o?o._mergeOption(n,e,!0):(i&&g5t(n),S_t(n.data,(function(t){t instanceof Array?(g5t(t[0]),g5t(t[1])):g5t(t)})),v_t(o=this.createMarkerModelFromSeries(n,this,e),{mainType:this.mainType,seriesIndex:t.seriesIndex,name:t.name,createdBySelf:!0}),o.__hostSeries=t),m5t(t)[r]=o):m5t(t)[r]=null}),this)},e.prototype.formatTooltip=function(t,e,n){var i=this.getData(),r=this.getRawValue(t),o=i.getName(t);return RRt("section",{header:this.name,blocks:[RRt("nameValue",{name:o,value:r,noName:!o,noValue:null==r})]})},e.prototype.getData=function(){return this._data},e.prototype.setData=function(t){this._data=t},e.getMarkerModelFromSeries=function(t,e){return m5t(t)[e]},e.type="marker",e.dependencies=["series","grid","polar","geo"],e}(FOt);__t(y5t,sRt.prototype);var v5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.createMarkerModelFromSeries=function(t,n,i){return new e(t,n,i)},e.type="markPoint",e.defaultOption={zlevel:0,z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},e}(y5t);function x5t(t,e,n,i,r,o){var a=[],s=JBt(e,i)?e.getCalculationInfo("stackResultDimension"):i,l=C5t(e,s,t),u=e.indicesOfNearest(s,l)[0];a[r]=e.get(n,u),a[o]=e.get(s,u);var c=e.get(i,u),h=gAt(e.get(i,u));return(h=Math.min(h,20))>=0&&(a[o]=+a[o].toFixed(h)),[a,c]}var b5t={min:T_t(x5t,"min"),max:T_t(x5t,"max"),average:T_t(x5t,"average"),median:T_t(x5t,"median")};function w5t(t,e){var n=t.getData(),i=t.coordinateSystem;if(e&&!function(t){return!isNaN(parseFloat(t.x))&&!isNaN(parseFloat(t.y))}(e)&&!E_t(e.coord)&&i){var r=i.dimensions,o=_5t(e,n,i,t);if((e=g_t(e)).type&&b5t[e.type]&&o.baseAxis&&o.valueAxis){var a=w_t(r,o.baseAxis.dim),s=w_t(r,o.valueAxis.dim),l=b5t[e.type](n,o.baseDataDim,o.valueDataDim,a,s);e.coord=l[0],e.value=l[1]}else{for(var u=[null!=e.xAxis?e.xAxis:e.radiusAxis,null!=e.yAxis?e.yAxis:e.angleAxis],c=0;c<2;c++)b5t[u[c]]&&(u[c]=C5t(n,n.mapDimension(r[c]),u[c]));e.coord=u}}return e}function _5t(t,e,n,i){var r={};return null!=t.valueIndex||null!=t.valueDim?(r.valueDataDim=null!=t.valueIndex?e.getDimension(t.valueIndex):t.valueDim,r.valueAxis=n.getAxis(function(t,e){var n=t.getData(),i=n.dimensions;e=n.getDimension(e);for(var r=0;r<i.length;r++){var o=n.getDimensionInfo(i[r]);if(o.name===e)return o.coordDim}}(i,r.valueDataDim)),r.baseAxis=n.getOtherAxis(r.valueAxis),r.baseDataDim=e.mapDimension(r.baseAxis.dim)):(r.baseAxis=i.getBaseAxis(),r.valueAxis=n.getOtherAxis(r.baseAxis),r.baseDataDim=e.mapDimension(r.baseAxis.dim),r.valueDataDim=e.mapDimension(r.valueAxis.dim)),r}function k5t(t,e){return!(t&&t.containData&&e.coord&&!function(t){return!(isNaN(parseFloat(t.x))&&isNaN(parseFloat(t.y)))}(e))||t.containData(e.coord)}function S5t(t,e,n,i){return i<2?t.coord&&t.coord[i]:t.value}function C5t(t,e,n){if("average"===n){var i=0,r=0;return t.each(e,(function(t,e){isNaN(t)||(i+=t,r++)})),i/r}return"median"===n?t.getMedian(e):t.getDataExtent(e)["max"===n?1:0]}var A5t=jAt(),I5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.init=function(){this.markerGroupMap=Z_t()},e.prototype.render=function(t,e,n){var i=this,r=this.markerGroupMap;r.each((function(t){A5t(t).keep=!1})),e.eachSeries((function(t){var r=y5t.getMarkerModelFromSeries(t,i.type);r&&i.renderSeries(t,r,e,n)})),r.each((function(t){!A5t(t).keep&&i.group.remove(t.group)}))},e.prototype.markKeep=function(t){A5t(t).keep=!0},e.prototype.blurSeries=function(t){var e=this;S_t(t,(function(t){var n=y5t.getMarkerModelFromSeries(t,e.type);n&&n.getData().eachItemGraphicEl((function(t){t&&JDt(t)}))}))},e.type="marker",e}(nLt);function M5t(t,e,n){var i=e.coordinateSystem;t.each((function(r){var o,a=t.getItemModel(r),s=dAt(a.get("x"),n.getWidth()),l=dAt(a.get("y"),n.getHeight());if(isNaN(s)||isNaN(l)){if(e.getMarkerPosition)o=e.getMarkerPosition(t.getValues(t.dimensions,r));else if(i){var u=t.get(i.dimensions[0],r),c=t.get(i.dimensions[1],r);o=i.dataToPoint([u,c])}}else o=[s,l];isNaN(s)||(o[0]=s),isNaN(l)||(o[1]=l),t.setItemLayout(r,o)}))}var D5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.updateTransform=function(t,e,n){e.eachSeries((function(t){var e=y5t.getMarkerModelFromSeries(t,"markPoint");e&&(M5t(e.getData(),t,n),this.markerGroupMap.get(t.id).updateLayout())}),this)},e.prototype.renderSeries=function(t,e,n,i){var r=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap,l=s.get(o)||s.set(o,new yjt),u=function(t,e,n){var i;i=t?C_t(t&&t.dimensions,(function(t){return x_t({name:t},e.getData().getDimensionInfo(e.getData().mapDimension(t))||{})})):[{name:"value",type:"float"}];var r=new GBt(i,n),o=C_t(n.get("data"),T_t(w5t,e));t&&(o=I_t(o,T_t(k5t,t)));return r.initData(o,null,t?S5t:function(t){return t.value}),r}(r,t,e);e.setData(u),M5t(e.getData(),t,i),u.each((function(t){var n=u.getItemModel(t),i=n.getShallow("symbol"),r=n.getShallow("symbolSize"),o=n.getShallow("symbolRotate");if(N_t(i)||N_t(r)||N_t(o)){var s=e.getRawValue(t),l=e.getDataParams(t);N_t(i)&&(i=i(s,l)),N_t(r)&&(r=r(s,l)),N_t(o)&&(o=o(s,l))}var c=n.getModel("itemStyle").getItemStyle(),h=XLt(a,"color");c.fill||(c.fill=h),u.setItemVisual(t,{symbol:i,symbolSize:r,symbolRotate:o,style:c})})),l.updateData(u),this.group.add(l.group),u.eachItemGraphicEl((function(t){t.traverse((function(t){IDt(t).dataModel=e}))})),this.markKeep(l),l.group.silent=e.get("silent")||t.get("silent")},e.type="markPoint",e}(I5t);var T5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.createMarkerModelFromSeries=function(t,n,i){return new e(t,n,i)},e.type="markLine",e.defaultOption={zlevel:0,z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},e}(y5t),E5t=jAt(),N5t=function(t,e,n,i){var r,o=t.getData();if(E_t(i))r=i;else{var a=i.type;if("min"===a||"max"===a||"average"===a||"median"===a||null!=i.xAxis||null!=i.yAxis){var s=void 0,l=void 0;if(null!=i.yAxis||null!=i.xAxis)s=e.getAxis(null!=i.yAxis?"y":"x"),l=V_t(i.yAxis,i.xAxis);else{var u=_5t(i,o,e,t);s=u.valueAxis,l=C5t(o,QBt(o,u.valueDataDim),a)}var c="x"===s.dim?0:1,h=1-c,d=g_t(i),p={coord:[]};d.type=null,d.coord=[],d.coord[h]=-1/0,p.coord[h]=1/0;var f=n.get("precision");f>=0&&"number"==typeof l&&(l=+l.toFixed(Math.min(f,20))),d.coord[c]=p.coord[c]=l,r=[d,p,{type:a,valueIndex:i.valueIndex,value:l}]}else r=[]}var g=[w5t(t,r[0]),w5t(t,r[1]),v_t({},r[2])];return g[2].type=g[2].type||null,m_t(g[2],g[0]),m_t(g[2],g[1]),g};function O5t(t){return!isNaN(t)&&!isFinite(t)}function F5t(t,e,n,i){var r=1-t,o=i.dimensions[t];return O5t(e[r])&&O5t(n[r])&&e[t]===n[t]&&i.getAxis(o).containData(e[t])}function R5t(t,e){if("cartesian2d"===t.type){var n=e[0].coord,i=e[1].coord;if(n&&i&&(F5t(1,n,i,t)||F5t(0,n,i,t)))return!0}return k5t(t,e[0])&&k5t(t,e[1])}function L5t(t,e,n,i,r){var o,a=i.coordinateSystem,s=t.getItemModel(e),l=dAt(s.get("x"),r.getWidth()),u=dAt(s.get("y"),r.getHeight());if(isNaN(l)||isNaN(u)){if(i.getMarkerPosition)o=i.getMarkerPosition(t.getValues(t.dimensions,e));else{var c=a.dimensions,h=t.get(c[0],e),d=t.get(c[1],e);o=a.dataToPoint([h,d])}if(Fjt(a,"cartesian2d")){var p=a.getAxis("x"),f=a.getAxis("y");c=a.dimensions;O5t(t.get(c[0],e))?o[0]=p.toGlobalCoord(p.getExtent()[n?0:1]):O5t(t.get(c[1],e))&&(o[1]=f.toGlobalCoord(f.getExtent()[n?0:1]))}isNaN(l)||(o[0]=l),isNaN(u)||(o[1]=u)}else o=[l,u];t.setItemLayout(e,o)}var $5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.updateTransform=function(t,e,n){e.eachSeries((function(t){var e=y5t.getMarkerModelFromSeries(t,"markLine");if(e){var i=e.getData(),r=E5t(e).from,o=E5t(e).to;r.each((function(e){L5t(r,e,!0,t,n),L5t(o,e,!1,t,n)})),i.each((function(t){i.setItemLayout(t,[r.getItemLayout(t),o.getItemLayout(t)])})),this.markerGroupMap.get(t.id).updateLayout()}}),this)},e.prototype.renderSeries=function(t,e,n,i){var r=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap,l=s.get(o)||s.set(o,new FXt);this.group.add(l.group);var u=function(t,e,n){var i;i=t?C_t(t&&t.dimensions,(function(t){return x_t({name:t},e.getData().getDimensionInfo(e.getData().mapDimension(t))||{})})):[{name:"value",type:"float"}];var r=new GBt(i,n),o=new GBt(i,n),a=new GBt([],n),s=C_t(n.get("data"),T_t(N5t,e,t,n));t&&(s=I_t(s,T_t(R5t,t)));var l=t?S5t:function(t){return t.value};return r.initData(C_t(s,(function(t){return t[0]})),null,l),o.initData(C_t(s,(function(t){return t[1]})),null,l),a.initData(C_t(s,(function(t){return t[2]}))),a.hasItemOption=!0,{from:r,to:o,line:a}}(r,t,e),c=u.from,h=u.to,d=u.line;E5t(e).from=c,E5t(e).to=h,e.setData(d);var p=e.get("symbol"),f=e.get("symbolSize"),g=e.get("symbolRotate"),m=e.get("symbolOffset");function y(e,n,r){var o=e.getItemModel(n);L5t(e,n,r,t,i);var s=o.getModel("itemStyle").getItemStyle();null==s.fill&&(s.fill=XLt(a,"color")),e.setItemVisual(n,{symbolKeepAspect:o.get("symbolKeepAspect"),symbolOffset:W_t(o.get("symbolOffset"),m[r?0:1]),symbolRotate:W_t(o.get("symbolRotate",!0),g[r?0:1]),symbolSize:W_t(o.get("symbolSize"),f[r?0:1]),symbol:W_t(o.get("symbol",!0),p[r?0:1]),style:s})}E_t(p)||(p=[p,p]),E_t(f)||(f=[f,f]),E_t(g)||(g=[g,g]),E_t(m)||(m=[m,m]),u.from.each((function(t){y(c,t,!0),y(h,t,!1)})),d.each((function(t){var e=d.getItemModel(t).getModel("lineStyle").getLineStyle();d.setItemLayout(t,[c.getItemLayout(t),h.getItemLayout(t)]),null==e.stroke&&(e.stroke=c.getItemVisual(t,"style").fill),d.setItemVisual(t,{fromSymbolKeepAspect:c.getItemVisual(t,"symbolKeepAspect"),fromSymbolOffset:c.getItemVisual(t,"symbolOffset"),fromSymbolRotate:c.getItemVisual(t,"symbolRotate"),fromSymbolSize:c.getItemVisual(t,"symbolSize"),fromSymbol:c.getItemVisual(t,"symbol"),toSymbolKeepAspect:h.getItemVisual(t,"symbolKeepAspect"),toSymbolOffset:h.getItemVisual(t,"symbolOffset"),toSymbolRotate:h.getItemVisual(t,"symbolRotate"),toSymbolSize:h.getItemVisual(t,"symbolSize"),toSymbol:h.getItemVisual(t,"symbol"),style:e})})),l.updateData(d),u.line.eachItemGraphicEl((function(t,n){t.traverse((function(t){IDt(t).dataModel=e}))})),this.markKeep(l),l.group.silent=e.get("silent")||t.get("silent")},e.type="markLine",e}(I5t);var P5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.createMarkerModelFromSeries=function(t,n,i){return new e(t,n,i)},e.type="markArea",e.defaultOption={zlevel:0,z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},e}(y5t),z5t=jAt(),B5t=function(t,e,n,i){var r=w5t(t,i[0]),o=w5t(t,i[1]),a=r.coord,s=o.coord;a[0]=V_t(a[0],-1/0),a[1]=V_t(a[1],-1/0),s[0]=V_t(s[0],1/0),s[1]=V_t(s[1],1/0);var l=y_t([{},r,o]);return l.coord=[r.coord,o.coord],l.x0=r.x,l.y0=r.y,l.x1=o.x,l.y1=o.y,l};function V5t(t){return!isNaN(t)&&!isFinite(t)}function W5t(t,e,n,i){var r=1-t;return V5t(e[r])&&V5t(n[r])}function j5t(t,e){var n=e.coord[0],i=e.coord[1];return!!(Fjt(t,"cartesian2d")&&n&&i&&(W5t(1,n,i)||W5t(0,n,i)))||(k5t(t,{coord:n,x:e.x0,y:e.y0})||k5t(t,{coord:i,x:e.x1,y:e.y1}))}function U5t(t,e,n,i,r){var o,a=i.coordinateSystem,s=t.getItemModel(e),l=dAt(s.get(n[0]),r.getWidth()),u=dAt(s.get(n[1]),r.getHeight());if(isNaN(l)||isNaN(u)){if(i.getMarkerPosition)o=i.getMarkerPosition(t.getValues(n,e));else{var c=[p=t.get(n[0],e),f=t.get(n[1],e)];a.clampData&&a.clampData(c,c),o=a.dataToPoint(c,!0)}if(Fjt(a,"cartesian2d")){var h=a.getAxis("x"),d=a.getAxis("y"),p=t.get(n[0],e),f=t.get(n[1],e);V5t(p)?o[0]=h.toGlobalCoord(h.getExtent()["x0"===n[0]?0:1]):V5t(f)&&(o[1]=d.toGlobalCoord(d.getExtent()["y0"===n[1]?0:1]))}isNaN(l)||(o[0]=l),isNaN(u)||(o[1]=u)}else o=[l,u];return o}var G5t=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],H5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.updateTransform=function(t,e,n){e.eachSeries((function(t){var e=y5t.getMarkerModelFromSeries(t,"markArea");if(e){var i=e.getData();i.each((function(e){var r=C_t(G5t,(function(r){return U5t(i,e,r,t,n)}));i.setItemLayout(e,r),i.getItemGraphicEl(e).setShape("points",r)}))}}),this)},e.prototype.renderSeries=function(t,e,n,i){var r=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap,l=s.get(o)||s.set(o,{group:new oAt});this.group.add(l.group),this.markKeep(l);var u=function(t,e,n){var i,r,o=["x0","y0","x1","y1"];t?(i=C_t(t&&t.dimensions,(function(t){var n=e.getData();return x_t({name:t},n.getDimensionInfo(n.mapDimension(t))||{})})),r=new GBt(C_t(o,(function(t,e){return{name:t,type:i[e%2].type}})),n)):r=new GBt(i=[{name:"value",type:"float"}],n);var a=C_t(n.get("data"),T_t(B5t,e,t,n));t&&(a=I_t(a,T_t(j5t,t)));var s=t?function(t,e,n,i){return t.coord[Math.floor(i/2)][i%2]}:function(t){return t.value};return r.initData(a,null,s),r.hasItemOption=!0,r}(r,t,e);e.setData(u),u.each((function(e){var n=C_t(G5t,(function(n){return U5t(u,e,n,t,i)})),o=r.getAxis("x").scale,s=r.getAxis("y").scale,l=o.getExtent(),c=s.getExtent(),h=[o.parse(u.get("x0",e)),o.parse(u.get("x1",e))],d=[s.parse(u.get("y0",e)),s.parse(u.get("y1",e))];fAt(h),fAt(d);var p=!!(l[0]>h[1]||l[1]<h[0]||c[0]>d[1]||c[1]<d[0]);u.setItemLayout(e,{points:n,allClipped:p});var f=u.getItemModel(e).getModel("itemStyle").getItemStyle(),g=XLt(a,"color");f.fill||(f.fill=g,"string"==typeof f.fill&&(f.fill=MSt(f.fill,.4))),f.stroke||(f.stroke=g),u.setItemVisual(e,"style",f)})),u.diff(z5t(l).data).add((function(t){var e=u.getItemLayout(t);if(!e.allClipped){var n=new aEt({shape:{points:e.points}});u.setItemGraphicEl(t,n),l.group.add(n)}})).update((function(t,n){var i=z5t(l).data.getItemGraphicEl(n),r=u.getItemLayout(t);r.allClipped?i&&l.group.remove(i):(i?WEt(i,{shape:{points:r.points}},e,t):i=new aEt({shape:{points:r.points}}),u.setItemGraphicEl(t,i),l.group.add(i))})).remove((function(t){var e=z5t(l).data.getItemGraphicEl(t);l.group.remove(e)})).execute(),u.eachItemGraphicEl((function(t,n){var i=u.getItemModel(n),r=u.getItemVisual(n,"style");t.useStyle(u.getItemVisual(n,"style")),uNt(t,cNt(i),{labelFetcher:e,labelDataIndex:n,defaultText:u.getName(n)||"",inheritColor:"string"==typeof r.fill?MSt(r.fill,1):"#000"}),pTt(t,i),uTt(t),IDt(t).dataModel=e})),z5t(l).data=u,l.group.silent=e.get("silent")||t.get("silent")},e.type="markArea",e}(I5t);var q5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.layoutMode={type:"box",ignoreSize:!0},n}return Dit(e,t),e.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n),t.selected=t.selected||{},this._updateSelector(t)},e.prototype.mergeOption=function(e,n){t.prototype.mergeOption.call(this,e,n),this._updateSelector(e)},e.prototype._updateSelector=function(t){var e=t.selector,n=this.ecModel;!0===e&&(e=t.selector=["all","inverse"]),E_t(e)&&S_t(e,(function(t,i){O_t(t)&&(t={type:t}),e[i]=m_t(t,function(t,e){return"all"===e?{type:"all",title:t.getLocale(["legend","selector","all"])}:"inverse"===e?{type:"inverse",title:t.getLocale(["legend","selector","inverse"])}:void 0}(n,t.type))}))},e.prototype.optionUpdated=function(){this._updateData(this.ecModel);var t=this._data;if(t[0]&&"single"===this.get("selectedMode")){for(var e=!1,n=0;n<t.length;n++){var i=t[n].get("name");if(this.isSelected(i)){this.select(i),e=!0;break}}!e&&this.select(t[0].get("name"))}},e.prototype._updateData=function(t){var e=[],n=[];t.eachRawSeries((function(i){var r,o=i.name;if(n.push(o),i.legendVisualProvider){var a=i.legendVisualProvider.getAllNames();t.isSeriesFiltered(i)||(n=n.concat(a)),a.length?e=e.concat(a):r=!0}else r=!0;r&&BAt(i)&&e.push(i.name)})),this._availableNames=n;var i=C_t(this.get("data")||e,(function(t){return"string"!=typeof t&&"number"!=typeof t||(t={name:t}),new NNt(t,this,this.ecModel)}),this);this._data=i},e.prototype.getData=function(){return this._data},e.prototype.select=function(t){var e=this.option.selected;"single"===this.get("selectedMode")&&S_t(this._data,(function(t){e[t.get("name")]=!1}));e[t]=!0},e.prototype.unSelect=function(t){"single"!==this.get("selectedMode")&&(this.option.selected[t]=!1)},e.prototype.toggleSelected=function(t){var e=this.option.selected;e.hasOwnProperty(t)||(e[t]=!0),this[e[t]?"unSelect":"select"](t)},e.prototype.allSelect=function(){var t=this._data,e=this.option.selected;S_t(t,(function(t){e[t.get("name",!0)]=!0}))},e.prototype.inverseSelect=function(){var t=this._data,e=this.option.selected;S_t(t,(function(t){var n=t.get("name",!0);e.hasOwnProperty(n)||(e[n]=!0),e[n]=!e[n]}))},e.prototype.isSelected=function(t){var e=this.option.selected;return!(e.hasOwnProperty(t)&&!e[t])&&w_t(this._availableNames,t)>=0},e.prototype.getOrient=function(){return"vertical"===this.get("orient")?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},e.type="legend.plain",e.dependencies=["series"],e.defaultOption={zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",decal:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:" sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},e}(FOt),X5t=T_t,Y5t=S_t,K5t=oAt,Z5t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.newlineDisabled=!1,n}return Dit(e,t),e.prototype.init=function(){this.group.add(this._contentGroup=new K5t),this.group.add(this._selectorGroup=new K5t),this._isFirstRender=!0},e.prototype.getContentGroup=function(){return this._contentGroup},e.prototype.getSelectorGroup=function(){return this._selectorGroup},e.prototype.render=function(t,e,n){var i=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),t.get("show",!0)){var r=t.get("align"),o=t.get("orient");r&&"auto"!==r||(r="right"===t.get("left")&&"vertical"===o?"right":"left");var a=t.get("selector",!0),s=t.get("selectorPosition",!0);!a||s&&"auto"!==s||(s="horizontal"===o?"end":"start"),this.renderInner(r,t,e,n,a,o,s);var l=t.getBoxLayoutParams(),u={width:n.getWidth(),height:n.getHeight()},c=t.get("padding"),h=IOt(l,u,c),d=this.layoutInner(t,r,h,i,a,s),p=IOt(x_t({width:d.width,height:d.height},l),u,c);this.group.x=p.x-d.x,this.group.y=p.y-d.y,this.group.markRedraw(),this.group.add(this._backgroundEl=A2t(d,t))}},e.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},e.prototype.renderInner=function(t,e,n,i,r,o,a){var s=this.getContentGroup(),l=Z_t(),u=e.get("selectedMode"),c=[];n.eachRawSeries((function(t){!t.get("legendHoverLink")&&c.push(t.id)})),Y5t(e.getData(),(function(r,o){var a=r.get("name");if(!this.newlineDisabled&&(""===a||"\n"===a)){var h=new K5t;return h.newline=!0,void s.add(h)}var d=n.getSeriesByName(a)[0];if(!l.get(a))if(d){var p=d.getData(),f=p.getVisual("legendLineStyle")||{},g=p.getVisual("legendIcon"),m=p.getVisual("style");this._createItem(d,a,o,r,e,t,f,m,g,u).on("click",X5t(J5t,a,null,i,c)).on("mouseover",X5t(t4t,d.name,null,i,c)).on("mouseout",X5t(e4t,d.name,null,i,c)),l.set(a,!0)}else n.eachRawSeries((function(n){if(!l.get(a)&&n.legendVisualProvider){var s=n.legendVisualProvider;if(!s.containName(a))return;var h=s.indexOfName(a),d=s.getItemVisual(h,"style"),p=s.getItemVisual(h,"legendIcon"),f=_St(d.fill);f&&0===f[3]&&(f[3]=.2,d.fill=DSt(f,"rgba")),this._createItem(n,a,o,r,e,t,{},d,p,u).on("click",X5t(J5t,null,a,i,c)).on("mouseover",X5t(t4t,null,a,i,c)).on("mouseout",X5t(e4t,null,a,i,c)),l.set(a,!0)}}),this)}),this),r&&this._createSelector(r,e,i,o,a)},e.prototype._createSelector=function(t,e,n,i,r){var o=this.getSelectorGroup();Y5t(t,(function(t){var i=t.type,r=new xDt({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:"all"===i?"legendAllSelect":"legendInverseSelect"})}});o.add(r),uNt(r,{normal:e.getModel("selectorLabel"),emphasis:e.getModel(["emphasis","selectorLabel"])},{defaultText:t.title}),uTt(r)}))},e.prototype._createItem=function(t,e,n,i,r,o,a,s,l,u){var c=t.visualDrawType,h=r.get("itemWidth"),d=r.get("itemHeight"),p=r.isSelected(e),f=i.get("symbolRotate"),g=i.get("icon"),m=function(t,e,n,i,r,o,a){for(var s=e.getModel("itemStyle"),l=DNt.concat([["decal"]]),u={},c=0;c<l.length;++c){var h=l[c][l[c].length-1],d=l[c][0];if("inherit"===(m=s.getShallow(h)))switch(d){case"fill":u.fill=r[o];break;case"stroke":u.stroke=r[0===t.lastIndexOf("empty",0)?"fill":"stroke"];break;case"opacity":u.opacity=("fill"===o?r:i).opacity;break;default:u[d]=r[d]}else"auto"===m&&"lineWidth"===d?u.lineWidth=r.lineWidth>0?2:0:u[d]=m}var p=e.getModel("lineStyle"),f=ANt.concat([["inactiveColor"],["inactiveWidth"]]),g={};for(c=0;c<f.length;++c){var m;h=f[c][1],d=f[c][0];"inherit"===(m=p.getShallow(h))?g[d]=i[d]:"auto"===m&&"lineWidth"===d?g.lineWidth=i.lineWidth>0?2:0:g[d]=m}if("auto"===u.fill&&(u.fill=r.fill),"auto"===u.stroke&&(u.stroke=r.fill),"auto"===g.stroke&&(g.stroke=r.fill),!a){var y=e.get("inactiveBorderWidth"),v=u[t.indexOf("empty")>-1?"fill":"stroke"];u.lineWidth="auto"===y?r.lineWidth>0&&v?2:0:u.lineWidth,u.fill=e.get("inactiveColor"),u.stroke=e.get("inactiveBorderColor"),g.stroke=n.get("inactiveColor"),g.lineWidth=n.get("inactiveWidth")}return{itemStyle:u,lineStyle:g}}(l=g||l||"roundRect",i,r.getModel("lineStyle"),a,s,c,p),y=new K5t,v=i.getModel("textStyle");if("function"!=typeof t.getLegendIcon||g&&"inherit"!==g){var x="inherit"===g&&t.getData().getVisual("symbol")?"inherit"===f?t.getData().getVisual("symbolRotate"):f:0;y.add(function(t){var e=t.icon||"roundRect",n=U$t(e,0,0,t.itemWidth,t.itemHeight,t.itemStyle.fill);n.setStyle(t.itemStyle),n.rotation=(t.iconRotate||0)*Math.PI/180,n.setOrigin([t.itemWidth/2,t.itemHeight/2]),e.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill="#fff",n.style.lineWidth=2);return n}({itemWidth:h,itemHeight:d,icon:l,iconRotate:x,itemStyle:m.itemStyle,lineStyle:m.lineStyle}))}else y.add(t.getLegendIcon({itemWidth:h,itemHeight:d,icon:l,iconRotate:f,itemStyle:m.itemStyle,lineStyle:m.lineStyle}));var b="left"===o?h+5:-5,w=o,_=r.get("formatter"),k=e;"string"==typeof _&&_?k=_.replace("{name}",null!=e?e:""):"function"==typeof _&&(k=_(e));var S=i.get("inactiveColor");y.add(new xDt({style:hNt(v,{text:k,x:b,y:d/2,fill:p?v.getTextColor():S,align:w,verticalAlign:"middle"})}));var C=new mDt({shape:y.getBoundingRect(),invisible:!0}),A=i.getModel("tooltip");return A.get("show")&&rNt({el:C,componentModel:r,itemName:e,itemTooltipOption:A.option}),y.add(C),y.eachChild((function(t){t.silent=!0})),C.silent=!u,this.getContentGroup().add(y),uTt(y),y.__legendDataIndex=n,y},e.prototype.layoutInner=function(t,e,n,i,r,o){var a=this.getContentGroup(),s=this.getSelectorGroup();AOt(t.get("orient"),a,t.get("itemGap"),n.width,n.height);var l=a.getBoundingRect(),u=[-l.x,-l.y];if(s.markRedraw(),a.markRedraw(),r){AOt("horizontal",s,t.get("selectorItemGap",!0));var c=s.getBoundingRect(),h=[-c.x,-c.y],d=t.get("selectorButtonGap",!0),p=t.getOrient().index,f=0===p?"width":"height",g=0===p?"height":"width",m=0===p?"y":"x";"end"===o?h[p]+=l[f]+d:u[p]+=c[f]+d,h[1-p]+=l[g]/2-c[g]/2,s.x=h[0],s.y=h[1],a.x=u[0],a.y=u[1];var y={x:0,y:0};return y[f]=l[f]+d+c[f],y[g]=Math.max(l[g],c[g]),y[m]=Math.min(0,c[m]+h[1-p]),y}return a.x=u[0],a.y=u[1],this.group.getBoundingRect()},e.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},e.type="legend.plain",e}(nLt);function J5t(t,e,n,i){e4t(t,e,n,i),n.dispatchAction({type:"legendToggleSelect",name:null!=t?t:e}),t4t(t,e,n,i)}function Q5t(t){for(var e,n=t.getZr().storage.getDisplayList(),i=0,r=n.length;i<r&&!(e=n[i].states.emphasis);)i++;return e&&e.hoverLayer}function t4t(t,e,n,i){Q5t(n)||n.dispatchAction({type:"highlight",seriesName:t,name:e,excludeSeriesId:i})}function e4t(t,e,n,i){Q5t(n)||n.dispatchAction({type:"downplay",seriesName:t,name:e,excludeSeriesId:i})}function n4t(t){var e=t.findComponents({mainType:"legend"});e&&e.length&&t.filterSeries((function(t){for(var n=0;n<e.length;n++)if(!e[n].isSelected(t.name))return!1;return!0}))}function i4t(t,e,n){var i,r={},o="toggleSelected"===t;return n.eachComponent("legend",(function(n){o&&null!=i?n[i?"select":"unSelect"](e.name):"allSelect"===t||"inverseSelect"===t?n[t]():(n[t](e.name),i=n.isSelected(e.name)),S_t(n.getData(),(function(t){var e=t.get("name");if("\n"!==e&&""!==e){var i=n.isSelected(e);r.hasOwnProperty(e)?r[e]=r[e]&&i:r[e]=i}}))})),"allSelect"===t||"inverseSelect"===t?{selected:r}:{name:e.name,selected:r}}function r4t(t){t.registerComponentModel(q5t),t.registerComponentView(Z5t),t.registerProcessor(t.PRIORITY.PROCESSOR.SERIES_FILTER,n4t),t.registerSubTypeDefaulter("legend",(function(){return"plain"})),function(t){t.registerAction("legendToggleSelect","legendselectchanged",T_t(i4t,"toggleSelected")),t.registerAction("legendAllSelect","legendselectall",T_t(i4t,"allSelect")),t.registerAction("legendInverseSelect","legendinverseselect",T_t(i4t,"inverseSelect")),t.registerAction("legendSelect","legendselected",T_t(i4t,"select")),t.registerAction("legendUnSelect","legendunselected",T_t(i4t,"unSelect"))}(t)}var o4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.setScrollDataIndex=function(t){this.option.scrollDataIndex=t},e.prototype.init=function(e,n,i){var r=EOt(e);t.prototype.init.call(this,e,n,i),a4t(this,e,r)},e.prototype.mergeOption=function(e,n){t.prototype.mergeOption.call(this,e,n),a4t(this,this.option,e)},e.type="legend.scroll",e.defaultOption=RNt(q5t.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),e}(q5t);function a4t(t,e,n){var i=[1,1];i[t.getOrient().index]=0,TOt(e,n,{type:"box",ignoreSize:!!i})}var s4t=oAt,l4t=["width","height"],u4t=["x","y"],c4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.newlineDisabled=!0,n._currentIndex=0,n}return Dit(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.group.add(this._containerGroup=new s4t),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new s4t)},e.prototype.resetInner=function(){t.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},e.prototype.renderInner=function(e,n,i,r,o,a,s){var l=this;t.prototype.renderInner.call(this,e,n,i,r,o,a,s);var u=this._controllerGroup,c=n.get("pageIconSize",!0),h=E_t(c)?c:[c,c];p("pagePrev",0);var d=n.getModel("pageTextStyle");function p(t,e){var i=t+"DataIndex",o=tNt(n.get("pageIcons",!0)[n.getOrient().name][e],{onclick:D_t(l._pageGo,l,i,n,r)},{x:-h[0]/2,y:-h[1]/2,width:h[0],height:h[1]});o.name=t,u.add(o)}u.add(new xDt({name:"pageText",style:{text:"xx/xx",fill:d.getTextColor(),font:d.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),p("pageNext",1)},e.prototype.layoutInner=function(t,e,n,i,r,o){var a=this.getSelectorGroup(),s=t.getOrient().index,l=l4t[s],u=u4t[s],c=l4t[1-s],h=u4t[1-s];r&&AOt("horizontal",a,t.get("selectorItemGap",!0));var d=t.get("selectorButtonGap",!0),p=a.getBoundingRect(),f=[-p.x,-p.y],g=g_t(n);r&&(g[l]=n[l]-p[l]-d);var m=this._layoutContentAndController(t,i,g,s,l,c,h,u);if(r){if("end"===o)f[s]+=m[l]+d;else{var y=p[l]+d;f[s]-=y,m[u]-=y}m[l]+=p[l]+d,f[1-s]+=m[h]+m[c]/2-p[c]/2,m[c]=Math.max(m[c],p[c]),m[h]=Math.min(m[h],p[h]+f[1-s]),a.x=f[0],a.y=f[1],a.markRedraw()}return m},e.prototype._layoutContentAndController=function(t,e,n,i,r,o,a,s){var l=this.getContentGroup(),u=this._containerGroup,c=this._controllerGroup;AOt(t.get("orient"),l,t.get("itemGap"),i?n.width:null,i?null:n.height),AOt("horizontal",c,t.get("pageButtonItemGap",!0));var h=l.getBoundingRect(),d=c.getBoundingRect(),p=this._showController=h[r]>n[r],f=[-h.x,-h.y];e||(f[i]=l[s]);var g=[0,0],m=[-d.x,-d.y],y=W_t(t.get("pageButtonGap",!0),t.get("itemGap",!0));p&&("end"===t.get("pageButtonPosition",!0)?m[i]+=n[r]-d[r]:g[i]+=d[r]+y);m[1-i]+=h[o]/2-d[o]/2,l.setPosition(f),u.setPosition(g),c.setPosition(m);var v={x:0,y:0};if(v[r]=p?n[r]:h[r],v[o]=Math.max(h[o],d[o]),v[a]=Math.min(0,d[a]+m[1-i]),u.__rectSize=n[r],p){var x={x:0,y:0};x[r]=Math.max(n[r]-d[r]-y,0),x[o]=v[o],u.setClipPath(new mDt({shape:x})),u.__rectSize=x[r]}else c.eachChild((function(t){t.attr({invisible:!0,silent:!0})}));var b=this._getPageInfo(t);return null!=b.pageIndex&&WEt(l,{x:b.contentPosition[0],y:b.contentPosition[1]},p?t:null),this._updatePageInfoView(t,b),v},e.prototype._pageGo=function(t,e,n){var i=this._getPageInfo(e)[t];null!=i&&n.dispatchAction({type:"legendScroll",scrollDataIndex:i,legendId:e.id})},e.prototype._updatePageInfoView=function(t,e){var n=this._controllerGroup;S_t(["pagePrev","pageNext"],(function(i){var r=null!=e[i+"DataIndex"],o=n.childOfName(i);o&&(o.setStyle("fill",r?t.get("pageIconColor",!0):t.get("pageIconInactiveColor",!0)),o.cursor=r?"pointer":"default")}));var i=n.childOfName("pageText"),r=t.get("pageFormatter"),o=e.pageIndex,a=null!=o?o+1:0,s=e.pageCount;i&&r&&i.setStyle("text",O_t(r)?r.replace("{current}",null==a?"":a+"").replace("{total}",null==s?"":s+""):r({current:a,total:s}))},e.prototype._getPageInfo=function(t){var e=t.get("scrollDataIndex",!0),n=this.getContentGroup(),i=this._containerGroup.__rectSize,r=t.getOrient().index,o=l4t[r],a=u4t[r],s=this._findTargetItemIndex(e),l=n.children(),u=l[s],c=l.length,h=c?1:0,d={contentPosition:[n.x,n.y],pageCount:h,pageIndex:h-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!u)return d;var p=v(u);d.contentPosition[r]=-p.s;for(var f=s+1,g=p,m=p,y=null;f<=c;++f)(!(y=v(l[f]))&&m.e>g.s+i||y&&!x(y,g.s))&&(g=m.i>g.i?m:y)&&(null==d.pageNextDataIndex&&(d.pageNextDataIndex=g.i),++d.pageCount),m=y;for(f=s-1,g=p,m=p,y=null;f>=-1;--f)(y=v(l[f]))&&x(m,y.s)||!(g.i<m.i)||(m=g,null==d.pagePrevDataIndex&&(d.pagePrevDataIndex=g.i),++d.pageCount,++d.pageIndex),g=y;return d;function v(t){if(t){var e=t.getBoundingRect(),n=e[a]+t[a];return{s:n,e:n+e[o],i:t.__legendDataIndex}}}function x(t,e){return t.e>=e&&t.s<=e+i}},e.prototype._findTargetItemIndex=function(t){return this._showController?(this.getContentGroup().eachChild((function(i,r){var o=i.__legendDataIndex;null==n&&null!=o&&(n=r),o===t&&(e=r)})),null!=e?e:n):0;var e,n},e.type="legend.scroll",e}(Z5t);function h4t(t){gBt(r4t),t.registerComponentModel(o4t),t.registerComponentView(c4t),function(t){t.registerAction("legendScroll","legendscroll",(function(t,e){var n=t.scrollDataIndex;null!=n&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},(function(t){t.setScrollDataIndex(n)}))}))}(t)}var d4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="dataZoom.inside",e.defaultOption=RNt(u2t.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),e}(u2t),p4t=jAt();function f4t(t,e,n){p4t(t).coordSysRecordMap.each((function(t){var i=t.dataZoomInfoMap.get(e.uid);i&&(i.getRange=n)}))}function g4t(t,e){if(e){t.removeKey(e.model.uid);var n=e.controller;n&&n.dispose()}}function m4t(t,e){t.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:e})}function y4t(t,e,n,i){return t.coordinateSystem.containPoint([n,i])}function v4t(t){t.registerProcessor(t.PRIORITY.PROCESSOR.FILTER,(function(t,e){var n=p4t(e),i=n.coordSysRecordMap||(n.coordSysRecordMap=Z_t());i.each((function(t){t.dataZoomInfoMap=null})),t.eachComponent({mainType:"dataZoom",subType:"inside"},(function(t){S_t(s2t(t).infoList,(function(n){var r=n.model.uid,o=i.get(r)||i.set(r,function(t,e){var n={model:e,containsPoint:T_t(y4t,e),dispatchAction:T_t(m4t,t),dataZoomInfoMap:null,controller:null},i=n.controller=new jGt(t.getZr());return S_t(["pan","zoom","scrollMove"],(function(t){i.on(t,(function(e){var i=[];n.dataZoomInfoMap.each((function(r){if(e.isAvailableBehavior(r.model.option)){var o=(r.getRange||{})[t],a=o&&o(r.dzReferCoordSysInfo,n.model.mainType,n.controller,e);!r.model.get("disabled",!0)&&a&&i.push({dataZoomId:r.model.id,start:a[0],end:a[1]})}})),i.length&&n.dispatchAction(i)}))})),n}(e,n.model));(o.dataZoomInfoMap||(o.dataZoomInfoMap=Z_t())).set(t.uid,{dzReferCoordSysInfo:n,model:t,getRange:null})}))})),i.each((function(t){var e,n=t.controller,r=t.dataZoomInfoMap;if(r){var o=r.keys()[0];null!=o&&(e=r.get(o))}if(e){var a=function(t){var e,n="type_",i={type_true:2,type_move:1,type_false:0,type_undefined:-1},r=!0;return t.each((function(t){var o=t.model,a=!o.get("disabled",!0)&&(!o.get("zoomLock",!0)||"move");i[n+a]>i[n+e]&&(e=a),r=r&&o.get("preventDefaultMouseMove",!0)})),{controlType:e,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!r}}}(r);n.enable(a.controlType,a.opt),n.setPointerChecker(t.containsPoint),gLt(t,"dispatchAction",e.model.get("throttle",!0),"fixRate")}else g4t(i,t)}))}))}var x4t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="dataZoom.inside",e}return Dit(e,t),e.prototype.render=function(e,n,i){t.prototype.render.apply(this,arguments),e.noTarget()?this._clear():(this.range=e.getPercentRange(),f4t(i,e,{pan:D_t(b4t.pan,this),zoom:D_t(b4t.zoom,this),scrollMove:D_t(b4t.scrollMove,this)}))},e.prototype.dispose=function(){this._clear(),t.prototype.dispose.apply(this,arguments)},e.prototype._clear=function(){!function(t,e){for(var n=p4t(t).coordSysRecordMap,i=n.keys(),r=0;r<i.length;r++){var o=i[r],a=n.get(o),s=a.dataZoomInfoMap;if(s){var l=e.uid;s.get(l)&&(s.removeKey(l),s.keys().length||g4t(n,a))}}}(this.api,this.dataZoomModel),this.range=null},e.type="dataZoom.inside",e}(d2t),b4t={zoom:function(t,e,n,i){var r=this.range,o=r.slice(),a=t.axisModels[0];if(a){var s=_4t[e](null,[i.originX,i.originY],a,n,t),l=(s.signal>0?s.pixelStart+s.pixelLength-s.pixel:s.pixel-s.pixelStart)/s.pixelLength*(o[1]-o[0])+o[0],u=Math.max(1/i.scale,0);o[0]=(o[0]-l)*u+l,o[1]=(o[1]-l)*u+l;var c=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();return MYt(0,o,[0,100],0,c.minSpan,c.maxSpan),this.range=o,r[0]!==o[0]||r[1]!==o[1]?o:void 0}},pan:w4t((function(t,e,n,i,r,o){var a=_4t[i]([o.oldX,o.oldY],[o.newX,o.newY],e,r,n);return a.signal*(t[1]-t[0])*a.pixel/a.pixelLength})),scrollMove:w4t((function(t,e,n,i,r,o){return _4t[i]([0,0],[o.scrollDelta,o.scrollDelta],e,r,n).signal*(t[1]-t[0])*o.scrollDelta}))};function w4t(t){return function(e,n,i,r){var o=this.range,a=o.slice(),s=e.axisModels[0];if(s)return MYt(t(a,s,e,n,i,r),a,[0,100],"all"),this.range=a,o[0]!==a[0]||o[1]!==a[1]?a:void 0}}var _4t={grid:function(t,e,n,i,r){var o=n.axis,a={},s=r.model.coordinateSystem.getRect();return t=t||[0,0],"x"===o.dim?(a.pixel=e[0]-t[0],a.pixelLength=s.width,a.pixelStart=s.x,a.signal=o.inverse?1:-1):(a.pixel=e[1]-t[1],a.pixelLength=s.height,a.pixelStart=s.y,a.signal=o.inverse?-1:1),a},polar:function(t,e,n,i,r){var o=n.axis,a={},s=r.model.coordinateSystem,l=s.getRadiusAxis().getExtent(),u=s.getAngleAxis().getExtent();return t=t?s.pointToCoord(t):[0,0],e=s.pointToCoord(e),"radiusAxis"===n.mainType?(a.pixel=e[0]-t[0],a.pixelLength=l[1]-l[0],a.pixelStart=l[0],a.signal=o.inverse?1:-1):(a.pixel=e[1]-t[1],a.pixelLength=u[1]-u[0],a.pixelStart=u[0],a.signal=o.inverse?-1:1),a},singleAxis:function(t,e,n,i,r){var o=n.axis,a=r.model.coordinateSystem.getRect(),s={};return t=t||[0,0],"horizontal"===o.orient?(s.pixel=e[0]-t[0],s.pixelLength=a.width,s.pixelStart=a.x,s.signal=o.inverse?1:-1):(s.pixel=e[1]-t[1],s.pixelLength=a.height,s.pixelStart=a.y,s.signal=o.inverse?-1:1),s}};function k4t(t){x2t(t),t.registerComponentModel(d4t),t.registerComponentView(x4t),v4t(t)}var S4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.type="dataZoom.slider",e.layoutMode="box",e.defaultOption=RNt(u2t.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#6E7079"},brushSelect:!0,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}}),e}(u2t),C4t=mDt,A4t=["line","bar","candlestick","scatter"],I4t={easing:"cubicOut",duration:100},M4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._displayables={},n}return Dit(e,t),e.prototype.init=function(t,e){this.api=e,this._onBrush=D_t(this._onBrush,this),this._onBrushEnd=D_t(this._onBrushEnd,this)},e.prototype.render=function(e,n,i,r){if(t.prototype.render.apply(this,arguments),gLt(this,"_dispatchZoomAction",e.get("throttle"),"fixRate"),this._orient=e.getOrient(),!1!==e.get("show")){if(e.noTarget())return this._clear(),void this.group.removeAll();r&&"dataZoom"===r.type&&r.from===this.uid||this._buildView(),this._updateView()}else this.group.removeAll()},e.prototype.dispose=function(){this._clear(),t.prototype.dispose.apply(this,arguments)},e.prototype._clear=function(){var t,e,n;(n=(t=this)[e="_dispatchZoomAction"])&&n[dLt]&&(t[e]=n[dLt]);var i=this.api.getZr();i.off("mousemove",this._onBrush),i.off("mouseup",this._onBrushEnd)},e.prototype._buildView=function(){var t=this.group;t.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var e=this._displayables.sliderGroup=new oAt;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(e),this._positionGroup()},e.prototype._resetLocation=function(){var t=this.dataZoomModel,e=this.api,n=t.get("brushSelect")?7:0,i=this._findCoordRect(),r={width:e.getWidth(),height:e.getHeight()},o="horizontal"===this._orient?{right:r.width-i.x-i.width,top:r.height-30-7-n,width:i.width,height:30}:{right:7,top:i.y,width:30,height:i.height},a=EOt(t.option);S_t(["right","top","width","height"],(function(t){"ph"===a[t]&&(a[t]=o[t])}));var s=IOt(a,r);this._location={x:s.x,y:s.y},this._size=[s.width,s.height],"vertical"===this._orient&&this._size.reverse()},e.prototype._positionGroup=function(){var t=this.group,e=this._location,n=this._orient,i=this.dataZoomModel.getFirstTargetAxisModel(),r=i&&i.get("inverse"),o=this._displayables.sliderGroup,a=(this._dataShadowInfo||{}).otherAxisInverse;o.attr("horizontal"!==n||r?"horizontal"===n&&r?{scaleY:a?1:-1,scaleX:-1}:"vertical"!==n||r?{scaleY:a?-1:1,scaleX:-1,rotation:Math.PI/2}:{scaleY:a?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:a?1:-1,scaleX:1});var s=t.getBoundingRect([o]);t.x=e.x-s.x,t.y=e.y-s.y,t.markRedraw()},e.prototype._getViewExtent=function(){return[0,this._size[0]]},e.prototype._renderBackground=function(){var t=this.dataZoomModel,e=this._size,n=this._displayables.sliderGroup,i=t.get("brushSelect");n.add(new C4t({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:t.get("backgroundColor")},z2:-40}));var r=new C4t({shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:"transparent"},z2:0,onclick:D_t(this._onClickPanel,this)}),o=this.api.getZr();i?(r.on("mousedown",this._onBrushStart,this),r.cursor="crosshair",o.on("mousemove",this._onBrush),o.on("mouseup",this._onBrushEnd)):(o.off("mousemove",this._onBrush),o.off("mouseup",this._onBrushEnd)),n.add(r)},e.prototype._renderDataShadow=function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],t){var e=this._size,n=t.series,i=n.getRawData(),r=n.getShadowDim?n.getShadowDim():t.otherDim;if(null!=r){var o=i.getDataExtent(r),a=.3*(o[1]-o[0]);o=[o[0]-a,o[1]+a];var s,l=[0,e[1]],u=[0,e[0]],c=[[e[0],0],[0,0]],h=[],d=u[1]/(i.count()-1),p=0,f=Math.round(i.count()/e[0]);i.each([r],(function(t,e){if(f>0&&e%f)p+=d;else{var n=null==t||isNaN(t)||""===t,i=n?0:hAt(t,o,l,!0);n&&!s&&e?(c.push([c[c.length-1][0],0]),h.push([h[h.length-1][0],0])):!n&&s&&(c.push([p,0]),h.push([p,0])),c.push([p,i]),h.push([p,i]),p+=d,s=n}}));for(var g,m,y,v,x,b=this.dataZoomModel,w=0;w<3;w++){var _=(g=1===w,m=void 0,y=void 0,v=void 0,x=void 0,m=b.getModel(g?"selectedDataBackground":"dataBackground"),y=new oAt,v=new aEt({shape:{points:c},segmentIgnoreThreshold:1,style:m.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),x=new lEt({shape:{points:h},segmentIgnoreThreshold:1,style:m.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19}),y.add(v),y.add(x),y);this._displayables.sliderGroup.add(_),this._displayables.dataShadowSegs.push(_)}}}},e.prototype._prepareDataShadowInfo=function(){var t=this.dataZoomModel,e=t.get("showDataShadow");if(!1!==e){var n,i=this.ecModel;return t.eachTargetAxis((function(r,o){S_t(t.getAxisProxy(r,o).getTargetSeriesModels(),(function(t){if(!(n||!0!==e&&w_t(A4t,t.get("type"))<0)){var a,s=i.getComponent(o2t(r),o).axis,l={x:"y",y:"x",radius:"angle",angle:"radius"}[r],u=t.coordinateSystem;null!=l&&u.getOtherAxis&&(a=u.getOtherAxis(s).inverse),l=t.getData().mapDimension(l),n={thisAxis:s,series:t,thisDim:r,otherDim:l,otherAxisInverse:a}}}),this)}),this),n}},e.prototype._renderHandle=function(){var t=this.group,e=this._displayables,n=e.handles=[null,null],i=e.handleLabels=[null,null],r=this._displayables.sliderGroup,o=this._size,a=this.dataZoomModel,s=this.api,l=a.get("borderRadius")||0,u=a.get("brushSelect"),c=e.filler=new C4t({silent:u,style:{fill:a.get("fillerColor")},textConfig:{position:"inside"}});r.add(c),r.add(new C4t({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:o[0],height:o[1],r:l},style:{stroke:a.get("dataBackgroundColor")||a.get("borderColor"),lineWidth:1,fill:"rgba(0,0,0,0)"}})),S_t([0,1],(function(e){var o=a.get("handleIcon");!V$t[o]&&o.indexOf("path://")<0&&o.indexOf("image://")<0&&(o="path://"+o);var s=U$t(o,-1,0,2,2,null,!0);s.attr({cursor:D4t(this._orient),draggable:!0,drift:D_t(this._onDragMove,this,e),ondragend:D_t(this._onDragEnd,this),onmouseover:D_t(this._showDataInfo,this,!0),onmouseout:D_t(this._showDataInfo,this,!1),z2:5});var l=s.getBoundingRect(),u=a.get("handleSize");this._handleHeight=dAt(u,this._size[1]),this._handleWidth=l.width/l.height*this._handleHeight,s.setStyle(a.getModel("handleStyle").getItemStyle()),s.style.strokeNoScale=!0,s.rectHover=!0,s.ensureState("emphasis").style=a.getModel(["emphasis","handleStyle"]).getItemStyle(),uTt(s);var c=a.get("handleColor");null!=c&&(s.style.fill=c),r.add(n[e]=s);var h=a.getModel("textStyle");t.add(i[e]=new xDt({silent:!0,invisible:!0,style:hNt(h,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:h.getTextColor(),font:h.getFont()}),z2:10}))}),this);var h=c;if(u){var d=dAt(a.get("moveHandleSize"),o[1]),p=e.moveHandle=new mDt({style:a.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:o[1]-.5,height:d}}),f=.8*d,g=e.moveHandleIcon=U$t(a.get("moveHandleIcon"),-f/2,-f/2,f,f,"#fff",!0);g.silent=!0,g.y=o[1]+d/2-.5,p.ensureState("emphasis").style=a.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var m=Math.min(o[1]/2,Math.max(d,10));(h=e.moveZone=new mDt({invisible:!0,shape:{y:o[1]-m,height:d+m}})).on("mouseover",(function(){s.enterEmphasis(p)})).on("mouseout",(function(){s.leaveEmphasis(p)})),r.add(p),r.add(g),r.add(h)}h.attr({draggable:!0,cursor:D4t(this._orient),drift:D_t(this._onDragMove,this,"all"),ondragstart:D_t(this._showDataInfo,this,!0),ondragend:D_t(this._onDragEnd,this),onmouseover:D_t(this._showDataInfo,this,!0),onmouseout:D_t(this._showDataInfo,this,!1)})},e.prototype._resetInterval=function(){var t=this._range=this.dataZoomModel.getPercentRange(),e=this._getViewExtent();this._handleEnds=[hAt(t[0],[0,100],e,!0),hAt(t[1],[0,100],e,!0)]},e.prototype._updateInterval=function(t,e){var n=this.dataZoomModel,i=this._handleEnds,r=this._getViewExtent(),o=n.findRepresentativeAxisProxy().getMinMaxSpan(),a=[0,100];MYt(e,i,r,n.get("zoomLock")?"all":t,null!=o.minSpan?hAt(o.minSpan,a,r,!0):null,null!=o.maxSpan?hAt(o.maxSpan,a,r,!0):null);var s=this._range,l=this._range=fAt([hAt(i[0],r,a,!0),hAt(i[1],r,a,!0)]);return!s||s[0]!==l[0]||s[1]!==l[1]},e.prototype._updateView=function(t){var e=this._displayables,n=this._handleEnds,i=fAt(n.slice()),r=this._size;S_t([0,1],(function(t){var i=e.handles[t],o=this._handleHeight;i.attr({scaleX:o/2,scaleY:o/2,x:n[t]+(t?-1:1),y:r[1]/2-o/2})}),this),e.filler.setShape({x:i[0],y:0,width:i[1]-i[0],height:r[1]});var o={x:i[0],width:i[1]-i[0]};e.moveHandle&&(e.moveHandle.setShape(o),e.moveZone.setShape(o),e.moveZone.getBoundingRect(),e.moveHandleIcon&&e.moveHandleIcon.attr("x",o.x+o.width/2));for(var a=e.dataShadowSegs,s=[0,i[0],i[1],r[0]],l=0;l<a.length;l++){var u=a[l],c=u.getClipPath();c||(c=new mDt,u.setClipPath(c)),c.setShape({x:s[l],y:0,width:s[l+1]-s[l],height:r[1]})}this._updateDataInfo(t)},e.prototype._updateDataInfo=function(t){var e=this.dataZoomModel,n=this._displayables,i=n.handleLabels,r=this._orient,o=["",""];if(e.get("showDetail")){var a=e.findRepresentativeAxisProxy();if(a){var s=a.getAxisModel().axis,l=this._range,u=t?a.calculateDataWindow({start:l[0],end:l[1]}).valueWindow:a.getDataValueWindow();o=[this._formatLabel(u[0],s),this._formatLabel(u[1],s)]}}var c=fAt(this._handleEnds.slice());function h(t){var e=XEt(n.handles[t].parent,this.group),a=KEt(0===t?"right":"left",e),s=this._handleWidth/2+5,l=YEt([c[t]+(0===t?-s:s),this._size[1]/2],e);i[t].setStyle({x:l[0],y:l[1],verticalAlign:"horizontal"===r?"middle":a,align:"horizontal"===r?a:"center",text:o[t]})}h.call(this,0),h.call(this,1)},e.prototype._formatLabel=function(t,e){var n=this.dataZoomModel,i=n.get("labelFormatter"),r=n.get("labelPrecision");null!=r&&"auto"!==r||(r=e.getPixelPrecision());var o=null==t||isNaN(t)?"":"category"===e.type||"time"===e.type?e.scale.getLabel({value:Math.round(t)}):t.toFixed(Math.min(r,20));return N_t(i)?i(t,o):O_t(i)?i.replace("{value}",o):o},e.prototype._showDataInfo=function(t){t=this._dragging||t;var e=this._displayables,n=e.handleLabels;n[0].attr("invisible",!t),n[1].attr("invisible",!t),e.moveHandle&&this.api[t?"enterEmphasis":"leaveEmphasis"](e.moveHandle,1)},e.prototype._onDragMove=function(t,e,n,i){this._dragging=!0,Lkt(i.event);var r=YEt([e,n],this._displayables.sliderGroup.getLocalTransform(),!0),o=this._updateInterval(t,r[0]),a=this.dataZoomModel.get("realtime");this._updateView(!a),o&&a&&this._dispatchZoomAction(!0)},e.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1),!this.dataZoomModel.get("realtime")&&this._dispatchZoomAction(!1)},e.prototype._onClickPanel=function(t){var e=this._size,n=this._displayables.sliderGroup.transformCoordToLocal(t.offsetX,t.offsetY);if(!(n[0]<0||n[0]>e[0]||n[1]<0||n[1]>e[1])){var i=this._handleEnds,r=(i[0]+i[1])/2,o=this._updateInterval("all",n[0]-r);this._updateView(),o&&this._dispatchZoomAction(!1)}},e.prototype._onBrushStart=function(t){var e=t.offsetX,n=t.offsetY;this._brushStart=new DCt(e,n),this._brushing=!0,this._brushStartTime=+new Date},e.prototype._onBrushEnd=function(t){if(this._brushing){var e=this._displayables.brushRect;if(this._brushing=!1,e){e.attr("ignore",!0);var n=e.shape;if(!(+new Date-this._brushStartTime<200&&Math.abs(n.width)<5)){var i=this._getViewExtent(),r=[0,100];this._range=fAt([hAt(n.x,i,r,!0),hAt(n.x+n.width,i,r,!0)]),this._handleEnds=[n.x,n.x+n.width],this._updateView(),this._dispatchZoomAction(!1)}}}},e.prototype._onBrush=function(t){this._brushing&&(Lkt(t.event),this._updateBrushRect(t.offsetX,t.offsetY))},e.prototype._updateBrushRect=function(t,e){var n=this._displayables,i=this.dataZoomModel,r=n.brushRect;r||(r=n.brushRect=new C4t({silent:!0,style:i.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(r)),r.attr("ignore",!1);var o=this._brushStart,a=this._displayables.sliderGroup,s=a.transformCoordToLocal(t,e),l=a.transformCoordToLocal(o.x,o.y),u=this._size;s[0]=Math.max(Math.min(u[0],s[0]),0),r.setShape({x:l[0],y:0,width:s[0]-l[0],height:u[1]})},e.prototype._dispatchZoomAction=function(t){var e=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:t?I4t:null,start:e[0],end:e[1]})},e.prototype._findCoordRect=function(){var t,e=s2t(this.dataZoomModel).infoList;if(!t&&e.length){var n=e[0].model.coordinateSystem;t=n.getRect&&n.getRect()}if(!t){var i=this.api.getWidth(),r=this.api.getHeight();t={x:.2*i,y:.2*r,width:.6*i,height:.6*r}}return t},e.type="dataZoom.slider",e}(d2t);function D4t(t){return"vertical"===t?"ns-resize":"ew-resize"}function T4t(t){t.registerComponentModel(S4t),t.registerComponentView(M4t),x2t(t)}var E4t=function(t,e,n){var i=g_t((N4t[t]||{})[e]);return n&&E_t(i)?i[i.length-1]:i},N4t={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}},O4t=kqt.mapVisual,F4t=kqt.eachVisual,R4t=E_t,L4t=S_t,$4t=fAt,P4t=hAt,z4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.stateList=["inRange","outOfRange"],n.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],n.layoutMode={type:"box",ignoreSize:!0},n.dataBound=[-1/0,1/0],n.targetVisuals={},n.controllerVisuals={},n}return Dit(e,t),e.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n)},e.prototype.optionUpdated=function(t,e){var n=this.option;t_t.canvasSupported||(n.realtime=!1),!e&&$3t(n,t,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},e.prototype.resetVisual=function(t){var e=this.stateList;t=D_t(t,this),this.controllerVisuals=L3t(this.option.controller,e,t),this.targetVisuals=L3t(this.option.target,e,t)},e.prototype.getItemSymbol=function(){return null},e.prototype.getTargetSeriesIndices=function(){var t=this.option.seriesIndex,e=[];return null==t||"all"===t?this.ecModel.eachSeries((function(t,n){e.push(n)})):e=NAt(t),e},e.prototype.eachTargetSeries=function(t,e){S_t(this.getTargetSeriesIndices(),(function(n){var i=this.ecModel.getSeriesByIndex(n);i&&t.call(e,i)}),this)},e.prototype.isTargetSeries=function(t){var e=!1;return this.eachTargetSeries((function(n){n===t&&(e=!0)})),e},e.prototype.formatValueText=function(t,e,n){var i,r=this.option,o=r.precision,a=this.dataBound,s=r.formatter;n=n||["<",">"],E_t(t)&&(t=t.slice(),i=!0);var l=e?t:i?[u(t[0]),u(t[1])]:u(t);return O_t(s)?s.replace("{value}",i?l[0]:l).replace("{value2}",i?l[1]:l):N_t(s)?i?s(t[0],t[1]):s(t):i?t[0]===a[0]?n[0]+" "+l[1]:t[1]===a[1]?n[1]+" "+l[0]:l[0]+" - "+l[1]:l;function u(t){return t===a[0]?"min":t===a[1]?"max":(+t).toFixed(Math.min(o,20))}},e.prototype.resetExtent=function(){var t=this.option,e=$4t([t.min,t.max]);this._dataExtent=e},e.prototype.getDataDimension=function(t){var e=this.option.dimension,n=t.dimensions;if(null!=e||n.length){if(null!=e)return t.getDimension(e);for(var i=t.dimensions,r=i.length-1;r>=0;r--){var o=i[r];if(!t.getDimensionInfo(o).isCalculationCoord)return o}}},e.prototype.getExtent=function(){return this._dataExtent.slice()},e.prototype.completeVisualOption=function(){var t=this.ecModel,e=this.option,n={inRange:e.inRange,outOfRange:e.outOfRange},i=e.target||(e.target={}),r=e.controller||(e.controller={});m_t(i,n),m_t(r,n);var o=this.isCategory();function a(n){R4t(e.color)&&!n.inRange&&(n.inRange={color:e.color.slice().reverse()}),n.inRange=n.inRange||{color:t.get("gradientColor")}}a.call(this,i),a.call(this,r),function(t,e,n){var i=t[e],r=t[n];i&&!r&&(r=t[n]={},L4t(i,(function(t,e){if(kqt.isValidType(e)){var n=E4t(e,"inactive",o);null!=n&&(r[e]=n,"color"!==e||r.hasOwnProperty("opacity")||r.hasOwnProperty("colorAlpha")||(r.opacity=[0,0]))}})))}.call(this,i,"inRange","outOfRange"),function(t){var e=(t.inRange||{}).symbol||(t.outOfRange||{}).symbol,n=(t.inRange||{}).symbolSize||(t.outOfRange||{}).symbolSize,i=this.get("inactiveColor"),r=this.getItemSymbol()||"roundRect";L4t(this.stateList,(function(a){var s=this.itemSize,l=t[a];l||(l=t[a]={color:o?i:[i]}),null==l.symbol&&(l.symbol=e&&g_t(e)||(o?r:[r])),null==l.symbolSize&&(l.symbolSize=n&&g_t(n)||(o?s[0]:[s[0],s[0]])),l.symbol=O4t(l.symbol,(function(t){return"none"===t?r:t}));var u=l.symbolSize;if(null!=u){var c=-1/0;F4t(u,(function(t){t>c&&(c=t)})),l.symbolSize=O4t(u,(function(t){return P4t(t,[0,c],[0,s[0]],!0)}))}}),this)}.call(this,r)},e.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},e.prototype.isCategory=function(){return!!this.option.categories},e.prototype.setSelected=function(t){},e.prototype.getSelected=function(){return null},e.prototype.getValueState=function(t){return null},e.prototype.getVisualMeta=function(t){return null},e.type="visualMap",e.dependencies=["series"],e.defaultOption={show:!0,zlevel:0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},e}(FOt),B4t=[20,140],V4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.optionUpdated=function(e,n){t.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual((function(t){t.mappingMethod="linear",t.dataExtent=this.getExtent()})),this._resetRange()},e.prototype.resetItemSize=function(){t.prototype.resetItemSize.apply(this,arguments);var e=this.itemSize;(null==e[0]||isNaN(e[0]))&&(e[0]=B4t[0]),(null==e[1]||isNaN(e[1]))&&(e[1]=B4t[1])},e.prototype._resetRange=function(){var t=this.getExtent(),e=this.option.range;!e||e.auto?(t.auto=1,this.option.range=t):E_t(e)&&(e[0]>e[1]&&e.reverse(),e[0]=Math.max(e[0],t[0]),e[1]=Math.min(e[1],t[1]))},e.prototype.completeVisualOption=function(){t.prototype.completeVisualOption.apply(this,arguments),S_t(this.stateList,(function(t){var e=this.option.controller[t].symbolSize;e&&e[0]!==e[1]&&(e[0]=e[1]/3)}),this)},e.prototype.setSelected=function(t){this.option.range=t.slice(),this._resetRange()},e.prototype.getSelected=function(){var t=this.getExtent(),e=fAt((this.get("range")||[]).slice());return e[0]>t[1]&&(e[0]=t[1]),e[1]>t[1]&&(e[1]=t[1]),e[0]<t[0]&&(e[0]=t[0]),e[1]<t[0]&&(e[1]=t[0]),e},e.prototype.getValueState=function(t){var e=this.option.range,n=this.getExtent();return(e[0]<=n[0]||e[0]<=t)&&(e[1]>=n[1]||t<=e[1])?"inRange":"outOfRange"},e.prototype.findTargetDataIndices=function(t){var e=[];return this.eachTargetSeries((function(n){var i=[],r=n.getData();r.each(this.getDataDimension(r),(function(e,n){t[0]<=e&&e<=t[1]&&i.push(n)}),this),e.push({seriesId:n.id,dataIndex:i})}),this),e},e.prototype.getVisualMeta=function(t){var e=W4t(this,"outOfRange",this.getExtent()),n=W4t(this,"inRange",this.option.range.slice()),i=[];function r(e,n){i.push({value:e,color:t(e,n)})}for(var o=0,a=0,s=n.length,l=e.length;a<l&&(!n.length||e[a]<=n[0]);a++)e[a]<n[o]&&r(e[a],"outOfRange");for(var u=1;o<s;o++,u=0)u&&i.length&&r(n[o],"outOfRange"),r(n[o],"inRange");for(u=1;a<l;a++)(!n.length||n[n.length-1]<e[a])&&(u&&(i.length&&r(i[i.length-1].value,"outOfRange"),u=0),r(e[a],"outOfRange"));var c=i.length;return{stops:i,outerColors:[c?i[0].color:"transparent",c?i[c-1].color:"transparent"]}},e.type="visualMap.continuous",e.defaultOption=RNt(z4t.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),e}(z4t);function W4t(t,e,n){if(n[0]===n[1])return n.slice();for(var i=(n[1]-n[0])/200,r=n[0],o=[],a=0;a<=200&&r<n[1];a++)o.push(r),r+=i;return o.push(n[1]),o}var j4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n.autoPositionValues={left:1,right:1,top:1,bottom:1},n}return Dit(e,t),e.prototype.init=function(t,e){this.ecModel=t,this.api=e},e.prototype.render=function(t,e,n,i){this.visualMapModel=t,!1!==t.get("show")?this.doRender(t,e,n,i):this.group.removeAll()},e.prototype.renderBackground=function(t){var e=this.visualMapModel,n=dOt(e.get("padding")||0),i=t.getBoundingRect();t.add(new mDt({z2:-1,silent:!0,shape:{x:i.x-n[3],y:i.y-n[0],width:i.width+n[3]+n[1],height:i.height+n[0]+n[2]},style:{fill:e.get("backgroundColor"),stroke:e.get("borderColor"),lineWidth:e.get("borderWidth")}}))},e.prototype.getControllerVisual=function(t,e,n){var i=(n=n||{}).forceState,r=this.visualMapModel,o={};if("color"===e){var a=r.get("contentColor");o.color=a}function s(t){return o[t]}function l(t,e){o[t]=e}var u=r.controllerVisuals[i||r.getValueState(t)];return S_t(kqt.prepareVisualTypes(u),(function(i){var r=u[i];n.convertOpacityToAlpha&&"opacity"===i&&(i="colorAlpha",r=u.__alphaForOpacity),kqt.dependsOn(i,e)&&r&&r.applyVisual(t,s,l)})),o[e]},e.prototype.positionGroup=function(t){var e=this.visualMapModel,n=this.api;MOt(t,e.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()})},e.prototype.doRender=function(t,e,n,i){},e.type="visualMap",e}(nLt),U4t=[["left","right","width"],["top","bottom","height"]];function G4t(t,e,n){var i=t.option,r=i.align;if(null!=r&&"auto"!==r)return r;for(var o={width:e.getWidth(),height:e.getHeight()},a="horizontal"===i.orient?1:0,s=U4t[a],l=[0,null,10],u={},c=0;c<3;c++)u[U4t[1-a][c]]=l[c],u[s[c]]=2===c?n[0]:i[s[c]];var h=[["x","width",3],["y","height",0]][a],d=IOt(u,o,i.padding);return s[(d.margin[h[2]]||0)+d[h[0]]+.5*d[h[1]]<.5*o[h[1]]?0:1]}function H4t(t,e){return S_t(t||[],(function(t){null!=t.dataIndex&&(t.dataIndexInside=t.dataIndex,t.dataIndex=null),t.highlightKey="visualMap"+(e?e.componentIndex:"")})),t}var q4t=hAt,X4t=S_t,Y4t=Math.min,K4t=Math.max,Z4t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._shapes={},n._dataInterval=[],n._handleEnds=[],n._hoverLinkDataIndices=[],n}return Dit(e,t),e.prototype.doRender=function(t,e,n,i){this._api=n,i&&"selectDataRange"===i.type&&i.from===this.uid||this._buildView()},e.prototype._buildView=function(){this.group.removeAll();var t=this.visualMapModel,e=this.group;this._orient=t.get("orient"),this._useHandle=t.get("calculable"),this._resetInterval(),this._renderBar(e);var n=t.get("text");this._renderEndsText(e,n,0),this._renderEndsText(e,n,1),this._updateView(!0),this.renderBackground(e),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(e)},e.prototype._renderEndsText=function(t,e,n){if(e){var i=e[1-n];i=null!=i?i+"":"";var r=this.visualMapModel,o=r.get("textGap"),a=r.itemSize,s=this._shapes.mainGroup,l=this._applyTransform([a[0]/2,0===n?-o:a[1]+o],s),u=this._applyTransform(0===n?"bottom":"top",s),c=this._orient,h=this.visualMapModel.textStyleModel;this.group.add(new xDt({style:{x:l[0],y:l[1],verticalAlign:"horizontal"===c?"middle":u,align:"horizontal"===c?u:"center",text:i,font:h.getFont(),fill:h.getTextColor()}}))}},e.prototype._renderBar=function(t){var e=this.visualMapModel,n=this._shapes,i=e.itemSize,r=this._orient,o=this._useHandle,a=G4t(e,this.api,i),s=n.mainGroup=this._createBarGroup(a),l=new oAt;s.add(l),l.add(n.outOfRange=J4t()),l.add(n.inRange=J4t(null,o?t6t(this._orient):null,D_t(this._dragHandle,this,"all",!1),D_t(this._dragHandle,this,"all",!0))),l.setClipPath(new mDt({shape:{x:0,y:0,width:i[0],height:i[1],r:3}}));var u=e.textStyleModel.getTextRect("国"),c=K4t(u.width,u.height);o&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(e,s,0,i,c,r),this._createHandle(e,s,1,i,c,r)),this._createIndicator(e,s,i,c,r),t.add(s)},e.prototype._createHandle=function(t,e,n,i,r,o){var a=D_t(this._dragHandle,this,n,!1),s=D_t(this._dragHandle,this,n,!0),l=XCt(t.get("handleSize"),i[0]),u=U$t(t.get("handleIcon"),-l/2,-l/2,l,l,null,!0),c=t6t(this._orient);u.attr({cursor:c,draggable:!0,drift:a,ondragend:s,onmousemove:function(t){Lkt(t.event)}}),u.x=i[0]/2,u.useStyle(t.getModel("handleStyle").getItemStyle()),u.setStyle({strokeNoScale:!0,strokeFirst:!0}),u.style.lineWidth*=2,u.ensureState("emphasis").style=t.getModel(["emphasis","handleStyle"]).getItemStyle(),fTt(u,!0),e.add(u);var h=this.visualMapModel.textStyleModel,d=new xDt({cursor:c,draggable:!0,drift:a,onmousemove:function(t){Lkt(t.event)},ondragend:s,style:{x:0,y:0,text:"",font:h.getFont(),fill:h.getTextColor()}});d.ensureState("blur").style={opacity:.1},d.stateTransition={duration:200},this.group.add(d);var p=[l,0],f=this._shapes;f.handleThumbs[n]=u,f.handleLabelPoints[n]=p,f.handleLabels[n]=d},e.prototype._createIndicator=function(t,e,n,i,r){var o=XCt(t.get("indicatorSize"),n[0]),a=U$t(t.get("indicatorIcon"),-o/2,-o/2,o,o,null,!0);a.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2});var s=t.getModel("indicatorStyle").getItemStyle();if(a instanceof uDt){var l=a.style;a.useStyle(v_t({image:l.image,x:l.x,y:l.y,width:l.width,height:l.height},s))}else a.useStyle(s);e.add(a);var u=this.visualMapModel.textStyleModel,c=new xDt({silent:!0,invisible:!0,style:{x:0,y:0,text:"",font:u.getFont(),fill:u.getTextColor()}});this.group.add(c);var h=[("horizontal"===r?i/2:6)+n[0]/2,0],d=this._shapes;d.indicator=a,d.indicatorLabel=c,d.indicatorLabelPoint=h,this._firstShowIndicator=!0},e.prototype._dragHandle=function(t,e,n,i){if(this._useHandle){if(this._dragging=!e,!e){var r=this._applyTransform([n,i],this._shapes.mainGroup,!0);this._updateInterval(t,r[1]),this._hideIndicator(),this._updateView()}e===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),e?!this._hovering&&this._clearHoverLinkToSeries():Q4t(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[t],!1)}},e.prototype._resetInterval=function(){var t=this.visualMapModel,e=this._dataInterval=t.getSelected(),n=t.getExtent(),i=[0,t.itemSize[1]];this._handleEnds=[q4t(e[0],n,i,!0),q4t(e[1],n,i,!0)]},e.prototype._updateInterval=function(t,e){e=e||0;var n=this.visualMapModel,i=this._handleEnds,r=[0,n.itemSize[1]];MYt(e,i,r,t,0);var o=n.getExtent();this._dataInterval=[q4t(i[0],r,o,!0),q4t(i[1],r,o,!0)]},e.prototype._updateView=function(t){var e=this.visualMapModel,n=e.getExtent(),i=this._shapes,r=[0,e.itemSize[1]],o=t?r:this._handleEnds,a=this._createBarVisual(this._dataInterval,n,o,"inRange"),s=this._createBarVisual(n,n,r,"outOfRange");i.inRange.setStyle({fill:a.barColor}).setShape("points",a.barPoints),i.outOfRange.setStyle({fill:s.barColor}).setShape("points",s.barPoints),this._updateHandle(o,a)},e.prototype._createBarVisual=function(t,e,n,i){var r={forceState:i,convertOpacityToAlpha:!0},o=this._makeColorGradient(t,r),a=[this.getControllerVisual(t[0],"symbolSize",r),this.getControllerVisual(t[1],"symbolSize",r)],s=this._createBarPoints(n,a);return{barColor:new bEt(0,0,0,1,o),barPoints:s,handlesColor:[o[0].color,o[o.length-1].color]}},e.prototype._makeColorGradient=function(t,e){var n=[],i=(t[1]-t[0])/100;n.push({color:this.getControllerVisual(t[0],"color",e),offset:0});for(var r=1;r<100;r++){var o=t[0]+i*r;if(o>t[1])break;n.push({color:this.getControllerVisual(o,"color",e),offset:r/100})}return n.push({color:this.getControllerVisual(t[1],"color",e),offset:1}),n},e.prototype._createBarPoints=function(t,e){var n=this.visualMapModel.itemSize;return[[n[0]-e[0],t[0]],[n[0],t[0]],[n[0],t[1]],[n[0]-e[1],t[1]]]},e.prototype._createBarGroup=function(t){var e=this._orient,n=this.visualMapModel.get("inverse");return new oAt("horizontal"!==e||n?"horizontal"===e&&n?{scaleX:"bottom"===t?-1:1,rotation:-Math.PI/2}:"vertical"!==e||n?{scaleX:"left"===t?1:-1}:{scaleX:"left"===t?1:-1,scaleY:-1}:{scaleX:"bottom"===t?1:-1,rotation:Math.PI/2})},e.prototype._updateHandle=function(t,e){if(this._useHandle){var n=this._shapes,i=this.visualMapModel,r=n.handleThumbs,o=n.handleLabels,a=i.itemSize,s=i.getExtent();X4t([0,1],(function(l){var u=r[l];u.setStyle("fill",e.handlesColor[l]),u.y=t[l];var c=q4t(t[l],[0,a[1]],s,!0),h=this.getControllerVisual(c,"symbolSize");u.scaleX=u.scaleY=h/a[0],u.x=a[0]-h/2;var d=YEt(n.handleLabelPoints[l],XEt(u,this.group));o[l].setStyle({x:d[0],y:d[1],text:i.formatValueText(this._dataInterval[l]),verticalAlign:"middle",align:"vertical"===this._orient?this._applyTransform("left",n.mainGroup):"center"})}),this)}},e.prototype._showIndicator=function(t,e,n,i){var r=this.visualMapModel,o=r.getExtent(),a=r.itemSize,s=[0,a[1]],l=this._shapes,u=l.indicator;if(u){u.attr("invisible",!1);var c=this.getControllerVisual(t,"color",{convertOpacityToAlpha:!0}),h=this.getControllerVisual(t,"symbolSize"),d=q4t(t,o,s,!0),p=a[0]-h/2,f={x:u.x,y:u.y};u.y=d,u.x=p;var g=YEt(l.indicatorLabelPoint,XEt(u,this.group)),m=l.indicatorLabel;m.attr("invisible",!1);var y=this._applyTransform("left",l.mainGroup),v="horizontal"===this._orient;m.setStyle({text:(n||"")+r.formatValueText(e),verticalAlign:v?y:"middle",align:v?"center":y});var x={x:p,y:d,style:{fill:c}},b={style:{x:g[0],y:g[1]}};if(r.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var w={duration:100,easing:"cubicInOut",additive:!0};u.x=f.x,u.y=f.y,u.animateTo(x,w),m.animateTo(b,w)}else u.attr(x),m.attr(b);this._firstShowIndicator=!1;var _=this._shapes.handleLabels;if(_)for(var k=0;k<_.length;k++)this._api.enterBlur(_[k])}},e.prototype._enableHoverLinkToSeries=function(){var t=this;this._shapes.mainGroup.on("mousemove",(function(e){if(t._hovering=!0,!t._dragging){var n=t.visualMapModel.itemSize,i=t._applyTransform([e.offsetX,e.offsetY],t._shapes.mainGroup,!0,!0);i[1]=Y4t(K4t(0,i[1]),n[1]),t._doHoverLinkToSeries(i[1],0<=i[0]&&i[0]<=n[0])}})).on("mouseout",(function(){t._hovering=!1,!t._dragging&&t._clearHoverLinkToSeries()}))},e.prototype._enableHoverLinkFromSeries=function(){var t=this.api.getZr();this.visualMapModel.option.hoverLink?(t.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),t.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},e.prototype._doHoverLinkToSeries=function(t,e){var n=this.visualMapModel,i=n.itemSize;if(n.option.hoverLink){var r=[0,i[1]],o=n.getExtent();t=Y4t(K4t(r[0],t),r[1]);var a=function(t,e,n){var i=6,r=t.get("hoverLinkDataSize");r&&(i=q4t(r,e,n,!0)/2);return i}(n,o,r),s=[t-a,t+a],l=q4t(t,r,o,!0),u=[q4t(s[0],r,o,!0),q4t(s[1],r,o,!0)];s[0]<r[0]&&(u[0]=-1/0),s[1]>r[1]&&(u[1]=1/0),e&&(u[0]===-1/0?this._showIndicator(l,u[1],"< ",a):u[1]===1/0?this._showIndicator(l,u[0],"> ",a):this._showIndicator(l,l,"≈ ",a));var c=this._hoverLinkDataIndices,h=[];(e||Q4t(n))&&(h=this._hoverLinkDataIndices=n.findTargetDataIndices(u));var d=function(t,e){var n={},i={};return r(t||[],n),r(e||[],i,n),[o(n),o(i)];function r(t,e,n){for(var i=0,r=t.length;i<r;i++){var o=zAt(t[i].seriesId,null);if(null==o)return;for(var a=NAt(t[i].dataIndex),s=n&&n[o],l=0,u=a.length;l<u;l++){var c=a[l];s&&s[c]?s[c]=null:(e[o]||(e[o]={}))[c]=1}}}function o(t,e){var n=[];for(var i in t)if(t.hasOwnProperty(i)&&null!=t[i])if(e)n.push(+i);else{var r=o(t[i],!0);r.length&&n.push({seriesId:i,dataIndex:r})}return n}}(c,h);this._dispatchHighDown("downplay",H4t(d[0],n)),this._dispatchHighDown("highlight",H4t(d[1],n))}},e.prototype._hoverLinkFromSeriesMouseOver=function(t){var e=t.target,n=this.visualMapModel;if(e&&null!=IDt(e).dataIndex){var i=IDt(e),r=this.ecModel.getSeriesByIndex(i.seriesIndex);if(n.isTargetSeries(r)){var o=r.getData(i.dataType),a=o.get(n.getDataDimension(o),i.dataIndex);isNaN(a)||this._showIndicator(a,a)}}},e.prototype._hideIndicator=function(){var t=this._shapes;t.indicator&&t.indicator.attr("invisible",!0),t.indicatorLabel&&t.indicatorLabel.attr("invisible",!0);var e=this._shapes.handleLabels;if(e)for(var n=0;n<e.length;n++)this._api.leaveBlur(e[n])},e.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var t=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",H4t(t,this.visualMapModel)),t.length=0},e.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var t=this.api.getZr();t.off("mouseover",this._hoverLinkFromSeriesMouseOver),t.off("mouseout",this._hideIndicator)},e.prototype._applyTransform=function(t,e,n,i){var r=XEt(e,i?null:this.group);return E_t(t)?YEt(t,r,n):KEt(t,r,n)},e.prototype._dispatchHighDown=function(t,e){e&&e.length&&this.api.dispatchAction({type:t,batch:e})},e.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},e.prototype.remove=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},e.type="visualMap.continuous",e}(j4t);function J4t(t,e,n,i){return new aEt({shape:{points:t},draggable:!!n,cursor:e,drift:n,onmousemove:function(t){Lkt(t.event)},ondragend:i})}function Q4t(t){var e=t.get("hoverLinkOnHandle");return!!(null==e?t.get("realtime"):e)}function t6t(t){return"vertical"===t?"ns-resize":"ew-resize"}var e6t={type:"selectDataRange",event:"dataRangeSelected",update:"update"},n6t=function(t,e){e.eachComponent({mainType:"visualMap",query:t},(function(e){e.setSelected(t.selected)}))},i6t=[{createOnAllSeries:!0,reset:function(t,e){var n=[];return e.eachComponent("visualMap",(function(e){var i,r,o,a,s,l=t.pipelineContext;!e.isTargetSeries(t)||l&&l.large||n.push((i=e.stateList,r=e.targetVisuals,o=D_t(e.getValueState,e),a=e.getDataDimension(t.getData()),s={},S_t(i,(function(t){var e=kqt.prepareVisualTypes(r[t]);s[t]=e})),{progress:function(t,e){var n,i;function l(t){return qLt(e,i,t)}function u(t,n){YLt(e,i,t,n)}for(null!=a&&(n=e.getDimension(a));null!=(i=t.next());){var c=e.getRawDataItem(i);if(!c||!1!==c.visualMap)for(var h=null!=a?e.get(n,i):i,d=o(h),p=r[d],f=s[d],g=0,m=f.length;g<m;g++){var y=f[g];p[y]&&p[y].applyVisual(h,l,u)}}}}))})),n}},{createOnAllSeries:!0,reset:function(t,e){var n=t.getData(),i=[];e.eachComponent("visualMap",(function(e){if(e.isTargetSeries(t)){var r=e.getVisualMeta(D_t(r6t,null,t,e))||{stops:[],outerColors:[]},o=e.getDataDimension(n),a=n.getDimensionInfo(o);null!=a&&(r.dimension=a.index,i.push(r))}})),t.getData().setVisual("visualMeta",i)}}];function r6t(t,e,n,i){for(var r=e.targetVisuals[i],o=kqt.prepareVisualTypes(r),a={color:XLt(t.getData(),"color")},s=0,l=o.length;s<l;s++){var u=o[s],c=r["opacity"===u?"__alphaForOpacity":u];c&&c.applyVisual(n,h,d)}return a.color;function h(t){return a[t]}function d(t,e){a[t]=e}}var o6t=S_t;function a6t(t){var e=t&&t.visualMap;E_t(e)||(e=e?[e]:[]),o6t(e,(function(t){if(t){s6t(t,"splitList")&&!s6t(t,"pieces")&&(t.pieces=t.splitList,delete t.splitList);var e=t.pieces;e&&E_t(e)&&o6t(e,(function(t){L_t(t)&&(s6t(t,"start")&&!s6t(t,"min")&&(t.min=t.start),s6t(t,"end")&&!s6t(t,"max")&&(t.max=t.end))}))}}))}function s6t(t,e){return t&&t.hasOwnProperty&&t.hasOwnProperty(e)}var l6t=!1;function u6t(t){l6t||(l6t=!0,t.registerSubTypeDefaulter("visualMap",(function(t){return t.categories||(t.pieces?t.pieces.length>0:t.splitNumber>0)&&!t.calculable?"piecewise":"continuous"})),t.registerAction(e6t,n6t),S_t(i6t,(function(e){t.registerVisual(t.PRIORITY.VISUAL.COMPONENT,e)})),t.registerPreprocessor(a6t))}function c6t(t){t.registerComponentModel(V4t),t.registerComponentView(Z4t),u6t(t)}var h6t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n._pieceList=[],n}return Dit(e,t),e.prototype.optionUpdated=function(e,n){t.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var i=this._mode=this._determineMode();this._pieceList=[],d6t[this._mode].call(this,this._pieceList),this._resetSelected(e,n);var r=this.option.categories;this.resetVisual((function(t,e){"categories"===i?(t.mappingMethod="category",t.categories=g_t(r)):(t.dataExtent=this.getExtent(),t.mappingMethod="piecewise",t.pieceList=C_t(this._pieceList,(function(t){return t=g_t(t),"inRange"!==e&&(t.visual=null),t})))}))},e.prototype.completeVisualOption=function(){var e=this.option,n={},i=kqt.listVisualTypes(),r=this.isCategory();function o(t,e,n){return t&&t[e]&&t[e].hasOwnProperty(n)}S_t(e.pieces,(function(t){S_t(i,(function(e){t.hasOwnProperty(e)&&(n[e]=1)}))})),S_t(n,(function(t,n){var i=!1;S_t(this.stateList,(function(t){i=i||o(e,t,n)||o(e.target,t,n)}),this),!i&&S_t(this.stateList,(function(t){(e[t]||(e[t]={}))[n]=E4t(n,"inRange"===t?"active":"inactive",r)}))}),this),t.prototype.completeVisualOption.apply(this,arguments)},e.prototype._resetSelected=function(t,e){var n=this.option,i=this._pieceList,r=(e?n:t).selected||{};if(n.selected=r,S_t(i,(function(t,e){var n=this.getSelectedMapKey(t);r.hasOwnProperty(n)||(r[n]=!0)}),this),"single"===n.selectedMode){var o=!1;S_t(i,(function(t,e){var n=this.getSelectedMapKey(t);r[n]&&(o?r[n]=!1:o=!0)}),this)}},e.prototype.getItemSymbol=function(){return this.get("itemSymbol")},e.prototype.getSelectedMapKey=function(t){return"categories"===this._mode?t.value+"":t.index+""},e.prototype.getPieceList=function(){return this._pieceList},e.prototype._determineMode=function(){var t=this.option;return t.pieces&&t.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},e.prototype.setSelected=function(t){this.option.selected=g_t(t)},e.prototype.getValueState=function(t){var e=kqt.findPieceIndex(t,this._pieceList);return null!=e&&this.option.selected[this.getSelectedMapKey(this._pieceList[e])]?"inRange":"outOfRange"},e.prototype.findTargetDataIndices=function(t){var e=[],n=this._pieceList;return this.eachTargetSeries((function(i){var r=[],o=i.getData();o.each(this.getDataDimension(o),(function(e,i){kqt.findPieceIndex(e,n)===t&&r.push(i)}),this),e.push({seriesId:i.id,dataIndex:r})}),this),e},e.prototype.getRepresentValue=function(t){var e;if(this.isCategory())e=t.value;else if(null!=t.value)e=t.value;else{var n=t.interval||[];e=n[0]===-1/0&&n[1]===1/0?0:(n[0]+n[1])/2}return e},e.prototype.getVisualMeta=function(t){if(!this.isCategory()){var e=[],n=["",""],i=this,r=this._pieceList.slice();if(r.length){var o=r[0].interval[0];o!==-1/0&&r.unshift({interval:[-1/0,o]}),(o=r[r.length-1].interval[1])!==1/0&&r.push({interval:[o,1/0]})}else r.push({interval:[-1/0,1/0]});var a=-1/0;return S_t(r,(function(t){var e=t.interval;e&&(e[0]>a&&s([a,e[0]],"outOfRange"),s(e.slice()),a=e[1])}),this),{stops:e,outerColors:n}}function s(r,o){var a=i.getRepresentValue({interval:r});o||(o=i.getValueState(a));var s=t(a,o);r[0]===-1/0?n[0]=s:r[1]===1/0?n[1]=s:e.push({value:r[0],color:s},{value:r[1],color:s})}},e.type="visualMap.piecewise",e.defaultOption=RNt(z4t.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),e}(z4t),d6t={splitNumber:function(t){var e=this.option,n=Math.min(e.precision,20),i=this.getExtent(),r=e.splitNumber;r=Math.max(parseInt(r,10),1),e.splitNumber=r;for(var o=(i[1]-i[0])/r;+o.toFixed(n)!==o&&n<5;)n++;e.precision=n,o=+o.toFixed(n),e.minOpen&&t.push({interval:[-1/0,i[0]],close:[0,0]});for(var a=0,s=i[0];a<r;s+=o,a++){var l=a===r-1?i[1]:s+o;t.push({interval:[s,l],close:[1,1]})}e.maxOpen&&t.push({interval:[i[1],1/0],close:[0,0]}),CAt(t),S_t(t,(function(t,e){t.index=e,t.text=this.formatValueText(t.interval)}),this)},categories:function(t){var e=this.option;S_t(e.categories,(function(e){t.push({text:this.formatValueText(e,!0),value:e})}),this),p6t(e,t)},pieces:function(t){var e=this.option;S_t(e.pieces,(function(e,n){L_t(e)||(e={value:e});var i={text:"",index:n};if(null!=e.label&&(i.text=e.label),e.hasOwnProperty("value")){var r=i.value=e.value;i.interval=[r,r],i.close=[1,1]}else{for(var o=i.interval=[],a=i.close=[0,0],s=[1,0,1],l=[-1/0,1/0],u=[],c=0;c<2;c++){for(var h=[["gte","gt","min"],["lte","lt","max"]][c],d=0;d<3&&null==o[c];d++)o[c]=e[h[d]],a[c]=s[d],u[c]=2===d;null==o[c]&&(o[c]=l[c])}u[0]&&o[1]===1/0&&(a[0]=0),u[1]&&o[0]===-1/0&&(a[1]=0),o[0]===o[1]&&a[0]&&a[1]&&(i.value=o[0])}i.visual=kqt.retrieveVisuals(e),t.push(i)}),this),p6t(e,t),CAt(t),S_t(t,(function(t){var e=t.close,n=[["<","≤"][e[1]],[">","≥"][e[0]]];t.text=t.text||this.formatValueText(null!=t.value?t.value:t.interval,!1,n)}),this)}};function p6t(t,e){var n=t.inverse;("vertical"===t.orient?!n:n)&&e.reverse()}var f6t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return Dit(e,t),e.prototype.doRender=function(){var t=this.group;t.removeAll();var e=this.visualMapModel,n=e.get("textGap"),i=e.textStyleModel,r=i.getFont(),o=i.getTextColor(),a=this._getItemAlign(),s=e.itemSize,l=this._getViewData(),u=l.endsText,c=V_t(e.get("showLabel",!0),!u);u&&this._renderEndsText(t,u[0],s,c,a),S_t(l.viewPieceList,(function(i){var l=i.piece,u=new oAt;u.onclick=D_t(this._onItemClick,this,l),this._enableHoverLink(u,i.indexInModelPieceList);var h=e.getRepresentValue(l);if(this._createItemSymbol(u,h,[0,0,s[0],s[1]]),c){var d=this.visualMapModel.getValueState(h);u.add(new xDt({style:{x:"right"===a?-n:s[0]+n,y:s[1]/2,text:l.text,verticalAlign:"middle",align:a,font:r,fill:o,opacity:"outOfRange"===d?.5:1}}))}t.add(u)}),this),u&&this._renderEndsText(t,u[1],s,c,a),AOt(e.get("orient"),t,e.get("itemGap")),this.renderBackground(t),this.positionGroup(t)},e.prototype._enableHoverLink=function(t,e){var n=this;t.on("mouseover",(function(){return i("highlight")})).on("mouseout",(function(){return i("downplay")}));var i=function(t){var i=n.visualMapModel;i.option.hoverLink&&n.api.dispatchAction({type:t,batch:H4t(i.findTargetDataIndices(e),i)})}},e.prototype._getItemAlign=function(){var t=this.visualMapModel,e=t.option;if("vertical"===e.orient)return G4t(t,this.api,t.itemSize);var n=e.align;return n&&"auto"!==n||(n="left"),n},e.prototype._renderEndsText=function(t,e,n,i,r){if(e){var o=new oAt,a=this.visualMapModel.textStyleModel;o.add(new xDt({style:{x:i?"right"===r?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:i?r:"center",text:e,font:a.getFont(),fill:a.getTextColor()}})),t.add(o)}},e.prototype._getViewData=function(){var t=this.visualMapModel,e=C_t(t.getPieceList(),(function(t,e){return{piece:t,indexInModelPieceList:e}})),n=t.get("text"),i=t.get("orient"),r=t.get("inverse");return("horizontal"===i?r:!r)?e.reverse():n&&(n=n.slice().reverse()),{viewPieceList:e,endsText:n}},e.prototype._createItemSymbol=function(t,e,n){t.add(U$t(this.getControllerVisual(e,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(e,"color")))},e.prototype._onItemClick=function(t){var e=this.visualMapModel,n=e.option,i=g_t(n.selected),r=e.getSelectedMapKey(t);"single"===n.selectedMode?(i[r]=!0,S_t(i,(function(t,e){i[e]=e===r}))):i[r]=!i[r],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:i})},e.type="visualMap.piecewise",e}(j4t);function g6t(t){t.registerComponentModel(h6t),t.registerComponentView(f6t),u6t(t)}var m6t={label:{enabled:!0},decal:{show:!1}},y6t=jAt(),v6t={};function x6t(t,e){var n=t.getModel("aria");if(n.get("enabled")){var i=g_t(m6t);m_t(i.label,t.getLocaleModel().get("aria"),!1),m_t(n.option,i,!1),function(){if(n.getModel("decal").get("show")){var e=Z_t();t.eachSeries((function(t){if(t.useColorPaletteOnData){var n=e.get(t.type);n||(n={},e.set(t.type,n)),y6t(t).scope=n}})),t.eachRawSeries((function(e){if(!t.isSeriesFiltered(e))if("function"!=typeof e.enableAriaDecal){var n=e.getData();if(e.useColorPaletteOnData){var i=e.getRawData(),r={},o=y6t(e).scope;n.each((function(t){var e=n.getRawIndex(t);r[e]=t}));var a=i.count();i.each((function(t){var s=r[t],l=i.getName(t)||t+"",c=eFt(e.ecModel,l,o,a),h=n.getItemVisual(s,"decal");n.setItemVisual(s,"decal",u(h,c))}))}else{var s=eFt(e.ecModel,e.name,v6t,t.getSeriesCount()),l=n.getVisual("decal");n.setVisual("decal",u(l,s))}}else e.enableAriaDecal();function u(t,e){var n=t?v_t(v_t({},e),t):e;return n.dirty=!0,n}}))}}(),function(){var i=t.getLocaleModel().get("aria"),o=n.getModel("label");if(o.option=x_t(o.option,i),!o.get("enabled"))return;var a=e.getZr().dom;if(o.get("description"))return void a.setAttribute("aria-label",o.get("description"));var s,l=t.getSeriesCount(),u=o.get(["data","maxCount"])||10,c=o.get(["series","maxCount"])||10,h=Math.min(l,c);if(l<1)return;var d=function(){var e=t.get("title");e&&e.length&&(e=e[0]);return e&&e.text}();if(d){var p=o.get(["general","withTitle"]);s=r(p,{title:d})}else s=o.get(["general","withoutTitle"]);var f=[],g=l>1?o.get(["series","multiple","prefix"]):o.get(["series","single","prefix"]);s+=r(g,{seriesCount:l}),t.eachSeries((function(e,n){if(n<h){var i=void 0,a=e.get("name")?"withName":"withoutName";i=r(i=l>1?o.get(["series","multiple",a]):o.get(["series","single",a]),{seriesId:e.seriesIndex,seriesName:e.get("name"),seriesType:(x=e.subType,t.getLocaleModel().get(["series","typeNames"])[x]||"自定义图")});var s=e.getData();if(s.count()>u)i+=r(o.get(["data","partialData"]),{displayCnt:u});else i+=o.get(["data","allData"]);for(var c=[],d=0;d<s.count();d++)if(d<u){var p=s.getName(d),g=oRt(s,d),m=o.get(["data",p?"withName":"withoutName"]);c.push(r(m,{name:p,value:g}))}var y=o.get(["data","separator","middle"]),v=o.get(["data","separator","end"]);i+=c.join(y)+v,f.push(i)}var x}));var m=o.getModel(["series","multiple","separator"]),y=m.get("middle"),v=m.get("end");s+=f.join(y)+v,a.setAttribute("aria-label",s)}()}function r(t,e){if("string"!=typeof t)return t;var n=t;return S_t(e,(function(t,e){n=n.replace(new RegExp("\\{\\s*"+e+"\\s*\\}","g"),t)})),n}}function b6t(t){if(t&&t.aria){var e=t.aria;null!=e.show&&(e.enabled=e.show),e.label=e.label||{},S_t(["description","general","series","data"],(function(t){null!=e[t]&&(e.label[t]=e[t])}))}}var w6t={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},_6t=function(){function t(t){var e;if(null==(this._condVal=O_t(t)?new RegExp(t):(e=t,"[object RegExp]"===i_t.call(e)?t:null))){EAt("")}}return t.prototype.evaluate=function(t){var e=typeof t;return"string"===e?this._condVal.test(t):"number"===e&&this._condVal.test(t+"")},t}(),k6t=function(){function t(){}return t.prototype.evaluate=function(){return this.value},t}(),S6t=function(){function t(){}return t.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(!t[e].evaluate())return!1;return!0},t}(),C6t=function(){function t(){}return t.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(t[e].evaluate())return!0;return!1},t}(),A6t=function(){function t(){}return t.prototype.evaluate=function(){return!this.child.evaluate()},t}(),I6t=function(){function t(){}return t.prototype.evaluate=function(){for(var t=!!this.valueParser,e=(0,this.getValue)(this.valueGetterParam),n=t?this.valueParser(e):null,i=0;i<this.subCondList.length;i++)if(!this.subCondList[i].evaluate(t?n:e))return!1;return!0},t}();function M6t(t,e){if(!0===t||!1===t){var n=new k6t;return n.value=t,n}return T6t(t)||EAt(""),t.and?D6t("and",t,e):t.or?D6t("or",t,e):t.not?function(t,e){var n=t.not,i="";T6t(n)||EAt(i);var r=new A6t;r.child=M6t(n,e),r.child||EAt(i);return r}(t,e):function(t,e){for(var n="",i=e.prepareGetValue(t),r=[],o=M_t(t),a=t.parser,s=a?fRt(a):null,l=0;l<o.length;l++){var u=o[l];if("parser"!==u&&!e.valueGetterAttrMap.get(u)){var c=tkt(w6t,u)?w6t[u]:u,h=t[u],d=s?s(h):h,p=xRt(c,d)||"reg"===c&&new _6t(d);p||EAt(n),r.push(p)}}r.length||EAt(n);var f=new I6t;return f.valueGetterParam=i,f.valueParser=s,f.getValue=e.getValue,f.subCondList=r,f}(t,e)}function D6t(t,e,n){var i=e[t];E_t(i)||EAt(""),i.length||EAt("");var r="and"===t?new S6t:new C6t;return r.children=C_t(i,(function(t){return M6t(t,n)})),r.children.length||EAt(""),r}function T6t(t){return L_t(t)&&!k_t(t)}var E6t=function(){function t(t,e){this._cond=M6t(t,e)}return t.prototype.evaluate=function(){return this._cond.evaluate()},t}();var N6t={type:"echarts:filter",transform:function(t){for(var e,n,i,r=t.upstream,o=(n=t.config,i={valueGetterAttrMap:Z_t({dimension:!0}),prepareGetValue:function(t){var e=t.dimension;tkt(t,"dimension")||EAt("");var n=r.getDimensionInfo(e);return n||EAt(""),{dimIdx:n.index}},getValue:function(t){return r.retrieveValueFromItem(e,t.dimIdx)}},new E6t(n,i)),a=[],s=0,l=r.count();s<l;s++)e=r.getRawDataItem(s),o.evaluate()&&a.push(e);return{data:a}}},O6t={type:"echarts:sort",transform:function(t){var e=t.upstream,n=t.config,i="",r=NAt(n);r.length||EAt(i);var o=[];S_t(r,(function(t){var n=t.dimension,r=t.order,a=t.parser,s=t.incomparable;if(null==n&&EAt(i),"asc"!==r&&"desc"!==r&&EAt(i),s&&"min"!==s&&"max"!==s){EAt("")}if("asc"!==r&&"desc"!==r){EAt("")}var l=e.getDimensionInfo(n);l||EAt(i);var u=a?fRt(a):null;a&&!u&&EAt(i),o.push({dimIdx:l.index,parser:u,comparator:new yRt(r,s)})}));var a=e.sourceFormat;"arrayRows"!==a&&"objectRows"!==a&&EAt(i);for(var s=[],l=0,u=e.count();l<u;l++)s.push(e.getRawDataItem(l));return s.sort((function(t,n){for(var i=0;i<o.length;i++){var r=o[i],a=e.retrieveValueFromItem(t,r.dimIdx),s=e.retrieveValueFromItem(n,r.dimIdx);r.parser&&(a=r.parser(a),s=r.parser(s));var l=r.comparator.evaluate(a,s);if(0!==l)return l}return 0})),{data:s}}};var F6t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="dataset",e}return Dit(e,t),e.prototype.init=function(e,n,i){t.prototype.init.call(this,e,n,i),this._sourceManager=new MRt(this),DRt(this)},e.prototype.mergeOption=function(e,n){t.prototype.mergeOption.call(this,e,n),DRt(this)},e.prototype.optionUpdated=function(){this._sourceManager.dirty()},e.prototype.getSourceManager=function(){return this._sourceManager},e.type="dataset",e.defaultOption={seriesLayoutBy:"column"},e}(FOt),R6t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="dataset",e}return Dit(e,t),e.type="dataset",e}(nLt);gBt([function(t){t.registerPainter("canvas",ljt)}]),gBt([function(t){t.registerPainter("svg",njt)}]),gBt([function(t){t.registerChartView(Ujt),t.registerSeriesModel(ujt),t.registerLayout(Gjt("line",!0)),t.registerVisual({seriesType:"line",reset:function(t){var e=t.getData(),n=t.getModel("lineStyle").getLineStyle();n&&!n.stroke&&(n.stroke=e.getVisual("style").fill),e.setVisual("legendLineStyle",n)}}),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,Xjt("line"))},function(t){t.registerChartView(nUt),t.registerSeriesModel(Kjt),t.registerLayout(t.PRIORITY.VISUAL.LAYOUT,T_t(wVt,"bar")),t.registerLayout(t.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,_Vt),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,Xjt("bar")),t.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},(function(t,e){var n=t.componentType||"series";e.eachComponent({mainType:n,query:t},(function(e){t.sortInfo&&e.axis.setCategorySortInfo(t.sortInfo)}))}))},function(t){t.registerChartView(kUt),t.registerSeriesModel(AUt),E$t("pie",t.registerAction),t.registerLayout(T_t(gUt,"pie")),t.registerProcessor(mUt("pie"))},function(t){gBt(CGt),t.registerSeriesModel(IUt),t.registerChartView(EUt),t.registerLayout(Gjt("scatter"))},function(t){gBt(zGt),t.registerChartView(TGt),t.registerSeriesModel(EGt),t.registerLayout(AGt),t.registerProcessor(mUt("radar")),t.registerPreprocessor(DGt)},function(t){gBt(SHt),t.registerChartView(uHt),t.registerSeriesModel(cHt),t.registerLayout(dHt),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,hHt),E$t("map",t.registerAction)},function(t){t.registerChartView(LHt),t.registerSeriesModel(nqt),t.registerLayout(rqt),t.registerVisual(oqt),function(t){t.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},(function(t,e){e.eachComponent({mainType:"series",subType:"tree",query:t},(function(e){var n=t.dataIndex,i=e.getData().tree.getNodeByDataIndex(n);i.isExpand=!i.isExpand}))})),t.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},(function(t,e){e.eachComponent({mainType:"series",subType:"tree",query:t},(function(e){var n=_Ht(e.coordinateSystem,t);e.setCenter&&e.setCenter(n.center),e.setZoom&&e.setZoom(n.zoom)}))}))}(t)},function(t){t.registerSeriesModel(uqt),t.registerChartView(bqt),t.registerVisual(Lqt),t.registerLayout(Yqt),function(t){for(var e=0;e<sqt.length;e++)t.registerAction({type:sqt[e],update:"updateView"},aqt);t.registerAction({type:"treemapRootToNode",update:"updateView"},(function(t,e){e.eachComponent({mainType:"series",subType:"treemap",query:t},(function(e,n){var i=JHt(t,["treemapZoomToNode","treemapRootToNode"],e);if(i){var r=e.getViewRoot();r&&(t.direction=tqt(r,i.node)?"rollUp":"drillDown"),e.resetViewRoot(i.node)}}))}))}(t)},function(t){t.registerChartView(qXt),t.registerSeriesModel(tYt),t.registerProcessor(eXt),t.registerVisual(nXt),t.registerVisual(rXt),t.registerLayout(pXt),t.registerLayout(t.PRIORITY.VISUAL.POST_CHART_LAYOUT,bXt),t.registerLayout(_Xt),t.registerCoordinateSystem("graphView",{dimensions:fHt.dimensions,create:kXt}),t.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},(function(){})),t.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},(function(){})),t.registerAction(eYt,(function(t,e){e.eachComponent({mainType:"series",query:t},(function(e){var n=_Ht(e.coordinateSystem,t);e.setCenter&&e.setCenter(n.center),e.setZoom&&e.setZoom(n.zoom)}))}))},function(t){t.registerChartView(aYt),t.registerSeriesModel(sYt)},function(t){t.registerChartView(cYt),t.registerSeriesModel(hYt),t.registerLayout(dYt),t.registerProcessor(mUt("funnel"))},function(t){gBt(LKt),t.registerChartView(pYt),t.registerSeriesModel(vYt),t.registerVisual(t.PRIORITY.VISUAL.BRUSH,wYt)},function(t){t.registerChartView(zKt),t.registerSeriesModel(BKt),t.registerLayout(VKt),t.registerVisual(QKt),t.registerAction({type:"dragNode",event:"dragnode",update:"update"},(function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},(function(e){e.setNodePosition(t.dataIndex,[t.localX,t.localY])}))}))},function(t){t.registerSeriesModel(eZt),t.registerChartView(nZt),t.registerVisual(lZt),t.registerLayout(cZt),t.registerTransform(hZt)},function(t){t.registerChartView(pZt),t.registerSeriesModel(SZt),t.registerPreprocessor(CZt),t.registerVisual(TZt),t.registerLayout(NZt)},function(t){t.registerChartView(LZt),t.registerSeriesModel($Zt),t.registerLayout(Gjt("effectScatter"))},function(t){t.registerChartView(GZt),t.registerSeriesModel(YZt),t.registerLayout(UZt),t.registerVisual(ZZt)},function(t){t.registerChartView(tJt),t.registerSeriesModel(eJt)},function(t){t.registerChartView(oJt),t.registerSeriesModel(kJt),t.registerLayout(T_t(wVt,"pictorialBar"))},function(t){t.registerChartView(SJt),t.registerSeriesModel(CJt),t.registerLayout(AJt),t.registerProcessor(mUt("themeRiver"))},function(t){t.registerChartView(DJt),t.registerSeriesModel(TJt),t.registerLayout(T_t(OJt,"sunburst")),t.registerProcessor(T_t(mUt,"sunburst")),t.registerVisual(RJt),function(t){t.registerAction({type:"sunburstRootToNode",update:"updateView"},(function(t,e){e.eachComponent({mainType:"series",subType:"sunburst",query:t},(function(e,n){var i=JHt(t,["sunburstRootToNode"],e);if(i){var r=e.getViewRoot();r&&(t.direction=tqt(r,i.node)?"rollUp":"drillDown"),e.resetViewRoot(i.node)}}))})),t.registerAction({type:"sunburstHighlight",update:"none"},(function(t,e,n){t=v_t({},t),e.eachComponent({mainType:"series",subType:"sunburst",query:t},(function(e){var n=JHt(t,["sunburstHighlight"],e);n&&(t.dataIndex=n.node.dataIndex)})),n.dispatchAction(v_t(t,{type:"highlight"}))})),t.registerAction({type:"sunburstUnhighlight",update:"updateView"},(function(t,e,n){t=v_t({},t),n.dispatchAction(v_t(t,{type:"downplay"}))}))}(t)},function(t){t.registerChartView(MQt),t.registerSeriesModel(IQt)}]),gBt((function(t){gBt(CGt),gBt(X0t)})),gBt((function(t){gBt(X0t),pGt.registerAxisPointerClass("PolarAxisPointer",Y0t),t.registerCoordinateSystem("polar",l1t),t.registerComponentModel(Z0t),t.registerComponentView(S1t),zUt(t,"angle",Q0t,_1t),zUt(t,"radius",t1t,k1t),t.registerComponentView(p1t),t.registerComponentView(y1t),t.registerLayout(T_t(w1t,"bar"))})),gBt(SHt),gBt((function(t){gBt(X0t),pGt.registerAxisPointerClass("SingleAxisPointer",$1t),t.registerComponentView(V1t),t.registerComponentView(M1t),t.registerComponentModel(T1t),zUt(t,"single",T1t,T1t.defaultOption),t.registerCoordinateSystem("single",F1t)})),gBt(LKt),gBt((function(t){t.registerComponentModel(W1t),t.registerComponentView(H1t),t.registerCoordinateSystem("calendar",q1t)})),gBt((function(t){t.registerComponentModel(J1t),t.registerComponentView(Q1t),t.registerPreprocessor(Z1t)})),gBt((function(t){t.registerComponentModel(C2t),t.registerComponentView(I2t),k2t("saveAsImage",M2t),k2t("magicType",T2t),k2t("dataView",L2t),k2t("dataZoom",r3t),k2t("restore",V2t),gBt(b2t)})),gBt((function(t){gBt(X0t),t.registerComponentModel(s3t),t.registerComponentView(M3t),t.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},(function(){})),t.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},(function(){}))})),gBt(X0t),gBt((function(t){t.registerComponentView(Y3t),t.registerComponentModel(K3t),t.registerPreprocessor(O3t),t.registerVisual(t.PRIORITY.VISUAL.BRUSH,U3t),t.registerAction({type:"brush",event:"brush",update:"updateVisual"},(function(t,e){e.eachComponent({mainType:"brush",query:t},(function(e){e.setAreas(t.areas)}))})),t.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},(function(){})),t.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},(function(){})),k2t("brush",Q3t)})),gBt((function(t){t.registerComponentModel(t5t),t.registerComponentView(e5t)})),gBt((function(t){t.registerComponentModel(i5t),t.registerComponentView(l5t),t.registerSubTypeDefaulter("timeline",(function(){return"slider"})),function(t){t.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},(function(t,e){var n=e.getComponent("timeline");return n&&null!=t.currentIndex&&(n.setCurrentIndex(t.currentIndex),!n.get("loop",!0)&&n.isIndexMax()&&n.setPlayState(!1)),e.resetOption("timeline",{replaceMerge:n.get("replaceMerge",!0)}),x_t({currentIndex:n.option.currentIndex},t)})),t.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},(function(t,e){var n=e.getComponent("timeline");n&&null!=t.playState&&n.setPlayState(t.playState)}))}(t),t.registerPreprocessor(h5t)})),gBt((function(t){t.registerComponentModel(v5t),t.registerComponentView(D5t),t.registerPreprocessor((function(t){f5t(t.series,"markPoint")&&(t.markPoint=t.markPoint||{})}))})),gBt((function(t){t.registerComponentModel(T5t),t.registerComponentView($5t),t.registerPreprocessor((function(t){f5t(t.series,"markLine")&&(t.markLine=t.markLine||{})}))})),gBt((function(t){t.registerComponentModel(P5t),t.registerComponentView(H5t),t.registerPreprocessor((function(t){f5t(t.series,"markArea")&&(t.markArea=t.markArea||{})}))})),gBt((function(t){gBt(r4t),gBt(h4t)})),gBt((function(t){gBt(k4t),gBt(T4t)})),gBt(k4t),gBt(T4t),gBt((function(t){gBt(c6t),gBt(g6t)})),gBt(c6t),gBt(g6t),gBt((function(t){t.registerPreprocessor(b6t),t.registerVisual(t.PRIORITY.VISUAL.ARIA,x6t)})),gBt((function(t){t.registerTransform(N6t),t.registerTransform(O6t)})),gBt((function(t){t.registerComponentModel(F6t),t.registerComponentView(R6t)}));export{tm as D,Gg as L,rm as R,Wf as S,Qe as a,zg as b,$s as c,Jwt as d,iBt as i,pu as l,ds as s,Cu as t};
